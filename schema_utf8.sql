USE [BaseCrm]
GO
/****** Object:  Table [dbo].[VenCliHeader]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[VenCliHeader](
	[idtransaccion] [int] IDENTITY(1,1) NOT NULL,
	[comprobante] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[fecha] [datetime] NOT NULL,
	[cliente] [int] NOT NULL,
	[tipocomprobante] [int] NOT NULL,
	[nrocomprobante] [char](12) NULL,
	[tipofactura] [char](1) NULL,
	[totalimporte] [numeric](18, 2) NOT NULL,
	[cancelado] [numeric](18, 2) NULL,
	[fecha1venc] [datetime] NULL,
	[fecha2venc] [datetime] NULL,
	[estado] [char](2) NULL,
	[fechareal] [datetime] NOT NULL,
	[centrocosto] [int] NULL,
	[DescripcionImporte] [varchar](255) NULL,
	[Moneda] [int] NULL,
	[ImporteOrigen] [numeric](18, 2) NULL,
	[TC] [numeric](18, 4) NULL,
	[doc_c] [numeric](18, 0) NULL,
	[CanceladoOrigen] [numeric](18, 2) NULL,
 CONSTRAINT [PK_VenCliHeader] PRIMARY KEY CLUSTERED 
(
	[idtransaccion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  View [dbo].[Pendientes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create view [dbo].[Pendientes]
as
Select * from Basecrm..vencliheader vv
where (isnull(vv.cancelado,0)<>vv.totalimporte
or isnull(vv.canceladoOrigen,0)<>vv.importeOrigen)
GO
/****** Object:  Table [dbo].[Provincias]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Provincias](
	[provincia] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [char](30) NULL,
	[pClip] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[socios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[socios](
	[socio] [int] IDENTITY(1,1) NOT NULL,
	[Apellido] [char](40) NULL,
	[nombre] [char](40) NULL,
	[tipodocto] [tinyint] NULL,
	[numedocto] [int] NULL,
	[Nacionalidad] [int] NULL,
	[Sexo] [tinyint] NULL,
	[Grupo] [char](1) NULL,
	[gDesde] [datetime] NULL,
	[nAma] [char](10) NULL,
	[DomicilioPrincipal] [char](1) NULL,
	[Domicilio] [varchar](60) NULL,
	[cpostal] [varchar](8) NULL,
	[localidad] [varchar](50) NULL,
	[provincia] [int] NULL,
	[pais] [int] NULL,
	[telefono] [varchar](100) NULL,
	[Fax] [varchar](100) NULL,
	[Email] [varchar](100) NULL,
	[EmailAlt1] [varchar](50) NULL,
	[EmailAlt2] [varchar](50) NULL,
	[EmailAlt3] [varchar](50) NULL,
	[EstadoCivil] [tinyint] NULL,
	[Nacido] [datetime] NULL,
	[mesRecibido] [tinyint] NULL,
	[anoRecibido] [int] NULL,
	[Domicilio_consultorio] [char](40) NULL,
	[cpostal_consultorio] [varchar](8) NULL,
	[localidad_consultorio] [varchar](50) NULL,
	[provincia_consultorio] [int] NULL,
	[pais_consultorio] [int] NULL,
	[telefono_consultorio] [varchar](50) NULL,
	[Fax_Consultorio] [varchar](50) NULL,
	[Observa1] [nvarchar](4000) NULL,
	[Observa2] [char](60) NULL,
	[Tarjeta] [int] NULL,
	[numero] [char](16) NULL,
	[Adherido] [char](1) NULL,
	[Vencimiento] [datetime] NULL,
	[FechaBaja] [datetime] NULL,
	[cuil] [char](13) NULL,
	[DebitarDesde] [datetime] NULL,
	[FechaIngreso] [datetime] NULL,
	[Residente] [char](1) NULL,
	[pr] [char](10) NULL,
	[prc] [char](10) NULL,
	[cpais] [char](10) NULL,
	[cpaisc] [char](10) NULL,
	[tipoMatricula] [int] NULL,
	[nroMatricula] [char](12) NULL,
	[fresidencia] [datetime] NULL,
	[fechanac] [datetime] NULL,
	[nacdos] [char](10) NULL,
	[tdDos] [char](10) NULL,
	[ndDos] [varchar](50) NULL,
	[amaDos] [varchar](50) NULL,
	[Cobrador] [int] NULL,
	[Matricula] [varchar](50) NULL,
	[pairDos] [char](10) NULL,
	[PaicDos] [char](10) NULL,
	[tIpoMatricula2] [int] NULL,
	[NroMatricula2] [char](12) NULL,
	[domicEnvio] [tinyint] NULL,
	[FechaGrupo] [datetime] NULL,
	[fResidente] [datetime] NULL,
	[identificador] [datetime] NULL,
	[ultimageneracion] [datetime] NULL,
	[seguro] [int] NULL,
	[cuotas] [int] NULL,
	[aceptoseguro] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  View [dbo].[VistaSociosAPP]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create view [dbo].[VistaSociosAPP]
as
Select 
numedocto documento,
ltrim(rtrim(Nombre)) nombre,
ltrim(rtrim(apellido)) apellido,
ltrim(rtrim(email)) email,
format(cast(Nacido as date),'yyyyMMdd') nacido,
ltrim(rtrim(nroMatricula)) matricula,
ltrim(rtrim(NroMatricula2)) matriculaprovincia,
--tipodocto,
ltrim(rtrim(case when DomicilioPrincipal='P' 
then Domicilio else Domicilio_consultorio end)) domicilio,
ltrim(rtrim(case when DomicilioPrincipal='P' 
then Localidad else Localidad_consultorio end)) localidad,
ltrim(rtrim(p.provincia)) provincia,--p.Descripcion,
ltrim(rtrim(case when DomicilioPrincipal='P' 
then cpostal else cpostal_consultorio end)) codigopostal,
0 Pais,
right(cast(case when DomicilioPrincipal='P' 
then telefono else telefono_consultorio end as varchar(30)),4) telefonofijo,
'' celular, 
case when Residente=1 then 1 else 0 end residente,
cast(null as datetime) 'inicioResidencia',
aceptoseguro,
grupo,socio, dbo.saldo (socio,getdate()) saldo

From socios s 
left join provincias p 
on case when DomicilioPrincipal='P' 
then s.provincia else provincia_consultorio end=p.provincia

where grupo not in ('F','R')
and not (isnull(email,'')='' or numedocto=0)

-- order by apellido 

--FOR XML PATH('Socio')
/*
Update socios 
set aceptoSeguro=1
where socio in (
Select Socio from conceptos_socios 
where concepto='SMP'
and fechabaja is not null
)
*/
GO
/****** Object:  Table [dbo].[Detalle_Operaciones]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Detalle_Operaciones](
	[idOperacion] [int] NOT NULL,
	[idTipoTransaccion] [int] NOT NULL,
	[idTransaccion] [int] NOT NULL,
	[ItemDiario] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[tipventModHeader]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[tipventModHeader](
	[codigo] [int] IDENTITY(0,1) NOT NULL,
	[comprobante] [char](5) NOT NULL,
	[descripcion] [varchar](25) NOT NULL,
	[signo] [int] NULL,
	[Multiplicador] [int] NULL,
	[Sicore] [varchar](2) NULL,
	[TipoStock] [int] NULL,
	[Modulo] [int] NULL,
	[IvaVentas] [char](1) NULL,
	[c_mov] [int] NULL,
	[comp] [varchar](10) NULL,
	[concCompra] [varchar](3) NULL,
	[IE] [int] NULL,
	[WSA] [int] NULL,
	[WSB] [int] NULL,
	[WSE] [int] NULL,
	[wsc] [int] NULL,
 CONSTRAINT [PK_tipventModHeader] PRIMARY KEY CLUSTERED 
(
	[codigo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY],
 CONSTRAINT [IX_tipventModHeader] UNIQUE NONCLUSTERED 
(
	[comprobante] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Vencliitems]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Vencliitems](
	[idTransaccion] [int] NULL,
	[comprobante] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[item] [int] NOT NULL,
	[concepto] [char](3) NOT NULL,
	[cuenta] [int] NOT NULL,
	[importe] [numeric](18, 2) NOT NULL,
	[BaseContable] [numeric](18, 2) NOT NULL,
	[Area] [int] NULL,
	[Detalle] [varchar](60) NULL,
	[Alicuota] [numeric](18, 2) NOT NULL,
	[Grilla] [varchar](30) NULL,
	[idCampo] [int] IDENTITY(1,1) NOT NULL,
	[Base] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[DatosVenta]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DatosVenta](
	[idOperacion] [int] NULL,
	[Bonificacion] [numeric](18, 2) NULL,
	[contacto1] [int] NULL,
	[contacto2] [int] NULL,
	[contacto3] [int] NULL,
	[fPago] [int] NULL,
	[Numero] [int] NULL,
	[TC] [numeric](18, 2) NULL,
	[idVendedor] [int] NULL,
	[idCvta] [int] NULL,
	[idTransporte] [int] NULL,
	[Remito] [int] NULL,
	[Factura] [int] NULL,
	[Bultos] [int] NULL,
	[vDeclarado] [numeric](18, 2) NULL,
	[oCompra] [varchar](50) NULL,
	[idLeyenda] [int] NULL,
	[NetoGravado] [numeric](18, 2) NULL,
	[vigencia] [datetime] NULL,
	[vs] [tinyint] NULL,
	[NC] [varchar](50) NULL,
	[comision] [int] NULL,
	[idMatricula] [int] NULL,
	[idObra] [int] NULL,
	[Dias] [int] NULL,
	[coeficiente] [numeric](18, 2) NULL,
	[taxi] [int] NULL,
	[Mat] [int] NULL,
	[MO] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Categorias_Iva]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Categorias_Iva](
	[IdCiva] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [char](25) NULL,
	[Ganancias] [int] NULL,
	[TipoFacturaCompras] [char](1) NULL,
	[TipoFacturaVentas] [char](1) NULL,
	[Resumido] [char](4) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Clientes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Clientes](
	[Codigo] [int] IDENTITY(1,1) NOT NULL,
	[RazonSocial] [nvarchar](60) NULL,
	[Domicilio] [nvarchar](40) NULL,
	[Localidad] [nvarchar](40) NULL,
	[CodigoPostal] [varchar](8) NULL,
	[idProvincia] [int] NULL,
	[Tipo1] [tinyint] NULL,
	[Telefono1] [nvarchar](40) NULL,
	[Tipo2] [tinyint] NULL,
	[Telefono2] [nvarchar](40) NULL,
	[Tipo3] [tinyint] NULL,
	[Telefono3] [nvarchar](40) NULL,
	[tipo4] [tinyint] NULL,
	[telefono4] [nvarchar](40) NULL,
	[Tipo5] [tinyint] NULL,
	[telefono5] [nvarchar](40) NULL,
	[tipo6] [tinyint] NULL,
	[telefono6] [nvarchar](40) NULL,
	[mail] [nvarchar](50) NULL,
	[Notas] [ntext] NULL,
	[Fecha] [smalldatetime] NULL,
	[Vendedor] [smallint] NULL,
	[Hora] [datetime] NULL,
	[idClienteant] [int] NULL,
	[Nombre] [nvarchar](30) NULL,
	[Apellido] [nvarchar](30) NULL,
	[TipoCuenta] [tinyint] NULL,
	[Categoria] [tinyint] NULL,
	[Cuit] [nvarchar](13) NULL,
	[civa] [tinyint] NULL,
	[Cuenta] [int] NULL,
	[CuentaSubdiario] [int] NULL,
	[FechaNac] [datetime] NULL,
	[Activo] [int] NULL,
	[codigoexterno] [varchar](20) NULL,
	[vencimiento] [datetime] NULL,
	[horaAtencion] [varchar](50) NULL,
	[Alerta] [varchar](255) NULL,
	[cventa] [int] NULL,
	[tablaganancia] [int] NULL,
	[idZona] [int] NULL,
	[Fechabaja] [datetime] NULL,
	[tipodocto] [int] NULL,
	[numerodocto] [int] NULL,
	[Descuento] [numeric](18, 2) NULL,
	[TipoCuentaComis] [int] NULL,
	[ibrutos] [varchar](12) NULL,
	[percepcionIB] [numeric](8, 2) NULL,
	[retencionIB] [numeric](8, 2) NULL,
	[idPais] [int] NULL,
	[Jurisdiccion] [int] NULL,
	[Adicional] [varchar](60) NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  View [dbo].[vIvaVentas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*order by v.fecha,nrocomprobante*/
CREATE VIEW [dbo].[vIvaVentas]
AS
SELECT     v.fecha, t.comp, SUBSTRING(v.nrocomprobante, 1, 4) AS pv, SUBSTRING(v.nrocomprobante, 5, 8) AS nc, v.tipofactura, c.RazonSocial, 
                      ci.Descripcion AS dciva, v.totalimporte * t.Multiplicador AS Total, ISNULL(ISNULL(dv.NetoGravado,
                          (SELECT     SUM(BaseContable) AS Expr1
                            FROM          dbo.Vencliitems
                            WHERE      (idTransaccion = v.idtransaccion) AND (LTRIM(RTRIM(concepto)) = 'NG'))) * t.Multiplicador, 0) AS Neto, ISNULL
                          ((SELECT     SUM(BaseContable) AS Expr1
                              FROM         dbo.Vencliitems AS Vencliitems_2
                              WHERE     (idTransaccion = v.idtransaccion) AND (concepto = 'IVA' OR
                                                    concepto = 'IC0')) * t.Multiplicador, 0) AS iva, ISNULL
                          ((SELECT     AVG(Alicuota) AS Expr1
                              FROM         dbo.Vencliitems AS Vencliitems_1
                              WHERE     (idTransaccion = v.idtransaccion) AND (concepto = 'IVA' OR
                                                    concepto = 'IC0')), 0) AS alicuota, c.idProvincia, p.Descripcion AS dProvincia, do.idOperacion, v.idtransaccion, c.Cuit
FROM         dbo.VenCliHeader AS v INNER JOIN
                      dbo.tipventModHeader AS t ON v.tipocomprobante = t.codigo INNER JOIN
                      dbo.Clientes AS c ON v.cliente = c.Codigo INNER JOIN
                      dbo.Categorias_Iva AS ci ON c.civa = ci.IdCiva LEFT OUTER JOIN
                      dbo.Detalle_Operaciones AS do ON do.idTransaccion = v.idtransaccion LEFT OUTER JOIN
                      dbo.DatosVenta AS dv ON do.idOperacion = dv.idOperacion LEFT OUTER JOIN
                      dbo.Provincias AS p ON c.idProvincia = p.provincia
WHERE     (t.IvaVentas = 'S') AND (ISNULL(do.idTipoTransaccion, 0) = 0)
GO
/****** Object:  Table [dbo].[Header_Operaciones]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Header_Operaciones](
	[idOperacion] [int] IDENTITY(1,1) NOT NULL,
	[Fecha] [datetime] NOT NULL,
	[TipodeOperacion] [int] NOT NULL,
	[Observacion] [varchar](255) NOT NULL,
	[AsientoDiario] [int] NULL,
	[AnioMes] [int] NULL,
	[tipoasiento] [int] NULL,
	[idUsuario] [char](10) NULL,
	[idOperadorTesoreria] [int] NULL,
	[Procesado] [datetime] NULL,
	[cuenta] [int] NULL,
	[ComprobanteNumero] [numeric](18, 0) NULL,
	[Serie] [char](6) NULL,
	[ObservacionComprobante] [varchar](256) NULL,
	[Cerrada] [datetime] NULL,
	[AsientoCierre] [numeric](18, 0) NULL,
 CONSTRAINT [PK_Header_Operaciones] PRIMARY KEY CLUSTERED 
(
	[idOperacion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AsientosDiariosItems]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AsientosDiariosItems](
	[asiento] [int] NOT NULL,
	[item] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[tipoasiento] [int] NOT NULL,
	[cuenta] [int] NOT NULL,
	[debe] [numeric](18, 2) NULL,
	[haber] [numeric](18, 2) NULL,
	[observacion] [varchar](50) NULL,
	[centrocosto] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  View [dbo].[vBaseIva]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

/*Select * from vBaseIva*/
CREATE VIEW [dbo].[vBaseIva]
AS
SELECT     v.fecha, t.comp, v.nrocomprobante, v.tipofactura, c.RazonSocial, ci.Descripcion AS dciva, v.totalimporte * t.Multiplicador AS TotalComprobante, 
                      c.Jurisdiccion, ISNULL(p.Descripcion, 'no Informado') AS dProvincia, v.aniomes, v.TC, SUM(CASE WHEN ai.cuenta BETWEEN 120999 AND 
                      122999 THEN isnull(debe - haber, 0) ELSE 0 END) AS Total, SUM(CASE WHEN ai.cuenta NOT BETWEEN 120999 AND 122999 AND 
                      ai.cuenta NOT BETWEEN 243000 AND 243999 THEN isnull(debe - haber, 0) * - 1 ELSE 0 END) AS Neto, 
                      SUM(CASE WHEN ai.cuenta = 243500 THEN isnull(debe - haber, 0) * - 1 ELSE 0 END) AS Iva, 
                      SUM(CASE WHEN ai.cuenta = 243402 THEN isnull(debe - haber, 0) * - 1 ELSE 0 END) AS PIB, 
                      CASE WHEN v.tipofactura = 'E' THEN '            ' ELSE c.Cuit END AS cuit, c.Codigo, v.idtransaccion,
                          (SELECT     ISNULL(Alicuota, 0) AS Expr1
                            FROM          dbo.Vencliitems
                            WHERE      (idTransaccion = v.idtransaccion) AND (concepto = 'IVA' OR
                                                   concepto = 'IC0')) AS Alicuota
FROM         dbo.VenCliHeader AS v INNER JOIN
                      dbo.tipventModHeader AS t ON v.tipocomprobante = t.codigo INNER JOIN
                      dbo.Clientes AS c ON v.cliente = c.Codigo INNER JOIN
                      dbo.Categorias_Iva AS ci ON c.civa = ci.IdCiva LEFT OUTER JOIN
                      dbo.Detalle_Operaciones AS do ON do.idTransaccion = v.idtransaccion LEFT OUTER JOIN
                      dbo.DatosVenta AS dv ON do.idOperacion = dv.idOperacion LEFT OUTER JOIN
                      dbo.Provincias AS p ON c.idProvincia = p.provincia INNER JOIN
                      dbo.Header_Operaciones AS ho ON do.idOperacion = ho.idOperacion INNER JOIN
                      dbo.AsientosDiariosItems AS ai ON ho.AsientoDiario = ai.asiento AND ho.tipoasiento = ai.tipoasiento AND ho.AnioMes = ai.aniomes
WHERE     (t.IvaVentas = 'S') AND (ISNULL(do.idTipoTransaccion, 0) = 0) AND (v.fecha > '20090630')
GROUP BY v.fecha, t.comp, v.nrocomprobante, v.tipofactura, c.RazonSocial, ci.Descripcion, v.totalimporte * t.Multiplicador, c.Jurisdiccion, ISNULL(p.Descripcion, 
                      'no Informado'), v.aniomes, v.TC, c.Cuit, c.Codigo, v.idtransaccion
GO
/****** Object:  Table [dbo].[CompProvHeader]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CompProvHeader](
	[idtransaccion] [int] IDENTITY(1,1) NOT NULL,
	[comprobante] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[fecha] [datetime] NOT NULL,
	[proveedor] [int] NOT NULL,
	[tipocomprobante] [int] NOT NULL,
	[nrocomprobante] [char](12) NOT NULL,
	[tipofactura] [char](1) NULL,
	[totalimporte] [numeric](18, 2) NOT NULL,
	[cancelado] [numeric](18, 2) NULL,
	[fecha1venc] [datetime] NULL,
	[fecha2venc] [datetime] NULL,
	[estado] [char](1) NOT NULL,
	[fechareal] [datetime] NOT NULL,
	[centrocosto] [int] NULL,
	[DescripcionImporte] [varchar](255) NULL,
	[Moneda] [int] NULL,
	[ImporteOrigen] [numeric](18, 2) NULL,
	[TC] [numeric](18, 3) NULL,
	[doc_c] [numeric](18, 0) NULL,
	[CanceladoOrigen] [numeric](18, 2) NULL,
 CONSTRAINT [PK_CompProvHeader] PRIMARY KEY CLUSTERED 
(
	[idtransaccion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TipCompModHeader]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TipCompModHeader](
	[codigo] [int] IDENTITY(0,1) NOT NULL,
	[comprobante] [char](5) NOT NULL,
	[descripcion] [varchar](25) NOT NULL,
	[signo] [int] NULL,
	[Multiplicador] [int] NULL,
	[Sicore] [char](2) NULL,
	[TIpoStock] [int] NULL,
	[c_mov] [int] NULL,
	[comp] [varchar](50) NULL,
	[ivaCompras] [varchar](1) NULL,
	[IE] [int] NULL,
	[BR] [varchar](2) NULL,
	[Modulo] [int] NULL,
 CONSTRAINT [PK_TipCompModHeader] PRIMARY KEY CLUSTERED 
(
	[codigo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CompProvItems]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CompProvItems](
	[idTransaccion] [int] NULL,
	[comprobante] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[item] [int] NOT NULL,
	[concepto] [char](3) NOT NULL,
	[cuenta] [int] NOT NULL,
	[importe] [numeric](18, 4) NOT NULL,
	[BaseContable] [numeric](18, 2) NOT NULL,
	[Area] [int] NULL,
	[Detalle] [varchar](60) NULL,
	[Alicuota] [numeric](18, 2) NOT NULL,
	[Grilla] [varchar](30) NULL,
	[idCampo] [int] IDENTITY(1,1) NOT NULL,
	[Base] [numeric](18, 2) NULL,
	[FechaCierre] [datetime] NULL,
	[Factura] [varchar](20) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CompFondosHeader]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CompFondosHeader](
	[idtransaccion] [int] IDENTITY(1,1) NOT NULL,
	[comprobante] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[fecha] [datetime] NOT NULL,
	[proveedor] [int] NOT NULL,
	[tipocomprobante] [int] NOT NULL,
	[nrocomprobante] [char](12) NOT NULL,
	[tipofactura] [char](1) NULL,
	[totalimporte] [numeric](18, 2) NOT NULL,
	[cancelado] [numeric](18, 2) NULL,
	[fecha1venc] [datetime] NULL,
	[fecha2venc] [datetime] NULL,
	[estado] [char](1) NOT NULL,
	[fechareal] [datetime] NOT NULL,
	[centrocosto] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CompFondosItems]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CompFondosItems](
	[comprobante] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[item] [int] NOT NULL,
	[concepto] [char](3) NOT NULL,
	[importe] [numeric](18, 2) NOT NULL,
	[cuentaneto] [int] NOT NULL,
	[neto] [numeric](18, 2) NOT NULL,
	[cuentamonto] [int] NOT NULL,
	[monto] [numeric](18, 2) NOT NULL,
	[base] [numeric](18, 2) NULL,
	[idtransaccion] [int] NULL,
	[alicuota] [numeric](18, 2) NULL,
	[area] [int] NULL,
	[FechaCierre] [datetime] NULL,
	[Factura] [varchar](20) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[cphVarios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[cphVarios](
	[idtransaccion] [int] NOT NULL,
	[Codigo] [int] NULL,
 CONSTRAINT [PK_cphVarios] PRIMARY KEY CLUSTERED 
(
	[idtransaccion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Proveedores]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Proveedores](
	[Codigo] [int] IDENTITY(1,1) NOT NULL,
	[RazonSocial] [nvarchar](60) NULL,
	[Domicilio] [nvarchar](40) NULL,
	[Localidad] [nvarchar](40) NULL,
	[CodigoPostal] [varchar](8) NULL,
	[idProvincia] [int] NULL,
	[Cuenta] [int] NULL,
	[Tipo1] [tinyint] NULL,
	[Telefono1] [nvarchar](40) NULL,
	[Tipo2] [tinyint] NULL,
	[Telefono2] [nvarchar](40) NULL,
	[Tipo3] [tinyint] NULL,
	[Telefono3] [nvarchar](40) NULL,
	[tipo4] [tinyint] NULL,
	[telefono4] [nvarchar](40) NULL,
	[Tipo5] [tinyint] NULL,
	[telefono5] [nvarchar](40) NULL,
	[tipo6] [tinyint] NULL,
	[telefono6] [nvarchar](40) NULL,
	[mail] [nvarchar](50) NULL,
	[Notas] [ntext] NULL,
	[Fecha] [smalldatetime] NULL,
	[Vendedor] [smallint] NULL,
	[Hora] [datetime] NULL,
	[idClienteant] [int] NULL,
	[Nombre] [nvarchar](30) NULL,
	[Apellido] [nvarchar](30) NULL,
	[TipoCuenta] [tinyint] NULL,
	[Categoria] [tinyint] NULL,
	[Cuit] [nvarchar](13) NULL,
	[civa] [tinyint] NULL,
	[CuentaSubdiario] [int] NULL,
	[FechaNac] [datetime] NULL,
	[Activo] [int] NULL,
	[codigoexterno] [varchar](20) NULL,
	[vencimiento] [datetime] NULL,
	[horaAtencion] [varchar](50) NULL,
	[Alerta] [varchar](255) NULL,
	[cventa] [int] NULL,
	[idZona] [int] NULL,
	[fechabaja] [datetime] NULL,
	[TablaGanancia] [int] NULL,
	[tipodocto] [int] NULL,
	[numerodocto] [int] NULL,
	[descuento] [numeric](18, 2) NULL,
	[ibrutos] [varchar](12) NULL,
	[percepcionIB] [numeric](8, 2) NULL,
	[retencionIB] [numeric](8, 2) NULL,
	[idPais] [int] NULL,
	[Jurisdiccion] [int] NULL,
	[Adicional] [varchar](60) NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ProvFondo]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ProvFondo](
	[proveedor] [int] IDENTITY(1,1) NOT NULL,
	[razonsocial] [varchar](30) NULL,
	[civa] [int] NULL,
	[cuit] [char](14) NULL,
	[cuenta] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  View [dbo].[vIvaCompras]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE view [dbo].[vIvaCompras]
as
Select v.fecha,t.comprobante Comp,substring(nrocomprobante,1,4) + '-' + Substring(nrocomprobante,5,8) nrocomprobante,tipofactura,isnull(cv.razonsocial,c.razonSocial) razonsocial,isnull(cv.cuit,c.cuit) cuit,ci.resumido dciva,
totalimporte*multiplicador total,
case when v.tipofactura<>'C' and v.tipofactura<>'M' then isnull(
(select sum(baseContable) 
from CompProvitems
where idtransaccion=v.idtransaccion and concepto='NG ')*multiplicador,0) else 0 end Neto,
isnull(
(select sum(baseContable) 
from CompProvitems
where idtransaccion=v.idtransaccion and concepto='EXE')*multiplicador,0) Exento,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='IVG')*multiplicador,0) Iva,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='I27')*multiplicador,0) Iva27,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='I10')*multiplicador,0) Iva10,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='I05')*multiplicador,0) Iva5,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='IBC')*multiplicador,0) PibC,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PIV')*multiplicador,0) PIV,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='IBB')*multiplicador,0) PIB,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PGI')*multiplicador,0) PGI,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PAB')*multiplicador,0) PAB,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PAC')*multiplicador,0) PAC,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PBB')*multiplicador,0) PBB,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PBC')*multiplicador,0) PBC,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='II')*multiplicador,0) II,
isnull((select sum(base) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='II')*multiplicador,0) BII,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='GSI')*multiplicador,0) GSI,
case when v.tipofactura='C' or v.tipofactura='M' then isnull(
(select sum(baseContable)
from CompProvitems
where idtransaccion=v.idtransaccion and concepto='NG ')*multiplicador,0) else 0 end Monotributo,
idoperacion

from CompProVHeader v
left join cphVarios vv
on v.idtransaccion=vv.idtransaccion
inner join TipCompModHeader t
on v.tipocomprobante=t.codigo
Left join Proveedores c
on isnull(vv.Codigo,v.Proveedor)=c.codigo
Left join Provfondo cv
on isnull(vv.Codigo,v.Proveedor)=cv.proveedor
left join categorias_iva ci
on c.civa=ci.idciva
left join detalle_Operaciones do
on v.idtransaccion=do.idtransaccion and do.idtipotransaccion=1
where v.fecha between '20090701' and '20090731'
and ivaCompras='S'
--and isnull(idtipotransaccion,1)=1
and v.proveedor<212000

union

Select v.fecha,t.comprobante Comp,substring(nrocomprobante,1,4) + '-' + Substring(nrocomprobante,5,8) nrocomprobante,tipofactura,isnull(cv.razonsocial,c.razonSocial) razonsocial,isnull(cv.cuit,c.cuit) cuit,ci.resumido dciva,
totalimporte*multiplicador total,
case when v.tipofactura<>'C' and v.tipofactura<>'M' then isnull(
(select sum(Neto) 
from CompFondosItems
where idtransaccion=v.idtransaccion and concepto='NG ')*multiplicador,0) else 0 end Neto,
isnull(
(select sum(Neto) 
from CompFondosItems
where idtransaccion=v.idtransaccion and concepto='EXE')*multiplicador,0) Exento,
isnull((select sum(Neto) from CompFondosItems 
where idtransaccion=v.idtransaccion and concepto='IVG')*multiplicador,0) Iva,
isnull((select sum(Neto) from CompFondosItems 
where idtransaccion=v.idtransaccion and concepto='I27')*multiplicador,0) Iva27,
isnull((select sum(Neto) from CompFondosItems 
where idtransaccion=v.idtransaccion and concepto='I10')*multiplicador,0) Iva10,
isnull((select sum(Neto) from CompFondosItems 
where idtransaccion=v.idtransaccion and concepto='I05')*multiplicador,0) Iva5,
isnull((select sum(Neto) from CompFondosItems 
where idtransaccion=v.idtransaccion and concepto='IBC')*multiplicador,0) PibC,
isnull((select sum(Neto) from CompFondosItems 
where idtransaccion=v.idtransaccion and concepto='PIV')*multiplicador,0) PIV,
isnull((select sum(Neto) from CompFondosItems 
where idtransaccion=v.idtransaccion and concepto='IBB')*multiplicador,0) PIB,
isnull((select sum(Neto) from CompFondosItems 
where idtransaccion=v.idtransaccion and concepto='PGI')*multiplicador,0) PGI,
isnull((select sum(Neto) from CompFondosItems 
where idtransaccion=v.idtransaccion and concepto='PAB')*multiplicador,0) PAB,
isnull((select sum(Neto) from CompFondosItems 
where idtransaccion=v.idtransaccion and concepto='PAC')*multiplicador,0) PAC,
isnull((select sum(Neto) from CompFondosItems 
where idtransaccion=v.idtransaccion and concepto='PBB')*multiplicador,0) PBB,
isnull((select sum(Neto) from CompFondosItems 
where idtransaccion=v.idtransaccion and concepto='PBC')*multiplicador,0) PBC,
isnull((select sum(Neto) from CompFondosItems 
where idtransaccion=v.idtransaccion and concepto='II')*multiplicador,0) II,
isnull((select sum(base) from CompFondosItems 
where idtransaccion=v.idtransaccion and concepto='II')*multiplicador,0) BII,
isnull((select sum(Neto) from CompFondosItems 
where idtransaccion=v.idtransaccion and concepto='GSI')*multiplicador,0) GSI,
case when v.tipofactura='C' or v.tipofactura='M' then isnull(
(select sum(Neto) 
from CompFondosItems
where idtransaccion=v.idtransaccion and concepto='NG ')*multiplicador,0) else 0 end Monotributo, idOperacion

from CompFondosHeader v
left join cphVarios vv
on v.idtransaccion=vv.idtransaccion
inner join TipCompModHeader t
on v.tipocomprobante=t.codigo
Left join Proveedores c
on isnull(vv.Codigo,v.Proveedor)=c.codigo
Left join Provfondo cv
on isnull(vv.Codigo,v.Proveedor)=cv.proveedor
left join categorias_iva ci
on c.civa=ci.idciva
inner join detalle_Operaciones do
on v.idtransaccion=do.idtransaccion and do.idtipotransaccion=3

where v.fecha between '20090701' and '20090731'
and ivaCompras='S'
and v.proveedor<212000

-- order by v.fecha,nrocomprobante











GO
/****** Object:  Table [dbo].[EstadisticaArticulos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EstadisticaArticulos](
	[idCampo] [int] IDENTITY(1,1) NOT NULL,
	[idOperacion] [int] NULL,
	[TipoMovimiento] [int] NULL,
	[Deposito] [int] NULL,
	[idarticulo] [int] NULL,
	[serial] [varchar](30) NULL,
	[cantidad] [numeric](18, 2) NULL,
	[Stock] [numeric](18, 2) NULL,
	[Vencimiento] [datetime] NULL,
	[idCampoOrigen] [int] NULL,
	[oCompra] [varchar](20) NULL,
	[ArticuloProveedor] [varchar](50) NULL,
	[Desvia] [varchar](50) NULL,
	[idMatricula] [int] NULL,
	[idObra] [int] NULL,
	[FecFactura] [datetime] NULL,
	[FecProceso] [datetime] NULL,
	[Docum] [int] NULL,
	[idProveedor] [int] NULL,
	[fcProv] [int] NULL,
	[nroFactura] [int] NULL,
	[paca] [numeric](18, 2) NULL,
	[FechaDOS] [datetime] NULL,
	[idCampoAnexo] [int] NULL,
	[Fabricado] [datetime] NULL,
 CONSTRAINT [PK_EstadisticaArticulos] PRIMARY KEY CLUSTERED 
(
	[idCampo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Articulos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Articulos](
	[idArticulo] [int] IDENTITY(1,1) NOT NULL,
	[Articulo] [varchar](15) NOT NULL,
	[Descripcion] [varchar](40) NULL,
	[Detalle] [varchar](255) NULL,
	[Presentacion] [varchar](20) NULL,
	[Notas] [varchar](20) NULL,
	[Unidades] [numeric](18, 2) NULL,
	[xCaja] [numeric](18, 2) NULL,
	[xMetro] [numeric](18, 2) NULL,
	[Comercio] [tinyint] NULL,
	[idLinea] [int] NULL,
	[idSublinea] [int] NULL,
	[idMarca] [int] NULL,
	[Procesa] [int] NULL,
	[Serial] [int] NULL,
	[Minimo] [int] NULL,
	[Maximo] [int] NULL,
	[Meses] [int] NULL,
	[cuenta] [int] NULL,
	[Alicuota] [numeric](18, 2) NULL,
	[FechaIngreso] [datetime] NULL,
	[FechaInactivo] [datetime] NULL,
	[Modalidad] [int] NULL,
	[idArticuloBase] [int] NULL,
	[unidadesxbase] [numeric](18, 4) NULL,
	[idlineaComis] [int] NULL,
	[idsublineaComis] [int] NULL,
	[Precio] [numeric](18, 2) NULL,
	[Sector] [int] NULL,
	[Ubicacion] [int] NULL,
	[Observacion] [varchar](50) NULL,
 CONSTRAINT [PK_Articulos] PRIMARY KEY CLUSTERED 
(
	[idArticulo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Detalle_listas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Detalle_listas](
	[idLista] [int] NOT NULL,
	[idArticulo] [int] NOT NULL,
	[Moneda] [int] NULL,
	[Neto] [numeric](18, 2) NULL,
	[Final] [numeric](18, 2) NULL,
	[redondeo] [tinyint] NULL,
 CONSTRAINT [PK_Detalle_listas] PRIMARY KEY CLUSTERED 
(
	[idLista] ASC,
	[idArticulo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  View [dbo].[StockValorizado]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create View [dbo].[StockValorizado]
as
Select a.idarticulo,a.articulo,a.descripcion,
Deposito,sum(stock) stock ,sum(stock)*dl.neto valor
from estadisticaarticulos ea
inner join articulos a
on ea.idarticulo=a.idarticulo
inner join detalle_listas dl
on dl.idarticulo=ea.idarticulo and idlista=90
group by a.idarticulo,a.articulo,a.descripcion,Deposito,dl.neto
having sum(stock)>0




GO
/****** Object:  View [dbo].[dups]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
create view [dbo].[dups]
as
Select idtipotransaccion,idtransaccion,count(*) casos
from detalle_operaciones 
group by idtipotransaccion,idtransaccion
Having count(*)>1
--order by idtipotransaccion


GO
/****** Object:  Table [dbo].[Vendedores]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Vendedores](
	[idvendedor] [int] IDENTITY(0,1) NOT NULL,
	[nyap] [nvarchar](40) NULL,
	[Activo] [int] NULL,
	[vClip] [char](3) NULL,
	[comision] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Lineas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Lineas](
	[idLinea] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [varchar](20) NULL,
	[idLineaAnterior] [int] NULL,
	[iComis] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TiposCliente]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TiposCliente](
	[idTipo] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [char](30) NULL,
	[TipoClip] [char](3) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[subLineas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[subLineas](
	[idSubLinea] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [varchar](20) NULL,
	[idSubLineaAnt] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EstadisticaArticulosPrecios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EstadisticaArticulosPrecios](
	[idCampo] [int] NOT NULL,
	[Concepto] [varchar](10) NULL,
	[Unitario] [numeric](18, 2) NULL,
	[BaseContable] [numeric](18, 2) NULL,
	[Alicuota] [numeric](6, 2) NULL,
	[Cuenta] [int] NULL,
	[bonificacion] [numeric](18, 2) NULL,
	[Neto] [numeric](18, 2) NULL,
 CONSTRAINT [PK_PreciosEstadisticas] PRIMARY KEY CLUSTERED 
(
	[idCampo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AplicacionesCuentasaCobrar]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AplicacionesCuentasaCobrar](
	[idTransaccion] [int] NOT NULL,
	[item] [int] NOT NULL,
	[IdTransaccionCancelada] [int] NOT NULL,
	[Importe] [numeric](18, 2) NOT NULL,
	[ImporteOrigen] [numeric](18, 2) NULL,
	[idAplicacion] [int] IDENTITY(1,1) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  View [dbo].[vComisionesInternas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE      View [dbo].[vComisionesInternas]
as

Select ho.idOPeracion,
vch.fecha fechaRecibo, vch.nrocomprobante nroRecibo,vch.totalimporte TotalRecibo,
cl.codigo,cl.razonsocial,isnull(t.canti,ea.cantidad) Cantidad,isnull(t.serial,ea.serial) nSerie,
isnull(presimp,basecontable)*multiplicador Bruto,isnull(artic,an.articulo) Articulo ,
isnull(a.descripcion,an.descripcion) dArticulo,acc.importe,vchc.totalimporte,
l.idlinea Linea, l.Descripcion dLinea,sl.idsublinea sublinea, sl.Descripcion dSublinea,isnull(dv.idvendedor,cl.vendedor) Vendedor, isnull(v1.nyap,v.nyap) dVendedor,
tc.idtipo,tc.descripcion dTipoCliente,vchc.Fecha fechaFc, vchc.nrocomprobante NroFc, tvm.comprobante tcFC,
-- Nestor   
isnull( case 
-- Audifonos Distribuidores y Nestor
when cl.codigo=14116 and vch.fecha between '20080701' and '20080731' then 0
when (vchc.idtransaccion between 39519 and 39522)
then (isnull(presimp,basecontable)*multiplicador*0.00225) 
when (
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
(idTipo=9 or ((idTipo=17 or idTipo=1) and isnull(dv.idvendedor,cl.vendedor)=15))
then (isnull(presimp,basecontable)*multiplicador*0.01) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=17 and isnull(dv.idvendedor,cl.vendedor)<>15))
then (isnull(presimp,basecontable)*multiplicador*0.005) 
end,0)  NGO,

-- Patricia
isnull(
case 
-- Audifonos Distribuidores y Nestor
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
(idTipo=9 or (idTipo=17 and isnull(dv.idvendedor,cl.vendedor)=15))
then (isnull(presimp,basecontable)*multiplicador*0.003) 
-- Audifonos Distribuidores Buenos Aires no Nestor
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=17 and isnull(dv.idvendedor,cl.vendedor)<>15))
then (isnull(presimp,basecontable)*multiplicador*0.003) 

when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.003) 

when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.003) 

when ( 
(l.idLinea=18 and (sl.idSublinea=1801 or sl.idSublinea=1802
or sl.idSublinea=1804 or sl.idSublinea=1807 or sl.idSublinea=1808 or sl.idSublinea=1809)
or (l.idLinea=19))
and (idTipo<>9)
)
then (isnull(presimp,basecontable)*multiplicador*0.003) 

When l.idlinea=27 OR l.idlinea=100 OR l.idlinea=29 OR l.idlinea=30 OR l.idlinea=32 OR l.idlinea=33 
OR l.idlinea=35 OR l.idlinea=50 OR (l.idlinea=18 ANd (sl.idsublinea=3 OR sl.idsublinea=5 OR sl.idsublinea=6)) or isnull(a.articulo,an.articulo)='00001/4' 

then (isnull(presimp,basecontable)*multiplicador*0.003) 

when ( l.idLinea=1 or sl.idSublinea=108)
then (isnull(presimp,basecontable)*multiplicador*0.003) 

end,0) PA,



isnull(Case
-- Audifonos Distribuidores Buenos Aires no Nestor
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=17 and isnull(dv.idvendedor,cl.vendedor)<>15))
then (isnull(presimp,basecontable)*multiplicador*0.01) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.005) 

when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.015) 

when ( 
(l.idLinea=18 and (sl.idSublinea=1801 or sl.idSublinea=1802
or sl.idSublinea=1804 or sl.idSublinea=1807 or sl.idSublinea=1808 or sl.idSublinea=1809)
or (l.idLinea=19))
and (idTipo<>9)
and (isnull(an.articulo,a.articulo) like 'ST-%' or sl.idsublinea=1901)
)
then (isnull(presimp,basecontable)*multiplicador*0.02) 

when ( 
(l.idLinea=18 and (sl.idSublinea=1801 or sl.idSublinea=1802
or sl.idSublinea=1804 or sl.idSublinea=1807 or sl.idSublinea=1808 or sl.idSublinea=1809)
or (l.idLinea=19))
and (idTipo<>9)
and (isnull(an.articulo,a.articulo) not like 'ST-%' and sl.idsublinea<>1901)
)
then (isnull(presimp,basecontable)*multiplicador*0.0425) 

When l.idlinea=27 OR l.idlinea=100 OR l.idlinea=29 OR l.idlinea=30 OR l.idlinea=32 OR l.idlinea=33 
OR l.idlinea=35 OR l.idlinea=50 OR (l.idlinea=18 ANd (sl.idsublinea=3 OR sl.idsublinea=5 OR sl.idsublinea=6)) or isnull(a.articulo,an.articulo)='00001/4' 

then (isnull(presimp,basecontable)*multiplicador*0.03) 

/* when ( l.idLinea=1 or sl.idSublinea=108)
then (isnull(presimp,basecontable)*multiplicador*0.01) 
*/
end,0) GVE,

isnull(Case 
when cl.codigo=14116 and vch.fecha between '20080701' and '20080731' then 0
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.00225) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.0145) 
end,0) HAY,

isnull(Case 
when cl.codigo=14116 and vch.fecha between '20080701' and '20080731' then 0
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.00225) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.0078) 
end,0) VIG,


isnull(Case 
when cl.codigo=14116 and vch.fecha between '20080701' and '20080731' then 0
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.00225) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.0078) 
end,0) EFR,

isnull(Case 
when cl.codigo=14116 and vch.fecha between '20080701' and '20080731' then 0
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.00225) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.0078) 
end,0) CLB,


isnull(Case 
when cl.codigo=14116 and vch.fecha between '20080701' and '20080731' then 0
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.001) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.0040) 
end,0) GR,


isnull(Case 
when cl.codigo=14116 and vch.fecha between '20080701' and '20080731' then 0when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.001) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.004) 
end,0) JJ

From Header_operaciones ho
inner join detalle_operaciones do 
on ho.idOPeracion=do.idOperacion 
inner join vencliheader vch 
on do.idtransaccion=vch.idtransaccion 
inner join aplicacionescuentasacobrar acc
on acc.idtransaccion=vch.idtransaccion
inner join vencliheader vchc 
on acc.idtransaccioncancelada=vchc.idtransaccion
inner join detalle_operaciones doc
on vchc.idtransaccion=doc.idtransaccion and doc.idtipotransaccion=0
left join estadisticaArticulos ea 
on doc.idoperacion=ea.idoperacion
left join estadisticaArticulosPrecios eap 
on ea.idcampo=eap.idcampo
left join datosventa dv
on doc.idoperacion=dv.idoperacion
left join tra0 t
on vchc.cliente=t.codig 
and cast(substring(vchc.nrocomprobante,5,8) as int)=doc_d 
and vchc.fecha=t.fecha
inner join clientes cl 
on vch.cliente=cl.codigo
left join articulos a 
on t.artic=a.articulo
left join articulos an
on ea.idarticulo=an.idarticulo
left join lineas l 
on isnull(a.idlinea,an.idlinea)=l.idlinea
left join sublineas sl 
on isnull(a.idsublinea,an.idSublinea)=sl.idsublinea
left join vendedores v
on cl.vendedor=v.idvendedor
left join vendedores v1
on dv.idvendedor=v1.idvendedor
inner join tiposCliente tc
on cl.tipocuenta=tc.idtipo
inner join tipVentmodheader tvm
on tvm.codigo=vchc.tipocomprobante
where tipodeOperacion between 10 and 19
and do.idtipotransaccion=0
and isnull(dv.comision,0)<>-1
and isnull(isnull(dv.idvendedor,cl.vendedor),0)<>24
and isnull(isnull(dv.idvendedor,cl.vendedor),0)<>20
and isnull(artic,an.articulo)<>'00001/8'
and vchc.cancelado=vchc.totalimporte
and isnull(presimp,basecontable)*multiplicador is not null
and isnull(a.articulo,an.articulo)<>'00001/8'
and 

isnull(
case
when (
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
(idTipo=9 or (idTipo=17 and isnull(dv.idvendedor,cl.vendedor)=15))
then (isnull(presimp,basecontable)*multiplicador*0.01) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=17 and isnull(dv.idvendedor,cl.vendedor)<>15))
then (isnull(presimp,basecontable)*multiplicador*0.005) 
end,0) +

-- Patricia
isnull(
case 
-- Audifonos Distribuidores y Nestor
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
(idTipo=9 or (idTipo=17 and isnull(dv.idvendedor,cl.vendedor)=15))
then (isnull(presimp,basecontable)*multiplicador*0.003) 
-- Audifonos Distribuidores Buenos Aires no Nestor
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=17 and isnull(dv.idvendedor,cl.vendedor)<>15))
then (isnull(presimp,basecontable)*multiplicador*0.003) 

when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.003) 

when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.003) 

when ( 
(l.idLinea=18 and (sl.idSublinea=1801 or sl.idSublinea=1802
or sl.idSublinea=1804 or sl.idSublinea=1807 or sl.idSublinea=1808 or sl.idSublinea=1809)
or (l.idLinea=19))
and (idTipo<>9)
)
then (isnull(presimp,basecontable)*multiplicador*0.003) 

When l.idlinea=27 OR l.idlinea=100 OR l.idlinea=29 OR l.idlinea=30 OR l.idlinea=32 OR l.idlinea=33 
OR l.idlinea=35 OR l.idlinea=50 OR (l.idlinea=18 ANd (sl.idsublinea=3 OR sl.idsublinea=5 OR sl.idsublinea=6)) or isnull(a.articulo,an.articulo)='00001/4' 

then (isnull(presimp,basecontable)*multiplicador*0.003) 

when ( l.idLinea=1 or sl.idSublinea=108)
then (isnull(presimp,basecontable)*multiplicador*0.003) 

end,0) +
isnull(Case
-- Audifonos Distribuidores Buenos Aires no Nestor
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=17 and isnull(dv.idvendedor,cl.vendedor)<>15))
then (isnull(presimp,basecontable)*multiplicador*0.01) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.005) 

when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.015) 

when ( 
(l.idLinea=18 and (sl.idSublinea=1801 or sl.idSublinea=1802
or sl.idSublinea=1804 or sl.idSublinea=1807 or sl.idSublinea=1808 or sl.idSublinea=1809)
or (l.idLinea=19))
and (idTipo<>9)
and (isnull(an.articulo,a.articulo) like 'ST-%' or sl.idsublinea=1901)
)
then (isnull(presimp,basecontable)*multiplicador*0.02) 

when ( 
(l.idLinea=18 and (sl.idSublinea=1801 or sl.idSublinea=1802
or sl.idSublinea=1804 or sl.idSublinea=1807 or sl.idSublinea=1808 or sl.idSublinea=1809)
or (l.idLinea=19))
and (idTipo<>9)
and (isnull(an.articulo,a.articulo) not like 'ST-%' and sl.idsublinea<>1901)
)
then (isnull(presimp,basecontable)*multiplicador*0.0425) 

When l.idlinea=27 OR l.idlinea=100 OR l.idlinea=29 OR l.idlinea=30 OR l.idlinea=32 OR l.idlinea=33 
OR l.idlinea=35 OR l.idlinea=50 OR (l.idlinea=18 ANd (sl.idsublinea=3 OR sl.idsublinea=5 OR sl.idsublinea=6)) or isnull(a.articulo,an.articulo)='00001/4' 

then (isnull(presimp,basecontable)*multiplicador*0.03) 

when ( l.idLinea=1 or sl.idSublinea=108)
then (isnull(presimp,basecontable)*multiplicador*0.01) 

end,0) +

isnull(Case when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.00225) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.0145) 
end,0) +

isnull(Case when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.00225) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.0078) 
end,0) +


isnull(Case when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.00225) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.0078) 
end,0) +

isnull(Case when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.00225) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.0078) 
end,0) +


isnull(Case when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.001) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.0040) 
end,0) +


isnull(Case when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.001) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.004) 
end,0)<>0






GO
/****** Object:  Table [dbo].[AsientosDiariosHeader]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AsientosDiariosHeader](
	[asiento] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[tipoasiento] [int] NOT NULL,
	[fecha] [datetime] NOT NULL,
	[detalle] [varchar](50) NULL,
	[centrocosto] [int] NOT NULL,
	[AsientoCierre] [int] NULL,
	[AsientoInterno] [int] NULL,
	[TipoAsInterno] [int] NULL,
 CONSTRAINT [PK_AsientosDiariosHeader] PRIMARY KEY CLUSTERED 
(
	[asiento] ASC,
	[aniomes] ASC,
	[tipoasiento] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  View [dbo].[duplis]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE view [dbo].[duplis]
as
Select asiento,tipoasiento,aniomes,min(fecha) fecha ,count(*) casos from Asientosdiariosheader
group by asiento,tipoasiento,aniomes
having count(*)>1
GO
/****** Object:  View [dbo].[vComisionesInternasPendientes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE   View [dbo].[vComisionesInternasPendientes]
as

Select ho.idOPeracion,
vchc.fecha fechaRecibo, vchc.nrocomprobante nroRecibo,vchc.totalimporte TotalRecibo,
cl.codigo,cl.razonsocial,isnull(t.canti,ea.cantidad) Cantidad,isnull(t.serial,ea.serial) nSerie,
isnull(presimp,basecontable)*multiplicador Bruto,isnull(artic,an.articulo) Articulo ,
isnull(a.descripcion,an.descripcion) dArticulo,vchc.totalimporte importe,vchc.totalimporte,
l.idlinea Linea, l.Descripcion dLinea,sl.idsublinea sublinea, sl.Descripcion dSublinea,v.idvendedor Vendedor, v.nyap dVendedor,
tc.idtipo,tc.descripcion dTipoCliente,vchc.Fecha fechaFc, vchc.nrocomprobante NroFc, tvm.comprobante tcFC,
-- Nestor
isnull( case 
-- Audifonos Distribuidores y Nestor
when (
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
(idTipo=9 or (idTipo=17 and idvendedor=15))
then (isnull(presimp,basecontable)*multiplicador*0.01) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=17 and idvendedor<>15))
then (isnull(presimp,basecontable)*multiplicador*0.005) 
end,0)  NGO,

-- Patricia
isnull(
case 
-- Audifonos Distribuidores y Nestor
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
(idTipo=9 or (idTipo=17 and idvendedor=15))
then (isnull(presimp,basecontable)*multiplicador*0.003) 
-- Audifonos Distribuidores Buenos Aires no Nestor
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=17 and idvendedor<>15))
then (isnull(presimp,basecontable)*multiplicador*0.003) 

when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.003) 

when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.003) 

when ( 
(l.idLinea=18 and (sl.idSublinea=1801 or sl.idSublinea=1802
or sl.idSublinea=1804 or sl.idSublinea=1807 or sl.idSublinea=1808 or sl.idSublinea=1809)
or (l.idLinea=19))
and (idTipo<>9)
)
then (isnull(presimp,basecontable)*multiplicador*0.003) 

When l.idlinea=27 OR l.idlinea=100 OR l.idlinea=29 OR l.idlinea=30 OR l.idlinea=32 OR l.idlinea=33 
OR l.idlinea=35 OR l.idlinea=50 OR (l.idlinea=18 ANd (sl.idsublinea=3 OR sl.idsublinea=5 OR sl.idsublinea=6)) or isnull(a.articulo,an.articulo)='00001/4' 

then (isnull(presimp,basecontable)*multiplicador*0.003) 

when ( l.idLinea=1 or sl.idSublinea=108)
then (isnull(presimp,basecontable)*multiplicador*0.003) 

end,0) PA,
isnull(Case
-- Audifonos Distribuidores Buenos Aires no Nestor
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=17 and idvendedor<>15))
then (isnull(presimp,basecontable)*multiplicador*0.01) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.005) 

when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.015) 

when ( 
(l.idLinea=18 and (sl.idSublinea=1801 or sl.idSublinea=1802
or sl.idSublinea=1804 or sl.idSublinea=1807 or sl.idSublinea=1808 or sl.idSublinea=1809)
or (l.idLinea=19))
and (idTipo<>9)
and (isnull(an.articulo,a.articulo) like 'ST-%' or sl.idsublinea=1901)
)
then (isnull(presimp,basecontable)*multiplicador*0.02) 

when ( 
(l.idLinea=18 and (sl.idSublinea=1801 or sl.idSublinea=1802
or sl.idSublinea=1804 or sl.idSublinea=1807 or sl.idSublinea=1808 or sl.idSublinea=1809)
or (l.idLinea=19))
and (idTipo<>9)
and (isnull(an.articulo,a.articulo) not like 'ST-%' and sl.idsublinea<>1901)
)
then (isnull(presimp,basecontable)*multiplicador*0.0425) 

When l.idlinea=27 OR l.idlinea=100 OR l.idlinea=29 OR l.idlinea=30 OR l.idlinea=32 OR l.idlinea=33 
OR l.idlinea=35 OR l.idlinea=50 OR (l.idlinea=18 ANd (sl.idsublinea=3 OR sl.idsublinea=5 OR sl.idsublinea=6)) or isnull(a.articulo,an.articulo)='00001/4' 

then (isnull(presimp,basecontable)*multiplicador*0.03) 

end,0) GVE,

isnull(Case when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.00225) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.0145) 
end,0) HAY,

isnull(Case when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.00225) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.0078) 
end,0) VIG,

isnull(Case when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.00225) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.0078) 
end,0) EFR,

isnull(Case when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.00225) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.0078) 
end,0) CLB,

isnull(Case when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.001) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.0040) 
end,0) GR,

isnull(Case when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.001) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.004) 
end,0) JJ

From Header_operaciones ho
inner join detalle_operaciones doc 
on ho.idOPeracion=doc.idOperacion 
/* inner join vencliheader vch 
on do.idtransaccion=vch.idtransaccion 
inner join aplicacionescuentasacobrar acc
on acc.idtransaccion=vch.idtransaccion */
inner join vencliheader vchc 
on doc.idtransaccion=vchc.idtransaccion 
/*inner join detalle_operaciones doc
on vchc.idtransaccion=doc.idtransaccion and doc.idtipotransaccion=0*/
left join estadisticaArticulos ea 
on doc.idoperacion=ea.idoperacion
left join estadisticaArticulosPrecios eap 
on ea.idcampo=eap.idcampo
left join tra0 t
on vchc.cliente=t.codig and cast(substring(vchc.nrocomprobante,5,8) as int)=doc_d 
and vchc.fecha=t.fecha
inner join clientes cl 
on vchc.cliente=cl.codigo
left join articulos a 
on t.artic=a.articulo
left join articulos an
on ea.idarticulo=an.idarticulo
left join lineas l 
on isnull(a.idlinea,an.idlinea)=l.idlinea
left join sublineas sl 
on isnull(a.idsublinea,an.idSublinea)=sl.idsublinea
left join vendedores v
on cl.vendedor=v.idvendedor
inner join tiposCliente tc
on cl.tipocuenta=tc.idtipo
inner join tipVentmodheader tvm
on tvm.codigo=vchc.tipocomprobante
where tipodeOperacion between 40 and 49
and doc.idtipotransaccion=0
and isnull(idvendedor,0)<>24 
and isnull(idvendedor,0)<>20
and isnull(artic,an.articulo)<>'00001/8'
and isnull(vchc.cancelado,0)<vchc.totalimporte
and isnull(presimp,basecontable)*multiplicador is not null
and isnull(a.articulo,an.articulo)<>'00001/8'
and 

isnull(
case
when (
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
(idTipo=9 or (idTipo=17 and idvendedor=15))
then (isnull(presimp,basecontable)*multiplicador*0.01) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=17 and idvendedor<>15))
then (isnull(presimp,basecontable)*multiplicador*0.005) 
end,0) +

-- Patricia
isnull(
case 
-- Audifonos Distribuidores y Nestor
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
(idTipo=9 or (idTipo=17 and idvendedor=15))
then (isnull(presimp,basecontable)*multiplicador*0.003) 
-- Audifonos Distribuidores Buenos Aires no Nestor
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=17 and idvendedor<>15))
then (isnull(presimp,basecontable)*multiplicador*0.003) 

when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.003) 

when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.003) 

when ( 
(l.idLinea=18 and (sl.idSublinea=1801 or sl.idSublinea=1802
or sl.idSublinea=1804 or sl.idSublinea=1807 or sl.idSublinea=1808 or sl.idSublinea=1809)
or (l.idLinea=19))
and (idTipo<>9)
)
then (isnull(presimp,basecontable)*multiplicador*0.003) 

When l.idlinea=27 OR l.idlinea=100 OR l.idlinea=29 OR l.idlinea=30 OR l.idlinea=32 OR l.idlinea=33 
OR l.idlinea=35 OR l.idlinea=50 OR (l.idlinea=18 ANd (sl.idsublinea=3 OR sl.idsublinea=5 OR sl.idsublinea=6)) or isnull(a.articulo,an.articulo)='00001/4' 

then (isnull(presimp,basecontable)*multiplicador*0.003) 

when ( l.idLinea=1 or sl.idSublinea=108)
then (isnull(presimp,basecontable)*multiplicador*0.003) 

end,0) +
isnull(Case
-- Audifonos Distribuidores Buenos Aires no Nestor
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=17 and idvendedor<>15))
then (isnull(presimp,basecontable)*multiplicador*0.01) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.005) 

when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.015) 

when ( 
(l.idLinea=18 and (sl.idSublinea=1801 or sl.idSublinea=1802
or sl.idSublinea=1804 or sl.idSublinea=1807 or sl.idSublinea=1808 or sl.idSublinea=1809)
or (l.idLinea=19))
and (idTipo<>9)
and (isnull(an.articulo,a.articulo) like 'ST-%' or sl.idsublinea=1901)
)
then (isnull(presimp,basecontable)*multiplicador*0.02) 

when ( 
(l.idLinea=18 and (sl.idSublinea=1801 or sl.idSublinea=1802
or sl.idSublinea=1804 or sl.idSublinea=1807 or sl.idSublinea=1808 or sl.idSublinea=1809)
or (l.idLinea=19))
and (idTipo<>9)
and (isnull(an.articulo,a.articulo) not like 'ST-%' and sl.idsublinea<>1901)
)
then (isnull(presimp,basecontable)*multiplicador*0.0425) 

When l.idlinea=27 OR l.idlinea=100 OR l.idlinea=29 OR l.idlinea=30 OR l.idlinea=32 OR l.idlinea=33 
OR l.idlinea=35 OR l.idlinea=50 OR (l.idlinea=18 ANd (sl.idsublinea=3 OR sl.idsublinea=5 OR sl.idsublinea=6)) or isnull(a.articulo,an.articulo)='00001/4' 

then (isnull(presimp,basecontable)*multiplicador*0.03) 

when ( l.idLinea=1 or sl.idSublinea=108)
then (isnull(presimp,basecontable)*multiplicador*0.01) 

end,0) +

isnull(Case when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.00225) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.0145) 
end,0) +

isnull(Case when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.00225) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.0078) 
end,0) +


isnull(Case when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.00225) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.0078) 
end,0) +

isnull(Case when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.00225) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.0078) 
end,0) +

isnull(Case when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.001) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.0040) 
end,0) +

isnull(Case when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo=16))
then (isnull(presimp,basecontable)*multiplicador*0.001) 
when ( 
(l.idLinea=1 and sl.idSublinea<>108) or isnull(a.articulo,an.articulo)='00001') 
and
((idTipo<>16 and idTipo<>17 and idTipo<>9))
then (isnull(presimp,basecontable)*multiplicador*0.004) 
end,0)<>0




GO
/****** Object:  View [dbo].[Dupls]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create view [dbo].[Dupls]
as
Select Notas from articulos 
where articulo between '700000' and '799999'
group by notas
Having count(*)>1
GO
/****** Object:  View [dbo].[dupsMax]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create view [dbo].[dupsMax]
as
Select max(articulo) articulo,d.notas from Dupls d
inner join articulos a
on d.notas=a.notas

where a.articulo>'699999'

Group by d.notas
GO
/****** Object:  View [dbo].[dupsMin]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create view [dbo].[dupsMin]
as
Select min(articulo) articulo,d.notas from Dupls d
inner join articulos a
on d.notas=a.notas

where a.articulo>'699999'

Group by d.notas
GO
/****** Object:  Table [dbo].[Marcas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Marcas](
	[idMarca] [int] IDENTITY(0,1) NOT NULL,
	[Descripcion] [varchar](20) NULL
) ON [PRIMARY]
GO
/****** Object:  View [dbo].[acumulados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE   view [dbo].[acumulados]
as
Select ho.aniomes,ea.idArticulo,a.articulo,a.descripcion dArticulo,
a.idlinea cLinea,l.descripcion dLinea,a.idsublinea cSublinea,sl.descripcion dSublinea,a.idmarca cMarca,m.descripcion dMarca,

sum(cantidad*multiplicador) Cantidad,
sum(baseContable*multiplicador) Importe,
sum(isnull(baseContable*multiplicador,0))/case when sum(cantidad*multiplicador)=0 then 1 else sum(cantidad*multiplicador) end Promedio

from Header_Operaciones ho
inner join Detalle_operaciones do 
on ho.idOPeracion=do.idOPeracion
inner join VenCliHeader vch 
on do.idtransaccion=vch.idtransaccion 
inner join Clientes c
on vch.cliente=c.codigo
inner join EstadisticaArticulos ea
on do.idOperacion=ea.idOPeracion
inner join EstadisticaArticulosPrecios eap
on ea.idCampo=eap.idCampo
inner join Articulos a
on ea.idArticulo=a.idarticulo
left join Lineas l 
on a.idLinea=l.idLinea
left join Sublineas sl
on a.idSublinea=sl.idSublinea
left join Marcas m 
on a.idMarca=m.idMarca
left join vendedores v
on c.vendedor=v.idvendedor
inner join tipVentModHeader t
on vch.tipocomprobante=t.codigo

where idtipotransaccion=0 and ho.aniomes>200800

Group by ho.aniomes,ea.idArticulo,a.articulo,a.descripcion,a.idlinea,l.descripcion,a.idsublinea,sl.descripcion,a.idmarca,m.descripcion



GO
/****** Object:  Table [dbo].[AplicacionesCuentasaPagar]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AplicacionesCuentasaPagar](
	[idTransaccion] [int] NOT NULL,
	[item] [int] NOT NULL,
	[IdTransaccionCancelada] [int] NOT NULL,
	[Importe] [numeric](18, 2) NOT NULL,
	[ImporteOrigen] [numeric](18, 2) NULL,
	[idAplicacion] [int] IDENTITY(1,1) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  View [dbo].[ApcOptimizada]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create View [dbo].[ApcOptimizada] 
as
Select * from aplicacionescuentasaPagar union 

Select a.idtransaccionCancelada,1,c.idtransaccion,-sum(a.importe) importe, -sum(a.importeOrigen),0 from (
Select distinct a1.*
from CompProvHeader c
inner join aplicacionescuentasaPagar a on a.idtransaccion=c.idtransaccion
inner join aplicacionescuentasaPagar a1 on a1.idtransaccionCancelada=c.idtransaccion
) as a
inner join CompProvHeader c on a.idtransaccion=c.idtransaccion


Group by a.idtransaccionCancelada,c.idtransaccion
GO
/****** Object:  View [dbo].[bCarteraaFecha]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE view [dbo].[bCarteraaFecha]
as
Select vch.idtransaccion,vch.totalimporte,vch.importeOrigen,max(vch.fecha) Fecha
from CompProvHeader vch
inner join ApcOptimizada a on a.idtransaccion=vch.idtransaccion
inner join CompProvHeader vch1 on a.idtransaccionCancelada=vch1.idtransaccion
inner join TipCompModHeader tch on tch.codigo=vch1.tipoComprobante
where vch.proveedor>211000
Group by vch.idtransaccion,vch.totalimporte,vch.importeOrigen
Having vch.totalImporte=sum(a.importe*Multiplicador)

union

Select vch.idtransaccion,vch.totalimporte,vch.importeOrigen,max(isnull(vch1.fecha,vch.fecha)) Fecha
from CompProvHeader vch
inner join aplicacionescuentasaPagar a on a.idtransaccionCancelada=vch.idtransaccion
left join CompProvHeader vch1 on a.idtransaccion=vch1.idtransaccion
where vch.proveedor>211000
Group by vch.idtransaccion,vch.totalimporte,vch.importeOrigen
Having vch.totalImporte=sum(a.importe)

union 
Select vch.idtransaccion,vch.totalimporte,vch.importeOrigen,vch.fecha Fecha
from CompProvHeader vch
left join aplicacionescuentasaPagar a on a.idtransaccion=vch.idtransaccion
left join aplicacionescuentasaPagar a1 on a1.idtransaccionCancelada=vch.idtransaccion
where estado in ('Z','F')
and vch.proveedor>211000
and isnull(a.idtransaccion,a1.idtransaccion) is null
GO
/****** Object:  View [dbo].[Difs]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create view [dbo].[Difs]
as
Select 
cliente,
substring(nroComprobante,5,8) nd,
sum(totalimporte*multiplicador) pes,
sum(case when moneda=0 then totalimporte else 0 end*multiplicador) dol,
sum(ImporteOrigen*multiplicador) dolpUR

from vencliheader v
inner join TipVentModHeader t
on v.tipocomprobante=t.codigo
group by substring(nroComprobante,5,8),cliente
having sum(totalimporte*multiplicador)=0
and sum(case when moneda=0 then totalimporte else 0 end*multiplicador)<>0
--or sum(importeOrigen*multiplicador)<>0
GO
/****** Object:  View [dbo].[Diferencias]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create view [dbo].[Diferencias]
as
Select asiento,aniomes,tipoasiento, 6309000 Cuenta,sum(debe) Debitos ,sum(haber) Creditos,
case when sum(debe)<sum(haber) then sum(Haber)-sum(Debe) else 0 end Debe,
case when sum(debe)>sum(haber) then sum(Debe)-sum(Haber) else 0 end Haber

from asientosdiariositems 
Group by asiento,aniomes,tipoasiento
having sum(debe)<>sum(haber)
--order by tipoasiento

/* 
Select * from asientosdiariositems 
where debe=.01 or haber=.01


*/
GO
/****** Object:  View [dbo].[Aplicaciones]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE view [dbo].[Aplicaciones]
as
Select Proveedor,nroComprobante,sum(totalimporte*Multiplicador ) aPesos,sum(ImporteOrigen*Multiplicador ) aDolares
from CompProvHeader v
inner join TipCompModHeader t
on v.tipocomprobante=t.codigo
group by Proveedor,nroComprobante
GO
/****** Object:  Table [dbo].[Profesionales]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Profesionales](
	[socio] [int] IDENTITY(1,1) NOT NULL,
	[Apellido] [char](40) NULL,
	[nombre] [char](40) NULL,
	[tipodocto] [tinyint] NULL,
	[numedocto] [int] NULL,
	[Nacionalidad] [int] NULL,
	[Sexo] [tinyint] NULL,
	[Grupo] [char](1) NULL,
	[gDesde] [datetime] NULL,
	[nAma] [char](10) NULL,
	[DomicilioPrincipal] [char](1) NULL,
	[Domicilio] [varchar](60) NULL,
	[cpostal] [varchar](8) NULL,
	[localidad] [varchar](50) NULL,
	[provincia] [int] NULL,
	[pais] [int] NULL,
	[telefono] [varchar](60) NULL,
	[Fax] [varchar](60) NULL,
	[Email] [varchar](60) NULL,
	[EmailAlt1] [varchar](50) NULL,
	[EmailAlt2] [varchar](50) NULL,
	[EmailAlt3] [varchar](50) NULL,
	[EstadoCivil] [tinyint] NULL,
	[Nacido] [datetime] NULL,
	[mesRecibido] [tinyint] NULL,
	[anoRecibido] [int] NULL,
	[Domicilio_consultorio] [char](40) NULL,
	[cpostal_consultorio] [varchar](8) NULL,
	[localidad_consultorio] [varchar](50) NULL,
	[provincia_consultorio] [int] NULL,
	[pais_consultorio] [int] NULL,
	[telefono_consultorio] [varchar](50) NULL,
	[Fax_Consultorio] [varchar](50) NULL,
	[Observa1] [char](60) NULL,
	[Observa2] [char](60) NULL,
	[Tarjeta] [int] NULL,
	[numero] [char](16) NULL,
	[Adherido] [char](1) NULL,
	[Vencimiento] [datetime] NULL,
	[FechaBaja] [datetime] NULL,
	[cuil] [char](13) NULL,
	[DebitarDesde] [datetime] NULL,
	[FechaIngreso] [datetime] NULL,
	[Residente] [char](1) NULL,
	[pr] [char](10) NULL,
	[prc] [char](10) NULL,
	[cpais] [char](10) NULL,
	[cpaisc] [char](10) NULL,
	[tipoMatricula] [int] NULL,
	[nroMatricula] [char](12) NULL,
	[fresidencia] [datetime] NULL,
	[fechanac] [datetime] NULL,
	[nacdos] [char](10) NULL,
	[tdDos] [char](10) NULL,
	[ndDos] [varchar](50) NULL,
	[amaDos] [varchar](50) NULL,
	[Cobrador] [int] NULL,
	[Matricula] [varchar](50) NULL,
	[pairDos] [char](10) NULL,
	[PaicDos] [char](10) NULL,
	[tIpoMatricula2] [int] NULL,
	[NroMatricula2] [char](12) NULL,
	[domicEnvio] [tinyint] NULL,
	[FechaGrupo] [datetime] NULL,
	[fResidente] [datetime] NULL,
	[seguro] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  View [dbo].[medicos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create view [dbo].[medicos]
as
Select socio,apellido,nombre,0 entidad,grupo,fechabaja from socios
union 
Select socio,apellido,nombre,1 entidad,grupo,fechabaja from Profesionales
GO
/****** Object:  Table [dbo].[__socios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[__socios](
	[socio] [int] NOT NULL,
	[Apellido] [char](40) NULL,
	[nombre] [char](40) NULL,
	[tipodocto] [tinyint] NULL,
	[numedocto] [int] NULL,
	[Nacionalidad] [int] NULL,
	[Sexo] [tinyint] NULL,
	[Grupo] [char](1) NULL,
	[gDesde] [datetime] NULL,
	[nAma] [char](10) NULL,
	[DomicilioPrincipal] [char](1) NULL,
	[Domicilio] [varchar](60) NULL,
	[cpostal] [varchar](8) NULL,
	[localidad] [varchar](50) NULL,
	[provincia] [int] NULL,
	[pais] [int] NULL,
	[telefono] [varchar](100) NULL,
	[Fax] [varchar](100) NULL,
	[Email] [varchar](100) NULL,
	[EmailAlt1] [varchar](50) NULL,
	[EmailAlt2] [varchar](50) NULL,
	[EmailAlt3] [varchar](50) NULL,
	[EstadoCivil] [tinyint] NULL,
	[Nacido] [datetime] NULL,
	[mesRecibido] [tinyint] NULL,
	[anoRecibido] [int] NULL,
	[Domicilio_consultorio] [char](40) NULL,
	[cpostal_consultorio] [varchar](8) NULL,
	[localidad_consultorio] [varchar](50) NULL,
	[provincia_consultorio] [int] NULL,
	[pais_consultorio] [int] NULL,
	[telefono_consultorio] [varchar](50) NULL,
	[Fax_Consultorio] [varchar](50) NULL,
	[Observa1] [nvarchar](4000) NULL,
	[Observa2] [char](60) NULL,
	[Tarjeta] [int] NULL,
	[numero] [char](16) NULL,
	[Adherido] [char](1) NULL,
	[Vencimiento] [datetime] NULL,
	[FechaBaja] [datetime] NULL,
	[cuil] [char](13) NULL,
	[DebitarDesde] [datetime] NULL,
	[FechaIngreso] [datetime] NULL,
	[Residente] [char](1) NULL,
	[pr] [char](10) NULL,
	[prc] [char](10) NULL,
	[cpais] [char](10) NULL,
	[cpaisc] [char](10) NULL,
	[tipoMatricula] [int] NULL,
	[nroMatricula] [char](12) NULL,
	[fresidencia] [datetime] NULL,
	[fechanac] [datetime] NULL,
	[nacdos] [char](10) NULL,
	[tdDos] [char](10) NULL,
	[ndDos] [varchar](50) NULL,
	[amaDos] [varchar](50) NULL,
	[Cobrador] [int] NULL,
	[Matricula] [varchar](50) NULL,
	[pairDos] [char](10) NULL,
	[PaicDos] [char](10) NULL,
	[tIpoMatricula2] [int] NULL,
	[NroMatricula2] [char](12) NULL,
	[domicEnvio] [tinyint] NULL,
	[FechaGrupo] [datetime] NULL,
	[fResidente] [datetime] NULL,
	[identificador] [datetime] NULL,
	[ultimageneracion] [datetime] NULL,
	[seguro] [int] NULL,
	[cuotas] [int] NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Adherentes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Adherentes](
	[Adherente] [int] IDENTITY(1,1) NOT NULL,
	[Apellido] [char](40) NULL,
	[nombre] [char](40) NULL,
	[Domicilio] [varchar](60) NULL,
	[cpostal] [char](8) NULL,
	[localidad] [char](20) NULL,
	[provincia] [int] NULL,
	[telefono] [char](40) NULL,
	[Email] [char](40) NULL,
	[tipodocto] [tinyint] NULL,
	[numedocto] [int] NULL,
	[tipoMatricula] [tinyint] NULL,
	[NroMatricula] [int] NULL,
	[FichaMun] [int] NULL,
	[SubNumero] [int] NULL,
	[Nacional] [tinyint] NULL,
	[Sexo] [tinyint] NULL,
	[EstadoCivil] [tinyint] NULL,
	[Nacido] [datetime] NULL,
	[Certificado] [datetime] NULL,
	[mesRecibido] [tinyint] NULL,
	[anoRecibido] [int] NULL,
	[FichaCensal] [char](8) NULL,
	[LugarVoto] [char](5) NULL,
	[Domicilio_cobro] [char](40) NULL,
	[cpostal_cobro] [char](8) NULL,
	[localidad_cobro] [char](20) NULL,
	[provincia_cobro] [int] NULL,
	[telefono_cobro] [char](40) NULL,
	[Colegio] [char](1) NULL,
	[col_Adherente] [char](6) NULL,
	[Observa1] [varchar](60) NULL,
	[Observa2] [varchar](60) NULL,
	[Cobrador] [tinyint] NULL,
	[Legajo2] [int] NULL,
	[FechayHora] [datetime] NULL,
	[Usuario] [int] NULL,
	[Tarjeta] [int] NULL,
	[numero] [char](16) NULL,
	[Adherido] [char](1) NULL,
	[Vencimiento] [datetime] NULL,
	[FechaBaja] [datetime] NULL,
	[Identificador] [datetime] NULL,
	[UltimaGeneracion] [datetime] NULL,
	[Uno] [int] NULL,
	[Dos] [int] NULL,
	[tres] [int] NULL,
	[cuil] [char](13) NULL,
	[DebitarDesde] [datetime] NULL,
	[FechaIngreso] [datetime] NULL,
	[Grupo] [char](1) NULL,
	[Residente] [char](1) NULL,
	[idDomicilioCobro] [int] NULL,
	[CajaAnses] [int] NULL,
	[ed1] [int] NULL,
	[ed2] [int] NULL,
	[ed3] [int] NULL,
	[ed4] [int] NULL,
	[Foto] [varchar](50) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Aduanas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Aduanas](
	[idAduana] [int] IDENTITY(0,1) NOT NULL,
	[Descripcion] [varchar](50) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ahBoradosSinItems]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ahBoradosSinItems](
	[asiento] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[tipoasiento] [int] NOT NULL,
	[fecha] [datetime] NOT NULL,
	[detalle] [varchar](50) NULL,
	[centrocosto] [int] NOT NULL,
	[AsientoCierre] [int] NULL,
	[AsientoInterno] [int] NULL,
	[TipoAsInterno] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[aiEliminados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[aiEliminados](
	[asiento] [int] NOT NULL,
	[item] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[tipoasiento] [int] NOT NULL,
	[cuenta] [int] NOT NULL,
	[debe] [numeric](18, 2) NULL,
	[haber] [numeric](18, 2) NULL,
	[observacion] [varchar](50) NULL,
	[centrocosto] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Alumnos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Alumnos](
	[idAlumno] [int] IDENTITY(1,1) NOT NULL,
	[nyap] [varchar](50) NULL,
	[Domicilio] [varchar](50) NULL,
	[Localidad] [varchar](50) NULL,
	[cpostal] [varchar](8) NULL,
	[Provincia] [int] NULL,
	[Telefono] [varchar](30) NULL,
	[TelefonoII] [varchar](50) NULL,
	[email] [varchar](50) NULL,
	[idProfesion] [int] NULL,
	[EstadoCivil] [tinyint] NULL,
	[Nacido] [datetime] NULL,
	[LugarTrabajo] [varchar](50) NULL,
	[Recibido] [datetime] NULL,
	[Especialidad] [int] NULL,
	[TipoDocumento] [tinyint] NULL,
	[Numedocto] [int] NULL,
	[FichaMunicipal] [int] NULL,
	[FechaIngreso] [datetime] NULL,
	[TipoMat] [int] NULL,
	[NumeroMat] [int] NULL,
	[FichaMun] [int] NULL,
	[Nacionalidad] [int] NULL,
	[cuil] [varchar](13) NULL,
	[Grupo] [int] NULL,
	[CodigoGrupo] [int] NULL,
	[Sexo] [tinyint] NULL,
	[Debito] [tinyint] NULL,
	[Tarjeta] [int] NULL,
	[Numero] [numeric](18, 0) NULL,
	[Vencimiento] [datetime] NULL,
	[Debitardesde] [datetime] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AnexoMateriales]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AnexoMateriales](
	[idCampo] [int] IDENTITY(1,1) NOT NULL,
	[PartNumber] [varchar](30) NULL,
	[descripcion] [varchar](20) NULL,
	[cantidad] [numeric](18, 2) NULL,
	[afacturar] [numeric](18, 2) NULL,
	[precio] [numeric](18, 2) NULL,
	[idObra] [int] NULL,
	[idOperacion] [int] NULL,
	[idOperacionPresupuesto] [int] NULL,
	[itMao] [int] NULL,
	[itMat] [int] NULL,
	[afacturarmanual] [numeric](18, 2) NULL,
 CONSTRAINT [PK_AnexoMateriales] PRIMARY KEY CLUSTERED 
(
	[idCampo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AnexoMaterialesPrespuestos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AnexoMaterialesPrespuestos](
	[idCampo] [int] IDENTITY(1,1) NOT NULL,
	[PartNumber] [varchar](30) NULL,
	[descripcion] [varchar](20) NULL,
	[cantidad] [numeric](18, 2) NULL,
	[afacturar] [numeric](18, 2) NULL,
	[precio] [numeric](18, 2) NULL,
	[idObra] [int] NULL,
	[idOperacion] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AnexoMaterialesPresupuestos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AnexoMaterialesPresupuestos](
	[idCampo] [int] IDENTITY(1,1) NOT NULL,
	[PartNumber] [varchar](30) NULL,
	[descripcion] [varchar](20) NULL,
	[cantidad] [numeric](18, 2) NULL,
	[afacturar] [numeric](18, 2) NULL,
	[precio] [numeric](18, 2) NULL,
	[idObra] [int] NULL,
	[idOperacion] [int] NULL,
	[afacturarmanual] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[aoCierre]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[aoCierre](
	[cuenta] [int] NOT NULL,
	[Debe] [numeric](38, 2) NULL,
	[Haber] [numeric](38, 2) NULL,
	[Saldo] [numeric](38, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AplicacionesCuentasaPagarAnuladas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AplicacionesCuentasaPagarAnuladas](
	[idTransaccion] [int] NOT NULL,
	[item] [int] NOT NULL,
	[IdTransaccionCancelada] [int] NOT NULL,
	[Importe] [numeric](18, 2) NOT NULL,
	[ImporteOrigen] [numeric](18, 2) NULL,
	[idAplicacion] [int] NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AplicacionesCuentasCorrientes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AplicacionesCuentasCorrientes](
	[idTransaccion] [int] NOT NULL,
	[item] [int] NOT NULL,
	[IdTransaccionCancelada] [int] NOT NULL,
	[Importe] [numeric](18, 2) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AplicacionesCuentasCorrientesAnuladas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AplicacionesCuentasCorrientesAnuladas](
	[idTransaccion] [int] NOT NULL,
	[item] [int] NOT NULL,
	[IdTransaccionCancelada] [int] NOT NULL,
	[Importe] [numeric](18, 2) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AplicacionesCuentasCorrientesAnuladasDebitos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AplicacionesCuentasCorrientesAnuladasDebitos](
	[idTransaccion] [int] NULL,
	[item] [int] NULL,
	[IdTransaccionCancelada] [int] NULL,
	[Importe] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AplicacionesValores]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AplicacionesValores](
	[idTransaccion] [int] NOT NULL,
	[item] [int] NOT NULL,
	[IdTransaccionCancelada] [int] NOT NULL,
	[Importe] [numeric](18, 2) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AplicacionesValoresAnulados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AplicacionesValoresAnulados](
	[idTransaccion] [int] NOT NULL,
	[item] [int] NOT NULL,
	[IdTransaccionCancelada] [int] NOT NULL,
	[Importe] [numeric](18, 2) NOT NULL,
	[Fecha] [datetime] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ArticulosClientes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ArticulosClientes](
	[idaCliente] [int] IDENTITY(1,1) NOT NULL,
	[idArticulo] [int] NOT NULL,
	[idCliente] [int] NULL,
	[ArticuloCliente] [varchar](50) NOT NULL,
	[idOrigen] [int] NULL,
	[FechaAlta] [datetime] NULL,
	[Vencimiento] [datetime] NULL,
 CONSTRAINT [PK_ArticulosCliente] PRIMARY KEY CLUSTERED 
(
	[idArticulo] ASC,
	[ArticuloCliente] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ArticulosProveedor]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ArticulosProveedor](
	[idaProveedor] [int] IDENTITY(1,1) NOT NULL,
	[idArticulo] [int] NOT NULL,
	[idProveedor] [int] NULL,
	[ArticuloProveedor] [varchar](50) NOT NULL,
	[idOrigen] [int] NULL,
	[FechaAlta] [datetime] NULL,
	[Vencimiento] [datetime] NULL,
 CONSTRAINT [PK_ArticulosProveedor] PRIMARY KEY CLUSTERED 
(
	[idArticulo] ASC,
	[ArticuloProveedor] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AsientoCierreObrasTemp]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AsientoCierreObrasTemp](
	[Orden] [int] NOT NULL,
	[Cuenta] [int] NULL,
	[Debe] [numeric](18, 2) NULL,
	[Haber] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AsientosDiariosHeaderAnulados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AsientosDiariosHeaderAnulados](
	[asiento] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[tipoasiento] [int] NOT NULL,
	[fecha] [datetime] NOT NULL,
	[detalle] [varchar](50) NULL,
	[centrocosto] [int] NOT NULL,
	[AsientoCierre] [int] NULL,
	[AsientoInterno] [int] NULL,
	[TipoAsInterno] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AsientosDiariosHeaderDAAnulados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AsientosDiariosHeaderDAAnulados](
	[asiento] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[tipoasiento] [int] NOT NULL,
	[fecha] [datetime] NOT NULL,
	[detalle] [varchar](50) NULL,
	[centrocosto] [int] NOT NULL,
	[AsientoCierre] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AsientosDiariosItemsAnulados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AsientosDiariosItemsAnulados](
	[asiento] [int] NOT NULL,
	[item] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[tipoasiento] [int] NOT NULL,
	[cuenta] [int] NOT NULL,
	[debe] [numeric](18, 2) NULL,
	[haber] [numeric](18, 2) NULL,
	[observacion] [varchar](20) NULL,
	[centrocosto] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AsientosDiariosItemsBalance]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AsientosDiariosItemsBalance](
	[asiento] [int] NOT NULL,
	[item] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[tipoasiento] [int] NOT NULL,
	[cuenta] [int] NOT NULL,
	[debe] [numeric](18, 2) NULL,
	[haber] [numeric](18, 2) NULL,
	[observacion] [varchar](20) NULL,
	[centrocosto] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AsientosDiariosItemsCVAnulados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AsientosDiariosItemsCVAnulados](
	[asiento] [int] NOT NULL,
	[item] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[tipoasiento] [int] NOT NULL,
	[cuenta] [int] NOT NULL,
	[debe] [numeric](18, 2) NULL,
	[haber] [numeric](18, 2) NULL,
	[observacion] [varchar](20) NULL,
	[centrocosto] [int] NULL,
	[Fecha] [datetime] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AsientosDiariosItemsDAAnulados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AsientosDiariosItemsDAAnulados](
	[asiento] [int] NOT NULL,
	[item] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[tipoasiento] [int] NOT NULL,
	[cuenta] [int] NOT NULL,
	[debe] [numeric](18, 2) NULL,
	[haber] [numeric](18, 2) NULL,
	[observacion] [varchar](20) NULL,
	[centrocosto] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AsientosDiariosItemsDiario]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AsientosDiariosItemsDiario](
	[asiento] [int] NOT NULL,
	[item] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[tipoasiento] [int] NOT NULL,
	[cuenta] [int] NOT NULL,
	[debe] [numeric](18, 2) NULL,
	[haber] [numeric](18, 2) NULL,
	[observacion] [varchar](50) NULL,
	[centrocosto] [int] NULL,
	[Usuario] [varchar](50) NULL,
	[tipodeComprobante] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AsientosExcluidos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AsientosExcluidos](
	[Computer] [varchar](50) NULL,
	[aniomes] [int] NULL,
	[tas] [int] NULL,
	[asiento] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[auditoria]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[auditoria](
	[espacio] [varchar](50) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[AuditoriaAnexoMateriales]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AuditoriaAnexoMateriales](
	[itMao] [int] NULL,
	[itMat] [int] NULL,
	[Origen] [varchar](50) NULL,
	[Modulo] [varchar](50) NULL,
	[Fecha] [datetime] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[BajasVisa_202312]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[BajasVisa_202312](
	[Socio] [int] NOT NULL,
	[apellido] [char](40) NULL,
	[nombre] [char](40) NULL,
	[tarjeta] [int] NULL,
	[numero] [char](16) NULL,
	[email] [varchar](100) NULL,
	[telefono] [varchar](100) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[bak_20240605_CuentasCorrientes_planes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[bak_20240605_CuentasCorrientes_planes](
	[IdTransaccion] [int] NOT NULL,
	[socio] [int] NOT NULL,
	[Entidad] [int] NOT NULL,
	[Fecha] [datetime] NOT NULL,
	[Concepto] [char](3) NOT NULL,
	[PuntodeVenta] [char](14) NULL,
	[DocumentoNumero] [char](14) NULL,
	[FechaRendicion] [datetime] NULL,
	[Rendicion] [varchar](20) NULL,
	[importe] [numeric](18, 2) NULL,
	[Cancelado] [numeric](18, 2) NULL,
	[vencimiento] [datetime] NULL,
	[Cobrador] [int] NULL,
	[Serie] [varchar](50) NULL,
	[idCancelada] [numeric](18, 0) NULL,
	[idOpCobrador] [numeric](18, 0) NULL,
	[rg1] [varchar](100) NULL,
	[rg2] [varchar](100) NULL,
	[rg3] [varchar](100) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Bancos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Bancos](
	[banco] [int] NOT NULL,
	[descripcion] [varchar](20) NULL,
	[opera] [char](1) NULL,
 CONSTRAINT [PK_Bancos] PRIMARY KEY CLUSTERED 
(
	[banco] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[BaseInventarios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[BaseInventarios](
	[aniomes] [int] NOT NULL,
	[Vigenciadesde] [int] NULL,
	[VigenciaHasta] [int] NULL,
	[idArticulo] [int] NOT NULL,
	[Articulo] [varchar](15) NOT NULL,
	[Descripcion] [varchar](40) NULL,
	[Detalle] [varchar](255) NULL,
	[Presentacion] [varchar](20) NULL,
	[Notas] [varchar](20) NULL,
	[Unidades] [numeric](18, 2) NULL,
	[xCaja] [numeric](18, 2) NULL,
	[xMetro] [numeric](18, 2) NULL,
	[Comercio] [tinyint] NULL,
	[idLinea] [int] NULL,
	[idSublinea] [int] NULL,
	[idMarca] [int] NULL,
	[Procesa] [int] NULL,
	[Serial] [int] NULL,
	[Minimo] [int] NULL,
	[Maximo] [int] NULL,
	[Meses] [int] NULL,
	[cuenta] [int] NULL,
	[Alicuota] [numeric](18, 2) NULL,
	[FechaIngreso] [datetime] NULL,
	[FechaInactivo] [datetime] NULL,
	[Modalidad] [int] NULL,
	[idArticuloBase] [int] NULL,
	[unidadesxbase] [numeric](18, 4) NULL,
	[idlineaComis] [int] NULL,
	[idsublineaComis] [int] NULL,
	[Precio] [numeric](18, 2) NULL,
	[Sector] [int] NULL,
	[Ubicacion] [int] NULL,
	[Observacion] [varchar](50) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[BaseJuicios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[BaseJuicios](
	[idJuicio] [int] IDENTITY(1,1) NOT NULL,
	[Juicio] [int] NULL,
	[Fuero] [char](1) NULL,
	[Caratula] [varchar](160) NULL,
	[caratula2] [varchar](78) NULL,
	[Estado] [varchar](78) NULL,
	[fHecho] [varchar](78) NULL,
	[lHecho] [varchar](78) NULL,
	[Compania] [varchar](78) NULL,
	[Jurisdiccion] [varchar](78) NULL,
	[Monto] [varchar](78) NULL,
	[FCarga] [varchar](78) NULL,
	[dCarga] [datetime] NULL,
	[FCertificado] [varchar](78) NULL,
	[dCertificado] [datetime] NULL,
	[Observa1] [varchar](160) NULL,
	[Observa2] [varchar](78) NULL,
	[Detalle] [varchar](160) NULL,
	[idEstado] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[bk_20240703_cancelado_mayor_importe]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[bk_20240703_cancelado_mayor_importe](
	[IdTransaccion] [int] IDENTITY(1,1) NOT NULL,
	[socio] [int] NOT NULL,
	[Entidad] [int] NOT NULL,
	[Fecha] [datetime] NOT NULL,
	[Concepto] [char](3) NOT NULL,
	[PuntodeVenta] [char](14) NULL,
	[DocumentoNumero] [char](14) NULL,
	[FechaRendicion] [datetime] NULL,
	[Rendicion] [varchar](20) NULL,
	[importe] [numeric](18, 2) NULL,
	[Cancelado] [numeric](18, 2) NULL,
	[vencimiento] [datetime] NULL,
	[Cobrador] [int] NULL,
	[Serie] [varchar](50) NULL,
	[idCancelada] [numeric](18, 0) NULL,
	[idOpCobrador] [numeric](18, 0) NULL,
	[rg1] [varchar](100) NULL,
	[rg2] [varchar](100) NULL,
	[rg3] [varchar](100) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Cajeros]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Cajeros](
	[idCajero] [int] IDENTITY(0,1) NOT NULL,
	[Descripcion] [char](10) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CalificProfesionales]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CalificProfesionales](
	[califprofesional] [int] IDENTITY(1,1) NOT NULL,
	[descripcion] [varchar](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CambiosTarjetaMaster]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CambiosTarjetaMaster](
	[idRegistro] [int] IDENTITY(0,1) NOT NULL,
	[socio] [int] NOT NULL,
	[entidad] [int] NOT NULL,
	[numeroAnterior] [numeric](18, 0) NOT NULL,
	[numeroNuevo] [numeric](18, 0) NOT NULL,
	[Procesado] [datetime] NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Cargas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Cargas](
	[Carga] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [varchar](50) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[cargoMateriales]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[cargoMateriales](
	[idcampo] [int] NOT NULL,
	[cantidad] [numeric](18, 2) NULL,
	[precio] [numeric](18, 2) NULL,
	[Subtotal] [numeric](38, 6) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[cargos_adherentes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[cargos_adherentes](
	[adherente] [int] NOT NULL,
	[CodCargo] [tinyint] NOT NULL,
	[LugarCargo] [int] NULL,
	[FecDesde] [datetime] NULL,
	[FecHasta] [datetime] NULL,
	[TituSup] [char](1) NULL,
	[idCampo] [int] IDENTITY(1,1) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[cargos_socios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[cargos_socios](
	[socio] [int] NOT NULL,
	[CodCargo] [tinyint] NOT NULL,
	[LugarCargo] [int] NULL,
	[FecDesde] [datetime] NULL,
	[FecHasta] [datetime] NULL,
	[TituSup] [char](1) NULL,
	[idCampo] [int] IDENTITY(1,1) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CargosAsociacion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CargosAsociacion](
	[Cargo] [tinyint] NOT NULL,
	[Descripcion] [char](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[catConvenio]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[catConvenio](
	[idcConvenio] [int] IDENTITY(0,1) NOT NULL,
	[dCategoria] [varchar](50) NULL,
	[Descripcion] [varchar](50) NULL,
	[importe] [numeric](18, 2) NOT NULL,
	[Categoria] [int] NULL,
	[Concepto] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Categorias]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Categorias](
	[categoria] [int] IDENTITY(1,1) NOT NULL,
	[descripcion] [varchar](30) NULL,
	[Importe] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CategoriasCodigos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CategoriasCodigos](
	[idCategoria] [int] NOT NULL,
	[Descripcion] [char](15) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CategoriasGruposUsuarios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CategoriasGruposUsuarios](
	[Categoria] [int] NULL,
	[Descripcion] [varchar](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CategoriasPagos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CategoriasPagos](
	[idCategoria] [int] IDENTITY(0,1) NOT NULL,
	[Descripcion] [varchar](50) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CategoriasProveedor]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CategoriasProveedor](
	[idCategoria] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [char](15) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CategoriasSueldos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CategoriasSueldos](
	[idtCategoria] [int] IDENTITY(1,1) NOT NULL,
	[idNivel] [int] NULL,
	[idCategoria] [int] NULL,
	[idSubcategoria] [int] NULL,
	[Importe] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CentrosdeCostos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CentrosdeCostos](
	[centrocosto] [int] IDENTITY(1,1) NOT NULL,
	[descripcion] [varchar](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Certificados_Adherentes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Certificados_Adherentes](
	[idCampo] [int] IDENTITY(1,1) NOT NULL,
	[Socio] [int] NULL,
	[Fecha] [datetime] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[certiva]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[certiva](
	[Item] [int] NULL,
	[detalle] [varchar](max) NULL,
	[codaseg] [int] NULL,
	[nfile] [varchar](21) NULL,
	[socio] [int] NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Chequeras]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Chequeras](
	[Item] [int] IDENTITY(1,1) NOT NULL,
	[Concepto] [int] NULL,
	[FechaMovimiento] [datetime] NULL,
	[NroPrimerCheque] [numeric](18, 0) NULL,
	[CantCheques] [int] NULL,
	[UltimoChequeEmitido] [numeric](18, 0) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Cierrejulio]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Cierrejulio](
	[Modo] [int] NOT NULL,
	[idCampoEA] [int] NOT NULL,
	[notas] [varchar](20) NULL,
	[articulo] [varchar](15) NULL,
	[docum] [int] NULL,
	[fecha] [datetime] NULL,
	[descripcion] [varchar](19) NULL,
	[Cantidad] [numeric](31, 2) NULL,
	[precio] [numeric](20, 4) NULL,
	[subtotalDolares] [numeric](38, 4) NULL,
	[Pesos] [numeric](38, 6) NULL,
	[tipomovimiento] [int] NULL,
	[idobra] [int] NULL,
	[razonSocial] [nvarchar](60) NULL,
	[idProveedor] [int] NULL,
	[fcProv] [int] NULL,
	[fechaFc] [datetime] NULL,
	[Observacion] [varchar](10) NULL,
	[idcampoAnexo] [int] NULL,
	[idcampo] [int] NULL,
	[idoperacion] [int] NULL,
	[RazonSocialProveedor] [nvarchar](60) NULL,
	[nombreAvion] [varchar](25) NULL,
	[matricula] [varchar](15) NULL,
	[tabla] [int] NOT NULL,
	[Moneda] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Claves]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Claves](
	[Clave] [char](10) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Cobradores]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Cobradores](
	[cobrador] [int] NOT NULL,
	[nombre] [varchar](50) NULL,
	[serie] [char](5) NULL,
	[importe] [numeric](18, 2) NULL,
	[global] [char](1) NULL,
	[Honorarios] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CodigoCuitPaises]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CodigoCuitPaises](
	[Cuit] [nvarchar](50) NULL,
	[paisDetalle] [nvarchar](120) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CodigosActividades]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CodigosActividades](
	[codigoactividad] [int] NOT NULL,
	[descripcion] [varchar](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Comisionistas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Comisionistas](
	[idContacto] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [varchar](50) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Comisionistas1]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Comisionistas1](
	[idContacto] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [varchar](50) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Comisionistas2]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Comisionistas2](
	[idContacto] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [varchar](50) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CompFondosHeaderAnulados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CompFondosHeaderAnulados](
	[idtransaccion] [int] NOT NULL,
	[comprobante] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[fecha] [datetime] NOT NULL,
	[proveedor] [int] NOT NULL,
	[tipocomprobante] [int] NOT NULL,
	[nrocomprobante] [char](12) NOT NULL,
	[tipofactura] [char](1) NULL,
	[totalimporte] [numeric](18, 2) NOT NULL,
	[cancelado] [numeric](18, 2) NULL,
	[fecha1venc] [datetime] NULL,
	[fecha2venc] [datetime] NULL,
	[estado] [char](1) NOT NULL,
	[fechareal] [datetime] NOT NULL,
	[centrocosto] [int] NULL,
	[fechaAnulacion] [datetime] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CompFondosHeaderTemp]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CompFondosHeaderTemp](
	[computer] [varchar](100) NOT NULL,
	[itemfondo] [int] NOT NULL,
	[idtransaccion] [int] NOT NULL,
	[comprobante] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[fecha] [datetime] NOT NULL,
	[proveedor] [int] NOT NULL,
	[tipocomprobante] [int] NOT NULL,
	[nrocomprobante] [char](12) NOT NULL,
	[tipofactura] [char](1) NULL,
	[totalimporte] [numeric](18, 2) NOT NULL,
	[cancelado] [numeric](18, 2) NULL,
	[fecha1venc] [datetime] NULL,
	[fecha2venc] [datetime] NULL,
	[estado] [char](1) NOT NULL,
	[fechareal] [datetime] NOT NULL,
	[centrocosto] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CompFondosItemsanulados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CompFondosItemsanulados](
	[comprobante] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[item] [int] NOT NULL,
	[concepto] [char](3) NOT NULL,
	[importe] [numeric](18, 2) NOT NULL,
	[cuentaneto] [int] NOT NULL,
	[neto] [numeric](18, 2) NOT NULL,
	[cuentamonto] [int] NOT NULL,
	[monto] [numeric](18, 2) NOT NULL,
	[base] [numeric](18, 2) NULL,
	[idtransaccion] [int] NULL,
	[alicuota] [numeric](18, 2) NULL,
	[area] [int] NULL,
	[FechaCierre] [datetime] NULL,
	[Factura] [varchar](20) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CompFondosItemsTemp]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CompFondosItemsTemp](
	[computer] [varchar](100) NOT NULL,
	[itemfondo] [int] NOT NULL,
	[comprobante] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[item] [int] NOT NULL,
	[concepto] [char](3) NOT NULL,
	[importe] [numeric](18, 2) NOT NULL,
	[cuentaneto] [int] NOT NULL,
	[neto] [numeric](18, 2) NOT NULL,
	[cuentamonto] [int] NOT NULL,
	[monto] [numeric](18, 2) NOT NULL,
	[base] [numeric](18, 2) NULL,
	[idtransaccion] [int] NULL,
	[alicuota] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ComplementoAnses]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ComplementoAnses](
	[AnioMes] [char](6) NULL,
	[Socio] [int] NULL,
	[MesaImputar] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ComplementoEnero06]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ComplementoEnero06](
	[idliquidacion] [int] NOT NULL,
	[Legajo] [int] NULL,
	[Item] [int] NOT NULL,
	[Concepto] [int] NULL,
	[Horas] [decimal](18, 2) NULL,
	[Importe] [decimal](18, 2) NULL,
	[TipoCalculo] [char](1) NULL,
	[origen] [char](1) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ComplementoHospitales]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ComplementoHospitales](
	[AnioMes] [char](6) NULL,
	[Socio] [int] NULL,
	[MesaImputar] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ComplementoTarjetasCredito]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ComplementoTarjetasCredito](
	[AnioMes] [char](6) NULL,
	[Socio] [int] NULL,
	[MesaImputar] [int] NULL,
	[Entidad] [int] NULL,
	[Importe] [numeric](18, 2) NULL,
	[Tarjeta] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CompProvHeaderAnulados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CompProvHeaderAnulados](
	[idtransaccion] [int] NOT NULL,
	[comprobante] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[fecha] [datetime] NOT NULL,
	[proveedor] [int] NOT NULL,
	[tipocomprobante] [int] NOT NULL,
	[nrocomprobante] [char](12) NOT NULL,
	[tipofactura] [char](1) NULL,
	[totalimporte] [numeric](18, 2) NOT NULL,
	[cancelado] [numeric](18, 2) NULL,
	[fecha1venc] [datetime] NULL,
	[fecha2venc] [datetime] NULL,
	[estado] [char](1) NOT NULL,
	[fechareal] [datetime] NOT NULL,
	[centrocosto] [int] NULL,
	[DescripcionImporte] [varchar](255) NULL,
	[Moneda] [int] NULL,
	[ImporteOrigen] [numeric](18, 2) NULL,
	[TC] [numeric](18, 3) NULL,
	[doc_c] [numeric](18, 0) NULL,
	[CanceladoOrigen] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[compProvHeaderBak]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[compProvHeaderBak](
	[idtransaccion] [int] IDENTITY(1,1) NOT NULL,
	[comprobante] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[fecha] [datetime] NOT NULL,
	[proveedor] [int] NOT NULL,
	[tipocomprobante] [int] NOT NULL,
	[nrocomprobante] [char](12) NOT NULL,
	[tipofactura] [char](1) NULL,
	[totalimporte] [numeric](18, 2) NOT NULL,
	[cancelado] [numeric](18, 2) NULL,
	[fecha1venc] [datetime] NULL,
	[fecha2venc] [datetime] NULL,
	[estado] [char](1) NOT NULL,
	[fechareal] [datetime] NOT NULL,
	[centrocosto] [int] NULL,
	[DescripcionImporte] [varchar](255) NULL,
	[Moneda] [int] NULL,
	[ImporteOrigen] [numeric](18, 2) NULL,
	[TC] [numeric](18, 3) NULL,
	[doc_c] [numeric](18, 0) NULL,
	[CanceladoOrigen] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CompProvItemsAnulados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CompProvItemsAnulados](
	[idTransaccion] [int] NULL,
	[comprobante] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[item] [int] NOT NULL,
	[concepto] [char](3) NOT NULL,
	[cuenta] [int] NOT NULL,
	[importe] [numeric](18, 4) NOT NULL,
	[BaseContable] [numeric](18, 2) NOT NULL,
	[Area] [int] NULL,
	[Detalle] [varchar](60) NULL,
	[Alicuota] [numeric](18, 2) NOT NULL,
	[Grilla] [varchar](30) NULL,
	[idCampo] [int] NOT NULL,
	[Base] [numeric](18, 2) NULL,
	[FechaCierre] [datetime] NULL,
	[Factura] [varchar](20) NULL,
	[Fecha] [datetime] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[comprobantescuentascorrientes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[comprobantescuentascorrientes](
	[Comprobante] [char](3) NOT NULL,
	[Descripcion] [char](30) NOT NULL,
	[idTipodeMovimiento] [int] NOT NULL,
	[signo] [numeric](18, 0) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CompTarjetas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CompTarjetas](
	[Tarjeta] [float] NULL,
	[Modo] [nvarchar](255) NULL,
	[Periodo] [float] NULL,
	[Entidad] [float] NULL,
	[Socio] [float] NULL,
	[Aniomes] [float] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Conceptos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Conceptos](
	[Concepto] [char](3) NOT NULL,
	[Entidad] [tinyint] NOT NULL,
	[Descripcion] [char](30) NULL,
	[Modalidad] [char](1) NULL,
	[Importe] [numeric](18, 2) NULL,
	[mes] [int] NULL,
	[ano] [int] NULL,
	[Imputacion_Contable] [int] NULL,
	[Seguro] [int] NULL,
	[Grupo] [char](1) NULL,
	[Concepto_Muni] [char](3) NULL,
	[Modalidad_Muni] [char](1) NULL,
	[Importe_Muni] [numeric](18, 2) NULL,
	[idconcepto] [int] IDENTITY(1,1) NOT NULL,
	[Cobertura] [numeric](18, 0) NULL,
	[Comision] [numeric](18, 2) NULL,
	[idCobertura] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Conceptos_adherentes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Conceptos_adherentes](
	[Adherente] [int] NOT NULL,
	[Concepto] [char](3) NOT NULL,
	[FechaAlta] [datetime] NULL,
	[FecHaVigencia] [datetime] NULL,
	[FechaBaja] [datetime] NULL,
	[MotivoBaja] [int] NULL,
	[idCampo] [int] IDENTITY(1,1) NOT NULL,
	[Activo] [int] NULL,
	[Fecha_movimiento] [datetime] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Conceptos_Aumento]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Conceptos_Aumento](
	[Concepto] [char](3) NOT NULL,
	[Entidad] [tinyint] NOT NULL,
	[Descripcion] [char](30) NULL,
	[Modalidad] [char](1) NULL,
	[Importe] [numeric](18, 2) NULL,
	[mes] [int] NULL,
	[ano] [int] NULL,
	[Imputacion_Contable] [int] NULL,
	[Seguro] [int] NULL,
	[Grupo] [char](1) NULL,
	[Concepto_Muni] [char](3) NULL,
	[Modalidad_Muni] [char](1) NULL,
	[Importe_Muni] [numeric](18, 2) NULL,
	[idconcepto] [int] IDENTITY(1,1) NOT NULL,
	[idCobertura] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Conceptos_Profesionales]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Conceptos_Profesionales](
	[socio] [int] NOT NULL,
	[Concepto] [char](3) NOT NULL,
	[FechaAlta] [datetime] NULL,
	[FecHaVigencia] [datetime] NULL,
	[Importe] [numeric](18, 2) NULL,
	[FechaBaja] [datetime] NULL,
	[MotivoBaja] [int] NULL,
	[idCampo] [int] IDENTITY(1,1) NOT NULL,
	[Activo] [int] NULL,
	[Cuotas] [int] NULL,
	[Moneda] [int] NULL,
	[idCampoTarjeta] [int] NULL,
	[Rechazos] [int] NULL,
	[Presentadas] [int] NULL,
	[TipoCambio] [numeric](18, 2) NULL,
	[ValorOrigen] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Conceptos_Sindicatos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Conceptos_Sindicatos](
	[sindicato] [int] NOT NULL,
	[concepto] [int] NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Conceptos_Socios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Conceptos_Socios](
	[socio] [int] NOT NULL,
	[Concepto] [char](3) NOT NULL,
	[FechaAlta] [datetime] NULL,
	[FecHaVigencia] [datetime] NULL,
	[Importe] [numeric](18, 2) NULL,
	[FechaBaja] [datetime] NULL,
	[MotivoBaja] [int] NULL,
	[idCampo] [int] IDENTITY(1,1) NOT NULL,
	[Activo] [int] NULL,
	[Cuotas] [int] NULL,
	[Moneda] [int] NULL,
	[idCampoTarjeta] [int] NULL,
	[Rechazos] [int] NULL,
	[Presentadas] [int] NULL,
	[TipoCambio] [numeric](18, 2) NULL,
	[ValorOrigen] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Conceptos_tesoreria]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Conceptos_tesoreria](
	[idConcepto_Tesoreria] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [char](25) NULL,
	[Imputacion_Contable] [int] NULL,
	[Modalidad] [int] NULL,
	[CI] [char](1) NULL,
	[CE] [char](1) NULL,
	[Unificador] [int] NULL,
	[Mostrador] [int] NULL,
	[MonedaExtranjera] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ConceptosContables]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ConceptosContables](
	[concepto] [char](3) NOT NULL,
	[descripcion] [varchar](30) NULL,
	[alicuota] [numeric](6, 2) NULL,
	[cuenta] [int] NULL,
	[cCompras] [int] NULL,
	[cVentas] [int] NULL,
	[ConceptoVentas] [varchar](3) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ConceptosFechasLegajos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ConceptosFechasLegajos](
	[concepto] [int] NOT NULL,
	[descripcion] [varchar](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ConceptosImpuestos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ConceptosImpuestos](
	[concepto] [int] IDENTITY(1,1) NOT NULL,
	[descripcion] [varchar](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ConceptosLegajos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ConceptosLegajos](
	[legajo] [int] NOT NULL,
	[orden] [int] NOT NULL,
	[concepto] [int] NOT NULL,
	[importe] [numeric](18, 2) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ConceptosLegajosNovedades]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ConceptosLegajosNovedades](
	[legajo] [int] NOT NULL,
	[orden] [int] NOT NULL,
	[concepto] [int] NOT NULL,
	[importe] [numeric](18, 2) NOT NULL,
	[AnioMes] [int] NOT NULL,
	[Periodo] [int] NOT NULL,
	[Tipo] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ConceptosLegajosNovedadesAguinaldo]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ConceptosLegajosNovedadesAguinaldo](
	[legajo] [int] NOT NULL,
	[orden] [int] NOT NULL,
	[concepto] [int] NOT NULL,
	[importe] [numeric](18, 2) NOT NULL,
	[AnioMes] [int] NULL,
	[Periodo] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ConceptosLiquidacion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ConceptosLiquidacion](
	[concepto] [int] NOT NULL,
	[descripcion] [varchar](25) NULL,
	[tipoconcepto] [int] NULL,
	[modo] [int] NULL,
	[cuentacontable] [int] NULL,
	[LegajosAplicables] [char](1) NULL,
	[Periodo] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ConceptosLiquidacionDetalle]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ConceptosLiquidacionDetalle](
	[codigo] [int] NOT NULL,
	[grupo] [int] NOT NULL,
	[concepto] [int] NOT NULL,
	[operador1] [int] NOT NULL,
	[constante1] [int] NOT NULL,
	[operador2] [int] NOT NULL,
	[constante2] [int] NOT NULL,
	[operador3] [int] NOT NULL,
	[constante3] [int] NOT NULL,
	[operador4] [int] NOT NULL,
	[constante4] [int] NOT NULL,
	[signo] [int] NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ConceptosRemunerativos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ConceptosRemunerativos](
	[concepto] [int] IDENTITY(1,1) NOT NULL,
	[descripcion] [varchar](21) NULL,
	[tipoconcepto] [int] NULL,
	[modo] [int] NULL,
	[cuentacontable] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Condiciones]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Condiciones](
	[condicion] [int] NOT NULL,
	[descripcion] [varchar](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[condicionesventa]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[condicionesventa](
	[cventa] [int] IDENTITY(0,1) NOT NULL,
	[Descripcion] [varchar](30) NULL,
	[dias] [int] NULL,
	[dias2] [int] NULL,
	[dias3] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ConstantesLiquidacion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ConstantesLiquidacion](
	[constante] [int] IDENTITY(1,1) NOT NULL,
	[descripcion] [varchar](20) NULL,
	[valor] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Contactos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Contactos](
	[idcontacto] [int] IDENTITY(1,1) NOT NULL,
	[nombre] [varchar](30) NULL,
	[telefono] [varchar](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ContactosClientes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ContactosClientes](
	[idContacto] [int] IDENTITY(1,1) NOT NULL,
	[Codigo] [int] NULL,
	[nyap] [nvarchar](50) NULL,
	[Sector] [nvarchar](60) NULL,
	[telefono] [nvarchar](50) NULL,
	[mail] [nvarchar](50) NULL,
	[observacion] [nvarchar](60) NULL,
	[Nacido] [datetime] NULL,
	[Sucursal] [varchar](60) NULL,
	[Cargo] [varchar](60) NULL,
	[Alta] [datetime] NULL,
	[baja] [datetime] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ContactosProveedores]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ContactosProveedores](
	[idContacto] [int] IDENTITY(1,1) NOT NULL,
	[Codigo] [int] NULL,
	[nyap] [nvarchar](50) NULL,
	[Sector] [nvarchar](60) NULL,
	[telefono] [nvarchar](50) NULL,
	[mail] [nvarchar](50) NULL,
	[observacion] [nvarchar](60) NULL,
	[Nacido] [datetime] NULL,
	[Sucursal] [varchar](60) NULL,
	[Cargo] [varchar](60) NULL,
	[Alta] [datetime] NULL,
	[baja] [datetime] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Contador]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Contador](
	[idCount] [int] IDENTITY(1,1) NOT NULL,
	[bla] [char](1) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[controlaDiario]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[controlaDiario](
	[Cuenta] [int] NOT NULL,
	[Debe] [numeric](38, 2) NULL,
	[Haber] [numeric](38, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[controlMayor]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[controlMayor](
	[fecha] [datetime] NOT NULL,
	[Comp] [char](5) NOT NULL,
	[nrocomprobante] [varchar](13) NULL,
	[tipofactura] [char](1) NULL,
	[razonsocial] [varchar](30) NULL,
	[cuit] [char](14) NULL,
	[dciva] [char](4) NULL,
	[total] [numeric](29, 2) NULL,
	[Neto] [numeric](38, 2) NOT NULL,
	[Exento] [numeric](38, 2) NOT NULL,
	[Iva] [numeric](38, 2) NOT NULL,
	[NG21] [numeric](38, 2) NOT NULL,
	[Iva27] [numeric](38, 2) NOT NULL,
	[NG27] [numeric](38, 2) NOT NULL,
	[Iva10] [numeric](38, 2) NOT NULL,
	[NG105] [numeric](38, 2) NOT NULL,
	[NG0] [numeric](38, 2) NOT NULL,
	[Iva5] [numeric](38, 2) NOT NULL,
	[PibC] [numeric](38, 2) NOT NULL,
	[PIV] [numeric](38, 2) NOT NULL,
	[PIB] [numeric](38, 2) NOT NULL,
	[PGI] [numeric](38, 2) NOT NULL,
	[PAB] [numeric](38, 2) NOT NULL,
	[PAC] [numeric](38, 2) NOT NULL,
	[PBB] [numeric](38, 2) NOT NULL,
	[PBC] [numeric](38, 2) NOT NULL,
	[II] [numeric](38, 2) NOT NULL,
	[BII] [numeric](38, 2) NOT NULL,
	[GSI] [numeric](38, 2) NOT NULL,
	[Monotributo] [numeric](38, 2) NOT NULL,
	[idoperacion] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ControlOP]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ControlOP](
	[fecha] [datetime] NOT NULL,
	[TP] [char](5) NOT NULL,
	[nrocomprobante] [char](12) NOT NULL,
	[PV] [varchar](4) NULL,
	[NCO] [varchar](8) NULL,
	[tipofactura] [char](1) NULL,
	[Debe] [numeric](18, 2) NOT NULL,
	[Haber] [int] NOT NULL,
	[SALDO] [int] NOT NULL,
	[cancelado] [numeric](18, 2) NULL,
	[Vencimiento] [datetime] NULL,
	[serie] [int] NOT NULL,
	[idTransaccion] [int] NOT NULL,
	[Proveedor] [int] NOT NULL,
	[signo] [int] NULL,
	[idOperacion] [int] NOT NULL,
	[Asiento] [int] NOT NULL,
	[tipoasiento] [int] NULL,
	[fecha1venc] [datetime] NULL,
	[fecha2venc] [datetime] NULL,
	[DolaresDebe] [numeric](18, 2) NULL,
	[DolaresHaber] [numeric](18, 2) NULL,
	[Moneda] [int] NULL,
	[tc] [numeric](18, 2) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[cphAjustado]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[cphAjustado](
	[idtransaccion] [int] NOT NULL,
	[comprobante] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[fecha] [datetime] NOT NULL,
	[proveedor] [int] NOT NULL,
	[tipocomprobante] [int] NOT NULL,
	[nrocomprobante] [char](12) NOT NULL,
	[tipofactura] [char](1) NULL,
	[totalimporte] [numeric](18, 2) NOT NULL,
	[cancelado] [numeric](18, 2) NULL,
	[fecha1venc] [datetime] NULL,
	[fecha2venc] [datetime] NULL,
	[estado] [char](1) NOT NULL,
	[fechareal] [datetime] NOT NULL,
	[centrocosto] [int] NULL,
	[DescripcionImporte] [varchar](255) NULL,
	[Moneda] [int] NULL,
	[ImporteOrigen] [numeric](18, 2) NULL,
	[TC] [numeric](18, 3) NULL,
	[doc_c] [numeric](18, 0) NULL,
	[CanceladoOrigen] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[cphCeros]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[cphCeros](
	[idtransaccion] [int] IDENTITY(1,1) NOT NULL,
	[comprobante] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[fecha] [datetime] NOT NULL,
	[proveedor] [int] NOT NULL,
	[tipocomprobante] [int] NOT NULL,
	[nrocomprobante] [char](12) NOT NULL,
	[tipofactura] [char](1) NULL,
	[totalimporte] [numeric](18, 2) NOT NULL,
	[cancelado] [numeric](18, 2) NULL,
	[fecha1venc] [datetime] NULL,
	[fecha2venc] [datetime] NULL,
	[estado] [char](1) NOT NULL,
	[fechareal] [datetime] NOT NULL,
	[centrocosto] [int] NULL,
	[DescripcionImporte] [varchar](255) NULL,
	[Moneda] [int] NULL,
	[ImporteOrigen] [numeric](18, 2) NULL,
	[TC] [numeric](18, 3) NULL,
	[doc_c] [numeric](18, 0) NULL,
	[CanceladoOrigen] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[cphDolPes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[cphDolPes](
	[idtransaccion] [int] IDENTITY(1,1) NOT NULL,
	[comprobante] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[fecha] [datetime] NOT NULL,
	[proveedor] [int] NOT NULL,
	[tipocomprobante] [int] NOT NULL,
	[nrocomprobante] [char](12) NOT NULL,
	[tipofactura] [char](1) NULL,
	[totalimporte] [numeric](18, 2) NOT NULL,
	[cancelado] [numeric](18, 2) NULL,
	[fecha1venc] [datetime] NULL,
	[fecha2venc] [datetime] NULL,
	[estado] [char](1) NOT NULL,
	[fechareal] [datetime] NOT NULL,
	[centrocosto] [int] NULL,
	[DescripcionImporte] [varchar](255) NULL,
	[Moneda] [int] NULL,
	[ImporteOrigen] [numeric](18, 2) NULL,
	[TC] [numeric](18, 2) NULL,
	[doc_c] [numeric](18, 0) NULL,
	[CanceladoOrigen] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[cPolizas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[cPolizas](
	[idPoliza] [int] NOT NULL,
	[Concepto] [char](3) NULL,
	[Desde] [datetime] NULL,
	[Hasta] [datetime] NULL,
	[Descripcion] [char](25) NULL,
	[Poliza] [char](75) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[cprovRetenciones]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[cprovRetenciones](
	[idtransaccion] [int] NOT NULL,
	[comprobante] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[fecha] [datetime] NOT NULL,
	[proveedor] [int] NOT NULL,
	[tipocomprobante] [int] NOT NULL,
	[nrocomprobante] [char](12) NOT NULL,
	[tipofactura] [char](1) NULL,
	[totalimporte] [numeric](18, 2) NOT NULL,
	[cancelado] [numeric](18, 2) NULL,
	[fecha1venc] [datetime] NULL,
	[fecha2venc] [datetime] NULL,
	[estado] [char](1) NOT NULL,
	[fechareal] [datetime] NOT NULL,
	[centrocosto] [int] NULL,
	[DescripcionImporte] [varchar](255) NULL,
	[Moneda] [int] NULL,
	[ImporteOrigen] [numeric](18, 2) NULL,
	[TC] [numeric](18, 2) NULL,
	[doc_c] [numeric](18, 0) NULL,
	[CanceladoOrigen] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ctaCteaHistorico26032023]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ctaCteaHistorico26032023](
	[IdTransaccion] [int] NOT NULL,
	[socio] [int] NOT NULL,
	[Entidad] [int] NOT NULL,
	[Fecha] [datetime] NOT NULL,
	[Concepto] [char](3) NOT NULL,
	[PuntodeVenta] [char](14) NULL,
	[DocumentoNumero] [char](14) NULL,
	[FechaRendicion] [datetime] NULL,
	[Rendicion] [varchar](20) NULL,
	[importe] [numeric](18, 2) NULL,
	[Cancelado] [numeric](18, 2) NULL,
	[vencimiento] [datetime] NULL,
	[Cobrador] [int] NULL,
	[Serie] [varchar](50) NULL,
	[idCancelada] [numeric](18, 0) NULL,
	[idOpCobrador] [numeric](18, 0) NULL,
	[rg1] [varchar](100) NULL,
	[rg2] [varchar](100) NULL,
	[rg3] [varchar](100) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ctaVisa]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ctaVisa](
	[Fecha] [datetime] NOT NULL,
	[Descripcion] [varchar](25) NOT NULL,
	[cliente] [int] NOT NULL,
	[razonsocial] [nvarchar](60) NULL,
	[NroComprobante] [char](12) NOT NULL,
	[Debe] [numeric](38, 2) NULL,
	[Haber] [numeric](38, 2) NULL,
	[Saldo] [numeric](38, 2) NULL,
	[DebeDolares] [numeric](38, 2) NULL,
	[HaberDolares] [numeric](38, 2) NULL,
	[SaldoDolares] [numeric](38, 2) NULL,
	[DebeContable] [numeric](38, 2) NULL,
	[HaberContable] [numeric](38, 2) NULL,
	[SaldoContable] [numeric](38, 2) NULL,
	[idtransaccion] [int] NOT NULL,
	[domicilio] [nvarchar](40) NULL,
	[localidad] [nvarchar](40) NULL,
	[telefono1] [nvarchar](40) NULL,
	[telefono2] [nvarchar](40) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[cuentas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[cuentas](
	[cuenta] [int] NOT NULL,
	[descripcion] [char](35) NULL,
	[corta] [int] NULL,
	[sigla] [char](5) NULL,
	[Resumida] [char](10) NULL,
	[tipocuentaContable] [tinyint] NULL,
	[imputable] [tinyint] NULL,
	[Rubro] [int] NULL,
	[subrubro] [int] NULL,
	[UBBalance] [int] NULL,
	[UBResultado] [int] NULL,
	[CLResultado] [int] NULL,
 CONSTRAINT [PK_cuentas] PRIMARY KEY CLUSTERED 
(
	[cuenta] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CuentasCorrientes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CuentasCorrientes](
	[IdTransaccion] [int] IDENTITY(1,1) NOT NULL,
	[socio] [int] NOT NULL,
	[Entidad] [int] NOT NULL,
	[Fecha] [datetime] NOT NULL,
	[Concepto] [char](3) NOT NULL,
	[PuntodeVenta] [char](14) NULL,
	[DocumentoNumero] [char](14) NULL,
	[FechaRendicion] [datetime] NULL,
	[Rendicion] [varchar](20) NULL,
	[importe] [numeric](18, 2) NULL,
	[Cancelado] [numeric](18, 2) NULL,
	[vencimiento] [datetime] NULL,
	[Cobrador] [int] NULL,
	[Serie] [varchar](50) NULL,
	[idCancelada] [numeric](18, 0) NULL,
	[idOpCobrador] [numeric](18, 0) NULL,
	[rg1] [varchar](100) NULL,
	[rg2] [varchar](100) NULL,
	[rg3] [varchar](100) NULL,
 CONSTRAINT [PK_CuentasCorrientes] PRIMARY KEY CLUSTERED 
(
	[IdTransaccion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[cuentascorrientes_bak_20240410]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[cuentascorrientes_bak_20240410](
	[IdTransaccion] [int] IDENTITY(1,1) NOT NULL,
	[socio] [int] NOT NULL,
	[Entidad] [int] NOT NULL,
	[Fecha] [datetime] NOT NULL,
	[Concepto] [char](3) NOT NULL,
	[PuntodeVenta] [char](14) NULL,
	[DocumentoNumero] [char](14) NULL,
	[FechaRendicion] [datetime] NULL,
	[Rendicion] [varchar](20) NULL,
	[importe] [numeric](18, 2) NULL,
	[Cancelado] [numeric](18, 2) NULL,
	[vencimiento] [datetime] NULL,
	[Cobrador] [int] NULL,
	[Serie] [varchar](50) NULL,
	[idCancelada] [numeric](18, 0) NULL,
	[idOpCobrador] [numeric](18, 0) NULL,
	[rg1] [varchar](100) NULL,
	[rg2] [varchar](100) NULL,
	[rg3] [varchar](100) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CuentasCorrientesAnuladas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CuentasCorrientesAnuladas](
	[IdTransaccion] [int] NOT NULL,
	[socio] [int] NOT NULL,
	[Entidad] [int] NOT NULL,
	[Fecha] [datetime] NOT NULL,
	[Concepto] [char](3) NOT NULL,
	[PuntodeVenta] [char](14) NULL,
	[DocumentoNumero] [char](14) NULL,
	[FechaRendicion] [datetime] NULL,
	[Rendicion] [char](14) NULL,
	[importe] [numeric](18, 2) NULL,
	[Cancelado] [numeric](18, 2) NULL,
	[vencimiento] [datetime] NULL,
	[Cobrador] [int] NULL,
	[Serie] [char](10) NULL,
	[idCancelada] [numeric](18, 0) NULL,
	[idOpCobrador] [numeric](18, 0) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CuentasCorrientesCursosCambios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CuentasCorrientesCursosCambios](
	[IdTransaccion] [int] NOT NULL,
	[socio] [int] NOT NULL,
	[Entidad] [int] NOT NULL,
	[Fecha] [datetime] NOT NULL,
	[Concepto] [char](3) NOT NULL,
	[PuntodeVenta] [char](14) NULL,
	[DocumentoNumero] [char](14) NULL,
	[FechaRendicion] [datetime] NULL,
	[Rendicion] [char](14) NULL,
	[importe] [numeric](18, 2) NULL,
	[Cancelado] [numeric](18, 2) NULL,
	[vencimiento] [datetime] NULL,
	[Cobrador] [int] NULL,
	[Serie] [char](10) NULL,
	[idCancelada] [numeric](18, 0) NULL,
	[idOpCobrador] [numeric](18, 0) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CuentasCorrientesDA]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CuentasCorrientesDA](
	[IdTransaccion] [int] NOT NULL,
	[socio] [int] NOT NULL,
	[Entidad] [int] NOT NULL,
	[Fecha] [datetime] NOT NULL,
	[Concepto] [char](3) NOT NULL,
	[PuntodeVenta] [char](14) NULL,
	[DocumentoNumero] [char](14) NULL,
	[FechaRendicion] [datetime] NULL,
	[Rendicion] [char](14) NULL,
	[importe] [numeric](18, 2) NULL,
	[Cancelado] [numeric](18, 2) NULL,
	[vencimiento] [datetime] NULL,
	[Cobrador] [int] NULL,
	[Serie] [char](10) NULL,
	[idCancelada] [numeric](18, 0) NULL,
	[idOpCobrador] [numeric](18, 0) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CuentasCorrientesHistorico]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CuentasCorrientesHistorico](
	[IdTransaccion] [int] IDENTITY(1,1) NOT NULL,
	[socio] [int] NOT NULL,
	[Entidad] [int] NOT NULL,
	[Fecha] [datetime] NOT NULL,
	[Concepto] [char](3) NOT NULL,
	[PuntodeVenta] [char](14) NULL,
	[DocumentoNumero] [char](14) NULL,
	[FechaRendicion] [datetime] NULL,
	[Rendicion] [varchar](20) NULL,
	[importe] [numeric](18, 2) NULL,
	[Cancelado] [numeric](18, 2) NULL,
	[vencimiento] [datetime] NULL,
	[Cobrador] [int] NULL,
	[Serie] [varchar](50) NULL,
	[idCancelada] [numeric](18, 0) NULL,
	[idOpCobrador] [numeric](18, 0) NULL,
	[rg1] [varchar](100) NULL,
	[rg2] [varchar](100) NULL,
	[rg3] [varchar](100) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Cuentascorrientestransaccionduplicados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Cuentascorrientestransaccionduplicados](
	[IdTransaccion] [int] IDENTITY(1,1) NOT NULL,
	[socio] [int] NOT NULL,
	[Entidad] [int] NOT NULL,
	[Fecha] [datetime] NOT NULL,
	[Concepto] [char](3) NOT NULL,
	[PuntodeVenta] [char](14) NULL,
	[DocumentoNumero] [char](14) NULL,
	[FechaRendicion] [datetime] NULL,
	[Rendicion] [varchar](20) NULL,
	[importe] [numeric](18, 2) NULL,
	[Cancelado] [numeric](18, 2) NULL,
	[vencimiento] [datetime] NULL,
	[Cobrador] [int] NULL,
	[Serie] [varchar](50) NULL,
	[idCancelada] [numeric](18, 0) NULL,
	[idOpCobrador] [numeric](18, 0) NULL,
	[rg1] [varchar](100) NULL,
	[rg2] [varchar](100) NULL,
	[rg3] [varchar](100) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[CuilsFE]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CuilsFE](
	[CodigoCuit] [nvarchar](50) NULL,
	[PaisFex] [int] NULL,
	[NombrePais] [nvarchar](50) NULL,
	[TipoCuit] [int] NOT NULL,
	[paisDetalle] [nvarchar](120) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[datospresupuesto]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[datospresupuesto](
	[idoperacion] [int] NOT NULL,
	[fecha] [datetime] NULL,
	[dias] [int] NULL,
	[vencimiento] [datetime] NULL,
	[observacion] [varchar](4000) NULL,
	[Numero] [int] NULL,
 CONSTRAINT [PK_datospresupuesto] PRIMARY KEY CLUSTERED 
(
	[idoperacion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[DatosVentaAnulados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DatosVentaAnulados](
	[idOperacion] [int] NULL,
	[Bonificacion] [numeric](18, 2) NULL,
	[contacto1] [int] NULL,
	[contacto2] [int] NULL,
	[contacto3] [int] NULL,
	[fPago] [int] NULL,
	[Numero] [int] NULL,
	[TC] [numeric](18, 2) NULL,
	[idVendedor] [int] NULL,
	[idCvta] [int] NULL,
	[idTransporte] [int] NULL,
	[Remito] [int] NULL,
	[Factura] [int] NULL,
	[Bultos] [int] NULL,
	[vDeclarado] [numeric](18, 2) NULL,
	[oCompra] [varchar](50) NULL,
	[idLeyenda] [int] NULL,
	[NetoGravado] [numeric](18, 2) NULL,
	[vigencia] [datetime] NULL,
	[vs] [tinyint] NULL,
	[NC] [varchar](50) NULL,
	[comision] [int] NULL,
	[idMatricula] [int] NULL,
	[idObra] [int] NULL,
	[Dias] [int] NULL,
	[coeficiente] [numeric](18, 2) NULL,
	[taxi] [int] NULL,
	[Mat] [int] NULL,
	[MO] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[debehaberigual]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[debehaberigual](
	[asiento] [int] NOT NULL,
	[item] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[tipoasiento] [int] NOT NULL,
	[cuenta] [int] NOT NULL,
	[debe] [numeric](18, 2) NULL,
	[haber] [numeric](18, 2) NULL,
	[observacion] [varchar](50) NULL,
	[centrocosto] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Depositos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Depositos](
	[idDeposito] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [varchar](20) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[depositosheader]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[depositosheader](
	[deposito] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[fecha] [datetime] NOT NULL,
	[banco] [int] NULL,
	[numero] [int] NULL,
	[total] [numeric](18, 2) NOT NULL,
	[efectivo] [numeric](18, 2) NOT NULL,
	[clearing] [int] NULL,
	[conceptotesoreria] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[depositositems]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[depositositems](
	[deposito] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[item] [int] NOT NULL,
	[fecha] [datetime] NULL,
	[banco] [int] NULL,
	[sucursal] [int] NULL,
	[nrocheque] [int] NULL,
	[importe] [numeric](18, 2) NOT NULL,
	[checked] [bit] NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Despachantes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Despachantes](
	[idDespachante] [int] IDENTITY(0,1) NOT NULL,
	[Nombre] [varchar](50) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Despachos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Despachos](
	[idDespacho] [int] IDENTITY(0,1) NOT NULL,
	[Despacho] [varchar](50) NULL,
	[Fecha] [datetime] NULL,
	[idAduana] [int] NULL,
	[idProcedencia] [int] NULL,
	[idDespachante] [int] NULL,
	[awb] [varchar](50) NULL,
	[Observaciones] [varchar](255) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Detalle_CodigosGanancias]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Detalle_CodigosGanancias](
	[Codigo] [int] NULL,
	[Item] [int] IDENTITY(1,1) NOT NULL,
	[Impo_Desde] [numeric](18, 2) NULL,
	[Impo_Hasta] [numeric](18, 2) NULL,
	[Impo_Reten] [numeric](18, 2) NULL,
	[Porc_Reten] [numeric](18, 2) NULL,
	[Excedente] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Detalle_listas_ABM]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Detalle_listas_ABM](
	[idLista] [int] NOT NULL,
	[idArticulo] [int] NOT NULL,
	[Moneda] [int] NULL,
	[Neto] [numeric](18, 2) NULL,
	[Final] [numeric](18, 2) NULL,
	[redondeo] [tinyint] NULL,
	[Procesado] [datetime] NOT NULL,
	[idUsuario] [char](20) NULL,
	[Computer] [varchar](50) NULL,
 CONSTRAINT [PK_Detalle_listas_ABM] PRIMARY KEY CLUSTERED 
(
	[idLista] ASC,
	[idArticulo] ASC,
	[Procesado] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Detalle_Prestamos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Detalle_Prestamos](
	[Numero] [int] NULL,
	[Cuota] [int] NULL,
	[FechaVencimiento] [datetime] NULL,
	[CapitalCuota] [numeric](18, 2) NULL,
	[Interes] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Detalle_RecibosDA]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Detalle_RecibosDA](
	[idRecibo] [int] NOT NULL,
	[idtransaccion] [int] NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[DetalleCuentasCorrientes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DetalleCuentasCorrientes](
	[idTransaccion] [int] NOT NULL,
	[item] [int] NOT NULL,
	[Concepto] [char](3) NOT NULL,
	[Cantidad] [numeric](18, 2) NULL,
	[importe] [numeric](18, 2) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[DetalleCuentasCorrientesAnuladas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DetalleCuentasCorrientesAnuladas](
	[idTransaccion] [int] NOT NULL,
	[item] [int] NOT NULL,
	[Concepto] [char](3) NOT NULL,
	[Cantidad] [numeric](18, 2) NULL,
	[importe] [numeric](18, 2) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[DetalleCuentasCorrientesCursosCambios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DetalleCuentasCorrientesCursosCambios](
	[idTransaccion] [int] NOT NULL,
	[item] [int] NOT NULL,
	[Concepto] [char](3) NOT NULL,
	[Cantidad] [numeric](18, 2) NULL,
	[importe] [numeric](18, 2) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[DetalleOrdenesProduccion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DetalleOrdenesProduccion](
	[idCampo] [int] IDENTITY(1,1) NOT NULL,
	[idOrden] [int] NULL,
	[TipoMovimiento] [int] NULL,
	[Deposito] [int] NULL,
	[idarticulo] [int] NULL,
	[serial] [varchar](30) NULL,
	[cantidad] [numeric](18, 2) NULL,
	[Stock] [numeric](18, 2) NULL,
	[Vencimiento] [datetime] NULL,
	[idCampoOrigen] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[DetalleOtrosIngresos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DetalleOtrosIngresos](
	[Concepto] [char](8) NULL,
	[Aniomes] [int] NULL,
	[Asiento] [int] NULL,
	[Item] [int] NULL,
	[TipoAsiento] [int] NULL,
	[ApellidoNombre] [varchar](50) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Distribuidores]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Distribuidores](
	[idDistribuidor] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [nvarchar](255) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Dobles]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Dobles](
	[Periodo] [int] NULL,
	[adherente] [int] NULL,
	[cantidad] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[DomiciliosdeCobro]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DomiciliosdeCobro](
	[idDomicilio] [int] IDENTITY(1,1) NOT NULL,
	[Nombre] [char](30) NULL,
	[Calle] [char](30) NULL,
	[Numero] [int] NULL,
	[PisoDto] [char](30) NULL,
	[Localidad] [int] NULL,
	[Provincia] [int] NULL,
	[CodDomicilioCobroAnterior] [char](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Electronicos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Electronicos](
	[ID_Gestion] [int] IDENTITY(1,1) NOT NULL,
	[CAE] [varchar](50) NULL,
	[Vencimiento] [datetime] NULL,
	[Mensaje] [varchar](500) NULL,
	[PDF] [varchar](50) NULL,
	[Fecha] [datetime] NULL,
	[idOperacion_Origen] [int] NULL,
	[XML] [varchar](50) NULL,
	[tipoComprobante] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Especialidades]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Especialidades](
	[Especialidad] [int] NOT NULL,
	[Descripcion] [char](30) NULL,
	[Medico] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[especialidades_adherentes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[especialidades_adherentes](
	[adherente] [int] NOT NULL,
	[especialidad] [int] NOT NULL,
	[anio] [int] NULL,
	[idCampo] [int] IDENTITY(1,1) NOT NULL,
	[Tomar] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[especialidades_socios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[especialidades_socios](
	[socio] [int] NOT NULL,
	[especialidad] [int] NOT NULL,
	[anio] [int] NULL,
	[idCampo] [int] IDENTITY(1,1) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Estadios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Estadios](
	[idEstado] [tinyint] NOT NULL,
	[Descripcion] [varchar](50) NULL,
	[rango] [tinyint] NULL,
	[Sigla] [char](1) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EstadisticaArticulosAnulados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EstadisticaArticulosAnulados](
	[idCampo] [int] NOT NULL,
	[idOperacion] [int] NULL,
	[TipoMovimiento] [int] NULL,
	[Deposito] [int] NULL,
	[idarticulo] [int] NULL,
	[serial] [varchar](30) NULL,
	[cantidad] [numeric](18, 2) NULL,
	[Stock] [numeric](18, 2) NULL,
	[Vencimiento] [datetime] NULL,
	[idCampoOrigen] [int] NULL,
	[oCompra] [varchar](20) NULL,
	[ArticuloProveedor] [varchar](50) NULL,
	[Desvia] [varchar](50) NULL,
	[idMatricula] [int] NULL,
	[idObra] [int] NULL,
	[FecFactura] [datetime] NULL,
	[FecProceso] [datetime] NULL,
	[Docum] [int] NULL,
	[idProveedor] [int] NULL,
	[fcProv] [int] NULL,
	[nroFactura] [int] NULL,
	[paca] [numeric](18, 2) NULL,
	[FechaDOS] [datetime] NULL,
	[idCampoAnexo] [int] NULL,
	[Fabricado] [datetime] NULL,
	[Fecha] [datetime] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EstadisticaArticulosComision]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EstadisticaArticulosComision](
	[idCampoComis] [int] IDENTITY(1,1) NOT NULL,
	[idCampo] [int] NOT NULL,
	[idDoctor] [int] NULL,
	[idFono] [int] NULL,
	[idDistribuidor] [int] NULL,
	[Fecha] [datetime] NULL,
	[Importe] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EstadisticaArticulosDescripciones]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EstadisticaArticulosDescripciones](
	[idCampo] [int] NOT NULL,
	[Descripcion] [varchar](2000) NULL,
 CONSTRAINT [PK_PreciosEstadisticasDesc] PRIMARY KEY CLUSTERED 
(
	[idCampo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EstadisticaArticulosDescripcionesAnuladas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EstadisticaArticulosDescripcionesAnuladas](
	[idCampo] [int] NOT NULL,
	[Descripcion] [varchar](255) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EstadisticaArticulosDescripcionesPedidos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EstadisticaArticulosDescripcionesPedidos](
	[idCampo] [int] NOT NULL,
	[Descripcion] [varchar](255) NULL,
 CONSTRAINT [PK_PreciosEstadisticasDescPedidos] PRIMARY KEY CLUSTERED 
(
	[idCampo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EstadisticaArticulosDescripcionesPO]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EstadisticaArticulosDescripcionesPO](
	[idCampo] [int] NOT NULL,
	[Descripcion] [varchar](255) NULL,
 CONSTRAINT [PK_PreciosEstadisticasDescPO] PRIMARY KEY CLUSTERED 
(
	[idCampo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EstadisticaArticulosDescripcionesPresupuestos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EstadisticaArticulosDescripcionesPresupuestos](
	[idCampo] [int] NOT NULL,
	[Descripcion] [varchar](2000) NULL,
 CONSTRAINT [PK_PreciosEstadisticasDescPresupuestos] PRIMARY KEY CLUSTERED 
(
	[idCampo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EstadisticaArticulosPedidos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EstadisticaArticulosPedidos](
	[idCampo] [int] IDENTITY(1,1) NOT NULL,
	[idOperacion] [int] NULL,
	[TipoMovimiento] [int] NULL,
	[Deposito] [int] NULL,
	[idarticulo] [int] NULL,
	[serial] [varchar](30) NULL,
	[cantidad] [numeric](18, 2) NULL,
	[Stock] [numeric](18, 2) NULL,
	[Vencimiento] [datetime] NULL,
	[idCampoOrigen] [int] NULL,
 CONSTRAINT [PK_EstadisticaArticulosPedidos] PRIMARY KEY CLUSTERED 
(
	[idCampo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EstadisticaArticulosPO]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EstadisticaArticulosPO](
	[idCampo] [int] IDENTITY(1,1) NOT NULL,
	[idOperacion] [int] NULL,
	[TipoMovimiento] [int] NULL,
	[Deposito] [int] NULL,
	[idarticulo] [int] NULL,
	[serial] [varchar](30) NULL,
	[cantidad] [numeric](18, 2) NULL,
	[Stock] [numeric](18, 2) NULL,
	[Vencimiento] [datetime] NULL,
	[idCampoOrigen] [int] NULL,
	[idMatricula] [int] NULL,
 CONSTRAINT [PK_EstadisticaArticulosPO] PRIMARY KEY CLUSTERED 
(
	[idCampo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EstadisticaArticulosPOAnulados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EstadisticaArticulosPOAnulados](
	[idCampo] [int] IDENTITY(1,1) NOT NULL,
	[idOperacion] [int] NULL,
	[TipoMovimiento] [int] NULL,
	[Deposito] [int] NULL,
	[idarticulo] [int] NULL,
	[serial] [varchar](30) NULL,
	[cantidad] [numeric](18, 2) NULL,
	[Stock] [numeric](18, 2) NULL,
	[Vencimiento] [datetime] NULL,
	[idCampoOrigen] [int] NULL,
	[idMatricula] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EstadisticaArticulosPreciosAnulados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EstadisticaArticulosPreciosAnulados](
	[idCampo] [int] NOT NULL,
	[Concepto] [varchar](10) NULL,
	[Unitario] [numeric](18, 2) NULL,
	[BaseContable] [numeric](18, 2) NULL,
	[Alicuota] [numeric](6, 2) NULL,
	[Cuenta] [int] NULL,
	[Bonificacion] [numeric](18, 2) NULL,
	[Neto] [numeric](18, 2) NULL,
	[Fecha] [datetime] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EstadisticaArticulosPreciosPedidos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EstadisticaArticulosPreciosPedidos](
	[idCampo] [int] NOT NULL,
	[Concepto] [varchar](10) NULL,
	[Unitario] [numeric](18, 2) NULL,
	[BaseContable] [numeric](18, 2) NULL,
	[Alicuota] [numeric](6, 2) NULL,
	[Cuenta] [int] NULL,
	[Bonificacion] [numeric](18, 2) NULL,
 CONSTRAINT [PK_PreciosEstadisticasPedidos] PRIMARY KEY CLUSTERED 
(
	[idCampo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EstadisticaArticulosPreciosPO]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EstadisticaArticulosPreciosPO](
	[idCampo] [int] NOT NULL,
	[Concepto] [varchar](10) NULL,
	[Unitario] [numeric](18, 2) NULL,
	[BaseContable] [numeric](18, 2) NULL,
	[Alicuota] [numeric](6, 2) NULL,
	[Cuenta] [int] NULL,
	[bonificacion] [numeric](18, 2) NULL,
	[Neto] [numeric](18, 2) NULL,
 CONSTRAINT [PK_PreciosEstadisticasPO] PRIMARY KEY CLUSTERED 
(
	[idCampo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EstadisticaArticulosPreciosPresupuestos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EstadisticaArticulosPreciosPresupuestos](
	[idCampo] [int] NOT NULL,
	[Concepto] [varchar](10) NULL,
	[Unitario] [numeric](18, 2) NULL,
	[BaseContable] [numeric](18, 2) NULL,
	[Alicuota] [numeric](6, 2) NULL,
	[Cuenta] [int] NULL,
	[bonificacion] [numeric](18, 2) NULL,
	[Neto] [numeric](18, 2) NULL,
 CONSTRAINT [PK_PreciosEstadisticasPresupuestos] PRIMARY KEY CLUSTERED 
(
	[idCampo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EstadisticaArticulosPresupuestos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EstadisticaArticulosPresupuestos](
	[idCampo] [int] IDENTITY(1,1) NOT NULL,
	[idOperacion] [int] NULL,
	[TipoMovimiento] [int] NULL,
	[Deposito] [int] NULL,
	[idarticulo] [int] NULL,
	[serial] [varchar](30) NULL,
	[cantidad] [numeric](18, 2) NULL,
	[Stock] [numeric](18, 2) NULL,
	[Vencimiento] [datetime] NULL,
	[idCampoOrigen] [int] NULL,
	[oCompra] [varchar](20) NULL,
	[ArticuloProveedor] [varchar](50) NULL,
	[Desvia] [varchar](50) NULL,
	[idMatricula] [int] NULL,
	[idObra] [int] NULL,
	[FecFactura] [datetime] NULL,
	[FecProceso] [datetime] NULL,
	[Docum] [int] NULL,
	[idProveedor] [int] NULL,
	[fcProv] [int] NULL,
	[nroFactura] [int] NULL,
	[paca] [numeric](18, 2) NULL,
	[FechaDOS] [datetime] NULL,
	[idCampoAnexo] [int] NULL,
	[Fabricado] [datetime] NULL,
 CONSTRAINT [PK_EstadisticaArticulosPresupuestos] PRIMARY KEY CLUSTERED 
(
	[idCampo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Estados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Estados](
	[idEstadio] [int] NULL,
	[Descripcion] [varchar](50) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EstadosCivil]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EstadosCivil](
	[EstadoCivil] [tinyint] NOT NULL,
	[Descripcion] [char](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EstadosJuicios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EstadosJuicios](
	[idJuicio] [int] NULL,
	[idEstado] [int] NULL,
	[Desde] [datetime] NULL,
	[Hasta] [datetime] NULL,
	[idCampo] [int] IDENTITY(1,1) NOT NULL,
	[Notas] [varchar](5000) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EstadosPersonal]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EstadosPersonal](
	[estado] [int] NOT NULL,
	[descripcion] [varchar](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[EstadosPresupuestos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EstadosPresupuestos](
	[idCampo] [int] IDENTITY(1,1) NOT NULL,
	[idPresupuesto] [int] NULL,
	[sucursal] [int] NULL,
	[Estado] [int] NULL,
	[Desde] [datetime] NULL,
	[Hasta] [datetime] NULL,
	[idVendedor] [int] NULL,
	[Nota] [nvarchar](50) NULL,
	[idCampoOrigen] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Fallas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Fallas](
	[idFalla] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [char](30) NULL,
	[DescReducida] [char](10) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Familiares]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Familiares](
	[legajo] [int] NOT NULL,
	[apellido] [varchar](30) NULL,
	[nombre] [varchar](30) NULL,
	[fechanac] [datetime] NULL,
	[fechaultimo] [datetime] NULL,
	[certificado] [varchar](30) NULL,
	[parentesco] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[FamiliaresLegajos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FamiliaresLegajos](
	[legajo] [int] NOT NULL,
	[orden] [int] NOT NULL,
	[apellnombre] [varchar](35) NULL,
	[sexo] [int] NULL,
	[fecnac] [datetime] NULL,
	[tipodoc] [int] NULL,
	[numero] [int] NULL,
	[parentesco] [int] NOT NULL,
	[feccertificado] [datetime] NULL,
	[fecvigencia] [datetime] NULL,
	[fecvencimiento] [datetime] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[fechasJuicios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[fechasJuicios](
	[idJuicio] [int] NULL,
	[Desde] [datetime] NULL,
	[Hasta] [datetime] NULL,
	[Observacion] [varchar](50) NULL,
	[idCampo] [int] IDENTITY(1,1) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[FechasLegajos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FechasLegajos](
	[legajo] [int] NOT NULL,
	[orden] [int] NOT NULL,
	[concepto] [int] NULL,
	[indicativoantiguedad] [int] NULL,
	[fecha] [datetime] NOT NULL,
	[Finaliza] [datetime] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[FondosFijos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FondosFijos](
	[fechaid] [datetime] NOT NULL,
	[cuenta] [int] NOT NULL,
	[item] [int] NOT NULL,
	[fecha] [datetime] NULL,
	[tipocomprobante] [int] NULL,
	[numero] [int] NULL,
	[debe] [numeric](18, 2) NULL,
	[haber] [numeric](18, 2) NULL,
	[ctafecha] [datetime] NULL,
	[ctanrocomprobante] [char](12) NULL,
	[ctatipofactura] [char](1) NULL,
	[ctaestado] [char](1) NULL,
	[ctaproveedor] [int] NULL,
	[ctatipocomp] [int] NULL,
	[ctamonto] [numeric](18, 2) NULL,
	[ctaneto] [numeric](18, 2) NULL,
	[ctaconceptoimpuesto] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Foproes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Foproes](
	[Adherente] [int] NOT NULL,
	[cobertura] [int] NULL,
	[especialidad] [char](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Formulas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Formulas](
	[idFormula] [int] IDENTITY(1,1) NOT NULL,
	[Concepto] [int] NOT NULL,
	[Base] [int] NULL,
	[idcConvenio] [int] NULL,
	[Grupo] [int] NULL,
	[aTrabajados] [int] NULL,
	[coeficiente] [numeric](18, 6) NULL,
	[tipoLiquidacion] [int] NULL,
	[Basico] [int] NULL,
	[jubilado] [int] NULL,
	[sistema] [int] NULL,
	[sindicato] [int] NULL,
	[obrasocial] [int] NULL,
	[adherentes] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[FormulasArticulos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[FormulasArticulos](
	[idCampo] [int] IDENTITY(0,1) NOT NULL,
	[idArticulo] [int] NULL,
	[idComponente] [int] NULL,
	[Cantidad] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Ganancias]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ganancias](
	[Periodo] [int] NULL,
	[Recibo] [int] NULL,
	[BRUTO] [numeric](18, 2) NULL,
	[baseCalculo] [numeric](18, 2) NULL,
	[retencion] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Gastos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Gastos](
	[idconcepto] [int] NOT NULL,
	[observacion] [varchar](30) NULL,
	[importe] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[gCoberturas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[gCoberturas](
	[idCobertura] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [varchar](50) NULL,
	[Miles] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[grupos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[grupos](
	[grupo] [char](2) NOT NULL,
	[Descripcion] [char](30) NULL,
	[Modo] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[grupos_adherentes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[grupos_adherentes](
	[adherente] [int] NOT NULL,
	[grupo] [char](2) NOT NULL,
	[clase] [char](5) NULL,
	[funcion] [char](10) NULL,
	[subnumero] [char](1) NULL,
	[reparticion] [int] NULL,
	[lugarpago] [char](5) NULL,
	[idCampo] [int] IDENTITY(1,1) NOT NULL,
	[Activo] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Grupos_Agrupados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Grupos_Agrupados](
	[Grupo] [char](1) NULL,
	[Descripcion] [varchar](20) NULL,
	[Entidad] [tinyint] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[grupos_socios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[grupos_socios](
	[socio] [int] NOT NULL,
	[grupo] [char](2) NOT NULL,
	[clase] [char](5) NULL,
	[funcion] [char](10) NULL,
	[subnumero] [char](2) NULL,
	[reparticion] [int] NULL,
	[lugarpago] [char](5) NULL,
	[idCampo] [int] NOT NULL,
	[Activo] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[grupos_socios_ANT]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[grupos_socios_ANT](
	[socio] [int] NOT NULL,
	[grupo] [char](2) NOT NULL,
	[clase] [char](5) NULL,
	[funcion] [char](10) NULL,
	[subnumero] [char](2) NULL,
	[reparticion] [int] NULL,
	[lugarpago] [char](5) NULL,
	[idCampo] [int] NOT NULL,
	[Activo] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[GruposConceptosHeader]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[GruposConceptosHeader](
	[grupo] [int] IDENTITY(1,1) NOT NULL,
	[descripcion] [varchar](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[GruposConceptosItems]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[GruposConceptosItems](
	[grupo] [int] NOT NULL,
	[concepto] [int] NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[gruposIDH]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[gruposIDH](
	[Grupo] [int] NOT NULL,
	[Descripcion] [char](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[GruposUsuarios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[GruposUsuarios](
	[grupo] [int] IDENTITY(1,1) NOT NULL,
	[descripcion] [varchar](30) NOT NULL,
	[categoria] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Header_CodigosGanancias]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Header_CodigosGanancias](
	[Codigo] [int] NOT NULL,
	[Descripcion] [varchar](50) NULL,
	[alicuota] [numeric](18, 2) NULL,
	[NoImponible] [numeric](18, 2) NULL,
	[Minimo] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Header_Liquidaciones]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Header_Liquidaciones](
	[idLiquidacion] [int] IDENTITY(1,1) NOT NULL,
	[aniomes] [int] NULL,
	[Periodo] [int] NULL,
	[FechaLiq] [datetime] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Header_Listas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Header_Listas](
	[idLista] [int] NOT NULL,
	[Descripcion] [char](40) NULL,
	[FechaAlta] [datetime] NULL,
 CONSTRAINT [PK_Header_Listas] PRIMARY KEY CLUSTERED 
(
	[idLista] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[header_operaciones_renumerados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[header_operaciones_renumerados](
	[idOperacion] [int] NOT NULL,
	[Fecha] [datetime] NOT NULL,
	[TipodeOperacion] [int] NOT NULL,
	[Observacion] [varchar](255) NOT NULL,
	[AsientoDiario] [int] NULL,
	[AnioMes] [int] NULL,
	[tipoasiento] [int] NULL,
	[idUsuario] [char](10) NULL,
	[idOperadorTesoreria] [int] NULL,
	[Procesado] [datetime] NULL,
	[cuenta] [int] NULL,
	[ComprobanteNumero] [numeric](18, 0) NULL,
	[Serie] [char](6) NULL,
	[ObservacionComprobante] [varchar](256) NULL,
	[Cerrada] [datetime] NULL,
	[AsientoCierre] [numeric](18, 0) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Header_Pedidos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Header_Pedidos](
	[idtransaccion] [int] IDENTITY(1,1) NOT NULL,
	[comprobante] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[fecha] [datetime] NOT NULL,
	[cliente] [int] NOT NULL,
	[tipocomprobante] [int] NOT NULL,
	[nrocomprobante] [char](12) NULL,
	[tipofactura] [char](1) NULL,
	[totalimporte] [numeric](18, 2) NOT NULL,
	[cancelado] [numeric](18, 2) NULL,
	[fecha1venc] [datetime] NULL,
	[fecha2venc] [datetime] NULL,
	[estado] [char](1) NULL,
	[fechareal] [datetime] NOT NULL,
	[centrocosto] [int] NULL,
	[DescripcionImporte] [varchar](255) NULL,
	[Moneda] [int] NULL,
	[ImporteOrigen] [numeric](18, 2) NULL,
	[TC] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Header_PO]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Header_PO](
	[idtransaccion] [int] IDENTITY(1,1) NOT NULL,
	[comprobante] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[fecha] [datetime] NOT NULL,
	[Proveedor] [int] NOT NULL,
	[tipocomprobante] [int] NOT NULL,
	[nrocomprobante] [char](12) NULL,
	[tipofactura] [char](1) NULL,
	[totalimporte] [numeric](18, 2) NOT NULL,
	[cancelado] [numeric](18, 2) NULL,
	[fecha1venc] [datetime] NULL,
	[fecha2venc] [datetime] NULL,
	[estado] [char](1) NULL,
	[fechareal] [datetime] NOT NULL,
	[centrocosto] [int] NULL,
	[DescripcionImporte] [varchar](255) NULL,
	[Moneda] [int] NULL,
	[ImporteOrigen] [numeric](18, 2) NULL,
	[TC] [numeric](18, 2) NULL,
	[POOrigen] [varchar](15) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Header_Prestamos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Header_Prestamos](
	[Entidad] [int] NULL,
	[Codigo] [int] NULL,
	[Numero] [int] NOT NULL,
	[FechaOtorgamiento] [datetime] NULL,
	[MontoPrestado] [numeric](18, 2) NULL,
	[TasaInteres] [numeric](18, 2) NULL,
	[CantCuotas] [int] NULL,
	[Cancelado] [char](1) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Header_Presupuestos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Header_Presupuestos](
	[idtransaccion] [int] IDENTITY(1,1) NOT NULL,
	[comprobante] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[fecha] [datetime] NOT NULL,
	[cliente] [int] NOT NULL,
	[tipocomprobante] [int] NOT NULL,
	[nrocomprobante] [char](12) NULL,
	[tipofactura] [char](1) NULL,
	[totalimporte] [numeric](18, 2) NOT NULL,
	[cancelado] [numeric](18, 2) NULL,
	[fecha1venc] [datetime] NULL,
	[fecha2venc] [datetime] NULL,
	[estado] [char](1) NULL,
	[fechareal] [datetime] NOT NULL,
	[centrocosto] [int] NULL,
	[DescripcionImporte] [varchar](255) NULL,
	[Moneda] [int] NULL,
	[ImporteOrigen] [numeric](18, 2) NULL,
	[TC] [numeric](18, 2) NULL,
	[idLeyenda] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Header_RecibosDA]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Header_RecibosDA](
	[idRecibo] [int] IDENTITY(1,1) NOT NULL,
	[Entidad] [int] NULL,
	[Socio] [int] NULL,
	[Numero] [int] NULL,
	[Fecha] [datetime] NULL,
	[idOPeracion] [int] NULL,
	[Importe] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[HeaderMovimientosStock]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[HeaderMovimientosStock](
	[idOperacion] [int] NOT NULL,
	[idtipoMovimiento] [int] NULL,
	[idDepositoOrigen] [int] NULL,
	[idDepositoDestino] [int] NULL,
	[idDespacho] [int] NULL,
	[Observacion] [varchar](100) NULL,
	[idObra] [int] NULL,
	[idProveedor] [int] NULL,
	[fcProveedor] [varchar](13) NULL,
 CONSTRAINT [PK_HeaderMovimientosStock] PRIMARY KEY CLUSTERED 
(
	[idOperacion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[headerOrdenesProduccion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[headerOrdenesProduccion](
	[idOrden] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [varchar](50) NULL,
	[Fecha] [datetime] NULL,
	[FechaEntrega] [datetime] NULL,
	[idCliente] [int] NULL,
	[idPedido] [int] NULL,
	[Observacion] [varchar](255) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[HeaderPO]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[HeaderPO](
	[idPO] [int] IDENTITY(1,1) NOT NULL,
	[nPOProveedor] [varchar](50) NULL,
	[fecha] [datetime] NULL,
	[fechaarribo] [datetime] NULL,
	[idProveedor] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[HeaderRemitos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[HeaderRemitos](
	[idtransaccion] [int] IDENTITY(1,1) NOT NULL,
	[idtransaccionFactura] [int] NULL,
	[fecha] [datetime] NULL,
	[idCliente] [int] NULL,
	[idtransporte] [int] NULL,
	[valordeclarado] [numeric](18, 2) NULL,
	[bultos] [numeric](18, 2) NULL,
	[idOperacion] [int] NULL,
	[nrocomprobante] [varchar](20) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[hodup]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[hodup](
	[asientodiario] [int] NULL,
	[tipoasiento] [int] NULL,
	[aniomes] [int] NULL,
	[count] [int] NULL,
	[idoperacion] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Horarios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Horarios](
	[idHorario] [int] NOT NULL,
	[idCurso] [int] NULL,
	[InicioTeorico] [datetime] NULL,
	[FechaCierre] [datetime] NULL,
	[InicioReal] [datetime] NULL,
	[MatriculaSocio] [numeric](18, 2) NULL,
	[MatriculanoSocio] [numeric](18, 2) NULL,
	[MatriculaResidente] [int] NULL,
	[Cuotas] [int] NULL,
	[CuotasSocios] [numeric](18, 2) NULL,
	[CuotasnoSocios] [numeric](18, 2) NULL,
	[CuotasResidentes] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Hospitales]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Hospitales](
	[idHospital] [int] IDENTITY(1,1) NOT NULL,
	[Hospital] [int] NOT NULL,
	[Nombre] [char](30) NULL,
	[Reparticion] [int] NULL,
	[Filial] [char](1) NULL,
	[HospitalVoto] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Hospitales_Socios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Hospitales_Socios](
	[Socio] [numeric](18, 0) NULL,
	[Hospital] [numeric](18, 0) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[HospitalesVoto]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[HospitalesVoto](
	[HospitalVoto] [int] NOT NULL,
	[Nombre] [char](30) NULL,
	[Unificador] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ida]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ida](
	[Entidad] [int] NOT NULL,
	[AnioMes_Anio] [varchar](4) NULL,
	[AnioMes_Mes] [varchar](2) NULL,
	[Serie] [varchar](4) NULL,
	[NumeroRecibo] [varchar](8) NULL,
	[FechaRecibo] [varchar](8) NULL,
	[Concepto] [varchar](3) NULL,
	[FechaFactura] [varchar](8) NULL,
	[Socio] [varchar](6) NULL,
	[Importe_ACobrar] [numeric](18, 2) NULL,
	[Importe_Cobrado] [numeric](18, 2) NULL,
	[Vencimiento] [varchar](8) NULL,
	[Cobrador] [varchar](2) NULL,
	[Rendicion] [varchar](6) NULL,
	[FechaRendicion] [varchar](8) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ida_Hospitales]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ida_Hospitales](
	[Numerador] [numeric](18, 0) IDENTITY(1,1) NOT NULL,
	[Col001] [char](18) NULL,
	[Col002] [char](8) NULL,
	[Col003] [char](1) NULL,
	[Col004] [char](2) NULL,
	[Col005] [char](3) NULL,
	[Col006] [char](1) NULL,
	[Col007] [char](9) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[IdentityTable]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[IdentityTable](
	[ForTable] [sysname] NOT NULL,
	[Value] [numeric](10, 0) NOT NULL,
 CONSTRAINT [PK_IdentityTable] PRIMARY KEY CLUSTERED 
(
	[ForTable] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[inco]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[inco](
	[Socio] [float] NULL,
	[Apellido] [nvarchar](255) NULL,
	[Nombre] [nvarchar](255) NULL,
	[F4] [nvarchar](255) NULL,
	[F5] [nvarchar](255) NULL,
	[F6] [nvarchar](255) NULL,
	[F7] [nvarchar](255) NULL,
	[F8] [nvarchar](255) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[infoComision]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[infoComision](
	[idCampo] [int] NULL,
	[idContacto1] [int] NULL,
	[idContacto2] [int] NULL,
	[idContacto3] [int] NULL,
	[Fecha] [datetime] NULL,
	[valorComis] [numeric](18, 2) NULL,
	[idPaciente] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[infoComplementoGanancias]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[infoComplementoGanancias](
	[idCampo] [int] IDENTITY(1,1) NOT NULL,
	[idCliente] [int] NULL,
	[FechaRetencion] [datetime] NULL,
	[FechaContabilizacion] [datetime] NULL,
	[idRegimen] [int] NULL,
	[ImporteRetencion] [numeric](18, 2) NULL,
	[NumeroRetencion] [varchar](50) NULL,
	[idtransaccion] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[InformacionComisiones]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[InformacionComisiones](
	[idCampo] [int] NOT NULL,
	[idFono] [int] NULL,
	[idDist] [int] NULL,
	[idDr] [int] NULL,
	[Valor] [numeric](10, 2) NULL,
	[fecha] [datetime] NULL,
	[idVendedor] [int] NULL,
	[paciente] [varchar](50) NULL,
	[idRegistroTemp] [int] IDENTITY(1,1) NOT NULL,
	[ComisDist] [numeric](18, 2) NULL,
	[ComisDr] [numeric](18, 2) NULL,
	[ComisFono] [numeric](18, 2) NULL,
 CONSTRAINT [PK_InformacionComisiones] PRIMARY KEY CLUSTERED 
(
	[idCampo] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[InfoTarjetas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[InfoTarjetas](
	[entidad] [int] NOT NULL,
	[socio] [int] NOT NULL,
	[adherido] [char](1) NULL,
	[tarjeta] [int] NULL,
	[numero] [char](16) NULL,
	[vencimiento] [datetime] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Items_Liquidaciones]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Items_Liquidaciones](
	[idliquidacion] [int] NOT NULL,
	[Legajo] [int] NULL,
	[Item] [int] IDENTITY(1,1) NOT NULL,
	[Concepto] [int] NULL,
	[Horas] [numeric](18, 2) NULL,
	[Importe] [numeric](18, 2) NULL,
	[TipoCalculo] [char](1) NULL,
	[origen] [char](1) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[juicios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[juicios](
	[Col001] [char](727) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Junio]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Junio](
	[Entidad] [float] NULL,
	[Socio] [float] NULL,
	[Importe] [float] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[JunioMuni04]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[JunioMuni04](
	[socio] [int] NOT NULL,
	[meses] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[LegajosPago]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[LegajosPago](
	[idOperacion] [int] NULL,
	[idtransaccion] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Letras]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Letras](
	[id] [int] IDENTITY(1,1) NOT NULL,
	[Letra] [varchar](2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[leyendas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[leyendas](
	[idLeyenda] [int] IDENTITY(1,1) NOT NULL,
	[Titulo] [varchar](30) NOT NULL,
	[Leyenda] [nvarchar](4000) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[lisclip]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[lisclip](
	[LISTA] [float] NULL,
	[CODIGO] [nvarchar](8) NULL,
	[PRECIO] [float] NULL,
	[LINEA] [float] NULL,
	[PRECIO1] [float] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ListadoPendientes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ListadoPendientes](
	[idobra] [int] NULL,
	[partnumber] [varchar](30) NOT NULL,
	[descripcion] [varchar](19) NULL,
	[precio] [numeric](18, 2) NULL,
	[Cantidad] [numeric](38, 2) NULL,
	[Subtotal] [numeric](38, 4) NULL,
	[Matricula] [varchar](15) NULL,
	[idMatricula] [int] NOT NULL,
	[Fecha] [datetime] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[listadosCompanias]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[listadosCompanias](
	[Entidad] [int] NOT NULL,
	[Periodo] [int] NULL,
	[socio] [int] NOT NULL,
	[cobrador] [int] NOT NULL,
	[Grupo] [char](1) NULL,
	[cobertura] [int] NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Listas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Listas](
	[idAlumno] [int] NOT NULL,
	[idHorario] [int] NOT NULL,
	[fechaInscripcion] [datetime] NULL,
	[FechaBaja] [datetime] NULL,
	[idModalidad] [int] NULL,
	[Porcentaje] [numeric](18, 2) NULL,
	[Observaciones] [varchar](50) NULL,
	[Matricula] [numeric](18, 2) NULL,
	[Cuotas] [int] NULL,
	[ImporteCuotas] [numeric](18, 2) NULL,
	[idCampo] [int] IDENTITY(1,1) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Localidades]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Localidades](
	[localidad] [int] IDENTITY(1,1) NOT NULL,
	[descripcion] [varchar](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[LockRegs]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[LockRegs](
	[computer] [varchar](100) NOT NULL,
	[tablename] [varchar](100) NOT NULL,
	[idtransaccion] [int] NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[login]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[login](
	[id] [int] IDENTITY(1,1) NOT NULL,
	[username] [varchar](20) NULL,
	[password] [varchar](102) NULL,
	[fullname] [varchar](50) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Losno]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Losno](
	[socio] [int] NOT NULL,
	[Entidad] [int] NOT NULL,
	[Fecha_Mes] [datetime] NOT NULL,
	[Conc_Mes] [char](3) NOT NULL,
	[Fecha_Recibo] [datetime] NULL,
	[Conc_Recibo] [char](3) NULL,
	[DocumentoNumero_Mes] [char](14) NULL,
	[DocumentoNumero_Recibo] [char](14) NULL,
	[FechaRendicion] [datetime] NULL,
	[Rendicion] [char](14) NULL,
	[importe_Mes] [numeric](18, 2) NULL,
	[Porcentaje_Mes] [numeric](18, 2) NULL,
	[importe_Recibo] [numeric](18, 2) NULL,
	[vencimiento] [datetime] NULL,
	[Cobrador] [int] NOT NULL,
	[Serie] [char](4) NULL,
	[importe_Mes_original] [numeric](18, 2) NULL,
	[importe_Recibo_original] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Lugaresdetrabajo_adherentes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Lugaresdetrabajo_adherentes](
	[adherente] [int] NOT NULL,
	[LugarTrabajo] [char](20) NULL,
	[FecDesde] [datetime] NULL,
	[FecHasta] [datetime] NULL,
	[TituSup] [char](1) NULL,
	[idCampo] [int] IDENTITY(1,1) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[MaestroPersonal]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[MaestroPersonal](
	[legajo] [int] NOT NULL,
	[centrocosto] [int] NULL,
	[apellido] [varchar](20) NOT NULL,
	[nombre] [varchar](20) NOT NULL,
	[tipodocumento] [int] NULL,
	[numero] [int] NULL,
	[nacionalidad] [int] NULL,
	[obrasocial] [int] NOT NULL,
	[adherentes] [int] NULL,
	[sindicato] [int] NULL,
	[estadocivil] [int] NULL,
	[califprofesional] [int] NOT NULL,
	[categoria] [int] NOT NULL,
	[estado] [int] NOT NULL,
	[tareacumplida] [int] NOT NULL,
	[fechanacimiento] [datetime] NULL,
	[modalidad] [int] NOT NULL,
	[jornalbasico] [numeric](18, 2) NULL,
	[jornalacuenta] [numeric](18, 2) NULL,
	[cuil] [char](13) NULL,
	[zonageografica] [int] NOT NULL,
	[codigoactividad] [int] NOT NULL,
	[domicilio] [varchar](30) NULL,
	[localidad] [int] NULL,
	[cpostal] [char](8) NULL,
	[telefono] [varchar](20) NULL,
	[modoantiguedad] [int] NOT NULL,
	[jubilado] [int] NOT NULL,
	[situacion] [int] NOT NULL,
	[condicion] [int] NOT NULL,
	[sistemajubilacion] [int] NOT NULL,
	[idcConvenio] [int] NULL,
	[FechaAntiguedad] [datetime] NULL,
	[FechaBaja] [datetime] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[matCierre]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[matCierre](
	[idCampo] [int] NOT NULL,
	[Fase] [int] NOT NULL,
	[Cantidad] [numeric](18, 2) NULL,
	[precio] [decimal](20, 4) NULL,
	[fecFactura] [datetime] NULL,
	[signo] [numeric](20, 2) NULL,
	[Subtotal] [decimal](38, 6) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Matriculas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Matriculas](
	[idMatricula] [int] IDENTITY(1,1) NOT NULL,
	[Matricula] [varchar](15) NULL,
	[nombreAvion] [varchar](25) NULL,
	[idcliente] [int] NULL,
	[NumeroSerie] [varchar](25) NULL,
	[taxi] [smallint] NULL,
	[Estado] [smallint] NULL,
	[Observacion] [varchar](30) NULL,
	[fechabaja] [datetime] NULL,
 CONSTRAINT [PK_Matriculas] PRIMARY KEY CLUSTERED 
(
	[idMatricula] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[MatrizComisiones]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[MatrizComisiones](
	[FGA] [float] NULL,
	[RAZ_FGA] [nvarchar](30) NULL,
	[COMISF] [float] NULL,
	[DIST] [float] NULL,
	[RAZ_DIST] [nvarchar](30) NULL,
	[COMISD] [float] NULL,
	[DR] [float] NULL,
	[RAZ_DR] [nvarchar](30) NULL,
	[COMISDR] [float] NULL,
	[SUP1] [float] NULL,
	[RAZ_SUP1] [nvarchar](30) NULL,
	[COM_SUP1] [float] NULL,
	[SUP2] [float] NULL,
	[RAZ_SUP2] [nvarchar](30) NULL,
	[COM_SUP2] [float] NULL,
	[FLI] [float] NULL,
	[SFLI] [float] NULL,
	[PACIENTE] [nvarchar](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[medicos sin especialidad]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[medicos sin especialidad](
	[idMed] [int] IDENTITY(1,1) NOT NULL,
	[Col001] [varchar](255) NULL,
	[Col002] [varchar](255) NULL,
	[Col003] [varchar](255) NULL,
	[Col004] [varchar](255) NULL,
	[Col005] [varchar](255) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ModalidadesPersonal]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ModalidadesPersonal](
	[modalidad] [int] NOT NULL,
	[descripcion] [varchar](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ModalidadNovedadesLegajos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ModalidadNovedadesLegajos](
	[modalidad] [int] NOT NULL,
	[descripcion] [varchar](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Modelos_Pacientes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Modelos_Pacientes](
	[idModelo] [int] IDENTITY(1,1) NOT NULL,
	[idPaciente] [int] NULL,
	[modelo] [varchar](50) NULL,
	[Serie] [varchar](50) NULL,
	[finGarantia] [datetime] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ModoAntiguedad]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ModoAntiguedad](
	[modoantiguedad] [int] IDENTITY(1,1) NOT NULL,
	[descripcion] [varchar](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ModoConcepLiq]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ModoConcepLiq](
	[concepto] [int] NOT NULL,
	[descripcion] [varchar](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ModoConcepRemun]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ModoConcepRemun](
	[concepto] [int] NOT NULL,
	[descripcion] [varchar](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Modulos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Modulos](
	[idModulo] [int] NOT NULL,
	[Descripcion] [char](20) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Moneda]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Moneda](
	[idmoneda] [int] NULL,
	[Descripcion] [char](10) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[MotivosBaja]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[MotivosBaja](
	[Motivo] [int] NOT NULL,
	[Nombre] [char](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Movimientos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Movimientos](
	[idOperacion] [int] IDENTITY(1,1) NOT NULL,
	[Fecha] [datetime] NULL,
	[Cliente] [int] NULL,
	[idConcepto] [int] NULL,
	[TipoOperacion] [int] NULL,
	[Moneda] [int] NULL,
	[Cantidad] [numeric](18, 2) NULL,
	[Precio] [numeric](18, 4) NULL,
	[MonedaNeto] [int] NULL,
	[Neto] [numeric](18, 2) NULL,
	[Operador] [int] NULL,
	[Cancelar] [int] NULL,
	[Estado] [int] NULL,
	[idContacto] [int] NULL,
	[precio_contacto] [numeric](18, 4) NULL,
	[idOperador] [int] NULL,
	[precio_operador] [numeric](18, 4) NULL,
	[idOperacionCalce] [int] NULL,
	[Observacion] [varchar](50) NULL,
	[Hora] [char](5) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Nacionalidades]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Nacionalidades](
	[Nacionalidad] [tinyint] NOT NULL,
	[Descripcion] [char](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[NF]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[NF](
	[TipoComprobante] [varchar](2) NULL,
	[precio] [varchar](2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Nombra]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Nombra](
	[HOSPITAL] [nvarchar](255) NULL,
	[APELLIDO Y NOMBRE] [nvarchar](255) NULL,
	[DNI] [float] NULL,
	[F#M# ] [float] NULL,
	[CARGO] [nvarchar](255) NULL,
	[HORAS] [float] NULL,
	[FECHA B#M#] [smalldatetime] NULL,
	[B#M# ] [float] NULL,
	[DESIGNACION] [nvarchar](255) NULL,
	[DECRETO N°] [nvarchar](255) NULL,
	[F11] [nvarchar](255) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[NominaCursos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[NominaCursos](
	[idCurso] [int] NOT NULL,
	[Descripcion] [varchar](65) NOT NULL,
	[Concepto] [char](3) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Notas_Imputacion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Notas_Imputacion](
	[idOPeracion] [numeric](18, 0) NOT NULL,
	[idtransaccion] [numeric](18, 0) NOT NULL,
	[importe] [numeric](18, 2) NULL,
	[TipoOperacion] [int] NULL,
	[Observacion] [varchar](50) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[NotasImputacion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[NotasImputacion](
	[socio] [int] NOT NULL,
	[Fechaingreso] [datetime] NULL,
	[ingreso] [int] NULL,
	[documentonumero] [char](14) NULL,
	[idtransaccionRecibo] [int] NULL,
	[idtransaccionMes] [int] NOT NULL,
	[ImporteNC] [numeric](18, 2) NULL,
	[id] [int] IDENTITY(1,1) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[NOVE]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[NOVE](
	[Col001] [char](35) NULL,
	[Col002] [char](134) NULL,
	[Col003] [char](11) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Novedades]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Novedades](
	[legajo] [int] NOT NULL,
	[orden] [int] NOT NULL,
	[concepto] [int] NOT NULL,
	[importe] [numeric](18, 2) NOT NULL,
	[AnioMes] [int] NOT NULL,
	[Periodo] [int] NOT NULL,
	[Tipo] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[NovedadesLegajos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[NovedadesLegajos](
	[legajo] [int] NOT NULL,
	[orden] [int] NULL,
	[concepto] [int] NOT NULL,
	[modalidad] [int] NOT NULL,
	[importe] [numeric](18, 2) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Obras]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Obras](
	[idObra] [int] NOT NULL,
	[idMatricula] [int] NULL,
	[idCliente] [int] NULL,
	[Creada] [datetime] NULL,
	[Matricula] [varchar](50) NULL,
	[activo] [int] NULL,
	[coeficiente] [numeric](18, 2) NULL,
	[cierre] [datetime] NULL,
	[cierreFC] [datetime] NULL,
	[Observacion] [varchar](50) NULL,
 CONSTRAINT [PK_Obras] PRIMARY KEY CLUSTERED 
(
	[idObra] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[obrasab]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[obrasab](
	[Modo] [int] NOT NULL,
	[idCampoEA] [int] NOT NULL,
	[notas] [varchar](20) NULL,
	[articulo] [varchar](15) NULL,
	[docum] [int] NULL,
	[fecha] [datetime] NULL,
	[descripcion] [varchar](19) NULL,
	[Cantidad] [decimal](31, 2) NULL,
	[precio] [decimal](20, 4) NULL,
	[subtotalDolares] [decimal](38, 4) NULL,
	[Pesos] [decimal](38, 6) NULL,
	[tipomovimiento] [int] NULL,
	[idobra] [int] NULL,
	[razonSocial] [nvarchar](60) NULL,
	[idProveedor] [int] NULL,
	[fcProv] [int] NULL,
	[fechaFc] [datetime] NULL,
	[Observacion] [varchar](255) NULL,
	[idcampoAnexo] [int] NULL,
	[idcampo] [int] NULL,
	[idoperacion] [int] NULL,
	[RazonSocialProveedor] [nvarchar](60) NULL,
	[nombreAvion] [varchar](25) NULL,
	[matricula] [varchar](15) NULL,
	[computername] [varchar](200) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ObrasSociales]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ObrasSociales](
	[obrasocial] [int] NOT NULL,
	[descripcion] [varchar](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Observaciones_Adherentes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Observaciones_Adherentes](
	[Adherente] [int] NULL,
	[fecha] [datetime] NULL,
	[observacion] [text] NULL,
	[idCampo] [int] IDENTITY(1,1) NOT NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Observaciones_Alumnos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Observaciones_Alumnos](
	[idCampo] [int] IDENTITY(1,1) NOT NULL,
	[idAlumno] [int] NULL,
	[fecha] [datetime] NULL,
	[Observacion] [text] NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Observaciones_Clientes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Observaciones_Clientes](
	[idCampo] [int] IDENTITY(1,1) NOT NULL,
	[Codigo] [int] NULL,
	[fecha] [datetime] NULL,
	[Observacion] [text] NULL,
	[alerta] [datetime] NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Observaciones_Juicios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Observaciones_Juicios](
	[idJuicio] [int] NULL,
	[fecha] [datetime] NULL,
	[observacion] [text] NULL,
	[idCampo] [int] IDENTITY(1,1) NOT NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Observaciones_Profesionales]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Observaciones_Profesionales](
	[Socio] [int] NULL,
	[fecha] [datetime] NULL,
	[observacion] [varchar](100) NULL,
	[idCampo] [int] NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Observaciones_Proveedores]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Observaciones_Proveedores](
	[idCampo] [int] IDENTITY(1,1) NOT NULL,
	[Codigo] [int] NULL,
	[fecha] [datetime] NULL,
	[Observacion] [text] NULL,
	[alerta] [datetime] NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Observaciones_socios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Observaciones_socios](
	[Socio] [int] NULL,
	[fecha] [datetime] NULL,
	[observacion] [varchar](500) NULL,
	[idCampo] [int] NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Operaciones]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Operaciones](
	[idTipoOperacion] [int] IDENTITY(1,1) NOT NULL,
	[descripcion] [varchar](10) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Operadores]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Operadores](
	[idoperador] [int] IDENTITY(1,1) NOT NULL,
	[nombre] [varchar](30) NULL,
	[telefono] [varchar](30) NULL,
	[monto] [numeric](18, 2) NULL,
	[aliquidar] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Origenes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Origenes](
	[idOrigen] [int] IDENTITY(0,1) NOT NULL,
	[Descripcion] [varchar](20) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[oTotMatAgo]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[oTotMatAgo](
	[Fase] [int] NOT NULL,
	[idcampoEA] [int] NOT NULL,
	[precio] [decimal](20, 4) NULL,
	[pesos] [decimal](38, 6) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[OtrosCargos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[OtrosCargos](
	[Concepto] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [char](10) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[OtrosConceptos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[OtrosConceptos](
	[Concepto] [char](8) NOT NULL,
	[Descripcion] [varchar](30) NULL,
	[Importe] [numeric](18, 2) NULL,
	[Imputacion_contable] [int] NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Pacientes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Pacientes](
	[idPaciente] [int] IDENTITY(1,1) NOT NULL,
	[Nombre] [nvarchar](50) NULL,
	[Domicilio] [nvarchar](50) NULL,
	[Localidad] [nvarchar](50) NULL,
	[Telefono] [nvarchar](50) NULL,
	[Email] [nvarchar](50) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PagosJuicios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PagosJuicios](
	[idJuicio] [int] NULL,
	[idCampo] [int] IDENTITY(1,1) NOT NULL,
	[Fecha] [datetime] NULL,
	[observacion] [varchar](200) NULL,
	[idCategoria] [int] NULL,
	[Importe] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Paises]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Paises](
	[idPais] [int] IDENTITY(0,1) NOT NULL,
	[Nombre] [varchar](50) NULL,
	[id_FacturaElectronica] [int] NULL,
 CONSTRAINT [PK_Paises] PRIMARY KEY CLUSTERED 
(
	[idPais] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PaisesFacturaElectronica]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PaisesFacturaElectronica](
	[PaisFex] [int] NULL,
	[NombrePais] [nvarchar](50) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ParametrosGenerales]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ParametrosGenerales](
	[parametro] [varchar](50) NOT NULL,
	[valor] [varchar](255) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ParametrosGeneralesSueldos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ParametrosGeneralesSueldos](
	[nombreempresa] [varchar](255) NOT NULL,
	[domicilio] [varchar](30) NULL,
	[codigopostal] [char](8) NULL,
	[localidad] [varchar](30) NULL,
	[provincia] [varchar](30) NULL,
	[telefono] [varchar](30) NULL,
	[mail] [varchar](30) NULL,
	[cuit] [char](13) NULL,
	[localidadpago] [varchar](30) NULL,
	[lugardedeposito] [varchar](30) NULL,
	[sucursal] [varchar](30) NULL,
	[cargofijoART] [numeric](18, 2) NULL,
	[alicuotaART] [numeric](18, 2) NULL,
	[nombretxtDGI] [varchar](30) NULL,
	[redondeo] [int] NULL,
	[valor] [numeric](18, 2) NULL,
	[actividadempresa] [varchar](30) NULL,
	[ivaGeneral] [numeric](18, 2) NULL,
	[Deudores] [int] NULL,
	[DeudoresExterior] [int] NULL,
	[Proveedores] [int] NULL,
	[ProveedoresExterior] [int] NULL,
	[Mercaderias] [int] NULL,
	[MercaderiasExterior] [int] NULL,
	[Inicio] [datetime] NULL,
	[Cierre] [datetime] NULL,
	[Cheques] [int] NULL,
	[ListadePrecios] [int] NULL,
	[PuntodeVenta] [int] NULL,
	[ProveedoresVarios] [int] NULL,
	[CuentaIvaCompras] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ParametrosModoAntiguedad]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ParametrosModoAntiguedad](
	[modoantiguedad] [int] NOT NULL,
	[item] [int] NOT NULL,
	[vigentehasta] [int] NOT NULL,
	[tipocalculo] [int] NOT NULL,
	[base] [int] NOT NULL,
	[importe] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Parentescos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Parentescos](
	[parentesco] [int] IDENTITY(1,1) NOT NULL,
	[descripcion] [varchar](30) NULL,
	[conceptoliquidacion] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[partes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[partes](
	[PART_NBR] [nvarchar](26) NULL,
	[GP] [nvarchar](2) NULL,
	[PRECIO] [float] NULL,
	[MEDIDA] [nvarchar](2) NULL,
	[PPRECIO] [float] NULL,
	[CPRECIO] [float] NULL,
	[TYPE] [nvarchar](10) NULL,
	[DESC] [nvarchar](51) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[pCuentas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[pCuentas](
	[PROVEEDOR] [float] NULL,
	[RAZON] [nvarchar](255) NULL,
	[CUIT] [nvarchar](255) NULL,
	[CATIVA] [float] NULL,
	[Imputacion] [float] NULL,
	[F6] [nvarchar](255) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Pedidos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Pedidos](
	[idtransaccion] [int] IDENTITY(1,1) NOT NULL,
	[idPresupuesto] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[fecha] [datetime] NOT NULL,
	[cliente] [int] NOT NULL,
	[idPaciente] [int] NOT NULL,
	[TipoConsulta] [int] NULL,
	[tipocomprobante] [int] NOT NULL,
	[nrocomprobante] [char](12) NULL,
	[tipofactura] [char](1) NULL,
	[totalimporte] [numeric](18, 2) NULL,
	[cancelado] [numeric](18, 2) NULL,
	[fecha1venc] [datetime] NULL,
	[fecha2venc] [datetime] NULL,
	[estado] [char](1) NULL,
	[fechareal] [datetime] NULL,
	[centrocosto] [int] NULL,
	[DescripcionImporte] [varchar](255) NULL,
	[Moneda] [int] NULL,
	[ImporteOrigen] [numeric](18, 2) NULL,
	[idSistema] [int] NULL,
	[idVendedor] [int] NULL,
	[TC] [numeric](18, 2) NULL,
	[Observacion] [nvarchar](50) NULL,
	[ObservacionPresupuesto] [text] NULL,
	[ok] [int] NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PeriodoLiquidacion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PeriodoLiquidacion](
	[Codigo] [int] NOT NULL,
	[Descripcion] [varchar](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Periodos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Periodos](
	[id] [numeric](18, 0) IDENTITY(1,1) NOT NULL,
	[Periodo] [char](6) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PeriodosBase]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PeriodosBase](
	[id] [numeric](18, 0) IDENTITY(1,1) NOT NULL,
	[Periodo] [char](6) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PermisosUsuarios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PermisosUsuarios](
	[usuario] [int] NOT NULL,
	[grupo] [int] NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PO]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PO](
	[idtransaccion] [int] IDENTITY(1,1) NOT NULL,
	[idPo] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[fecha] [datetime] NOT NULL,
	[cliente] [int] NOT NULL,
	[idPaciente] [int] NOT NULL,
	[TipoConsulta] [int] NULL,
	[tipocomprobante] [int] NOT NULL,
	[nrocomprobante] [char](12) NULL,
	[tipofactura] [char](1) NULL,
	[totalimporte] [numeric](18, 2) NULL,
	[cancelado] [numeric](18, 2) NULL,
	[fecha1venc] [datetime] NULL,
	[fecha2venc] [datetime] NULL,
	[estado] [char](1) NULL,
	[fechareal] [datetime] NULL,
	[centrocosto] [int] NULL,
	[DescripcionImporte] [varchar](255) NULL,
	[Moneda] [int] NULL,
	[ImporteOrigen] [numeric](18, 2) NULL,
	[idSistema] [int] NULL,
	[idVendedor] [int] NULL,
	[TC] [numeric](18, 2) NULL,
	[Observacion] [nvarchar](50) NULL,
	[ObservacionPresupuesto] [text] NULL,
	[ok] [int] NULL,
	[poInterna] [varchar](20) NULL,
	[poProveedor] [varchar](20) NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Polizas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Polizas](
	[idPoliza] [int] IDENTITY(1,1) NOT NULL,
	[Concepto] [char](3) NULL,
	[Desde] [datetime] NULL,
	[Hasta] [datetime] NULL,
	[Descripcion] [char](25) NULL,
	[Poliza] [char](75) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Precios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Precios](
	[idComponente] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [nvarchar](255) NULL,
	[Dolares] [nvarchar](255) NULL,
	[pesos] [money] NULL,
	[Tipo] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PresentacionesTarjetas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PresentacionesTarjetas](
	[tarjeta] [int] NOT NULL,
	[Periodo] [int] NOT NULL,
	[socio] [int] NULL,
	[entidad] [varchar](1) NULL,
	[Importe] [numeric](22, 6) NULL,
	[Numero] [numeric](16, 0) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Presupuestos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Presupuestos](
	[idtransaccion] [int] IDENTITY(1,1) NOT NULL,
	[idPresupuesto] [int] NOT NULL,
	[Sucursal] [int] NULL,
	[aniomes] [int] NOT NULL,
	[fecha] [datetime] NOT NULL,
	[cliente] [int] NOT NULL,
	[idPaciente] [int] NOT NULL,
	[TipoConsulta] [int] NULL,
	[tipocomprobante] [int] NOT NULL,
	[nrocomprobante] [char](12) NULL,
	[tipofactura] [char](1) NULL,
	[totalimporte] [numeric](18, 2) NULL,
	[cancelado] [numeric](18, 2) NULL,
	[fecha1venc] [datetime] NULL,
	[fecha2venc] [datetime] NULL,
	[estado] [char](1) NULL,
	[fechareal] [datetime] NULL,
	[centrocosto] [int] NULL,
	[DescripcionImporte] [varchar](255) NULL,
	[Moneda] [int] NULL,
	[ImporteOrigen] [numeric](18, 2) NULL,
	[idSistema] [int] NULL,
	[idVendedor] [int] NULL,
	[TC] [numeric](18, 2) NULL,
	[Observacion] [nvarchar](50) NULL,
	[ObservacionPresupuesto] [text] NULL,
	[ok] [int] NULL,
	[idLeyenda] [int] NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Procedencias]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Procedencias](
	[idProcedencia] [int] IDENTITY(0,1) NOT NULL,
	[Descripcion] [varchar](50) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[proclip]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[proclip](
	[CODIG] [float] NULL,
	[RAZON] [nvarchar](30) NULL,
	[RESU] [nvarchar](10) NULL,
	[DOMIC] [nvarchar](25) NULL,
	[LOCAL] [nvarchar](25) NULL,
	[PROV] [nvarchar](20) NULL,
	[PROV1] [float] NULL,
	[PC_POS] [nvarchar](1) NULL,
	[C_POS] [float] NULL,
	[MC_POS] [nvarchar](3) NULL,
	[TELEF] [nvarchar](14) NULL,
	[TELEF1] [nvarchar](14) NULL,
	[TELEF2] [nvarchar](14) NULL,
	[C_IVA] [float] NULL,
	[CUIT] [nvarchar](14) NULL,
	[CUENTA] [float] NULL,
	[PASO] [bit] NOT NULL,
	[PAIS] [float] NULL,
	[MAIL] [nvarchar](30) NULL,
	[VENDE] [nvarchar](3) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Profesiones]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Profesiones](
	[Profesion] [int] NOT NULL,
	[Descripcion] [char](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[prpVarios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[prpVarios](
	[idtransaccion] [int] NOT NULL,
	[Codigo] [int] NULL,
 CONSTRAINT [PK_prpVarios] PRIMARY KEY CLUSTERED 
(
	[idtransaccion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[PuntosdeVenta]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PuntosdeVenta](
	[Computer] [varchar](50) NULL,
	[PuntodeVenta] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[rcDobles]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[rcDobles](
	[idOperacion] [int] NULL,
	[Periodo] [int] NULL,
	[adherente] [int] NULL,
	[cantidad] [int] NULL,
	[IdTransaccion] [int] NOT NULL,
	[socio] [int] NOT NULL,
	[Entidad] [int] NOT NULL,
	[Fecha] [datetime] NOT NULL,
	[Concepto] [char](3) NOT NULL,
	[PuntodeVenta] [char](14) NULL,
	[DocumentoNumero] [char](14) NULL,
	[FechaRendicion] [datetime] NULL,
	[Rendicion] [char](14) NULL,
	[importe] [numeric](18, 2) NULL,
	[Cancelado] [numeric](18, 2) NULL,
	[vencimiento] [datetime] NULL,
	[Cobrador] [int] NULL,
	[Serie] [char](10) NULL,
	[idCancelada] [numeric](18, 0) NULL,
	[idOpCobrador] [numeric](18, 0) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Recertificaciones]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Recertificaciones](
	[idCampo] [int] NOT NULL,
	[Socio] [int] NULL,
	[Periodo] [int] NULL,
	[fRecertificacion] [datetime] NULL,
	[fEgresado] [datetime] NULL,
	[Universidad] [varchar](50) NULL,
	[Colegio] [varchar](50) NULL,
	[Categoria] [varchar](50) NULL,
	[entidad] [char](10) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[RechaMaster]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[RechaMaster](
	[periodo] [int] NULL,
	[socio] [int] NULL,
	[entidad] [int] NULL,
	[importe] [int] NULL,
	[detalle] [varchar](max) NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[RechaVisa]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[RechaVisa](
	[periodo] [int] NULL,
	[socio] [int] NULL,
	[entidad] [int] NULL,
	[importe] [int] NULL,
	[detalle] [varchar](max) NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Rechazos_master]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Rechazos_master](
	[TextoMaster] [varchar](max) NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[rechazosMaster_not used]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[rechazosMaster_not used](
	[identifica] [varchar](50) NULL,
	[tarjetaNueva] [varchar](50) NULL,
	[TarjetaOrigen] [varchar](50) NULL,
	[cantidad] [varchar](50) NULL,
	[cuotas] [varchar](50) NULL,
	[codigo] [varchar](50) NULL,
	[importe] [varchar](50) NULL,
	[observacion] [varchar](max) NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[RechazosVisa]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[RechazosVisa](
	[Texto] [varchar](max) NULL,
	[Periodo] [int] NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Recibos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Recibos](
	[idtransaccion] [numeric](18, 0) IDENTITY(1,1) NOT NULL,
	[idTransaccionMes] [numeric](10, 0) NULL,
	[Numero] [numeric](10, 0) NULL,
	[Fecha] [datetime] NULL,
	[Cobrador] [int] NULL,
	[idTransaccionRecibo] [numeric](18, 0) NULL,
	[Activo] [numeric](18, 0) NULL,
	[fechaRemplazo] [datetime] NULL,
	[idOperacion] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Recibos0]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Recibos0](
	[idliquidacion] [int] NOT NULL,
	[Legajo] [int] NULL,
	[Item] [int] NOT NULL,
	[Concepto] [int] NULL,
	[Horas] [decimal](18, 2) NULL,
	[Importe] [decimal](18, 2) NULL,
	[TipoCalculo] [char](1) NULL,
	[origen] [char](1) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[RecibosDA]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[RecibosDA](
	[idOperacion] [int] IDENTITY(1,1) NOT NULL,
	[pDesde] [int] NULL,
	[PHasta] [int] NULL,
	[cDesde] [int] NULL,
	[cHasta] [int] NULL,
	[fecha] [datetime] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[RecibosLev]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[RecibosLev](
	[idTransaccionRecibos] [numeric](18, 0) NOT NULL,
	[recibo_Numero] [numeric](10, 0) NULL,
	[IdTransaccion] [int] NOT NULL,
	[socio] [int] NOT NULL,
	[Entidad] [int] NOT NULL,
	[Fecha] [datetime] NOT NULL,
	[Concepto] [char](3) NOT NULL,
	[PuntodeVenta] [char](14) NULL,
	[DocumentoNumero] [char](14) NULL,
	[FechaRendicion] [datetime] NULL,
	[Rendicion] [char](14) NULL,
	[importe] [numeric](18, 2) NULL,
	[Cancelado] [numeric](18, 2) NULL,
	[vencimiento] [datetime] NULL,
	[Cobrador] [int] NULL,
	[Serie] [char](4) NULL,
	[idCancelada] [numeric](18, 0) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[RecibosProvisoriosProcesados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[RecibosProvisoriosProcesados](
	[idtransaccion] [decimal](18, 0) NOT NULL,
	[idTransaccionMes] [decimal](10, 0) NULL,
	[Numero] [decimal](10, 0) NULL,
	[Fecha] [datetime] NULL,
	[Cobrador] [int] NULL,
	[idTransaccionRecibo] [decimal](18, 0) NULL,
	[Activo] [decimal](18, 0) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Reimputa Muni]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Reimputa Muni](
	[idTransaccion] [numeric](18, 0) NULL,
	[Socio] [int] NULL,
	[Descuentos] [int] NULL,
	[Periodo] [int] NULL,
	[Importe_Total] [numeric](18, 2) NULL,
	[DescuentoPeriodo] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Reparticiones]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Reparticiones](
	[Reparticion] [int] NOT NULL,
	[Nombre] [char](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[RepMuni]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[RepMuni](
	[Codigo] [float] NULL,
	[Subcodigo] [float] NULL,
	[Unificador] [float] NULL,
	[Descripcion] [nvarchar](255) NULL,
	[Grupo] [nvarchar](255) NULL,
	[Resumido] [nvarchar](25) NULL,
	[uniAlfa] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Reportes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Reportes](
	[idReporte] [int] IDENTITY(1,1) NOT NULL,
	[Detalle] [varchar](50) NULL,
	[rpt] [varchar](50) NULL,
	[Modulo] [varchar](50) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Repuestos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Repuestos](
	[idService] [int] NULL,
	[idCampo] [int] IDENTITY(1,1) NOT NULL,
	[idComponente] [int] NULL,
	[Cantidad] [int] NULL,
	[Precio] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[RPT_MAYORESCUENTAS]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[RPT_MAYORESCUENTAS](
	[computer] [varchar](100) NOT NULL,
	[tipo] [int] NOT NULL,
	[fecha] [datetime] NULL,
	[asiento] [int] NULL,
	[idtipoasiento] [int] NULL,
	[tipoasiento] [varchar](50) NULL,
	[detalle] [varchar](70) NULL,
	[debe] [numeric](18, 2) NULL,
	[haber] [numeric](18, 2) NULL,
	[saldo] [numeric](18, 2) NULL,
	[ctaini] [int] NULL,
	[ctafin] [int] NULL,
	[cuenta] [int] NULL,
	[apertura] [varchar](20) NULL,
	[saldoapertura] [numeric](18, 2) NULL,
	[DescCuenta] [varchar](100) NULL,
	[DescCentro] [varchar](100) NULL,
	[Detallediario] [varchar](100) NULL,
	[Detallevt] [varchar](100) NULL,
	[Numerovt] [varchar](100) NULL,
	[item] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[RPT_SaldosCuentas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[RPT_SaldosCuentas](
	[computer] [varchar](100) NOT NULL,
	[tipo] [int] NOT NULL,
	[cuenta] [int] NULL,
	[descripcion] [varchar](50) NULL,
	[apertura] [numeric](18, 2) NULL,
	[debe] [numeric](18, 2) NULL,
	[haber] [numeric](18, 2) NULL,
	[saldo] [numeric](18, 2) NULL,
	[ubbalance] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Rubros_Contablidad]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Rubros_Contablidad](
	[Rubro] [int] NULL,
	[Descripcion] [varchar](50) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Services]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Services](
	[idService] [int] IDENTITY(1,1) NOT NULL,
	[idModelo] [int] NULL,
	[Entra] [datetime] NULL,
	[idRecepcion] [int] NULL,
	[Prometido] [datetime] NULL,
	[Observacion1] [text] NULL,
	[Presupuesto] [datetime] NULL,
	[Observacion2] [text] NULL,
	[Aceptado] [datetime] NULL,
	[Rechazado] [datetime] NULL,
	[Observacion3] [text] NULL,
	[Reparado] [datetime] NULL,
	[Observacion4] [text] NULL,
	[idDistribuidor] [int] NULL,
	[idTecnico] [int] NULL,
	[idServiceAnt] [int] NULL,
	[Fingarantia] [datetime] NULL,
	[idfalla1] [int] NULL,
	[idfalla2] [int] NULL,
	[idfalla3] [int] NULL,
	[idfalla4] [int] NULL,
	[idfalla5] [int] NULL,
	[idfalla6] [int] NULL,
	[obseIngreso] [text] NULL,
	[ObsePresupuesto] [text] NULL,
	[Pesos] [numeric](18, 2) NULL,
	[Dolares] [numeric](18, 2) NULL,
	[idtecnicoPresupuesto] [int] NULL,
	[ObseAceptaRechazo] [text] NULL,
	[AceptaRechazo] [int] NULL,
	[FinReparacion] [datetime] NULL,
	[idTecnicoFinReparacion] [int] NULL,
	[ObseFinReparacion] [text] NULL,
	[Entrega] [datetime] NULL,
	[idRecepcionEntrega] [int] NULL,
	[ObseEntrega] [text] NULL,
	[idPaciente] [int] NULL,
	[Obsereservada] [nvarchar](50) NULL,
	[idleyenda] [int] NULL,
	[texto] [text] NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Sexos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Sexos](
	[Sexo] [tinyint] NOT NULL,
	[Descripcion] [char](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[SignosComprobanteModelo]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SignosComprobanteModelo](
	[codigo] [int] NOT NULL,
	[descripcion] [varchar](25) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[SinCobertura]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SinCobertura](
	[Aniomes] [int] NULL,
	[Entidad] [int] NULL,
	[Socio] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Sindicatos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Sindicatos](
	[sindicato] [int] IDENTITY(1,1) NOT NULL,
	[descripcion] [varchar](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Sistemas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Sistemas](
	[idSistema] [int] IDENTITY(0,1) NOT NULL,
	[Descripcion] [varchar](25) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[SistemasJubilacion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SistemasJubilacion](
	[sistemajubilacion] [int] NOT NULL,
	[descripcion] [varchar](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Situaciones]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Situaciones](
	[situacion] [int] NOT NULL,
	[descripcion] [varchar](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[socios__]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[socios__](
	[socio] [int] NOT NULL,
	[Apellido] [char](40) NULL,
	[nombre] [char](40) NULL,
	[tipodocto] [tinyint] NULL,
	[numedocto] [int] NULL,
	[Nacionalidad] [int] NULL,
	[Sexo] [tinyint] NULL,
	[Grupo] [char](1) NULL,
	[gDesde] [datetime] NULL,
	[nAma] [char](10) NULL,
	[DomicilioPrincipal] [char](1) NULL,
	[Domicilio] [varchar](60) NULL,
	[cpostal] [varchar](8) NULL,
	[localidad] [varchar](50) NULL,
	[provincia] [int] NULL,
	[pais] [int] NULL,
	[telefono] [varchar](100) NULL,
	[Fax] [varchar](100) NULL,
	[Email] [varchar](100) NULL,
	[EmailAlt1] [varchar](50) NULL,
	[EmailAlt2] [varchar](50) NULL,
	[EmailAlt3] [varchar](50) NULL,
	[EstadoCivil] [tinyint] NULL,
	[Nacido] [datetime] NULL,
	[mesRecibido] [tinyint] NULL,
	[anoRecibido] [int] NULL,
	[Domicilio_consultorio] [char](40) NULL,
	[cpostal_consultorio] [varchar](8) NULL,
	[localidad_consultorio] [varchar](50) NULL,
	[provincia_consultorio] [int] NULL,
	[pais_consultorio] [int] NULL,
	[telefono_consultorio] [varchar](50) NULL,
	[Fax_Consultorio] [varchar](50) NULL,
	[Observa1] [nvarchar](4000) NULL,
	[Observa2] [char](60) NULL,
	[Tarjeta] [int] NULL,
	[numero] [char](16) NULL,
	[Adherido] [char](1) NULL,
	[Vencimiento] [datetime] NULL,
	[FechaBaja] [datetime] NULL,
	[cuil] [char](13) NULL,
	[DebitarDesde] [datetime] NULL,
	[FechaIngreso] [datetime] NULL,
	[Residente] [char](1) NULL,
	[pr] [char](10) NULL,
	[prc] [char](10) NULL,
	[cpais] [char](10) NULL,
	[cpaisc] [char](10) NULL,
	[tipoMatricula] [int] NULL,
	[nroMatricula] [char](12) NULL,
	[fresidencia] [datetime] NULL,
	[fechanac] [datetime] NULL,
	[nacdos] [char](10) NULL,
	[tdDos] [char](10) NULL,
	[ndDos] [varchar](50) NULL,
	[amaDos] [varchar](50) NULL,
	[Cobrador] [int] NULL,
	[Matricula] [varchar](50) NULL,
	[pairDos] [char](10) NULL,
	[PaicDos] [char](10) NULL,
	[tIpoMatricula2] [int] NULL,
	[NroMatricula2] [char](12) NULL,
	[domicEnvio] [tinyint] NULL,
	[FechaGrupo] [datetime] NULL,
	[fResidente] [datetime] NULL,
	[identificador] [datetime] NULL,
	[ultimageneracion] [datetime] NULL,
	[seguro] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[SociosAPP]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SociosAPP](
	[documento] [int] NULL,
	[nombre] [varchar](40) NULL,
	[apellido] [varchar](40) NULL,
	[email] [varchar](100) NULL,
	[nacido] [nvarchar](4000) NULL,
	[matricula] [varchar](12) NULL,
	[matriculaprovincia] [varchar](12) NULL,
	[domicilio] [varchar](60) NULL,
	[localidad] [varchar](50) NULL,
	[provincia] [varchar](12) NULL,
	[codigopostal] [varchar](8) NULL,
	[Pais] [int] NOT NULL,
	[telefonofijo] [varchar](4) NULL,
	[celular] [varchar](1) NOT NULL,
	[residente] [int] NOT NULL,
	[inicioResidencia] [datetime] NULL,
	[aceptoseguro] [int] NULL,
	[grupo] [char](1) NULL,
	[socio] [int] NOT NULL,
	[saldo] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[SociosBaseJuicios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SociosBaseJuicios](
	[Juicio] [int] NULL,
	[entidad] [int] NULL,
	[Socio] [int] NULL,
	[idCampo] [int] IDENTITY(1,1) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[stConsolidado]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[stConsolidado](
	[Notas] [varchar](30) NULL,
	[Descripcion] [varchar](60) NULL,
	[Stock] [numeric](38, 2) NULL,
	[pañoles] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[stpTotal]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[stpTotal](
	[notas] [varchar](30) NULL,
	[Descripcion] [varchar](60) NULL,
	[Stock] [numeric](38, 2) NULL,
	[Articulo] [varchar](15) NOT NULL,
	[fechainactivo] [datetime] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TABREP]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TABREP](
	[Col001] [varchar](8000) NULL,
	[Col002] [varchar](8000) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TareasCumplidas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TareasCumplidas](
	[tareacumplida] [int] IDENTITY(1,1) NOT NULL,
	[descripcion] [varchar](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tarjetas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tarjetas](
	[idTarjeta] [int] NOT NULL,
	[Descripcion] [char](20) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TBFLI]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TBFLI](
	[FL_FLIA] [float] NULL,
	[FL_SFLI] [float] NULL,
	[FL_DESF] [nvarchar](30) NULL,
	[FL_DESS] [nvarchar](30) NULL,
	[CAP] [nvarchar](3) NULL,
	[ORD] [float] NULL,
	[CA1] [float] NULL,
	[CA2] [float] NULL,
	[CA3] [float] NULL,
	[CA4] [float] NULL,
	[CA5] [float] NULL,
	[CA6] [float] NULL,
	[TIBA] [nvarchar](20) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TBLPR]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TBLPR](
	[LP_COD] [float] NULL,
	[LP_DESC] [nvarchar](30) NULL,
	[LP_MONE] [nvarchar](1) NULL,
	[LP_FEMO] [smalldatetime] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[tciva]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[tciva](
	[IdCiva] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [char](25) NULL,
	[Ganancias] [int] NULL,
	[TipoFacturaCompras] [char](1) NULL,
	[TipoFacturaVentas] [char](1) NULL,
	[Resumido] [char](4) NULL,
	[CodigoImpuesto] [varchar](50) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Tecnicos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tecnicos](
	[idTecnico] [int] IDENTITY(0,1) NOT NULL,
	[Descripcion] [char](10) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Temp_Cobranzas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Temp_Cobranzas](
	[computer] [varchar](100) NOT NULL,
	[idTransaccion] [numeric](18, 0) NULL,
	[cuenta] [int] NULL,
	[Importe] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TEMP_COBROS]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TEMP_COBROS](
	[Col001] [varchar](255) NULL,
	[Col002] [varchar](255) NULL,
	[Col003] [varchar](255) NULL,
	[Col004] [varchar](255) NULL,
	[Col005] [varchar](255) NULL,
	[Col006] [varchar](255) NULL,
	[Col007] [varchar](255) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Temp_Cuil]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Temp_Cuil](
	[Documento] [char](9) NULL,
	[TipoDocumento] [char](2) NULL,
	[SubNumero] [char](3) NULL,
	[FichaMunicipal] [char](6) NULL,
	[Grupo] [char](5) NULL,
	[Clase] [char](13) NULL,
	[ApellidoNombre] [char](50) NULL,
	[Cuil] [char](15) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Temp_Datos_Cuil]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Temp_Datos_Cuil](
	[Numerador] [numeric](18, 0) IDENTITY(1,1) NOT NULL,
	[Col001] [char](6) NULL,
	[Col002] [char](8) NULL,
	[Col003] [char](8) NULL,
	[Col004] [char](1) NULL,
	[Col005] [char](2) NULL,
	[Col006] [char](6) NULL,
	[Col007] [char](2) NULL,
	[Col008] [char](2) NULL,
	[Col009] [char](3) NULL,
	[Col010] [char](4) NULL,
	[Col011] [char](24) NULL,
	[Col012] [char](3) NULL,
	[Col013] [char](7) NULL,
	[Col014] [char](4) NULL,
	[Col015] [char](11) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Temp_DobleCargo]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Temp_DobleCargo](
	[FICHA_MUNI] [float] NULL,
	[F2] [nvarchar](255) NULL,
	[SUB] [float] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Temp_Empleados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Temp_Empleados](
	[Apellido] [varchar](20) NULL,
	[Nombre] [varchar](30) NULL,
	[TipoDocumento] [int] NULL,
	[NroDocumento] [numeric](18, 0) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Temp_etiquetas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Temp_etiquetas](
	[Computer] [char](20) NULL,
	[entidad] [int] NULL,
	[socio] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Temp_Hospitales]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Temp_Hospitales](
	[Hospital] [varchar](255) NULL,
	[Descripcion] [varchar](255) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Temp_Imputacion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Temp_Imputacion](
	[Periodo] [int] NULL,
	[socio] [int] NOT NULL,
	[concepto] [char](3) NOT NULL,
	[descripcion] [char](30) NULL,
	[modalidad] [char](1) NULL,
	[Cantidad] [numeric](18, 2) NULL,
	[importe] [numeric](18, 2) NULL,
	[MES] [numeric](18, 2) NOT NULL,
	[TotalPorcentaje] [numeric](18, 2) NOT NULL,
	[Conceptos] [int] NOT NULL,
	[Parcial] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Temp_Ingreso_Hosp]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Temp_Ingreso_Hosp](
	[Col001] [char](6) NULL,
	[Col002] [char](8) NULL,
	[Col003] [char](1) NULL,
	[Col004] [char](2) NULL,
	[Col005] [char](3) NULL,
	[Col006] [char](1) NULL,
	[Col007] [char](9) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[temp_ingreso_hosp_2]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[temp_ingreso_hosp_2](
	[Col001] [char](18) NULL,
	[Col002] [char](8) NULL,
	[Col003] [char](1) NULL,
	[Col004] [char](2) NULL,
	[Col005] [char](3) NULL,
	[Col006] [char](1) NULL,
	[Col007] [char](6) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Temp_Memm]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Temp_Memm](
	[Col001] [char](35) NULL,
	[Col002] [char](41) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Temp_N580]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Temp_N580](
	[Col001] [char](18) NULL,
	[Col002] [char](61) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Temp_Rendicion_cheques]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Temp_Rendicion_cheques](
	[Recibo] [float] NULL,
	[Socio] [float] NULL,
	[Nombre] [nvarchar](255) NULL,
	[Banco] [float] NULL,
	[CP] [float] NULL,
	[Numero] [nvarchar](255) NULL,
	[Fecha] [smalldatetime] NULL,
	[Importe] [money] NULL,
	[idopCobrador] [float] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Temp_Rendicion_efectivo]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Temp_Rendicion_efectivo](
	[Recibo] [float] NULL,
	[Socio] [float] NULL,
	[Nombre] [nvarchar](255) NULL,
	[Tipo] [nvarchar](255) NULL,
	[Importe] [money] NULL,
	[idopCobrador] [float] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Temp_Socios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Temp_Socios](
	[NroSocio] [int] NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Temp_Vencimientos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Temp_Vencimientos](
	[idCampo] [int] NULL,
	[Fecha] [datetime] NULL,
	[Vto] [datetime] NULL,
	[Cantidad] [numeric](18, 2) NULL,
	[ComputerName] [varchar](50) NULL,
	[Saldo] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TempAjustes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TempAjustes](
	[idtransaccion] [int] NOT NULL,
	[importeOrigen] [numeric](18, 2) NULL,
	[canceladoOrigen] [numeric](18, 2) NULL,
	[acp] [numeric](38, 2) NULL,
	[ajustado] [numeric](38, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TempFacturacionMateriales]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TempFacturacionMateriales](
	[idObra] [int] NULL,
	[idArticulo] [int] NULL,
	[ArticuloFactura] [varchar](50) NULL,
	[articuloProveedor] [varchar](50) NULL,
	[cantidad] [numeric](18, 2) NULL,
	[precio] [numeric](18, 2) NULL,
	[Detalle] [varchar](255) NULL,
	[idCampoOrigen] [int] NULL,
	[idCampoDestino] [int] NULL,
	[idCampo] [int] NULL,
	[idOperacion] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TempFacturacionMO]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TempFacturacionMO](
	[idObra] [int] NULL,
	[idArticulo] [int] NULL,
	[ArticuloFactura] [varchar](50) NULL,
	[articuloProveedor] [varchar](50) NULL,
	[cantidad] [numeric](18, 2) NULL,
	[precio] [numeric](18, 2) NULL,
	[Detalle] [varchar](2000) NULL,
	[idCampoOrigen] [int] NULL,
	[idCampoDestino] [int] NULL,
	[Marca] [int] NULL,
	[idCampo] [int] IDENTITY(1,1) NOT NULL,
	[idOperacion] [int] NULL,
	[idOperacionPresupuesto] [int] NULL,
	[MonedaPre] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TempFacturacionMOPresupuestos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TempFacturacionMOPresupuestos](
	[idObra] [int] NULL,
	[idArticulo] [int] NULL,
	[ArticuloFactura] [varchar](50) NULL,
	[articuloProveedor] [varchar](50) NULL,
	[cantidad] [numeric](18, 2) NULL,
	[precio] [numeric](18, 2) NULL,
	[Detalle] [varchar](2000) NULL,
	[idCampoOrigen] [int] NULL,
	[idCampoDestino] [int] NULL,
	[Marca] [int] NULL,
	[idCampo] [int] IDENTITY(1,1) NOT NULL,
	[idOperacion] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TempHangarajes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TempHangarajes](
	[Matricula] [varchar](20) NULL,
	[Pesos] [numeric](18, 2) NULL,
	[Dolares] [numeric](18, 2) NULL,
	[Iva] [numeric](18, 2) NULL,
	[PIB] [numeric](18, 2) NULL,
	[Total] [numeric](18, 2) NULL,
	[Letras] [varchar](100) NULL,
	[TC] [numeric](18, 2) NULL,
	[leyenda] [int] NULL,
	[Maquina] [varchar](100) NULL,
	[aPIB] [numeric](18, 2) NULL,
	[aIva] [numeric](18, 2) NULL,
	[Dias] [int] NULL,
	[vence] [datetime] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TempRS]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TempRS](
	[recibo] [int] NOT NULL,
	[Legajo] [int] NULL,
	[Concepto] [int] NULL,
	[Horas] [decimal](18, 2) NULL,
	[Importe] [decimal](18, 2) NULL,
	[DescConcepto] [varchar](21) NULL,
	[tipoconcepto] [int] NULL,
	[Apellido] [varchar](20) NOT NULL,
	[Nombre] [varchar](20) NOT NULL,
	[Cuil] [char](13) NULL,
	[Jubilado] [int] NOT NULL,
	[CalificacionProfesional] [varchar](30) NULL,
	[FechaIngreso] [datetime] NOT NULL,
	[Categoria] [varchar](30) NULL,
	[RemunAsignada] [decimal](18, 2) NULL,
	[TotalRemuReten] [decimal](38, 2) NOT NULL,
	[TotalRemuExen] [decimal](38, 2) NOT NULL,
	[TotalDescuentos] [decimal](38, 2) NOT NULL,
	[Letras] [varchar](255) NULL,
	[descripcion] [varchar](30) NULL,
	[firma] [varchar](8) NULL,
	[fe] [varchar](15) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TipCompModItems]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TipCompModItems](
	[codigo] [int] NOT NULL,
	[concepto] [char](5) NOT NULL,
	[signo] [int] NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TipConcLiq]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TipConcLiq](
	[concepto] [int] NOT NULL,
	[descripcion] [varchar](50) NULL,
	[Multiplicador] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TipConcRemun]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TipConcRemun](
	[concepto] [int] NOT NULL,
	[descripcion] [varchar](50) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TiposAcciones]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TiposAcciones](
	[tipo] [int] NOT NULL,
	[descripcion] [varchar](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TiposComprobantesModelo]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TiposComprobantesModelo](
	[codigo] [int] IDENTITY(1,1) NOT NULL,
	[descripcion] [varchar](25) NOT NULL,
	[concepto] [char](3) NULL,
	[signo] [int] NULL,
	[tipo] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TiposCuentaContable]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TiposCuentaContable](
	[tipocuenta] [tinyint] NOT NULL,
	[descripcion] [char](35) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TiposdeMovimiento]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TiposdeMovimiento](
	[idTipodeMovimiento] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [char](35) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TiposdeOperacion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TiposdeOperacion](
	[idTipodeOperacion] [int] NOT NULL,
	[Descripcion] [varchar](35) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TiposDocumento]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TiposDocumento](
	[tipodocto] [tinyint] NOT NULL,
	[Descripcion] [char](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TiposMatricula]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TiposMatricula](
	[tipoMatricula] [tinyint] NOT NULL,
	[Descripcion] [char](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TiposMovimientoStock]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TiposMovimientoStock](
	[idTipoMovimientoStock] [int] IDENTITY(0,1) NOT NULL,
	[Descripcion] [varchar](50) NULL,
	[idDepositos] [int] NULL,
	[signo] [int] NULL,
	[activo] [int] NULL,
	[modulo] [int] NULL,
	[Aduana] [int] NULL,
	[Cliente] [int] NULL,
	[Obra] [int] NOT NULL,
	[ESA] [varchar](1) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TiposProveedor]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TiposProveedor](
	[idTipo] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [char](4) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TiposTel]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TiposTel](
	[idTipo] [decimal](18, 0) NOT NULL,
	[Descripcion] [varchar](50) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TiposTransaccion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TiposTransaccion](
	[idTipoTransaccion] [int] NOT NULL,
	[Descripcion] [varchar](35) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[tipventModItems]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[tipventModItems](
	[codigo] [int] NOT NULL,
	[concepto] [char](5) NOT NULL,
	[signo] [int] NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[tIvacompras]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[tIvacompras](
	[fecha] [datetime] NOT NULL,
	[Comp] [char](5) NOT NULL,
	[nrocomprobante] [varchar](13) NULL,
	[tipofactura] [char](1) NULL,
	[razonsocial] [varchar](30) NULL,
	[cuit] [char](14) NULL,
	[dciva] [char](4) NULL,
	[total] [numeric](29, 2) NULL,
	[Neto] [numeric](38, 2) NOT NULL,
	[Exento] [numeric](38, 2) NOT NULL,
	[Iva] [numeric](38, 2) NOT NULL,
	[NG21] [numeric](38, 2) NOT NULL,
	[Iva27] [numeric](38, 2) NOT NULL,
	[NG27] [numeric](38, 2) NOT NULL,
	[Iva10] [numeric](38, 2) NOT NULL,
	[NG105] [numeric](38, 2) NOT NULL,
	[NG0] [numeric](38, 2) NOT NULL,
	[Iva5] [numeric](38, 2) NOT NULL,
	[PibC] [numeric](38, 2) NOT NULL,
	[PIV] [numeric](38, 2) NOT NULL,
	[PIB] [numeric](38, 2) NOT NULL,
	[PAB] [numeric](38, 2) NOT NULL,
	[PAC] [numeric](38, 2) NOT NULL,
	[II] [numeric](38, 2) NOT NULL,
	[BII] [numeric](38, 2) NOT NULL,
	[GSI] [numeric](38, 2) NOT NULL,
	[Monotributo] [numeric](38, 2) NOT NULL,
	[idoperacion] [int] NULL,
	[totalNeto] [numeric](8, 2) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[tmC]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[tmC](
	[idMov] [int] IDENTITY(1,1) NOT NULL,
	[comp] [varchar](5) NULL,
	[c_mov] [int] NULL,
	[c_movn] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[tmP]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[tmP](
	[idMov] [int] IDENTITY(1,1) NOT NULL,
	[comp] [varchar](5) NULL,
	[c_mov] [int] NULL,
	[c_movn] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[tProvincias]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[tProvincias](
	[provincia] [int] IDENTITY(1,1) NOT NULL,
	[Descripcion] [char](30) NULL,
	[pClip] [int] NULL,
	[CLILETRA] [varchar](50) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TransaccionesRechazadas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TransaccionesRechazadas](
	[idtransaccion] [int] NOT NULL,
	[detalle] [varchar](50) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Transportes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Transportes](
	[idTransporte] [int] IDENTITY(1,1) NOT NULL,
	[razonsocial] [varchar](30) NULL,
	[contacto] [varchar](30) NULL,
	[domicilio] [varchar](30) NULL,
	[localidad] [varchar](30) NULL,
	[provincia] [int] NULL,
	[cpostal] [varchar](8) NULL,
	[telefono] [varchar](30) NULL,
	[telefonoii] [varchar](30) NULL,
	[telefonoiii] [varchar](30) NULL,
	[civa] [int] NULL,
	[cuit] [varchar](14) NULL,
	[cuenta] [int] NULL,
	[email] [varchar](30) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[TransportesClientes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TransportesClientes](
	[idCampo] [int] IDENTITY(1,1) NOT NULL,
	[idCliente] [int] NULL,
	[idTransporte] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[tRubros]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[tRubros](
	[idRubro] [float] NULL,
	[Descripcion] [nvarchar](255) NULL,
	[Capitulo] [nvarchar](255) NULL,
	[Titulo] [nvarchar](255) NULL,
	[GranTitulo] [nvarchar](255) NULL,
	[Control] [char](40) NULL,
	[idCapitulo] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ubResultado]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ubResultado](
	[ubResultado] [int] NULL,
	[Descripcion] [varchar](100) NULL,
	[agrupar] [int] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[user]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[user](
	[id] [int] IDENTITY(1,1) NOT NULL,
	[username] [varchar](80) NOT NULL,
	[password_hash] [varchar](128) NOT NULL,
PRIMARY KEY CLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
UNIQUE NONCLUSTERED 
(
	[username] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Users]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Users](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[Email] [nvarchar](256) NULL,
	[EmailNormalizado] [nvarchar](256) NULL,
	[PasswordHash] [nvarchar](max) NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Usuarios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Usuarios](
	[idUsuario] [int] IDENTITY(1,1) NOT NULL,
	[uName] [char](10) NULL,
	[uPwd] [char](10) NULL,
	[sqlName] [char](10) NULL,
	[sqlPwd] [char](10) NULL,
	[idusuariotesoreria] [int] NULL,
	[vendedor] [varchar](3) NULL,
 CONSTRAINT [PK_Usuarios] PRIMARY KEY CLUSTERED 
(
	[idUsuario] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Usuarios_Tesoreria]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Usuarios_Tesoreria](
	[idUsuario] [int] NOT NULL,
	[Caja] [int] NOT NULL,
	[uName] [char](20) NULL,
	[uPwd] [char](10) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[usuarios_web]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[usuarios_web](
	[id_usuario] [int] IDENTITY(1,1) NOT NULL,
	[username] [varchar](10) NULL,
	[password_hash] [varchar](max) NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Valor_Dolar]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Valor_Dolar](
	[aniomes] [nvarchar](50) NULL,
	[referencia] [nvarchar](50) NULL,
	[dolar] [nvarchar](50) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[valoresHangaraje]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[valoresHangaraje](
	[idMatricula] [int] NOT NULL,
	[Pesos] [numeric](18, 2) NULL,
	[Dolares] [numeric](18, 2) NULL,
	[chkLeyenda] [int] NULL,
	[LeyendaPersonalizada] [varchar](255) NULL,
	[Desde] [datetime] NULL,
	[Hasta] [datetime] NULL,
 CONSTRAINT [PK_valoresHangaraje] PRIMARY KEY CLUSTERED 
(
	[idMatricula] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ValoresTesoreria]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ValoresTesoreria](
	[idTransaccion] [int] IDENTITY(1,1) NOT NULL,
	[idTransaccionOrigen] [int] NOT NULL,
	[TipoMovimiento] [int] NOT NULL,
	[idConcepto_Tesoreria] [int] NOT NULL,
	[FechaEmision] [datetime] NULL,
	[Vencimiento] [datetime] NULL,
	[Banco] [int] NULL,
	[Cuenta] [int] NULL,
	[Sucursal] [int] NULL,
	[Numero] [numeric](10, 0) NULL,
	[NumeroInterno] [int] NULL,
	[Firma] [char](60) NULL,
	[importe] [numeric](18, 2) NOT NULL,
	[Cancelado] [numeric](18, 2) NULL,
	[idOperador] [int] NOT NULL,
	[Observaciones] [varchar](255) NULL,
	[locked] [binary](50) NULL,
	[cobrador] [int] NULL,
	[idOpCobrador] [numeric](18, 0) NULL,
	[Corregido] [char](1) NULL,
	[tipocambio] [numeric](18, 2) NULL,
	[base] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ValoresTesoreriaAnulados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ValoresTesoreriaAnulados](
	[idTransaccion] [int] NOT NULL,
	[idTransaccionOrigen] [int] NOT NULL,
	[TipoMovimiento] [int] NOT NULL,
	[idConcepto_Tesoreria] [int] NOT NULL,
	[FechaEmision] [datetime] NULL,
	[Vencimiento] [datetime] NULL,
	[Banco] [int] NULL,
	[Cuenta] [int] NULL,
	[Sucursal] [int] NULL,
	[Numero] [numeric](10, 0) NULL,
	[NumeroInterno] [int] NULL,
	[Firma] [char](30) NULL,
	[importe] [numeric](18, 2) NOT NULL,
	[Cancelado] [numeric](18, 2) NULL,
	[idOperador] [int] NOT NULL,
	[Observaciones] [varchar](255) NULL,
	[locked] [binary](50) NULL,
	[cobrador] [int] NULL,
	[idOpCobrador] [numeric](18, 0) NULL,
	[Corregido] [char](1) NULL,
	[tipocambio] [numeric](18, 2) NULL,
	[base] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ValoresTesoreriaAnulados_MuniAses]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ValoresTesoreriaAnulados_MuniAses](
	[idTransaccion] [int] NOT NULL,
	[idTransaccionOrigen] [int] NOT NULL,
	[TipoMovimiento] [int] NOT NULL,
	[idConcepto_Tesoreria] [int] NOT NULL,
	[FechaEmision] [datetime] NULL,
	[Vencimiento] [datetime] NULL,
	[Banco] [int] NULL,
	[Cuenta] [int] NULL,
	[Sucursal] [int] NULL,
	[Numero] [numeric](10, 0) NULL,
	[NumeroInterno] [int] NULL,
	[Firma] [char](30) NULL,
	[importe] [numeric](18, 2) NOT NULL,
	[Cancelado] [numeric](18, 2) NULL,
	[idOperador] [int] NOT NULL,
	[Observaciones] [varchar](255) NULL,
	[locked] [binary](50) NULL,
	[cobrador] [int] NULL,
	[idOpCobrador] [numeric](18, 0) NULL,
	[Corregido] [char](1) NULL,
	[tipocambio] [numeric](18, 2) NULL,
	[base] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ValoresTesoreriaOPAnulados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ValoresTesoreriaOPAnulados](
	[idTransaccion] [int] NOT NULL,
	[idTransaccionOrigen] [int] NOT NULL,
	[TipoMovimiento] [int] NOT NULL,
	[idConcepto_Tesoreria] [int] NOT NULL,
	[FechaEmision] [datetime] NULL,
	[Vencimiento] [datetime] NULL,
	[Banco] [int] NULL,
	[Cuenta] [int] NULL,
	[Sucursal] [int] NULL,
	[Numero] [numeric](10, 0) NULL,
	[NumeroInterno] [int] NULL,
	[Firma] [char](30) NULL,
	[importe] [numeric](18, 2) NOT NULL,
	[Cancelado] [numeric](18, 2) NULL,
	[idOperador] [int] NOT NULL,
	[Observaciones] [varchar](255) NULL,
	[locked] [binary](50) NULL,
	[cobrador] [int] NULL,
	[idOpCobrador] [numeric](18, 0) NULL,
	[Corregido] [char](1) NULL,
	[tipocambio] [numeric](18, 2) NULL,
	[base] [numeric](18, 2) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ValoresTesoreriaPresentaciones]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ValoresTesoreriaPresentaciones](
	[idTransaccion] [int] IDENTITY(1,1) NOT NULL,
	[idTransaccionOrigen] [int] NOT NULL,
	[TipoMovimiento] [int] NOT NULL,
	[idConcepto_Tesoreria] [int] NOT NULL,
	[FechaEmision] [datetime] NULL,
	[Vencimiento] [datetime] NULL,
	[Banco] [int] NULL,
	[Cuenta] [int] NULL,
	[Sucursal] [int] NULL,
	[Numero] [numeric](18, 0) NULL,
	[NumeroInterno] [int] NULL,
	[Firma] [char](30) NULL,
	[importe] [numeric](18, 2) NOT NULL,
	[Cancelado] [numeric](18, 2) NULL,
	[idOperador] [int] NOT NULL,
	[Observaciones] [varchar](255) NULL,
	[locked] [binary](50) NULL,
	[cobrador] [int] NULL,
	[idOpCobrador] [numeric](18, 0) NULL,
	[Corregido] [char](1) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[vchVarios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[vchVarios](
	[idtransaccion] [int] NOT NULL,
	[Codigo] [int] NULL,
 CONSTRAINT [PK_vchVarios] PRIMARY KEY CLUSTERED 
(
	[idtransaccion] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, FILLFACTOR = 90) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[VenCliHeaderAnulados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[VenCliHeaderAnulados](
	[idtransaccion] [int] NOT NULL,
	[comprobante] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[fecha] [datetime] NOT NULL,
	[cliente] [int] NOT NULL,
	[tipocomprobante] [int] NOT NULL,
	[nrocomprobante] [char](12) NULL,
	[tipofactura] [char](1) NULL,
	[totalimporte] [numeric](18, 2) NOT NULL,
	[cancelado] [numeric](18, 2) NULL,
	[fecha1venc] [datetime] NULL,
	[fecha2venc] [datetime] NULL,
	[estado] [char](2) NULL,
	[fechareal] [datetime] NOT NULL,
	[centrocosto] [int] NULL,
	[DescripcionImporte] [varchar](255) NULL,
	[Moneda] [int] NULL,
	[ImporteOrigen] [numeric](18, 2) NULL,
	[TC] [numeric](18, 2) NULL,
	[doc_c] [numeric](18, 0) NULL,
	[CanceladoOrigen] [numeric](18, 2) NULL,
	[fechaAnulacion] [datetime] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[VenCliItemsAnulados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[VenCliItemsAnulados](
	[idTransaccion] [int] NULL,
	[comprobante] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[item] [int] NOT NULL,
	[concepto] [char](3) NOT NULL,
	[cuenta] [int] NOT NULL,
	[importe] [numeric](18, 2) NOT NULL,
	[BaseContable] [numeric](18, 2) NOT NULL,
	[Area] [int] NULL,
	[Detalle] [char](20) NULL,
	[Alicuota] [numeric](18, 2) NOT NULL,
	[Grilla] [varchar](30) NULL,
	[idCampo] [int] NOT NULL,
	[Base] [numeric](18, 2) NULL,
	[Fecha] [datetime] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[VenCliItemsAnuladosPedidos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[VenCliItemsAnuladosPedidos](
	[idTransaccion] [int] NULL,
	[comprobante] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[item] [int] NOT NULL,
	[concepto] [char](3) NOT NULL,
	[cuenta] [int] NOT NULL,
	[importe] [numeric](18, 2) NOT NULL,
	[BaseContable] [numeric](18, 2) NOT NULL,
	[Area] [int] NULL,
	[Detalle] [char](20) NULL,
	[Alicuota] [numeric](18, 2) NOT NULL,
	[Grilla] [varchar](30) NULL,
	[idCampo] [int] NOT NULL,
	[Fecha] [datetime] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[VenCliItemsAnuladosPO]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[VenCliItemsAnuladosPO](
	[idTransaccion] [int] NULL,
	[comprobante] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[item] [int] NOT NULL,
	[concepto] [char](3) NOT NULL,
	[cuenta] [int] NOT NULL,
	[importe] [numeric](18, 2) NOT NULL,
	[BaseContable] [numeric](18, 2) NOT NULL,
	[Area] [int] NULL,
	[Detalle] [char](20) NULL,
	[Alicuota] [numeric](18, 2) NOT NULL,
	[Grilla] [varchar](30) NULL,
	[idCampo] [int] NOT NULL,
	[Fecha] [datetime] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[VenCliItemsAnuladosPresupuestos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[VenCliItemsAnuladosPresupuestos](
	[idTransaccion] [int] NULL,
	[comprobante] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[item] [int] NOT NULL,
	[concepto] [char](3) NOT NULL,
	[cuenta] [int] NOT NULL,
	[importe] [numeric](18, 2) NOT NULL,
	[BaseContable] [numeric](18, 2) NOT NULL,
	[Area] [int] NULL,
	[Detalle] [char](20) NULL,
	[Alicuota] [numeric](18, 2) NOT NULL,
	[Grilla] [varchar](30) NULL,
	[idCampo] [int] NOT NULL,
	[Fecha] [datetime] NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[VencliitemsPedidos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[VencliitemsPedidos](
	[idTransaccion] [int] NULL,
	[comprobante] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[item] [int] NOT NULL,
	[concepto] [char](3) NOT NULL,
	[cuenta] [int] NOT NULL,
	[importe] [numeric](18, 2) NOT NULL,
	[BaseContable] [numeric](18, 2) NOT NULL,
	[Area] [int] NULL,
	[Detalle] [char](20) NULL,
	[Alicuota] [numeric](18, 2) NOT NULL,
	[Grilla] [varchar](30) NULL,
	[idCampo] [int] IDENTITY(1,1) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[VencliitemsPresupuestos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[VencliitemsPresupuestos](
	[idTransaccion] [int] NULL,
	[comprobante] [int] NOT NULL,
	[aniomes] [int] NOT NULL,
	[item] [int] NOT NULL,
	[concepto] [char](3) NOT NULL,
	[cuenta] [int] NOT NULL,
	[importe] [numeric](18, 2) NOT NULL,
	[BaseContable] [numeric](18, 2) NOT NULL,
	[Area] [int] NULL,
	[Detalle] [char](20) NULL,
	[Alicuota] [numeric](18, 2) NOT NULL,
	[Grilla] [varchar](30) NULL,
	[idCampo] [int] IDENTITY(1,1) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[zippedData]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[zippedData](
	[column1] [int] NOT NULL,
	[column2] [nvarchar](50) NOT NULL,
	[column3] [float] NOT NULL,
	[column4] [nvarchar](50) NOT NULL,
	[column5] [nvarchar](50) NOT NULL,
	[column6] [int] NOT NULL,
	[column7] [float] NOT NULL,
	[column8] [nvarchar](100) NOT NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[Zonas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Zonas](
	[idZona] [int] IDENTITY(0,1) NOT NULL,
	[Descripcion] [varchar](20) NULL
) ON [PRIMARY]
GO
/****** Object:  Table [dbo].[ZonasGeograficas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ZonasGeograficas](
	[zonageografica] [int] NOT NULL,
	[descripcion] [varchar](30) NULL
) ON [PRIMARY]
GO
ALTER TABLE [dbo].[AnexoMateriales] ADD  CONSTRAINT [DF_AnexoMateriales_afacturarmanual]  DEFAULT ((0)) FOR [afacturarmanual]
GO
ALTER TABLE [dbo].[AnexoMaterialesPresupuestos] ADD  CONSTRAINT [DF_AnexoMaterialesPresupuestos_afacturarmanual]  DEFAULT ((0)) FOR [afacturarmanual]
GO
ALTER TABLE [dbo].[CambiosTarjetaMaster] ADD  DEFAULT (getdate()) FOR [Procesado]
GO
ALTER TABLE [dbo].[Conceptos_tesoreria] ADD  CONSTRAINT [DF_Conceptos_tesoreria_Mostrador]  DEFAULT (0) FOR [Mostrador]
GO
ALTER TABLE [dbo].[Conceptos_tesoreria] ADD  CONSTRAINT [DF_Conceptos_tesoreria_MonedaExtranjera]  DEFAULT ((0)) FOR [MonedaExtranjera]
GO
ALTER TABLE [dbo].[EstadosPresupuestos] ADD  CONSTRAINT [DF_EstadosPresupuestos_Desde]  DEFAULT (getdate()) FOR [Desde]
GO
ALTER TABLE [dbo].[Header_Listas] ADD  CONSTRAINT [DF_Header_Listas_Creadael]  DEFAULT (getdate()) FOR [FechaAlta]
GO
ALTER TABLE [dbo].[Presupuestos] ADD  CONSTRAINT [DF_Presupuestos_Sucursal]  DEFAULT (1) FOR [Sucursal]
GO
ALTER TABLE [dbo].[TempFacturacionMO] ADD  CONSTRAINT [DF_TempFacturacionMO_MonedaPre]  DEFAULT ((0)) FOR [MonedaPre]
GO
ALTER TABLE [dbo].[TiposMovimientoStock] ADD  CONSTRAINT [DF_TiposMovimientoStock_Obra]  DEFAULT (0) FOR [Obra]
GO
ALTER TABLE [dbo].[tipventModHeader] ADD  CONSTRAINT [DF_tipventModHeader_IvaVentas]  DEFAULT ('S') FOR [IvaVentas]
GO
ALTER TABLE [dbo].[Vendedores] ADD  CONSTRAINT [DF_Vendedores_Activo]  DEFAULT (0) FOR [Activo]
GO
ALTER TABLE [dbo].[Vendedores] ADD  CONSTRAINT [DF_Vendedores_vClip]  DEFAULT (0) FOR [vClip]
GO
ALTER TABLE [dbo].[AsientosDiariosItems]  WITH CHECK ADD  CONSTRAINT [FK_AsientosDiariosItems_cuentas] FOREIGN KEY([cuenta])
REFERENCES [dbo].[cuentas] ([cuenta])
GO
ALTER TABLE [dbo].[AsientosDiariosItems] CHECK CONSTRAINT [FK_AsientosDiariosItems_cuentas]
GO
ALTER TABLE [dbo].[AsientosDiariosItems]  WITH CHECK ADD  CONSTRAINT [FK_AsientosDiariosItemsDiario_cuentas] FOREIGN KEY([cuenta])
REFERENCES [dbo].[cuentas] ([cuenta])
GO
ALTER TABLE [dbo].[AsientosDiariosItems] CHECK CONSTRAINT [FK_AsientosDiariosItemsDiario_cuentas]
GO
ALTER TABLE [dbo].[EstadisticaArticulosDescripciones]  WITH NOCHECK ADD  CONSTRAINT [FK_EstadisticaArticulosDescripciones_EstadisticaArticulos] FOREIGN KEY([idCampo])
REFERENCES [dbo].[EstadisticaArticulos] ([idCampo])
GO
ALTER TABLE [dbo].[EstadisticaArticulosDescripciones] CHECK CONSTRAINT [FK_EstadisticaArticulosDescripciones_EstadisticaArticulos]
GO
ALTER TABLE [dbo].[EstadisticaArticulosDescripcionesPedidos]  WITH CHECK ADD  CONSTRAINT [FK_EstadisticaArticulosDescripciones_EstadisticaArticulosPedidos] FOREIGN KEY([idCampo])
REFERENCES [dbo].[EstadisticaArticulosPedidos] ([idCampo])
GO
ALTER TABLE [dbo].[EstadisticaArticulosDescripcionesPedidos] CHECK CONSTRAINT [FK_EstadisticaArticulosDescripciones_EstadisticaArticulosPedidos]
GO
ALTER TABLE [dbo].[EstadisticaArticulosDescripcionesPO]  WITH CHECK ADD  CONSTRAINT [FK_EstadisticaArticulosDescripciones_EstadisticaArticulosPO] FOREIGN KEY([idCampo])
REFERENCES [dbo].[EstadisticaArticulosPO] ([idCampo])
GO
ALTER TABLE [dbo].[EstadisticaArticulosDescripcionesPO] CHECK CONSTRAINT [FK_EstadisticaArticulosDescripciones_EstadisticaArticulosPO]
GO
ALTER TABLE [dbo].[EstadisticaArticulosDescripcionesPresupuestos]  WITH NOCHECK ADD  CONSTRAINT [FK_EstadisticaArticulosDescripciones_EstadisticaArticulosPresupuestos] FOREIGN KEY([idCampo])
REFERENCES [dbo].[EstadisticaArticulosPresupuestos] ([idCampo])
GO
ALTER TABLE [dbo].[EstadisticaArticulosDescripcionesPresupuestos] CHECK CONSTRAINT [FK_EstadisticaArticulosDescripciones_EstadisticaArticulosPresupuestos]
GO
ALTER TABLE [dbo].[EstadisticaArticulosPrecios]  WITH NOCHECK ADD  CONSTRAINT [FK_EstadisticaArticulosPrecios_EstadisticaArticulos] FOREIGN KEY([idCampo])
REFERENCES [dbo].[EstadisticaArticulos] ([idCampo])
GO
ALTER TABLE [dbo].[EstadisticaArticulosPrecios] CHECK CONSTRAINT [FK_EstadisticaArticulosPrecios_EstadisticaArticulos]
GO
ALTER TABLE [dbo].[EstadisticaArticulosPreciosPedidos]  WITH CHECK ADD  CONSTRAINT [FK_EstadisticaArticulosPrecios_EstadisticaArticulosPedidos] FOREIGN KEY([idCampo])
REFERENCES [dbo].[EstadisticaArticulosPedidos] ([idCampo])
GO
ALTER TABLE [dbo].[EstadisticaArticulosPreciosPedidos] CHECK CONSTRAINT [FK_EstadisticaArticulosPrecios_EstadisticaArticulosPedidos]
GO
ALTER TABLE [dbo].[EstadisticaArticulosPreciosPO]  WITH CHECK ADD  CONSTRAINT [FK_EstadisticaArticulosPrecios_EstadisticaArticulosPO] FOREIGN KEY([idCampo])
REFERENCES [dbo].[EstadisticaArticulosPO] ([idCampo])
GO
ALTER TABLE [dbo].[EstadisticaArticulosPreciosPO] CHECK CONSTRAINT [FK_EstadisticaArticulosPrecios_EstadisticaArticulosPO]
GO
ALTER TABLE [dbo].[EstadisticaArticulosPreciosPresupuestos]  WITH NOCHECK ADD  CONSTRAINT [FK_EstadisticaArticulosPrecios_EstadisticaArticulosPresupuestos] FOREIGN KEY([idCampo])
REFERENCES [dbo].[EstadisticaArticulosPresupuestos] ([idCampo])
GO
ALTER TABLE [dbo].[EstadisticaArticulosPreciosPresupuestos] CHECK CONSTRAINT [FK_EstadisticaArticulosPrecios_EstadisticaArticulosPresupuestos]
GO
/****** Object:  StoredProcedure [dbo].[ABM_AplicacionesCtasaCobrar]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE     Procedure [dbo].[ABM_AplicacionesCtasaCobrar]
	@C_Modo				char(1)='A',
	@N_idTransaccion 		numeric (18,0)=101179,
	@N_item 			int=1,
	@N_IdTransaccionCancelada 	numeric (18,0)=81523,
	@N_Importe 			numeric (18,2)=116.50,
	@N_ImporteOrigen 			numeric (18,2)=31.15,
	@N_idoperacion	 		numeric (18,0)=214532
AS

declare @iret numeric(18,0)
declare @totalImporte numeric(18,0)

INSERT INTO [AplicacionesCuentasaCobrar]
([idTransaccion], [item], [IdTransaccionCancelada], [Importe], ImporteOrigen)
VALUES
(@N_idTransaccion,@N_item,@N_IdTransaccionCancelada,@N_Importe,@N_ImporteOrigen)

-- Numero de Aplicacion
Select @iret=@@identity

Select @totalImporte=isnull(totalimporte,0) from vencliheader where idtransaccion=@N_IdTransaccionCancelada

-- Actualizo Aplicacion de Comprobante Cancelada
if @totalImporte<>0
	update VenCliHeader set cancelado=(dbo.cCliAplicado(@N_IdTransaccionCancelada)) 
		where idTransaccion=@N_IdTransaccionCancelada

	update VenCliHeader set cancelado=(dbo.cCliAplicado(@N_IdTransaccion)) 
		where idTransaccion=@N_IdTransaccion

Select @totalImporte=isnull(importeOrigen,0) from vencliheader where idtransaccion=@N_IdTransaccionCancelada

-- Actualizo Aplicacion de Comprobante Cancelada
if @totalImporte<>0
Begin
	update VenCliHeader set canceladoOrigen=(dbo.cCliAplicadoOrigen(@N_IdTransaccionCancelada)) 
		where idTransaccion=@N_IdTransaccionCancelada

	update VenCliHeader set canceladoOrigen=(dbo.cCliAplicadoOrigen(@N_IdTransaccion)) 
		where idTransaccion=@N_IdTransaccion

end
if  @N_IdOPeracion<>0
begin
	insert into Detalle_Operaciones
	(IdOperacion, idTipoTransaccion, IdTransaccion)
	Values
	(@N_IdOperacion, 5, @iret)
-- Actualizo Aplicacion de Comprobante que cancela
	update VenCliHeader set cancelado=(dbo.cCliAplicado(@N_IdTransaccion))
	where idTransaccion=@N_IdTransaccion

	update VenCliHeader set cancelado=(dbo.cCliAplicado(@N_IdTransaccionCancelada)) 
		where idTransaccion=@N_IdTransaccionCancelada
end


GO
/****** Object:  StoredProcedure [dbo].[ABM_AplicacionesCtasaPagar]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE     Procedure [dbo].[ABM_AplicacionesCtasaPagar]
	@C_Modo						char(1),
	@N_idTransaccion 			numeric (18,0),
	@N_item 					int,
	@N_IdTransaccionCancelada 	numeric (18,0),
	@N_Importe 					numeric (18,2),
	@N_ImporteOrigen 			numeric (18,2),
	@N_idoperacion	 			numeric (18,0)=0
AS

declare @iret numeric(18,0)
declare @totalImporte numeric(18,0)

INSERT INTO [AplicacionesCuentasaPagar]
([idTransaccion], [item], [IdTransaccionCancelada], [Importe], ImporteOrigen)
VALUES
(@N_idTransaccion,@N_item,@N_IdTransaccionCancelada,@N_Importe,@N_ImporteOrigen)

Select @iret=@@identity

Select @totalImporte=isnull(totalimporte,0) from CompProvHeader where idtransaccion=@N_IdTransaccionCancelada

-- Actualizo Aplicacion de Comprobante Cancelada
if @totalImporte<>0
	update CompProvHeader set cancelado=(dbo.cProAplicado(@N_IdTransaccionCancelada)) 
		where idTransaccion=@N_IdTransaccionCancelada

Select @totalImporte=isnull(importeOrigen,0) from CompProvHeader where idtransaccion=@N_IdTransaccionCancelada

-- Actualizo Aplicacion de Comprobante Cancelada
if @totalImporte<>0
Begin
	update CompProvHeader set canceladoOrigen=(dbo.cProAplicadoOrigen(@N_IdTransaccionCancelada)) 
		where idTransaccion=@N_IdTransaccionCancelada

	update CompProvHeader set canceladoOrigen=(dbo.cProAplicadoOrigen(@N_IdTransaccion)) 
		where idTransaccion=@N_IdTransaccion
end

if @N_IdOPeracion<>0
begin
	insert into Detalle_Operaciones
	(IdOperacion, idTipoTransaccion, IdTransaccion)
	Values
	(@N_IdOperacion, 5, @iret)

	update CompProvHeader set cancelado=(dbo.cProAplicado(@N_IdTransaccion)) 
	where idTransaccion=@N_IdTransaccion

	update CompProvHeader set cancelado=(dbo.cProAplicado(@N_IdTransaccionCancelada)) 
	where idTransaccion=@N_IdTransaccionCancelada

end






GO
/****** Object:  StoredProcedure [dbo].[ABM_AplicacionesCtasCtes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE   Procedure [dbo].[ABM_AplicacionesCtasCtes]
	@C_Modo				char(1),
	@N_idTransaccion 		numeric (18,0),
	@N_item 			int,
	@N_IdTransaccionCancelada 	numeric (18,0),
	@N_Importe 			numeric (18,2)
AS

INSERT INTO [AplicacionesCuentasCorrientes]
([idTransaccion], [item], [IdTransaccionCancelada], [Importe])
VALUES
(@N_idTransaccion,@N_item,@N_IdTransaccionCancelada,@N_Importe)

update CuentasCorrientes set cancelado=(
Select SUM(importe) from AplicacionesCuentasCorrientes where idTransaccionCancelada=@N_IdTransaccionCancelada) where idTransaccion=@N_IdTransaccionCancelada

if @C_modo='U' 
	begin
		update CuentasCorrientes set importe=cancelado where idTransaccion=@N_IdTransaccionCancelada	
	end

GO
/****** Object:  StoredProcedure [dbo].[ABM_AplicacionesValores]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  procedure [dbo].[ABM_AplicacionesValores]
@C_Modo char(1),
@N_idTransaccion numeric (18,0),
@N_item int,
@N_IdTransaccionCancelada numeric (18,0),
@N_Importe numeric (18,2)
as
begin
   insert into AplicacionesValores (idTransaccion,item,IdTransaccionCancelada,Importe)
   values (@N_idTransaccion,@N_item,@N_IdTransaccionCancelada,@N_Importe)

   update ValoresTesoreria set 
   cancelado=(select SUM(importe) 
              from AplicacionesValores 
              where idTransaccionCancelada=@N_IdTransaccionCancelada) 
   where idTransaccion=@N_IdTransaccionCancelada

   Delete from lockRegs where idtransaccion=@N_IdTransaccionCancelada

end


GO
/****** Object:  StoredProcedure [dbo].[ABM_CuentasCorrientes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE           PROCEDURE [dbo].[ABM_CuentasCorrientes] 
	@C_ABM			char(1),
	@N_socio 		int,  
	@N_Entidad		int, 
	@D_Fecha		datetime, 
	@C_Concepto		char(3) , 
	@N_PuntodeVenta		int, 
	@N_DocumentoNumero	int, 
	@D_FechaRendicion	datetime=null, 
	@N_Rendicion		int=null,  
	@N_importe		numeric (18,2), 
	@N_Cancelado		numeric (18,2), 
	@D_vencimiento		Datetime=NUll, 
	@N_Cobrador		int ,
	@C_SERIE		char(10),
	@D_FechaGeneracion	DateTime=null,
	@N_IdOperacion		numeric (18,0),
	@N_idTipoTransaccion	int=0,
	@numeroint		int=null,
	@itemdiario		int=null,
	@observaciones		varchar(50)=null,
	@itransctacte		int=null,
	@idOpcobrador		numeric=null,
	@N_IdTransaccion numeric output
AS

if @C_ABM='A' 
	begin
		declare @iret int
		Insert Into CuentasCorrientes
		(socio, Entidad, Fecha, Concepto, 
		PuntodeVenta, DocumentoNumero, FechaRendicion, 
		Rendicion, importe, Cancelado, vencimiento, Cobrador,serie,idOpcobrador)
		Values 
		(@N_socio, @N_Entidad, @D_Fecha, @C_Concepto, 
		@N_PuntodeVenta, @N_DocumentoNumero, @D_FechaRendicion, 
		@N_Rendicion, @N_importe, @N_Cancelado, @D_vencimiento, @N_Cobrador, @C_SERIE,@idOpcobrador)
		select @iret=@@identity
		select @N_idtransaccion=@iret
		commit transaction

		   insert into detalle_operaciones (IdOperacion,IdTipoTransaccion,idTransaccion,itemdiario) /* ,idtransctacte) */
		   values (@N_IdOperacion,@N_IdTipoTransaccion,@N_IdTransaccion,@itemdiario) /* ,@itransctacte) */
		   return @iret

	end
else if @C_ABM='B' 
	Begin
		Delete From CuentasCorrientes where IdTransaccion =  @N_IdTransaccion
	end
else if @C_ABM='M' 
	Begin
		Update CuentasCorrientes Set 
		socio=@N_socio, Entidad=@N_Entidad, Fecha=@D_Fecha, Concepto=@C_Concepto, PuntodeVenta=@N_PuntodeVenta, 
		DocumentoNumero=@N_DocumentoNumero, FechaRendicion=@D_FechaRendicion, Rendicion=@N_Rendicion, importe=@N_importe, 
		Cancelado=@N_Cancelado, vencimiento=@D_vencimiento, Cobrador=@N_Cobrador, SERIE=@C_SERIE Where 
		IdTransaccion=@N_IdTransaccion
	End

if  @C_Concepto='MES'

begin
	if @N_Entidad=0 
		begin
		update SOCIOS set ultimaGeneracion=@D_FechaGeneracion where socio=@N_SOCIO
		end
	else if @N_Entidad=1
		begin
		update Adherentes set ultimaGeneracion=@D_FechaGeneracion where adherente=@N_SOCIO
		end
end

insert into Detalle_Operaciones
(IdOperacion, idTipoTransaccion, IdTransaccion)
Values
(@N_IdOperacion, 0, @N_IdTransaccion)




GO
/****** Object:  StoredProcedure [dbo].[ABM_DetalleCtasCtes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


CREATE   PROCEDURE [dbo].[ABM_DetalleCtasCtes] 
	@C_ABM		char(1),
	@N_idTransaccion int, 
	@N_Item		 int,
	@C_Concepto	char(3),
	@N_Cantidad	 numeric(18,2), 
	@N_Importe	 numeric(18,2)
AS

if @C_ABM='A' 
	begin
		 Insert Into DetalleCuentasCorrientes
		(idTransaccion, item, Concepto, Cantidad, importe) 
		Values 
		(@N_idTransaccion, @N_item, @C_Concepto, @N_Cantidad, @N_importe) 
	end
else if @C_ABM='B' 
	begin
		Delete FROM DetalleCuentasCorrientes Where 
		idTransaccion=@N_idTransaccion and item=@N_item
	end
else if @C_ABM='M' 
	begin
		Update DetalleCuentasCorrientes Set 
		Concepto=@C_Concepto, Cantidad=@N_Cantidad, importe=@N_importe Where 
		idTransaccion=@N_idTransaccion and item=@N_item
	end
else if @C_ABM='U' 
	begin
		if (Select count(*) from DetalleCuentasCorrientes where idTransaccion=@N_idTransaccion and Concepto=@C_Concepto)=1
			Update DetalleCuentasCorrientes Set 
			Cantidad=@N_Cantidad, importe=@N_importe Where 
			idTransaccion=@N_idTransaccion and Concepto=@C_Concepto
		else
			 Insert Into DetalleCuentasCorrientes
			(idTransaccion, item, Concepto, Cantidad, importe) 
			Values 
			(@N_idTransaccion, @N_item, @C_Concepto, @N_Cantidad, @N_importe) 
	end

GO
/****** Object:  StoredProcedure [dbo].[ABM_Header_Operaciones]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO






CREATE      procedure [dbo].[ABM_Header_Operaciones](
@fecha datetime,
@tipodeoperacion int,
@observacion varchar(255),
@idusuario char(10),
@idoperadortesoreria int=null,
@asientodiario int=null,
@aniomes int=null,
@tipoasiento int=null,
@cuenta int=null,
@numero int=null,
@serie char(6)=null,
@observacionCompro varchar(256)=null)
as
begin
   declare @iret int
   begin transaction
   insert into header_operaciones(fecha,tipodeoperacion,observacion,
   idusuario,idoperadortesoreria,procesado,asientodiario,aniomes,tipoasiento,cuenta,comprobantenumero,serie,observacioncomprobante) 
   values
   (@fecha,@tipodeoperacion,@observacion,@idusuario,@idoperadortesoreria,
   getdate(),@asientodiario,@aniomes,@tipoasiento,@cuenta,@numero,@serie,@observacionCompro)
   select @iret=@@identity
   commit transaction
   return @iret
end

GO
/****** Object:  StoredProcedure [dbo].[ABM_Item_Operaciones]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



Create  Procedure [dbo].[ABM_Item_Operaciones]
	@N_idOperacion int, 
	@N_idTransaccion int
As
	Insert into detalle_Operaciones 
	(idOperacion, idTransaccion)
	values
	(@N_idOperacion, @N_idTransaccion)






GO
/****** Object:  StoredProcedure [dbo].[ABM_Recibos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE   Procedure [dbo].[ABM_Recibos]
	@N_IdOperacion bigint = null,
	@idTransaccionMes bigint = Null,
	@Numero bigint = Null,
	@Fecha datetime,
	@Cobrador int = Null,
	@idTransaccionRecibo bigint = Null

AS
	Declare @iret int
   	Declare @N_idtransaccion numeric(18,0)
	Begin Transaction
		Insert Into Recibos
			(idTransaccionMes, Numero, Fecha, Cobrador, idTransaccionRecibo) 
   		Values 
			(@idTransaccionMes, @Numero, @Fecha, @Cobrador, @idTransaccionRecibo)
		select @iret=@@identity
		select @N_idtransaccion=@iret
   	Commit Transaction

/********************************************************/
/* 	Grabo los Detalles de las Operaciones 		*/
/********************************************************/
	Insert into Detalle_Operaciones
		(IdOperacion, idTipoTransaccion, IdTransaccion)
	Values
		(@N_IdOperacion, 4, @N_IdTransaccion)

   	return 	@iret



GO
/****** Object:  StoredProcedure [dbo].[ABM_Repuestos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create Procedure [dbo].[ABM_Repuestos]
(
	@idService	int,
	@idCampo	int=0,
	@idComponente	int,
	@Cantidad	int,
	@Precio		numeric(18,2)=0
)
as
if @idCampo=0
	insert into Repuestos 
	(idService,idComponente,Cantidad,Precio)
	values
	(@idService,@idComponente,@Cantidad,@Precio)
else
	Update Repuestos 
	set  idcomponente=@idComponente,cantidad=@Cantidad,precio=@Precio	
	where idCampo=@idCampo



GO
/****** Object:  StoredProcedure [dbo].[ABM_Service]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE   Procedure [dbo].[ABM_Service]
(
	@idPaciente		int=0,
	@idService		int=0,
	@idModelo		int=0,
	@Modelo			nvarchar(50),	
	@Serie			nvarchar(50),
	@FinGarantia 		nvarchar(8)=null,
	@Entra			nvarchar(8), 
	@idRecepcion		int=0,	 
	@Prometido		nvarchar(8)=null, 
	@Presupuesto		nvarchar(8)=null, 
	@Aceptado		nvarchar(8)=null, 
	@Reparado		nvarchar(8)=null, 
	@idDistribuidor		int=0,
	@idTecnico		int=0, 
	@idServiceAnt		int=0,	 
	@idFalla1		int=0,	 
	@idFalla2		int=0, 
	@idFalla3		int=0, 
	@idFalla4		int=0, 
	@idFalla5		int=0,
	@idFalla6  		int=0,
	@ObseIngreso		nvarchar(255)=null, 
	@ObsePresupuesto	nvarchar(255)=null,
	@Pesos			numeric(18,2)=0, 
	@Dolares		numeric(18,2)=0, 
	@idTecnicoPresupuesto	int=0, 
	@AceptaRechazo		int=0, 
	@obseAceptaRechazo	nvarchar(255)=null,
	@FinReparacion		nvarchar(255)=null,
	@ObseFinReparacion 	nvarchar(255)=null, 
	@idTecnicoFinReparacion	int=0,
	@Entrega		nvarchar(8)=null, 
	@ObseEntrega		nvarchar(255)=null, 
	@idRecepcionEntrega	int=0, 
	@ObseReservada		nvarchar(255)=null,
	@idLeyenda		int=0,
	@Texto			text
)
as
if @idModelo=0
	begin
		Select @idModelo=isnull(idModelo,0) from modelos_pacientes where Modelo=@Modelo and Serie=@Serie
		and idPaciente=@idPaciente
		
		if @idModelo=0
			begin
				insert into modelos_pacientes (idPaciente,modelo,Serie)
				values (@idPaciente,@modelo,@Serie)
				Select @idModelo=@@identity
			end
		else
			Update modelos_pacientes set fingarantia=@FinGarantia where idModelo=@idModelo
	end

if @idService=0
	Begin
		INSERT INTO Services(
		idModelo, Entra, idRecepcion, Prometido, Presupuesto, Aceptado, Reparado, idDistribuidor,
		idTecnico, idServiceAnt, idFalla1, idFalla2, idFalla3, idFalla4, idFalla5, idFalla6, 
		ObseIngreso, ObsePresupuesto, Pesos, Dolares, idTecnicoPresupuesto, 
		AceptaRechazo, obseAceptaRechazo, FinReparacion, ObseFinReparacion, idTecnicoFinReparacion,
		Entrega, ObseEntrega, idRecepcionEntrega, ObseReservada,idLeyenda,texto
		)
		VALUES
		(
		@idModelo, @Entra, @idRecepcion, @Prometido, @Presupuesto, @Aceptado, @Reparado, @idDistribuidor,
		@idTecnico, @idServiceAnt, @idFalla1, @idFalla2, @idFalla3, @idFalla4, @idFalla5, @idFalla6, 
		@ObseIngreso, @ObsePresupuesto, @Pesos, @Dolares, @idTecnicoPresupuesto, 
		@AceptaRechazo, @obseAceptaRechazo, @FinReparacion, @ObseFinReparacion, @idTecnicoFinReparacion,
		@Entrega, @ObseEntrega, @idRecepcionEntrega, @ObseReservada,@idLeyenda,@texto
		)
		Select @idService=@@identity
	end
else
	Update Services set idModelo=@idmodelo, Entra=@entra, idRecepcion=@idrecepcion, 
	Prometido=@Prometido,Presupuesto=@Presupuesto,Aceptado=@Aceptado,Reparado=@Reparado, 
	idDistribuidor=@idDistribuidor,idTecnico=@idTecnico,idServiceAnt=@idServiceAnt, 
	idFalla1=@idFalla1,idFalla2=@idFalla2,idFalla3=@idFalla3,idFalla4=@idFalla4,
	idFalla5=@idFalla5,idFalla6=@idFalla6,ObseIngreso=@Obseingreso, 
	ObsePresupuesto=@ObsePresupuesto, Pesos=@pesos, Dolares=@Dolares, 
	idTecnicoPresupuesto=@idTecnicoPresupuesto, AceptaRechazo=@AceptaRechazo, 
	obseAceptaRechazo=@obseAceptaRechazo, FinReparacion=@FinReparacion, 
	ObseFinReparacion=@ObseFinReparacion, idTecnicoFinReparacion=@idTecnicoFinReparacion, 
	Entrega=@Entrega, ObseEntrega=@ObseEntrega, idRecepcionEntrega=@idRecepcionEntrega, 
	ObseReservada=@ObseReservada,idLeyenda=@idLeyenda, Texto=@texto
	where idService=@idService



GO
/****** Object:  StoredProcedure [dbo].[ABM_ValoresTesoreria]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO

CREATE         Procedure [dbo].[ABM_ValoresTesoreria](
@N_Modo			char(1),
@N_idTransaccion	int,
@N_idTransaccionOrigen	numeric(18,0),
@N_TipoMovimiento	int,
@N_idConcepto_Tesoreria	int,
@D_FechaEmision			datetime=null,
@D_Vencimiento			datetime=null,
@N_Banco				int=null,
@N_Cuenta				int=null,
@N_Sucursal				int=null,
@N_Numero				int=null,
@C_Firma				varchar(60)=null,
@N_importe				numeric(18,2),
@N_Cancelado			numeric(18,2)=null,
@N_idOperador			int,
@N_idOperacion			numeric(18,0),
@N_idTipoTransaccion	int,
@numeroint				int=null,
@itemdiario				int=null,
@newitem            	int=null,
@observaciones			varchar(255)=null,
@idOpCobrador			numeric(18,0)=null,
@Corregido				char(1) = 'N',
@Base				numeric(18,2)=0,
@TC				numeric(18,4)=0)
as
begin
  declare @iret int
  if @N_MODO='A'
   begin
		--Si estamos agregando un nuevo registro -> recuperamos el idtransaccion
		begin transaction
		INSERT INTO ValoresTesoreria(idTransaccionOrigen,TipoMovimiento,
		idConcepto_Tesoreria,FechaEmision,Vencimiento,Banco,Cuenta,Sucursal,Numero,Firma,
		importe,Cancelado,idoperador,numerointerno,observaciones,idOpCobrador,Corregido,base,tipocambio)
		values (@N_idTransaccionOrigen,@N_TipoMovimiento,
		@N_idConcepto_Tesoreria,@D_FechaEmision,@D_Vencimiento,@N_Banco,@N_Cuenta,
		@N_Sucursal,@N_Numero,@C_Firma,@N_importe,@N_Cancelado,@N_idOperador,@numeroint,@observaciones,@idopCobrador,@Corregido,@base,@tc)
		select @iret=@@identity
		select @N_idtransaccion=@iret
		commit transaction
		
		insert into detalle_operaciones (IdOperacion,IdTipoTransaccion,idTransaccion,itemdiario)
		values (@N_IdOperacion,@N_IdTipoTransaccion,@N_IdTransaccion,@itemdiario)

		if @N_TipoMovimiento=2 and @N_Numero<>0
			Update chequeras 
			set ultimoChequeEmitido=@N_Numero
			where concepto=@N_idConcepto_Tesoreria

		if (Select Modalidad from COnceptos_Tesoreria where idConcepto_Tesoreria=@N_idConcepto_Tesoreria)=0
			Update ValoresTesoreria 
			set fechaEmision=(Select fecha from Header_Operaciones where idOperacion=@N_IdOperacion)
			where idtransaccion=@iret
		
		return @iret

   end
  else if @N_MODO='M'
   begin
      update valorestesoreria set
      idTransaccionOrigen=@N_idTransaccionOrigen,TipoMovimiento=@N_tipomovimiento,
      idConcepto_Tesoreria=@N_idconcepto_tesoreria,FechaEmision=@D_Fechaemision,
      Vencimiento=@D_Vencimiento,Banco=@N_Banco,Cuenta=@N_cuenta,Sucursal=@N_Sucursal,
      Numero=@N_Numero,Firma=@C_Firma,importe=@N_importe,Cancelado=@N_cancelado,
      idoperador=@N_idoperador,numerointerno=@numeroint,observaciones=@observaciones,Corregido=@Corregido,base=@base,tipocambio=@tc
      where idtransaccion=@N_idtransaccion
      update detalle_operaciones set
      idtipotransaccion=@N_idtipotransaccion,itemdiario=@itemdiario
      where idoperacion=@n_idoperacion and idtransaccion=@n_idtransaccion
   end
end





GO
/****** Object:  StoredProcedure [dbo].[ABM_ValoresTesoreriaAnulados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE     Procedure [dbo].[ABM_ValoresTesoreriaAnulados](

	@N_Modo			char(1),
	@N_idTransaccion	int,
	@N_idTransaccionOrigen	numeric(18,0),
	@N_TipoMovimiento	int,
	@N_idConcepto_Tesoreria	int,
	@D_FechaEmision			datetime=null,
	@D_Vencimiento			datetime=null,
	@N_Banco				int=null,
	@N_Cuenta				int=null,
	@N_Sucursal				int=null,
	@N_Numero				int=null,
	@C_Firma				varchar(50)=null,
	@N_importe				numeric(18,2),
	@N_Cancelado			numeric(18,2)=null,
	@N_idOperador			int,
	@N_idOperacion			numeric(18,0),
	@N_idTipoTransaccion	int,
	@numeroint				int=null,
	@itemdiario				int=null,
	@newitem            	int=null,
	@observaciones			varchar(255)=null,
	@idOpCobrador			numeric(18,0)=null)

as
begin
  declare @iret int
  if @N_MODO='A'
   begin
      --Si estamos agregando un nuevo registro -> recuperamos el idtransaccion
      begin transaction
      INSERT INTO ValoresTesoreriaAnulados(idTransaccionOrigen,TipoMovimiento,
      idConcepto_Tesoreria,FechaEmision,Vencimiento,Banco,Cuenta,Sucursal,Numero,Firma,
      importe,Cancelado,idoperador,numerointerno,observaciones,idOpCobrador)
      values (@N_idTransaccionOrigen,@N_TipoMovimiento,
      @N_idConcepto_Tesoreria,@D_FechaEmision,@D_Vencimiento,@N_Banco,@N_Cuenta,
      @N_Sucursal,@N_Numero,@C_Firma,@N_importe,@N_Cancelado,@N_idOperador,@numeroint,@observaciones,@idopCobrador)
      select @iret=@@identity
      select @N_idtransaccion=@iret
      commit transaction
      insert into detalle_operaciones (IdOperacion,IdTipoTransaccion,idTransaccion,itemdiario)
      values (@N_IdOperacion,@N_IdTipoTransaccion,@N_IdTransaccion,@itemdiario)
      return @iret
   end
  else if @N_MODO='M'
   begin
      update valorestesoreriaAnulados set
      idTransaccionOrigen=@N_idTransaccionOrigen,TipoMovimiento=@N_tipomovimiento,
      idConcepto_Tesoreria=@N_idconcepto_tesoreria,FechaEmision=@D_Fechaemision,
      Vencimiento=@D_Vencimiento,Banco=@N_Banco,Cuenta=@N_cuenta,Sucursal=@N_Sucursal,
      Numero=@N_Numero,Firma=@C_Firma,importe=@N_importe,Cancelado=@N_cancelado,
      idoperador=@N_idoperador,numerointerno=@numeroint,observaciones=@observaciones
      where idtransaccion=@N_idtransaccion
      update detalle_operaciones set
      idtipotransaccion=@N_idtipotransaccion,itemdiario=@itemdiario
      where idoperacion=@n_idoperacion and idtransaccion=@n_idtransaccion
   end
end




GO
/****** Object:  StoredProcedure [dbo].[ABMAnses]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[ABMAnses]
(
	@Aniomes	int=200509
)
As
Select sc.Socio,apellido,sc.nombre,concepto,fechavigencia,cs.fechabaja,cs.motivoBaja,mb.nombre mbNombre,
sc.Fichamun,cajaAnses
from socios sc
inner join Conceptos_socios cs
on sc.socio=cs.socio
left join motivosbaja mb
on cs.motivobaja=mb.motivo
where grupo='J'
and ((dbo.toaniomes(cs.fechabaja)>=@Aniomes)
or (dbo.toaniomes(cs.fechaVigencia)>=@Aniomes))
and sc.cobrador=0
order by sc.socio



GO
/****** Object:  StoredProcedure [dbo].[ABMS_Alumnos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE    Procedure [dbo].[ABMS_Alumnos]
(
	@nyap			varchar(50),
	@Domicilio		varchar(50),
	@Localidad		varchar(50),
	@cpostal 		varchar(8),
	@Provincia  	int,
	@Telefono 		varchar(30),
	@TelefonoII 	varchar(50),
	@Sexo 			tinyint,
	@Nacido			char(8),
	@TipoDocumento 	tinyint,
	@Numedocto		int,
	@Nacionalidad	int,
	@EstadoCivil	tinyint,
	@TipoMat		int,
	@NumeroMat		int,
	@FichaMunicipal int,
	@cuil 			varchar(13),
	@idProfesion	int,
	@Especialidad	int,
	@email			varchar(50),
	@Grupo			int,
	@CodigoGrupo	int,
	@debito			int,
	@tarjeta		int,
	@numero			numeric(18,0),
	@vencimiento	char(8),
	@debitardesde	char(8),
	@alumno			int=0
)
as
Declare @iret	int
if @alumno=0

	Begin 

		Insert into Alumnos
		([nyap],[Domicilio],[Localidad],[cpostal],[Provincia],[Telefono],[TelefonoII],[Sexo],
		[Nacido],TipoDocumento,[Numedocto],[Nacionalidad],[EstadoCivil],[TipoMat],[NumeroMat],
		[FichaMunicipal],[cuil],[idProfesion],[Especialidad],[email],[Grupo],[CodigoGrupo],
		[debito],[tarjeta],[numero],[vencimiento],[debitardesde]
		)
		VALUES 
		(@nyap, @Domicilio,@Localidad, @cpostal, @Provincia,@Telefono, @TelefonoII,@Sexo, 
		@Nacido,@TipoDocumento,@Numedocto,@Nacionalidad,@EstadoCivil,@TipoMat,@NumeroMat,
		@FichaMunicipal,@cuil,@idProfesion,@Especialidad,@email,@Grupo,@CodigoGrupo,
		@debito,@tarjeta,@numero,@vencimiento,@debitardesde)

		Select @iret=@@identity	

		return 	@iret
	end

else
	Begin
		Update Alumnos
		set
		[nyap]=@nyap,[Domicilio]=@Domicilio,[Localidad]=@Localidad,[cpostal]=@cpostal,[Provincia]=@provincia,[Telefono]=@telefono,[TelefonoII]=@telefonoii,[Sexo]=@sexo,
		[Nacido]=@nacido,TipoDocumento=@TipoDocumento,[Numedocto]=@Numedocto,[Nacionalidad]=@Nacionalidad,[EstadoCivil]=@EstadoCivil,[TipoMat]=@TipoMat,[NumeroMat]=@NumeroMat,
		[FichaMunicipal]=@FichaMunicipal,[cuil]=@cuil,[idProfesion]=@idProfesion,[Especialidad]=@Especialidad,[email]=@email,[Grupo]=@Grupo,[CodigoGrupo]=@CodigoGrupo,
		debito=@debito,tarjeta=@tarjeta,numero=@numero,vencimiento=@vencimiento,debitardesde=@debitardesde
		where idalumno=@Alumno

		return 	@Alumno
	End

GO
/****** Object:  StoredProcedure [dbo].[ABMS_ListasAlumnos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE     Procedure [dbo].[ABMS_ListasAlumnos]
(
	@idAlumno			int,
	@idHorario			int,
	@FechaInscripcion	char(8),
	@FechaBaja			char(8),
	@Matricula			numeric(18,2),
	@cuotas				int,
	@ImporteCuotas      numeric(18,2),
	@idCampo			int
)
as

if @idCampo=0 
	begin
		Declare @i int
		Set @i=1
	
		INSERT INTO Listas 
		(idAlumno, idHorario, fechaInscripcion,FechaBaja,Matricula,Cuotas,ImporteCuotas)
		VALUES(@idAlumno,@idHorario,@fechaInscripcion,@FechaBaja,@Matricula,@Cuotas,
		@ImporteCuotas)
	
		DECLARE @DumpCC TABLE 
		(Socio int, Entidad int,Fecha datetime, concepto char(3),Puntodeventa int,documentonumero int,importe numeric(18,2))
	
		if isnull(@matricula,0)<>0
			insert into @DumpCC values (@idAlumno,2,@fechaInscripcion,'MAT',@idHorario,0,@matricula)
		Set @i=1	
		While @i<=@Cuotas
		begin
			insert into @DumpCC values (@idAlumno,2,@fechaInscripcion,'CUO',@idHorario,@i,@importecuotas)
			Set @i=@i+1
	
			if month(@fechaInscripcion)=12
					Set @fechaInscripcion = cast(Year(@fechaInscripcion)+1 as char(4)) + 
					 '03' 
					+ '01'
			else		
					Set @fechaInscripcion = cast(Year(@fechaInscripcion) as char(4)) + 
					case when month(@fechaInscripcion)<9 then '0' + 
					cast(month(@fechaInscripcion)+1 as char(1)) else cast(month(@fechaInscripcion)+1 as char(2)) end 
					+ '01'
	
		end
	
		insert into CuentasCorrientes
		(socio,entidad,Fecha,Concepto,idcancelada,documentonumero,importe)
		Select * from @Dumpcc
	
		Insert into DetalleCuentasCorrientes
		SELECT 	
		idtransaccion,0,cast(idcancelada as char(3)) as concepto, 1 as cantidad,cc.importe
		FROM CuentasCorrientes cc
		where socio=@idAlumno and idcancelada=@idHorario and entidad=2

	end	
else

	Update Listas
	set FechaInscripcion=@FechaInscripcion,fechabaja=@fechabaja,
	matricula=@Matricula,Cuotas=@Cuotas,importeCuotas=@ImporteCuotas
	where idAlumno=@idAlumno and idHorario=@idHorario



GO
/****** Object:  StoredProcedure [dbo].[ABMS_ObservacionesAlumnos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE Procedure [dbo].[ABMS_ObservacionesAlumnos]
(
	@idCampo		int,
	@idAlumno		int,
	@Fecha			char(8),
	@Observacion	nvarchar(255)
)
as
if @idCampo=0
	INSERT INTO [Observaciones_Alumnos]([idAlumno], [fecha], [Observacion])
	VALUES(@idAlumno,@fecha,@Observacion)
else
	Update Observaciones_alumnos 
	set fecha=@fecha, observacion=@observacion,idAlumno=@idAlumno 
	where idCampo=@idCampo


GO
/****** Object:  StoredProcedure [dbo].[Actualiza_Hospitales]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create Procedure [dbo].[Actualiza_Hospitales](@Codigo char(5))
as

Update socios 
set LugarVoto=@Codigo
from maesocio ms
inner Join Socios sc on substring(col001,5,6)=socio
where substring(col004,1,5)=@Codigo and lugarVoto=0

GO
/****** Object:  StoredProcedure [dbo].[Actualiza_UltimaGeneracion_Adherentes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  procedure [dbo].[Actualiza_UltimaGeneracion_Adherentes]
as 
begin
   	--Declaracion variables
	declare @Adherente int

   	--Declaramos el cursor
	declare curItems cursor for
	select adherente from Adherentes

   	--Abrimos el cursor
   	open curItems

   	fetch next from curItems into @Adherente
   	WHILE @@FETCH_STATUS = 0
    	begin
		Update Adherentes
		set UltimaGeneracion = (select top 1 Fecha from cuentascorrientes 
					where Concepto = 'MES' and Entidad = 1 and socio = @Adherente 
					order by fecha desc)
		where Adherente = @Adherente
	
   		fetch next from curItems into @Adherente
    	end
	close curItems
	deallocate curItems
end


GO
/****** Object:  StoredProcedure [dbo].[Actualiza_UltimaGeneracion_Socios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE   procedure [dbo].[Actualiza_UltimaGeneracion_Socios] 
as 
begin
   	--Declaracion variables
	declare @Socio int

   	--Declaramos el cursor
	declare curItems cursor for
	select socio from Socios

   	--Abrimos el cursor
   	open curItems

   	fetch next from curItems into @Socio
   	WHILE @@FETCH_STATUS = 0
    	begin
		Update Socios 
		set UltimaGeneracion = (select top 1 Fecha from cuentascorrientes 
					where Concepto = 'MES' and Entidad = 0 
					and socio = @Socio 
					order by fecha desc)
		where socio = @socio		
	
   		fetch next from curItems into @Socio
    	end
	close curItems
	deallocate curItems
end



GO
/****** Object:  StoredProcedure [dbo].[addcpAltas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

--addcpAltas 20060602,20060701

CREATE Procedure [dbo].[addcpAltas] -- cpAltas '20060101','20060201',60,1
(
	@Inicio char(8)='20060201',
	@Cierre char(8)='20060301',
	@Cobertura char(3)=150,
	@Entidad Char(1)=1
)
as
insert into listadosCompanias 
select @Entidad,@inicio,ad.adherente,ad.cobrador,ad.grupo,@Cobertura
from conceptos_Adherentes ca 
inner join conceptos co1 on ca.concepto=co1.concepto
inner join Adherentes ad on ca.adherente=ad.adherente
inner join cobradores cb
on ad.cobrador=cb.cobrador
where (ca.FechaVigencia>@Inicio and FechaVigencia<=@Cierre)
and  co1.Cobertura=@Cobertura and @Entidad=1
union

select @Entidad,@inicio,ad.socio,ad.cobrador,ad.grupo,@Cobertura
--@Inicio,@Cierre,ad.socio,ad.apellido,ad.nombre,ad.cobrador,@Cobertura Cobertura,'',cb.nombre 
from socios ad 
inner join cobradores cb on ad.cobrador=cb.cobrador
where 
(
(
(Select count(*) from conceptos_Socios ca 
inner join conceptos co1 on ca.concepto=co1.concepto
where  @Entidad=0 and (ca.fechabaja is null or ca.fechabaja > @Cierre) and ca.FechaVigencia <= @Cierre
and  co1.Cobertura=@Cobertura and ad.socio=ca.socio)>0)
) 
and 
(
(Select count(*) from conceptos_Socios ca 
inner join conceptos co1 on ca.concepto=co1.concepto
where (ca.fechabaja is null or ca.fechabaja > @Inicio) and ca.FechaVigencia <= @Inicio
and co1.Cobertura=@Cobertura and ad.socio=ca.socio)=0)



GO
/****** Object:  StoredProcedure [dbo].[Agrupado]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE   Procedure [dbo].[Agrupado]
(
	@tc		decimal(18,2)=3.2,
	@idlista	int=90,
	@Desde		char(8)='20080301',
	@Hasta		char(8)='20080331',
	@idcliente	int=0

)
as
Select a.idarticulo,hl.descripcion dlista,a.articulo ,a.descripcion dArticulo,a.idlinea nlinea, 
l.descripcion dLinea, a.idsublinea nSublinea, sl.descripcion dSublinea,sum(cantidad*multiplicador) cantidad,
sum(basecontable*multiplicador)/case when sum(cantidad*multiplicador)=0 then 1 else sum(cantidad*multiplicador) end UnitarioVenta,
sum(basecontable*multiplicador) PesosVenta, 
dl.neto PrecioBase,dl.neto, isnull(dl.neto,0)*@tc unitarioPesoscosto,
isnull(dl.neto,0)*@tc*sum(cantidad*multiplicador) PesosCosto,
cast(a.idlinea as char(3)) + cast(a.idsublinea as char(3)) + ' ' + l.descripcion+' '+sl.descripcion Grupo,
sum(basecontable*multiplicador)-isnull(dl.neto,0)*@tc*sum(cantidad*multiplicador) Resultado
from estadisticaArticulos ea
inner join estadisticaArticulosPrecios eap
on ea.idcampo=eap.idcampo
inner join articulos a
on ea.idarticulo=a.idarticulo
Left join lineas l
on a.idlinea=l.idlinea
left join sublineas sl 
on a.idsublinea=sl.idsublinea
inner join Header_operaciones ho 
on ea.idOperacion=ho.idoperacion
inner join detalle_operaciones do 
on ho.idOPeracion=do.idOPeracion
inner join vencliheader vch
on do.idtransaccion=vch.idtransaccion
inner join tipventmodheader tmv
on tmv.codigo=vch.tipocomprobante
left join detalle_Listas dl 
on dl.idarticulo=a.idarticulo and idlista=@idlista
left join header_listas hl
on dl.idlista=hl.idlista

Where ho.fecha between @Desde and @hasta
and (vch.cliente=@idcliente or @idcliente=0)
group by a.idarticulo,a.articulo,a.descripcion,a.idlinea,l.descripcion,a.idsublinea,
sl.descripcion,hl.descripcion,dl.neto

Order by a.idlinea,a.idsublinea,a.articulo













GO
/****** Object:  StoredProcedure [dbo].[Alta_Operacion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[Alta_Operacion](
@N_Cliente  int=null,
@N_Topera  int,
@N_Moneda  int,
@N_Cantidad  numeric (18,2),
@N_Precio  numeric (18,4),
@N_Neto  numeric (18,4),
@N_Precio_Contacto  numeric (18,2),
@N_Contacto  int,
@N_idOpCalce  int,
@N_MonedaNeto  int,
@N_Confirmada   int = 1,
@C_Hora char(5),
@operador int,
@N_ID  int output,
@idConcepto int=null,
@Observacion varchar(50)=null
)
as
begin
  if @N_Moneda<>10
   begin
      insert into Movimientos (fecha,Cliente,TipoOperacion,Moneda,Cantidad,Precio,Neto,
      Precio_Contacto,idContacto,idOperacionCalce,MonedaNeto,estado,hora,operador,
      idConcepto,Observacion) 
      values 
      (GetDate(),@N_Cliente,@N_Topera,@N_Moneda,@N_Cantidad,@N_Precio,@N_Neto,
      @N_Precio_Contacto,@N_Contacto,@N_idOpCalce,10,@N_Confirmada,@C_Hora,@operador,
      @idConcepto,@Observacion) 
   end
  else
   begin
    insert into Movimientos (fecha,Cliente,TipoOperacion,Moneda,Cantidad,Precio,Neto,
    Precio_Contacto,idContacto,idOperacionCalce,MonedaNeto,estado,HOra,operador,
    idConcepto,Observacion) 
    values 
    (GetDate(),@N_Cliente,@N_Topera,@N_Moneda,@N_Cantidad,@N_Precio,@N_Neto,
    @N_Precio_Contacto,@N_Contacto,@N_idOpCalce,@N_MonedaNeto,@N_Confirmada,@C_Hora,
    @operador,@idConcepto,@Observacion) 
   end
  select @N_ID=@@IDENTITY
end

GO
/****** Object:  StoredProcedure [dbo].[altas2003]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[altas2003]
as
Select h.nombre,count(*) as cantidad
from socios sc
left join Grupos_socios gs
on sc.socio=gs.socio
LEFT JOIN  Hospitales h ON gs.lugarpago = H.Hospital AND gs.reparticion = H.Reparticion 
LEFT JOIN  Reparticiones ON gs.reparticion = Reparticiones.Reparticion
where year(fechaIngreso)=2003
Group by h.nombre
order by h.nombre




GO
/****** Object:  StoredProcedure [dbo].[AltasBajas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  Procedure [dbo].[AltasBajas]
(
	@Inicio 	char(8),
	@Cierre		char(8)
)
as

Select Altas=(Select count(*) from Socios sc
where FechaIngreso between @inicio and @Cierre and (Select count(*) from conceptos_socios 
where socio=sc.socio and fechaalta<sc.fechaIngreso)=0),
Reingresos=(Select count(*) from Socios sc
where FechaIngreso between @inicio and @Cierre and (Select count(*) from conceptos_socios 
where socio=sc.socio and fechaalta<sc.fechaIngreso)>0),
Bajas=(Select count(*) from Socios where FechaBaja between @inicio and @Cierre)





GO
/****** Object:  StoredProcedure [dbo].[Analisis]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create Procedure [dbo].[Analisis]
as
(
Select 'Foprosa' as Entidad,nt.socio as Socio, ad.apellido as apellido, ad.nombre as Nombre, nt.aniomes as aniomes,
nt.acobrar as acobrar, nt.cobrado as cobrado
from [New table] nt 

inner Join Adherentes ad on nt.socio=ad.adherente

where entidad=1

)
Union
(
Select 'Socios' as Entidad,nt.socio as Socio, ad.apellido as apellido, ad.nombre as Nombre, nt.aniomes as aniomes,
nt.acobrar as acobrar, nt.cobrado as cobrado
from [New table] nt 

inner Join Socios ad on nt.socio=ad.Socio

where entidad=0 

)

Order by Entidad, Apellido, Nombre, aCobrar, cobrado


GO
/****** Object:  StoredProcedure [dbo].[Analisis_Foprosa]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create Procedure [dbo].[Analisis_Foprosa]
as
Select nt.Socio as Socio, ad.Apellido as Apellido, ad.Nombre as Nombre , nt.aniomes as Aniomes
, nt1.fecha as Fecha, nt1.acobrar as aCobrar, nt1.cobrado as Cobrado
from [New Table] nt 

inner join [New Table] nt1 on nt1.aniomes=nt.aniomes and nt1.Socio=nt.Socio
and nt1.Entidad=nt.Entidad

inner join adherentes ad on nt.socio=ad.adherente

where nt.acobrar<>nt.cobrado and nt.entidad=1

order by nt.socio

GO
/****** Object:  StoredProcedure [dbo].[Analisis_Socios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create Procedure [dbo].[Analisis_Socios]
as
Select nt.Socio as Socio, ad.Apellido as Apellido, ad.Nombre as Nombre , nt.aniomes as Aniomes
, nt1.fecha as Fecha, nt1.acobrar as aCobrar, nt1.cobrado as Cobrado
from [New Table] nt 

inner join [New Table] nt1 on nt1.aniomes=nt.aniomes and nt1.Socio=nt.Socio
and nt1.Entidad=nt.Entidad

inner join Socios ad on nt.socio=ad.socio

where nt.acobrar<>nt.cobrado and nt.entidad=0

order by nt.socio

GO
/****** Object:  StoredProcedure [dbo].[analisisnorentados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  Procedure [dbo].[analisisnorentados]
as
Select count(*) as Casos,Importe,
C02,C05,F04,F05,F06,S01,
round(importe*count(*),2) as Parcial,'AMM' as unificador,
count(*)*C02 as tc02,
count(*)*C05 as tc05,
count(*)*F04 as tF04,
count(*)*F05 as tF05,
count(*)*F06 as tF06,
count(*)*S01 as tS01



from analisisGrupos

Group by Importe,c02,c05,f04,f05,f06,s01,importe


GO
/****** Object:  StoredProcedure [dbo].[Anexo]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE Procedure [dbo].[Anexo]
(
	@idObra		int=7108,
	@Base		varchar(20)='BaseCrm',
	@Modo		varchar(1)='P', -- Pendiente  T  Total
	@Suma		varChar(1)='C'
)
as
declare @SqlStr	 as nvarchar(4000)

Set @Base=ltrim(rtrim(@Base))

Select @SqlStr='Select isnull(a.notas,"") partNumber,substring(a.descripcion,1,19) descripcion,ea.cantidad*-1*signo as cantidad, a.precio,
isnull(amt.idCampo,0) as idCampoAmt, ea.idCampo idCampoEa,isnull(ea.idObra,ho.idObra) idObra from ' + @Base + '..estadisticaArticulos ea
left join ' + @Base + '..HeaderMovimientosStock ho on ea.idOPeracion=ho.idOPeracion
inner join BaseCrm..TiposMovimientoStock t on ea.tipomovimiento=t.idTipomovimientoStock
inner join ' + @Base + '..Articulos a on ea.idArticulo=a.idarticulo
left join ' + @Base + '..Detalle_Listas dl on a.idArticulo=dl.idarticulo
left join BaseCrm..anexoMateriales amt on ea.idcampoAnexo=amt.idcampo
where ea.fecfactura is null and isnull(ea.idObra,ho.idObra)=' + cast(@idObra as varchar(6))

if @Modo='P'
Select @SqlStr=@SqlStr + ' and isnull(amt.idOperacion,0)=0 '

if @Suma='S'
	Select @SqlStr=@SqlStr + ' and isnull(amt.idCampo,0)=0 '

-- Print @SqlStr

Exec sp_executesql @SqlStr








GO
/****** Object:  StoredProcedure [dbo].[AnexoIvaVentas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE Procedure [dbo].[AnexoIvaVentas]
(
	@Desde	varchar(8)='20150201',
	@Hasta	varchar(8)='20150228'
)
as
Select 
sum(case when tipoFactura='A' and idtransaccion<>108225  and iva<>0 and alicuota=21 then Neto else 0 end) NetoA,
sum(case when tipoFactura='A' and alicuota=21 then Iva else 0 end) IvaA,
sum(case when tipoFactura='B' and iva<>0 and alicuota=21 then case when idtransaccion=115694 then 10878.63 else Neto end else 0 end) NetoB,
sum(case when tipoFactura='B' and alicuota=21 then case 
when idtransaccion=115694 then 2284.51
else iva end else 0 end) IvaB,

sum(case when tipoFactura='A' and iva<>0 and alicuota=10.5 then Neto else 0 end) NetoA105,
sum(case when tipoFactura='A' and alicuota=10.5 then Iva else 0 end) IvaA105,
sum(case when tipoFactura='B' and iva<>0 and alicuota=10.5 then Neto else 0 end) NetoB105,
sum(case when tipoFactura='B' and alicuota=10.5 then Iva else 0 end) IvaB105,

sum(case when tipoFactura='E'  then neto else 0 end) NetoE,
sum(case when (tipoFactura<>'E' and iva=0) or idtransaccion in (108225,115694)
then case 
when idtransaccion=115694 then 10125
else neto end else 0 end) NetoExe,
sum(PIB) PIB
from vBaseIva where fecha between @Desde and @Hasta




GO
/****** Object:  StoredProcedure [dbo].[Anula_OP_Otros]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE     Procedure [dbo].[Anula_OP_Otros](@idOperacion int)
as
-- Agrego en ValoresTesoreriaOPAnulados, el valor Cancelado
insert into valoresTesoreriaOPAnulados
Select vt.* from Header_Operaciones ho
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join ValoresTesoreria vt
on vt.idtransaccion=do.idtransaccion 
where (ho.idOperacion=@idOperacion and idtipotransaccion=2)

-- Repongo a cartera de cheques
Update vt1 set vt1.cancelado=0 
from Header_Operaciones ho
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join ValoresTesoreria vt
on vt.idtransaccion=do.idtransaccion 
inner join aplicacionesvalores av
on vt.idtransaccion=av.idtransaccion
inner join valorestesoreria vt1
on av.idtransaccioncancelada=vt1.idtransaccion
where (ho.idOperacion=@idOperacion and idtipotransaccion=2)

-- Borro de valores Tesoreria  el valor Cancelado
Delete from  vt
from Header_Operaciones ho
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join ValoresTesoreria vt
on vt.idtransaccion=do.idtransaccion 
where (ho.idOperacion=@idOperacion and idtipotransaccion=2)

-- Guardo AsientosDiariosItems
insert into asientosdiariositemsanulados
Select ai.* 
from Header_Operaciones ho
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join AsientosDiariosHeader ah
on ho.asientodiario=ah.asiento and ho.aniomes=ah.aniomes and ho.tipoasiento=ah.tipoasiento
inner join AsientosDiariositems ai
on ho.asientodiario=ai.asiento and ho.aniomes=ai.aniomes and ho.tipoasiento=ai.tipoasiento
where ho.idOperacion=@idOperacion

-- Borro asientos Diarios items 
Delete from ai
from Header_Operaciones ho
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join AsientosDiariosHeader ah
on ho.asientodiario=ah.asiento and ho.aniomes=ah.aniomes and ho.tipoasiento=ah.tipoasiento
inner join AsientosDiariositems ai
on ho.asientodiario=ai.asiento and ho.aniomes=ai.aniomes and ho.tipoasiento=ai.tipoasiento
where ho.idOperacion=@idOperacion

-- Guardo Header de Asientos de Diario
insert into asientosdiariosHeaderAnulados
Select ah.*
from Header_Operaciones ho
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join AsientosDiariosHeader ah
on ho.asientodiario=ah.asiento and ho.aniomes=ah.aniomes and ho.tipoasiento=ah.tipoasiento
where ho.idOperacion=@idOperacion

-- Borro Header de Asientos de Diario
Delete from ah
from Header_Operaciones ho
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join AsientosDiariosHeader ah
on ho.asientodiario=ah.asiento and ho.aniomes=ah.aniomes and ho.tipoasiento=ah.tipoasiento
where ho.idOperacion=@idOperacion





GO
/****** Object:  StoredProcedure [dbo].[Anula_OP_Proveedores]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO





CREATE     Procedure [dbo].[Anula_OP_Proveedores](@idOperacion int)
as
-- Agrego en ValoresTesoreriaOPAnulados, el valor Cancelado
insert into valoresTesoreriaOPAnulados
Select vt.* from Header_Operaciones ho
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join ValoresTesoreria vt
on vt.idtransaccion=do.idtransaccion 
where (ho.idOperacion=@idOperacion and idtipotransaccion=2)

-- Repongo a cartera de cheques
Update vt1 set vt1.cancelado=0 
from Header_Operaciones ho
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join ValoresTesoreria vt
on vt.idtransaccion=do.idtransaccion 
inner join aplicacionesvalores av
on vt.idtransaccion=av.idtransaccion
inner join valorestesoreria vt1
on av.idtransaccioncancelada=vt1.idtransaccion
where (ho.idOperacion=@idOperacion and idtipotransaccion=2)

-- Borro de valores Tesoreria  el valor Cancelado
Delete from  vt
from Header_Operaciones ho
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join ValoresTesoreria vt
on vt.idtransaccion=do.idtransaccion 
where (ho.idOperacion=@idOperacion and idtipotransaccion=2)


-- Guardo Asientos Diarios items 
insert into asientosdiariositemsanulados
Select ai.*
from Header_Operaciones ho
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join CompprovHeader cp
on cp.idtransaccion=do.idtransaccion 
Left Join CompProvItems ci on 
cp.comprobante=ci.comprobante and cp.Aniomes=ci.aniomes
inner join AsientosDiariosHeader ah
on ho.asientodiario=ah.asiento and ho.aniomes=ah.aniomes and ho.tipoasiento=ah.tipoasiento
inner join AsientosDiariositems ai
on ho.asientodiario=ai.asiento and ho.aniomes=ai.aniomes and ho.tipoasiento=ai.tipoasiento
where ho.idOperacion=@idOperacion
and idtipotransaccion=1

-- Borro asientos Diarios items 
Delete from ai
from Header_Operaciones ho
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join CompprovHeader cp
on cp.idtransaccion=do.idtransaccion 
Left Join CompProvItems ci on 
cp.comprobante=ci.comprobante and cp.Aniomes=ci.aniomes
inner join AsientosDiariosHeader ah
on ho.asientodiario=ah.asiento and ho.aniomes=ah.aniomes and ho.tipoasiento=ah.tipoasiento
inner join AsientosDiariositems ai
on ho.asientodiario=ai.asiento and ho.aniomes=ai.aniomes and ho.tipoasiento=ai.tipoasiento
where ho.idOperacion=@idOperacion
and idtipotransaccion=1

-- Guardo Asientos Diarios Header
insert into asientosdiariosHeaderanulados
Select ah.*
from Header_Operaciones ho
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join CompprovHeader cp
on cp.idtransaccion=do.idtransaccion 
left Join CompProvItems ci on 
cp.comprobante=ci.comprobante and ci.Aniomes=cp.aniomes
inner join AsientosDiariosHeader ah
on ho.asientodiario=ah.asiento and ho.aniomes=ah.aniomes and ho.tipoasiento=ah.tipoasiento
where ho.idOperacion=@idOperacion
and idtipotransaccion=1

-- Borro Header de Asientos de Diario
Delete from ah
from Header_Operaciones ho
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join CompprovHeader cp
on cp.idtransaccion=do.idtransaccion 
left Join CompProvItems ci on 
cp.comprobante=ci.comprobante and ci.Aniomes=cp.aniomes
inner join AsientosDiariosHeader ah
on ho.asientodiario=ah.asiento and ho.aniomes=ah.aniomes and ho.tipoasiento=ah.tipoasiento
where ho.idOperacion=@idOperacion
and idtipotransaccion=1

-- Repongo Cancelados de Cuentas a Pagar
Update CC
set cancelado=isnull((
Select SUM(importe) 
from AplicacionesCuentasaPagar ac1 
where ac1.idTransaccionCancelada=acc.IdTransaccionCancelada 
and cc.idTransaccion=acc.IdTransaccionCancelada and ac1.idtransaccion<>do.idTransaccion),0) 
from Detalle_Operaciones do
inner Join AplicacionesCuentasaPagar acc on acc.idtransaccion=do.idtransaccion and do.idtipotransaccion=1
inner join CompProvHeader cc on cc.idTransaccion=acc.idtransaccionCancelada
where idOPeracion=@idOperacion

-- Repongo Cancelados de Cuentas a Pagar
Update CC
set canceladoOrigen=isnull((
Select SUM(ac1.importeOrigen) 
from AplicacionesCuentasaPagar ac1 
where ac1.idTransaccionCancelada=acc.IdTransaccionCancelada 
and cc.idTransaccion=acc.IdTransaccionCancelada and ac1.idtransaccion<>do.idTransaccion),0) 
from Detalle_Operaciones do
inner Join AplicacionesCuentasaPagar acc on acc.idtransaccion=do.idtransaccion and do.idtipotransaccion=1
inner join CompProvHeader cc on cc.idTransaccion=acc.idtransaccionCancelada
where idOPeracion=@idOperacion

-- Guardo Orden de Pago anulada
insert into compprovheaderAnulados
Select cp.*
from Header_Operaciones ho
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join CompprovHeader cp
on cp.idtransaccion=do.idtransaccion 
where ho.idOperacion=@idOperacion
and idtipotransaccion=1

-- Borro Orden de Pago anulada
Delete cp
from Header_Operaciones ho
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join CompprovHeader cp
on cp.idtransaccion=do.idtransaccion 
where ho.idOperacion=@idOperacion
and idtipotransaccion=1

-- Guardo aplicaciones de Cuentas a Pagar
Insert into aplicacionesCuentasaPagarAnuladas
Select acc.*
from Detalle_Operaciones do
inner Join AplicacionesCuentasaPagar acc on acc.idtransaccion=do.idtransaccion 
where idOPeracion=@idOperacion and do.idtipotransaccion=1

-- Borro aplicaciones de Cuentas a Pagar
Delete acc
from Detalle_Operaciones do
inner Join AplicacionesCuentasaPagar acc on acc.idtransaccion=do.idtransaccion 
where idOPeracion=@idOperacion and do.idtipotransaccion=1




GO
/****** Object:  StoredProcedure [dbo].[Anula_Transaccion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create Procedure [dbo].[Anula_Transaccion] (@idtransaccion int, @idOperacion int)
as
Insert into DetalleCuentasCorrientesAnuladas
select * from DetalleCuentasCorrientes
where idtransaccion=@idtransaccion

Insert into CuentasCorrientesAnuladas
select * from CuentasCorrientes
where idtransaccion=@idtransaccion

Delete from CuentasCorrientes 
where idtransaccion=@idtransaccion

Delete from DetalleCuentasCorrientes 
where idtransaccion=@idtransaccion

insert into detalle_operaciones 
(IdOperacion,IdTipoTransaccion,idTransaccion,itemdiario)
values
(@IdOperacion,10,@idTransaccion,0)


GO
/****** Object:  StoredProcedure [dbo].[AnulaFactura]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


Create  Procedure [dbo].[AnulaFactura]
(
	@idOperacion int
)
as
Update v
set totalimporte=0
from VenCliHeader v
inner join Detalle_operaciones do 
on v.idtransaccion=do.idtransaccion and idtipotransaccion=0
inner join EstadisticaArticulos ea
on do.idOperacion=ea.idOperacion
inner join EstadisticaArticulosPrecios eap 
on ea.idCampo=eap.idcampo
where do.idOperacion like @idOperacion

insert into EstadisticaArticulosPreciosAnulados
Select eap.*,getdate()
from VenCliHeader v
inner join Detalle_operaciones do 
on v.idtransaccion=do.idtransaccion and idtipotransaccion=0
inner join EstadisticaArticulos ea
on do.idOperacion=ea.idOperacion
inner join EstadisticaArticulosPrecios eap 
on ea.idCampo=eap.idcampo
where do.idOperacion like @idOperacion


Delete eap
from VenCliHeader v
inner join Detalle_operaciones do 
on v.idtransaccion=do.idtransaccion and idtipotransaccion=0
inner join EstadisticaArticulos ea
on do.idOperacion=ea.idOperacion
inner join EstadisticaArticulosPrecios eap 
on ea.idCampo=eap.idcampo
where do.idOperacion like @idOperacion

insert into EstadisticaArticulosDescripcionesAnulados
Select eap.*,getdate()
from VenCliHeader v
inner join Detalle_operaciones do 
on v.idtransaccion=do.idtransaccion and idtipotransaccion=0
inner join EstadisticaArticulos ea
on do.idOperacion=ea.idOperacion
inner join EstadisticaArticulosDescripciones eap 
on ea.idCampo=eap.idcampo
where do.idOperacion like @idOperacion


Delete eap
from VenCliHeader v
inner join Detalle_operaciones do 
on v.idtransaccion=do.idtransaccion and idtipotransaccion=0
inner join EstadisticaArticulos ea
on do.idOperacion=ea.idOperacion
inner join EstadisticaArticulosDescripciones eap 
on ea.idCampo=eap.idcampo
where do.idOperacion like @idOperacion



insert into EstadisticaArticulosAnulados
Select ea.*,getdate()
from VenCliHeader v
inner join Detalle_operaciones do 
on v.idtransaccion=do.idtransaccion and idtipotransaccion=0
inner join EstadisticaArticulos ea
on do.idOperacion=ea.idOperacion
where do.idOperacion like @idOperacion

Delete ea
from VenCliHeader v
inner join Detalle_operaciones do 
on v.idtransaccion=do.idtransaccion and idtipotransaccion=0
inner join EstadisticaArticulos ea
on do.idOperacion=ea.idOperacion
where do.idOperacion like @idOperacion

Insert into asientosdiariositemsanulados
Select ai.*
from VenCliHeader v
inner join Detalle_operaciones do 
on v.idtransaccion=do.idtransaccion and idtipotransaccion=0
inner join Header_operaciones ea
on do.idOperacion=ea.idOperacion
inner join asientosdiariositems ai
on ea.asientodiario=ai.asiento and ea.tipoasiento=ai.tipoasiento and ea.aniomes=ai.aniomes
where do.idOperacion like @idOperacion

Delete ai
from VenCliHeader v
inner join Detalle_operaciones do 
on v.idtransaccion=do.idtransaccion and idtipotransaccion=0
inner join Header_operaciones ea
on do.idOperacion=ea.idOperacion
inner join asientosdiariositems ai
on ea.asientodiario=ai.asiento and ea.tipoasiento=ai.tipoasiento and ea.aniomes=ai.aniomes
where do.idOperacion like @idOperacion


GO
/****** Object:  StoredProcedure [dbo].[aPlanTarjeta]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE procedure [dbo].[aPlanTarjeta]
(
	@socio int=257,
	@entidad int=0
)
as

Declare @saldo int=0
Declare @idAplan int=0
/*

Select @saldo=isnull(dbo.SaldosinPlan(@socio,0,getdate()),0)

if @saldo<>0
begin
INSERT INTO [dbo].[CuentasCorrientes]
           ([socio]
           ,[Entidad]
           ,[Fecha]
           ,[Concepto]
           ,[PuntodeVenta]
           ,[DocumentoNumero]
           ,[FechaRendicion]
           ,[Rendicion]
           ,[importe]
           ,[Cancelado]
           ,[vencimiento]
           ,[Cobrador]
           ,[Serie]
           ,[idCancelada]
           ,[idOpCobrador] )
     VALUES
           (@socio
           ,@entidad
           ,getdate()
           ,'APT'
           ,0
           ,dbo.toaniomes(getdate())
           ,getdate()
           ,0
           ,@saldo
           ,@saldo
           ,getdate()
           ,0
           ,''
           ,0
           ,0)

Select @idAplan=@@IDENTITY

Select idtransaccion,importe-isnull(cancelado,0) Importe 
into #aplica
from cuentascorrientes 
where socio=@socio and entidad=@entidad
and isnull(cancelado,0)<importe

insert into AplicacionesCuentasCorrientes
select @idAplan,1,idtransaccion,importe
from #aplica

Update c 
set cancelado=isnull(cancelado,0)+a.importe
from cuentascorrientes c
inner join #aplica a
on c.IdTransaccion=a.IdTransaccion

end

*/
GO
/****** Object:  StoredProcedure [dbo].[AplicaMovimiento]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE   Procedure [dbo].[AplicaMovimiento](@idTransaccion int, @idTransaccionOrigen int, @Importe Numeric(18,2)) 
as

insert into AplicacionesCuentasCorrientes
values
(@idTransaccionOrigen,1,@idTransaccion,@Importe)

Update CuentasCorrientes 
set cancelado=isnull((
Select SUM(importe) 
from AplicacionesCuentasCorrientes ac1 
where ac1.idTransaccionCancelada=@idTransaccion),0)
where idtransaccion=@idTransaccion



Update CuentasCorrientes 
set cancelado=isnull((
Select SUM(importe) 
from AplicacionesCuentasCorrientes ac1 
where ac1.idTransaccion=@idTransaccionOrigen),0)
where idtransaccion=@idTransaccionOrigen


GO
/****** Object:  StoredProcedure [dbo].[ArmaComposicionStock]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE Procedure [dbo].[ArmaComposicionStock]
(
	@Fecha varchar(8)='20120630',
	@ComputerName	varchar(30)='PC'
)
as
Declare @idArticulo	int
Declare @Articulo	varchar(20)
Declare @Meses		int
Declare	@Stock		numeric(18,2)



DECLARE cArticulos CURSOR FOR 
Select idArticulo,Articulo,meses,dbo.stockaFecha(idArticulo,@Fecha) from articulos 
Where --meses<>0 and 
dbo.stockaFecha(idArticulo,@Fecha)>0
-- and cast(articulo as varchar(20)) between '700000' and '799999'
order by articulo

/*** Borro TempImputaciones ***/
Delete from Temp_Vencimientos where Computername=@ComputerName

/*** Abro el Cursor ***/
OPEN cArticulos
FETCH NEXT FROM cArticulos INTO @idArticulo,@Articulo, @Meses,@Stock

WHILE @@FETCH_STATUS = 0
BEGIN
	Declare @Cantidad		numeric(18,2)
	Declare	@FechaMov		datetime
	Declare	@FechaVto		datetime
	Declare @idCampo	int

	DECLARE mArticulos CURSOR FOR 
	Select Cantidad,Vencimiento Fabricacion,vencimiento+(@Meses*30) Vencimiento,idCampo 
	from estadisticaarticulos ea
	inner join Header_operaciones ho on ea.idOperacion=ho.idOPeracion
	where idArticulo=@idArticulo and tipomovimiento=1 and isnull(FechaDos,ho.fecha)<=@Fecha
	order by isnull(FechaDos,ho.fecha) desc

	/*** Abro el Cursor ***/
	OPEN mArticulos
	FETCH NEXT FROM mArticulos INTO @Cantidad,@FechaMov,@FechaVto,@idCampo
	Declare	@acum numeric(18,2)
	Set @Acum = 0

	WHILE @@FETCH_STATUS = 0
	BEGIN
		if @acum<@Stock
			Begin
				if @Cantidad>@Stock-@acum
					set @Cantidad=@Stock-@acum

				insert into Temp_Vencimientos
				(idCampo,Fecha,Vto,Cantidad,Computername)
				values
				(@idCampo,@FechaMov,@FechaVto,@Cantidad,@Computername)
			end	
	
		Set @Acum=@Acum + @Cantidad

		FETCH NEXT FROM mArticulos INTO @Cantidad,@FechaMov,@FechaVto,@idCampo
	END
	Close mArticulos
	Deallocate mArticulos

	FETCH NEXT FROM cArticulos INTO @idArticulo,@Articulo, @Meses,@Stock
END

CLOSE cArticulos
DEALLOCATE cArticulos





GO
/****** Object:  StoredProcedure [dbo].[ArmaLista]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO





CREATE      Procedure [dbo].[ArmaLista]
(
	@idLista	int=4,
	@idLista1	int=1,
	@idLista2	int=85,
	@idLista3	int=90,
	@idLista4	int=95,
	@idListaBase	int=0,
	@Coeficiente	numeric(18,2)=0,
	@idLinea	int=0,
	@idSublinea	int=0,
	@idMarca	int=0,
	@adesde		varchar(20)='',
	@ahasta		varchar(20)='',
	@idModalidad	int=0,
	@Activos	int=0 -- 0 Activos 1 Todos


)
as

Select Articulo,Descripcion,isnull(dl.Moneda,0) Moneda,
isnull(dl.Neto,0) Neto,isnull(dl.Final,0) Final,
isnull(dl1.Neto,0) Neto1,isnull(dl1.Final,0) Final1,
isnull(dl2.Neto,0) Neto2,isnull(dl2.Final,0) Final2,
isnull(dl3.Neto,0) Neto3,isnull(dl3.Final,0) Final3,
isnull(dl4.Neto,0) Neto4,isnull(dl4.Final,0) Final4,
isnull(dl.redondeo,0) redondeo,a.idArticulo,
case when isnull(alicuota,0)=0 then (Select Ivageneral from parametrosgeneralessueldos) else
alicuota end alicuota
from Articulos a
left join Detalle_Listas dl
on a.idArticulo=dl.idArticulo and dl.idLista=@idLista
left join Detalle_Listas dl1
on a.idArticulo=dl1.idArticulo and dl1.idLista=@idLista1
left join Detalle_Listas dl2
on a.idArticulo=dl2.idArticulo and dl2.idLista=@idLista2
left join Detalle_Listas dl3
on a.idArticulo=dl3.idArticulo and dl3.idLista=@idLista3
left join Detalle_Listas dl4
on a.idArticulo=dl4.idArticulo and dl4.idLista=@idLista4
where isNull(dl.idlista,@idLista)=@idLista
and (a.fechainactivo is null or @Activos=1)
and (@idLinea=0 or idlinea=@idlinea)
and (@idsubLinea=0 or idsublinea=@idsublinea)
and (@idMarca=0 or idMarca=@idMarca)
and (@adesde='' or articulo>=@adesde)
and (@ahasta='' or articulo<=@aHasta)





GO
/****** Object:  StoredProcedure [dbo].[ArmaVencimientos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE Procedure [dbo].[ArmaVencimientos]
(
	@Fecha varchar(8)='20101231',
	@ComputerName	varchar(30)='veamos'
)
as
Declare @idArticulo	int
Declare @Articulo	varchar(20)
Declare @Meses		int
Declare	@Stock		numeric(18,2)

DECLARE cArticulos CURSOR FOR 
Select idArticulo,Articulo,meses,dbo.stockaFecha(idArticulo,@Fecha) from articulos 
Where -- meses<>0 and 
dbo.stockaFecha(idArticulo,@Fecha)>0
and cast(articulo as varchar(20)) between '700000' and '799999'
order by articulo

/*** Borro TempImputaciones ***/
Delete from Temp_Vencimientos where Computername=@ComputerName

/*** Abro el Cursor ***/
OPEN cArticulos
FETCH NEXT FROM cArticulos INTO @idArticulo,@Articulo, @Meses,@Stock

WHILE @@FETCH_STATUS = 0
BEGIN
	Declare @Cantidad		numeric(18,2)
	Declare @Saldo		numeric(18,2)
	Declare	@FechaMov		datetime
	Declare	@FechaVto		datetime
	Declare @idCampo	int

	DECLARE mArticulos CURSOR FOR 
	Select Cantidad,Vencimiento Fabricacion,vencimiento+(@Meses*30) Vencimiento,idCampo from estadisticaarticulos ea
	inner join Header_operaciones ho on ea.idOperacion=ho.idOPeracion
	where idArticulo=@idArticulo and tipomovimiento=1 order by isnull(FechaDos,ho.fecha) desc

	/*** Abro el Cursor ***/
	OPEN mArticulos
	FETCH NEXT FROM mArticulos INTO @Cantidad,@FechaMov,@FechaVto,@idCampo
	Declare	@acum numeric(18,2)
	Set @Acum = 0

	WHILE @@FETCH_STATUS = 0
	BEGIN
		set @Saldo=@Cantidad
		if @acum<@Stock and @Stock>0
			begin
				if @Stock-@aCum<@Cantidad
					set @Saldo=@Stock-@aCum

				insert into Temp_Vencimientos
				(idCampo,Fecha,Vto,Cantidad,saldo,Computername)
				values
				(@idCampo,@FechaMov,@FechaVto,@Cantidad,@Saldo,@Computername)
			end

		Set @Acum=@Acum + @Cantidad

		FETCH NEXT FROM mArticulos INTO @Cantidad,@FechaMov,@FechaVto,@idCampo
	END
	Close mArticulos
	Deallocate mArticulos

	FETCH NEXT FROM cArticulos INTO @idArticulo,@Articulo, @Meses,@Stock
END

CLOSE cArticulos
DEALLOCATE cArticulos







GO
/****** Object:  StoredProcedure [dbo].[Asiento_rendicion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE     Procedure [dbo].[Asiento_rendicion] (@idOperacion int) 
as

Declare @Aniomes int
Declare @Asiento int
Declare @Tipoasiento int

Select @aniomes=(Select ho.aniomes
from Header_Operaciones ho
where idOperacion=@idOperacion)

Select @Asiento=(Select ho.AsientoDiario
from Header_Operaciones ho
where idOperacion=@idOperacion)

Select @Tipoasiento=1

Update AsientosDiariosHeader
Set Detalle=(Select 'Rendicion ' + case ho.TipodeOperacion
	when 17 then ' de ' + (Select Nombre from Cobradores where cobrador=ho.cuenta)
	when 19 then 'Numero ' + cast(ho.ComprobanteNumero as char(10))
	end
from Header_Operaciones ho
where idOperacion=@idOperacion)
where asiento=@asiento and aniomes=@aniomes and tipoasiento=@Tipoasiento

Update Header_operaciones 
set cerrada=getdate()
where idOperacion=@idOperacion

-- Borro Asiento de Diario Anterior
Delete from AsientosDiariosItems
where asiento=@asiento and aniomes=@aniomes and tipoasiento=@Tipoasiento

-- Guardo Asiento de Diario Nuevo
insert into AsientosDiariosItems
Select 
ho.asientoDiario,
0 as item,
ho.aniomes,
@TipoAsiento as tipoasiento,
ct.Imputacion_Contable,
Sum(cc.Importe) as Debe, 
0 as Haber,
'' as Observacion, 
0 as CentroCosto
from Detalle_Operaciones do
inner join Header_Operaciones ho
on do.idOperacion=ho.IdOperacion
inner join ValoresTesoreria cc
on do.idtransaccion=cc.idtransaccion
inner join Conceptos_Tesoreria ct
on cc.idConcepto_tesoreria=ct.idConcepto_tesoreria
where do.idoperacion=@idOperacion and idtipotransaccion=2
Group by ct.Imputacion_Contable,ho.asientoDiario,ho.aniomes
having Sum(cc.Importe)>0
Union
Select 
ho.asientoDiario,
0 as item,
ho.aniomes,
@TipoAsiento as tipoasiento,
ct.Imputacion_Contable,0 as Debe, 
Sum(cc.Importe)*-1 as Haber,
'' as observacion, 
0 as centrocosto
from Detalle_Operaciones do
inner join Header_Operaciones ho
on do.idOperacion=ho.IdOperacion
inner join ValoresTesoreria cc
on do.idtransaccion=cc.idtransaccion
inner join Conceptos_Tesoreria ct
on cc.idConcepto_tesoreria=ct.idConcepto_tesoreria
where do.idoperacion=@idOperacion and idtipotransaccion=2
Group by ct.Imputacion_Contable,ho.asientoDiario,ho.aniomes
having Sum(cc.Importe)<0
union
Select 
ho.asientoDiario,
0 as item,
ho.aniomes,
@Tipoasiento as tipoasiento,
ct.Imputacion_Contable, 
0 as debe,
Sum(dcc.Importe) as haber,
'' as observacion, 
0 as centrocosto
from Detalle_Operaciones do
inner join Header_Operaciones ho
on do.idOperacion=ho.IdOperacion
inner join CuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion
inner join AplicacionesCuentasCorrientes acc
on cc.idtransaccion=acc.idtransaccion
inner join CuentasCorrientes cc1
on acc.idtransaccionCancelada=cc1.idtransaccion
inner join DetalleCuentasCorrientes dcc
on cc1.idtransaccion=dcc.idtransaccion
inner Join Conceptos ct
on ct.Concepto=dcc.Concepto
where ho.idoperacion=@idOperacion and idtipotransaccion=0
Group by ct.Imputacion_Contable,ho.asientoDiario,ho.aniomes





GO
/****** Object:  StoredProcedure [dbo].[AsientosIngresos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO






CREATE           Procedure 
[dbo].[AsientosIngresos] /*0,200304,'20030430'*/(@Tipo int,@Periodo int,@Fecha datetime)
/*
	Tipos de Asientos
	0. Cobranzas Ventanilla
	1. Cobranzas (Cobradores)}
	2. Rendiciones Colegios
*/

As

declare @AsientoCierre int
Declare @Table char(11)
 
if @tipo=0
	begin

		Select @AsientoCierre=isnull((Select asientoDiario from header_Operaciones 
		where aniomes=@Periodo and tipodeOperacion=210 and tipoasiento=0),0)
		if @AsientoCierre=0
			begin 
				select @Table='as_0_'+cast(@Periodo as char(6))
				Execute getNextIdentity @Table, @Value=@asientoCierre Output

				insert into Header_Operaciones 
				(fecha,tipodeOperacion,Observacion,asientoDiario,aniomes,tipoasiento,Procesado,AsientoCierre)
				values
				(getdate(),210,'Asiento Resumen de Cobranzas en sede',@AsientoCierre,@Periodo,0,getdate(),1)

			end

		update AsientosDiariosHeader
		set asientoCierre=@AsientoCierre 
		from asientosDiariosItems ai 
		inner Join AsientosDiariosHeader ah on 
		ah.asiento=ai.asiento and ah.aniomes=ai.aniomes
		and ah.tipoasiento=ai.tipoasiento
		inner Join header_Operaciones ho on 
		ai.asiento=ho.asientodiario and 
		ai.tipoasiento=ho.tipoasiento and 
		ai.aniomes=ho.aniomes 

		where 
		ho.aniomes=@Periodo
		and (tipodeOperacion=11 or tipodeOperacion=15)

		Delete from AsientosDiariosHeader
		where asiento=@AsientoCierre and Aniomes=@Periodo and tipoasiento=0

Print @AsientoCierre
Print @Periodo

		Delete from AsientosDiariosItems
		where asiento=@AsientoCierre and Aniomes=@Periodo and tipoasiento=0

		insert into asientosdiariosHeader
		values
		(@AsientoCierre,@Periodo,0,@Fecha,'Asiento Resumen de Cobranzas en Sede',0,0)

		Insert into AsientosDiariosItems
		Select @AsientoCierre as Asiento,0 as item,@Periodo as Aniomes,
		0 as tipoasiento,ai.cuenta,sum(debe),sum(haber),'' as observacion,0 as centrocosto
		from asientosDiariosItems ai 
		inner Join AsientosDiariosHeader ah on 
		ah.asiento=ai.asiento and ah.aniomes=ai.aniomes
		and ah.tipoasiento=ai.tipoasiento
		inner Join header_Operaciones ho on 
		ai.asiento=ho.asientodiario and 
		ai.tipoasiento=ho.tipoasiento and 
		ai.aniomes=ho.aniomes 

		where 
		ho.aniomes=@Periodo
		and (tipodeOperacion=11 or tipodeOperacion=15 or tipodeOperacion=82)
		and Haber=0		
		Group by ai.cuenta

		union

		Select @AsientoCierre as Asiento,1 as item,@Periodo as Aniomes,
		0 as tipoasiento,ai.cuenta,sum(debe),sum(haber),'' as observacion,0 as centrocosto
		from asientosDiariosItems ai 
		inner Join AsientosDiariosHeader ah on 
		ah.asiento=ai.asiento and ah.aniomes=ai.aniomes
		and ah.tipoasiento=ai.tipoasiento
		inner Join header_Operaciones ho on 
		ai.asiento=ho.asientodiario and 
		ai.tipoasiento=ho.tipoasiento and 
		ai.aniomes=ho.aniomes 

		where 
		ho.aniomes=@Periodo
		and (tipodeOperacion=11 or tipodeOperacion=15 or tipodeOperacion=82)
		and Debe=0		
		Group by ai.cuenta

	end	

else if @tipo=1

	begin

		Select @AsientoCierre=isnull((Select asientoDiario from header_Operaciones 
		where aniomes=@Periodo and tipodeOperacion=217 and tipoasiento=0),0)
		if @AsientoCierre=0
			begin 

				select @Table='as_0_'+cast(@Periodo as char(6))
				Execute getNextIdentity @Table, @Value=@asientoCierre Output

				insert into Header_Operaciones 
				(fecha,tipodeOperacion,Observacion,asientoDiario,aniomes,tipoasiento,Procesado,AsientoCierre)
				values
				(getdate(),217,'Asiento Resumen de Cobranzas Globales',@AsientoCierre,@Periodo,0,getdate(),1)

			end

		update AsientosDiariosHeader
		set asientoCierre=@AsientoCierre 
		from asientosDiariosItems ai 
		inner Join AsientosDiariosHeader ah on 
		ah.asiento=ai.asiento and ah.aniomes=ai.aniomes
		and ah.tipoasiento=ai.tipoasiento
		inner Join header_Operaciones ho on 
		ai.asiento=ho.asientodiario and 
		ai.tipoasiento=ho.tipoasiento and 
		ai.aniomes=ho.aniomes 

		where 
		ho.aniomes=@Periodo
		and (tipodeOperacion=17)

		Delete from AsientosDiariosHeader
		where asiento=@AsientoCierre and Aniomes=@Periodo and tipoasiento=0

		Delete from AsientosDiariosItems
		where asiento=@AsientoCierre and Aniomes=@Periodo and tipoasiento=0

		insert into asientosdiariosHeader
		values
		(@AsientoCierre,@Periodo,0,@Fecha,'Asiento Resumen de Cobranzas Globales',0,0)

		Insert into AsientosDiariosItems
		Select @AsientoCierre as Asiento,0 as item,@Periodo as Aniomes,
		0 as tipoasiento,ai.cuenta,sum(debe),sum(haber),'' as observacion,0 as centrocosto
		from asientosDiariosItems ai 
		inner Join AsientosDiariosHeader ah on 
		ah.asiento=ai.asiento and ah.aniomes=ai.aniomes
		and ah.tipoasiento=ai.tipoasiento
		inner Join header_Operaciones ho on 
		ai.asiento=ho.asientodiario and 
		ai.tipoasiento=ho.tipoasiento and 
		ai.aniomes=ho.aniomes 

		where 
		ho.aniomes=@Periodo
		and (tipodeOperacion=17)
		and Haber=0		
		Group by ai.cuenta

		union

		Select @AsientoCierre as Asiento,1 as item,@Periodo as Aniomes,
		0 as tipoasiento,ai.cuenta,sum(debe),sum(haber),'' as observacion,0 as centrocosto
		from asientosDiariosItems ai 
		inner Join AsientosDiariosHeader ah on 
		ah.asiento=ai.asiento and ah.aniomes=ai.aniomes
		and ah.tipoasiento=ai.tipoasiento
		inner Join header_Operaciones ho on 
		ai.asiento=ho.asientodiario and 
		ai.tipoasiento=ho.tipoasiento and 
		ai.aniomes=ho.aniomes 

		where 
		ho.aniomes=@Periodo
		and (tipodeOperacion=17)
		and Debe=0		
		Group by ai.cuenta

	end	

else if @tipo=2

	begin

		Select @AsientoCierre=isnull((Select asientoDiario from header_Operaciones 
		where aniomes=@Periodo and tipodeOperacion=219 and tipoasiento=0),0)
		if @AsientoCierre=0
			begin 

				select @Table='as_0_'+cast(@Periodo as char(6))
				Execute getNextIdentity @Table, @Value=@asientoCierre Output

				insert into Header_Operaciones 
				(fecha,tipodeOperacion,Observacion,asientoDiario,aniomes,tipoasiento,Procesado,AsientoCierre)
				values
				(getdate(),219,'Asiento Resumen de Cobranzas Locales',@AsientoCierre,@Periodo,0,getdate(),1)

			end

		update AsientosDiariosHeader
		set asientoCierre=@AsientoCierre 
		from asientosDiariosItems ai 
		inner Join AsientosDiariosHeader ah on 
		ah.asiento=ai.asiento and ah.aniomes=ai.aniomes
		and ah.tipoasiento=ai.tipoasiento
		inner Join header_Operaciones ho on 
		ai.asiento=ho.asientodiario and 
		ai.tipoasiento=ho.tipoasiento and 
		ai.aniomes=ho.aniomes 

		where 
		ho.aniomes=@Periodo
		and (tipodeOperacion=19)

		Delete from AsientosDiariosHeader
		where asiento=@AsientoCierre and Aniomes=@Periodo and tipoasiento=0

		Delete from AsientosDiariosItems
		where asiento=@AsientoCierre and Aniomes=@Periodo and tipoasiento=0

		insert into asientosdiariosHeader
		values
		(@AsientoCierre,@Periodo,0,@Fecha,'Asiento Resumen de Cobranzas Locales',0,0)

		Insert into AsientosDiariosItems
		Select @AsientoCierre as Asiento,0 as item,@Periodo as Aniomes,
		0 as tipoasiento,ai.cuenta,sum(debe),sum(haber),'' as observacion,0 as centrocosto
		from asientosDiariosItems ai 
		inner Join AsientosDiariosHeader ah on 
		ah.asiento=ai.asiento and ah.aniomes=ai.aniomes
		and ah.tipoasiento=ai.tipoasiento
		inner Join header_Operaciones ho on 
		ai.asiento=ho.asientodiario and 
		ai.tipoasiento=ho.tipoasiento and 
		ai.aniomes=ho.aniomes 

		where 
		ho.aniomes=@Periodo
		and (tipodeOperacion=19)
		and Haber=0		
		Group by ai.cuenta

		union

		Select @AsientoCierre as Asiento,1 as item,@Periodo as Aniomes,
		0 as tipoasiento,ai.cuenta,sum(debe),sum(haber),'' as observacion,0 as centrocosto
		from asientosDiariosItems ai 
		inner Join AsientosDiariosHeader ah on 
		ah.asiento=ai.asiento and ah.aniomes=ai.aniomes
		and ah.tipoasiento=ai.tipoasiento
		inner Join header_Operaciones ho on 
		ai.asiento=ho.asientodiario and 
		ai.tipoasiento=ho.tipoasiento and 
		ai.aniomes=ho.aniomes 

		where 
		ho.aniomes=@Periodo
		and (tipodeOperacion=19)
		and Debe=0		
		Group by ai.cuenta
	end	




GO
/****** Object:  StoredProcedure [dbo].[AsientosResumen]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO






CREATE       Procedure 
[dbo].[AsientosResumen] /*0,200304,'20030430'*/(@Tipo int,@Periodo int,@Fecha datetime)
/*
	Tipos de Asientos
	0. Cobranzas Ventanilla
	1. Cobranzas (Cobradores)}
	2. Rendiciones Colegios
*/

As

declare @AsientoCierre int
Declare @Table char(11)
 
	Select @AsientoCierre=isnull((Select asientoDiario from header_Operaciones 
	where aniomes=@Periodo and tipodeOperacion=case @Tipo
							when 1 then 210 
							when 2 then 220 
							when 3 then 230 
							when 4 then 240 
							when 6 then 260 end
							and tipoasiento=0),0)
	if @AsientoCierre=0
		begin 
			select @Table='as_0_'+cast(@Periodo as char(6))
			Execute getNextIdentity @Table, @Value=@asientoCierre Output

			insert into Header_Operaciones 
			(fecha,tipodeOperacion,Observacion,asientoDiario,aniomes,tipoasiento,Procesado,AsientoCierre)
			values
			(getdate(),
			case @Tipo
							when 1 then 210 
							when 2 then 220 
							when 3 then 230 
							when 4 then 240 
							when 6 then 260 end,
			case @Tipo
				when 1 then 'Asiento Resumen de Ingresos' 
				when 2 then 'Asiento Resumen de Egresos' 
				when 3 then 'Asiento Resumen de Compras' 
				when 4 then 'Asiento Resumen de Ventas' 
				when 6 then 'Asiento Resumen de Tesoreria' 
				end
			,@AsientoCierre,@Periodo,0,getdate(),@AsientoCierre)

		end

	update AsientosDiariosHeader
	set asientoCierre=@AsientoCierre 
	from asientosDiariosItems ai 
	inner Join AsientosDiariosHeader ah on 
	ah.asiento=ai.asiento and ah.aniomes=ai.aniomes
	and ah.tipoasiento=ai.tipoasiento
	inner Join header_Operaciones ho on 
	ai.asiento=ho.asientodiario and 
	ai.tipoasiento=ho.tipoasiento and 
	ai.aniomes=ho.aniomes 

	where 
	ho.aniomes=@Periodo
	and (ho.tipoasiento=@Tipo and tipodeOperacion<200)

	Delete from AsientosDiariosHeader
	where asiento=@AsientoCierre and Aniomes=@Periodo and tipoasiento=0

	Print @AsientoCierre
	Print @Periodo

	Delete from AsientosDiariosItems
	where asiento=@AsientoCierre and Aniomes=@Periodo and tipoasiento=0

	insert into asientosdiariosHeader
	values
	(@AsientoCierre,@Periodo,0,@Fecha,
			case @Tipo
				when 1 then 'Asiento Resumen de Ingresos' 
				when 2 then 'Asiento Resumen de Egresos' 
				when 3 then 'Asiento Resumen de Compras' 
				when 4 then 'Asiento Resumen de Ventas' 
				when 6 then 'Asiento Resumen de Tesoreria' 
				end,0,0)

	/*** Declaro Variables Imputacion ***/
	DECLARE @item 			as int
	Declare @Cuenta			as int
	Declare @Centrocosto		as int
	DECLARE @Debe		 	as Numeric(18,2)
	DECLARE @Haber 		        as Numeric(18,2)
	
	/*** Declaro el Cursor de los Conceptos ***/
	DECLARE AsientoResumen CURSOR FOR 
	Select -- @AsientoCierre as Asiento,0 as item,@Periodo as Aniomes,
	--0 as tipoasiento,
	ai.cuenta,isnull(ai.Centrocosto,1) as centrocosto,sum(debe),sum(haber)
	--,'' as observacion
	from asientosDiariosItems ai 
	inner Join AsientosDiariosHeader ah on 
	ah.asiento=ai.asiento and ah.aniomes=ai.aniomes
	and ah.tipoasiento=ai.tipoasiento
	inner Join header_Operaciones ho on 
	ai.asiento=ho.asientodiario and 
	ai.tipoasiento=ho.tipoasiento and 
	ai.aniomes=ho.aniomes 

	where 
	ho.aniomes=@Periodo
	and (ho.tipoasiento=@Tipo and tipodeOperacion<200)
	and Haber=0		
	Group by ai.cuenta,isnull(ai.Centrocosto,1)
	having round(sum(debe)+sum(haber),2)<>0

	union
	Select -- @AsientoCierre as Asiento,0 as item,@Periodo as Aniomes,
	--0 as tipoasiento,
	ai.cuenta,isnull(ai.Centrocosto,1) as centrocosto,sum(debe),sum(haber)
	--,'' as observacion
	from asientosDiariosItems ai 
	inner Join AsientosDiariosHeader ah on 
	ah.asiento=ai.asiento and ah.aniomes=ai.aniomes
	and ah.tipoasiento=ai.tipoasiento
	inner Join header_Operaciones ho on 
	ai.asiento=ho.asientodiario and 
	ai.tipoasiento=ho.tipoasiento and 
	ai.aniomes=ho.aniomes 

	where 
	ho.aniomes=@Periodo
	and (ho.tipoasiento=@Tipo and tipodeOperacion<200)
	and Debe=0		
	Group by ai.cuenta,isnull(ai.Centrocosto,1)
	having round(sum(debe)+sum(haber),2)<>0

OPEN AsientoResumen
FETCH NEXT FROM AsientoResumen INTO @Cuenta,@Centrocosto,@debe,@haber

set @item=0
/*** Recorro el Cursor ***/
WHILE @@FETCH_STATUS = 0
BEGIN
	set @item=@item+1
Print @asientoCierre
Print @Item 
Print @cuenta


	Insert into AsientosDiariosItems
	(asiento,item,tipoasiento,aniomes,cuenta,centrocosto,debe,haber)
	values (@AsientoCierre,@item,0,@Periodo,@cuenta,@Centrocosto,@debe,@haber)

	FETCH NEXT FROM AsientoResumen INTO @Cuenta,@Centrocosto,@debe,@haber
END

CLOSE AsientoResumen
DEALLOCATE AsientoResumen







GO
/****** Object:  StoredProcedure [dbo].[Bajas2003]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[Bajas2003]
as
Select h.nombre,count(*) as cantidad
from socios sc
left join Grupos_socios gs
on sc.socio=gs.socio
LEFT JOIN  Hospitales h ON gs.lugarpago = H.Hospital AND gs.reparticion = H.Reparticion 
LEFT JOIN  Reparticiones ON gs.reparticion = Reparticiones.Reparticion
where year(fechabaja)=2003
Group by h.nombre
order by h.nombre

GO
/****** Object:  StoredProcedure [dbo].[BajasCp]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[BajasCp]
(
	@Inicio char(8)='20060201',
	@Cierre char(8)='20060301',
	@Cobertura char(3)=150,
	@Entidad char(1)=1
)
as
(select ad.Adherente,ad.apellido,ad.nombre,ad.cobrador,@Cobertura Cobertura,mb.nombre,cb.nombre,cb.[global]
from conceptos_Adherentes ca 
inner join conceptos co1 on ca.concepto=co1.concepto
inner join adherentes ad on ca.adherente=ad.adherente
inner join motivosBaja mb on ca.motivoBaja=motivo
inner join cobradores cb on ad.cobrador=cb.cobrador
where (ca.FechaBaja Between  @Inicio and @Cierre) and  co1.Cobertura=@Cobertura and @Entidad=1)
Union
(select ad.socio,ad.apellido,ad.nombre,ad.cobrador,@Cobertura Cobertura,(
Select Distinct Mb.nombre
from conceptos_Socios ca 
inner join conceptos co1 on ca.concepto=co1.concepto
inner join motivosBaja mb
on ca.motivoBaja=motivo
where (ca.fechabaja is null or ca.fechabaja > @Inicio) and ca.FechaVigencia <= @Inicio
and  co1.Cobertura=@Cobertura and ad.socio=ca.socio

),cb.nombre,cb.[global]
from socios ad 
inner join cobradores cb on ad.cobrador=cb.cobrador
where @Entidad=0 and 
((
(Select count(*) from conceptos_Socios ca inner join conceptos co1 
on ca.concepto=co1.concepto
where (ca.fechabaja is null or ca.fechabaja > @Cierre) and ca.FechaVigencia <= @Cierre
and  co1.Cobertura=@Cobertura and ad.socio=ca.socio)=0)
) and 
(
(Select count(*) from conceptos_Socios ca inner join conceptos co1 
on ca.concepto=co1.concepto
where (ca.fechabaja is null or ca.fechabaja > @Inicio) and ca.FechaVigencia <= @Inicio
and  co1.Cobertura=@Cobertura and ad.socio=ca.socio)>0)
)




GO
/****** Object:  StoredProcedure [dbo].[Balance]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[Balance]
(
		@Computer varchar(20)='SERVERBaires'
)
as
Select ai.ubbalance,ai.cuenta,ai.descripcion dCuenta,sum(debe) Debe,sum(haber) Haber,sum(debe-haber) saldo,
cast(ltrim(rtrim(t.Descripcion)) as char(30)) dRubro,
cast(ltrim(rtrim(t.Capitulo)) as char(30)) dCapitulo,
cast(ltrim(rtrim(t.Titulo)) as char(30)) dTitulo, 
cast(ltrim(rtrim(t.grantitulo)) as char(30)) dGranditulo,
Control, idCapitulo, case when ai.ubbalance between 2111 and 2112 then sum(debe-haber) else 0 end Proveedores
from rpt_saldosCuentas ai 
left join tRubros t
on ai.ubbalance=t.idrubro
where  ai.cuenta<400000 and computer=@Computer

group by ai.ubbalance,ai.cuenta,ai.descripcion,t.descripcion ,Titulo,grantitulo, COntrol,capitulo, idCapitulo

having sum(debe-haber)<>0

union

Select 2530 ubbalance,999999 cuenta,'Resultado del Ejercicio' dCuenta,sum(debe) Debe,sum(haber) Haber,sum(debe-haber) saldo,
'Revaluaciones Contables' dRubro,
'CAPITAL SUSCRIPTO' dCapitulo,
'PATRIMONIO NETO' dTitulo, 
'PATRIMONIO NETO' dGranditulo,
'PASIVO + PATRIMONIO NETO' Control, 8 idCapitulo, 0 proveedores
from rpt_saldosCuentas ai 
left join tRubros t
on ai.ubbalance=t.idrubro
where  ai.cuenta>399999 and computer=@Computer

--group by ai.ubbalance,ai.cuenta,ai.descripcion,t.descripcion ,Titulo,grantitulo, COntrol,capitulo, idCapitulo

having sum(debe-haber)<>0


order by ai.ubbalance,ai.cuenta

GO
/****** Object:  StoredProcedure [dbo].[BalancePresentacion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE         Procedure [dbo].[BalancePresentacion] -- 0,'20020501','20030430','A'
(
	@CuentaDesde	int=0,
	@CuentaHasta	int=0,
	@Area 	int=0, -- 0 = Completo o Areas
	@Inicio	char(8)=null,
	@Cierre	char(8)=null,
	@AP	char(1)='A'
)
as
Declare @sqlSt as nvarchar(4000)

Select @sqlSt='Select 
caco.rubro as Rrubro, rc.descripcion as Descripcion_Rubro,
caco.capitulo,caco.descripcion as Descripcion_Capitulo,
Substring(cast(ct.cuenta as char(6)),2,3) as Subrubro, 
ct1.Descripcion as Descripcion_Subrubro,
ct.Cuenta, ct.Descripcion as descripcion_Cuenta,
Substring(cast(ct.cuenta as char(6)),1,1) as Capitulo,
ct.Rubro,
(
Select ct10.Descripcion from Cuentas ct10 
where cuenta=substring(cast(ct1.cuenta as char(6)),1,3)+"000"
) as descripcion_Grupo,
Substring(cast(ct.cuenta as char(6)),4,1) as SubRubro,
Substring(cast(ct.cuenta as char(6)),5,2) as Imputacion,
(
Select isnull(sum(debe)-sum(haber),0) from asientosDiariosItems ai
inner join asientosdiariosheader ah1 on 
ai.asiento=ah1.asiento and ai.aniomes=ah1.aniomes and ai.tipoasiento=ah1.tipoasiento
where ai.cuenta=ct.cuenta and ai.tipoasiento=0 
and ah1.Fecha>="' + @Inicio + '" and ah1.fecha<="' + @Cierre + '" '

if isnull(@Area,0)>0
	select @sqlst=@sqlst + ' and ai.centrocosto=' + cast(@area as char(1)) 

if isnull(@CuentaDesde,0)>0
	select @sqlst=@sqlst + ' and ai.Cuenta>=' + cast(@CuentaDesde as char(9)) 

if isnull(@CuentaHasta,0)>0
	select @sqlst=@sqlst + ' and ai.Cuenta<=' + cast(@CuentaHasta as char(9)) 


	select @sqlst=@sqlst + ' ) as Total

from Cuentas ct
left Join Capitulos_Contablidad caco on 
Substring(cast(ct.cuenta as char(6)),1,1)=caco.capitulo
left Join Rubros_Contablidad rc on 
caco.rubro=rc.rubro
left Join  Cuentas ct1
on Substring(cast(ct.cuenta as char(6)),1,4)+"00"=ct1.cuenta
where ct.rubro=0  '

if isnull(@CuentaDesde,0)>0
	select @sqlst=@sqlst + ' and ct.Cuenta>=' + cast(@CuentaDesde as char(9)) 

if isnull(@CuentaHasta,0)>0
	select @sqlst=@sqlst + ' and ct.Cuenta<=' + cast(@CuentaHasta as char(9)) 

	select @sqlst=@sqlst + ' 
union

Select 
caco.rubro as Rrubro, rc.descripcion as Descripcion_Rubro,
caco.capitulo,caco.descripcion as Descripcion_Capitulo,
Substring(cast(ct.cuenta as char(6)),2,3) as Subrubro, 
ct1.Descripcion as Descripcion_Subrubro,
ct.Cuenta, ct.Descripcion as descripcion_Cuenta,
Substring(cast(ct.cuenta as char(6)),1,1) as Capitulo,
ct.Rubro,
(
Select ct10.Descripcion from Cuentas ct10 where cuenta=ct1.cuenta
) as descripcion_Grupo,
Substring(cast(ct.cuenta as char(6)),4,1) as SubRubro,
Substring(cast(ct.cuenta as char(6)),5,2) as Imputacion,
(
Select isnull(sum(debe)-sum(haber),0) from asientosDiariosItems ai
inner join asientosdiariosheader ah1 on 
ai.asiento=ah1.asiento and ai.aniomes=ah1.aniomes and ai.tipoasiento=ah1.tipoasiento
where ai.cuenta=ct.cuenta and ai.tipoasiento=0 
and ah1.Fecha>="' + @Inicio + '" and ah1.fecha<="' + @Cierre + '" '

if isnull(@Area,0)>0
	select @sqlst=@sqlst + ' and ai.centrocosto=' + cast(@area as char(2))

if isnull(@CuentaDesde,0)>0
	select @sqlst=@sqlst + ' and ai.Cuenta>=' + cast(@CuentaDesde as char(9)) 

if isnull(@CuentaHasta,0)>0
	select @sqlst=@sqlst + ' and ai.Cuenta<=' + cast(@CuentaHasta as char(9)) 

select @sqlst=@sqlst + ') as Total

from Cuentas ct
left Join Capitulos_Contablidad caco on 
Substring(cast(ct.cuenta as char(6)),1,1)=caco.capitulo
left Join Rubros_Contablidad rc on 
caco.rubro=rc.rubro
left Join  Cuentas ct1
on cast( substring(cast(ct.cuenta as char(6)),1,1)+  
cast(ct.rubro as char(3)) + "00" as int)=ct1.cuenta
where ct.rubro<>0 '

if isnull(@CuentaDesde,0)>0
	select @sqlst=@sqlst + ' and ct.Cuenta>=' + cast(@CuentaDesde as char(9)) 

if isnull(@CuentaHasta,0)>0
	select @sqlst=@sqlst + ' and ct.Cuenta<=' + cast(@CuentaHasta as char(9)) 

	select @sqlst=@sqlst + ' order by ct.cuenta '

execute sp_executesql @sqlst
--print @sqlst




GO
/****** Object:  StoredProcedure [dbo].[Base_combinar]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO

-- Base_combinar 1,'F10','F10','','20040929',7

CREATE  Procedure [dbo].[Base_combinar]
(
	@Entidad	int=0,
	@CDesde		char(3)='',
	@CHasta		char(3)='',
	@FDesde		char(8)='',
	@FHasta		char(8)='',
	@Cobrador	int=0
)
as
Declare @SqlStr nvarchar(4000),@sqlSct char(7),@sqlFpt char(7)
Select @SqlStr = ''

Select @SqlSct = ' Where  '

if @Entidad<>1
Begin
	select @SqlStr=@SqlStr + '
	Select Distinct sc.socio , Apellido , sc.Nombre , Domicilio , Localidad , cPostal , p.descripcion provincia,isnull(t.descripcion,c.nombre) cobra,
	"Socio" Entidad
	from socios sc
	inner join Conceptos_socios cs
	on sc.socio=cs.socio
	inner join provincias p
	on sc.provincia=p.provincia
	left join cobradores c
	on c.cobrador=sc.cobrador
	left join tarjetas t
	on t.idtarjeta=sc.tarjeta '

if len(ltrim(rtrim(@CDesde)))>0
	Begin 
		select @SqlStr=@SqlStr + @sqlsct + ' Concepto>="' + @cDesde + '"'
		Select @SqlSct = ' And '
	end

if len(ltrim(rtrim(@CHasta)))>0
	Begin 
		select @SqlStr=@SqlStr + @sqlsct + 'Concepto<="' + @cHasta + '"'
		Select @SqlSct = ' And '
	end

if len(ltrim(rtrim(@FDesde)))>0
	Begin 
		select @SqlStr=@SqlStr + @sqlsct + 'FechaVigencia>="' + @Fdesde + '"'
		Select @SqlSct = ' And '
	end

if len(ltrim(rtrim(@FHasta)))>0
	Begin 
		select @SqlStr=@SqlStr + @sqlsct + 'FechaVigencia<="' + @FHasta + '" and (cs.FechaBaja>"' + @FHasta + '" or cs.Fechabaja is null)'
		Select @SqlSct = ' And '
	end

if @Cobrador<>0
	Begin
 		select @SqlStr=@SqlStr + @sqlsct + 'sc.Cobrador=' + cast(@cobrador as char(3))
		Select @SqlSct = ' And '
	end
ENd
select @SqlStr=@SqlStr + case when @Entidad=9 then ' union ' else '' end 

Select @SqlSct = ' Where '

if @Entidad<>0
Begin
	select @SqlStr = @SqlStr + '
	Select Distinct sc.Adherente, Apellido , sc.Nombre , Domicilio , Localidad , cPostal , p.descripcion provincia,isnull(t.descripcion,c.nombre) cobra,
	"Foprosa" Entidad
	from Adherentes sc
	inner join Conceptos_Adherentes cs
	on sc.Adherente=Cs.adherente
	inner join provincias p
	on sc.provincia=p.provincia
	left join cobradores c
	on c.cobrador=sc.cobrador
	left join tarjetas t
	on t.idtarjeta=sc.tarjeta '

if len(ltrim(rtrim(@CDesde)))>0
	Begin 
		select @SqlStr=@SqlStr + @sqlsct + 'Concepto>="' + @cDesde + '"'
		Select @SqlSct = ' And '
	end

if len(ltrim(rtrim(@CHasta)))>0
	Begin 
		select @SqlStr=@SqlStr + @sqlsct + 'Concepto<="' + @cHasta + '"'
		Select @SqlSct = ' And '
	end

if len(ltrim(rtrim(@FDesde)))>0
	Begin 
		select @SqlStr=@SqlStr + @sqlsct + 'FechaVigencia>="' + @Fdesde + '"'
		Select @SqlSct = ' And '
	end

if len(ltrim(rtrim(@FHasta)))>0
	Begin 
		select @SqlStr=@SqlStr + @sqlsct + 'FechaVigencia<="' + @FHasta + '" and (cs.FechaBaja>"' + @FHasta + '" or cs.Fechabaja is null)'
		Select @SqlSct = ' And '
	end

if @Cobrador<>0
	Begin
 		select @SqlStr=@SqlStr + @sqlsct + 'sc.Cobrador=' + cast(@cobrador as char(3))
		Select @SqlSct = ' And '
	end
End
--print @SqlStr
exec sp_executesql @SqlStr


GO
/****** Object:  StoredProcedure [dbo].[Base_Reportes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[Base_Reportes]
(
	@idService	int=2566
)
as
Select * from services s 
inner join modelos_pacientes m 
on s.idmodelo=m.idModelo 
inner join Pacientes p 
on p.idPaciente=m.idPaciente Where idService=@idService

GO
/****** Object:  StoredProcedure [dbo].[BaseControlComisiones]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO






CREATE       Procedure [dbo].[BaseControlComisiones]
(
	@Desde	char(8)='20080101',
	@Hasta	char(8)='20080131',
	@TP	char(1)='T',
	@opcion char(1)='A'
)
as
Select 
vch.fecha,razonsocial,vch.totalimporte*Multiplicador total,
tvm.comprobante+' '+ cast(vch.nrocomprobante as char(12))+' '+ tipofactura,a.articulo,
a.descripcion,ea.serial,isnull(valor,eap.basecontable) basecontable,
v.nyap,vcli.Nyap,isnull(co.Descripcion,'') Medico
,isnull(co1.Descripcion,'') FonoAudiologa,
isnull(co2.Descripcion,'') Distribuidor,v.idvendedor ,isnull(co.idcontacto,0) idMedico,
isnull(co1.idcontacto,0) idFono, isnull(co2.idContacto,0) idDistribuidor, do.idOPeracion,
vch.idtransaccion,isnull(vch.cancelado,0)*Multiplicador Cancelado,vch.cliente,ea.idcampo Campo
from vencliHeader vch
inner join detalle_operaciones do 
on vch.idtransaccion=do.idtransaccion
inner join estadisticaArticulos ea
on ea.idoperacion=do.idOperacion
inner join EstadisticaArticulosPrecios eap 
on ea.idcampo=eap.idcampo
inner join articulos a
on ea.idarticulo=a.idarticulo
inner join tipventmodheader tvm
on vch.tipocomprobante=tvm.codigo
inner join clientes cl
on vch.cliente=cl.codigo
left join datosventa dv
on do.idOperacion=dv.idOPeracion
left join vendedores v
on dv.idvendedor=v.idvendedor
left join vendedores vCli
on cl.vendedor=vcli.idvendedor
left join comisionistas co
on dv.contacto1=co.idcontacto
left join comisionistas1 co1
on dv.contacto2=co1.idcontacto
left join comisionistas2 co2
on dv.contacto3=co2.idcontacto
left join informacioncomisiones ico
on eap.idcampo=ico.idcampo
where vch.fecha between @Desde and @Hasta
and ((a.idlinea=1 and @opcion='A') or (idlinea=18 and @Opcion='P'))

and (@TP='T' or totalimporte=isnull(cancelado,0))








GO
/****** Object:  StoredProcedure [dbo].[BaseEstadistica]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Procedure [dbo].[BaseEstadistica]
as
Select  
idtransaccion,totalimporte,sum(canti),
cast(sum(presimp) as numeric(18,2)),cast(sum(ito) as numeric(18,2)),
cast(sum(presimp+ito) as numeric(18,2))
from VencliHeader vch
inner join tra0 t on  nrocomprobante like '%'+ltrim(rtrim(cast(t.doc_d as char(8) )))
and vch.fecha=t.fecha and vch.cliente=t.codig
where vch.fecha>'20071231'
and tipoComprobante<>7 and tipocomprobante<>0 and tipocomprobante<>12
and tipoComprobante<>17 and tipocomprobante<>9
Group by idtransaccion,totalImporte

GO
/****** Object:  StoredProcedure [dbo].[BaseListadosServicesSelectivo]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create Procedure [dbo].[BaseListadosServicesSelectivo]
(
	@idService	int
)
as
Select * from services s 
	inner join modelos_pacientes m 
	on s.idmodelo=m.idModelo 
	inner join Pacientes p 
	on p.idPaciente=m.idPaciente 
	Where idService=@idService

GO
/****** Object:  StoredProcedure [dbo].[Borra_Asiento]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE Procedure [dbo].[Borra_Asiento]
(	@Asiento int=7, 
	@aniomes int=201003,
	@Tipoasiento int=0
)
as

Insert into Asientosdiariosheaderanulados
Select * from asientosdiariosHeader
where tipoasiento=@tipoasiento and aniomes=@aniomes and asiento=@Asiento

Delete from asientosdiariosHeader
where tipoasiento=@tipoasiento and aniomes=@aniomes and asiento=@Asiento

Insert into Asientosdiariositemsanulados
Select * from asientosdiariositems
where tipoasiento=@tipoasiento and aniomes=@aniomes and asiento=@Asiento

Delete from asientosdiariositems 
where tipoasiento=@tipoasiento and aniomes=@aniomes and asiento=@Asiento

insert into valorestesoreriaanulados 
Select vt.*--,getdate()
from Header_operaciones ho
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join ValoresTesoreria vt
on do.idtransaccion=vt.idtransaccion
where tipoasiento=@tipoasiento and aniomes=@aniomes and asientoDiario=@Asiento and idtipotransaccion=2

Delete vt
from Header_operaciones ho
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join ValoresTesoreria vt
on do.idtransaccion=vt.idtransaccion
where tipoasiento=@tipoasiento and aniomes=@aniomes and asientoDiario=@Asiento and idtipotransaccion=2

Update vt set cancelado=0 
from Header_operaciones ho
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join aplicacionesValores av
on do.idtransaccion=av.idtransaccion
inner join valorestesoreria vt
on av.idtransaccioncancelada=vt.idtransaccion

where tipoasiento=@tipoasiento and aniomes=@aniomes and asientoDiario=@Asiento 
and idtipotransaccion=2

insert into aplicacionesvaloresanulados
Select av.*,getdate()
from Header_operaciones ho
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join aplicacionesValores av
on do.idtransaccion=av.idtransaccion
inner join valorestesoreria vt
on av.idtransaccioncancelada=vt.idtransaccion

where tipoasiento=@tipoasiento and aniomes=@aniomes and asientoDiario=@Asiento 
and idtipotransaccion=2

Delete av
from Header_operaciones ho
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join aplicacionesValores av
on do.idtransaccion=av.idtransaccion
inner join valorestesoreria vt
on av.idtransaccioncancelada=vt.idtransaccion

where tipoasiento=@tipoasiento and aniomes=@aniomes and asientoDiario=@Asiento 
and idtipotransaccion=2

Insert into compProvHeaderAnulados
Select cph.*--,getdate()
from Header_operaciones ho
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join CompProvHeader cph
on do.idtransaccion=cph.idtransaccion
where tipoasiento=@tipoasiento and ho.aniomes=@aniomes and asientoDiario=@Asiento 
and idtipotransaccion=1

Delete cph --.*--,getdate()
from Header_operaciones ho
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join CompProvHeader cph
on do.idtransaccion=cph.idtransaccion
where tipoasiento=@tipoasiento and ho.aniomes=@aniomes and asientoDiario=@Asiento 
and idtipotransaccion=1

Insert into compFondosHeaderAnulados
Select cph.*,getdate()
from Header_operaciones ho
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join CompFondosHeader cph
on do.idtransaccion=cph.idtransaccion
where tipoasiento=@tipoasiento and ho.aniomes=@aniomes and asientoDiario=@Asiento 
and idtipotransaccion=3

Delete cph --.*--,getdate()
from Header_operaciones ho
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join CompFondosHeader cph
on do.idtransaccion=cph.idtransaccion
where tipoasiento=@tipoasiento and ho.aniomes=@aniomes and asientoDiario=@Asiento 
and idtipotransaccion=3


GO
/****** Object:  StoredProcedure [dbo].[Borra_AsientoDiario]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create Procedure [dbo].[Borra_AsientoDiario] (@Asiento int, @Aniomes int)
as

Delete from Header_Operaciones 
where asientodiario=@Asiento and aniomes=@Aniomes and tipoasiento=0

Delete from AsientosDiariosHeader
where asiento=@Asiento and aniomes=@Aniomes and tipoasiento=0

Delete from AsientosDiariosItems
where asiento=@Asiento and aniomes=@Aniomes and tipoasiento=0

GO
/****** Object:  StoredProcedure [dbo].[Borra_FFijo]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Procedure [dbo].[Borra_FFijo]
(
	@idOperacion	int=215222
)
as
Delete ai from Header_operaciones ho
inner join AsientosdiariosHeader ai
on ho.asientodiario=ai.asiento and ho.aniomes=ai.aniomes and ho.tipoasiento=ai.tipoasiento
where idOPeracion=@idOperacion

Delete ai from Header_operaciones ho
inner join Asientosdiariositems ai
on ho.asientodiario=ai.asiento and ho.aniomes=ai.aniomes and ho.tipoasiento=ai.tipoasiento
where idOPeracion=@idOperacion

Delete ci from Detalle_operaciones do
inner join compFondosHeader c
on do.idtransaccion=c.idtransaccion
inner join compFondosItems ci
on c.comprobante=ci.comprobante and c.aniomes=ci.aniomes
where idOPeracion=@idOperacion

Delete c from Detalle_operaciones do
inner join compFondosHeader c
on do.idtransaccion=c.idtransaccion
where idOPeracion=@idOperacion


GO
/****** Object:  StoredProcedure [dbo].[Borra_Mes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create Procedure [dbo].[Borra_Mes] (@idtransaccion as int)
as

Delete from CuentasCorrientes 
where idtransaccion=@idtransaccion

Delete from DetalleCuentasCorrientes 
where idtransaccion=@idtransaccion


GO
/****** Object:  StoredProcedure [dbo].[Borra_Recibo]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[Borra_Recibo] (@idTransaccion int)
as
Delete From CuentasCorrientes 
where idtransaccion=@idTransaccion

Update cc
set cancelado=0
from AplicacionesCuentasCorrientes acc
inner join cuentasCorrientes cc on cc.idtransaccion=acc.idtransaccionCancelada
where acc.idtransaccion=@idTransaccion

Delete from AplicacionesCuentasCorrientes
from AplicacionesCuentasCorrientes acc
where acc.idtransaccion=@idTransaccion

Delete From ValoresTesoreria 
where idTransaccionOrigen=@idTransaccion




GO
/****** Object:  StoredProcedure [dbo].[Borra_reciboClientes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




-- Borra_reciboClientes 72725



CREATE      Procedure 
	[dbo].[Borra_reciboClientes] (@idOperacion numeric (18,0))
as

Insert into VencliheaderAnulados
Select cc.*,getdate()
from Detalle_Operaciones do
--inner Join AplicacionesCuentasCorrientes acc on acc.idtransaccion=do.idtransaccion and do.idtipotransaccion=0
inner join VencliHeader cc on cc.idTransaccion=do.idtransaccion 
and do.idtipoTransaccion=0 -- Cancelada
where idOPeracion=@idOperacion

-- Borro Movimientos de Cuentas Corrientes
Delete cc
from Detalle_Operaciones do
--inner Join AplicacionesCuentasCorrientes acc on acc.idtransaccion=do.idtransaccion and do.idtipotransaccion=0
inner join VencliHeader cc on cc.idTransaccion=do.idtransaccion 
and do.idtipoTransaccion=0 -- Cancelada
where idOPeracion=@idOperacion

-- Repongo valores de Aplicaciones CuentasCorrientes Pesos
Update VenCliheader 
set cancelado=isnull((
Select abs(sum(importe*multiplicador) ) from aplicacionescuentasacobrar a
	inner join Vencliheader vch
	on a.idtransaccionCancelada=vch.idtransaccion
	inner join TipVentModHeader t
	on vch.tipocomprobante=t.codigo
	where 
 	(a.idtransaccion=acc.idtransaccioncancelada
	or a.idtransaccioncancelada=acc.idtransaccioncancelada)
	and a.idtransaccion<>acc.idtransaccion),0) 
from Detalle_Operaciones do
inner Join AplicacionesCuentasaCobrar acc on acc.idtransaccion=do.idtransaccion and do.idtipotransaccion=0
inner join VenCliheader cc on cc.idTransaccion=acc.idtransaccionCancelada
where idOPeracion=@idOperacion


-- Repongo valores de Aplicaciones CuentasCorrientes Dolares
Update VenCliheader 
set canceladoOrigen=isnull((
Select abs(sum(a.importeOrigen*multiplicador) ) from aplicacionescuentasacobrar a
	inner join Vencliheader vch
	on a.idtransaccionCancelada=vch.idtransaccion
	inner join TipVentModHeader t
	on vch.tipocomprobante=t.codigo
	where 
 	(a.idtransaccion=acc.idtransaccioncancelada
	or a.idtransaccioncancelada=acc.idtransaccioncancelada)
	and a.idtransaccion<>acc.idtransaccion),0) 
from Detalle_Operaciones do
inner Join AplicacionesCuentasaCobrar acc on acc.idtransaccion=do.idtransaccion and do.idtipotransaccion=0
inner join VenCliheader cc on cc.idTransaccion=acc.idtransaccionCancelada
where idOPeracion=@idOperacion

-- Borro Movimientos de Aplicaciones Cuentas Corrientes
Delete from AplicacionesCuentasaCobrar
from Detalle_Operaciones do
inner Join AplicacionesCuentasaCobrar acc on acc.idtransaccion=do.idtransaccion
and do.idtipotransaccion=0
--inner join cuentascorrientes cc on cc.idTransaccion=do.idtransaccion and do.idtipoTransaccion=0 
where idOPeracion=@idOperacion


Insert into ValoresTesoreriaanulados
select cc.*
from Detalle_Operaciones do
inner join ValoresTesoreria cc on cc.idTransaccion=do.idtransaccion 
and do.idtipoTransaccion=2 -- Cancelada
where idOPeracion=@idOperacion

-- Borro Movimientos de ValoresTesoreria
Delete from ValoresTesoreria
from Detalle_Operaciones do
inner join ValoresTesoreria cc on cc.idTransaccion=do.idtransaccion 
and do.idtipoTransaccion=2 -- Cancelada
where idOPeracion=@idOperacion

-- Borro Asientos De Diario Items
Insert into Asientosdiariositemsanulados 
Select ai.* 
from Header_OPeraciones ho
inner join asientosdiariositems ai on ho.asientodiario=ai.asiento and ho.aniomes=ai.aniomes and ho.tipoasiento=ai.tipoasiento
where idOPeracion=@idOperacion


Delete from AsientosDiariosItems
from Header_OPeraciones ho
inner join asientosdiariosItems ai on ho.asientodiario=ai.asiento and ho.aniomes=ai.aniomes and ho.tipoasiento=ai.tipoasiento
where idOPeracion=@idOperacion

-- Borro Asientos De Diario Header
/*
Delete from AsientosDiariosHeader
from Header_OPeraciones ho
inner join AsientosDiariosHeader ai on ho.asientodiario=ai.asiento and ho.aniomes=ai.aniomes and ho.tipoasiento=ai.tipoasiento
where idOPeracion=@idOperacion
*/

-- Borro Detalle de Operaciones, Solo dejo el Header como Antecedente
Delete from Detalle_Operaciones 
where idOPeracion=@idOperacion








GO
/****** Object:  StoredProcedure [dbo].[Borra_rendicion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE   Procedure 
[dbo].[Borra_rendicion] (@idOperacion numeric (18,0))
as

-- Borro Movimientos de Cuentas Corrientes
Delete from CuentasCorrientes
from Detalle_Operaciones do
--inner Join AplicacionesCuentasCorrientes acc on acc.idtransaccion=do.idtransaccion and do.idtipotransaccion=0
inner join cuentascorrientes cc on cc.idTransaccion=do.idtransaccion 
and do.idtipoTransaccion=0 -- Cancelada
where idOPeracion=@idOperacion

-- Borro Movimientos de Detalle Cuentas Corrientes
Delete from detalleCuentasCorrientes
from Detalle_Operaciones do
--inner Join AplicacionesCuentasCorrientes acc on acc.idtransaccion=do.idtransaccion and do.idtipotransaccion=0
inner join Detallecuentascorrientes cc on cc.idTransaccion=do.idtransaccion 
and do.idtipoTransaccion=0 -- Cancelada
where idOPeracion=@idOperacion

-- Repongo valores de Aplicaciones CuentasCorrientes
Update CuentasCorrientes 
set cancelado=isnull((
Select SUM(importe) 
from AplicacionesCuentasCorrientes ac1 
where ac1.idTransaccionCancelada=acc.IdTransaccionCancelada 
and cc.idTransaccion=acc.IdTransaccionCancelada and ac1.idtransaccion<>do.idTransaccion),0) 
from Detalle_Operaciones do
inner Join AplicacionesCuentasCorrientes acc on acc.idtransaccion=do.idtransaccion and do.idtipotransaccion=0
inner join cuentascorrientes cc on cc.idTransaccion=acc.idtransaccionCancelada
where idOPeracion=@idOperacion

-- Borro Movimientos de Aplicaciones Cuentas Corrientes
Delete from AplicacionesCuentasCorrientes
from Detalle_Operaciones do
inner Join AplicacionesCuentasCorrientes acc on acc.idtransaccion=do.idtransaccion
and do.idtipotransaccion=0
--inner join cuentascorrientes cc on cc.idTransaccion=do.idtransaccion and do.idtipoTransaccion=0 
where idOPeracion=@idOperacion

-- Borro Movimientos de ValoresTesoreria
Delete from ValoresTesoreria
from Detalle_Operaciones do
inner join ValoresTesoreria cc on cc.idTransaccion=do.idtransaccion 
and do.idtipoTransaccion=2 -- Cancelada
where idOPeracion=@idOperacion

/*
-- Borro Asientos De Diario Items
Delete from AsientosDiariosItems
from Header_OPeraciones ho
inner join asientosdiariosItems ai on ho.asientodiario=ai.asiento and ho.aniomes=ai.aniomes and ho.tipoasiento=ai.tipoasiento
where idOPeracion=@idOperacion
-- Borro Asientos De Diario Header

Delete from AsientosDiariosHeader
from Header_OPeraciones ho
inner join AsientosDiariosHeader ai on ho.asientodiario=ai.asiento and ho.aniomes=ai.aniomes and ho.tipoasiento=ai.tipoasiento
where idOPeracion=@idOperacion
*/

-- Borro Detalle de Operaciones, Solo dejo el Header como Antecedente
Delete from Detalle_Operaciones 
where idOPeracion=@idOperacion





GO
/****** Object:  StoredProcedure [dbo].[Borra_Tesoreria]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create Procedure [dbo].[Borra_Tesoreria](@idOperacion int)
as

insert into valorestesoreriaanulados
Select vt.* 
from Detalle_operaciones do
inner join valorestesoreria vt
on do.idtransaccion=vt.idtransaccion
where idOperacion=@idOperacion
and idtipotransaccion=2

Delete vt 
from Detalle_operaciones do
inner join valorestesoreria vt
on do.idtransaccion=vt.idtransaccion
where idOperacion=@idOperacion
and idtipotransaccion=2

insert into asientosdiariositemsanulados
Select ai.* from Header_operaciones ho
inner join asientosdiariosItems ai
on ho.asientodiario=ai.asiento and ho.tipoasiento=ai.tipoasiento 
and ho.aniomes=ai.aniomes
where idOperacion=@idOperacion

Delete ai
from Header_operaciones ho
inner join asientosdiariosItems ai
on ho.asientodiario=ai.asiento and ho.tipoasiento=ai.tipoasiento 
and ho.aniomes=ai.aniomes
where idOperacion=@idOperacion

insert into asientosdiariosHeaderanulados
Select ai.* from Header_operaciones ho
inner join asientosdiariosHeader ai
on ho.asientodiario=ai.asiento and ho.tipoasiento=ai.tipoasiento 
and ho.aniomes=ai.aniomes
where idOperacion=@idOperacion

Delete ai 
from Header_operaciones ho
inner join asientosdiariosHeader ai
on ho.asientodiario=ai.asiento and ho.tipoasiento=ai.tipoasiento 
and ho.aniomes=ai.aniomes
where idOperacion=@idOperacion



GO
/****** Object:  StoredProcedure [dbo].[BorraAplicaciones]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE Procedure [dbo].[BorraAplicaciones]
	@idTransaccion int
as 
Declare oAplicaciones CURSOR FOR
	Select * From AplicacionesValores Where idTransaccion=@IdTransaccion

Open oAplicaciones
Declare @idT int, @iTem int, @idTC int, @Importe numeric(18,2)
FETCH NEXT FROM oAplicaciones INTO @idT, @iTem,@idTC, @Importe
while (@@FETCH_STATUS <>-1)
BEGIN

   Delete from aplicacionesValores where idTransaccion=@idT and item=@iTem
   update ValoresTesoreria set 
   cancelado=(select SUM(importe) 
              from AplicacionesValores 
              where idTransaccionCancelada=@IdTC) 
   where idTransaccion=@IdTC

   FETCH NEXT FROM oAplicaciones INTO @idT, @iTem,@idTC, @Importe

END
Close oAplicaciones
deallocate oAplicaciones


GO
/****** Object:  StoredProcedure [dbo].[BorraCompFondo]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
Create Procedure [dbo].[BorraCompFondo]
(
	@idOperacion	int=0
)
as
Delete from detalle_operaciones 
where idOperacion=215102

Delete from Header_operaciones
where idOperacion=215102

Delete from Asientosdiariositems 
where asiento=26 and tipoasiento=0 and aniomes=200907

Delete from AsientosdiariosHeader
where asiento=26 and tipoasiento=0 and aniomes=200907

Delete from CompFondosHEader

Delete from CompFondosItems

GO
/****** Object:  StoredProcedure [dbo].[BorraFCProv]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  Procedure [dbo].[BorraFCProv] (@idOperacion int)
as

/* delete FROM Header_Operaciones 
where aniomes=200306 and asientodiario=59 and tipoasiento=3
Delete from detalle_OPeraciones 
where idOperacion=20655
*/

insert into compprovitemsAnulados
select cpi.*,getdate() from detalle_operaciones do 
inner join compprovHeader cph 
on do.idtransaccion=cph.idtransaccion
inner join compprovitems cpi 
on cph.comprobante=cpi.comprobante and cph.aniomes=cpi.aniomes
where idtipotransaccion=1 and idOPeracion=@idOperacion

Delete from cpi
from detalle_operaciones do 
inner join compprovHeader cph 
on do.idtransaccion=cph.idtransaccion
inner join compprovitems cpi 
on cph.comprobante=cpi.comprobante and cph.aniomes=cpi.aniomes
where idtipotransaccion=1 and idOPeracion=@idOperacion

insert into compprovHeaderAnulados
select cph.* from detalle_operaciones do 
inner join compprovHeader cph 
on do.idtransaccion=cph.idtransaccion
--inner join compprovitems cpi 
--on cph.comprobante=cpi.comprobante and cph.aniomes=cpi.aniomes
where idtipotransaccion=1 and idOPeracion=@idOperacion

Delete from cph
from detalle_operaciones do 
inner join compprovHeader cph 
on do.idtransaccion=cph.idtransaccion
--inner join compprovitems cpi 
--on cph.comprobante=cpi.comprobante and cph.aniomes=cpi.aniomes
where idtipotransaccion=1 and idOPeracion=@idOperacion

insert into asientosdiariosHeaderanulados
select ai.*from asientosDiariosheader ai 
inner join Header_Operaciones ho 
on ho.asientodiario=ai.asiento and ho.aniomes=ai.aniomes
and ho.tipoasiento=ai.tipoasiento
where idOperacion=@idOperacion

Delete ai
from asientosDiariosHeader ai 
inner join Header_Operaciones ho 
on ho.asientodiario=ai.asiento and ho.aniomes=ai.aniomes
and ho.tipoasiento=ai.tipoasiento
where idOperacion=@idOperacion

insert into asientosdiariositemsanulados
select ai.*from asientosDiariosItems ai 
inner join Header_Operaciones ho 
on ho.asientodiario=ai.asiento and ho.aniomes=ai.aniomes
and ho.tipoasiento=ai.tipoasiento
where idOperacion=@idOperacion

Delete ai
from asientosDiariosItems ai 
inner join Header_Operaciones ho 
on ho.asientodiario=ai.asiento and ho.aniomes=ai.aniomes
and ho.tipoasiento=ai.tipoasiento
where idOperacion=@idOperacion
--where asiento=59 and aniomes=200306 and tipoasiento=3




GO
/****** Object:  StoredProcedure [dbo].[BorraFcVentas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE  Procedure [dbo].[BorraFcVentas]
(
	@idOPeracion int=73226
)
as
Insert into DatosVentaAnulados
Select distinct dv.* 
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idoPeracion=do.idOperacion
inner join VencliHeader vch on 
do.idtransaccion=vch.idtransaccion 
inner join VenCliItems vci on 
vch.idtransaccion=vci.idtransaccion
inner join EstadisticaArticulos ea
on ho.idOPeracion=ea.idOperacion 
inner join EstadisticaArticulosPrecios eap 
on ea.idcampo=eap.idCampo
inner join DatosVenta dv
on ho.idOPeracion=dv.idOperacion 
where ho.idOPeracion=@idOperacion

----Delete dv
----from Header_operaciones ho
----inner join Detalle_operaciones do 
----on ho.idoPeracion=do.idOperacion
----inner join VencliHeader vch on 
----do.idtransaccion=vch.idtransaccion 
----inner join VenCliItems vci on 
----vch.idtransaccion=vci.idtransaccion
----inner join EstadisticaArticulos ea
----on ho.idOPeracion=ea.idOperacion 
----inner join EstadisticaArticulosPrecios eap 
----on ea.idcampo=eap.idCampo
----inner join DatosVenta dv
----on ho.idOPeracion=dv.idOperacion 
----where ho.idOPeracion=@idOperacion

Insert into EstadisticaArticulosPreciosAnulados
Select eap.*,getdate() 
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idoPeracion=do.idOperacion
inner join VencliHeader vch on 
do.idtransaccion=vch.idtransaccion 
inner join VenCliItems vci on 
vch.idtransaccion=vci.idtransaccion
inner join EstadisticaArticulos ea
on ho.idOPeracion=ea.idOperacion 
inner join EstadisticaArticulosPrecios eap 
on ea.idcampo=eap.idCampo
where ho.idOPeracion=@idOperacion

--Delete eap
--from Header_operaciones ho
--inner join Detalle_operaciones do 
--on ho.idoPeracion=do.idOperacion
--inner join VencliHeader vch on 
--do.idtransaccion=vch.idtransaccion 
--inner join VenCliItems vci on 
--vch.idtransaccion=vci.idtransaccion
--inner join EstadisticaArticulos ea
--on ho.idOPeracion=ea.idOperacion 
--inner join EstadisticaArticulosPrecios eap 
--on ea.idcampo=eap.idCampo
--where ho.idOPeracion=@idOperacion

Insert into EstadisticaArticulosAnulados
Select ea.*,getdate() 
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idoPeracion=do.idOperacion
inner join VencliHeader vch on 
do.idtransaccion=vch.idtransaccion 
inner join VenCliItems vci on 
vch.idtransaccion=vci.idtransaccion
inner join EstadisticaArticulos ea
on ho.idOPeracion=ea.idOperacion 
where ho.idOPeracion=@idOperacion

--Delete ea
--from Header_operaciones ho
--inner join Detalle_operaciones do 
--on ho.idoPeracion=do.idOperacion
--inner join VencliHeader vch on 
--do.idtransaccion=vch.idtransaccion 
--inner join VenCliItems vci on 
--vch.idtransaccion=vci.idtransaccion
--inner join EstadisticaArticulos ea
--on ho.idOPeracion=ea.idOperacion 
--where ho.idOPeracion=@idOperacion

Insert into VenCliItemsAnulados
Select vci.*,getdate() 
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idoPeracion=do.idOperacion
inner join VencliHeader vch on 
do.idtransaccion=vch.idtransaccion 
inner join VenCliItems vci on 
vch.idtransaccion=vci.idtransaccion
where ho.idOPeracion=@idOperacion

--Delete vci
--from Header_operaciones ho
--inner join Detalle_operaciones do 
--on ho.idoPeracion=do.idOperacion
--inner join VencliHeader vch on 
--do.idtransaccion=vch.idtransaccion 
--inner join VenCliItems vci on 
--vch.idtransaccion=vci.idtransaccion
--where ho.idOPeracion=@idOperacion

Insert into VenCliHeaderAnulados
Select vch.*,getdate() 
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idoPeracion=do.idOperacion
inner join VencliHeader vch on 
do.idtransaccion=vch.idtransaccion 
where ho.idOPeracion=@idOperacion

--Delete vch
--from Header_operaciones ho
--inner join Detalle_operaciones do 
--on ho.idoPeracion=do.idOperacion
--inner join VencliHeader vch on 
--do.idtransaccion=vch.idtransaccion 
--where ho.idOPeracion=@idOperacion

----Insert into Asientosdiariositemsanulados
----Select ai.*
----from Header_operaciones ho
----inner join Detalle_operaciones do 
----on ho.idoPeracion=do.idOperacion
----inner join Asientosdiariositems ai on 
----ho.asientodiario=ai.asiento and ho.tipoasiento=ai.tipoasiento
----and ho.aniomes=ai.aniomes
----where ho.idOPeracion=@idOperacion
----
----Delete ai
----from Header_operaciones ho
----inner join Detalle_operaciones do 
----on ho.idoPeracion=do.idOperacion
----inner join Asientosdiariositems ai on 
----ho.asientodiario=ai.asiento and ho.tipoasiento=ai.tipoasiento
----and ho.aniomes=ai.aniomes
----where ho.idOPeracion=@idOperacion

Update tempFacturacionMO 
set idOperacion=0 
where idOPeracion=@idOperacion

Update AnexoMateriales
set idOperacion=0 
where idOPeracion=@idOperacion




GO
/****** Object:  StoredProcedure [dbo].[BorraFcVentasCompleto]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  Procedure [dbo].[BorraFcVentasCompleto]
(
	@id_Operacion int=292513
)
as
Insert into DatosVentaAnulados
Select distinct dv.* 
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idoPeracion=do.idOperacion
inner join VencliHeader vch on 
do.idtransaccion=vch.idtransaccion 
inner join VenCliItems vci on 
vch.idtransaccion=vci.idtransaccion
inner join EstadisticaArticulos ea
on ho.idOPeracion=ea.idOperacion 
inner join EstadisticaArticulosPrecios eap 
on ea.idcampo=eap.idCampo
inner join DatosVenta dv
on ho.idOPeracion=dv.idOperacion 
where ho.idOPeracion=@id_Operacion

Delete dv
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idoPeracion=do.idOperacion
inner join VencliHeader vch on 
do.idtransaccion=vch.idtransaccion 
inner join VenCliItems vci on 
vch.idtransaccion=vci.idtransaccion
inner join EstadisticaArticulos ea
on ho.idOPeracion=ea.idOperacion 
inner join EstadisticaArticulosPrecios eap 
on ea.idcampo=eap.idCampo
inner join DatosVenta dv
on ho.idOPeracion=dv.idOperacion 
where ho.idOPeracion=@id_Operacion

Insert into EstadisticaArticulosPreciosAnulados
Select eap.*,getdate() 
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idoPeracion=do.idOperacion
inner join VencliHeader vch on 
do.idtransaccion=vch.idtransaccion 
inner join VenCliItems vci on 
vch.idtransaccion=vci.idtransaccion
inner join EstadisticaArticulos ea
on ho.idOPeracion=ea.idOperacion 
inner join EstadisticaArticulosPrecios eap 
on ea.idcampo=eap.idCampo
where ho.idOPeracion=@id_Operacion

Delete eap
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idoPeracion=do.idOperacion
inner join VencliHeader vch on 
do.idtransaccion=vch.idtransaccion 
inner join VenCliItems vci on 
vch.idtransaccion=vci.idtransaccion
inner join EstadisticaArticulos ea
on ho.idOPeracion=ea.idOperacion 
inner join EstadisticaArticulosPrecios eap 
on ea.idcampo=eap.idCampo
where ho.idOPeracion=@id_Operacion

Insert into EstadisticaArticulosDescripcionesAnuladas
Select eap.* 
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idoPeracion=do.idOperacion
inner join VencliHeader vch on 
do.idtransaccion=vch.idtransaccion 
inner join VenCliItems vci on 
vch.idtransaccion=vci.idtransaccion
inner join EstadisticaArticulos ea
on ho.idOPeracion=ea.idOperacion 
inner join EstadisticaArticulosDescripciones eap 
on ea.idcampo=eap.idCampo
where ho.idOPeracion=@id_Operacion

Delete eap
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idoPeracion=do.idOperacion
inner join VencliHeader vch on 
do.idtransaccion=vch.idtransaccion 
inner join VenCliItems vci on 
vch.idtransaccion=vci.idtransaccion
inner join EstadisticaArticulos ea
on ho.idOPeracion=ea.idOperacion 
inner join EstadisticaArticulosDescripciones eap 
on ea.idcampo=eap.idCampo
where ho.idOPeracion=@id_Operacion

Insert into EstadisticaArticulosAnulados
Select ea.*,getdate() 
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idoPeracion=do.idOperacion
inner join VencliHeader vch on 
do.idtransaccion=vch.idtransaccion 
inner join VenCliItems vci on 
vch.idtransaccion=vci.idtransaccion
inner join EstadisticaArticulos ea
on ho.idOPeracion=ea.idOperacion 
where ho.idOPeracion=@id_Operacion

Delete ea
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idoPeracion=do.idOperacion
inner join VencliHeader vch on 
do.idtransaccion=vch.idtransaccion 
inner join VenCliItems vci on 
vch.idtransaccion=vci.idtransaccion
inner join EstadisticaArticulos ea
on ho.idOPeracion=ea.idOperacion 
where ho.idOPeracion=@id_Operacion

Insert into VenCliItemsAnulados
Select vci.*,getdate() 
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idoPeracion=do.idOperacion
inner join VencliHeader vch on 
do.idtransaccion=vch.idtransaccion 
inner join VenCliItems vci on 
vch.idtransaccion=vci.idtransaccion
where ho.idOPeracion=@id_Operacion

Delete vci
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idoPeracion=do.idOperacion
inner join VencliHeader vch on 
do.idtransaccion=vch.idtransaccion 
inner join VenCliItems vci on 
vch.idtransaccion=vci.idtransaccion
where ho.idOPeracion=@id_Operacion

Insert into VenCliHeaderAnulados
Select vch.*,getdate() 
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idoPeracion=do.idOperacion
inner join VencliHeader vch on 
do.idtransaccion=vch.idtransaccion 
where ho.idOPeracion=@id_Operacion

Delete vch
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idoPeracion=do.idOperacion
inner join VencliHeader vch on 
do.idtransaccion=vch.idtransaccion 
where ho.idOPeracion=@id_Operacion

Insert into Asientosdiariositemsanulados
Select ai.*
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idoPeracion=do.idOperacion
inner join Asientosdiariositems ai on 
ho.asientodiario=ai.asiento and ho.tipoasiento=ai.tipoasiento
and ho.aniomes=ai.aniomes
where ho.idOPeracion=@id_Operacion

Delete ai
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idoPeracion=do.idOperacion
inner join Asientosdiariositems ai on 
ho.asientodiario=ai.asiento and ho.tipoasiento=ai.tipoasiento
and ho.aniomes=ai.aniomes
where ho.idOPeracion=@id_Operacion

Update tempFacturacionMO 
set idOperacion=0 
where idOPeracion=@id_Operacion

Update AnexoMateriales
set idOperacion=0 
where idOPeracion=@id_Operacion










GO
/****** Object:  StoredProcedure [dbo].[BorraNovedades]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create Procedure [dbo].[BorraNovedades] (@Aniomes int,@Periodo int)
as
Update ConceptosLegajosNovedades
Set Aniomes=@Aniomes, Periodo=@Periodo

Delete ConceptosLegajosNovedadesDiciembreMensual 
where aniomes=@Aniomes and periodo=@Periodo

Insert into ConceptosLegajosNovedadesDiciembreMensual
Select * from ConceptosLegajosNovedades

Delete from ConceptosLegajosNovedades

GO
/****** Object:  StoredProcedure [dbo].[BorraPendientes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[BorraPendientes]
(
	@idObra	int=6821
)
as

Update ea set idcampoAnexo=0 
from BaseCrm..estadisticaArticulos ea 
left join Headermovimientosstock h
on ea.idoperacion=h.idOPeracion
left join AnexoMateriales a
on ea.idcampoanexo=a.idcampo and isnull(ea.idobra,h.idobra)=a.idObra
left join store..AnexoMateriales a1
on ea.idcampoanexo=a1.idcampo and isnull(ea.idobra,h.idobra)=a1.idObra
where a.idcampo is null and ea.fecfactura is null
and isnull(ea.idobra,h.idobra)=@idObra

Update ea set idcampoAnexo=0 
from Store..estadisticaArticulos ea 
left join Store..Headermovimientosstock h
on ea.idoperacion=h.idOPeracion
left join AnexoMateriales a
on ea.idcampoanexo=a.idcampo and isnull(ea.idobra,h.idobra)=a.idObra
left join store..AnexoMateriales a1
on ea.idcampoanexo=a1.idcampo and isnull(ea.idobra,h.idobra)=a1.idObra
where a.idcampo is null and ea.fecfactura is null
and isnull(ea.idobra,h.idobra)=@idObra

Update ea set idcampoAnexo=0 from BaseCrm..estadisticaArticulos ea 
left join BaseCrm..headermovimientosStock hm
on ea.idoperacion=hm.idOPeracion
inner join Store..anexomateriales am
on ea.idcampoanexo=am.idcampo and isnull(ea.idobra,hm.idobra)=am.idobra
where isnull(ea.idobra,hm.idobra)=@idObra
and isnull(am.idoperacion,0)=0

Update ea set idcampoAnexo=0 from store..estadisticaArticulos ea 
left join store..headermovimientosStock hm
on ea.idoperacion=hm.idOPeracion
inner join Store..anexomateriales am
on ea.idcampoanexo=am.idcampo and isnull(ea.idobra,hm.idobra)=am.idobra
where isnull(ea.idobra,hm.idobra)=@idObra
and isnull(am.idoperacion,0)=0

Delete from Store..anexoMateriales
where idobra=@idObra and  isnull(idOPeracion,0)=0







GO
/****** Object:  StoredProcedure [dbo].[BorraTemporalDiario]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Procedure [dbo].[BorraTemporalDiario]
(
	@ComputerName varchar(50)='CASA-78CD17791F'
)
As
Delete cpi
from asientosdiariositemsdiario ai
inner join compProvHeader cph 
on ai.asiento=cph.comprobante and ai.aniomes=cph.aniomes
inner join compProvItems cpi
on cph.idtransaccion=cpi.idtransaccion
where tipodeComprobante=301
and usuario=@ComputerName

Delete cph
from asientosdiariositemsdiario ai
inner join compProvHeader cph 
on ai.asiento=cph.comprobante and ai.aniomes=cph.aniomes
where tipodeComprobante=301
and usuario=@ComputerName

Delete cpi
from asientosdiariositemsdiario ai
inner join CompProvHeader cph 
on ai.asiento=cph.comprobante and ai.aniomes=cph.aniomes
inner join CompProvItems cpi
on cph.idtransaccion=cpi.idtransaccion
where tipodeComprobante=302
and usuario=@ComputerName

Delete cph
from asientosdiariositemsdiario ai
inner join CompProvHeader cph 
on ai.asiento=cph.comprobante and ai.aniomes=cph.aniomes
where tipodeComprobante=302
and usuario=@ComputerName

Delete ai
from asientosdiariositemsdiario ai
where usuario=@ComputerName
GO
/****** Object:  StoredProcedure [dbo].[BorraTemporalDiarioSelectivo]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Procedure [dbo].[BorraTemporalDiarioSelectivo]
(
	@ComputerName	varchar(50)='CASA-78CD17791F',
	@aniomes		int,
	@Comprobante	int
)
As
Delete cpi
from asientosdiariositemsdiario ai
inner join compProvHeader cph 
on ai.asiento=cph.comprobante and ai.aniomes=cph.aniomes
inner join compProvItems cpi
on cph.idtransaccion=cpi.idtransaccion
where tipodeComprobante=301
and usuario=@ComputerName
and ai.aniomes=@aniomes
and asiento=@comprobante

Delete cph
from asientosdiariositemsdiario ai
inner join compProvHeader cph 
on ai.asiento=cph.comprobante and ai.aniomes=cph.aniomes
where tipodeComprobante=301
and usuario=@ComputerName
and ai.aniomes=@aniomes
and asiento=@comprobante

Delete cpi
from asientosdiariositemsdiario ai
inner join compProvHeader cph 
on ai.asiento=cph.comprobante and ai.aniomes=cph.aniomes
inner join compProvItems cpi
on cph.idtransaccion=cpi.idtransaccion
where tipodeComprobante=302
and usuario=@ComputerName
and ai.aniomes=@aniomes
and asiento=@comprobante

Delete cph
from asientosdiariositemsdiario ai
inner join compProvHeader cph 
on ai.asiento=cph.comprobante and ai.aniomes=cph.aniomes
where tipodeComprobante=302
and usuario=@ComputerName
and ai.aniomes=@aniomes
and asiento=@comprobante

Delete ai
from asientosdiariositemsdiario ai
where usuario=@ComputerName
and ai.aniomes=@aniomes
and asiento=@comprobante
GO
/****** Object:  StoredProcedure [dbo].[Busca_Compra]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE   Procedure [dbo].[Busca_Compra]
(
	@Comprobante	int=0,
	@Aniomes		int=0,
	@idtransaccion	numeric(18,0)=0,
	@tipodeOperacion int=31
)
as
Declare @sqlStr nvarchar(4000)
Declare @Codigo varchar(20)
Declare @Header varchar(20)
Declare @Codigos varchar(20)
Declare @Tipos varchar(25)

select @Codigo=case when @tipodeOperacion between 30 and 39 then 'cph.Proveedor' else 'cph.Cliente' end
select @Header=case when @tipodeOperacion between 30 and 39 then 'CompProvHeader' else 'VenCliHeader' end
select @Codigos=case when @tipodeOperacion between 30 and 39 then 'Proveedores' else 'Clientes' end
select @Tipos=case when @tipodeOperacion between 30 and 39 then 'TipCompModHeader' else 'TipVentModHeader' end

set @sqlStr='
Select ho.idoperacion,cph.idtransaccion,cph.comprobante,cph.fecha,' + @Codigo + ', 
pv.razonsocial,cph.tipocomprobante,th.descripcion dstipocomprobante,nrocomprobante, 
tipofactura,totalimporte,fecha1venc,fecha2venc,estado,cph.fechareal,cph.centrocosto,
Moneda,TC,ImporteOrigen
from ' + @Header +' cph 
inner Join Detalle_operaciones do on do.idtransaccion=cph.idtransaccion 
inner Join Header_operaciones ho on do.idOperacion=ho.idOperacion 
left join ' + @Codigos +' pv on cph.proveedor=pv.codigo 
left join ' + @Tipos +' th on cph.tipocomprobante=th.codigo 
Where idtipotransaccion=1 and tipodeOperacion=' + cast(@tipodeOperacion as char(3))
if @Aniomes<>0 and @Comprobante<>0
	set @sqlStr=@sqlStr + ' and cph.comprobante=' + cast(@Comprobante as char(10)) +
	' and cph.aniomes=' + cast(@Aniomes as char(8))

if @idtransaccion<>0
	set @sqlStr=@sqlStr + ' and cph.idtransaccion=' + cast(@idtransaccion as char(18))

exec sp_executesql @sqlStr
--print @sqlStr



GO
/****** Object:  StoredProcedure [dbo].[Busca_compras_items]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[Busca_compras_items]
(
	@Comprobante	int=0,
	@Aniomes		int=0
)
as
select 
comprobante,item,a.concepto,b.descripcion,importe,
a.cuentaneto,(Select Descripcion from cuentas where cuenta=a.cuentaneto)as CtaNeto,a.neto,a.cuentamonto,(Select Descripcion from cuentas where cuenta=a.cuentamonto) as CtaMonto,a.monto,a.area,cc.descripcion as descArea,a.detalle 
from compprovitems a 
left join conceptoscontables b 
on a.concepto=b.concepto 
left join centrosdecostos cc
on area=centrocosto
where a.comprobante=@Comprobante and a.aniomes=@Aniomes 
order by a.item asc

GO
/****** Object:  StoredProcedure [dbo].[Busca_ComprasVentas_Articulos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

-- exec Busca_ComprasVentas_items 1, 200705, 40, 'sprGasto'

CREATE Procedure [dbo].[Busca_ComprasVentas_Articulos]
(
	@idOperacion     int=2
)
as
	select *,ea.*,eap.Concepto,unitario,basecontable,
	eap.alicuota,eap.cuenta,a.articulo,a.Descripcion dArticulo
	from estadisticaArticulos ea
	inner join estadisticaArticulosPrecios eap
	on ea.idCampo=eap.idCampo
	inner join Articulos a
	on ea.idarticulo=a.idArticulo
	where idOperacion=@idOperacion
	order by ea.idcampo asc

GO
/****** Object:  StoredProcedure [dbo].[Busca_ComprasVentas_items]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

-- exec Busca_ComprasVentas_items 1, 200705, 40, 'sprGasto'

CREATE  Procedure [dbo].[Busca_ComprasVentas_items]
(
	@Comprobante	int=3,
	@Aniomes	int=200705,
	@tipodeOperacion int=31,
	@Grilla		varchar(20)='sprConceptos'
)
as
if @tipodeOperacion between 30 and 39
	select a.*,c.Descripcion
	from compprovitems a 
	left join conceptoscontables b 
	on a.concepto=b.concepto 
	left join centrosdecostos cc
	on area=centrocosto
	left join cuentas c
	on a.cuenta=c.cuenta
	where a.comprobante=@Comprobante and a.aniomes=@Aniomes and Grilla=@Grilla
	order by a.item asc
else
	select a.*,c.Descripcion
	from Vencliitems a
	left join conceptoscontables b 
	on a.concepto=b.concepto 
	left join centrosdecostos cc
	on area=centrocosto
	left join cuentas c
	on a.cuenta=c.cuenta
	where a.comprobante=@Comprobante and a.aniomes=@Aniomes and Grilla=@Grilla
	order by a.item asc

GO
/****** Object:  StoredProcedure [dbo].[Busca_CompraVenta]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO



--exec Busca_CompraVenta 16, 200802, 0, 30

CREATE       Procedure [dbo].[Busca_CompraVenta]
(
	@Comprobante	int=0,
	@Aniomes		int=0,
	@idtransaccion	numeric(18,0)=0,
	@tipodeOperacion int=30
)
as
Declare @sqlStr nvarchar(4000)
Declare @Codigo varchar(20)
Declare @Header varchar(20)
Declare @Codigos varchar(20)
Declare @Tipos varchar(25)

-- 30 a 39 Compras 40 a 49 Ventas

select @Codigo=case when @tipodeOperacion between 30 and 39 then 'cph.Proveedor' else 'cph.Cliente' end
select @Header=case when @tipodeOperacion between 30 and 39 then 'CompProvHeader' else 'VenCliHeader' end
select @Codigos=case when @tipodeOperacion between 30 and 39 then 'Proveedores' else 'Clientes' end
select @Tipos=case when @tipodeOperacion between 30 and 39 then 'TipCompModHeader' else 'TipVentModHeader' end

set @sqlStr='
Select ho.idoperacion,cph.idtransaccion,cph.comprobante,cph.fecha,' + @Codigo + ', 
pv.razonsocial,cph.tipocomprobante,th.descripcion dstipocomprobante,nrocomprobante, 
tipofactura,totalimporte,fecha1venc,fecha2venc,estado,cph.fechareal,cph.centrocosto,
Moneda,TC,ImporteOrigen,idDespacho,idDepositoOrigen,idDepositoDestino,isnull(asientoInterno,0) asientoInterno'
if @tipodeOperacion between 30 and 39
	set @sqlStr=@sqlStr+',isnull(cphVarios.codigo,0) ProvFondo'

set @sqlStr=@sqlStr+' from ' + @Header +' cph 
inner Join Detalle_operaciones do on do.idtransaccion=cph.idtransaccion 
inner Join Header_operaciones ho on do.idOperacion=ho.idOperacion 
left join asientosdiariosheader ah on ho.asientodiario=ah.asiento and ho.aniomes=ah.aniomes and ho.tipoasiento=ah.tipoasiento
left join ' + @Codigos +' pv on ' + @Codigo +'=pv.codigo 
left join ' + @Tipos +' th on cph.tipocomprobante=th.codigo 
Left Join HeaderMovimientosStock hms on  hms.idOperacion=ho.idOperacion '

if @tipodeOperacion between 30 and 39
set @sqlStr=@sqlStr+'left join cphVarios on cph.idtransaccion=cphVarios.idtransaccion '

if @tipodeOperacion between 30 and 39
set @sqlStr=@sqlStr+'Where idtipotransaccion=1 and tipodeOperacion=' + cast(@tipodeOperacion as char(3))

if @tipodeOperacion between 40 and 49
set @sqlStr=@sqlStr+'Where idtipotransaccion=0 and tipodeOperacion=' + cast(@tipodeOperacion as char(3))

if @Aniomes<>0 and @Comprobante<>0
	set @sqlStr=@sqlStr + ' and cph.comprobante=' + cast(@Comprobante as char(10)) +
	' and cph.aniomes=' + cast(@Aniomes as char(8))

if @idtransaccion<>0
	set @sqlStr=@sqlStr + ' and cph.idtransaccion=' + cast(@idtransaccion as char(18))

exec sp_executesql @sqlStr
-- print @sqlStr






GO
/****** Object:  StoredProcedure [dbo].[Busca_CompraVentaDiario]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO

--exec Busca_CompraVentaDiario 20007, 201006, 0, 30

Create Procedure [dbo].[Busca_CompraVentaDiario]
(
	@Comprobante	int=0,
	@Aniomes		int=0,
	@idtransaccion	numeric(18,0)=0,
	@tipodeOperacion int=30
)
as
Declare @sqlStr nvarchar(4000)
Declare @Codigo varchar(20)
Declare @Header varchar(20)
Declare @Codigos varchar(20)
Declare @Tipos varchar(25)

-- 30 a 39 Compras 40 a 49 Ventas

select @Codigo=case when @tipodeOperacion between 30 and 39 then 'cph.Proveedor' else 'cph.Cliente' end
select @Header=case when @tipodeOperacion between 30 and 39 then 'CompProvHeader' else 'VenCliHeader' end
select @Codigos=case when @tipodeOperacion between 30 and 39 then 'Proveedores' else 'Clientes' end
select @Tipos=case when @tipodeOperacion between 30 and 39 then 'TipCompModHeader' else 'TipVentModHeader' end

set @sqlStr='
Select 0 idoperacion,cph.idtransaccion,cph.comprobante,cph.fecha,cph.Proveedor, 
pv.razonsocial,cph.tipocomprobante,th.descripcion dstipocomprobante,nrocomprobante, 
tipofactura,totalimporte,fecha1venc,fecha2venc,estado,cph.fechareal,cph.centrocosto,
Moneda,TC,ImporteOrigen,0 idDespacho,0 idDepositoOrigen,0 idDepositoDestino,cph.comprobante asientoInterno,isnull(cphVarios.codigo,0) ProvFondo 
'

set @sqlStr=@sqlStr+' from ' + @Header +' cph 
left join ' + @Codigos +' pv on ' + @Codigo +'=pv.codigo 
left join ' + @Tipos +' th on cph.tipocomprobante=th.codigo '

if @tipodeOperacion between 30 and 39
set @sqlStr=@sqlStr+'left join cphVarios on cph.idtransaccion=cphVarios.idtransaccion '

if @tipodeOperacion between 30 and 39
set @sqlStr=@sqlStr+' Where '

if @tipodeOperacion between 40 and 49
set @sqlStr=@sqlStr+'Where idtipotransaccion=0 and tipodeOperacion=' + cast(@tipodeOperacion as char(3))

if @Aniomes<>0 and @Comprobante<>0
	set @sqlStr=@sqlStr + ' cph.comprobante=' + cast(@Comprobante as char(10)) +
	' and cph.aniomes=' + cast(@Aniomes as char(8))

if @idtransaccion<>0
	set @sqlStr=@sqlStr + ' and cph.idtransaccion=' + cast(@idtransaccion as char(18))

exec sp_executesql @sqlStr

print @sqlStr







GO
/****** Object:  StoredProcedure [dbo].[BuscaChequeTerceros]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE   Procedure [dbo].[BuscaChequeTerceros]
(
	@numero	int=0,
	@idTransaccion int=534,
	@NumeroInterno int=0
)
as
Select ho.fecha,ho.observacion,hoc.fecha dFecha,isnull(hoc.Observacion,'') dObservacion,vencimiento,b.descripcion banco,vt.importe,vt.numero
from valorestesoreria vt
inner join detalle_operaciones do
on vt.idtransaccion=do.idtransaccion
inner join header_operaciones ho 
on do.idOperacion=ho.idOperacion
left join bancos b 
on vt.banco=b.banco
left join Aplicacionesvalores av
on vt.idtransaccion=av.idtransaccioncancelada
left join detalle_operaciones doc on av.idtransaccion=doc.idtransaccion and doc.idTipotransaccion=2
left join header_operaciones hoc on doc.idOperacion=hoc.idOperacion
where ((numero=@Numero) or NumeroInterno=@NumeroInterno
or (vt.idtransaccion=@idtransaccion ))
and do.idtipotransaccion=2
and vt.idconcepto_Tesoreria=(Select cheques from parametrosGeneralesSueldos)
GO
/****** Object:  StoredProcedure [dbo].[buscaDatosArticulo]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE    procedure [dbo].[buscaDatosArticulo]
(
	@NumerodeParte		varchar(15)='',
	@Codigo			varchar(15)='',
	@idLista		int=10
)
as
Select Articulo,a.Descripcion, case when isnull(Alicuota,0)=0 then (Select IvaGeneral 
from ParametrosGeneralesSueldos) else alicuota end Alicuota,a.idArticulo, 
case when isnull(cuenta,0)=0 then 
(Select Mercaderias from ParametrosGeneralesSueldos) else cuenta end Cuenta,
0 nf, 0 Precio,
--isnull(dbo.Precio(@idLista,a.idArticulo,'N'),0) nf,
--isnull(dbo.Precio(@idLista,a.idArticulo,'N'),0) precio,
isnull(iComis,0) iComis,
a.notas articuloproveedor
from articulos a 
left join articulosproveedor ap on a.idArticulo=ap.idarticulo
left join lineas l on a.idlinea=l.idlinea 
where (articuloproveedor = @NumerodeParte or ltrim(rtrim(@NumerodeParte))='')
and
(articulo = @Codigo or ltrim(rtrim(@codigo))='')









GO
/****** Object:  StoredProcedure [dbo].[BuscaDatosRendicion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE  Procedure [dbo].[BuscaDatosRendicion] (@Entidad int, @idOperacion int)
as

if @Entidad = 1
begin
	select 	ho.idOperacion,
			ho.Comprobantenumero as Rendicion,
			cc.Socio AS Codigo, 
			ad.Apellido AS Apellido, 
			ad.nombre AS Nombre, 
			ad.NroMatricula AS NroMatricula, 
			cc.Concepto AS Concepto_CtaCte,
			cc.DocumentoNumero AS DocumentoNumero, 
			cc.Serie AS Serie, 
			cc.Importe AS Importe_CtaCte, 
			cc.vencimiento AS Vencimiento, 
			cc.IdTransaccion AS IdTransaccion , 	
			cc1.idTransaccion as idTransaccionRen,
			cc.cancelado as Cancelado,
			cb.Importe as Bonificacion, 
			cb.Honorarios,
			cb.Cobrador,
			cb.nombre as CobradorNombre,
			cc1.idOpCobrador,
			cb.tope
	from Header_operaciones ho
		inner join detalle_operaciones do
			on ho.idoperacion = do.idoperacion and idtipotransaccion = 0
		inner join aplicacionescuentascorrientes acc
			on acc.idtransaccion = do.idtransaccion
		inner join cuentascorrientes cc
			on acc.idtransaccioncancelada = cc.idtransaccion
		inner join cuentascorrientes cc1
			on acc.idtransaccion = cc1.idtransaccion
		inner join adherentes ad 
			on cc.socio = ad.Adherente 
		inner join cobradores cb 
			on ho.cuenta=cb.cobrador
	where ho.idoperacion = @idOperacion and cc.entidad = 1
end
Else
begin
	select 	ho.idOperacion,
			ho.Comprobantenumero as Rendicion,
			cc.Socio AS Codigo, 
			ad.Apellido AS Apellido, 
			ad.nombre AS Nombre, 
			ad.NroMatricula AS NroMatricula, 
			cc.Concepto AS Concepto_CtaCte,
			cc.DocumentoNumero AS DocumentoNumero, 
			cc.Serie AS Serie, 
			cc.Importe AS Importe_CtaCte, 
			cc.vencimiento AS Vencimiento, 
			cc.IdTransaccion AS IdTransaccion , 
			cc1.idTransaccion as idTransaccionRen,
			cc.cancelado as Cancelado,
			cb.Importe as Bonificacion, 
			cb.Honorarios,
			cb.Cobrador,
			cb.nombre as CobradorNombre,
			cc1.idOpCobrador,
			cb.tope
	from Header_operaciones ho
		inner join detalle_operaciones do
			on ho.idoperacion = do.idoperacion and idtipotransaccion = 0
		inner join aplicacionescuentascorrientes acc
			on acc.idtransaccion = do.idtransaccion
		inner join cuentascorrientes cc
			on acc.idtransaccioncancelada = cc.idtransaccion
		inner join cuentascorrientes cc1
			on acc.idtransaccion = cc1.idtransaccion
		inner join Socios ad 
			on cc.socio = ad.Socio
		inner join cobradores cb 
			on ho.cuenta=cb.cobrador
	where ho.idoperacion = @idOperacion and cc.entidad = 0
end












GO
/****** Object:  StoredProcedure [dbo].[BuscaRendicion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE      Procedure [dbo].[BuscaRendicion] (@Entidad int, @idOperacion int)
as

select do.*,cc.*,co.* from detalle_operaciones do
inner join cuentascorrientes cc 
on do.idtransaccion = cc.idtransaccion and cc.entidad = @Entidad
inner join header_operaciones ho
on do.idoperacion = ho.idoperacion
inner join cobradores co
on co.cobrador = ho.cuenta
where do.idoperacion = @idOperacion
and idtipotransaccion = 0


select * from colegios


GO
/****** Object:  StoredProcedure [dbo].[buscArticulo]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create    procedure [dbo].[buscArticulo]
(
	@NumerodeParte		varchar(15)='',
	@Codigo			varchar(15)='',
	@idLista		int=10
)
as
Select Articulo,a.Descripcion, case when isnull(Alicuota,0)=0 then (Select IvaGeneral 
from ParametrosGeneralesSueldos) else alicuota end Alicuota,a.idArticulo, 
case when isnull(cuenta,0)=0 then 
(Select Mercaderias from ParametrosGeneralesSueldos) else cuenta end Cuenta,
0 nf, 0 Precio,
--isnull(dbo.Precio(@idLista,a.idArticulo,'N'),0) nf,
--isnull(dbo.Precio(@idLista,a.idArticulo,'N'),0) precio,
isnull(iComis,0) iComis,
articuloproveedor
from articulos a 
left join articulosproveedor ap on a.idArticulo=ap.idarticulo
left join lineas l on a.idlinea=l.idlinea 
where (articuloproveedor = @NumerodeParte or ltrim(rtrim(@NumerodeParte))='')
and
(articulo = @Codigo or ltrim(rtrim(@codigo))='')









GO
/****** Object:  StoredProcedure [dbo].[BuscaValoresComprobante]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE       Procedure [dbo].[BuscaValoresComprobante] (@idOperacion numeric(18,0))
as



Select do.idOperacion, vt.*
from detalle_operaciones do
	inner join valorestesoreria vt
		on do.idtransaccion = vt.idtransaccion
where do.idoperacion = @idOperacion
and do.idtipotransaccion = 2




GO
/****** Object:  StoredProcedure [dbo].[BuscaValoresRendicion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO








CREATE       Procedure [dbo].[BuscaValoresRendicion] (@Entidad int, @idOperacion int)
as

select 	do.idOperacion,
		vt.idConcepto_Tesoreria, 
		vt.FechaEmision,
		vt.Banco,
		vt.Cuenta,
		vt.Sucursal,
		vt.Numero,
		vt.Importe,
		vt.Observaciones,
		vt.idOpCobrador,
		vt.idtransaccion
from detalle_operaciones do
	inner join valorestesoreria vt
		on do.idtransaccion = vt.idtransaccion
where do.idoperacion = @idOperacion and do.idtipotransaccion = 2






GO
/****** Object:  StoredProcedure [dbo].[BusParam]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE Procedure [dbo].[BusParam] 
	@Descripcion Char(50), @Value int OUTPUT
AS
select @Value=convert(int,valor) from ParametrosGenerales where parametro=@Descripcion
Return @Value


GO
/****** Object:  StoredProcedure [dbo].[busReciboDA]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[busReciboDA]
(
	@Entidad	int=2,
	@SocioD		int=4711,
	@SocioH		int=4711
)
as
Select h.fecha, h.idOPeracion,h.idRecibo,h.entidad,h.Socio,
isnull(nyap,
isnull(
ltrim(rtrim(ad.apellido))+','+ltrim(rtrim(ad.nombre)),ltrim(rtrim(sc.apellido))+','+ltrim(rtrim(sc.nombre)))),
count(*) Meses, sum(cc.importe) Importe ,min(cc.documentonumero) desde ,max(cc.documentoNUmero) Hasta
from Header_recibosDA h
inner join Detalle_RecibosDA d
on h.idRecibo=d.idRecibo
inner join CuentasCorrientes cc
on d.idtransaccion=cc.idtransaccion
Left join socios sc
on h.socio=sc.socio and h.entidad=0
Left join adherentes ad
on h.socio=ad.adherente and h.entidad=1
Left join alumnos al
on h.socio=al.idalumno and h.entidad=2
where h.entidad=@Entidad
and h.socio between @SocioD and @SocioH

Group by h.fecha,h.idOPeracion,h.idRecibo,h.entidad,h.Socio,isnull(nyap,
isnull(
ltrim(rtrim(ad.apellido))+','+ltrim(rtrim(ad.nombre)),ltrim(rtrim(sc.apellido))+','+ltrim(rtrim(sc.nombre))))



GO
/****** Object:  StoredProcedure [dbo].[CalculoGanancia]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE   Procedure [dbo].[CalculoGanancia]
(
	@Proveedor	int,
	@total		numeric(18,2)
)
as

Select 

case 
when @total>noimponible then round((@total-noimponible)*alicuota/100,2)*isnull(ci.ganancias,0)
else 0	end
as total, minimo as minimo
from header_codigosGanancias hg
inner join proveedores pv on hg.codigo=pv.tablaganancia
inner join categorias_iva ci on pv.civa=ci.idciva

where pv.codigo=@Proveedor


GO
/****** Object:  StoredProcedure [dbo].[Cancelado]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create  Procedure [dbo].[Cancelado]
(
	@idOperacion int
)
as
Select isnull(cancelado,0)
from VenCliHeader v
inner join Detalle_operaciones do 
on v.idtransaccion=do.idtransaccion and idtipotransaccion=0
inner join EstadisticaArticulos ea
on do.idOperacion=ea.idOperacion
inner join EstadisticaArticulosPrecios eap 
on ea.idCampo=eap.idcampo
where do.idOperacion like @idOperacion


GO
/****** Object:  StoredProcedure [dbo].[CanceladoP]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create  Procedure [dbo].[CanceladoP]
(
	@idOperacion int
)
as
Select isnull(cancelado,0)
from CompProvHeader v
inner join Detalle_operaciones do 
on v.idtransaccion=do.idtransaccion and idtipotransaccion=1
where do.idOperacion like @idOperacion

GO
/****** Object:  StoredProcedure [dbo].[CargaAguinaldos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE     Procedure [dbo].[CargaAguinaldos] -- CargaAguinaldos 2004,1
(
	@AAAA	char(4),
	@Periodo int
)
as
Delete from conceptosLegajosNovedades where 
Aniomes=cast(@AAAA + case when @Periodo=1 then '06' else '12' end as char(6)) and periodo=2

Insert into ConceptosLegajosNovedades
Select 
Legajo,
1 as orden,
190 as concepto, 
(select cast(round(max(isnull(acumulado,0))/ 12 *
 (select count(*) from remuneracionesacumuladas where legajo=cnh.legajo 
 and aniomes between cast(@AAAA + case when @Periodo=1 then '01' else '07' end as char(6)) 
					 and
					 cast(@AAAA + case when @Periodo=1 then '06' else '12' end as char(6))),2)
as numeric (18,2)) from remuneracionesacumuladas
where aniomes between cast(@AAAA + case when @Periodo=1 then '01' else '07' end as char(6)) 
					 and
					 cast(@AAAA + case when @Periodo=1 then '06' else '12' end as char(6)) and legajo=cnh.legajo 
group by LEgajo) as importe,
cast(@AAAA + case when @Periodo=1 then '06' else '12' end as char(6)) as importe,
2 as periodo,
0 as tipo
from conceptoslegajos cnh
where -- aniomes=@Cierre and 
(select count(*) from FechasLegajos fl where
fl.legajo = cnh.legajo and (fl.concepto=0 and finaliza is null))>0
group by cnh.Legajo



GO
/****** Object:  StoredProcedure [dbo].[CargaHijos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  Procedure [dbo].[CargaHijos]
(
	@aniomes 	int,
	@Periodo	int
)
as
if @Periodo=0

	insert into ConceptosLegajosNovedades
	Select r.legajo,20 as orden,501 as concepto,
	case when avg(Remuneracion)>=1725 then 0
	     when avg(Remuneracion) between 1225 and 1725
		then 20 * (select count(*) from familiaresLegajos
				where parentesco=2 and dbo.edad(fecnac,getdate())<18
				and legajo=r.legajo)
	     when avg(Remuneracion) between 725 and 1225
		then 30 * (select count(*) from familiaresLegajos
				where parentesco=2 and dbo.edad(fecnac,getdate())<18
				and legajo=r.legajo)
	     when avg(Remuneracion) between 100 and 725
		then 40 * (select count(*) from familiaresLegajos
				where parentesco=2 and dbo.edad(fecnac,getdate())<18
				and legajo=r.legajo)
	end as Importe,@Aniomes as Aniomes,0 as Periodo,null as tipo
	
	from Remuneraciones r
	inner join MaestroPersonal mp
	on mp.legajo=r.legajo
	
	where aniomes>=200307 and aniomes<=200312
	and (select count(*) from familiaresLegajos
							where parentesco=2 and dbo.edad(fecnac,getdate())<18
							and legajo=r.legajo)>0
	Group by r.legajo,apellido,nombre
	
	having avg(Remuneracion)<1725


GO
/****** Object:  StoredProcedure [dbo].[Cargo_Socio]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE      Procedure [dbo].[Cargo_Socio]
	@N_Entidad int,
	@N_Socio int,
	@AnioMes int
as

Declare @N_Cargo numeric(18,2)
if @aniomes<200604
begin
	if @N_entidad=0
		begin
			SELECT @N_Cargo= SUM(Imp.importe)
			FROM conceptos_socios Con
			INNER JOIN dbo.Conceptos Imp
			ON Imp.Concepto = Con.Concepto
			and Imp.Modalidad = 'I' 
			WHERE Con.Socio = @N_SOCIO 
			and (fechaBaja is null and 
			(convert(char(4),year(FechaVigencia)) 
			+ right((convert(varchar(2),month(FechaVigencia)) + 100),2)<=@aniomes) or 
			((convert(char(4),year(FechaBaja)) + right((convert(varchar(2),month(FechaBaja)) + 100),2))
			>=@Aniomes) 
			and ((convert(char(4),year(FechaVigencia)) + right((convert(varchar(2),month(FechaVigencia)) 
			+ 100),2))<=@Aniomes))
		end
	else
		begin
			SELECT @N_Cargo=SUM(Imp.importe)
			FROM conceptos_adherentes Con
			INNER JOIN dbo.Conceptos Imp
			ON Imp.Concepto = Con.Concepto
			and Imp.Modalidad = 'I'
			WHERE Con.Adherente = @N_socio
			and (fechaBaja is null and 
	(convert(char(4),year(FechaVigencia)) 
	+ right((convert(varchar(2),month(FechaVigencia)) + 100),2)<=@aniomes) or 
			((convert(char(4),year(FechaBaja)) + right((convert(varchar(2),month(FechaBaja)) + 100),2))
			>=@Aniomes) 
			and ((convert(char(4),year(FechaVigencia)) + right((convert(varchar(2),month(FechaVigencia)) 
			+ 100),2))<=@Aniomes))
		end
end
else
begin
	if @N_entidad=0
		begin
			SELECT @N_Cargo= SUM(Imp.importe)
			FROM conceptos_socios Con
			INNER JOIN Conceptos_Aumento Imp
			ON Imp.Concepto = Con.Concepto
			and Imp.Modalidad = 'I' 
			WHERE Con.Socio = @N_SOCIO 
			and (fechaBaja is null and 
			(convert(char(4),year(FechaVigencia)) 
			+ right((convert(varchar(2),month(FechaVigencia)) + 100),2)<=@aniomes) or 
			((convert(char(4),year(FechaBaja)) + right((convert(varchar(2),month(FechaBaja)) + 100),2))
			>=@Aniomes) 
			and ((convert(char(4),year(FechaVigencia)) + right((convert(varchar(2),month(FechaVigencia)) 
			+ 100),2))<=@Aniomes))
		end
	else
		begin
			SELECT @N_Cargo=SUM(Imp.importe)
			FROM conceptos_adherentes Con
			INNER JOIN Conceptos_Aumento Imp
			ON Imp.Concepto = Con.Concepto
			and Imp.Modalidad = 'I'
			WHERE Con.Adherente = @N_socio
			and (fechaBaja is null and 
	(convert(char(4),year(FechaVigencia)) 
	+ right((convert(varchar(2),month(FechaVigencia)) + 100),2)<=@aniomes) or 
			((convert(char(4),year(FechaBaja)) + right((convert(varchar(2),month(FechaBaja)) + 100),2))
			>=@Aniomes) 
			and ((convert(char(4),year(FechaVigencia)) + right((convert(varchar(2),month(FechaVigencia)) 
			+ 100),2))<=@Aniomes))
		end
end

Return @N_Cargo








GO
/****** Object:  StoredProcedure [dbo].[CargoaObras]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[CargoaObras]
	@idObra	int=0,
	@Cierre	varchar(8)='20090831',
	@Desde	varchar(8)='20090801',
	@Hasta	varchar(8)='20090831',
	@TC		numeric(18,3)=4.310,
	@AL		varchar(1)='A'
as
Select sum(ea.cantidad*a.precio*ts.Signo*-1) subtotalDolares,
sum(ea.cantidad*isnull(bi.precio,a.precio)*ts.Signo*-1*@TC) Debe,
0 Haber , count(*) Casos,ct.cuenta,ct.descripcion

from EstadisticaArticulos ea
left join headerMovimientosStock hm
on ea.idoperacion=hm.idoperacion
left join Header_operaciones ho 
on hm.idOperacion=ho.idoperacion
inner join tiposMovimientoStock ts
on ea.tipomovimiento=ts.idtipoMovimientoStock
inner join Articulos a
on ea.idarticulo=a.idarticulo
left join baseinventarios bi
on a.idarticulo=bi.idarticulo and substring(@Cierre,1,6) between vigenciadesde and vigenciaHasta
inner join cuentas ct
on ct.cuenta=132000
where 
isnull(fechaDos,ho.fecha)<=@Hasta -- and isnull(ea.fecfactura,'29001231')>@Cierre 
And (tipoMovimiento=4 or TipoMovimiento=9)
-- and (@idObra=0 or o.idObra=@idOBra)
and dbo.toaniomes(isnull(fechaDos,ho.fecha))=dbo.toaniomes(@Hasta) 
--and year(isnull(fechaDos,ho.fecha))=year(@Hasta) and month(isnull(fechaDos,ho.fecha))=month(@Hasta)
-- and case when @Hasta='' then '29000101' else @Hasta end 

Group by ct.cuenta,ct.descripcion
union
Select sum(ea.cantidad*a.precio*ts.Signo*-1) subtotalDolares,0 Debe,
sum(ea.cantidad*isnull(bi.precio,a.precio)*ts.Signo*-1*@TC) Haber,count(*) Casos,ct.cuenta,ct.descripcion

from EstadisticaArticulos ea
left join headerMovimientosStock hm
on ea.idoperacion=hm.idoperacion
left join Header_operaciones ho 
on hm.idOperacion=ho.idoperacion
inner join tiposMovimientoStock ts
on ea.tipomovimiento=ts.idtipoMovimientoStock
inner join Articulos a
on ea.idarticulo=a.idarticulo 
left join baseinventarios bi
on a.idarticulo=bi.idarticulo and substring(@Cierre,1,6) between vigenciadesde and vigenciaHasta
inner join cuentas ct
on ct.cuenta=131200
where 
isnull(fechaDos,ho.fecha)<=@Hasta -- and isnull(ea.fecfactura,'29001231')>@Cierre 
And (tipoMovimiento=4 or TipoMovimiento=9)
--and (@idObra=0 or o.idObra=@idOBra)

and dbo.toaniomes(isnull(fechaDos,ho.fecha))=dbo.toaniomes(@Hasta) 
-- and month(isnull(fechaDos,ho.fecha))=month(@Hasta)
-- and case when @Hasta='' then '29000101' else @Hasta end 

Group by ct.cuenta,ct.descripcion




GO
/****** Object:  StoredProcedure [dbo].[ChequesDeposito]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Procedure [dbo].[ChequesDeposito]
(
	@idOperacion	int
)
as
Select vt.idtransaccion,vt.importe ImporteDepositado,vt1.FechaEmision,vt1.Banco,b.descripcion,vt1.numero,vt1.Importe from Header_operaciones ho
inner join Detalle_Operaciones do 
on ho.idOperacion=do.idOperacion
inner join ValoresTesoreria vt
on do.idtransaccion=vt.idtransaccion
inner join aplicacionesvalores av
on vt.idtransaccion=av.idtransaccion
inner join ValoresTesoreria vt1
on av.idtransaccionCancelada=vt1.idtransaccion
inner join Bancos b
on vt1.banco=b.banco
where ho.idOperacion=@idOperacion
and vt.idConcepto_tesoreria=3



GO
/****** Object:  StoredProcedure [dbo].[ChequesRendicion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[ChequesRendicion]
(
	@idOperacion int=0
)
as
Select ComprobanteNumero,FechaEmision,Descripcion,Numero,count(*),sum(importe)
from Header_Operaciones ho
inner join Detalle_Operaciones do
on ho.idOperacion=do.idOperacion
inner join ValoresTesoreria vt
on do.idtransaccion=vt.idtransaccion
left join Bancos b 
on vt.banco=b.banco
where ho.idOperacion=@idOperacion
and tipodeOperacion=19
and idtipoTransaccion=2
and idConcepto_Tesoreria=6

Group by ComprobanteNumero,FechaEmision,Descripcion,Numero



GO
/****** Object:  StoredProcedure [dbo].[Coberturas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE   Procedure [dbo].[Coberturas]
(
	 @Inicio char(8)='20060201',
	 @Cierre char(8)='20060301'
)
as

Select distinct @Inicio,@Cierre,cobertura,case when entidad=0 then 'SOCIOS' when entidad=1 then 'FOPROSA' end entidad,
(select count(*) from conceptos_Adherentes ca inner join conceptos co1 on ca.concepto=co1.concepto
where (ca.fechabaja is null or ca.fechabaja > @Inicio) and ca.FechaVigencia <= @Inicio
and  co1.Cobertura=co.cobertura) +
(select count(*) from socios sc where 
((Select count(*) from conceptos_Socios ca inner join conceptos co1 
on ca.concepto=co1.concepto
where (ca.fechabaja is null or ca.fechabaja > @Inicio) and ca.FechaVigencia <= @Inicio
and  co1.Cobertura=co.cobertura and sc.socio=ca.socio)>0)) Inicio,
(select count(*) from conceptos_Adherentes ca inner join conceptos co1 on ca.concepto=co1.concepto
where (ca.FechaVigencia>@Inicio and FechaVigencia<=@Cierre)
and  co1.Cobertura=co.cobertura) 
+
(select count(*) from socios sc where 
((
(Select count(*) from conceptos_Socios ca inner join conceptos co1 
on ca.concepto=co1.concepto
where (ca.fechabaja is null or ca.fechabaja > @Cierre) and ca.FechaVigencia <= @Cierre
and  co1.Cobertura=co.cobertura and sc.socio=ca.socio)>0)
) and 
(
(Select count(*) from conceptos_Socios ca inner join conceptos co1 
on ca.concepto=co1.concepto
where (ca.fechabaja is null or ca.fechabaja > @Inicio) and ca.FechaVigencia <= @Inicio
and  co1.Cobertura=co.cobertura and sc.socio=ca.socio)=0)
)
Altas,

(select count(*) from conceptos_Adherentes ca inner join conceptos co1 on ca.concepto=co1.concepto
where (ca.FechaBaja Between  @Inicio and @Cierre)
and  co1.Cobertura=co.cobertura) 
+
(select count(*) from socios sc where 
((
(Select count(*) from conceptos_Socios ca inner join conceptos co1 
on ca.concepto=co1.concepto
where (ca.fechabaja is null or ca.fechabaja > @Cierre) and ca.FechaVigencia <= @Cierre
and  co1.Cobertura=co.cobertura and sc.socio=ca.socio)=0)
) and 
(
(Select count(*) from conceptos_Socios ca inner join conceptos co1 
on ca.concepto=co1.concepto
where (ca.fechabaja is null or ca.fechabaja > @Inicio) and ca.FechaVigencia <= @Inicio
and  co1.Cobertura=co.cobertura and sc.socio=ca.socio)>0)
)

Bajas,

(select count(*) from conceptos_Adherentes ca inner join conceptos co1 on ca.concepto=co1.concepto
where (ca.fechabaja is null or ca.fechabaja > @Cierre) and ca.FechaVigencia <= @Cierre
and  co1.Cobertura=co.cobertura) +
(select count(*) from socios sc where 
((Select count(*) from conceptos_Socios ca inner join conceptos co1 
on ca.concepto=co1.concepto
where (ca.fechabaja is null or ca.fechabaja > @Cierre) and ca.FechaVigencia <= @Cierre
and  co1.Cobertura=co.cobertura and sc.socio=ca.socio)>0)
)
Cierre,
case 
when cobertura=60 then 12.70
when cobertura=100 then 21.17
when cobertura=150 then 31.76
when cobertura=200 then 42.35
when cobertura=250 then 31.76 end ValorCap,
((select count(*) from conceptos_Adherentes ca inner join conceptos co1 on ca.concepto=co1.concepto
where (ca.fechabaja is null or ca.fechabaja > @Cierre) and ca.FechaVigencia <= @Cierre
and  co1.Cobertura=co.cobertura) +
(select count(*) from socios sc where 
((Select count(*) from conceptos_Socios ca inner join conceptos co1 
on ca.concepto=co1.concepto
where (ca.fechabaja is null or ca.fechabaja > @Cierre) and ca.FechaVigencia <= @Cierre
and  co1.Cobertura=co.cobertura and sc.socio=ca.socio)>0)
))*case 
when cobertura=60 then 12.70
when cobertura=100 then 21.17
when cobertura=150 then 31.76
when cobertura=200 then 42.35
when cobertura=250 then 31.76 end aPagar



from conceptos co
where cobertura is not null





GO
/****** Object:  StoredProcedure [dbo].[coJuicio]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE   Procedure [dbo].[coJuicio]
(
	@idJuicio	int=91,
	@Desde		char(8)='19980612',
	@Hasta		char(8)='20060612'
) as
Select distinct po.Desde,po.Hasta,poliza,po.Descripcion,cs.concepto,cs.fechaVigencia,cs.fechaBaja
from SociosbaseJuicios sbj
inner join socios sc on sbj.socio=sc.socio 
inner join Conceptos_socios cs on sc.socio=cs.socio
inner join Polizas po on cs.concepto=po.concepto
--inner join fechasJuicios f on sbj.juicio=f.idjuicio
inner join Basejuicios bj on  bj.idJuicio=sbj.juicio
where 
entidad=0 
and 
(cs.fechaVigencia<=@Desde) and (cs.fechaBaja>isnull(@Desde,@Hasta) or cs.fechabaja is null)

and po.Hasta>=@Desde and po.desde<=isnull(@Hasta,@Desde)

and sbj.Juicio=@idJuicio
union
Select distinct po.Desde,po.Hasta,poliza,po.Descripcion,cs.concepto,cs.fechaVigencia,cs.fechaBaja
from SociosbaseJuicios sbj
inner join Adherentes sc on sbj.socio=sc.Adherente
inner join Conceptos_Adherentes cs on sc.Adherente=cs.Adherente
inner join Polizas po on cs.concepto=po.concepto
--inner join fechasJuicios f on sbj.juicio=f.idjuicio
inner join Basejuicios bj on  bj.idJuicio=sbj.juicio
where 
entidad=1 
and 
(cs.fechaVigencia<=@Desde) and (cs.fechaBaja>isnull(@Desde,@Hasta) or cs.fechabaja is null)
and po.Hasta>=@Desde and po.desde<=isnull(@Hasta,@Desde)
and sbj.Juicio=@idJuicio






GO
/****** Object:  StoredProcedure [dbo].[Comis_cobrador]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




-- Comis_cobrador 8,'20060410','20060510'
CREATE    Procedure [dbo].[Comis_cobrador]
(
	@Cobrador	int,
	@Desde		char(8)='20050101',
	@Hasta		char(8)='20050131'
)
as
Select dcc.concepto,dcc.importe,count(*) as recibos,
count(*) * dcc.importe as subtotal,isnull(comision,0) cm,
count(*) * isnull(comision,0) as Bonificacion,
cb.nombre,cb.cobrador,substring(co.concepto,1,1) grupo,
(Select Count(*) 
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join AplicacionesCuentasCorrientes acc
on acc.idtransaccion=do.idtransaccion
inner join Cobradores cb
on ho.cuenta=cb.cobrador
where tipodeOperacion=19
and cuenta=@Cobrador
and fecha between @Desde and @Hasta
and idtipotransaccion=0
) RecibosTotales
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join AplicacionesCuentasCorrientes acc
on acc.idtransaccion=do.idtransaccion
inner join DetalleCuentasCorrientes dcc
on acc.idtransaccioncancelada=dcc.idtransaccion
inner join conceptos co
on dcc.concepto=co.concepto
inner join Cobradores cb
on ho.cuenta=cb.cobrador
where tipodeOperacion=19
and cuenta=@Cobrador
and fecha between @Desde and @Hasta
and idtipotransaccion=0
and dcc.concepto not like 'S%'
Group by dcc.concepto,dcc.importe,co.comision,cb.nombre,cb.cobrador,substring(co.concepto,1,1)




GO
/****** Object:  StoredProcedure [dbo].[ComisionesInternas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO





CREATE               Procedure [dbo].[ComisionesInternas]
(
	@Desde		char(8)='20080701',
	@Hasta		char(8)='20080731',
	@Vendedor	char(3)='GVE',
	@DT		char(1)='T'
)
as
declare @sqlS nvarchar(4000)

select @sqlS='Select *, ' + case when @Vendedor<>'ALL' then @vendedor else '0' end + ' as vSel from dbo.vComisionesInternas

where 

case when (idOperacion=44148 or idOperacion=44261 or idOperacion=44987 or idOperacion=45092
or idOperacion=45114 or idOperacion=45086 or idOperacion=45277 or idOperacion=45517
or idOperacion=45499 or idOperacion=45758 or idOperacion=45944 or idOperacion=46308)then "20080601" else fecharecibo end

between "' + @Desde + '" and "' + @Hasta + '" '

if @Vendedor<>'ALL'
select @sqlS=@sqlS + ' and ' + @vendedor + '<>0 '

select @sqlS=@sqlS + ' and sublinea<>51 '

--select @sqlS=@sqlS + ' and '
/*
(idOperacion=44148 or idOperacion=44261 or idOperacion=44987 or idOperacion=45092
or idOperacion=45114 or idOperacion=45086 or idOperacion=45277 or idOperacion=45517
or idOperacion=45499 or idOperacion=45758 or idOperacion=45944 or idOperacion=46308)
*/
select @sqlS=@sqlS + ' order by fechaRecibo '

--print @sqlS

exec sp_executesql @sqlS














GO
/****** Object:  StoredProcedure [dbo].[ComisionesInternasPendientes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE             Procedure [dbo].[ComisionesInternasPendientes]
(
	@Desde		char(8)='20080501',
	@Hasta		char(8)='20080531',
	@Vendedor	char(3)='HAY',
	@DT		char(1)='T'
)
as
declare @sqlS nvarchar(4000)

select @sqlS='Select *, ' + case when @Vendedor<>'ALL' then @vendedor else '0' end + ' as vSel from dbo.vComisionesInternasPendientes
where fechaRecibo>"20080122" '/* "' + @Desde + '" and "' + @Hasta + '" '*/

if @Vendedor<>'ALL'
select @sqlS=@sqlS + ' and ' + @vendedor + '<>0 '

select @sqlS=@sqlS + ' and sublinea<>51 '

--select @sqlS=@sqlS + ' and vendedor is null'

select @sqlS=@sqlS + ' order by fechaRecibo '

--print @sqlS

exec sp_executesql @sqlS












GO
/****** Object:  StoredProcedure [dbo].[ComisionesProfesionales]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE    Procedure [dbo].[ComisionesProfesionales]
(
	@Inicio	char(8)='20090101',
	@Cierre char(8)='20090131'
)
as
Select v.nrocomprobante,v.totalimporte,v.fecha,valor,ea.serial,a.articulo,ic.paciente,p.civa,
round(valor*isnull(ic.comisdist,Comisd)/100,2) neto , case when p.civa=1 then round(valor*isnull(ic.comisdist,m.Comisd)/100,2)*.21 else 0 end iva,
p.codigo prof,p.razonsocial nProfesional, a.descripcion aDesc
from informacionComisiones ic
inner join EstadisticaArticulos ea
on ic.idcampo=ea.idcampo
inner join Detalle_operaciones ho 
on ea.idOperacion=ho.idOperacion
inner join VenCliHeader v
on ho.idtransaccion=v.idtransaccion
Left join Proveedores dt
on ic.idDist=dt.codigo
inner join articulos a
on ea.idarticulo=a.idarticulo
left join clientes c
on v.cliente=c.codigo
inner join MatrizComisiones m
on ic.idDist=m.dist and ic.idFono=fga and ic.idDr=dr
inner join Proveedores p 
on ic.iddist=p.codigo
where idtipotransaccion=0 and isnull(idDist,0)<>0
and (v.fecha between @Inicio and @Cierre or ic.fecha between @Inicio and @Cierre)
union
Select v.nrocomprobante,v.totalimporte,v.fecha,valor,ea.serial,a.articulo,ic.paciente,p.civa,
round(valor*isnull(ic.Comisfono,m.Comisf)/100,2), case when dt.civa=1 then round(valor*isnull(ic.Comisfono,m.Comisf)/100,2)*.21 else 0 end,
p.codigo prof,p.razonsocial nProfesional, a.descripcion aDesc

from informacionComisiones ic
inner join EstadisticaArticulos ea
on ic.idcampo=ea.idcampo
inner join Detalle_operaciones ho 
on ea.idOperacion=ho.idOperacion
inner join VenCliHeader v
on ho.idtransaccion=v.idtransaccion
Left join Proveedores dt
on ic.idfono=dt.codigo
inner join articulos a
on ea.idarticulo=a.idarticulo
left join clientes c
on v.cliente=c.codigo
inner join MatrizComisiones m
on ic.idDist=m.dist and ic.idFono=fga and ic.idDr=dr
inner join Proveedores p 
on ic.idfono=p.codigo
where idtipotransaccion=0 and isnull(idFono,0)<>0
and (v.fecha between @Inicio and @Cierre or ic.fecha between @Inicio and @Cierre)
union
Select v.nrocomprobante,v.totalimporte,v.fecha,valor,ea.serial,a.articulo,ic.paciente,p.civa,
round(valor*isnull(ic.Comisdr,m.Comisdr)/100,2), case when dt.civa=1 then round(valor*isnull(ic.Comisdr,m.Comisdr)/100,2)*.21 else 0 end,
p.codigo prof,p.razonsocial nProfesional, a.descripcion aDesc
from informacionComisiones ic
inner join EstadisticaArticulos ea
on ic.idcampo=ea.idcampo
inner join Detalle_operaciones ho 
on ea.idOperacion=ho.idOperacion
inner join VenCliHeader v
on ho.idtransaccion=v.idtransaccion
Left join Proveedores dt
on ic.iddr=dt.codigo
inner join articulos a
on ea.idarticulo=a.idarticulo
left join clientes c
on v.cliente=c.codigo
inner join MatrizComisiones m
on ic.idDist=m.dist and ic.idFono=fga and ic.idDr=dr
inner join Proveedores p 
on ic.iddr=p.codigo
where idtipotransaccion=0 and isnull(idDr,0)<>0
and (v.fecha between @Inicio and @Cierre or ic.fecha between @Inicio and @Cierre)








GO
/****** Object:  StoredProcedure [dbo].[ComparativoIE]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  Procedure [dbo].[ComparativoIE]
(
	@Desde	int,
	@Hasta	int
)

as
select aniomes,concepto,cuenta,descripcion,
sum(debeFondo) as GastosFondo,
sum(HaberFondo) as ingresosFondo, 
sum(debeFoprosa) as GastosFopro,
sum(HaberFoprosa) as ingresosFopro 
from ieFondoFopro
where aniomes>=@Desde and aniomes<=@Hasta
group by aniomes,concepto,cuenta,descripcion


GO
/****** Object:  StoredProcedure [dbo].[CompComprasDia]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Procedure [dbo].[CompComprasDia]
(
	@Desde	varchar(8)='20090701',
	@Hasta	varchar(8)='20090731'
)
as
Select c.fecha,t.comprobante tcomp, c.nrocomprobante,tipoFactura,isnull(p.razonsocial,pf.razonSocial) razonSocial,totalimporte,c.comprobante,aniomes,idtransaccion
from CompProvHeader c
inner join tipCompModHeader t
on c.tipocomprobante=t.codigo
left join Proveedores p
on c.proveedor=p.codigo
left join provFondo pf
on c.proveedor=pf.proveedor
where c.fecha between @Desde and @Hasta
and ivacompras='S'






GO
/****** Object:  StoredProcedure [dbo].[CompComprasDiaFondos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Procedure [dbo].[CompComprasDiaFondos]
(
	@Desde	varchar(8)='20090701',
	@Hasta	varchar(8)='20090731'
)
as
Select c.fecha,t.comprobante tcomp, c.nrocomprobante,tipoFactura,isnull(p.razonsocial,pf.razonSocial) razonSocial,totalimporte,c.comprobante,aniomes,idtransaccion
from CompFondosHeader c
inner join tipCompModHeader t
on c.tipocomprobante=t.codigo
left join Proveedores p
on c.proveedor=p.codigo
left join provFondo pf
on c.proveedor=pf.proveedor
where c.fecha between @Desde and @Hasta
and ivacompras='S'






GO
/****** Object:  StoredProcedure [dbo].[compRetencion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Procedure [dbo].[compRetencion]
(
	@Proveedor	int=211255,
	@Neto		numeric(18,2)=34224,
	@Alicuota	numeric(18,2)=2.5,
	@CodigoRet	varchar(3)='06',
	@cNumero	varchar(14)='0001-00000204',
	@Fecha		varchar(8)='20090706'

)
as
Select Codigo,razonSocial,Cuit,Domicilio,localidad,codigopostal,idprovincia,
@alicuota,@neto,round(@neto*@alicuota/100,2) retenido,@CodigoRet

from proveedores 
Where codigo=@Proveedor

GO
/****** Object:  StoredProcedure [dbo].[Comprobantes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Procedure [dbo].[Comprobantes]
(
		@idOperacion int=215297
	
)
as
Select 0,cph.fecha,tmh.comprobante,nrocomprobante,isnull(pf.razonsocial,p.razonSocial) razonSocial, totalimporte,cph.idtransaccion from Detalle_Operaciones do
inner join compProvHeader cph
on do.idtransaccion=cph.idtransaccion
left join cphVarios cv
on cph.idtransaccion=cv.idtransaccion
left join proveedores p 
on isnull(cv.codigo,cph.proveedor)=p.codigo
left join ProvFondo pf 
on isnull(cv.codigo,cph.proveedor)=pf.proveedor
inner join TipCompModHeader tmh
on cph.tipocomprobante=tmh.codigo
where idoperacion=@idOperacion
and do.idtipotransaccion=1
Union
Select 1,cph.fecha,tmh.comprobante,nrocomprobante,isnull(pf.razonsocial,p.razonSocial) razonSocial, totalimporte,cph.idtransaccion from Detalle_Operaciones do
inner join compFondosHeader cph
on do.idtransaccion=cph.idtransaccion
left join cphVarios cv
on cph.idtransaccion=cv.idtransaccion
left join proveedores p 
on isnull(cv.codigo,cph.proveedor)=p.codigo
left join ProvFondo pf 
on isnull(cv.codigo,cph.proveedor)=pf.proveedor
inner join TipCompModHeader tmh
on cph.tipocomprobante=tmh.codigo
where idoperacion=@idOperacion
and do.idtipotransaccion=3

GO
/****** Object:  StoredProcedure [dbo].[ComprobantesProveedor]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Procedure [dbo].[ComprobantesProveedor]
(
	@Codigo		int=NULL,
	@fDesde		char(8)='',
	@fHasta		char(8)=''	
)
as
Select cph.fecha,t.comprobante,nroComprobante,totalimporte,fecha1Venc,1 as chk,idtransaccion from CompProvHeader cph
INNER JOIN TipCompModHeader t ON cph.tipocomprobante = T.codigo 
where cph.proveedor=@Codigo
and cph.Fecha between  @fDesde and @fHasta
and t.codigo<>0






GO
/****** Object:  StoredProcedure [dbo].[Conceptos_Activos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO






CREATE         Procedure [dbo].[Conceptos_Activos]
	@N_Entidad int,
	@N_Socio int,
	@idTransaccion Numeric (18,0)
AS
Declare @AnioMes int
Select @AnioMes=(Select DocumentoNumero From CuentasCorrientes where idTransaccion=@idTransaccion)

if @aniomes<200604
	begin
			if @N_Entidad=0
			BEGIN
			SELECT     Conceptos_socios.Concepto AS Concepto, Conceptos_socios.FechaVigencia AS Vigencia, Conceptos.Modalidad AS Modalidad, 
			               Conceptos.Importe AS Importe
			FROM       Conceptos_socios INNER JOIN
			               Conceptos ON Conceptos_socios.Concepto = Conceptos.Concepto
			WHERE     (Conceptos_socios.socio = @N_SOCIO) 
				   and (fechaBaja is null and 
					(convert(char(4),year(FechaVigencia)) 
					+ right((convert(varchar(2),month(FechaVigencia)) + 100),2)<=@aniomes)
					or (convert(char(4),year(FechaBaja)) + right((convert(varchar(2),month(FechaBaja)) + 100),2)
					)>=@Aniomes)
				  	and ((convert(char(4),year(FechaVigencia)) 
					+ right((convert(varchar(2),month(FechaVigencia)) + 100),2)
					)<=@Aniomes)
			END
			ELSE
			BEGIN
			SELECT     Conceptos_adherentes.Concepto AS Concepto, Conceptos_Adherentes.FechaVigencia AS Vigencia, Conceptos.Modalidad AS Modalidad, 
			               Conceptos.Importe AS Importe
			FROM       Conceptos_Adherentes INNER JOIN
			               Conceptos ON Conceptos_Adherentes.Concepto = Conceptos.Concepto
			WHERE     (Conceptos_Adherentes.adherente = @N_SOCIO)
				   and (fechaBaja is null and 
			(convert(char(4),year(FechaVigencia)) 
			+ right((convert(varchar(2),month(FechaVigencia)) + 100),2)<=@aniomes)
					or (convert(char(4),year(FechaBaja)) + right((convert(varchar(2),month(FechaBaja)) + 100),2)
					)>=@Aniomes)
				  	and ((convert(char(4),year(FechaVigencia)) 
					+ right((convert(varchar(2),month(FechaVigencia)) + 100),2)
					)<=@Aniomes)
			END
	end
else
	begin
			if @N_Entidad=0
			BEGIN
			SELECT     Conceptos_socios.Concepto AS Concepto, Conceptos_socios.FechaVigencia AS Vigencia, Conceptos.Modalidad AS Modalidad, 
			               Conceptos.Importe AS Importe
			FROM       Conceptos_socios INNER JOIN
			               Conceptos_aumento conceptos ON Conceptos_socios.Concepto = Conceptos.Concepto
			WHERE     (Conceptos_socios.socio = @N_SOCIO) 
				   and (fechaBaja is null and 
					(convert(char(4),year(FechaVigencia)) 
					+ right((convert(varchar(2),month(FechaVigencia)) + 100),2)<=@aniomes)
					or (convert(char(4),year(FechaBaja)) + right((convert(varchar(2),month(FechaBaja)) + 100),2)
					)>=@Aniomes)
				  	and ((convert(char(4),year(FechaVigencia)) 
					+ right((convert(varchar(2),month(FechaVigencia)) + 100),2)
					)<=@Aniomes)
			END
			ELSE
			BEGIN
			SELECT     Conceptos_adherentes.Concepto AS Concepto, Conceptos_Adherentes.FechaVigencia AS Vigencia, Conceptos.Modalidad AS Modalidad, 
			               Conceptos.Importe AS Importe
			FROM       Conceptos_Adherentes INNER JOIN
			               Conceptos_aumento conceptos ON Conceptos_Adherentes.Concepto = Conceptos.Concepto
			WHERE     (Conceptos_Adherentes.adherente = @N_SOCIO)
				   and (fechaBaja is null and 
			(convert(char(4),year(FechaVigencia)) 
			+ right((convert(varchar(2),month(FechaVigencia)) + 100),2)<=@aniomes)
					or (convert(char(4),year(FechaBaja)) + right((convert(varchar(2),month(FechaBaja)) + 100),2)
					)>=@Aniomes)
				  	and ((convert(char(4),year(FechaVigencia)) 
					+ right((convert(varchar(2),month(FechaVigencia)) + 100),2)
					)<=@Aniomes)
			END
	end





GO
/****** Object:  StoredProcedure [dbo].[Conceptos_Cargo_Socio]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE     Procedure [dbo].[Conceptos_Cargo_Socio] 
	@N_Entidad int,
	@N_Socio int,
	@AnioMes int
as

Declare @N_Cargo numeric(18,2)

if @N_entidad=0
	begin
		SELECT @N_Cargo= Count(*)
		FROM conceptos_socios Con
		INNER JOIN dbo.Conceptos Imp
		ON Imp.Concepto = Con.Concepto

		WHERE Con.Socio = @N_SOCIO 
		and (fechaBaja is null and 
		(convert(char(4),year(FechaVigencia)) 
		+ right((convert(varchar(2),month(FechaVigencia)) + 100),2)<=@aniomes) or 
		((convert(char(4),year(FechaBaja)) + right((convert(varchar(2),month(FechaBaja)) + 100),2))
		>=@Aniomes) 
		and ((convert(char(4),year(FechaVigencia)) + right((convert(varchar(2),month(FechaVigencia)) 
		+ 100),2))<=@Aniomes))
	end
else
	begin
		SELECT @N_Cargo=count(*)
		FROM conceptos_adherentes Con
		INNER JOIN dbo.Conceptos Imp
		ON Imp.Concepto = Con.Concepto

		WHERE Con.Adherente = @N_socio
		and (fechaBaja is null and 
(convert(char(4),year(FechaVigencia)) 
+ right((convert(varchar(2),month(FechaVigencia)) + 100),2)<=@aniomes) or 
		((convert(char(4),year(FechaBaja)) + right((convert(varchar(2),month(FechaBaja)) + 100),2))
		>=@Aniomes) 
		and ((convert(char(4),year(FechaVigencia)) + right((convert(varchar(2),month(FechaVigencia)) 
		+ 100),2))<=@Aniomes))
	end
Return @N_Cargo


GO
/****** Object:  StoredProcedure [dbo].[Conceptos_Imputacion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[Conceptos_Imputacion](@Socio int, @Periodo int,@Complemento int)
as
(Select 200211 as Periodo, cs.socio, cs.concepto, co.descripcion, co.modalidad, co.importe, isnull((Select sum(co1.Importe) from conceptos_socios cs1 inner join conceptos co1 on cs1.concepto = co1.concepto inner join socios sc on cs1.socio=sc.socio Where (cs1.fechabaja Is Null or cs1.FechaBaja>'20021130'  or cs1.fechabaja=sc.fechaBaja) And cs1.Socio = cs.Socio and Modalidad = 'I'),0) as ImporteResta, isnull((Select sum(co1.Importe) from conceptos_socios cs1 inner join conceptos co1 on cs1.concepto = co1.concepto inner join socios sc on cs1.socio=sc.socio Where (cs1.fechabaja Is Null or cs1.FechaBaja>'20021130' or cs1.fechabaja=sc.fechaBaja) And cs1.Socio = cs.Socio and Modalidad = 'P'),0) as TotalPorcentaje, isnull((Select Count(*) from conceptos_socios cs1 inner join conceptos co1 on cs1.concepto = co1.concepto inner join socios sc on cs1.socio=sc.socio Where (cs1.fechabaja Is Null or cs1.FechaBaja>'20021130'  or cs1.fechabaja=sc.fechaBaja) And cs1.Socio = cs.Socio ),0) as Conceptos from conceptos_socios cs
 inner join conceptos co on cs.concepto = co.concepto inner join socios sc on cs.socio=sc.socio Where (cs.fechabaja Is Null or cs.FechaBaja>'20021130' or cs.fechabaja=sc.fechaBaja) and cs.socio = @Socio) Union (Select ch.MesaImputar as Periodo, cs.socio, cs.concepto, co.descripcion, co.modalidad, co.importe, isnull((Select sum(co1.Importe) from conceptos_socios cs1 inner join conceptos co1 on cs1.concepto = co1.concepto inner join socios sc on cs1.socio=sc.socio Where (cs1.fechabaja Is Null or cs1.FechaBaja>'20021130'  or cs1.fechabaja=sc.fechaBaja) And cs1.Socio = cs.Socio and Modalidad = 'I'),0) as ImporteResta, isnull((Select sum(co1.Importe) from conceptos_socios cs1 inner join conceptos co1 on cs1.concepto = co1.concepto inner join socios sc on cs1.socio=sc.socio Where (cs1.fechabaja Is Null or cs1.FechaBaja>'20021130' or cs1.fechabaja=sc.fechaBaja) And cs1.Socio = cs.Socio and Modalidad = 'P'),0) as TotalPorcentaje, isnull((Select Count(*) from conceptos_socios cs1 inner join conceptos co1 on 
cs1.concepto = co1.concepto inner join socios sc on cs1.socio=sc.socio Where (cs1.fechabaja Is Null or cs1.FechaBaja>'20021130'  or cs1.fechabaja=sc.fechaBaja) And cs1.Socio = cs.Socio ),0) as Conceptos from conceptos_socios cs inner join conceptos co on cs.concepto = co.concepto inner join socios sc on cs.socio=sc.socio inner join ComplementoHospitales ch on cs.socio=ch.socio Where (cs.fechabaja Is Null or cs.FechaBaja>'20021130' or cs.fechabaja=sc.fechaBaja) and cs.socio = @Socio and (select count(*) from ComplementoHospitales where ch.aniomes=@Complemento and socio=@Socio)>0 ) Order by co.modalidad 




GO
/****** Object:  StoredProcedure [dbo].[Consulta_Generador]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO






CREATE     procedure [dbo].[Consulta_Generador]
	@N_Entidad	int	= null  ,
	@C_Grupo	char(2)	= NULL	, 
	@C_Tarjeta	Int	= NULL	,
	@N_Cobrador	Int	= NULL	,
	@N_Desde	Int	= NULL	,
	@N_Hasta	Int	= NULL
AS

	/****************************************************************/
	/* Devolver los datos						*/
	/****************************************************************/
		select		Soc.adherente as [Socio]		, 
				1 as Entidad				,
				Soc.apellido as [Apellido]		,
				Soc.nombre as [Nombre]			,
				Soc.tarjeta				,
				Soc.numero as [Numero de Tarjeta]	,
				Soc.vencimiento as [Vencimiento]	,
				Soc.Identificador 			,
				'Foprosa' as Dentidad
		from adherentes Soc

			FULL OUTER JOIN dbo.grupos_adherentes Grupo
			ON Grupo.Adherente = Soc.Adherente
			and (Grupo.Grupo = @C_Grupo or @C_Grupo is null)  

		where Soc.FechaBaja is null
		AND (Soc.Adherente BETWEEN @N_Desde AND @N_Hasta OR @N_Desde is null)
		AND (Soc.Tarjeta = @C_Tarjeta or @C_Tarjeta is null)
		And (Soc.Cobrador = @N_Cobrador or @N_Cobrador is null) 

	Union 

		select		Soc.Socio				,
				0 as Entidad				,
				Soc.apellido as [Apellido]		,
				Soc.nombre as [Nombre]			,
				Soc.tarjeta				,
				Soc.numero as [Numero de Tarjeta]	,
				Soc.vencimiento as [Vencimiento]	,
				Soc.Identificador 			,
				'Socios' as Dentidad
		from socios Soc

			FULL OUTER JOIN dbo.grupos_socios Grupo
			ON Grupo.Socio = Soc.Socio
			and (Grupo.Grupo = @C_Grupo or @C_Grupo is null) 

		where Soc.FechaBaja is null
		AND (Soc.Socio BETWEEN @N_Desde AND @N_Hasta OR @N_Desde is null)
		AND (Soc.Tarjeta = @C_Tarjeta or @C_Tarjeta is null)
		And (Soc.Cobrador = @N_Cobrador or @N_Cobrador is null)



	order by Dentidad, Apellido, Nombre, socio



GO
/****** Object:  StoredProcedure [dbo].[ConsultaCliPro]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO

-- Select * from CompProvHeader
-- Select * from venCliHeader
-- ConsultaCliPro 'P','A',211071,'20090630',''
-- ConsultaCliPro 'C','A',121030,'20090821',''

CREATE                                 Procedure [dbo].[ConsultaCliPro]

	@CliPro 	Char(1),
	@C_Modo		char(1)='T',
	@Codigo		int=NULL,
	@fDesde		char(8)='',
	@fHasta		char(8)=''

AS
Declare @C_String as nvarchar(4000)
Declare @TB as char(20)
Declare @TBC as char(20)
Declare @fnSaldo as char(150)
if @clipro='C'
begin
	Set @TB=ltrim(Rtrim('VenCliHeader'))
	Set @TBC=ltrim(Rtrim('Cliente'))
--	Set @fnSaldo='dbo.saldoDolar(VenCliHeader.Cliente,VenCliHeader.nrocomprobante)'
end

if @clipro='P'
begin
	Set @TB=ltrim(Rtrim('CompProvHeader'))
	Set @TBC=ltrim(Rtrim('Proveedor'))
--	Set @fnSaldo='dbo.saldoDolarProveedor(compProvHeader.Proveedor,CompProvHeader.nrocomprobante)'
end

Select @C_String=''

if @clipro='C' and @fDesde<>'' and @C_Modo<>'A'
	Select @C_String='(
SELECT "' + @fDesde + '"fecha , "SA" AS TP, "" nrocomprobante,"" as PV, 
"0" as NCO,
"" tipofactura, 
case when sum((totalImporte)*Multiplicador)>=0 then sum((totalImporte)*Multiplicador) else 0 end as Debe,
case when sum((totalImporte)*Multiplicador)<0 then -sum((totalImporte)*Multiplicador) else 0 end AS Haber, 
0 AS SALDO,
0 cancelado, 
"" as Vencimiento, 
"" as serie,
0 idTransaccion, 
' + CAST(@codigo AS VARCHAR(6)) + ' cliente, 0 signo, 0 idOperacion,0 as Asiento, 0 tipoasiento,"" fecha1venc,"" fecha2venc, 
case when sum(ImporteOrigen*Multiplicador*isnull(moneda,0))>=0 then Sum((ImporteOrigen)*Multiplicador*isnull(moneda,0)) else 0 end as DolaresDebe,
case when sum((ImporteOrigen)*Multiplicador*isnull(moneda,0))<0 then -sum((ImporteOrigen)*Multiplicador*isnull(moneda,0)) else 0 end AS DolaresHaber, 
1,isnull(1,1) tc
FROM vencliheader cph 
INNER JOIN TipVentModHeader x ON cph.tipocomprobante = x.codigo 
inner join clientes p on cph.cliente=p.codigo
						
Where cliente=' + CAST(@codigo AS VARCHAR(6)) + ' and cph.fecha<"' + @fDesde + '"
) union '

if @clipro='P' and @fDesde<>'' and @C_Modo<>'A'
	Select @C_String='(
SELECT "' + @fDesde + '"fecha , "SA" AS TP, "" nrocomprobante,"" as PV, 
"0" as NCO,
"" tipofactura, 
case when sum((totalImporte)*Multiplicador)<0 then -sum((totalImporte)*Multiplicador) else 0 end AS Debe, 
case when sum((totalImporte)*Multiplicador)>=0 then sum((totalImporte)*Multiplicador) else 0 end as Haber,
0 AS SALDO,
0 cancelado, 
"" as Vencimiento, 
"" as serie,
0 idTransaccion, 
' + CAST(@codigo AS VARCHAR(6)) + ' cliente, 0 signo, 0 idOperacion,0 as Asiento, 0 tipoasiento,"" fecha1venc,"" fecha2venc, 
case when sum((ImporteOrigen)*Multiplicador*isnull(moneda,0))<0 then -sum((ImporteOrigen)*Multiplicador*isnull(moneda,0)) else 0 end AS DolaresDebe, 
case when sum(ImporteOrigen*Multiplicador*isnull(moneda,0))>=0 then Sum((ImporteOrigen)*Multiplicador*isnull(moneda,0)) else 0 end as DolaresHaber,
1,isnull(1,1) tc
FROM CompProvHeader cph 
INNER JOIN TipCompModHeader x ON cph.tipocomprobante = x.codigo 
--inner join detalle_Operaciones do on do.idtransaccion=cph.idtransaccion
--inner join Header_Operaciones ho on do.idOperacion=ho.idOperacion
inner join proveedores p on cph.proveedor=p.codigo
						
Where  p.codigo=' + CAST(@codigo AS VARCHAR(6)) + ' and isnull(cph.estado,"A") not in ("F","Z") and cph.fecha<"' + @fDesde + '"
) union '

Set @C_String=@C_String + '
(
SELECT 
' + rtrim(ltrim(@TB)) + '.fecha, '
if @clipro='C'
Set @C_String=@C_String+'x.comprobante AS TP, nrocomprobante,'
else
Set @C_String=@C_String+'TipCompModHeader.comprobante AS TP, nrocomprobante,'

if @clipro='C' 
Set @C_String=@C_String+'case when len(ltrim(rtrim(VenCliHeader.nrocomprobante)))>8 
then SUBSTRING(VenCliHeader.nrocomprobante,1,4) else SUBSTRING(VenCliHeader.nrocomprobante,0,0) end as PV, 
case when len(ltrim(rtrim(VenCliHeader.nrocomprobante)))>8 
then SUBSTRING(VenCliHeader.nrocomprobante,5,8) else SUBSTRING(VenCliHeader.nrocomprobante,1,8) end as NCO,' + rtrim(ltrim(@TB)) + '.tipofactura, 
0 AS DEBE, ' 
ELSE
Set @C_String=@C_String+'SUBSTRING(' + rtrim(ltrim(@TB)) + '.nrocomprobante,1,4) as PV, 
SUBSTRING(' + rtrim(ltrim(@TB)) + '.nrocomprobante,5,8) as NCO,
' + rtrim(ltrim(@TB)) + '.tipofactura, 
0 AS DEBE, ' 

If @C_Modo='A'
	Set @C_String=@C_String + @tb + '.totalimporte-isnull(Cancelado,0)  as Haber, '
else
	Set @C_String=@C_String + @tb + '.totalimporte as haber, '

Set @C_String=@C_String + '0 AS SALDO,
' + rtrim(ltrim(@TB)) + '.cancelado, 
' + rtrim(ltrim(@TB)) + '.fecha1venc as Vencimiento, 
0 as serie,
' + rtrim(ltrim(@TB)) + '.idTransaccion, 
' + rtrim(ltrim(@TB)) + '.' + @TBC 

if @clipro='C'
	Set @C_String=@C_String+', x.signo, ho.idOPeracion ,' + rtrim(ltrim(@TB)) + '.Comprobante as Asiento, ho.tipoasiento,fecha1venc,fecha2venc, ' 
else
	Set @C_String=@C_String+', TipCompModHeader.signo, ho.idOperacion,' + rtrim(ltrim(@TB)) + '.Comprobante as Asiento, ho.tipoasiento,fecha1venc,fecha2venc, ' 

if @clipro='C'
	begin
		if @C_Modo='A' 
			Set @C_String=@C_String+'case when Multiplicador=1 and moneda=1 then importeOrigen-isnull(canceladoOrigen,0) else 0 end DolaresDebe,case when x.Multiplicador=-1 and Moneda=1 then importeOrigen-isnull(canceladoOrigen,0) else 0 end DolaresHaber '
		else
			Set @C_String=@C_String+'case when Multiplicador=1 and moneda=1 then importeOrigen else 0 end DolaresDebe,case when x.Multiplicador=-1 and Moneda=1 then importeOrigen else 0 end DolaresHaber '
		end
else
	begin
		if @C_Modo='A' 
			Set @C_String=@C_String+'case when TipCompModHeader.Multiplicador=-1 and moneda=1 then importeOrigen-isnull(canceladoOrigen,0) else 0 end DolaresDebe,case when TipCompModHeader.Multiplicador=1 and Moneda=1 then importeOrigen-isnull(canceladoOrigen,0) else 0 end DolaresHaber '
		else
			Set @C_String=@C_String+'case when TipCompModHeader.Multiplicador=-1 and moneda=1 then importeOrigen else 0 end DolaresDebe,case when TipCompModHeader.Multiplicador=1 and Moneda=1 then importeOrigen else 0 end DolaresHaber '
	end

Set @C_String=@C_String + ',Moneda,isnull(tc,1) tc FROM ' + @TB  

if @clipro='C'
	begin
		Set @C_String=@C_String+'  INNER JOIN TipVentModHeader x ON ' + rtrim(ltrim(@TB)) + '.tipocomprobante = x.codigo 
					   inner join detalle_Operaciones do on do.idtransaccion='+ rtrim(ltrim(@TB)) +'.idtransaccion
					   inner join Header_Operaciones ho on do.idOperacion=ho.idOperacion
		Where idtipotransaccion=0 and x.signo=2 and ' + @TBC + ' =' + cast(@Codigo as VARCHAR(6))
	end
else
	begin
		Set @C_String=@C_String+'  INNER JOIN TipCompModHeader ON ' + rtrim(ltrim(@TB)) + '.tipocomprobante = TipCompModHeader.codigo 
					   inner join detalle_Operaciones do on do.idtransaccion='+ rtrim(ltrim(@TB)) +'.idtransaccion
					   inner join Header_Operaciones ho on do.idOperacion=ho.idOperacion
		Where idtipotransaccion=1 and isnull(compprovheader.estado,"A") not in ("F","Z") and TipCompModHeader.signo=2 and ' + @TBC + ' =' + cast(@Codigo as VARCHAR(6))
	end

if @C_Modo='A'
	begin
		Set @C_String=@C_String + 'and ((totalimporte-isnull(Cancelado,0)<>0 /* and moneda=0 */) or (importeOrigen-isnull(CanceladoOrigen,0)<>0 and moneda=1))'
	end

if len(ltrim(rtrim(@fDesde)))>0 
	Set @C_String=@C_String + 'and ' + rtrim(ltrim(@TB)) + '.fecha>="' + @fDesde + '"'

if len(ltrim(rtrim(@fHasta)))>0 
	Set @C_String=@C_String + 'and ' + rtrim(ltrim(@TB)) + '.fecha<="' + @fHasta + '"'

Set @C_String=@C_String + ')
 Union
(
SELECT 
' + rtrim(ltrim(@TB)) + '.fecha, '
if @clipro='C'
	Set @C_String=@C_String+'x.comprobante AS TP, nrocomprobante,'
else
Set @C_String=@C_String+'TipCompModHeader.comprobante AS TP, nrocomprobante,'


Set @C_String=@C_String+' SUBSTRING(' + rtrim(ltrim(@TB)) + '.nrocomprobante,1,4) as PV, SUBSTRING(' + rtrim(ltrim(@TB)) + '.nrocomprobante,5,8) as NCO,
' + rtrim(ltrim(@TB)) + '.tipofactura, ' 

if @C_Modo='A'
	Set @C_String=@C_String + @tb + '.totalimporte-isnull(Cancelado,0) as Debe, '
else
	Set @C_String=@C_String + @tb + '.totalimporte  as Debe,'
 
Set @C_String=@C_String + '0 as Haber, 
0 AS SALDO,
' + rtrim(ltrim(@TB)) + '.cancelado, 
' + rtrim(ltrim(@TB)) + '.fecha1venc as Vencimiento,  
0 as serie,
' + rtrim(ltrim(@TB)) + '.idTransaccion, 
' + rtrim(ltrim(@TB)) + '.' + @TBC 
if @clipro='C'
	Set @C_String=@C_String+',x.signo, ho.idOperacion,' + rtrim(ltrim(@TB)) + '.Comprobante as Asiento, ho.tipoasiento,fecha1venc,fecha2venc,' -- case when x.Multiplicador=1 and moneda=1 then importeOrigen else 0 end DolaresDebe,case when x.Multiplicador=-1 and Moneda=1 then importeOrigen else 0 end DolaresHaber '
else
	Set @C_String=@C_String+',TipCompModHeader.signo, ho.idOperacion,' + rtrim(ltrim(@TB)) + '.Comprobante as Asiento, ho.tipoasiento,fecha1venc,fecha2venc,' -- case when TipCompModHeader.Multiplicador=-1 and moneda=1 then importeOrigen else 0 end DolaresDebe,case when TipCompModHeader.Multiplicador=1 and Moneda=1 then importeOrigen else 0 end DolaresHaber  '

if @clipro='C'
	begin
		if @C_Modo='A' 
			Set @C_String=@C_String+'case when Multiplicador=1 and moneda=1 then importeOrigen-isnull(canceladoOrigen,0) else 0 end DolaresDebe,case when x.Multiplicador=-1 and Moneda=1 then importeOrigen-isnull(canceladoOrigen,0) else 0 end DolaresHaber '
		else
			Set @C_String=@C_String+'case when Multiplicador=1 and moneda=1 then importeOrigen else 0 end DolaresDebe,case when x.Multiplicador=-1 and Moneda=1 then importeOrigen else 0 end DolaresHaber '
		end
else
	begin
		if @C_Modo='A' 
			Set @C_String=@C_String+'case when TipCompModHeader.Multiplicador=-1 and moneda=1 then importeOrigen-isnull(canceladoOrigen,0) else 0 end DolaresDebe,case when TipCompModHeader.Multiplicador=1 and Moneda=1 then importeOrigen-isnull(canceladoOrigen,0) else 0 end DolaresHaber '
		else
			Set @C_String=@C_String+'case when TipCompModHeader.Multiplicador=-1 and moneda=1 then importeOrigen else 0 end DolaresDebe,case when TipCompModHeader.Multiplicador=1 and Moneda=1 then importeOrigen else 0 end DolaresHaber '
	end


Set @C_String=@C_String + ',Moneda,isnull(tc,1) tc FROM ' + @TB  

if @clipro='C'
	begin
		Set @C_String=@C_String+'  INNER JOIN TipVentModHeader x ON ' + rtrim(ltrim(@TB)) + '.tipocomprobante = x.codigo 
					   inner join detalle_Operaciones do on do.idtransaccion='+ rtrim(ltrim(@TB)) +'.idtransaccion
					   inner join Header_Operaciones ho on do.idOperacion=ho.idOperacion
		Where  idtipotransaccion=0 and x.signo=1 and ' + @TBC + ' =' + cast(@Codigo as VARCHAR(6))
	end
else
	begin
		Set @C_String=@C_String+'  INNER JOIN TipCompModHeader ON ' + rtrim(ltrim(@TB)) + '.tipocomprobante = TipCompModHeader.codigo 
					   inner join detalle_Operaciones do on do.idtransaccion='+ rtrim(ltrim(@TB)) +'.idtransaccion
					   inner join Header_Operaciones ho on do.idOperacion=ho.idOperacion
		Where idtipotransaccion=1 and isnull(compprovheader.estado,"A") not in ("F","Z") and TipCompModHeader.signo=1 and ' + @TBC + ' =' + cast(@Codigo as VARCHAR(6))
	end

if @C_Modo='A'
	begin
		Set @C_String=@C_String + 'and ((totalimporte-isnull(Cancelado,0)<>0 /* and moneda=0*/) or (importeOrigen-isnull(CanceladoOrigen,0)<>0 and moneda=1))'
		-- Set @C_String=@C_String + 'and  (' + rtrim(ltrim(@TB)) + '.totalimporte<>' + rtrim(ltrim(@TB)) + '.Cancelado or ' + rtrim(ltrim(@TB)) + '.Cancelado is null )'
	end

if len(ltrim(rtrim(@fDesde)))>0 
	Set @C_String=@C_String + 'and ' + rtrim(ltrim(@TB)) + '.fecha>="' + @fDesde + '"'

if len(ltrim(rtrim(@fHasta)))>0 
	Set @C_String=@C_String + 'and ' + rtrim(ltrim(@TB)) + '.fecha<="' + @fHasta + '"'

Set @C_String=@C_String + '
)
Order by ' + rtrim(ltrim(@TB)) + '.fecha,nroComprobante '

-- Print @C_String 

 EXEC sp_executesql @C_String






GO
/****** Object:  StoredProcedure [dbo].[ConsultaCliProDeuda]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




-- exec ConsultaCliProDeuda 'P','T',211271,'',''

-- Select * from CompProvHeader
-- Select * from venCliHeader
-- ConsultaCliProDeuda 'P','A',211225,'',''
-- ConsultaCliPro 'C','A',121840,'',''

CREATE Procedure [dbo].[ConsultaCliProDeuda]

	@CliPro 	Char(1),
	@C_Modo		char(1)='T',
	@Codigo		int=NULL,
	@fDesde		char(8)='',
	@fHasta		char(8)=''

AS
Declare @C_String as nvarchar(4000)
Declare @TB as char(20)
Declare @TBC as char(20)
Declare @fnSaldo as char(150)
if @clipro='C'
begin
	Set @TB=ltrim(Rtrim('VenCliHeader'))
	Set @TBC=ltrim(Rtrim('Cliente'))
end

if @clipro='P'
begin
	Set @TB=ltrim(Rtrim('CompProvHeader'))
	Set @TBC=ltrim(Rtrim('Proveedor'))
end

Select @C_String=''

if @clipro='C' and @fDesde<>'' and @C_Modo<>'A'
	Select @C_String='(
SELECT "' + @fDesde + '"fecha , "SA" AS TP, "" nrocomprobante,"" as PV, 
"0" as NCO,
"" tipofactura, 
case when sum((case when moneda=1 then 0 else totalImporte end)*Multiplicador)>=0 then sum((case when moneda=1 then 0 else totalImporte end)*Multiplicador) else 0 end as Debe,
case when sum((case when moneda=1 then 0 else totalImporte end)*Multiplicador)<0 then -sum((case when moneda=1 then 0 else totalImporte end)*Multiplicador) else 0 end AS Haber, 
0 AS SALDO,
0 cancelado, 
"" as Vencimiento, 
"" as serie,
0 idTransaccion, 
' + CAST(@codigo AS VARCHAR(6)) + ' cliente, 0 signo, 0 idOperacion,0 as Asiento, 0 tipoasiento,"" fecha1venc,"" fecha2venc, 
case when sum(ImporteOrigen*Multiplicador*isnull(moneda,0))>=0 then Sum((ImporteOrigen)*Multiplicador*isnull(moneda,0)) else 0 end as DolaresDebe,
case when sum((ImporteOrigen)*Multiplicador*isnull(moneda,0))<0 then -sum((ImporteOrigen)*Multiplicador*isnull(moneda,0)) else 0 end AS DolaresHaber, 
1,isnull(1,1) tc
FROM vencliheader cph 
INNER JOIN TipVentModHeader x ON cph.tipocomprobante = x.codigo 
--inner join detalle_Operaciones do on do.idtransaccion=cph.idtransaccion
--inner join Header_Operaciones ho on do.idOperacion=ho.idOperacion
inner join clientes p on cph.cliente=p.codigo
						
Where cliente=' + CAST(@codigo AS VARCHAR(6)) + ' and cph.fecha<"' + @fDesde + '"
) union '

if @clipro='P' and @fDesde<>'' and @C_Modo<>'A'
	Select @C_String='(
SELECT "' + @fDesde + '"fecha , "SA" AS TP, "" nrocomprobante,"" as PV, 
"0" as NCO,
"" tipofactura, 
case when sum((case when moneda=1 then 0 else totalImporte end)*Multiplicador)<0 then -sum((case when moneda=1 then 0 else totalImporte end)*Multiplicador) else 0 end AS Debe, 
case when sum((case when moneda=1 then 0 else totalImporte end)*Multiplicador)>=0 then sum((case when moneda=1 then 0 else totalImporte end)*Multiplicador) else 0 end as Haber,
0 AS SALDO,
0 cancelado, 
"" as Vencimiento, 
"" as serie,
0 idTransaccion, 
' + CAST(@codigo AS VARCHAR(6)) + ' cliente, 0 signo, 0 idOperacion,0 as Asiento, 0 tipoasiento,"" fecha1venc,"" fecha2venc, 
case when sum((ImporteOrigen)*Multiplicador*isnull(moneda,0))<0 then -sum((ImporteOrigen)*Multiplicador*isnull(moneda,0)) else 0 end AS DolaresDebe, 
case when sum(ImporteOrigen*Multiplicador*isnull(moneda,0))>=0 then Sum((ImporteOrigen)*Multiplicador*isnull(moneda,0)) else 0 end as DolaresHaber,
1,isnull(1,1) tc
FROM compProvHeader cph 
INNER JOIN TipCompModHeader x ON cph.tipocomprobante = x.codigo 
--inner join detalle_Operaciones do on do.idtransaccion=cph.idtransaccion
--inner join Header_Operaciones ho on do.idOperacion=ho.idOperacion
inner join proveedores p on cph.proveedor=p.codigo
						
Where proveedor=' + CAST(@codigo AS VARCHAR(6)) + ' and cph.fecha<"' + @fDesde + '"
) union '

Set @C_String=@C_String + '
(
SELECT 
' + rtrim(ltrim(@TB)) + '.fecha, '
if @clipro='C'
Set @C_String=@C_String+'th.comprobante AS TP, nrocomprobante,'
else
Set @C_String=@C_String+'th.comprobante AS TP, nrocomprobante,'
if @clipro='C' 
Set @C_String=@C_String+'case when len(ltrim(rtrim(VenCliHeader.nrocomprobante)))>8 
then SUBSTRING(VenCliHeader.nrocomprobante,1,4) else SUBSTRING(VenCliHeader.nrocomprobante,0,0) end as PV, 
case when len(ltrim(rtrim(VenCliHeader.nrocomprobante)))>8 
then SUBSTRING(VenCliHeader.nrocomprobante,5,8) else SUBSTRING(VenCliHeader.nrocomprobante,1,8) end as NCO,' + rtrim(ltrim(@TB)) + '.tipofactura, 
0 AS DEBE, case when moneda=0 then ' 
ELSE
Set @C_String=@C_String+'SUBSTRING(' + rtrim(ltrim(@TB)) + '.nrocomprobante,1,4) as PV, 
SUBSTRING(' + rtrim(ltrim(@TB)) + '.nrocomprobante,5,8) as NCO,
' + rtrim(ltrim(@TB)) + '.tipofactura, 
0 AS DEBE, case when moneda=0 then ' 

If @C_Modo='A'
	Set @C_String=@C_String + @tb + '.totalimporte-isnull(Cancelado,0) else 0 end  as Haber, '
else
	Set @C_String=@C_String + @tb + '.totalimporte else 0 end as haber, '

Set @C_String=@C_String + '0 AS SALDO,
' + rtrim(ltrim(@TB)) + '.cancelado, 
' + rtrim(ltrim(@TB)) + '.fecha1venc as Vencimiento, 
0 as serie,
' + rtrim(ltrim(@TB)) + '.idTransaccion, 
' + rtrim(ltrim(@TB)) + '.' + @TBC 
if @clipro='C'
	Set @C_String=@C_String+', th.signo, ho.idOPeracion ,' + rtrim(ltrim(@TB)) + '.Comprobante as Asiento, ho.tipoasiento,fecha1venc,fecha2venc, ' 
else
	Set @C_String=@C_String+', th.signo, ho.idOperacion,' + rtrim(ltrim(@TB)) + '.Comprobante as Asiento, ho.tipoasiento,fecha1venc,fecha2venc, ' 

if @clipro='C'
	begin
		if @C_Modo='A' 
			Set @C_String=@C_String+'case when Multiplicador=1 and moneda=1 then importeOrigen-isnull(canceladoOrigen,0) else 0 end DolaresDebe,
case when th.Multiplicador=-1 and Moneda=1 then importeOrigen-isnull(canceladoOrigen,0) else 0 end DolaresHaber '
		else
			Set @C_String=@C_String+'case when Multiplicador=1 and moneda=1 then importeOrigen else 0 end DolaresDebe,
case when th.Multiplicador=-1 and Moneda=1 then importeOrigen else 0 end DolaresHaber '
		end
else
	begin
		if @C_Modo='A' 
			Set @C_String=@C_String+'case when th.Multiplicador=-1 and moneda=1 then importeOrigen-isnull(canceladoOrigen,0) else 0 end DolaresDebe,
case when th.Multiplicador=1 and Moneda=1 then importeOrigen-isnull(canceladoOrigen,0) else 0 end DolaresHaber '
		else
			Set @C_String=@C_String+'case when th.Multiplicador=-1 and moneda=1 then importeOrigen else 0 end DolaresDebe,
case when th.Multiplicador=1 and Moneda=1 then importeOrigen else 0 end DolaresHaber '
	end

Set @C_String=@C_String + ',Moneda,isnull(tc,1) tc FROM ' + @TB  

if @clipro='C'
	begin
		Set @C_String=@C_String+'  INNER JOIN TipVentModHeader th ON ' + rtrim(ltrim(@TB)) + '.tipocomprobante = th.codigo 
					   inner join detalle_Operaciones do on do.idtransaccion='+ rtrim(ltrim(@TB)) +'.idtransaccion
					   inner join Header_Operaciones ho on do.idOperacion=ho.idOperacion
		Where idtipotransaccion=0 and th.signo=2 and ' + @TBC + ' =' + cast(@Codigo as VARCHAR(6))
	end
else
	begin
		Set @C_String=@C_String+'  INNER JOIN TipCompModHeader th ON ' + rtrim(ltrim(@TB)) + '.tipocomprobante = th.codigo 
					   inner join detalle_Operaciones do on do.idtransaccion='+ rtrim(ltrim(@TB)) +'.idtransaccion
					   inner join Header_Operaciones ho on do.idOperacion=ho.idOperacion
		Where idtipotransaccion=1 and isnull(estado,"A") not in ("F","Z") and th.signo=2 and ' + @TBC + ' =' + cast(@Codigo as VARCHAR(6))
	end

if @C_Modo='A'
	begin
		Set @C_String=@C_String + 'and ((totalimporte-isnull(Cancelado,0)<>0 and moneda=0) or (importeOrigen-isnull(CanceladoOrigen,0)<>0) and Moneda=1)'
	end

if len(ltrim(rtrim(@fDesde)))>0 
	Set @C_String=@C_String + 'and ' + rtrim(ltrim(@TB)) + '.fecha>="' + @fDesde + '"'

if len(ltrim(rtrim(@fHasta)))>0 
	Set @C_String=@C_String + 'and ' + rtrim(ltrim(@TB)) + '.fecha<="' + @fHasta + '"'

Set @C_String=@C_String + ')
 Union
(
SELECT 
' + rtrim(ltrim(@TB)) + '.fecha, '
if @clipro='C'
	Set @C_String=@C_String+'th.comprobante AS TP, nrocomprobante,'
else
Set @C_String=@C_String+'th.comprobante AS TP, nrocomprobante,'


Set @C_String=@C_String+' SUBSTRING(' + rtrim(ltrim(@TB)) + '.nrocomprobante,1,4) as PV, SUBSTRING(' + rtrim(ltrim(@TB)) + '.nrocomprobante,5,8) as NCO,
' + rtrim(ltrim(@TB)) + '.tipofactura, case when moneda=0 then ' 

if @C_Modo='A'
	Set @C_String=@C_String + @tb + '.totalimporte-isnull(Cancelado,0) else 0 end as Debe, '
else
	Set @C_String=@C_String + @tb + '.totalimporte  else 0 end  as Debe,'
 
Set @C_String=@C_String + '0 as Haber, 
0 AS SALDO,
' + rtrim(ltrim(@TB)) + '.cancelado, 
' + rtrim(ltrim(@TB)) + '.fecha1venc as Vencimiento,  
0 as serie,
' + rtrim(ltrim(@TB)) + '.idTransaccion, 
' + rtrim(ltrim(@TB)) + '.' + @TBC 
if @clipro='C'
	Set @C_String=@C_String+',th.signo, ho.idOperacion,' + rtrim(ltrim(@TB)) + '.Comprobante as Asiento, ho.tipoasiento,fecha1venc,fecha2venc,' -- case when th.Multiplicador=1 and moneda=1 then importeOrigen else 0 end DolaresDebe,case when th.Multiplicador=-1 and Moneda=1 then importeOrigen else 0 end DolaresHaber '
else
	Set @C_String=@C_String+',th.signo, ho.idOperacion,' + rtrim(ltrim(@TB)) + '.Comprobante as Asiento, ho.tipoasiento,fecha1venc,fecha2venc,' -- case when th.Multiplicador=-1 and moneda=1 then importeOrigen else 0 end DolaresDebe,case when th.Multiplicador=1 and Moneda=1 then importeOrigen else 0 end DolaresHaber  '

if @clipro='C'
	begin
		if @C_Modo='A' 
			Set @C_String=@C_String+'case when Multiplicador=1 and moneda=1 then importeOrigen-isnull(canceladoOrigen,0) else 0 end DolaresDebe,case when th.Multiplicador=-1 and Moneda=1 then importeOrigen-isnull(canceladoOrigen,0) else 0 end DolaresHaber '
		else
			Set @C_String=@C_String+'case when Multiplicador=1 and moneda=1 then importeOrigen else 0 end DolaresDebe,case when th.Multiplicador=-1 and Moneda=1 then importeOrigen else 0 end DolaresHaber '
		end
else
	begin
		if @C_Modo='A' 
			Set @C_String=@C_String+'case when th.Multiplicador=-1 and moneda=1 then importeOrigen-isnull(canceladoOrigen,0) else 0 end DolaresDebe,case when th.Multiplicador=1 and Moneda=1 then importeOrigen-isnull(canceladoOrigen,0) else 0 end DolaresHaber '
		else
			Set @C_String=@C_String+'case when th.Multiplicador=-1 and moneda=1 then importeOrigen else 0 end DolaresDebe,case when th.Multiplicador=1 and Moneda=1 then importeOrigen else 0 end DolaresHaber '
	end


Set @C_String=@C_String + ',Moneda,isnull(tc,1) tc FROM ' + @TB  

if @clipro='C'
	begin
		Set @C_String=@C_String+'  INNER JOIN TipVentModHeader th ON ' + rtrim(ltrim(@TB)) + '.tipocomprobante = th.codigo 
					   inner join detalle_Operaciones do on do.idtransaccion='+ rtrim(ltrim(@TB)) +'.idtransaccion
					   inner join Header_Operaciones ho on do.idOperacion=ho.idOperacion
		Where  idtipotransaccion=0 and th.signo=1 and ' + @TBC + ' =' + cast(@Codigo as VARCHAR(6))
	end
else
	begin
		Set @C_String=@C_String+'  INNER JOIN TipCompModHeader th ON ' + rtrim(ltrim(@TB)) + '.tipocomprobante = th.codigo 
					   inner join detalle_Operaciones do on do.idtransaccion='+ rtrim(ltrim(@TB)) +'.idtransaccion
					   inner join Header_Operaciones ho on do.idOperacion=ho.idOperacion
		Where idtipotransaccion=1 and isnull(estado,"A") not in ("F","Z") and th.signo=1 and ' + @TBC + ' =' + cast(@Codigo as VARCHAR(6))
	end

if @C_Modo='A'
	begin
		Set @C_String=@C_String + 'and ((totalimporte-isnull(Cancelado,0)<>0 and moneda=0) or (importeOrigen-isnull(CanceladoOrigen,0)<>0) and Moneda=1)'
	end

if len(ltrim(rtrim(@fDesde)))>0 
	Set @C_String=@C_String + 'and ' + rtrim(ltrim(@TB)) + '.fecha>="' + @fDesde + '"'

if len(ltrim(rtrim(@fHasta)))>0 
	Set @C_String=@C_String + 'and ' + rtrim(ltrim(@TB)) + '.fecha<="' + @fHasta + '"'

Set @C_String=@C_String + '
)
Order by ' + rtrim(ltrim(@TB)) + '.fecha '

-- Print @C_String 

-- ConsultaCliProDeuda 'P','A',211225,'',''

EXEC sp_executesql @C_String







GO
/****** Object:  StoredProcedure [dbo].[ConsultaCtaCte]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO





--ConsultaCtaCte 'A',0, 485

CREATE                Procedure [dbo].[ConsultaCtaCte]

	@C_Modo		char(1)='T',
	@C_Entidad	int=NULL ,
	@C_Socio	int=NULL 

AS
Declare @C_String as nvarchar(4000)
if @C_Entidad<2
	Set @C_String='(SELECT cc.Fecha, cc.Concepto, 
	Case when concepto="CUO" or Concepto="MAT" then cast(idCancelada as char(3)) + "/" +cast(cc.DocumentoNumero as char(2)) else cast(cc.DocumentoNumero as char(6)) end DocumentoNumero, 
	cc.FechaRendicion, 0 as Rendicion,cc.importe-' + case when @C_Modo='A' then 'isnull(cancelado,0)' else '0' end  + ' as Debe,0 as Haber,
	0 as Saldo,cc.Cancelado,cc.vencimiento, cc.Serie,cc.IdTransaccion,cc.socio,cc.Entidad,
	ccc.idTipodeMovimiento,cc.Serie, idCancelada," " Detalle
	FROM ComprobantesCuentasCorrientes ccc
	INNER JOIN TiposdeMovimiento tm ON ccc.idTipodeMovimiento = tm.idTipodeMovimiento
	INNER JOIN CuentasCorrientes cc ON ccc.Comprobante = cc.Concepto  collate SQL_Latin1_General_CP1_CI_AS
	--Left join Detalle_operaciones do on cc.idtransaccion=do.idtransaccion
	--Left join Header_operaciones ho on ho.idOperacion=do.idOperacion
	WHERE (ccc.idTipodeMovimiento = 1) 
	--and isnull(idtipotransaccion,0)=0 
	and cc.socio='+ cast(@C_Socio as VARCHAR(6)) + 
	' and entidad='+cast(@C_Entidad as VARCHAR(1)) 
else
	Set @C_String='(SELECT cc.Fecha, cc.Concepto, 
	Case when cc.concepto="CUO" or cc.Concepto="MAT" then cast(idCancelada as char(3)) + "/" +cast(cc.DocumentoNumero as char(2)) else cast(cc.DocumentoNumero as char(6)) end DocumentoNumero, cc.FechaRendicion, /*isnull(ho.Comprobantenumero,0)*/ 0 as Rendicion,cc.importe as Debe,0 as Haber,
	0 as Saldo,cc.Cancelado,cc.vencimiento, cc.Serie,cc.IdTransaccion,cc.socio,cc.Entidad,
	ccc.idTipodeMovimiento,cc.Serie, idCancelada,a08.descripcion Detalle
	FROM ComprobantesCuentasCorrientes ccc
	INNER JOIN TiposdeMovimiento tm ON ccc.idTipodeMovimiento = tm.idTipodeMovimiento 
	INNER JOIN CuentasCorrientes cc ON ccc.Comprobante = cc.Concepto  collate SQL_Latin1_General_CP1_CI_AS
	Left join DetalleCuentasCorrientes A05 on A05.idTransaccion = cc.idTransaccion 
	left join Horarios h
		on h.idHorario=a05.concepto
	left join NominaCursos n
		on n.idCurso=h.idCurso
	Left JOIN OtrosConceptos a08
		ON n.concepto = a08.concepto	WHERE (ccc.idTipodeMovimiento = 1) 
	--and isnull(idtipotransaccion,0)=0 
	and cc.socio='+ cast(@C_Socio as VARCHAR(6)) + 
	' and entidad='+cast(@C_Entidad as VARCHAR(1)) 

if @C_Modo='A'
	begin
		Set @C_String=@C_String + ' and (cc.importe<>cc.Cancelado or cc.Cancelado is null)'
	end
Set @C_String=@C_String + '
Union

SELECT cc.Fecha, cc.Concepto,
Case when concepto="CUO" or Concepto="MAT" then cast(idCancelada as char(3))+"/"+cast(cc.DocumentoNumero as char(2)) else cast(cc.DocumentoNumero as char(6)) end DocumentoNumero,
cc.FechaRendicion,isnull(ho.Comprobantenumero,0) as Rendicion,0 as Debe,
cc.importe-' + case when @C_Modo='A' then 'isnull(cancelado,0)' else '0' end  + ' as Haber,0 as Saldo,cc.Cancelado,cc.vencimiento,cc.Serie,cc.IdTransaccion,
cc.socio, cc.Entidad, ccc.idTipodeMovimiento, cc.Serie, cc.idcancelada," " Detalle
FROM         ComprobantesCuentasCorrientes ccc
INNER JOIN TiposdeMovimiento tm ON ccc.idTipodeMovimiento = tm.idTipodeMovimiento 
INNER JOIN CuentasCorrientes cc ON ccc.Comprobante = cc.Concepto  collate SQL_Latin1_General_CP1_CI_AS
Left join Detalle_operaciones do on cc.idtransaccion=do.idtransaccion
Left join Header_operaciones ho on ho.idOperacion=do.idOperacion
WHERE (ccc.idTipodeMovimiento = 2) and isnull(idtipotransaccion,0)=0 and cc.socio='+ cast(@C_Socio as VARCHAR(6)) + 
' and entidad='+cast(@C_Entidad as VARCHAR(1)) 
if @C_Modo='A'
	begin
		Set @C_String=@C_String + ' and (cc.importe<>cc.Cancelado or cc.Cancelado is null)'
	end
Set @C_String=@C_String + '
)
Order by cc.Fecha, Haber 
'

EXEC sp_executesql @C_String
--PRINT  @C_String












GO
/****** Object:  StoredProcedure [dbo].[ConsultaDetalleCtaCte]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


-- ConsultaDetalleCtaCte 4284778, COB
CREATE     procedure [dbo].[ConsultaDetalleCtaCte]

	@N_idTransaccion	Int	= NULL,
	@Tipo as char(3)
AS

	/************************************************/
	/* Devolver los datos							*/
 	/************************************************/

if @Tipo = 'MES' or @Tipo = 'CUO' or @Tipo = 'MAT'
	begin
		SELECT 	DetalleCuentasCorrientes.Item, cast(DetalleCuentasCorrientes.Concepto as char(3)) concepto, 
				DetalleCuentasCorrientes.Cantidad, isnull(Conceptos.Descripcion,nc.Descripcion), Conceptos.Modalidad, 
				DetalleCuentasCorrientes.Importe
		FROM DetalleCuentasCorrientes 
			LEFT JOIN Conceptos 
				ON cast(Conceptos.Concepto as char(3)) = cast(DetalleCuentasCorrientes.Concepto as char(3))
			LEFT JOIN NominaCursos nc
				ON cast(DetalleCuentasCorrientes.Concepto as char(3)) = cast(nc.Concepto as char(3)) 
		where idTransaccion = @N_idTransaccion
		order by Item
	end
else
	begin
		-- COB y REN
		SELECT 	dcc.Concepto, isnull(co.Descripcion, nc.Descripcion) descripcion,
				cc.documentonumero as Periodo, dcc.Importe
		from aplicacionescuentascorrientes acc
			inner join detallecuentascorrientes dcc 
				on acc.idtransaccioncancelada = dcc.idtransaccion
			inner join cuentascorrientes cc 
				on cc.idtransaccion = dcc.idtransaccion
			left JOIN Conceptos co 
				on dcc.Concepto = co.Concepto
			left JOIN NominaCursos nc
				on cast(dcc.Concepto as char(3)) = cast(nc.idCurso as char(3))
		where acc.idtransaccion = @N_idTransaccion
		order by cc.documentonumero
    
	end 





GO
/****** Object:  StoredProcedure [dbo].[ConsultaObraFC]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


CREATE Procedure [dbo].[ConsultaObraFC]
(
	@idObra		int=7617
)
as
Select * from (
Select isnull(a.notas,"") partNumber,substring(a.descripcion,1,19) descripcion,ea.cantidad*-1*signo as cantidad, a.precio,
isnull(amt.idCampo,0) as idCampoAmt, ea.idCampo idCampoEa,isnull(ea.idObra,ho.idObra) idObra,
amt.idoperacion,nrocomprobante, 
case 
when totalImporte=cancelado then 'Cobrado' 
when totalImporte>cancelado and cancelado>0 then 'Parcial' 
else ''
end Cobrado, 'ab' Org
from BaseCrm..estadisticaArticulos ea
left join BaseCrm..HeaderMovimientosStock ho on ea.idOPeracion=ho.idOPeracion
inner join BaseCrm..TiposMovimientoStock t on ea.tipomovimiento=t.idTipomovimientoStock
inner join BaseCrm..Articulos a on ea.idArticulo=a.idarticulo
left join BaseCrm..Detalle_Listas dl on a.idArticulo=dl.idarticulo
left join BaseCrm..anexoMateriales amt on ea.idcampoAnexo=amt.idcampo
left join header_operaciones hofc on amt.idOperacion=hofc.idOperacion
left join detalle_Operaciones do on hofc.idOperacion=do.idoperacion and do.idtipotransaccion=0
left join vencliheader vch on do.idtransaccion=vch.idtransaccion
where -- ea.fecfactura is null and 
isnull(ea.idObra,ho.idObra)= @idObra

Union

Select isnull(a.notas,"") partNumber,substring(a.descripcion,1,19) descripcion,ea.cantidad*-1*signo as cantidad, a.precio,
isnull(amt.idCampo,0) as idCampoAmt, ea.idCampo idCampoEa,isnull(ea.idObra,ho.idObra) idObra,
amt.idoperacion,nrocomprobante, 
case 
when totalImporte=cancelado then 'Cobrado' 
when totalImporte>cancelado and cancelado>0 then 'Parcial' 
else ''
end Cobrado, 'st'
from Store..estadisticaArticulos ea
left join Store..HeaderMovimientosStock ho on ea.idOPeracion=ho.idOPeracion
inner join Store..TiposMovimientoStock t on ea.tipomovimiento=t.idTipomovimientoStock
inner join Store..Articulos a on ea.idArticulo=a.idarticulo
left join Store..Detalle_Listas dl on a.idArticulo=dl.idarticulo
left join BaseCrm..anexoMateriales amt on ea.idcampoAnexo=amt.idcampo
left join BaseCrm..header_operaciones hofc on amt.idOperacion=hofc.idOperacion
left join BaseCrm..detalle_Operaciones do on hofc.idOperacion=do.idoperacion and do.idtipotransaccion=0
left join BaseCrm..vencliheader vch on do.idtransaccion=vch.idtransaccion
where -- ea.fecfactura is null and 
isnull(ea.idObra,ho.idObra)= @idObra
) as fcObras Order by fcObras.partNumber

--[ConsultaObraFC] 7692


GO
/****** Object:  StoredProcedure [dbo].[ConsultaValoresTransaccion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE  Procedure [dbo].[ConsultaValoresTransaccion]
	@N_idTransaccion int
AS
SELECT     ValoresTesoreria.idTransaccion, ValoresTesoreria.idConcepto_Tesoreria, Conceptos_tesoreria.Descripcion, ValoresTesoreria.FechaEmision, 
                      Bancos.Descripcion, ValoresTesoreria.Cuenta, ValoresTesoreria.Sucursal, ValoresTesoreria.Numero, ValoresTesoreria.importe
FROM         ValoresTesoreria INNER JOIN
                      Conceptos_tesoreria ON ValoresTesoreria.idConcepto_Tesoreria = Conceptos_tesoreria.idConcepto_Tesoreria LEFT OUTER JOIN
                      Bancos ON ValoresTesoreria.Banco = Bancos.Banco
WHERE     (ValoresTesoreria.idTransaccion = @N_idTransaccion)



GO
/****** Object:  StoredProcedure [dbo].[ConsultaValoresTransaccionOrigen]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO


CREATE  Procedure [dbo].[ConsultaValoresTransaccionOrigen]
	@N_idTransaccion int
AS
SELECT     ValoresTesoreria.idTransaccion, ValoresTesoreria.idConcepto_Tesoreria, Conceptos_tesoreria.Descripcion, ValoresTesoreria.FechaEmision, 
                      Bancos.Descripcion, ValoresTesoreria.Cuenta, ValoresTesoreria.Sucursal, ValoresTesoreria.Numero, ValoresTesoreria.importe
FROM         ValoresTesoreria INNER JOIN
                      Conceptos_tesoreria ON ValoresTesoreria.idConcepto_Tesoreria = Conceptos_tesoreria.idConcepto_Tesoreria LEFT OUTER JOIN
                      Bancos ON ValoresTesoreria.Banco = Bancos.Banco
WHERE     (ValoresTesoreria.idTransaccionOrigen = @N_idTransaccion)

GO
/****** Object:  StoredProcedure [dbo].[Control_op_Proveedores]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create Procedure [dbo].[Control_op_Proveedores]
(
	@idProveedor	int
)
as
select 
Asientosdiariosheader.asiento,
Asientosdiariosheader.aniomes,
Asientosdiariosheader.tipoasiento,
Asientosdiariosheader.fecha,
Asientosdiariosheader.detalle,
 AsientosDiariosItems.item,
 AsientosDiariosItems.cuenta,
 AsientosDiariosItems.observacion,
      CentrosdeCostos.descripcion,
              cuentas.descripcion,
     TiposdeOperacion.descripcion, 
     CentrosdeCostosB.descripcion 
From CompProvHeader cpv
inner join Detalle_operaciones do
on do.idtransaccion=cpv.idtransaccion 
inner Join Header_operaciones Header_operaciones 
on do.idOperacion=Header_operaciones.idOperacion
inner join dbo.asientosdiariosheader Asientosdiariosheader
on Asientosdiariosheader.aniomes=Header_operaciones.aniomes 
and Asientosdiariosheader.tipoasiento=Header_operaciones.tipoasiento 
and Asientosdiariosheader.asiento=Header_operaciones.asientodiario 
left join dbo.TiposdeOperacion TiposdeOperacion 
on Header_operaciones.TipodeOperacion=TiposdeOperacion.idTipodeOperacion 
left join dbo.AsientosDiariosItems AsientosDiariosItems 
on Asientosdiariosheader.asiento=AsientosDiariosItems.asiento 
and Asientosdiariosheader.aniomes=AsientosDiariosItems.aniomes 
and Asientosdiariosheader.TipoAsiento=AsientosDiariosItems.tipoasiento 
left join dbo.CentrosdeCostos CentrosdeCostos 
on Asientosdiariosheader.centrocosto=CentrosdeCostos.centrocosto 
left join dbo.CentrosdeCostos CentrosdeCostosB 
on AsientosDiariosItems.centrocosto=CentrosdeCostosB.centrocosto 
left join dbo.cuentas cuentas 
on AsientosDiariosItems.cuenta = cuentas.cuenta 

where Asientosdiariosheader.fecha>='20030501' 
and Asientosdiariosheader.fecha<='20030901' 
and Asientosdiariosheader.tipoasiento=2 
and do.idtipotransaccion=1
and cpv.proveedor=312
Order By Asientosdiariosheader.tipoasiento ASC,
Asientosdiariosheader.aniomes ASC,
Asientosdiariosheader.Fecha Asc,
Asientosdiariosheader.asiento Asc, 
AsientosDiariosItems.item ASC 

GO
/****** Object:  StoredProcedure [dbo].[Control_rendicion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE Procedure [dbo].[Control_rendicion] (@idOperacion int ) as 

Select 
(Select sum(dcc.Importe)  from Detalle_Operaciones do
inner join CuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion
inner join AplicacionesCuentasCorrientes acc
on cc.idtransaccion=acc.idtransaccion
inner join CuentasCorrientes cc1
on acc.idtransaccionCancelada=cc1.idtransaccion
inner join DetalleCuentasCorrientes dcc
on cc1.idtransaccion=dcc.idtransaccion
where idoperacion=@IdOperacion and idtipotransaccion=0
) as Dcc
,
(Select Sum(cc.Importe)  from Detalle_Operaciones do
inner join CuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion
--inner join AplicacionesCuentasCorrientes acc
--on cc.idtransaccion=acc.idtransaccion
--inner join CuentasCorrientes cc1
--on acc.idtransaccionCancelada=cc1.idtransaccion
--inner join DetalleCuentasCorrientes dcc
--on cc1.idtransaccion=dcc.idtransaccion
where idoperacion=@IdOperacion and idtipotransaccion=0 and (cc.concepto='REN' or cc.concepto='COB')
) as Cobrado
,
(Select Sum(cc1.Importe)  from Detalle_Operaciones do
inner join CuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion
inner join AplicacionesCuentasCorrientes acc
on cc.idtransaccion=acc.idtransaccion
inner join CuentasCorrientes cc1
on acc.idtransaccionCancelada=cc1.idtransaccion
--inner join DetalleCuentasCorrientes dcc
--on cc1.idtransaccion=dcc.idtransaccion
where idoperacion=@IdOperacion and idtipotransaccion=0
) as Imputados
,
(Select Sum(cc.Importe)  from Detalle_Operaciones do
inner join ValoresTesoreria cc
on do.idtransaccion=cc.idtransaccion
where idoperacion=@IdOperacion and idtipotransaccion=2
) as Valores








GO
/****** Object:  StoredProcedure [dbo].[Control_Rendiciones_Totales]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE    Procedure [dbo].[Control_Rendiciones_Totales]
as
Select ho.fecha,idOperacion,ho.comprobanteNumero,
(Select sum(dcc.Importe)  from Detalle_Operaciones do
inner join CuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion
inner join AplicacionesCuentasCorrientes acc
on cc.idtransaccion=acc.idtransaccion
inner join CuentasCorrientes cc1
on acc.idtransaccionCancelada=cc1.idtransaccion
inner join DetalleCuentasCorrientes dcc
on cc1.idtransaccion=dcc.idtransaccion
where idoperacion=ho.idOPeracion and idtipotransaccion=0
) as Dcc
,
(Select Sum(cc.Importe)  from Detalle_Operaciones do
inner join CuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion
where idoperacion=ho.idOPeracion and idtipotransaccion=0 and (cc.concepto='REN' or cc.concepto='COB')
) as Cobrado
,
(Select Sum(cc1.Importe)  from Detalle_Operaciones do
inner join CuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion
inner join AplicacionesCuentasCorrientes acc
on cc.idtransaccion=acc.idtransaccion
inner join CuentasCorrientes cc1
on acc.idtransaccionCancelada=cc1.idtransaccion
where idoperacion=ho.idOPeracion and idtipotransaccion=0
) as Imputados
,
(Select Sum(cc.Importe)  from Detalle_Operaciones do
inner join ValoresTesoreria cc
on do.idtransaccion=cc.idtransaccion
where idoperacion=ho.idOPeracion and idtipotransaccion=2
) as Valores,ho.cuenta

from Header_Operaciones ho
where 
(TipodeOperacion=17 or tipodeOperacion=19)
and ho.fecha>='20060410' and ho.fecha<='20060510'
/*
(TipodeOperacion=17)
and ho.fecha>='20030501' and ho.fecha<='20030731'

--(TipodeOperacion=19)
--and ho.fecha>='20030501' and ho.fecha<='20030731'
*/

order by ho.fecha



GO
/****** Object:  StoredProcedure [dbo].[Control_rentados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[Control_rentados]
as
Select sc.socio,sc.apellido,sc.nombre,h.nombre as Hospital from 
socios sc
inner join grupos_socios gs
on sc.socio=gs.socio
LEFT JOIN 
Hospitales h ON gs.lugarpago = H.Hospital AND gs.reparticion = H.Reparticion
LEFT JOIN 
Reparticiones rpt ON gs.reparticion = rpt.Reparticion 
where fechabaja is null
and gs.grupo='R'
and sc.grupo<>'R'
Order by h.nombre,sc.Apellido,sc.Nombre




GO
/****** Object:  StoredProcedure [dbo].[Control_rentados_RESIDENTES]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

cREATE Procedure [dbo].[Control_rentados_RESIDENTES]
as

SELECT sc.socio,sc.apellido,sc.nombre,h.nombre as Hospital from socios_desarrollo.dbo.nr nr
inner join socios sc
on sc.socio=nr.f1
inner join grupos_socios gs
on sc.socio=gs.socio
LEFT JOIN 
Hospitales h ON gs.lugarpago = H.Hospital AND gs.reparticion = H.Reparticion
LEFT JOIN 
Reparticiones rpt ON gs.reparticion = rpt.Reparticion 

where sc.grupo<>'R'
and sc.fechabaja is null

GO
/****** Object:  StoredProcedure [dbo].[ControlAfip]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[ControlAfip](@idLiquidacion int)
as
(
Select distinct
c.concepto as concepto,
c.descripcion as descripcion,
(
Select sum(importe) from items_liquidaciones i
inner join maestropersonal m on i.legajo=m.legajo
where i.concepto=c.concepto and m.jubilado=0 
and m.sistemajubilacion=1
) as afjp,
(
Select sum(importe) from items_liquidaciones i
inner join maestropersonal m on i.legajo=m.legajo
where i.concepto=c.concepto and m.jubilado=0 
and m.sistemajubilacion=0
) as activo, 
(
Select sum(importe) from items_liquidaciones i
inner join maestropersonal m on i.legajo=m.legajo
where i.concepto=c.concepto and m.jubilado=1
and m.sistemajubilacion=0
) as jubilado

from 
conceptosLiquidacion c 
inner join items_liquidaciones i on c.concepto=i.concepto
where c.concepto<152 

)
order by concepto



GO
/****** Object:  StoredProcedure [dbo].[ControlConceptos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create Procedure [dbo].[ControlConceptos] (@idLiq int, @idConcepto int)
as
Select il.legajo, mp.Apellido,mp.nombre, il.importe From 
items_Liquidaciones il
inner Join MaestroPersonal mp on mp.legajo=il.legajo

where concepto=@idConcepto and idLiquidacion=@idLiq

order by il.legajo, Importe ASC


GO
/****** Object:  StoredProcedure [dbo].[ControlCuilMunicipal]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO






CREATE      Procedure [dbo].[ControlCuilMunicipal]
as

Select socios.Socio,Apellido,Nombre,Cuil,subString(cuilMuni,3,8),numedocto,gru_socios.subnumero from Socios 
inner join grupos_socios as gru_socios
	on socios.socio = gru_socios.socio
inner join grupos gru
	on gru.grupo = gru_socios.grupo and gru.modo = 1
where socios.Grupo='R' and Fechabaja is null and 
(cuilmuni is null or cuil is null or (len(ltrim(cuilMuni))<>11) or subString(cuilMuni,3,8)<>numedocto or (len(ltrim(cuil))<>11)
 or len(ltrim(gru_socios.subnumero))<>2 or len(gru_socios.subnumero)<>2)
order by Apellido,Nombre

/* agregar  subnumero 
longitud<>2 o corrido */






GO
/****** Object:  StoredProcedure [dbo].[ControlDiario]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



--ControlDiario 200907,2

CREATE   Procedure [dbo].[ControlDiario]
(
	@Aniomes	int,
	@tipoasiento	int,
	@asiento	int=0
)
as
Select 
ai.asiento,
ai.item,
ai.cuenta,
ct.descripcion,
ai.centrocosto,
debe,
haber,
ah.detalle,
ho.ObservacionComprobante,
ah.fecha,
isnull(ah.asientoInterno,0) AsientoInterno,
tipoAsInterno, 
isnull(Case 
when ai.tipoasiento=1 then (select Top 1 nroComprobante from Vencliheader vch
inner join detalle_operaciones do 
on vch.idtransaccion=do.idtransaccion and do.idtipotransaccion=0 where do.idOperacion=ho.idOPeracion)
When ai.tipoasiento=2 then (select Top 1 right(nroComprobante,8) from CompProvHeader c 
inner join detalle_operaciones do1 
on do1.idtransaccion=c.idtransaccion and do1.idtipotransaccion=1 where do1.idOperacion=ho.idOPeracion)
else
0 end,0)
ComProbante

from asientosdiariositems ai
inner Join asientosdiariosHeader ah
on ai.asiento=ah.asiento and ai.aniomes=ah.aniomes and ai.tipoasiento=ah.tipoasiento
inner Join Header_Operaciones ho
on ho.asientoDiario=ah.asiento and ho.aniomes=ah.aniomes and ho.tipoasiento=ah.tipoasiento
inner join cuentas ct
on ct.cuenta=ai.cuenta

where ah.tipoasiento=@tipoasiento 
and ah.aniomes=@Aniomes
and (@asiento=0 or @asiento=ah.asiento)
order by ah.aniomes,ah.Fecha,ah.asiento,ai.item





GO
/****** Object:  StoredProcedure [dbo].[ControlGrillaStock]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE Procedure [dbo].[ControlGrillaStock]
(
	@Desde	varchar(8)='20090701',
	@Hasta	varchar(8)='20090731',
	@TipoMovimiento	int=0
)
as
Select ho.fecha,Articulo,Cantidad,Desvia,Matricula,docum,hms.idObra,fcProveedor,hms.idProveedor,idCampo,ho.idOperacion,
isnull(vencimiento,'') vencimiento
from EstadisticaArticulos ea
inner join HeaderMovimientosStock hms
on ea.idOperacion=hms.idOPeracion
inner join Header_operaciones ho
on hms.idOperacion=ho.idOperacion
inner join Articulos a
on ea.idArticulo=a.idarticulo
Left join Matriculas m
on ea.idMatricula=m.idMatricula
where (tipoMovimiento<>11 and tipoMovimiento<>21)

and ho.Fecha between @Desde and @Hasta

and (TipoMovimiento=@TipoMovimiento or @TipoMovimiento=0)

order by ho.Fecha,idCampo Desc
GO
/****** Object:  StoredProcedure [dbo].[ControlIvaCompras]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


-- ControlIvaCompras 127400,'20090801','20090831','s'

CREATE Procedure [dbo].[ControlIvaCompras]
(
	@Cuenta		int=127400,
	@Desde		varchar(8)='20090701',
	@Hasta		varchar(8)='20090731',
	@SN			varchar(1)='S'
)
as
Select ho.idOperacion, ho.observacion + ' ' + cast(ho.aniomes as varchar(6)) as observacion,ah.asientointerno asientodiario,ho.tipoasiento,
ho.aniomes,sum(debe) Debe,sum(haber) Haber,isnull(isnull((Select sum(BaseContable) Cartera
from compProvItems i
inner join Detalle_Operaciones d
on i.idtransaccion=d.idtransaccion 
where idOperacion=ho.idOPeracion and idtipotransaccion=1 and cuenta=@Cuenta),
(Select sum(Neto) 
from compFondosItems i
inner join Detalle_Operaciones d
on i.idtransaccion=d.idtransaccion 
where idOperacion=ho.idOPeracion and idtipotransaccion=3 and cuentaneto=@Cuenta)),0) Cartera,
Sum(debe)+Sum(Haber)-isnull(isnull((Select sum(BaseContable) 
from compProvItems i
inner join Detalle_Operaciones d
on i.idtransaccion=d.idtransaccion 
where idOperacion=ho.idOPeracion and idtipotransaccion=1 and cuenta=@Cuenta),
(Select sum(Neto) 
from compFondosItems i
inner join Detalle_Operaciones d
on i.idtransaccion=d.idtransaccion 
where idOperacion=ho.idOPeracion and idtipotransaccion=3 and cuentaneto=@Cuenta)),0) Diferencia


from Asientosdiariositems ai
inner join Header_operaciones ho
on ai.asiento=ho.asientodiario and ai.aniomes=ho.aniomes
and ai.tipoasiento=ho.tipoasiento
inner join asientosdiariosheader ah 
on ai.asiento=ah.asiento and ai.aniomes=ah.aniomes and ai.tipoasiento=ah.tipoasiento
where ai.cuenta=@Cuenta
and ho.fecha between @Desde and @Hasta

Group by ho.idOperacion,ho.observacion + ' ' + cast(ho.aniomes as varchar(6)),ah.asientoInterno,ho.tipoasiento,
ho.aniomes

Having Sum(debe)+Sum(Haber)-isnull(isnull((Select sum(BaseContable) 
from compProvItems i
inner join Detalle_Operaciones d
on i.idtransaccion=d.idtransaccion 
where idOperacion=ho.idOPeracion and idtipotransaccion=1 and cuenta=@Cuenta),
(Select sum(Neto) 
from compFondosItems i
inner join Detalle_Operaciones d
on i.idtransaccion=d.idtransaccion 
where idOperacion=ho.idOPeracion and idtipotransaccion=3 and cuentaneto=@Cuenta)),0)<>0 or @SN='N'

order by ho.aniomes



GO
/****** Object:  StoredProcedure [dbo].[ControlMovimientosStock]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



--Select * from tiposMovimientoStock

CREATE        Procedure [dbo].[ControlMovimientosStock] 
(
		@fDesde				char(8)='',
		@fHasta				char(8)='20140630',
		@aDesde				char(15)='704391',
		@aHasta				char(15)='704391',
--		@Serie				char(10)='',
		@PartNumber			VARchar(20)='',
		@idObra				VARchar(20)='',
		@idMatricula		int=0,
		@tipomovimiento		int=0
)
as

Select ho.idOperacion,isnull(fechaDOS,ho.fecha) Fecha,ho.observacion,ho.observacioncomprobante,
a.articulo,a.Notas,a.descripcion,case when ea.tipomovimiento between 14 and 15 then 0 else ea.stock end cantidad, isnull(d.Descripcion,c.razonsocial) dDeposito,
isnull(d.Descripcion,c.razonsocial) dDeposito2,
case when ea.tipomovimiento between 14 and 15 then 'Transferencia entre Depositos' else t.descripcion end tMov,
case when ea.tipomovimiento<>14 and ea.tipomovimiento<>15 then 0 else ea.Cantidad*signo end transferido,signo,
isnull(hms.idObra,ea.idObra) idObra, desvia, docum, isnull(fcprov,fcproveedor) fcproveedor, oCompra, TipoMovimiento, Matricula, case when ea.tipoMovimiento=23 then cantidad else 0 end cPO, ea.idcampo
from estadisticaarticulos ea
left join Depositos d
on ea.Deposito=d.idDeposito
left join Clientes c
on ea.deposito=c.codigo
inner join tiposMovimientoStock t
on ea.tipomovimiento=t.idTipomovimientoStock
inner join Articulos a
on ea.idarticulo=a.idarticulo
left join Header_operaciones ho
on ho.idoperacion=ea.idoperacion
left join HeaderMovimientosStock hms
on ho.idOperacion=hms.idOperacion
Left join Matriculas mat
on ea.idmatricula=mat.idMatricula

where ea.tipomovimiento<>11 and isnull(FechaDOS,ho.fecha) between @fDesde and @fHasta
--and tipomovimiento<>15
and (a.Articulo>=@aDesde or @aDesde='')
and (a.Articulo<=@aHasta or @aHasta='')
and (ea.idMatricula=@idMatricula or @idMatricula=0)
and (a.Notas=@PartNumber or @PartNumber='')
and ((isnull(hms.idObra,ea.idObra)=@idObra and isnull(fechaDOS,ho.fecha)>'20040101')or @idObra=0)
and (ea.tipomovimiento=@TipoMovimiento or @tipomovimiento=0)

Union

Select 0,@Fdesde,'Stock Inicial','Acumulado',@aDesde,'','',(Select dbo.StockaFecha(idArticulo,@fDesde)),'',
'','Stock Inicio',0,0,0,'','','','','','',0,0 idcampo
from articulos where articulo=@aDesde and @fDesde<>'' and @aDesde=@aHasta

order by ea.idcampo

--Select dbo.StockaFecha('700001','20090601')




GO
/****** Object:  StoredProcedure [dbo].[ControlMuni]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create Procedure [dbo].[ControlMuni]
as
Select sc.socio,sc.apellido,sc.nombre
 from 
Detalle_Operaciones do

inner join aplicacionesCuentasCorrientes acc
on do.idtransaccion=acc.idtransaccion
inner Join CuentasCorrientes cc
on cc.idtransaccion=acc.idtransaccionCancelada
inner Join Socios sc
on cc.socio=sc.socio
where idOperacion=19525
and documentoNumero=200305


GO
/****** Object:  StoredProcedure [dbo].[ControlResumen]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO







CREATE Procedure 
[dbo].[ControlResumen] /*0,200304,'20030430'*/(@Tipo int,@Periodo int,@Fecha datetime)
/*
	Tipos de Asientos
	0. Cobranzas Ventanilla
	1. Cobranzas (Cobradores)}
	2. Rendiciones Colegios
*/

As

declare @AsientoCierre int
Declare @Table char(11)
 
	Select @AsientoCierre=isnull((Select asientoDiario from header_Operaciones 
	where aniomes=@Periodo and tipodeOperacion=case @Tipo
							when 2 then 220 
							when 3 then 230 
							when 6 then 260 end
							and tipoasiento=0),0)
--	if @AsientoCierre=0
--			select @Table='as_' + cast(@Tipo as char(1)) + '_'+cast(@Periodo as char(6))
--			Execute getNextIdentity @Table, @Value=@asientoCierre Output

	Select @AsientoCierre as Asiento,0 as item,@Periodo as Aniomes,
	0 as tipoasiento,ai.cuenta,sum(debe),sum(haber),'' as observacion,isnull(ai.Centrocosto,1) as centrocosto
	from asientosDiariosItems ai 
	inner Join AsientosDiariosHeader ah on 
	ah.asiento=ai.asiento and ah.aniomes=ai.aniomes
	and ah.tipoasiento=ai.tipoasiento
	inner Join header_Operaciones ho on 
	ai.asiento=ho.asientodiario and 
	ai.tipoasiento=ho.tipoasiento and 
	ai.aniomes=ho.aniomes 

	where 
	ho.aniomes=@Periodo
	and (ho.tipoasiento=@Tipo and tipodeOperacion<200)
	and Haber=0		
	Group by ai.cuenta,isnull(ai.Centrocosto,1)
	having round(sum(debe)+sum(haber),2)<>0

	union

	Select @AsientoCierre as Asiento,0 as item,@Periodo as Aniomes,
	0 as tipoasiento,ai.cuenta,sum(debe),sum(haber),'' as observacion,isnull(ai.Centrocosto,1) as centrocosto
	from asientosDiariosItems ai 
	inner Join AsientosDiariosHeader ah on 
	ah.asiento=ai.asiento and ah.aniomes=ai.aniomes
	and ah.tipoasiento=ai.tipoasiento
	inner Join header_Operaciones ho on 
	ai.asiento=ho.asientodiario and 
	ai.tipoasiento=ho.tipoasiento and 
	ai.aniomes=ho.aniomes 

	where 
	ho.aniomes=@Periodo
	and (ho.tipoasiento=@Tipo and tipodeOperacion<200)
	and Debe=0		
	Group by ai.cuenta,isnull(ai.Centrocosto,1)
	having round(sum(debe)+sum(haber),2)<>0


GO
/****** Object:  StoredProcedure [dbo].[cpAltas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE  Procedure [dbo].[cpAltas] -- cpAltas '20060101','20060201',60,1
(
	@Inicio char(8)='20060201',
	@Cierre char(8)='20060301',
	@Cobertura char(3)=150,
	@Entidad Char(1)=1
)
as
(select @Entidad,@inicio,ad.adherente,ad.cobrador,ad.grupo,@Cobertura
--,ad.adherente,ad.apellido,ad.nombre,ad.cobrador,@Cobertura Cobertura,FechaVigencia,cb.nombre
from conceptos_Adherentes ca 
inner join conceptos co1 on ca.concepto=co1.concepto
inner join Adherentes ad on ca.adherente=ad.adherente
inner join cobradores cb
on ad.cobrador=cb.cobrador
where (ca.FechaVigencia>@Inicio and FechaVigencia<=@Cierre)
and  co1.Cobertura=@Cobertura and @Entidad=1)
union

(select @Entidad,@inicio,ad.socio,ad.cobrador,ad.grupo,@Cobertura
--@Inicio,@Cierre,ad.socio,ad.apellido,ad.nombre,ad.cobrador,@Cobertura Cobertura,'',cb.nombre 
from socios ad 
inner join cobradores cb on ad.cobrador=cb.cobrador
where 
(
(
(Select count(*) from conceptos_Socios ca 
inner join conceptos co1 on ca.concepto=co1.concepto
where  @Entidad=0 and (ca.fechabaja is null or ca.fechabaja > @Cierre) and ca.FechaVigencia <= @Cierre
and  co1.Cobertura=@Cobertura and ad.socio=ca.socio)>0)
) 
and 
(
(Select count(*) from conceptos_Socios ca 
inner join conceptos co1 on ca.concepto=co1.concepto
where (ca.fechabaja is null or ca.fechabaja > @Inicio) and ca.FechaVigencia <= @Inicio
and co1.Cobertura=@Cobertura and ad.socio=ca.socio)=0)
)


GO
/****** Object:  StoredProcedure [dbo].[cpBajas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[cpBajas] -- cpBajas 20060201,20060301,150,1
(
	@Inicio char(8)='20060201',
	@Cierre char(8)='20060301',
	@Cobertura char(3)=150,
	@Entidad char(1)=1
)
as
(select @Inicio,@Cierre,ad.Adherente,ad.apellido,ad.nombre,ad.cobrador,@Cobertura Cobertura,mb.nombre,cb.nombre,cb.[global]
from conceptos_Adherentes ca 
inner join conceptos co1 on ca.concepto=co1.concepto
inner join adherentes ad on ca.adherente=ad.adherente
inner join motivosBaja mb on ca.motivoBaja=motivo
inner join cobradores cb on ad.cobrador=cb.cobrador
where (ca.FechaBaja Between  @Inicio and @Cierre) and  co1.Cobertura=@Cobertura and @Entidad=1)
Union
(select @Inicio,@Cierre,ad.socio,ad.apellido,ad.nombre,ad.cobrador,@Cobertura Cobertura,(
Select Distinct Mb.nombre
from conceptos_Socios ca 
inner join conceptos co1 on ca.concepto=co1.concepto
inner join motivosBaja mb
on ca.motivoBaja=motivo
where (ca.fechabaja is null or ca.fechabaja > @Inicio) and ca.FechaVigencia <= @Inicio
and  co1.Cobertura=@Cobertura and ad.socio=ca.socio

),cb.nombre,cb.[global]
from socios ad 
inner join cobradores cb on ad.cobrador=cb.cobrador
where @Entidad=0 and 
((
(Select count(*) from conceptos_Socios ca inner join conceptos co1 
on ca.concepto=co1.concepto
where (ca.fechabaja is null or ca.fechabaja > @Cierre) and ca.FechaVigencia <= @Cierre
and  co1.Cobertura=@Cobertura and ad.socio=ca.socio)=0)
) and 
(
(Select count(*) from conceptos_Socios ca inner join conceptos co1 
on ca.concepto=co1.concepto
where (ca.fechabaja is null or ca.fechabaja > @Inicio) and ca.FechaVigencia <= @Inicio
and  co1.Cobertura=@Cobertura and ad.socio=ca.socio)>0)
)




GO
/****** Object:  StoredProcedure [dbo].[CreaA0ObrasCerradas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE Procedure [dbo].[CreaA0ObrasCerradas]
	@idObra	int=0,
	@Cierre	varchar(8)='20110228',
	@Desde	varchar(8)='',
	@Hasta	varchar(8)='',
	@TC		numeric(18,2)=4.24,
	@TCAnt		numeric(18,2)=4.24,
	@AL		varchar(1)='A'
as

if (SELECT COUNT(*) FROM INFORMATION_SCHEMA.TABLES 
        WHERE TABLE_TYPE = 'BASE TABLE' 
        AND TABLE_NAME = 'BaseCierre')=1
Drop table BaseCierre

if (SELECT COUNT(*) FROM INFORMATION_SCHEMA.TABLES 
        WHERE TABLE_TYPE = 'BASE TABLE' 
        AND TABLE_NAME = 'AsientoCierreObrasTemp')=1
Drop table AsientoCierreObrasTemp

Select case when ea.tipoMovimiento=22 then 0 else 1 end Modo,ea.idcampo idCampoEA,
a.notas,a.articulo,ea.docum,isnull(fechaDos,ho.fecha) fecha,substring(a.descripcion,1,19) descripcion,
ea.cantidad*ts.Signo*-1 Cantidad,case when ea.tipomovimiento=22 then ea.cantidad else isnull(bi.precio,a.precio) end precio,
case when ea.tipomovimiento=22 then ea.cantidad else ea.cantidad*isnull(bi.precio,a.precio)*ts.Signo*-1 end subtotalDolares,
case when ea.tipomovimiento=22 then ea.cantidad else ea.cantidad*isnull(bi.precio,a.precio)*ts.Signo*-1*
case when substring(@Cierre,1,6)=dbo.toaniomes(isnull(fechaDos,ho.fecha)) then @TC else @TCAnt end end Pesos,
ea.tipomovimiento,isnull(ea.idObra,hm.idobra) idobra,
cl.razonSocial,
ea.idProveedor,ea.fcProv,
ho1.fecha fechaFc,right(vch1.nrocomprobante,8) + ' ' +  vch1.tipofactura Observacion,ea.idcampoAnexo,mt.idcampo, mt.idoperacion,pv.razonsocial RazonSocialProveedor,nombreAvion,mat.matricula,
0 as tabla, FecFactura,nroFactura,
case when ea.tipoMovimiento=22 then 0 else case when substring(@Cierre,1,6)=dbo.toaniomes(isnull(fechaDos,ho.fecha)) then @TC else @TCAnt end  end Cambio
into BaseCierre

from EstadisticaArticulos ea
left join headerMovimientosStock hm
on ea.idoperacion=hm.idoperacion
left join Header_operaciones ho 
on hm.idOperacion=ho.idoperacion
inner join tiposMovimientoStock t
on ea.tipomovimiento=t.idtipoMovimientoStock
left join Articulos a
on ea.idArticulo=a.idArticulo
left join baseinventarios bi
on a.idarticulo=bi.idarticulo and substring(@Cierre,1,6) between vigenciadesde and vigenciaHasta
inner join cuentas ct
on ct.cuenta=132000
left join anexoMateriales mt 
on ea.idcampoanexo=mt.idcampo and mt.partNumber=ea.articuloProveedor and mt.idOperacion is not null
left join Header_operaciones ho1
on mt.idOPeracion=ho1.idoperacion
left join detalle_operaciones do1
on ho1.idoperacion=do1.idoperacion and idtipotransaccion=0
left join vencliheader vch1
on do1.idtransaccion=vch1.idtransaccion and vch1.fecha<@Cierre
inner join obras o
on isnull(ea.idObra,hm.idobra)=o.idObra
inner join clientes cl
on o.idcliente=cl.codigo
left join proveedores pv
on ea.idproveedor=pv.codigo
inner join tiposMovimientoStock ts
on ea.tipoMovimiento=ts.idtipomovimientoStock
inner join matriculas mat
on o.idmatricula=mat.idmatricula
where --isnull(fechaDos,ho.fecha)<=@Cierre and isnull(ea.fecfactura,'29001231')>@Cierre and 
(tipoMovimiento=4 or TipoMovimiento=9 or TipoMovimiento=22)
and (@idObra=0 or o.idObra=@idOBra)
-- and o.cierre is null
and year(FecFactura)=year(@Cierre) and month(FecFactura)=month(@Cierre)
-- and case when @Hasta='' then '29000101' else @Hasta end 

union 

Select 
0 Modo,cph.idtransaccion idCampoEA,
'' notas,'' articulo,0 docum,ho.fecha fecha,'' descripcion,
1 Cantidad,cpi.importe precio,0 subtotalDolares,
tmh.Multiplicador*cpi.importe*case when moneda=1 then TC else 1 end Pesos,
cph.tipoComprobante tipomovimiento,cpi.area idobra,
cl.razonsocial razonSocial,
isnull(pv.codigo,pf.proveedor) idproveedor,right(cph.nroComprobante,8) nrocomprobante,
cph.fecha fechaFc,'' Observacion,0 idcampoAnexo,0 idcampo, 0 idoperacion,
isnull(pv.razonSocial,pf.razonsocial) razonSocialProveedor,nombreAvion,mat.matricula, 1 as tabla,
FechaCierre,factura,1 Cambio


from header_operaciones ho 
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion 
inner join CompProvHeader cph
on do.idtransaccion=cph.idtransaccion 
inner join tipCompModHeader tmh 
on cph.tipoComprobante=tmh.codigo
inner join compProvItems cpi
on cph.idtransaccion=cpi.idtransaccion 
left join proveedores pv
on cph.proveedor=pv.codigo
left join provFondo pf
on cph.proveedor=pf.proveedor
inner join obras o
on cpi.area=o.idObra
inner join clientes cl
on o.idcliente=cl.codigo
inner join matriculas mat
on o.idmatricula=mat.idmatricula
where idtipotransaccion=1 
-- and ho.fecha<=@Cierre and isnull(cpi.FechaCierre,'29001231')>@Cierre
and (@idObra=0 or cpi.Area=@idOBra)
and year(cpi.FechaCierre)=year(@Cierre) and month(cpi.FechaCierre)=month(@Cierre)
and ho.fecha between case when @Desde='' then '19000101' else @Desde end 
and case when @Hasta='' then '29000101' else @Hasta end 
AND cpi.cuenta=132000
union 
Select 
0 Modo,cph.idtransaccion idCampoEA,
'' notas,'' articulo,0 docum,ho.fecha fecha,'' descripcion,
1 Cantidad,cpi.importe precio,0 subtotalDolares,
tmh.Multiplicador*cpi.importe Pesos,
cph.tipoComprobante tipomovimiento,cpi.area idobra,
cl.razonSocial,
isnull(pv.codigo,pf.proveedor) idproveedor,right(cph.nroComprobante,8) nrocomprobante,
cph.fecha fechaFc,'' Observacion,0 idcampoAnexo,0 idcampo, 0 idoperacion,
isnull(pv.razonSocial,pf.razonsocial) razonSocialProveedor,nombreAvion,mat.matricula, 2 as tabla,FechaCierre,factura,
0 Cambio
from header_operaciones ho 
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion 
inner join CompFondosHeader cph
on do.idtransaccion=cph.idtransaccion 
inner join tipCompModHeader tmh 
on cph.tipoComprobante=tmh.codigo
inner join compFondosItems cpi
on cph.idtransaccion=cpi.idtransaccion 
left join proveedores pv
on cph.proveedor=pv.codigo
left join provFondo pf
on cph.proveedor=pf.proveedor
inner join obras o
on cpi.area=o.idObra
inner join clientes cl
on o.idcliente=cl.codigo
inner join matriculas mat
on o.idmatricula=mat.idmatricula
where idtipotransaccion=3 
--and ho.fecha<=@Cierre and isnull(cpi.FechaCierre,'29001231')>@Cierre
and (@idObra=0 or cpi.Area=@idOBra)
and year(cpi.FechaCierre)=year(@Cierre) and month(cpi.FechaCierre)=month(@Cierre)
and ho.fecha between case when @Desde='' then '19000101' else @Desde end 
and case when @Hasta='' then '29000101' else @Hasta end 
AND cpi.cuentaneto=132000

Select Modo,idObra,
Case 
when nroFactura>200000 then nroFactura
when Modo=0 then 600000
when Modo=1 then 630000
end Cuenta, nroFactura, fecFactura,Precio, SubtotalDolares*Modo Dolares, 
Cantidad*Modo Cantidad,Pesos 
Into BaseCierrePaso01
from BaseCierre

Select Cuenta, cast(sum(Pesos) as numeric(18,2)) Debe,0 Haber Into AsientoCierreObrasCred 
from BaseCierrePaso01
Group by Cuenta

Select 132000 Cuenta,0 Debe, cast(sum(Debe)as numeric(18,2)) Haber Into AsientoCierreObrasDeb 
from AsientoCierreObrasCred

Select 0 Orden,* 
into AsientoCierreObrasTemp 

from AsientoCierreObrasDeb
Union
Select 1 ,* from AsientoCierreObrasCred

Drop table BaseCierrePaso01
Drop table AsientoCierreObrasCred
Drop table AsientoCierreObrasDeb
Drop Table BaseCierre






GO
/****** Object:  StoredProcedure [dbo].[CrmFacturaElectronica]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


-- Select * from DatosVenta

-- HeaderFactura 12770

CREATE Procedure [dbo].[CrmFacturaElectronica] 
(
	@idOperacion	int=0,
	@Desde		Char(8)='20110301',
	@Hasta		Char(8)='20110331',
	@idCliente	int=0,
	@idArticulo	int='0',
	@nroDesde	int=0,
	@nroHasta	int=0

)
as
Declare @sqlString nvarchar(4000)

Select @sqlString='Select distinct vh.idtransaccion,
case when tipodeOperacion between 44 and 45 then "FACTURA"
 when tipodeOperacion=46 then "NOTA DE CREDITO"
when tipodeOperacion=47	 then "NOTA DE DEBITO"
 when tipodeOperacion=49 then "FACTURA"
else "" end Comprobante,
ho.idOperacion,ho.fecha,ho.observacionComprobante,
cl.codigo,cl.domicilio, substring(vh.nrocomprobante,1,4)
pv,substring(vh.nrocomprobante,5,8) numero ,ho.comprobantenumero,
vh.totalimporte,descripcionImporte,localidad,pv.descripcion Provincia,
tipofactura, fecha1Venc vto, Leyenda,codigopostal,
Case when Vh.tc<>1 then "Forma de Pago: en pesos al cambio dolar libre tipo vendedor del dia anterior al dia de pago." else "" end FContab,
Case when Vh.tc<>1 then "Nota: Al solo efecto de registro del Iva " else "" end FContab1,
Case when dv.MO=1 and dv.Taxi=1 then "Nota: Mano de obra por trabajos realizados, operacion exenta segun apartado 28 inc h), articulo 6 Ley 23349 y modificatorias." else "" end Taxi,
Case when Vh.tc<>1 then "T. C. $" + replace(cast(vh.tc as varchar(7)),".",",") + " - TOTAL " + case when tipodeOperacion between 44 and 45 then "FACTURA"
 when tipodeOperacion=46 then "NOTA DE CREDITO"
when tipodeOperacion=47	 then "NOTA DE DEBITO"
 when tipodeOperacion=49 then "FACTURA"
else "" end + " $ " + replace(cast(vh.totalimporte as varchar(12)),".",",") else "" end FContab2,
case when isnull(dv.idObra,0)<>0 then "Por los trabajos realizados en vuestro avion " + ltrim(rtrim(mt.nombreAvion)) + ", matricula " + ltrim(rtrim(mt.matricula)) else "" end Header
, isnull(dv.idObra,0) idObra, cuit, vh.Moneda, Dias, fecha1Venc, ci.descripcion dCiva,
case when vh.moneda=0 then "$" else "u$s" end Signo, isnull(dv.idObra,0) idObra,dv.Coeficiente,isnull(MO,0) MO,isnull(MAT,0) Mat,
case when tipodeOperacion between 44 and 45 then "FC"
when tipodeOperacion=46 then "NC"
when tipodeOperacion=47	then "ND"
when tipodeOperacion=49 then "FC"
else "" end tComprobante,
case when len(ltrim(rtrim(isnull(cl.adicional,""))))>0 then RazonSocial else "" end as RazonSocial,
case when len(ltrim(rtrim(isnull(cl.adicional,""))))=0 then RazonSocial else cl.adicional end as adicional,
case when len(ltrim(rtrim(codigopostal)))>0 then ltrim(rtrim(CodigoPostal)) + " - " + localidad else localidad end cposloc,
CAE,el.vencimiento Vencimiento_CAE

from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join VenCliheader vh
on do.idtransaccion=vh.idtransaccion
inner join clientes cl 
on vh.cliente=cl.codigo
inner join EstadisticaArticulos ea
on do.idOperacion=ea.idOperacion
left join provincias pv
on cl.idprovincia=pv.provincia
inner join DatosVenta dv
on ho.idOPeracion=dv.idOperacion
Left join Leyendas l
on dv.idLeyenda=l.idLeyenda
left join Obras ob
on dv.idObra=ob.idObra
left join Matriculas mt 
on ob.idMatricula=mt.idmatricula
left join categorias_Iva ci
on ci.idciva=cl.civa
left join electronicos el
on do.idOperacion=el.idOperacion_Origen


where idTipoTransaccion=0 '
if @idOperacion<>0
	Select @sqlString=@sqlString + '
and ho.idOperacion=' + cast(@idOperacion as char(6)) 

if @Desde<>""
	Select @sqlString=@sqlString + 
' and ho.Fecha>="' + @Desde + '"'

if @Hasta<>""
	Select @sqlString=@sqlString + 
' and ho.Fecha<="' + @Hasta + '"'

if @idCliente<>0
	Select @sqlString=@sqlString + 
' and cl.codigo=' + cast(@idCliente as char(10)) 

if @idArticulo<>0
	Select @sqlString=@sqlString + 
' and ea.idArticulo=' + cast(@idArticulo as char(8)) 

if @nroDesde<>0
	Select @sqlString=@sqlString + 
' and Substring(nroComprobante,5,8)>=' + cast(@nroDesde as char(8)) 

if @nroHasta<>0
	Select @sqlString=@sqlString + 
' and Substring(nroComprobante,5,8)<=' + cast(@nroHasta as char(8)) 

	Select @sqlString=@sqlString + 'Order by ho.idOperacion '

exec sp_executesql @sqlString

















GO
/****** Object:  StoredProcedure [dbo].[ctacte]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE procedure [dbo].[ctacte]
as
Select numedocto,apellido,nombre,socio,Grupo,isnull(dbo.saldo(socio,Getdate()),0) saldo 
,
case when isnull(DomicilioPrincipal,'P')='P' then Domicilio else Domicilio_consultorio end,
case when isnull(DomicilioPrincipal,'P')='P' then Localidad else Localidad_consultorio end,
case when isnull(DomicilioPrincipal,'P')='P' then cpostal else cpostal_consultorio end,
p.Descripcion,telefono,telefono_consultorio,email
from socios s
left join provincias p 
on s.provincia=p.provincia
where grupo not in ('R','F','M','B')
and apellido not in ('.                                       ')
order by apellido,nombre
/*
Select * from socios where apellido like 'BAUMANN'

Select * from cuentascorrientes 
where socio=5157
order by fecha desc
/*
Update cuentascorrientes 
set importe=0
where idtransaccion=620896437
*/
*/
GO
/****** Object:  StoredProcedure [dbo].[ctacteafecha]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE procedure [dbo].[ctacteafecha]
(
	@fecha varchar(8) = '20240801'
)
as
Select numedocto,apellido,nombre,socio,Grupo,isnull(dbo.saldoafecha(socio,@fecha),0) saldo 
,
case when isnull(DomicilioPrincipal,'P')='P' then Domicilio else Domicilio_consultorio end,
case when isnull(DomicilioPrincipal,'P')='P' then Localidad else Localidad_consultorio end,
case when isnull(DomicilioPrincipal,'P')='P' then cpostal else cpostal_consultorio end,
p.Descripcion,telefono,telefono_consultorio,email
from socios s
left join provincias p 
on s.provincia=p.provincia
where grupo not in ('R','F','M','B')
and apellido not in ('.                                       ')
order by apellido,nombre
/*
Select * from socios where apellido like 'BAUMANN'

Select * from cuentascorrientes 
where socio=5157
order by fecha desc
/*
Update cuentascorrientes 
set importe=0
where idtransaccion=620896437
*/
*/
GO
/****** Object:  StoredProcedure [dbo].[CtasCtes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE procedure [dbo].[CtasCtes]
as

Select socio,Grupo,gdesde, numedocto documento,ltrim(rtrim(apellido)) apellido,ltrim(rtrim(nombre)) nombre,
tarjeta, ltrim(rtrim(isnull(t.Descripcion,'s/debito'))) formapago,
isnull(dbo.saldo(socio,Getdate()),0) saldo,
residente,
case when tarjeta in (1,2) then isnull((select sum(importe-Cancelado) 
from cuentascorrientes where concepto in ('RDA') and cancelado=0 and socio=s.socio and entidad=0),0) else 0 end rechazos,
ltrim(rtrim(case when isnull(DomicilioPrincipal,'P')='P' then Domicilio else Domicilio_consultorio end)) domicilio,
ltrim(rtrim(case when isnull(DomicilioPrincipal,'P')='P' then Localidad else Localidad_consultorio end)) localidad,
ltrim(rtrim(case when isnull(DomicilioPrincipal,'P')='P' then cpostal else cpostal_consultorio end)) cpostal,
ltrim(rtrim(p.Descripcion)) provincia,ltrim(rtrim(telefono)) telefono_particular,
ltrim(rtrim(telefono_consultorio)) telefono_consultorio,
ltrim(rtrim(email)) email

from socios s
left join provincias p 
on s.provincia=p.provincia
left join tarjetas t 
on s.Tarjeta=t.idTarjeta
where grupo not in ('R','F','M','B')
-- and grupo in ('T','H','V')
-- and residente=1
/* and tarjeta in (1,2)
and residente=1
*/
and apellido not in ('.                                       ')
order by apellido,nombre
GO
/****** Object:  StoredProcedure [dbo].[Cursos_alumnos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE  Procedure [dbo].[Cursos_alumnos]
(
	@idAlumno	int
)
as
Select  l.idHorario,n.descripcion,fechainscripcion,matricula,l.cuotas,importecuotas,observaciones,fechabaja,idCampo
from listas l 
inner join horarios h
on h.idHorario=l.idHorario
inner join NominaCursos n
on h.idCurso=n.idCurso
where idAlumno=@idAlumno








GO
/****** Object:  StoredProcedure [dbo].[datosDespacho]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO





CREATE      Procedure [dbo].[datosDespacho]
(
	@idArticulo	int=716,
	@Serial		varchar(15)='0700453290'
)
as
Select d.fecha,ad.descripcion aduana,pc.descripcion procedencia, d.despacho,awb
from estadisticaarticulos ea
left join HeadermovimientosStock do 
on ea.idOPeracion=do.idoperacion
inner join articulos a
on ea.idarticulo=a.idarticulo
inner join despachos d
on d.iddespacho=do.iddespacho
left join aduanas ad
on d.idaduana=ad.idaduana
left join Procedencias pc
on d.idprocedencia=pc.idprocedencia
left join despachantes dp
on d.iddespachante=dp.iddespachante 
where ea.idArticulo=@idArticulo and ea.Serial=@Serial
and d.fecha is not null

GO
/****** Object:  StoredProcedure [dbo].[DatosItemsWSex]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE procedure [dbo].[DatosItemsWSex]
(
	@idtransaccion int=105797
) as
Select a.articulo,a.descripcion,ea.cantidad,eap.unitario from estadisticaArticulos ea
inner join detalle_operaciones do 
on ea.idOperacion=do.idOperacion
inner join articulos a
on ea.idarticulo=a.idarticulo
inner join estadisticaarticulosPrecios eap 
on ea.idcampo=eap.idcampo
where idtransaccion=@idtransaccion
and idtipotransaccion=0
GO
/****** Object:  StoredProcedure [dbo].[DatosWSEV1]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[DatosWSEV1] (
	@idtransaccion int=105747
)
as
Select vch.idtransaccion,replace(Cuit,'-','') cuit,do.idoperacion,
-- Controlar si tipo_cbte o Punto_vta=999
case when tipofactura='A' then wsa when tipofactura='B' then wsb when tipofactura='C' then wsc when tipofactura='E' then WSE else 999 end tipo_cbte,
case when tipofactura in ('A','B','C') then 4 when tipoFactura='E' then 5 else 999 end punto_vta,
case when moneda=0 then 'PES' else 'DOL' end Moneda,
case when moneda=0 then totalimporte else importeOrigen end TotalComprobante,
isnull((Select Alicuota from Vencliitems where idtransaccion=vch.idtransaccion and concepto='IVA'),0) Alicuota_iva,
isnull((Select importe from Vencliitems where idtransaccion=vch.idtransaccion and concepto='IVA'),0) iva,
isnull((Select Alicuota from Vencliitems where idtransaccion=vch.idtransaccion and concepto='PIB'),0) Alicuota_Pib,
isnull((Select importe from Vencliitems where idtransaccion=vch.idtransaccion and concepto='PIB'),0) PIB,
isnull(CAE,'') CAE, tc, vch.Fecha1venc vencimiento,
Case when Exists (Select *
From EstadisticaArticulos vi
inner join articulos ar
on vi.idarticulo=ar.idarticulo
where idoperacion=do.idoperacion
and ar.descripcion like 'Material%'
) then 2 else 0 end +
Case when Exists (Select *
From EstadisticaArticulos vi
inner join articulos ar
on vi.idarticulo=ar.idarticulo
where idoperacion=do.idoperacion
and ar.descripcion not like 'Material%'
) then 1 else 0 end Concepto

from vencliheader vch
inner join tipVentModHeader t
on vch.tipocomprobante=t.codigo
inner join Detalle_Operaciones do 
on vch.idtransaccion=do.idtransaccion and do.idtipotransaccion=0
inner join clientes cl
on vch.cliente=cl.codigo
left join electronicos el 
on do.idoperacion=el.idOperacion_origen
where vch.idtransaccion=@idtransaccion






GO
/****** Object:  StoredProcedure [dbo].[DatosWSEX]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[DatosWSEX] (
	@idtransaccion int=105797
)
as
Select vch.idtransaccion,replace(cl.Cuit,'-','') cuit,RazonSocial,Domicilio,TC,
-- Controlar si tipo_cbte o Punto_vta=999
case when tipofactura='A' then wsa when tipofactura='B' then wsb when tipofactura='E' then WSE else 999 end tipo_cbte,
case when tipofactura='A' or tipoFactura='B' then 4 when tipoFactura='E' then 5 else 999 end punto_vta,
case when moneda=0 then 'PES' else 'DOL' end Moneda,
case when moneda=0 then totalimporte else importeOrigen end TotalComprobante,
isnull((Select Alicuota from Vencliitems where idtransaccion=vch.idtransaccion and concepto='IVA'),0) Alicuota_iva,
isnull((Select importe from Vencliitems where idtransaccion=vch.idtransaccion and concepto='IVA'),0) iva,
isnull((Select Alicuota from Vencliitems where idtransaccion=vch.idtransaccion and concepto='PIB'),0) Alicuota_Pib,
isnull((Select importe from Vencliitems where idtransaccion=vch.idtransaccion and concepto='PIB'),0) PIB,
ID_FacturaElectronica,tipocuenta,codigoCuit

from vencliheader vch
inner join tipVentModHeader t
on vch.tipocomprobante=t.codigo
inner join clientes cl
on vch.cliente=cl.codigo
left join Paises p
on cl.idpais=p.idpais
left join cuilsfe cf
on cf.tipocuit=cl.tipocuenta and ID_FacturaElectronica=cf.paisfex
where idtransaccion=@idtransaccion





GO
/****** Object:  StoredProcedure [dbo].[DebitoAutomatico]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[DebitoAutomatico] (-- DebitoAutomatico 1,200307
	@Tarjeta	int,
	@Periodo	int
)
as
(
Select pt.tarjeta, pt.periodo, pt.socio, pt.entidad
,case when modo='D' then round(pt.importe/2,2)
     else pt.importe end as Importe, cc.idtransaccion,cc.cancelado
from  presentaciones pt
Left join compTarjetas tj
on pt.socio=tj.socio and pt.Entidad=tj.Entidad and pt.periodo=tj.periodo
left join CuentasCorrientes cc
on cc.entidad=pt.entidad and cc.socio=pt.socio and cc.documentonumero=pt.Periodo
Where pt.Periodo=@Periodo and pt.tarjeta=@Tarjeta
and isnull(tj.modo,'N')<>'R' and cc.concepto='MES'
)
Union
(
Select pt.tarjeta,tj.aniomes,pt.socio,pt.entidad
 ,case when modo='D' then round(pt.importe/2,2)
     else pt.importe end as Importe, cc.idtransaccion,cc.cancelado
from  presentaciones pt
Left join compTarjetas tj
on pt.socio=tj.socio and pt.Entidad=tj.Entidad and pt.periodo=tj.periodo
Left join CuentasCorrientes cc
on cc.entidad=pt.entidad and cc.socio=pt.socio and cc.documentonumero=tj.Aniomes
Where pt.Periodo=@Periodo and pt.tarjeta=@Tarjeta
and isnull(tj.modo,'N')='D' and cc.concepto='MES'
)
order by pt.entidad, pt.socio


GO
/****** Object:  StoredProcedure [dbo].[Desaplica_Rendicion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE Procedure [dbo].[Desaplica_Rendicion](@idtransaccionMes int, @idtransaccionRen int)
as
Update CuentasCorrientes
set cancelado=(
select (isnull((Select Sum(importe) from aplicacionesCuentasCorrientes 
where idtransaccioncancelada=@idtransaccionMes and idtransaccion<>@idtransaccionRen),0))
)
where idtransaccion=@idtransaccionMes

Delete from CuentasCorrientes 
where idtransaccion=@idtransaccionRen

Insert into Detalle_Operaciones 
Select idOperacion,10 as idTipotransaccion,idtransaccion,itemdiario from Detalle_Operaciones
where idtipotransaccion=0 and idTransaccion=@idtransaccionRen

Delete from Detalle_Operaciones 
where idtipotransaccion=0 and idTransaccion=@idtransaccionRen

Insert Into AplicacionesCuentasCorrientesAnuladas
Select * from AplicacionesCuentasCorrientes 
where idtransaccion=@idtransaccionRen and idtransaccionCancelada=@idtransaccionMes

Delete from AplicacionesCuentasCorrientes 
where idtransaccion=@idtransaccionRen and idtransaccionCancelada=@idtransaccionMes



GO
/****** Object:  StoredProcedure [dbo].[Detalle_Debitos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE    Procedure [dbo].[Detalle_Debitos]

@N_Tarjeta int
AS
(
SELECT 	Adherentes.Adherente AS Socio, 
	'Foprosa' as Entidad, 
	Adherentes.Apellido, 
	Adherentes.nombre, 
	Conceptos_adherentes.Concepto  as Concepto, 
	Conceptos.Descripcion, 
	Conceptos.Importe
FROM	Adherentes 
	INNER JOIN Conceptos_adherentes 
		ON Adherentes.Adherente = Conceptos_adherentes.Adherente 
	INNER JOIN Conceptos 
		ON Conceptos_adherentes.Concepto = Conceptos.Concepto
where adherentes.tarjeta = @N_Tarjeta 
and conceptos.modalidad='I' 
and conceptos_adherentes.fechabaja is null
and (Adherentes.debitardesde is null or Adherentes.debitardesde<'20021201')
)
Union
(
SELECT 	Socios.Socio AS Socio, 
	'Socios' as Entidad, 
	Socios.Apellido, 
	Socios.nombre, 
	Conceptos_Socios.Concepto as Concepto, 
	Conceptos.Descripcion, 
	Conceptos.Importe
FROM Socios 
	INNER JOIN Conceptos_Socios 
		ON Socios.Socio = Conceptos_Socios.Socio 
	INNER JOIN Conceptos 
		ON Conceptos_Socios.Concepto = Conceptos.Concepto
where Socios.tarjeta= @N_Tarjeta 
and conceptos.modalidad='I' 
and conceptos_Socios.fechabaja is null 
and (socios.debitardesde is null or socios.debitardesde<'20021201')
)
order by entidad,concepto,apellido,nombre


GO
/****** Object:  StoredProcedure [dbo].[Detalle_ItemMayor]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO





CREATE Procedure [dbo].[Detalle_ItemMayor]
(
	@Asiento		int=172,
	@tipoAsiento	int=1,
	@Aniomes		int=200907,
	@Cuenta			int=112800,
	@DH				varchar(1)='D',
	@Apertura		numeric(18,2)=0
)
as
Select idtipotransaccion,ct.concepto Descripcion,ah.fecha Fecha,
right(ltrim(rtrim(replace(cph.nrocomprobante,' ',''))),8) nrocomprobante,isnull(cpi.basecontable,cph.totalimporte) Importe,
case when cph.proveedor<>211012 then isnull(p.razonsocial,p1.razonsocial) else isnull(p1.razonsocial,p.razonsocial) end rzProveedor,
ah.asientoInterno,ah.detalle,case when isnull(cpi.area,0)>1000 then cpi.area else 0 end as obra,t.Comprobante,
case ah.tipoasinterno 
when 0 then "AD"
when 1 then "CI"
when 10 then "RC"
when 2 then "CE"
	when 3 then "CP"
	when 4 then "VT"
	when 5 then "SS"
	when 6 then "TS"
end tipoasiento, ho.asientodiario, do.idtransaccion
from header_operaciones ho
inner join AsientosdiariosHeader ah
on ho.asientodiario=ah.asiento and ho.aniomes=ah.aniomes and ho.tipoasiento=ah.tipoasiento 
inner join Detalle_operaciones do 
on ho.idOPeracion=do.idoperacion 
inner join CompProvHeader cph
on do.idtransaccion=cph.idtransaccion 
inner join tipCompModHeader t
on cph.tipocomprobante=t.codigo
left Join cphVarios cphv
on cph.idtransaccion=cphv.idtransaccion
inner join CompProvItems cpi 
on cph.idtransaccion=cpi.idtransaccion
left join Conceptoscontables ct
on cpi.concepto=ct.concepto
left join proveedores p 
on isnull(cphv.codigo,cph.proveedor)=p.codigo
left join provFondo p1 
on isnull(cphv.codigo,cph.proveedor)=p1.proveedor
where asientoDiario=@Asiento
and ho.tipoasiento=@tipoasiento
and ho.aniomes=@Aniomes
and idtipotransaccion=1
and ((cpi.cuenta=@Cuenta or ct.cuenta=@Cuenta or cph.proveedor=@CUENTA) and @cuenta not between 112000 and 112999)
union
Select idtipotransaccion,ct.concepto Descripcion,ah.fecha Fecha,right(ltrim(rtrim(cph.nrocomprobante)),6) nrocomprobante,
isnull(cpi.Importe,cph.totalimporte) Importe,
case when cph.proveedor<>211012 then isnull(p.razonsocial,p1.razonsocial) else isnull(p1.razonsocial,p.razonsocial) end rzProveedor,
ah.asientoInterno,ah.detalle,0 obra,t.Comprobante,
case ah.tipoasinterno 
when 0 then "AD"
when 1 then "CI"
when 10 then "RC"
when 2 then "CE"
	when 3 then "CP"
	when 4 then "VT"
	when 5 then "SS"
	when 6 then "TS"
end tipoasiento, ho.asientodiario,do.idtransaccion
from header_operaciones ho
inner join asientosdiariosHeader ah 
on ho.asientodiario=ah.asiento and ho.aniomes=ah.aniomes and ho.tipoasiento=ah.tipoasiento
inner join Detalle_operaciones do 
on ho.idOPeracion=do.idoperacion 
inner join CompFondosHeader cph
on do.idtransaccion=cph.idtransaccion 
inner join tipCompModHeader t
on cph.tipocomprobante=t.codigo
inner join CompFondosItems cpi 
on cph.idtransaccion=cpi.idtransaccion
inner join Conceptoscontables ct
on cpi.concepto=ct.concepto
left join proveedores p 
on cph.proveedor=p.codigo
left join provFondo p1 
on cph.proveedor=p1.proveedor
where asientoDiario=@Asiento
and ho.tipoasiento=@tipoasiento
and ho.aniomes=@Aniomes
and idtipotransaccion=3
and ((ct.cuenta=@Cuenta or cph.proveedor=@CUENTA) and @cuenta not between 112000 and 112999)
and @Cuenta<>132000
union
Select idtipotransaccion,replace(ho.observacion,'Recibo No: ','') as Descripcion ,ah.fecha Fecha,
right(ltrim(rtrim(replace(ho.comprobanteNumero,' ',''))),8) nrocomprobante,cph.Importe,
'' rzProveedor,
ah.asientoInterno,ah.detalle,0 as obra,'' Comprobante,
case ah.tipoasinterno 
when 0 then "AD"
when 1 then "CI"
when 10 then "RC"
when 2 then "CE"
	when 3 then "CP"
	when 4 then "VT"
	when 5 then "SS"
	when 6 then "TS"
end tipoasiento, ho.asientodiario,do.idtransaccion
from header_operaciones ho
inner join AsientosdiariosHeader ah
on ho.asientodiario=ah.asiento and ho.aniomes=ah.aniomes and ho.tipoasiento=ah.tipoasiento 
inner join Detalle_operaciones do 
on ho.idOPeracion=do.idoperacion 
inner join ValoresTesoreria cph
on do.idtransaccion=cph.idtransaccion 
left join Conceptos_Tesoreria ct
on cph.idconcepto_Tesoreria=ct.idconcepto_Tesoreria
where asientoDiario=@Asiento
and ho.tipoasiento=@tipoasiento
and ho.aniomes=@Aniomes
and idtipotransaccion=2
and (ct.Imputacion_contable=@Cuenta)












GO
/****** Object:  StoredProcedure [dbo].[Detalle_OrdenProduccion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Procedure [dbo].[Detalle_OrdenProduccion]
(
	@OProduccion	int=33
)
as
Select * from OrdenesProduccion op 
inner join articulos ar
on op.idArticulo=ar.idarticulo
left join FormulasArticulos fa
on ar.idarticulo=fa.idarticulo
left join articulos arc
on fa.idComponente=arc.idarticulo
where idOPeracion=@OProduccion




GO
/****** Object:  StoredProcedure [dbo].[DetalleFactura]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO





CREATE     Procedure [dbo].[DetalleFactura] 
(
	@idOperacion	int=37151
)
as
Select ea.idoperacion,a.articulo,isnull(eadp.descripcion,a.descripcion) descripcion,ea.cantidad,ea.serial,eap.unitario,ea.cantidad*eap.unitario as parcial,oCompra,
case when vch.moneda=0 then '$' else 'u$s' end Signo, ea.articuloProveedor
 
from EstadisticaArticulos ea
inner join EstadisticaArticulosPrecios eap
on ea.idcampo=eap.idcampo
inner join Articulos a
on ea.idArticulo=a.idArticulo
left join EstadisticaArticulosDescripciones eadp
on ea.idcampo=eadp.idcampo
inner join Detalle_operaciones do 
on ea.idOperacion=do.idOperacion 
inner join venCliHeader vch
on do.idtransaccion=vch.idtransaccion

where ea.idOperacion=@idOperacion
and idtipotransaccion=0

Order by ea.idCampo









GO
/****** Object:  StoredProcedure [dbo].[DetalleLegajoPago]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Procedure [dbo].[DetalleLegajoPago]
(
	@idOperacion	int=214477
)
as
Select p.codigo,p.razonsocial,cp.fecha fecha1Venc,t.comprobante,cp.totalimporte*Multiplicador totalimporte,substring(cp.nrocomprobante,5,8) as Numero 
from LegajosPago lp
inner join compProvHeader cp
on lp.idtransaccion=cp.idtransaccion
inner join proveedores p 
on cp.proveedor=p.codigo
inner join TipCompModHeader t
on cp.tipoComprobante=t.codigo
where idOPeracion=@idOperacion

--Select * from LegajosPago order by idOperacion

GO
/****** Object:  StoredProcedure [dbo].[DetalleMO]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE procedure [dbo].[DetalleMO]
(
	@idObra	int=8634
)
as
Select * from tempFacturacionMO
where idObra=@idObra
order by idCampo
GO
/****** Object:  StoredProcedure [dbo].[DetallePedido]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE    Procedure [dbo].[DetallePedido]
(
	@idOperacion	int=29712
)
as
Select idoperacion,a.articulo,a.descripcion,ea.cantidad,ea.serial,
eap.unitario,ea.cantidad*eap.unitario as parcial from EstadisticaArticulosPedidos ea
inner join EstadisticaArticulosPreciosPedidos eap
on ea.idcampo=eap.idcampo
inner join Articulos a
on ea.idArticulo=a.idArticulo
where idOperacion=@idOperacion




GO
/****** Object:  StoredProcedure [dbo].[DetallePresentaciones]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE        Procedure [dbo].[DetallePresentaciones] -- DetallePresentaciones 34429
(
	@IdOperacion int
)
as
Declare @tsql nvarchar(4000)

select @tsql='
SELECT 
sc.Socio,Apellido,Nombre,cc.importe,cc.idtransaccion,cc.entidad,tr.detalle
from 
Header_Operaciones ho
inner join Detalle_Operaciones do
on ho.idOperacion=do.idOperacion
inner join CuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion
left join transaccionesrechazadas tr
on tr.idtransaccion=cc.idtransaccion
inner join socios sc
on sc.socio=cc.socio
left join tarjetas ts
on ts.idtarjeta=ho.cuenta 
where ho.idOperacion=' + cast(@idOperacion as char(6)) + '
and idtipotransaccion=0 and entidad=0
and concepto="DA" 
union
SELECT 
sc.adherente,Apellido,Nombre,cc.importe,cc.idtransaccion, cc.entidad,tr.detalle
from 
Header_Operaciones ho
inner join Detalle_Operaciones do
on ho.idOperacion=do.idOperacion
inner join CuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion
inner join Adherentes sc
on sc.adherente=cc.socio
left join tarjetas ts
on ts.idtarjeta=ho.cuenta 
left join transaccionesrechazadas tr
on tr.idtransaccion=cc.idtransaccion
where ho.idOperacion=' + cast(@idOperacion as char(6)) + '
and idtipotransaccion=0 and entidad=1
and concepto="DA" 
union
SELECT 
sc.idalumno,nyap as Apellido,"" as Nombre,cc.importe,cc.idtransaccion, cc.entidad,tr.detalle
from 
Header_Operaciones ho
inner join Detalle_Operaciones do
on ho.idOperacion=do.idOperacion
inner join CuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion
inner join Alumnos sc
on sc.idalumno=cc.socio
left join tarjetas ts
on ts.idtarjeta=ho.cuenta 
left join transaccionesrechazadas tr
on tr.idtransaccion=cc.idtransaccion
where ho.idOperacion=' + cast(@idOperacion as char(6)) + '
and idtipotransaccion=0 and entidad=2
and concepto="DA" 
Order by apellido,nombre'

EXEC sp_executesql @tsql
--print @tsql




GO
/****** Object:  StoredProcedure [dbo].[DetallePresupuesto]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO





CREATE     Procedure [dbo].[DetallePresupuesto] 
(
	@idOperacion	int=37151
)
as
Select ea.idoperacion,a.articulo,isnull(eadp.descripcion,a.descripcion) descripcion,ea.cantidad,ea.serial,eap.unitario,ea.cantidad*eap.unitario as parcial,oCompra,
case when vch.moneda=0 then '$' else 'u$s' end Signo, ea.articuloProveedor
 
from EstadisticaArticulosPresupuestos ea
inner join EstadisticaArticulosPreciosPresupuestos eap
on ea.idcampo=eap.idcampo
inner join Articulos a
on ea.idArticulo=a.idArticulo
left join EstadisticaArticulosDescripcionesPresupuestos eadp
on ea.idcampo=eadp.idcampo
inner join Detalle_operaciones do 
on ea.idOperacion=do.idOperacion 
inner join venCliHeader vch
on do.idtransaccion=vch.idtransaccion

where ea.idOperacion=@idOperacion
and idtipotransaccion=10

Order by ea.idCampo










GO
/****** Object:  StoredProcedure [dbo].[DetalleRcCaja]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


-- DetalleRcCaja 88613
CREATE   Procedure [dbo].[DetalleRcCaja]
(
	@idOPeracion int
)
as
Declare @tSql nvarchar(4000)
Declare	@Entidad int

Select @entidad=cc.entidad 
from Detalle_operaciones do
inner join CuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion 
where do.idtipotransaccion=0 and idOperacion=@idOperacion

Set @tSql='Select  A01.idOperacion, 
A04.DocumentoNumero as PeriodoConcepto, A05.Concepto, A05.Importe as ImporteConcepto, 
A08.Descripcion As DescConcepto
,ltrim(rtrim(substring(cast(a04.documentonumero as char(6)),5,2)))+"/"+ltrim(rtrim(substring(cast(a04.documentonumero as char(6)),1,4))) PeriodoPago,a04.entidad
From Header_Operaciones A01 
inner join Detalle_Operaciones A02 on A01.idOperacion = A02.idOperacion 
and A02.idTipoTransaccion = 0 
inner join AplicacionesCuentasCorrientes A03 on A02.idTransaccion = A03.idTransaccion 
inner join CuentasCorrientes A04 on A04.idTransaccion = A03.idTransaccionCancelada '
if @Entidad=0 or @Entidad=1
	Set @tSql=@tSql + 'inner join DetalleCuentasCorrientes A05 on A05.idTransaccion = A04.idTransaccion 
	inner join Conceptos A08 on A05.Concepto = A08.Concepto '
Else
	Set @tSql=@tSql + 'inner join DetalleCuentasCorrientes A05 on A05.idTransaccion = A04.idTransaccion 
	inner join Horarios h
		on h.idHorario=a05.concepto
	inner join NominaCursos n
		on n.idCurso=h.idCurso
	INNER JOIN OtrosConceptos a08
		ON n.concepto = a08.concepto '

Set @tSql=@tSql + ' Where A01.idOperacion =' + cast(@idOperacion as char(12)) + ' Order by DocumentoNumero' 

exec sp_executesql @tSql  

--print @tSql

-- DetalleRcCaja 88613



GO
/****** Object:  StoredProcedure [dbo].[DetalleRcCajaValores]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


CREATE  Procedure [dbo].[DetalleRcCajaValores]
(
	@idOPeracion int
)
as
Declare @tSql nvarchar(4000)

Set @tSql='Select  A01.idOperacion, 
A06.importe as ImportePago,A06.Cuenta, A06.Sucursal, A06.Numero, A06.FechaEmision as FechaCheque, 
	case when a06.idConcepto_tesoreria<>1 then A07.Descripcion else "Efectivo" end as DescPago, A07.Modalidad , A10.Descripcion as DescBanco,
A06.idConcepto_Tesoreria 
From Header_Operaciones A01 
inner join Detalle_Operaciones A02 on A01.idOperacion = A02.idOperacion 
and A02.idTipoTransaccion = 2 
inner join ValoresTesoreria A06 
	on A06.idTransaccion = A02.idTransaccion 
inner join Conceptos_Tesoreria A07 
	on A06.idConcepto_Tesoreria = A07.idConcepto_Tesoreria 
left join Bancos A10 
	on A06.Banco = A10.Banco '

Set @tSql=@tSql + ' Where A01.idOperacion =' + cast(@idOperacion as char(12)) + ' Order by A06.idConcepto_tesoreria' 

exec sp_executesql @tSql  

-- DetalleRcCaja 2,2


GO
/****** Object:  StoredProcedure [dbo].[DetalleRecibos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Procedure [dbo].[DetalleRecibos]
(
	@Desde char(8)='20080501',
	@Hasta char(8)='20080531',
	@tipocomprobante int=999999

)
as
Select ho.fecha,cl.razonsocial,v.nrocomprobante,v.totalimporte from header_operaciones ho
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOPeracion 
inner join Vencliheader v
on do.idtransaccion=v.idtransaccion
inner join Clientes cl 
on v.cliente=cl.codigo
where tipodeoperacion between 10 and 19
and idtipotransaccion=0
and ho.fecha between @Desde and @Hasta 
and (tipocomprobante=@tipocomprobante or @tipocomprobante=999999)
GO
/****** Object:  StoredProcedure [dbo].[DetalleRecibosPagos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE   Procedure [dbo].[DetalleRecibosPagos]
(
	@Desde char(8)='20080401',
	@Hasta char(8)='20080430',
	@rcop  char(1)='R', -- 'R' recibo 'O' rden de pago
	@tipocomprobante int=999999

)
as
if @rcop='R'
	Select ho.fecha,cl.razonsocial,v.nrocomprobante,v.totalimporte*Multiplicador*-1 TOTAL
	from header_operaciones ho
	inner join Detalle_operaciones do 
	on ho.idOperacion=do.idOPeracion 
	inner join Vencliheader v
	on do.idtransaccion=v.idtransaccion
	inner join Clientes cl 
	on v.cliente=cl.codigo
	INNER JOIN TipVentModHeader 
	ON V.tipocomprobante = TipVentModHeader.codigo
	where tipodeoperacion between 10 and 19
	and idtipotransaccion=0
	and ho.fecha between @Desde and @Hasta 
	and (tipocomprobante=@tipocomprobante or @tipocomprobante=999999)

	order by ho.fecha

else
	Select ho.fecha,cl.razonsocial,v.nrocomprobante,(v.totalimporte*Multiplicador) TOTAL
	from header_operaciones ho
	inner join Detalle_operaciones do 
	on ho.idOperacion=do.idOPeracion 
	inner join CompProvHeader v
	on do.idtransaccion=v.idtransaccion
	inner join Proveedores cl 
	on v.proveedor=cl.codigo
	INNER JOIN TipCompModHeader ON tipocomprobante = TipCompModHeader.codigo 
	where tipodeoperacion between 20 and 29
	and idtipotransaccion=1
	and ho.fecha between @Desde and @Hasta 
	and (tipocomprobante=@tipocomprobante or @tipocomprobante=999999)

	order by ho.fecha


GO
/****** Object:  StoredProcedure [dbo].[DetalleStockArticulo]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO

CREATE  Procedure [dbo].[DetalleStockArticulo]
(
	@idArticulo	int=1,
	@Deposito	int=0,
	@Desde		char(8)='',
	@Hasta		char(8)=''
)
as

Declare @SqlScrpt nvarchar(4000)

set @SqlScrpt='Select ea.deposito,ho.fecha,a.Articulo,ho.observacion,ho.ObservacionComprobante,deposito,t.descripcion,isnull(deposito2,0) Dep2 ,
case when signo=1 then cantidad else 0 end Entradas,
case when signo=-1 then cantidad else 0 end Salidas,cantidad*signo unificado,a.Descripcion
from estadisticaArticulos ea
inner join tiposMovimientoStock t
on ea.tipomovimiento=t.idTipomovimientoStock
inner join articulos a
on ea.idarticulo=a.idarticulo
inner join Header_operaciones ho 
on ho.idOperacion=ea.idOPeracion 
where ea.idArticulo=' + cast(@idArticulo as char(20))

if @Deposito<>0
	set @SqlScrpt=@SqlScrpt + ' and Deposito=' + cast(@Deposito as char(8))

--Fecha Desde
if @Desde <> ''
	Set @SqlScrpt=@SqlScrpt + ' and ho.Fecha >= "' + @Desde + '"'

--Fecha Hasta
if @Hasta <> ''
	Set @SqlScrpt=@SqlScrpt + ' and ho.Fecha <= "' + @Hasta + '"'


EXEC sp_executesql @SqlScrpt




GO
/****** Object:  StoredProcedure [dbo].[DeudaVencimientos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Procedure [dbo].[DeudaVencimientos] 
(
	@codigo int	=0
)
as
Declare @Fecha char(8)
Select @Fecha='20080310'

Select 
Codigo,RazonSocial,(
	Select isnull(sum(totalimporte*Multiplicador),0)
	from vencliheader cph
	inner join tipventModHeader tcmh
	on cph.tipocomprobante=tcmh.codigo
	where Cliente=pv.codigo) as saldo,
(
	Select isnull(sum((totalimporte-isnull(cancelado,0))*Multiplicador),0)
	from vencliheader cph
	inner join tipventModHeader tcmh
	on cph.tipocomprobante=tcmh.codigo
	where Cliente=pv.codigo) as analizado,
(
	Select isnull(sum((totalimporte-isnull(cancelado,0))*Multiplicador),0)
	from vencliheader cph
	inner join tipventModHeader tcmh
	on cph.tipocomprobante=tcmh.codigo
	where Cliente=pv.codigo and multiplicador=1 and isnull(fecha1venc,'19000101')<cast(@fecha as smalldatetime) ) vdo
,
(
	Select isnull(sum((totalimporte-isnull(cancelado,0))*Multiplicador),0)
	from vencliheader cph
	inner join tipventModHeader tcmh
	on cph.tipocomprobante=tcmh.codigo
	where Cliente=pv.codigo and multiplicador=1 and fecha1venc between @fecha and cast(@fecha as smalldatetime)+15) as v15,
(
	Select isnull(sum((totalimporte-isnull(cancelado,0))*Multiplicador),0)
	from vencliheader cph
	inner join tipventModHeader tcmh
	on cph.tipocomprobante=tcmh.codigo
	where Cliente=pv.codigo and multiplicador=1 and fecha1venc between cast(@fecha as smalldatetime)+16 and cast(@fecha as smalldatetime)+30) as v30,
(
	Select isnull(sum((totalimporte-isnull(cancelado,0))*Multiplicador),0)
	from vencliheader cph
	inner join tipventModHeader tcmh
	on cph.tipocomprobante=tcmh.codigo
	where Cliente=pv.codigo and multiplicador=1 and fecha1venc>cast(@fecha as smalldatetime)+30 ),
(
	Select isnull(sum((totalimporte-isnull(cancelado,0))*Multiplicador),0)
	from vencliheader cph
	inner join tipventModHeader tcmh
	on cph.tipocomprobante=tcmh.codigo
	where Cliente=pv.codigo and multiplicador=-1  )
from Clientes pv
where ((
	Select isnull(sum(totalimporte*Multiplicador),0)
	from vencliheader cph
	inner join tipventModHeader tcmh
	on cph.tipocomprobante=tcmh.codigo
	where Cliente=pv.codigo)<>0)	
and (pv.codigo=@Codigo or @Codigo=0)
ORDER BY RAZONSOCIAL


GO
/****** Object:  StoredProcedure [dbo].[Diario]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


Create Procedure [dbo].[Diario]
AS
(
SELECT     AsientosDiariosItems.item, AsientosDiariosItems.cuenta, AsientosDiariosItems.debe, AsientosDiariosItems.haber, AsientosDiariosItems.observacion, 
                      Detalle_Operaciones.idTipoTransaccion, Detalle_Operaciones.idTransaccion
FROM         AsientosDiariosItems INNER JOIN
                      Header_Operaciones ON AsientosDiariosItems.aniomes = Header_Operaciones.AnioMes LEFT OUTER JOIN
                      Detalle_Operaciones ON Header_Operaciones.idOperacion = Detalle_Operaciones.idOperacion AND 
                      AsientosDiariosItems.item = Detalle_Operaciones.ItemDiario
WHERE     (Detalle_Operaciones.idTipoTransaccion IS NULL) AND (AsientosDiariosItems.asiento = 4) AND (AsientosDiariosItems.aniomes = 200205)
) 
Union
(
SELECT     AsientosDiariosItems.item, AsientosDiariosItems.cuenta, AsientosDiariosItems.debe, AsientosDiariosItems.haber, AsientosDiariosItems.observacion, 
                      Detalle_Operaciones.idTipoTransaccion, Detalle_Operaciones.idTransaccion
FROM         Detalle_Operaciones INNER JOIN
                      AsientosDiariosItems INNER JOIN
                      Header_Operaciones ON AsientosDiariosItems.aniomes = Header_Operaciones.AnioMes ON 
                      Detalle_Operaciones.idOperacion = Header_Operaciones.idOperacion AND 
                      Detalle_Operaciones.ItemDiario = AsientosDiariosItems.item INNER JOIN
                      CompProvHeader ON Detalle_Operaciones.idTransaccion = CompProvHeader.idtransaccion
WHERE     (Detalle_Operaciones.idTipoTransaccion =1) AND (AsientosDiariosItems.asiento = 4) AND (AsientosDiariosItems.aniomes = 200205)
)
Union
(
SELECT     AsientosDiariosItems.item, AsientosDiariosItems.cuenta, AsientosDiariosItems.debe, AsientosDiariosItems.haber, AsientosDiariosItems.observacion, 
                      Detalle_Operaciones.idTipoTransaccion, Detalle_Operaciones.idTransaccion
FROM         Detalle_Operaciones INNER JOIN
                      AsientosDiariosItems INNER JOIN
                      Header_Operaciones ON AsientosDiariosItems.aniomes = Header_Operaciones.AnioMes ON 
                      Detalle_Operaciones.idOperacion = Header_Operaciones.idOperacion AND 
                      Detalle_Operaciones.ItemDiario = AsientosDiariosItems.item INNER JOIN
                      VenCliHeader ON Detalle_Operaciones.idTransaccion = VenCliHeader.idtransaccion
WHERE     (Detalle_Operaciones.idTipoTransaccion =0) AND (AsientosDiariosItems.asiento = 4) AND (AsientosDiariosItems.aniomes = 200205)
)
Union
(
SELECT     AsientosDiariosItems.item, AsientosDiariosItems.cuenta, AsientosDiariosItems.debe, AsientosDiariosItems.haber, AsientosDiariosItems.observacion, 
                      Detalle_Operaciones.idTipoTransaccion, Detalle_Operaciones.idTransaccion
FROM         Detalle_Operaciones INNER JOIN
                      AsientosDiariosItems INNER JOIN
                      Header_Operaciones ON AsientosDiariosItems.aniomes = Header_Operaciones.AnioMes ON 
                      Detalle_Operaciones.idOperacion = Header_Operaciones.idOperacion AND 
                      Detalle_Operaciones.ItemDiario = AsientosDiariosItems.item INNER JOIN
                      ValoresTesoreria ON Detalle_Operaciones.idTransaccion = ValoresTesoreria.idtransaccion
WHERE     (Detalle_Operaciones.idTipoTransaccion =2) AND (AsientosDiariosItems.asiento = 4) AND (AsientosDiariosItems.aniomes = 200205)
)


GO
/****** Object:  StoredProcedure [dbo].[DifIVaFebrero2013]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create procedure [dbo].[DifIVaFebrero2013]
as

Select * from Asientosdiariosheader
where asientointerno=233 and aniomes=201302 and tipoasiento=0

Select * from header_operaciones 
where asientodiario=26 and aniomes=201302 and tipoasiento=0

Select * from detalle_operaciones 
where idoperacion=266112

Select * from compProvitems
where idtransaccion in (101080)

Select * from compProvHeader
where idtransaccion=101080
GO
/****** Object:  StoredProcedure [dbo].[eResultados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE Procedure [dbo].[eResultados]
(
	@Desde	varchar(8)='20090701',
	@Hasta	varchar(8)='20100630',
	@TC numeric(18,2)=3.81,
	@computer varchar(100)='6930'
)
as

Select ct.cuenta,ct.descripcion,ct.ubResultado,ct.clResultado,sum(debe) Debe,sum(haber) Haber,sum(isnull(debe,0)-isnull(Haber,0)) Saldo,
case when ct.clResultado=1 then sum(isnull(debe,0)-isnull(Haber,0)) else 0 end cl1,
case when ct.clResultado=2 then sum(isnull(debe,0)-isnull(Haber,0)) else 0 end cl2,
case when ct.clResultado=3 then sum(isnull(debe,0)-isnull(Haber,0)) else 0 end cl3,
case when ct.clResultado=4 then sum(isnull(debe,0)-isnull(Haber,0)) else 0 end cl4,
case when ct.clResultado=5 then sum(isnull(debe,0)-isnull(Haber,0)) else 0 end cl5, u.Descripcion dubResultado, agrupar

from asientosdiariositems ai
inner join cuentas ct on ai.cuenta=ct.cuenta

inner join asientosdiariosheader ah
on ai.asiento=ah.asiento and ai.tipoasiento=ah.tipoasiento and ai.aniomes=ah.aniomes

left join asientosexcluidos ax 
	on ah.tipoasInterno=ax.tas and ax.Asiento=ah.AsientoInterno and ah.aniomes=ax.aniomes and ax.Computer=@computer 

left join ubresultado u
on ct.ubresultado=u.ubresultado

where ct.cuenta>399999 

and ax.asiento is null

and fecha between @Desde and @Hasta

Group by ct.cuenta,ct.descripcion,ct.ubResultado,ct.clResultado, u.descripcion, agrupar

Having sum(debe-Haber)<>0





GO
/****** Object:  StoredProcedure [dbo].[EspecialidadesSociosAdherentes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create Procedure [dbo].[EspecialidadesSociosAdherentes]
(
	@Entidad	int
)
as
if @entidad=0
	Select 
	esp.descripcion,count(*) as Cantidad
	from especialidades_socios es
	inner join socios sc on es.socio=sc.socio
	inner join especialidades esp on esp.especialidad=es.especialidad
	where sc.fechabaja is null
	Group by esp.descripcion
	order by esp.descripcion
else
	Select 
	esp.descripcion,count(*) as Cantidad
	from especialidades_Adherentes es
	inner join Adherentes sc on es.Adherente=sc.Adherente
	inner join especialidades esp on esp.especialidad=es.especialidad
	where sc.fechabaja is null
	Group by esp.descripcion
	order by esp.descripcion

GO
/****** Object:  StoredProcedure [dbo].[estadisticaanual]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


CREATE   Procedure [dbo].[estadisticaanual]
(
	@anio char(4)='2008'
) 
as
Declare @sql nvarchar(4000)
Set @sql='Select a.idarticulo,a.articulo,a.descripcion
,isnull(a1.cantidad,0) cenero, isnull(a1.importe,0) ienero,
isnull(a2.cantidad,0) cfebrero,isnull(a2.importe,0) ifebrero,
isnull(a3.cantidad,0) cmarzo ,isnull(a3.importe,0) imarzo,
isnull(a4.cantidad,0) cabril ,isnull(a4.importe,0) iabril,
isnull(a5.cantidad,0) cmayo ,isnull(a5.importe,0) imayo,
isnull(a6.cantidad,0) cJunio ,isnull(a6.importe,0) ijunio,
isnull(a7.cantidad,0) cJulio ,isnull(a7.importe,0) ijulio, 
isnull(a8.cantidad,0) cAgosto ,isnull(a8.importe,0) iagosto,
isnull(a9.cantidad,0) cSeptiembre,isnull(a9.importe,0) iseptiembre, 
isnull(a10.cantidad,0) cOctubre ,isnull(a10.importe,0) ioctubre, 
isnull(a11.cantidad,0) cNoviembre ,isnull(a11.importe,0) inoviembre, 
isnull(a12.cantidad,0) cDiciembre ,isnull(a12.importe,0) idiciembre
from articulos a
left join Lineas l 
on a.idLinea=l.idLinea
left join Sublineas sl
on a.idSublinea=sl.idSublinea
left join Marcas m 
on a.idMarca=m.idMarca
left join acumulados a1
on a.idarticulo=a1.idarticulo and a1.aniomes=' + @anio + '01
left join acumulados a2
on a.idarticulo=a2.idarticulo and a2.aniomes=' + @anio + '02
left join acumulados a3
on a.idarticulo=a3.idarticulo and a3.aniomes=' + @anio + '03
left join acumulados a4
on a.idarticulo=a4.idarticulo and a4.aniomes=' + @anio + '04
left join acumulados a5
on a.idarticulo=a5.idarticulo and a5.aniomes=' + @anio + '05
left join acumulados a6
on a.idarticulo=a6.idarticulo and a6.aniomes=' + @anio + '06
left join acumulados a7
on a.idarticulo=a7.idarticulo and a7.aniomes=' + @anio + '07
left join acumulados a8
on a.idarticulo=a8.idarticulo and a8.aniomes=' + @anio + '08
left join acumulados a9
on a.idarticulo=a9.idarticulo and a5.aniomes=' + @anio + '09
left join acumulados a10
on a.idarticulo=a10.idarticulo and a6.aniomes=' + @anio + '10
left join acumulados a11
on a.idarticulo=a11.idarticulo and a7.aniomes=' + @anio + '11
left join acumulados a12
on a.idarticulo=a12.idarticulo and a8.aniomes=' + @anio + '12

where isnull(a1.importe,0)+isnull(a2.importe,0)+isnull(a3.importe,0)+isnull(a4.importe,0)+isnull(a5.importe,0)+isnull(a6.importe,0)+isnull(a7.importe,0)+isnull(a8.importe,0)+isnull(a9.importe,0)+isnull(a10.importe,0)+isnull(a11.importe,0)+isnull(a12.importe,0)<>0
'



exec Sp_executesql @sql


GO
/****** Object:  StoredProcedure [dbo].[estadisticaanualArticulos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE    Procedure [dbo].[estadisticaanualArticulos]
(
	@anio char(4)='2008'
) 
as
Declare @sql nvarchar(4000)
Set @sql='Select a.idarticulo,a.articulo,a.descripcion,
isnull(a1.cantidad,0) cenero, isnull(a1.importe,0) ienero,
isnull(a2.cantidad,0) cfebrero,isnull(a2.importe,0) ifebrero,
isnull(a3.cantidad,0) cmarzo ,isnull(a3.importe,0) imarzo,
isnull(a4.cantidad,0) cabril ,isnull(a4.importe,0) iabril,
isnull(a5.cantidad,0) cmayo ,isnull(a5.importe,0) imayo,
isnull(a6.cantidad,0) cJunio ,isnull(a6.importe,0) ijunio,
isnull(a7.cantidad,0) cJulio ,isnull(a7.importe,0) ijulio, 
isnull(a8.cantidad,0) cAgosto ,isnull(a8.importe,0) iagosto,
isnull(a9.cantidad,0) cSeptiembre,isnull(a9.importe,0) iseptiembre, 
isnull(a10.cantidad,0) cOctubre ,isnull(a10.importe,0) ioctubre, 
isnull(a11.cantidad,0) cNoviembre ,isnull(a11.importe,0) inoviembre, 
isnull(a12.cantidad,0) cDiciembre ,isnull(a12.importe,0) idiciembre,l.descripcion dLinea,sl.descripcion dSublinea
from articulos a
left join Lineas l 
on a.idLinea=l.idLinea
left join Sublineas sl
on a.idSublinea=sl.idSublinea
left join Marcas m 
on a.idMarca=m.idMarca
left join acumulados a1
on a.idarticulo=a1.idarticulo and a1.aniomes=' + @anio + '01
left join acumulados a2
on a.idarticulo=a2.idarticulo and a2.aniomes=' + @anio + '02
left join acumulados a3
on a.idarticulo=a3.idarticulo and a3.aniomes=' + @anio + '03
left join acumulados a4
on a.idarticulo=a4.idarticulo and a4.aniomes=' + @anio + '04
left join acumulados a5
on a.idarticulo=a5.idarticulo and a5.aniomes=' + @anio + '05
left join acumulados a6
on a.idarticulo=a6.idarticulo and a6.aniomes=' + @anio + '06
left join acumulados a7
on a.idarticulo=a7.idarticulo and a7.aniomes=' + @anio + '07
left join acumulados a8
on a.idarticulo=a8.idarticulo and a8.aniomes=' + @anio + '08
left join acumulados a9
on a.idarticulo=a9.idarticulo and a5.aniomes=' + @anio + '09
left join acumulados a10
on a.idarticulo=a10.idarticulo and a6.aniomes=' + @anio + '10
left join acumulados a11
on a.idarticulo=a11.idarticulo and a7.aniomes=' + @anio + '11
left join acumulados a12
on a.idarticulo=a12.idarticulo and a8.aniomes=' + @anio + '12

where isnull(a1.importe,0)+isnull(a2.importe,0)+isnull(a3.importe,0)+isnull(a4.importe,0)+isnull(a5.importe,0)+isnull(a6.importe,0)+isnull(a7.importe,0)+isnull(a8.importe,0)+isnull(a9.importe,0)+isnull(a10.importe,0)+isnull(a11.importe,0)+isnull(a12.importe,0)<>0
'



exec Sp_executesql @sql




GO
/****** Object:  StoredProcedure [dbo].[estadisticaanualLineas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


CREATE Procedure [dbo].[estadisticaanualLineas]
(
	@anio char(4)='2008'
) 
as
Declare @sql nvarchar(4000)
Set @sql='Select l.idlinea,l.descripcion
,sum(isnull(a1.cantidad,0)) cenero, sum(isnull(a1.importe,0)) ienero,
sum(isnull(a2.cantidad,0)) cfebrero,sum(isnull(a2.importe,0)) ifebrero,
sum(isnull(a3.cantidad,0)) cmarzo ,sum(isnull(a3.importe,0)) imarzo,
sum(isnull(a4.cantidad,0)) cabril ,sum(isnull(a4.importe,0)) iabril,
sum(isnull(a5.cantidad,0)) cmayo ,sum(isnull(a5.importe,0)) imayo,
sum(isnull(a6.cantidad,0)) cJunio ,sum(isnull(a6.importe,0)) ijunio,
sum(isnull(a7.cantidad,0)) cJulio ,sum(isnull(a7.importe,0)) ijulio, 
sum(isnull(a8.cantidad,0)) cAgosto ,sum(isnull(a8.importe,0)) iagosto,
sum(isnull(a9.cantidad,0)) cSeptiembre,sum(isnull(a9.importe,0)) iseptiembre, 
sum(isnull(a10.cantidad,0)) cOctubre ,sum(isnull(a10.importe,0)) ioctubre, 
sum(isnull(a11.cantidad,0)) cNoviembre ,sum(isnull(a11.importe,0)) inoviembre, 
sum(isnull(a12.cantidad,0)) cDiciembre ,sum(isnull(a12.importe,0)) idiciembre
from articulos a
left join Lineas l 
on a.idLinea=l.idLinea
left join Sublineas sl
on a.idSublinea=sl.idSublinea
left join Marcas m 
on a.idMarca=m.idMarca
left join acumulados a1
on a.idarticulo=a1.idarticulo and a1.aniomes=' + @anio + '01
left join acumulados a2
on a.idarticulo=a2.idarticulo and a2.aniomes=' + @anio + '02
left join acumulados a3
on a.idarticulo=a3.idarticulo and a3.aniomes=' + @anio + '03
left join acumulados a4
on a.idarticulo=a4.idarticulo and a4.aniomes=' + @anio + '04
left join acumulados a5
on a.idarticulo=a5.idarticulo and a5.aniomes=' + @anio + '05
left join acumulados a6
on a.idarticulo=a6.idarticulo and a6.aniomes=' + @anio + '06
left join acumulados a7
on a.idarticulo=a7.idarticulo and a7.aniomes=' + @anio + '07
left join acumulados a8
on a.idarticulo=a8.idarticulo and a8.aniomes=' + @anio + '08
left join acumulados a9
on a.idarticulo=a9.idarticulo and a5.aniomes=' + @anio + '09
left join acumulados a10
on a.idarticulo=a10.idarticulo and a6.aniomes=' + @anio + '10
left join acumulados a11
on a.idarticulo=a11.idarticulo and a7.aniomes=' + @anio + '11
left join acumulados a12
on a.idarticulo=a12.idarticulo and a8.aniomes=' + @anio + '12

Group by l.idlinea,l.descripcion

order by l.idlinea,l.descripcion
'



exec Sp_executesql @sql


GO
/****** Object:  StoredProcedure [dbo].[Estadisticas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE       Procedure [dbo].[Estadisticas]
(
	@Desde		char(8)='20080101',
	@Hasta		char(8)='20081231',
	@ArticuloDesde	varchar(15)='',
	@ArticuloHasta	varchar(15)='',
	@idLinea	int=0,
	@idSublinea	int=0,
	@idMarca	int=0,
	@Cliente	int=0,
	@Vendedor	int=0

)
as
Select ea.idArticulo,''''+a.articulo,a.descripcion,sum(cantidad*multiplicador) Cantidad,
sum(baseContable*multiplicador) Importe,
sum(isnull(baseContable*multiplicador,0))/case when sum(cantidad*multiplicador)=0 then 1 else sum(cantidad*multiplicador) end Promedio

from Header_Operaciones ho
inner join Detalle_operaciones do 
on ho.idOPeracion=do.idOPeracion
inner join VenCliHeader vch 
on do.idtransaccion=vch.idtransaccion 
inner join Clientes c
on vch.cliente=c.codigo
inner join EstadisticaArticulos ea
on do.idOperacion=ea.idOPeracion
inner join EstadisticaArticulosPrecios eap
on ea.idCampo=eap.idCampo
inner join Articulos a
on ea.idArticulo=a.idarticulo
left join Lineas l 
on a.idLinea=l.idLinea
left join Sublineas sl
on a.idSublinea=sl.idSublinea
left join Marcas m 
on a.idMarca=m.idMarca
left join vendedores v
on c.vendedor=v.idvendedor
inner join tipVentModHeader t
on vch.tipocomprobante=t.codigo

where idtipotransaccion=0

and ho.fecha between @Desde and @Hasta

and (a.articulo>=@ArticuloDesde or @ArticuloDesde='')

and (a.articulo<=@ArticuloHasta or @ArticuloHasta='')

and (a.idLinea=@idLinea or @idLinea=0)

and (a.idSubLinea=@idSubLinea or @idSubLinea=0)

and (a.idMarca=@idMarca or @idMarca=0)

and (vch.Cliente=@Cliente or @Cliente=0)

and (c.Vendedor=@Vendedor or @Vendedor=0)

Group by ea.idArticulo,a.articulo,a.descripcion






GO
/****** Object:  StoredProcedure [dbo].[Estadisticas_Adherentes_Header]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO

CREATE Procedure [dbo].[Estadisticas_Adherentes_Header] -- 'Cada5','Edades Cada 5 '
-- Estadisticas_Adherentes_Header 'Cada5','Edades Cada 5 '
(
	@Grupo1				char(15),
	@GrupoLetras1		char(20),
	@Grupo2				char(15)=null,
	@GrupoLetras2		char(20)=null,
	@Cobrador			int=0,
	@Hospital			int=0,
	@Especialidad		int=0,
	@Sexo				int=0,
	@Edad_Inicio		int=0,
	@Edad_Cierre		int=0,
	@CoberturaDesde 	char(3)='ALL',
	@CoberturaHasta 	char(3)='ALL',
	@FechaListado		char(8)='20040501'
)
as
Declare @Sqlstr	nvarchar(4000)

set @Sqlstr='Select ' + ltrim(rtrim(@Grupo1)) + ', 
Count(*) from listadoAdherentes '

set @Sqlstr=@Sqlstr + ' Group by ' + ltrim(rtrim(@Grupo1))

set @Sqlstr=@Sqlstr + ' Order by ' + ltrim(rtrim(@Grupo1))

Print @Sqlstr

GO
/****** Object:  StoredProcedure [dbo].[EstadisticasClientes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO





CREATE    Procedure [dbo].[EstadisticasClientes]
(
	@Desde		char(8)='20080101',
	@Hasta		char(8)='20080131',
	@ArticuloDesde	varchar(15)='',
	@ArticuloHasta	varchar(15)='',
	@idLinea	int=0,
	@idSublinea	int=0,
	@idMarca	int=0,
	@Cliente	int=0,
	@Vendedor	int=0

)
as
Select c.codigo,c.razonsocial,sum(Cantidad*multiplicador) Cantidad,sum(baseContable*multiplicador) Importe

from Header_Operaciones ho
inner join Detalle_operaciones do 
on ho.idOPeracion=do.idOPeracion
inner join VenCliHeader vch 
on do.idtransaccion=vch.idtransaccion 
inner join Clientes c
on vch.cliente=c.codigo
inner join EstadisticaArticulos ea
on do.idOperacion=ea.idOPeracion
inner join EstadisticaArticulosPrecios eap
on ea.idCampo=eap.idCampo
inner join Articulos a
on ea.idArticulo=a.idarticulo
left join Lineas l 
on a.idLinea=l.idLinea
left join Sublineas sl
on a.idSublinea=sl.idSublinea
left join Marcas m 
on a.idMarca=m.idMarca
left join vendedores v
on c.vendedor=v.idvendedor
inner join tipVentModHeader t
on vch.tipocomprobante=t.codigo

where idtipotransaccion=0

and ho.fecha between @Desde and @Hasta

and (a.articulo>=@ArticuloDesde or @ArticuloDesde='')

and (a.articulo<=@ArticuloHasta or @ArticuloHasta='')

and (a.idLinea=@idLinea or @idLinea=0)

and (a.idSubLinea=@idSubLinea or @idSubLinea=0)

and (a.idMarca=@idMarca or @idMarca=0)

and (vch.Cliente=@Cliente or @Cliente=0)

and (c.Vendedor=@Vendedor or @Vendedor=0)

Group by c.codigo,c.razonsocial








GO
/****** Object:  StoredProcedure [dbo].[EstadisticasDetallada]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO





CREATE      Procedure [dbo].[EstadisticasDetallada]
(
	@Desde		char(8)='20080301',
	@Hasta		char(8)='20080331',
	@ArticuloDesde	varchar(15)='',
	@ArticuloHasta	varchar(15)='',
	@idLinea	int=0,
	@idSublinea	int=0,
	@idMarca	int=0,
	@Cliente	int=0,
	@Vendedor	int=0

)
as
Select ea.idArticulo,a.articulo,a.descripcion,cantidad*multiplicador Cantidad,
baseContable*multiplicador Importe,
baseContable*multiplicador/case when cantidad*multiplicador=0 then 1 else cantidad*multiplicador end Promedio,
nrocomprobante,razonsocial,vch.fecha,t.comprobante

from Header_Operaciones ho
inner join Detalle_operaciones do 
on ho.idOPeracion=do.idOPeracion
inner join VenCliHeader vch 
on do.idtransaccion=vch.idtransaccion 
inner join Clientes c
on vch.cliente=c.codigo
inner join EstadisticaArticulos ea
on do.idOperacion=ea.idOPeracion
inner join EstadisticaArticulosPrecios eap
on ea.idCampo=eap.idCampo
inner join Articulos a
on ea.idArticulo=a.idarticulo
left join Lineas l 
on a.idLinea=l.idLinea
left join Sublineas sl
on a.idSublinea=sl.idSublinea
left join Marcas m 
on a.idMarca=m.idMarca
left join vendedores v
on c.vendedor=v.idvendedor
inner join tipVentModHeader t
on vch.tipocomprobante=t.codigo

where idtipotransaccion=0

and ho.fecha between @Desde and @Hasta

and (a.articulo>=@ArticuloDesde or @ArticuloDesde='')

and (a.articulo<=@ArticuloHasta or @ArticuloHasta='')

and (a.idLinea=@idLinea or @idLinea=0)

and (a.idSubLinea=@idSubLinea or @idSubLinea=0)

and (a.idMarca=@idMarca or @idMarca=0)

and (vch.Cliente=@Cliente or @Cliente=0)

and (c.Vendedor=@Vendedor or @Vendedor=0)

--Group by ea.idArticulo,a.articulo,a.descripcion

order by vch.fecha


GO
/****** Object:  StoredProcedure [dbo].[EstadisticasDetalladaComisiones]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[EstadisticasDetalladaComisiones]
(
	@Desde		char(8)='20080501',
	@Hasta		char(8)='20080531',
	@ArticuloDesde	varchar(15)='',
	@ArticuloHasta	varchar(15)='',
	@idLinea	int=0,
	@idSublinea	int=0,
	@idMarca	int=0,
	@Cliente	int=0,
	@Vendedor	int=13

)
as
Select ea.idArticulo,a.articulo,a.descripcion,cantidad*multiplicador Cantidad,
baseContable*multiplicador Importe,
baseContable*multiplicador/case when cantidad*multiplicador=0 then 1 else cantidad*multiplicador end Promedio,
nrocomprobante,razonsocial,vch.fecha,t.comprobante,dbo.esvendedor(@Vendedor,a.idarticulo,vch.cliente)

from Header_Operaciones ho
inner join Detalle_operaciones do 
on ho.idOPeracion=do.idOPeracion
inner join VenCliHeader vch 
on do.idtransaccion=vch.idtransaccion 
inner join Clientes c
on vch.cliente=c.codigo
inner join EstadisticaArticulos ea
on do.idOperacion=ea.idOPeracion
inner join EstadisticaArticulosPrecios eap
on ea.idCampo=eap.idCampo
inner join Articulos a
on ea.idArticulo=a.idarticulo
left join Lineas l 
on a.idLinea=l.idLinea
left join Sublineas sl
on a.idSublinea=sl.idSublinea
left join Marcas m 
on a.idMarca=m.idMarca
left join vendedores v
on c.vendedor=v.idvendedor
inner join tipVentModHeader t
on vch.tipocomprobante=t.codigo

where idtipotransaccion=0

and ho.fecha between @Desde and @Hasta

and (a.articulo>=@ArticuloDesde or @ArticuloDesde='')

and (a.articulo<=@ArticuloHasta or @ArticuloHasta='')

and (a.idLinea=@idLinea or @idLinea=0)

and (a.idSubLinea=@idSubLinea or @idSubLinea=0)

and (a.idMarca=@idMarca or @idMarca=0)

and (vch.Cliente=@Cliente or @Cliente=0)

and (c.Vendedor=@Vendedor or @Vendedor=0)

and (dbo.esvendedor(@Vendedor,a.idarticulo,vch.cliente)<>0)

--Group by ea.idArticulo,a.articulo,a.descripcion

order by vch.fecha



GO
/****** Object:  StoredProcedure [dbo].[esTaxi]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[esTaxi](@idObra int)
as
Select taxi,
case when isnull(taxi,0)=0 then (Select 100+(Select ivaGeneral from parametrosgeneralesSueldos))/100 else 1 end multiplicador  from matriculas m
inner join Obras o
on m.idMatricula=o.idmatricula
where idObra=@idObra

/*
Select taxi,
case 
when civa=7 then 1
when isnull(taxi,0)=0 then (Select 100+(Select ivaGeneral from parametrosgeneralesSueldos))/100 else 1 end multiplicador
from matriculas m
inner join Obras o
on m.idMatricula=o.idmatricula
inner join clientes c
on m.idcliente=c.codigo
where idObra=@idObra
*/
GO
/****** Object:  StoredProcedure [dbo].[Etiquetas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO






CREATE     Procedure [dbo].[Etiquetas](
	@FechaDesde	char(8)=null,
	@FechaHasta	char(8)=null,
	@Grupo 		char(1)=null,
	@SubGrupo 	char(1)=null,
	@Concepto	char(3)=null,
--	@Cargo		int=null,
	@Cobrador	int=null,
	@Tarjeta	int=null,
	@Hospital	int=null,
	@Orden		char(1)='A',	-- "A" Alfabetico "H" Hospital
	@Estado		char(1)='A'
)
as
Declare @sqlString nvarchar(4000)
Declare @sqlConcat varchar(20)

set @sqlConcat=' where '

Set @sqlString='Select "Socio Nº " + ltrim(rtrim(cast(Socio as char(6)))) as socio,
case sexo 	when 1 then "Dr. " else "Dra. "end + ltrim(rtrim(apellido))+ ", " + ltrim(rtrim(nombre)) as Nyap,
domicilio,"(" + ltrim(rtrim(cpostal)) + ") - " + localidad as Localidad,pv.descripcion
from socios sc inner join provincias pv on sc.provincia=pv.provincia '

if @Cobrador<>0
	begin 
		set @sqlString = @sqlString + @sqlConcat + ' sc.Cobrador=' + cast(@Cobrador as varchar(3)) + ' '
		set	@sqlConcat=' And ' 
	end

if @Tarjeta<>0
	begin 
		set @sqlString = @sqlString + @sqlConcat + ' sc.tarjeta=' + cast(@Tarjeta as varchar(3)) + ' '
		set	@sqlConcat=' And ' 
	end

if len(@grupo)>0
	begin 
		set @sqlString = @sqlString + @sqlConcat + ' sc.Grupo="' + @Grupo + '" '
		set	@sqlConcat=' And ' 
	end

if @Estado='A' or len(@Estado)=0
	begin 
		set @sqlString = @sqlString + @sqlConcat + ' sc.Fechabaja is null '
		set	@sqlConcat=' And ' 
	end

if len(@FechaDesde)>0
	begin 
		set @sqlString = @sqlString + @sqlConcat + ' sc.FechaIngreso>="' + @FechaDesde + '"'
		set	@sqlConcat=' And ' 
	end	

if len(@FechaHasta)>0
	begin 
		set @sqlString = @sqlString + @sqlConcat + ' sc.FechaIngreso<="' + @FechaHasta + '"'
		set	@sqlConcat=' And ' 
	end	

if len(@concepto)>0
	begin 
		set @sqlString = @sqlString + @sqlConcat + '(Select count(*) from Conceptos_socios cs where concepto="' + @Concepto + '" and cs.socio=sc.socio and cs.fechabaja is null)>0 '
		set	@sqlConcat=' And ' 
	end

if len(@subGrupo)>0
	begin 
		set @sqlString = @sqlString + @sqlConcat + '(Select count(*) from Grupos_socios cgs where Grupo="' + cast(@SubGrupo as varchar(1)) + '" and cgs.socio=sc.socio)>0 '
		set	@sqlConcat=' And ' 
	end

if @Orden='A'
	set @sqlString=@sqlString + ' order by apellido, Nombre'
Else if @Orden='S'
	set @sqlString=@sqlString + ' order by cast(Socio as int)'
else
	set @sqlString=@sqlString + ' order by cpostal,apellido, Nombre'

EXEC sp_executesql @sqlString
--print @sqlString






GO
/****** Object:  StoredProcedure [dbo].[Etiquetas_Jubilados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


-- Etiquetas_Jubilados NULL,NULL,'A'

CREATE      Procedure [dbo].[Etiquetas_Jubilados](
	@FechaDesde	char(8)='20060301',
	@FechaHasta	char(8)='20060331',
	@Orden		char(1)='A'
)
as
Declare @sqlString nvarchar(4000)
Declare @sqlConcat varchar(20)

set @sqlConcat=' and '

Set @sqlString='Select Distinct sc.socio nSOcio, "Socio Nº " + ltrim(rtrim(cast(sc.Socio as char(6)))) as socio,
case sexo 	when 1 then "Dr. " else "Dra. "end + ltrim(rtrim(apellido))+ ", " + ltrim(rtrim(nombre)) as Nyap,
domicilio,"(" + ltrim(rtrim(cpostal)) + ") - " + localidad as Localidad,pv.descripcion,Telefono,cpostal,apellido,nombre
from socios sc inner join provincias pv on sc.provincia=pv.provincia 
inner join conceptos_Socios cs on sc.socio=cs.socio

Where sc.grupo="J" and sc.fechabaja is null and concepto="C03" '

if len(@FechaDesde)>0
	begin 
		set @sqlString = @sqlString + @sqlConcat + ' cs.FechaVigencia>="' + @FechaDesde + '" '
		set	@sqlConcat=' And ' 
	end	

if len(@FechaHasta)>0
	begin 
		set @sqlString = @sqlString + @sqlConcat + ' cs.FechaVigencia<="' + @FechaHasta + '" '
		set	@sqlConcat=' And ' 
	end	


if @Orden='A'
	set @sqlString=@sqlString + ' order by apellido, Nombre'
Else if @Orden='S'
	set @sqlString=@sqlString + ' order by sc.Socio'
else
	set @sqlString=@sqlString + ' order by cpostal,apellido, Nombre'

EXEC sp_executesql @sqlString
--print @sqlString


/* 26193 -- */




GO
/****** Object:  StoredProcedure [dbo].[Etiquetas_Marcas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE   Procedure [dbo].[Etiquetas_Marcas](
	@Computer	char(20)
)
as
(
Select 'Socio Nº ' + ltrim(rtrim(cast(sc.Socio as char(6)))) as socio,
case sexo 	when 1 then 'Dr. ' else 'Dra. 'end + ltrim(rtrim(apellido))+ ', ' + ltrim(rtrim(nombre)) as Nyap,
domicilio,'(' + ltrim(rtrim(cpostal)) + ') - ' + localidad as Localidad,pv.descripcion,apellido,nombre
from 
temp_etiquetas te 
inner join socios sc
on sc.socio=te.socio
inner join provincias pv on sc.provincia=pv.provincia 
where computer=@Computer and entidad=0
)
union
(
Select 'Adherente Nº ' + ltrim(rtrim(cast(sc.Adherente as char(6)))) as socio,
case sexo 	when 1 then 'Dr. ' else 'Dra. 'end + ltrim(rtrim(apellido))+ ', ' + ltrim(rtrim(nombre)) as Nyap,
domicilio,'(' + ltrim(rtrim(cpostal)) + ') - ' + localidad as Localidad,pv.descripcion,apellido,nombre
from 
temp_etiquetas te 
inner join Adherentes sc
on sc.adherente=te.socio
inner join provincias pv on sc.provincia=pv.provincia 
where computer=@Computer and entidad=1
)
order by apellido,nombre



GO
/****** Object:  StoredProcedure [dbo].[Etiquetas_selectivo]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


-- Etiquetas_selectivo '', '', 0, 'a', 'b'

CREATE Procedure [dbo].[Etiquetas_selectivo](
	@Grupo 		char(1)=null,
	@SubGrupo 	char(1)=null,
	@Cobrador	int=null,
	@Apedes 	nvarchar(20)=null,
	@Apehas 	nvarchar(20)=null
)
as
Declare @sqlString nvarchar(4000)
Declare @sqlConcat varchar(20)

set @sqlConcat=' where '

Set @sqlString='Select socio codigo,"Socio Nº " + ltrim(rtrim(cast(Socio as char(6)))) as socio,
case sexo 	when 1 then "Dr. " else "Dra. "end + ltrim(rtrim(apellido))+ ", " + ltrim(rtrim(nombre)) as Nyap,
domicilio,"(" + ltrim(rtrim(cpostal)) + ") - " + localidad as Localidad,pv.descripcion, apellido, nombre
from socios sc inner join provincias pv on sc.provincia=pv.provincia '

if @Cobrador<>0
	begin 
		set @sqlString = @sqlString + @sqlConcat + ' sc.Cobrador=' + cast(@Cobrador as varchar(3)) + ' '
		set	@sqlConcat=' And ' 
	end


if len(@grupo)>0
	begin 
		set @sqlString = @sqlString + @sqlConcat + ' sc.Grupo="' + @Grupo + '" '
		set	@sqlConcat=' And ' 
	end


if len(@subGrupo)>0
	begin 
		set @sqlString = @sqlString + @sqlConcat + '(Select count(*) from Grupos_socios cgs where Grupo="' + cast(@SubGrupo as varchar(1)) + '" and cgs.socio=sc.socio)>0 '
		set	@sqlConcat=' And ' 
	end

if len(@apedes)>0
	begin 
		set @sqlString = @sqlString + @sqlConcat + ' sc.Apellido>="' + @Apedes + '" '
		set	@sqlConcat=' And ' 
	end

if len(@apehas)>0
	begin 
		set @sqlString = @sqlString + @sqlConcat + ' sc.Apellido<="' + @Apehas + '" '
		set	@sqlConcat=' And ' 
	end

	set @sqlString=@sqlString + ' order by apellido, Nombre'

EXEC sp_executesql @sqlString
--print @sqlString




GO
/****** Object:  StoredProcedure [dbo].[EtiquetasAdherentes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE Procedure [dbo].[EtiquetasAdherentes](
--	@FechaDesde	char(8)=null,
--	@FechaHasta	char(8)=null,
--	@Grupo 		char(1)=null,
--	@SubGrupo 	char(1)=null,
	@Concepto	char(3)='',
--	@Cargo		int=null,
	@Cobrador	int=0,
	@Tarjeta	int=0,
/*	@Hospital	int=null,	*/
	@Orden		char(1)='A',	-- "A" Alfabetico "H" Hospital
	@Estado		char(1)='A'
)
as
Declare @sqlString nvarchar(4000)
Declare @sqlConcat varchar(20)

set @sqlConcat=' where '

Set @sqlString='Select "Adherente Nº " + ltrim(rtrim(cast(Adherente as char(6)))) as socio,
case sexo 	when 1 then "Dr. " else "Dra. "end + ltrim(rtrim(apellido))+ ", " + ltrim(rtrim(nombre)) as Nyap,
domicilio,"(" + ltrim(rtrim(cpostal)) + ") - " + localidad as Localidad,pv.descripcion
from Adherentes sc inner join provincias pv on sc.provincia=pv.provincia '

if @Cobrador<>0
	begin 
		set @sqlString = @sqlString + @sqlConcat + ' sc.Cobrador=' + cast(@Cobrador as varchar(3)) + ' '
		set	@sqlConcat=' And ' 
	end

if @Tarjeta<>0
	begin 
		set @sqlString = @sqlString + @sqlConcat + ' sc.tarjeta=' + cast(@Tarjeta as varchar(3)) + ' '
		set	@sqlConcat=' And ' 
	end

/* if len(@grupo)>0
	begin 
		set @sqlString = @sqlString + @sqlConcat + ' sc.Grupo="' + @Grupo + '" '
		set	@sqlConcat=' And ' 
	end
*/

if @Estado='A' or len(@Estado)=0
	begin 
		set @sqlString = @sqlString + @sqlConcat + ' sc.Fechabaja is null '
		set	@sqlConcat=' And ' 
	end

/* 
if len(@FechaDesde)>0
	begin 
		set @sqlString = @sqlString + @sqlConcat + ' sc.FechaIngreso>="' + @FechaDesde + '"'
		set	@sqlConcat=' And ' 
	end	

if len(@FechaHasta)>0
	begin 
		set @sqlString = @sqlString + @sqlConcat + ' sc.FechaIngreso<="' + @FechaHasta + '"'
		set	@sqlConcat=' And ' 
	end	
*/

if len(@concepto)>'0'
	begin 
		set @sqlString = @sqlString + @sqlConcat + '(Select count(*) from Conceptos_Adherentes cs where concepto="' + @Concepto + '" and cs.Adherente=sc.Adherente and cs.fechabaja is null)>0 '
		set	@sqlConcat=' And ' 
	end

/* if len(@subGrupo)>0
	begin 
		set @sqlString = @sqlString + @sqlConcat + '(Select count(*) from Grupos_Adherentes cgs where Grupo="' + cast(@SubGrupo as varchar(1)) + '" and cgs.socio=sc.socio)>0 '
		set	@sqlConcat=' And ' 
	end
*/

if @Orden='A'
	set @sqlString=@sqlString + ' order by apellido, Nombre'
Else if @Orden='S'
	set @sqlString=@sqlString + ' order by cast(Adherente as int)'
else
	set @sqlString=@sqlString + ' order by cpostal,apellido, Nombre'

EXEC sp_executesql @sqlString
--print @sqlString







GO
/****** Object:  StoredProcedure [dbo].[EtiquetasListadoBajasConceptos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE Procedure [dbo].[EtiquetasListadoBajasConceptos] 
	@Concepto char(3),
	@ConceptoHasta char(3),
	@FechaDesde char(8),
	@FechaHasta char(8),
	@CobradorDesde int = NULL,
	@CobradorHasta int = NULL,
	@Activos int = NULL,
	@Entidad int, 
	@Matricula int, --1:SI, 0:NO
	@Especialidad int --999:TODOS, 1:MEDICOS, 0:NO MEDICOS
as

Declare @C_String as nvarchar(4000)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

if @Entidad = 1
	Set @C_String='Select Distinct "Socio Nº " + ltrim(rtrim(cast(ad.Adherente as char(6)))) as socio,
					case sexo 	when 1 then "Dr. " else "Dra. "end + ltrim(rtrim(apellido))+ ", " + ltrim(rtrim(ad.nombre)) as Nyap,
					domicilio,"(" + ltrim(rtrim(cpostal)) + ") - " + localidad as Localidad,pv.descripcion
	 				from Adherentes ad
						inner join provincias pv 
							on ad.provincia=pv.provincia
						inner join Conceptos_adherentes ca 
							on ca.adherente = ad.adherente 
						left join Cobradores co
							on co.cobrador = ad.cobrador
						left join MotivosBaja mb
							on mb.motivo = ca.MotivoBaja '
else
	Set @C_String='Select Distinct "Socio Nº " + ltrim(rtrim(cast(ad.socio as char(6)))) as socio,
					case sexo 	when 1 then "Dr. " else "Dra. "end + ltrim(rtrim(apellido))+ ", " + ltrim(rtrim(ad.nombre)) as Nyap,
					domicilio,"(" + ltrim(rtrim(cpostal)) + ") - " + localidad as Localidad,pv.descripcion,hv.nombre,ad.apellido,ad.nombre

	 				from socios ad
						inner join provincias pv 
							on ad.provincia=pv.provincia
						inner join Conceptos_socios ca 
							on ca.socio = ad.socio
						left join Cobradores co
							on co.cobrador = ad.cobrador
						left join MotivosBaja mb
							on mb.motivo = ca.MotivoBaja 
						left join hospitalesvoto hv
							on hv.hospitalvoto = ad.lugarvoto '

	if @Entidad = 1 
		Set @C_String= @C_String + ' where ca.concepto= "' + convert(char(3),@Concepto) + '"'
	else
		begin 
			Set @C_String= @C_String + ' where ca.concepto >= "' + convert(char(3),@Concepto) + '"'
	
			if @ConceptoHasta <> "0"
				Set @C_String= @C_String + ' and ca.concepto <= "' + convert(char(3),@ConceptoHasta) + '"'
		end 


	if @Activos = 1 
		-----------------
		----- ALTAS -----
		-----------------
		begin
			if @FechaDesde <> ''
				Set @C_String= @C_String + ' and  ca.FechaAlta >= "' + @FechaDesde + '"'
		
			if @FechaHasta <> ''
				Set @C_String= @C_String + ' and  ca.FechaAlta <= "' + @FechaHasta  + '"'

			--- Verifica que NO sean altas por cambio de concepto ---
			if @Entidad = 0
				begin
					Set @C_String= @C_String + ' and 
					(select count(*) from conceptos_socios cs where cs.socio = ad.socio
					and cs.fechabaja is not null and cs.fechabaja>= "' + @FechaDesde + '" 
					and cs.fechabaja <= "' + @FechaHasta + '"
					and cs.concepto >= "' + convert(char(3),@Concepto) + '"'
	
					if @ConceptoHasta <> "0"
						Set @C_String= @C_String + ' and cs.concepto <= "' + convert(char(3),@ConceptoHasta) + '"'
		
					Set @C_String= @C_String + ' and (cs.motivobaja = 17 or cs.motivobaja = 5)) = 0 '

				end

		end 
	else
		-----------------
		----- BAJAS -----
		-----------------
		begin
			Set @C_String= @C_String + ' and ca.fechabaja is not null  and mb.Motivo <> 17 and mb.Motivo <> 5 '

			if @FechaDesde <> ''
				Set @C_String= @C_String + ' and  ca.FechaBaja >= "' + @FechaDesde + '"'
		
			if @FechaHasta <> ''
				Set @C_String= @C_String + ' and  ca.FechaBaja <= "' + @FechaHasta  + '"'

		end

	-- COBRADOR DESDE
	if @CobradorDesde is not null and @CobradorDesde <> 0
		Set @C_String= @C_String + ' and  ad.Cobrador >= ' + rtrim(convert(char(5),@CobradorDesde))

	-- COBRADOR HASTA
	if @CobradorHasta is not null and @CobradorHasta <> 0
		Set @C_String= @C_String + ' and  ad.Cobrador <= ' + rtrim(convert(char(5),@CobradorHasta))


	-- MEDICOS, NO MEDICOS
	if @Especialidad is not null and @Especialidad <> 999
		begin
			if @Entidad = 0
				Set @C_String= @C_String + ' and (Select top 1 es.Medico from Especialidades_Socios esoc inner join Especialidades es on esoc.especialidad = es.especialidad where esoc.Socio = ad.Socio) = ' + convert(char(1),@Especialidad)
			else
				Set @C_String= @C_String + ' and (Select top 1 es.Medico from Especialidades_Adherentes esad inner join Especialidades es on esad.especialidad = es.especialidad where esad.adherente = ad.Adherente) = ' + convert(char(1),@Especialidad)
		end		


	/**** Armo el orden de la consulta ****/
	if @Entidad = 1
		Set @C_String=@C_String + ' Order by ad.Adherente'
	else
		Set @C_String=@C_String + ' Order by sc.socio,hv.nombre,ad.apellido,ad.nombre'


/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String














GO
/****** Object:  StoredProcedure [dbo].[ExcelCobradores]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO



-- ExcelCobradores 21

CREATE               Procedure [dbo].[ExcelCobradores] (@cobrador int)
as
Declare @sql nvarchar(4000)
Declare @Tope numeric(18,2)

Select @Tope=isnull(tope,0) from cobradores where cobrador=@cobrador

Select @sql='
(
Select  dbo.SaldoColegio('+  cast(@cobrador as char(3)) + ') Credito,ad.NroMatricula,rtrim(ad.apellido) + ", " +rtrim(ad.nombre) as nyap,
cc.fecha,cc.concepto,cc.documentonumero,cc.importe,isnull(cuil,"") cuil,telefono,domicilio,
cc.cancelado,cc.idTransaccion,cc.entidad,cc.socio,na.descripcion nacion,ec.descripcion eCivil,
cb.cobrador as cobradorNumero,cb.nombre as Cobrador,
--/* Case 	when isnull(Tope,0)=0 then cb.importe
--    	when isnull(Tope,0)<>0 and cc.importe*cb.Importe/100<=isnull(Tope,0) then cb.Importe
--	else round(isnull(Tope,0)*100/cc.importe,2) end */
cb.importe as Bonificacion, cb.honorarios as Honorarios,
(Select count(*) from conceptos_adherentes ca where ca.adherente=ad.adherente and ca.fechabaja is null) as conceptos,
cb.Tope Valor,
Case 	when isnull(Tope,0)=0 then cc.importe*cb.importe/100
    	when isnull(Tope,0)<>0 and cc.importe*cb.Importe/100<=isnull(Tope,0) then cc.importe*cb.Importe/100
	else isnull(Tope,0) end
ImporteBonificacion

from CuentasCorrientes cc

inner join adherentes ad on cc.socio=ad.adherente
inner join cobradores cb on ad.cobrador=cb.cobrador
left join nacionalidades na on ad.nacional=na.nacionalidad
left join estadoscivil ec on ad.estadoCivil=ec.estadoCivil

where ad.cobrador=' + cast(@cobrador as char(3)) + ' and ad.fechabaja is null and cc.cancelado=0 and cc.entidad=1

)
Union
(
Select  dbo.SaldoColegio('+  cast(@cobrador as char(3)) + ') Credito,  ad.NroMatricula,rtrim(ad.apellido) + ", " +rtrim(ad.nombre) as nyap,
cc.fecha,cc.concepto,cc.documentonumero,cc.importe,isnull(cuil,"") cuil,telefono,domicilio,
cc.cancelado,cc.idTransaccion,cc.entidad,cc.socio,na.descripcion nacion,ec.descripcion eCivil,
cb.cobrador as cobradorNumero,cb.nombre as Cobrador,
--/* Case 	when isnull(Tope,0)=0 then cb.importe
--    	when isnull(Tope,0)<>0 and cc.importe*cb.Importe/100<=isnull(Tope,0) then cb.Importe
--	else round(isnull(Tope,0)*100/cc.importe,2) end */
cb.importe as Bonificacion, cb.honorarios as Honorarios,
(Select count(*) from conceptos_socios ca where ca.socio=ad.socio and ca.fechabaja is null) as conceptos,
cb.Tope Valor,
Case 	when isnull(Tope,0)=0 then cc.importe*cb.importe/100
    	when isnull(Tope,0)<>0 and cc.importe*cb.Importe/100<=isnull(Tope,0) then cc.importe*cb.Importe/100
	else isnull(Tope,0) end
ImporteBonificacion

from CuentasCorrientes cc

inner join Socios ad on cc.socio=ad.Socio
inner join cobradores cb on ad.cobrador=cb.cobrador
left join nacionalidades na on ad.nacional=na.nacionalidad
left join estadoscivil ec on ad.estadoCivil=ec.estadoCivil
where ad.cobrador=' + cast(@cobrador as char(3)) + ' and ad.fechabaja is null and cc.cancelado=0 and cc.entidad=0
) '
if @tope=0
	Select @sql=@sql + ' order by nyap '
else
	Select @sql=@sql + ' order by nyap '

-- PRINT @SQL
Exec sp_executesql @sql


GO
/****** Object:  StoredProcedure [dbo].[FacturasPeriodo]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO





CREATE        Procedure [dbo].[FacturasPeriodo] 
(
	@Desde	char(8)='20080601',
	@Hasta	char(8)='20080630',
	@idOperador int=0,
	@tipocomprobante	int=11

)
as

Select distinct vch.fecha,ho.idOperacion,cl.codigo,Razonsocial,th.comprobante,th.Descripcion,substring(vch.nrocomprobante,1,4) succomprobante,substring(vch.nrocomprobante,5,8) nrocomprobante,
vch.totalimporte*multiplicador importe,isnull(vch.Cancelado,0) cancelado,
'' fPago,0 Concepto 
,idOperadortesoreria,uName,ho.asientodiario asiento
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join VenCliHeader vch 
on do.idtransaccion=vch.idtransaccion 
inner join clientes cl 
on vch.Cliente=cl.Codigo
inner join tipVentmodHeader th
on vch.tipocomprobante=th.codigo
left join aplicacionescuentasaCobrar acc
on vch.idtransaccion=acc.idtransaccioncancelada

left join usuarios_Tesoreria ut
on ho.idOperadortesoreria=ut.idusuario
where tipodeOperacion between 40 and 49
and ho.fecha between @Desde and @Hasta
and (ho.idOperadortesoreria=@idOperador or @idOperador=0)
and idtipotransaccion=0
and (vch.tipocomprobante=@tipocomprobante or @tipocomprobante=0)
union

Select distinct vch.fecha,ho.idOperacion,cl.codigo,Razonsocial,th.comprobante,th.Descripcion,substring(vch.nrocomprobante,1,4) succomprobante,substring(vch.nrocomprobante,5,8) nrocomprobante,
vci.importe*th.multiplicador*-1 importe,isnull(vch.Cancelado,0) cancelado,
'' fPago,0 Concepto 
,idOperadortesoreria,'' uName,ho.asientodiario asiento 
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join CompProvHeader vch 
on do.idtransaccion=vch.idtransaccion 
inner join CompProvItems vci
on vch.comprobante=vci.comprobante and vch.aniomes=vci.aniomes
inner join conceptosContables cct
on ltrim(rtrim(vci.concepto))=ltrim(rtrim(cct.concepto))
inner join proveedores cl 
on vch.proveedor=cl.Codigo
inner join tipCompmodHeader th
on vch.tipocomprobante=th.codigo

where tipodeOperacion between 30 and 39
and ho.fecha between @Desde and @Hasta
--and (ho.idOperadortesoreria=@idOperador or @idOperador=0)
and idtipotransaccion=1
and (cct.conceptoVentas=@tipocomprobante or @tipocomprobante=0)



order by vch.fecha,ho.idOperacion desc

/*
Select * from CompProvItems cpi
inner join conceptosContables cc
on ltrim(rtrim(cpi.concepto))=ltrim(rtrim(cc.concepto))
Select * from conceptosContables
*/


GO
/****** Object:  StoredProcedure [dbo].[fcGlobalHangarajes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE  Procedure [dbo].[fcGlobalHangarajes]
(
	@MesEnLetras	varchar(15)='JULIO 2009',
	@Fecha		varchar(8)='20090701',
	@Moneda		varchar(1)='P',
	@Computer	varchar(50)='PC10'
)	
as
Select idCliente,RazonSocial,idCiva,ci.descripcion,cuit,domicilio,localidad,codigopostal,
mt.Matricula,pesos+(dolares*TC) Neto,Iva,PIB,aIva,Apib, 'Por el Hangaraje de Vuestro Avion ' + ltrim(rtrim(mt.nombreAvion)) + ' matricula ' + ltrim(rtrim(mt.matricula)) + ' correspondiente al mes de ' + ltrim(rtrim(@MesEnLetras)) Leyenda,
Letras, 'HANGARAJE' as idArticulo,case when @Moneda='P' then Pesos else Dolares end Unitario, iva,total,case when leyenda=1 then 'Nota: La empresa se reserva del Derecho de podes brindar servicio sujeto a disponibilidad de lugar.' else '' end Nota,
cast(dias as varchar(2)) + ' dias fecha factura - Vencimiento ' dCVenta , vence, ci.descripcion dCIVA

from tempHangarajes th
inner join Matriculas mt
on th.matricula=mt.matricula
inner join clientes cl 
on mt.idcliente=cl.codigo
inner join dbo.Categorias_Iva ci
on cl.civa=ci.idciva

where Maquina=@Computer


GO
/****** Object:  StoredProcedure [dbo].[Fotos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create Procedure [dbo].[Fotos]
as
Select Socio,apellido,nombre,foto from socios 
where foto is not null

GO
/****** Object:  StoredProcedure [dbo].[Genera_RecibosDA]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE  procedure [dbo].[Genera_RecibosDA]

-- Genera_RecibosDA 200301,200306,22791,22791

@PeriodoInicio int,
@PeriodoCierre int,
@SocioDesde int=0,
@SocioHasta int=999999

as

Declare @idOperacion int

insert into Header_Operaciones 
(fecha,tipodeOperacion,Observacion,asientoDiario,aniomes,tipoasiento,Procesado)
values
(getdate(),500,'Recibos de Debito Automatico',0,0,0,getdate())
Select @idOperacion=@@identity

insert into Header_RecibosDA
(socio,entidad,Fecha,idOperacion)

(
Select cc.socio,cc.entidad,GetDate(),@idOperacion
from Header_Operaciones ho
inner Join Detalle_operaciones do
on do.idOperacion=ho.idOperacion

Inner Join AplicacionesCuentasCorrientes acc
on acc.idtransaccion=do.idtransaccion

Inner Join CuentasCorrientes cc
on cc.idtransaccion=acc.idtransaccionCancelada

Inner Join Socios sc
on sc.socio=cc.socio 

Left join Detalle_recibosDA rda
on cc.idtransaccion=rda.idtransaccion

where (TipoDeOperacion=120 or TipoDeOperacion=60) 
and do.idtipotransaccion=0 and cc.entidad=0
and (cc.DocumentoNumero between @PeriodoInicio and @PeriodoCierre) 
and (cc.socio between @SocioDesde and @SocioHasta)
and rda.idtransaccion is null
Group by cc.socio,cc.entidad,sc.apellido,sc.nombre
)
Union
(
Select cc.socio,cc.entidad,GetDate(),@idoperacion
from Header_Operaciones ho

inner Join Detalle_operaciones do
on do.idOperacion=ho.idOperacion

Inner Join CuentasCorrientes cc0
on cc0.idtransaccion=do.idtransaccion

Inner Join AplicacionesCuentasCorrientes acc
on acc.idtransaccion=cc0.idtransaccion

Inner Join CuentasCorrientes cc
on cc.idtransaccion=acc.idtransaccionCancelada

Inner Join Adherentes sc
on sc.Adherente=cc.socio 

Left join Detalle_recibosDA rda
on cc.idtransaccion=rda.idtransaccion

where (TipoDeOperacion=120 or TipoDeOperacion=60) and do.idtipotransaccion=0 
and cc.entidad=1
and (cc.DocumentoNumero between @PeriodoInicio and @PeriodoCierre) 
and (cc.socio between @SocioDesde and @SocioHasta)
and rda.idtransaccion is null

Group by cc.socio,cc.entidad,sc.apellido,sc.nombre
)


insert into Detalle_RecibosDA
(idRecibo,idtransaccion)

Select distinct rda.idrecibo,dcc.idtransaccion
from Header_Operaciones ho

inner Join Detalle_operaciones do
on do.idOperacion=ho.idOperacion

Inner Join CuentasCorrientes cc0
on cc0.idtransaccion=do.idtransaccion

Inner Join AplicacionesCuentasCorrientes acc
on acc.idtransaccion=cc0.idtransaccion

Inner Join CuentasCorrientes cc
on cc.idtransaccion=acc.idtransaccionCancelada

Inner Join DetalleCuentasCorrientes dcc
on dcc.idtransaccion=cc.idtransaccion

inner Join Conceptos cn
on dcc.Concepto=cn.concepto

inner join Header_recibosDA rda
on rda.socio=cc.socio and rda.entidad=cc.entidad

where (TipoDeOperacion=120 or TipoDeOperacion=60) and do.idtipotransaccion=0
and (cc.documentoNumero between @PeriodoInicio and @PeriodoCierre)
and rda.idOperacion=@idOperacion
and (cc.socio between @SocioDesde and @SocioHasta)



GO
/****** Object:  StoredProcedure [dbo].[Generador_Cargos_Facturas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



Create procedure [dbo].[Generador_Cargos_Facturas]

	@C_Grupo	char(2)		= NULL	,
	@C_Tarjeta	Int		= NULL	,
	@N_Cobrador	Int		= NULL	,
	@N_Desde	VARCHAR(25)	= NULL	,
	@N_Hasta	VARCHAR(25)	= NULL

AS
	/****************************************************************/
	/* Declaracion de Variables					*/
	/****************************************************************/
	DECLARE @D_Consulta	Nvarchar(4000)
	DECLARE @Retorno	INT
	DECLARE	@L_Filtro	BIT

	SET @L_Filtro = 0

	SET @D_Consulta = 'SELECT Soc.adherente as [Socio]		, 
				1 as Entidad				,
				Soc.apellido as [Apellido]		,
				Soc.nombre as [Nombre]			,
				Tar.Descripcion	[DescripcionTarjeta]	,
				Soc.numero as [NumeroTarjeta]		,
				Soc.vencimiento as [Vencimiento]	,
				Soc.Identificador 			,
				Cargo = (
						SELECT SUM(Imp.importe)
						FROM conceptos_adherentes Con
							INNER JOIN dbo.Conceptos Imp
							ON Imp.Concepto = Con.Concepto
							and Imp.Modalidad = ''I''  
						WHERE Con.Adherente = Soc.Adherente
						AND Con.FechaBaja IS NULL 
					)
		FROM adherentes Soc

			LEFT OUTER JOIN dbo.grupos_adherentes Grupo
			ON Grupo.Adherente = Soc.Adherente 
			
			LEFT OUTER JOIN dbo.Tarjetas Tar
			ON Tar.idTarjeta = Soc.tarjeta '

	/****************************************************************/
	/* Validar si se tiene grupo					*/
	/****************************************************************/
	IF @C_Grupo is NOT NULL
	BEGIN

		SET @D_Consulta = @D_Consulta + ' Where Grupo.Grupo = ' + CAST(@C_Grupo AS VARCHAR(5))+ ' '

		SET @L_Filtro = 1
	END

	/****************************************************************/
	/* Validar Fecha Desde y Hasta						*/
	/****************************************************************/
	IF @N_Desde IS NOT NULL AND @N_Hasta IS NOT NULL
	BEGIN

		IF @L_Filtro = 0
		BEGIN
			SET @D_Consulta = @D_Consulta + ' WHERE (Soc.Vencimiento BETWEEN ''' + CAST(@N_Desde AS VARCHAR(25)) + ''' AND ''' + CAST(@N_Hasta AS VARCHAR(25)) + ''' ) '
			
			SET @L_Filtro = 1
		END
		ELSE
		BEGIN
			SET @D_Consulta = @D_Consulta + ' AND (Soc.Vencimiento BETWEEN ''' + CAST(@N_Desde AS VARCHAR(25)) + ''' AND ''' + CAST(@N_Hasta AS VARCHAR(25)) + ''' ) '
		END
	END
	ELSE
	BEGIN
		IF @N_Desde IS NOT NULL 
		BEGIN
			IF @L_Filtro = 0
			BEGIN
				SET @D_Consulta = @D_Consulta + ' WHERE (Soc.Vencimiento > ''' + CAST(@N_Desde AS VARCHAR(25)) + ''' ) '
				
				SET @L_Filtro = 1
			END
			ELSE
			BEGIN
								
				SET @D_Consulta = @D_Consulta + ' AND (Soc.Vencimiento > ''' + CAST(@N_Desde AS VARCHAR(25)) + ''' ) '
			END
		END
		ELSE
		BEGIN
			IF @N_Hasta IS NOT NULL 
			BEGIN

				IF @L_Filtro = 0
				BEGIN
					SET @D_Consulta = @D_Consulta + ' WHERE (Soc.Vencimiento < ''' + CAST(@N_Hasta AS VARCHAR(25)) + ''' ) '
					
					SET @L_Filtro = 1
				END
				ELSE
				BEGIN
					SET @D_Consulta = @D_Consulta + ' AND (Soc.Vencimiento < ''' + CAST(@N_Hasta AS VARCHAR(25)) + ''' ) '
				END
			END
		END
	END

	IF @C_Tarjeta IS NOT NULL
	BEGIN
		IF @L_Filtro = 0
		BEGIN
			SET @D_Consulta = @D_Consulta + ' WHERE (Soc.Tarjeta = ' + CAST(@C_Tarjeta AS VARCHAR(2)) + ') '
			
			SET @L_Filtro = 1
		END
		ELSE
		BEGIN
			SET @D_Consulta = @D_Consulta + ' AND (Soc.Tarjeta = ' + CAST(@C_Tarjeta AS VARCHAR(2)) + ') '
		END
	END

	IF @N_Cobrador IS NOT NULL 
	BEGIN
		IF @L_Filtro = 0
		BEGIN
			SET @D_Consulta = @D_Consulta + ' WHERE (Soc.Cobrador = ' + CAST(@N_Cobrador AS VARCHAR(5)) + ') '
			
			SET @L_Filtro = 1
		END
		ELSE
		BEGIN
			SET @D_Consulta = @D_Consulta + ' And (Soc.Cobrador = ' + CAST(@N_Cobrador AS VARCHAR(5)) + ') '
		END
	END

	SET @D_Consulta = @D_Consulta + ' ORDER BY entidad, socio '


	/****************************************************************/
	/* Devolver los datos						*/
	/****************************************************************/
	PRINT @D_Consulta
	EXEC @Retorno = sp_executesql @D_Consulta


	RETURN @Retorno
		



GO
/****** Object:  StoredProcedure [dbo].[Generador_Cargos_Mes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO





CREATE              procedure [dbo].[Generador_Cargos_Mes] -- Generador_Cargos_Mes 1,null,null,null,200312

/*	@C_Grupo	char(2)	= NULL	, */
	@C_Tarjeta	Int	= -1	,
	@N_Cobrador	Int	= -1 	,
	@N_Desde	Int	= -1	,
	@N_Hasta	Int	= -1	,
	@Aniomes	int		-- ,@Cierre		datetime='20030131'
AS

Select * from fnGenerador_Cargos_Mes(@c_Tarjeta,null,null,null,@aniomes)
order by Dentidad, Apellido, Nombre, socio


GO
/****** Object:  StoredProcedure [dbo].[Generador_Cargos_Mes_OLD]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO





CREATE          procedure [dbo].[Generador_Cargos_Mes_OLD]

/*	@C_Grupo	char(2)	= NULL	, */
	@C_Tarjeta	Int	= -1	,
	@N_Cobrador	Int	= -1 	,
	@N_Desde	Int	= -1	,
	@N_Hasta	Int	= -1	--,	@Aniomes	int
AS

if @N_Cobrador = -1
	set @N_Cobrador = Null
if @N_Desde = -1
	set @N_Desde = Null
if @N_Hasta = -1
	set @N_Hasta = Null

	/****************************************************************/
	/* Devolver los datos						*/
	/****************************************************************/
		select	Soc.adherente as [Socio]	, 
				1 as Entidad				,
				Soc.apellido as [Apellido]	,
				Soc.nombre as [Nombre]		,
				Soc.tarjeta					,
				Soc.numero as [Numero de Tarjeta]	,
				Soc.vencimiento as [Vencimiento]	,
				Soc.Identificador 			,
				Cargo = (
						SELECT SUM(Imp.importe)
						FROM conceptos_adherentes Con
							INNER JOIN dbo.Conceptos Imp
							ON Imp.Concepto = Con.Concepto
							and Imp.Modalidad = 'I'

						WHERE Con.Adherente = Soc.Adherente
						AND ((Con.FechaBaja IS NULL and fechaVigencia<'20030101')
						or (FechaBaja>'20021231' and fechaVigencia<'20030101'))
/*
						WHERE Con.Adherente = Soc.Adherente
						and (con.FechaBaja is null and 
						(convert(char(4),year(FechaVigencia)) + right((convert(varchar(2),month(FechaVigencia)) + 100),2)<=@aniomes) 
						or ((convert(char(4),year(FechaBaja)) + right((convert(varchar(2),month(FechaBaja)) + 100),2))>=@Aniomes) 
						and ((convert(char(4),year(FechaVigencia)) + right((convert(varchar(2),month(FechaVigencia)) + 100),2))<=@Aniomes))
*/
					),
				'Foprosa' as Dentidad
		from adherentes Soc

/*			INNER JOIN dbo.grupos_adherentes Grupo
			ON Grupo.Adherente = Soc.Adherente
			and (Grupo.Grupo = @C_Grupo or @C_Grupo is null) */

		where Soc.FechaBaja is null
		and (Soc.debitardesde is null or Soc.debitardesde<'20030101')
		AND (Soc.Adherente BETWEEN @N_Desde AND @N_Hasta OR @N_Desde is null)
		AND (Soc.Tarjeta = @C_Tarjeta or @C_Tarjeta is null)
		And (Soc.Cobrador = @N_Cobrador or @N_Cobrador is null)
		AND (
						SELECT SUM(Imp.importe)
						FROM conceptos_Adherentes Con
							INNER JOIN dbo.Conceptos Imp
							ON Imp.Concepto = Con.Concepto
							and Imp.Modalidad = 'I'

						WHERE Con.Adherente = Soc.Adherente
						AND ((Con.FechaBaja IS NULL and fechaVigencia<'20030101')
						or (FechaBaja>'20021231' and fechaVigencia<'20030101'))

					) is not null

	Union 

		select		Soc.Socio				,
				0 as Entidad				,
				Soc.apellido as [Apellido]		,
				Soc.nombre as [Nombre]			,
				Soc.tarjeta				,
				Soc.numero as [Numero de Tarjeta]	,
				Soc.vencimiento as [Vencimiento]	,
				Soc.Identificador 			,
				Cargo = (
						SELECT SUM(Imp.importe)
						FROM conceptos_socios Con
							INNER JOIN dbo.Conceptos Imp
							ON Imp.Concepto = Con.Concepto
							and Imp.Modalidad = 'I'

						WHERE Con.Socio = Soc.Socio
						AND ((Con.FechaBaja IS NULL and fechaVigencia<'20030101')
						or (FechaBaja>'20021231' and fechaVigencia<'20030101'))

/*
						WHERE Con.Socio = Soc.socio
						and (con.FechaBaja is null and 
						(convert(char(4),year(FechaVigencia)) + right((convert(varchar(2),month(FechaVigencia)) + 100),2)<=@aniomes) 
						or ((convert(char(4),year(FechaBaja)) + right((convert(varchar(2),month(FechaBaja)) + 100),2))>=@Aniomes) 
						and ((convert(char(4),year(FechaVigencia)) + right((convert(varchar(2),month(FechaVigencia)) + 100),2))<=@Aniomes))
*/
					),
				'Socios' as Dentidad
		from socios Soc

/* 			INNER JOIN dbo.grupos_socios Grupo
			ON Grupo.Socio = Soc.Socio
			and (Grupo.Grupo = @C_Grupo or @C_Grupo is null) */

		where Soc.FechaBaja is null
		and (Soc.debitardesde is null or Soc.debitardesde<'20030101')
		AND (Soc.Socio BETWEEN @N_Desde AND @N_Hasta OR @N_Desde is null)
		AND (Soc.Tarjeta = @C_Tarjeta or @C_Tarjeta is null)
		And (Soc.Cobrador = @N_Cobrador or @N_Cobrador is null)
		AND (
						SELECT SUM(Imp.importe)
						FROM conceptos_socios Con
							INNER JOIN dbo.Conceptos Imp
							ON Imp.Concepto = Con.Concepto
							and Imp.Modalidad = 'I'

						WHERE Con.Socio = Soc.Socio
						AND ((Con.FechaBaja IS NULL and fechaVigencia<'20030101')
						or (FechaBaja>'20021231' and fechaVigencia<'20030101'))
/*
						WHERE Con.Socio = Soc.socio
						and (con.FechaBaja is null and 
						(convert(char(4),year(FechaVigencia)) + right((convert(varchar(2),month(FechaVigencia)) + 100),2)<=@aniomes) 
						or ((convert(char(4),year(FechaBaja)) + right((convert(varchar(2),month(FechaBaja)) + 100),2))>=@Aniomes) 
						and ((convert(char(4),year(FechaVigencia)) + right((convert(varchar(2),month(FechaVigencia)) + 100),2))<=@Aniomes))
*/
					) is not null

	order by Dentidad, Apellido, Nombre, socio











GO
/****** Object:  StoredProcedure [dbo].[Generador_Cargos_Mes_PARAM]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO





CREATE          procedure [dbo].[Generador_Cargos_Mes_PARAM]

/*	@C_Grupo	char(2)	= NULL	, */
	@C_Tarjeta	Int	= -1	,
	@N_Cobrador	Int	= -1 	,
	@N_Desde	Int	= -1	,
	@N_Hasta	Int	= -1	,
	@Aniomes	int
AS

if @N_Cobrador = -1
	set @N_Cobrador = Null
if @N_Desde = -1
	set @N_Desde = Null
if @N_Hasta = -1
	set @N_Hasta = Null

	/****************************************************************/
	/* Devolver los datos						*/
	/****************************************************************/
		select	Soc.adherente as [Socio]	, 
				1 as Entidad				,
				Soc.apellido as [Apellido]	,
				Soc.nombre as [Nombre]		,
				Soc.tarjeta					,
				Soc.numero as [Numero de Tarjeta]	,
				Soc.vencimiento as [Vencimiento]	,
				Soc.Identificador 			,
				Cargo = (
						SELECT SUM(Imp.importe)
						FROM conceptos_adherentes Con
							INNER JOIN dbo.Conceptos Imp
							ON Imp.Concepto = Con.Concepto
							and Imp.Modalidad = 'I'
/*
						WHERE Con.Adherente = Soc.Adherente
						AND ((Con.FechaBaja IS NULL and fechaVigencia<'20030101')
						or (FechaBaja>'20021231' and fechaVigencia<'20030101'))
*/
						WHERE Con.Adherente = Soc.Adherente
						and (con.FechaBaja is null and 
						(convert(char(4),year(FechaVigencia)) + right((convert(varchar(2),month(FechaVigencia)) + 100),2)<=@aniomes) 
						or ((convert(char(4),year(FechaBaja)) + right((convert(varchar(2),month(FechaBaja)) + 100),2))>=@Aniomes) 
						and ((convert(char(4),year(FechaVigencia)) + right((convert(varchar(2),month(FechaVigencia)) + 100),2))<=@Aniomes))

					),
				'Foprosa' as Dentidad
		from adherentes Soc

/*			INNER JOIN dbo.grupos_adherentes Grupo
			ON Grupo.Adherente = Soc.Adherente
			and (Grupo.Grupo = @C_Grupo or @C_Grupo is null) */

		where Soc.FechaBaja is null
		and (Soc.debitardesde is null or Soc.debitardesde<'20030101')
		AND (Soc.Adherente BETWEEN @N_Desde AND @N_Hasta OR @N_Desde is null)
		AND (Soc.Tarjeta = @C_Tarjeta or @C_Tarjeta is null)
		And (Soc.Cobrador = @N_Cobrador or @N_Cobrador is null)
		AND (
						SELECT SUM(Imp.importe)
						FROM conceptos_Adherentes Con
							INNER JOIN dbo.Conceptos Imp
							ON Imp.Concepto = Con.Concepto
							and Imp.Modalidad = 'I'
/*
						WHERE Con.Adherente = Soc.Adherente
						AND ((Con.FechaBaja IS NULL and fechaVigencia<'20030101')
						or (FechaBaja>'20021231' and fechaVigencia<'20030101'))
*/

						WHERE Con.Adherente = Soc.Adherente
						and (con.FechaBaja is null and 
						(convert(char(4),year(FechaVigencia)) + right((convert(varchar(2),month(FechaVigencia)) + 100),2)<=@aniomes) 
						or ((convert(char(4),year(FechaBaja)) + right((convert(varchar(2),month(FechaBaja)) + 100),2))>=@Aniomes) 
						and ((convert(char(4),year(FechaVigencia)) + right((convert(varchar(2),month(FechaVigencia)) + 100),2))<=@Aniomes))

					) is not null




	Union 

		select		Soc.Socio				,
				0 as Entidad				,
				Soc.apellido as [Apellido]		,
				Soc.nombre as [Nombre]			,
				Soc.tarjeta				,
				Soc.numero as [Numero de Tarjeta]	,
				Soc.vencimiento as [Vencimiento]	,
				Soc.Identificador 			,
				Cargo = (
						SELECT SUM(Imp.importe)
						FROM conceptos_socios Con
							INNER JOIN dbo.Conceptos Imp
							ON Imp.Concepto = Con.Concepto
							and Imp.Modalidad = 'I'
						WHERE Con.Socio = Soc.socio
						and (con.FechaBaja is null and 
						(convert(char(4),year(FechaVigencia)) + right((convert(varchar(2),month(FechaVigencia)) + 100),2)<=@aniomes) 
						or ((convert(char(4),year(FechaBaja)) + right((convert(varchar(2),month(FechaBaja)) + 100),2))>=@Aniomes) 
						and ((convert(char(4),year(FechaVigencia)) + right((convert(varchar(2),month(FechaVigencia)) + 100),2))<=@Aniomes))
					),
				'Socios' as Dentidad
		from socios Soc

/* 			INNER JOIN dbo.grupos_socios Grupo
			ON Grupo.Socio = Soc.Socio
			and (Grupo.Grupo = @C_Grupo or @C_Grupo is null) */

		where Soc.FechaBaja is null
		and (Soc.debitardesde is null or Soc.debitardesde<'20030101')
		AND (Soc.Socio BETWEEN @N_Desde AND @N_Hasta OR @N_Desde is null)
		AND (Soc.Tarjeta = @C_Tarjeta or @C_Tarjeta is null)
		And (Soc.Cobrador = @N_Cobrador or @N_Cobrador is null)
		AND (
						SELECT SUM(Imp.importe)
						FROM conceptos_socios Con
							INNER JOIN dbo.Conceptos Imp
							ON Imp.Concepto = Con.Concepto
							and Imp.Modalidad = 'I'
						WHERE Con.Socio = Soc.socio
						and (con.FechaBaja is null and 
						(convert(char(4),year(FechaVigencia)) + right((convert(varchar(2),month(FechaVigencia)) + 100),2)<=@aniomes) 
						or ((convert(char(4),year(FechaBaja)) + right((convert(varchar(2),month(FechaBaja)) + 100),2))>=@Aniomes) 
						and ((convert(char(4),year(FechaVigencia)) + right((convert(varchar(2),month(FechaVigencia)) + 100),2))<=@Aniomes))
					) is not null



	order by Dentidad, Apellido, Nombre, socio











GO
/****** Object:  StoredProcedure [dbo].[GeneraObrasEnCursoResumido]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO






--Select * from valor_Dolar

CREATE Procedure [dbo].[GeneraObrasEnCursoResumido]
	@idObra			int=0,
	@Cierre			varchar(8)='20140630',
	@Desde			varchar(8)='',
	@Hasta			varchar(8)='',
	@TC				numeric(18,3)=8.133,
	@ComputerName	varchar(200)='SERVERBAIRES'
as
Delete from obrasAB where computerName=@ComputerName

Insert into obrasAB
Select case when ea.tipoMovimiento=22 then 0 else 1 end Modo,ea.idcampo idCampoEA,
a.notas,a.articulo,ea.docum,isnull(fechaDos,ho.fecha) fecha,substring(a.descripcion,1,19) descripcion,
ea.cantidad*ts.Signo*-1 Cantidad,case when ea.tipomovimiento=22 then ea.cantidad else isnull(bi.precio,a.precio) end precio,
case when ea.tipomovimiento=22 then ea.cantidad else ea.cantidad*isnull(bi.precio,a.precio)*ts.Signo*-1 end subtotalDolares,
case when ea.tipomovimiento=22 then ea.cantidad else ea.cantidad*isnull(bi.precio,a.precio)*ts.Signo*-1*@TC end Pesos,
ea.tipomovimiento,isnull(ea.idObra,hm.idobra) idobra,
cl.razonSocial,
ea.idProveedor,ea.fcProv,
ho1.fecha fechaFc,right(vch1.nrocomprobante,8) + ' ' +  vch1.tipofactura,ea.idcampoAnexo,mt.idcampo, mt.idoperacion,pv.razonsocial RazonSocialProveedor,nombreAvion,mat.matricula,@ComputerName
from EstadisticaArticulos ea
left join headerMovimientosStock hm
on ea.idoperacion=hm.idoperacion
left join Header_operaciones ho 
on hm.idOperacion=ho.idoperacion
inner join tiposMovimientoStock t
on ea.tipomovimiento=t.idtipoMovimientoStock
left join Articulos a
on ea.idArticulo=a.idArticulo
left join baseinventarios bi
on a.idarticulo=bi.idarticulo and substring(@Cierre,1,6) between vigenciadesde and vigenciaHasta
inner join cuentas ct
on ct.cuenta=132000
left join anexoMateriales mt 
on ea.idcampoanexo=mt.idcampo and mt.partNumber=ea.articuloProveedor and mt.idOperacion is not null
left join Header_operaciones ho1
on mt.idOPeracion=ho1.idoperacion
left join detalle_operaciones do1
on ho1.idoperacion=do1.idoperacion and idtipotransaccion=0
left join vencliheader vch1
on do1.idtransaccion=vch1.idtransaccion
inner join obras o
on hm.idobra=o.idObra
inner join clientes cl
on o.idcliente=cl.codigo
left join proveedores pv
on ea.idproveedor=pv.codigo
inner join tiposMovimientoStock ts
on ea.tipoMovimiento=ts.idtipomovimientoStock
inner join matriculas mat
on o.idmatricula=mat.idmatricula
where isnull(fechaDos,ho.fecha)<=@Cierre and isnull(ea.fecfactura,'29001231')>@Cierre
and (tipoMovimiento=4 or TipoMovimiento=9 or TipoMovimiento=22)
and (@idObra=0 or o.idObra=@idOBra)
and (isnull(fechaDos,ho.fecha)>isnull(o.cierre,'19000101'))
and isnull(fechaDos,ho.fecha) between case when @Desde='' then '19000101' else @Desde end 
and case when @Hasta='' then '29000101' else @Hasta end 
union 
Select case when ea.tipoMovimiento=22 then 0 else 1 end Modo,ea.idcampo idCampoEA,
a.notas,a.articulo,ea.docum,isnull(fechaDos,ho.fecha) fecha,substring(a.descripcion,1,19) descripcion,
ea.cantidad*ts.Signo*-1 Cantidad,case when ea.tipomovimiento=22 then ea.cantidad else isnull(bi.precio,a.precio) end precio,
case when ea.tipomovimiento=22 then ea.cantidad else ea.cantidad*isnull(bi.precio,a.precio)*ts.Signo*-1 end subtotalDolares,
case when ea.tipomovimiento=22 then ea.cantidad else ea.cantidad*isnull(bi.precio,a.precio)*ts.Signo*-1*@TC end Pesos,
ea.tipomovimiento,isnull(ea.idObra,hm.idobra) idobra,
cl.razonSocial,
ea.idProveedor,ea.fcProv,
ho1.fecha fechaFc,right(vch1.nrocomprobante,8) + ' ' +  vch1.tipofactura,ea.idcampoAnexo,mt.idcampo, mt.idoperacion,pv.razonsocial RazonSocialProveedor,nombreAvion,mat.matricula,@ComputerName
from EstadisticaArticulos ea
left join headerMovimientosStock hm
on ea.idoperacion=hm.idoperacion
left join Header_operaciones ho 
on hm.idOperacion=ho.idoperacion
inner join tiposMovimientoStock t
on ea.tipomovimiento=t.idtipoMovimientoStock
left join Articulos a
on ea.idArticulo=a.idArticulo
left join baseinventarios bi
on a.idarticulo=bi.idarticulo and substring(@Cierre,1,6) between vigenciadesde and vigenciaHasta
inner join cuentas ct
on ct.cuenta=132000
left join anexoMateriales mt 
on ea.idcampoanexo=mt.idcampo and mt.partNumber=ea.articuloProveedor and mt.idOperacion is not null
left join Header_operaciones ho1
on mt.idOPeracion=ho1.idoperacion
left join detalle_operaciones do1
on ho1.idoperacion=do1.idoperacion and idtipotransaccion=0
left join vencliheader vch1
on do1.idtransaccion=vch1.idtransaccion
inner join obras o
on ea.idObra=o.idObra
inner join clientes cl
on o.idcliente=cl.codigo
left join proveedores pv
on ea.idproveedor=pv.codigo
inner join tiposMovimientoStock ts
on ea.tipoMovimiento=ts.idtipomovimientoStock
inner join matriculas mat
on o.idmatricula=mat.idmatricula
where isnull(fechaDos,ho.fecha)<=@Cierre and isnull(ea.fecfactura,'29001231')>@Cierre
and (tipoMovimiento=4 or TipoMovimiento=9 or TipoMovimiento=22)
and (@idObra=0 or o.idObra=@idOBra)
and (isnull(fechaDos,ho.fecha)>isnull(o.cierre,'19000101'))
and isnull(fechaDos,ho.fecha) between case when @Desde='' then '19000101' else @Desde end 
and case when @Hasta='' then '29000101' else @Hasta end 
union 
Select 
0 Modo,cph.idtransaccion idCampoEA,
'' notas,'' articulo,0 docum,ho.fecha fecha,'' descripcion,
1 Cantidad,cpi.importe precio,0 subtotalDolares,
tmh.Multiplicador*cpi.importe*case when moneda=1 then TC else 1 end Pesos,
cph.tipoComprobante tipomovimiento,cpi.area idobra,
cl.razonsocial razonSocial,
isnull(pv.codigo,pf.proveedor) idproveedor,right(cph.nroComprobante,8) nrocomprobante,
cph.fecha fechaFc,'' Observacion,0 idcampoAnexo,0 idcampo, 0 idoperacion,
isnull(pv.razonSocial,pf.razonsocial) razonSocialProveedor,nombreAvion,mat.matricula,@ComputerName
from header_operaciones ho 
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion 
inner join CompProvHeader cph
on do.idtransaccion=cph.idtransaccion 
inner join tipCompModHeader tmh 
on cph.tipoComprobante=tmh.codigo
inner join compProvItems cpi
on cph.idtransaccion=cpi.idtransaccion 
left join proveedores pv
on cph.proveedor=pv.codigo
left join provFondo pf
on cph.proveedor=pf.proveedor
inner join obras o
on cpi.area=o.idObra
inner join clientes cl
on o.idcliente=cl.codigo
inner join matriculas mat
on o.idmatricula=mat.idmatricula
where idtipotransaccion=1 
and ho.fecha<=@Cierre and isnull(cpi.FechaCierre,'29001231')>@Cierre
and (@idObra=0 or cpi.Area=@idOBra)
and ho.fecha between case when @Desde='' then '19000101' else @Desde end 
and case when @Hasta='' then '29000101' else @Hasta end 
AND cpi.cuenta=132000
union 
Select 
0 Modo,cph.idtransaccion idCampoEA,
'' notas,'' articulo,0 docum,ho.fecha fecha,'' descripcion,
1 Cantidad,cpi.importe precio,0 subtotalDolares,
tmh.Multiplicador*cpi.importe Pesos,
cph.tipoComprobante tipomovimiento,cpi.area idobra,
cl.razonSocial,
isnull(pv.codigo,pf.proveedor) idproveedor,right(cph.nroComprobante,8) nrocomprobante,
cph.fecha fechaFc,'' Observacion,0 idcampoAnexo,0 idcampo, 0 idoperacion,
isnull(pv.razonSocial,pf.razonsocial) razonSocialProveedor,nombreAvion,mat.matricula,@ComputerName
from header_operaciones ho 
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion 
inner join CompFondosHeader cph
on do.idtransaccion=cph.idtransaccion 
inner join tipCompModHeader tmh 
on cph.tipoComprobante=tmh.codigo
inner join compFondosItems cpi
on cph.idtransaccion=cpi.idtransaccion 
left join proveedores pv
on cph.proveedor=pv.codigo
left join provFondo pf
on cph.proveedor=pf.proveedor
inner join obras o
on cpi.area=o.idObra
inner join clientes cl
on o.idcliente=cl.codigo
inner join matriculas mat
on o.idmatricula=mat.idmatricula
where idtipotransaccion=3 
and ho.fecha<=@Cierre and isnull(cpi.FechaCierre,'29001231')>@Cierre
and (@idObra=0 or cpi.Area=@idOBra)
and ho.fecha between case when @Desde='' then '19000101' else @Desde end 
and case when @Hasta='' then '29000101' else @Hasta end 
AND cpi.cuentaneto=132000

order by idObra,Modo















GO
/****** Object:  StoredProcedure [dbo].[GeneraRecibosDebitos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE     Procedure [dbo].[GeneraRecibosDebitos]
(
	@pDesde	int=200201,
	@pHasta	int=200512,
	@sDesde	int=0,
	@sHasta	int=9999999
)
as

Declare @idOperacion int

Insert into RecibosDA
(pDesde, pHasta, cDesde, cHasta)
values
(@pDesde,@pHasta,@sDesde,@sHasta)

select @idOperacion=@@identity

DECLARE @DumpCC TABLE 
(Socio int, Entidad int,idtransaccion int,importe numeric(18,2))

insert into @DumpCC
Select Distinct cc.socio,cc.entidad,cc.idtransaccion,cc.importe
from cuentasCorrientes cc
inner join aplicacionesCuentasCorrientes acc
on cc.idtransaccion=acc.idtransaccion
inner join cuentasCorrientes cc1
on cc1.idtransaccion=acc.idtransaccionCancelada
left join Detalle_RecibosDA dr
on cc.idtransaccion=dr.idtransaccion
where cc.concepto='DA' and cc1.concepto<>'RDA'
and cc.documentonumero between @pDesde and @pHasta
and dr.idtransaccion is null

Insert into Header_RecibosDA 
(Entidad,Socio,Fecha,idOperacion,Importe)
Select Entidad,Socio,Getdate(),@idOperacion,Sum(importe)
from @DumpCC
Group by Entidad,Socio

insert into Detalle_recibosDA
Select idRecibo,idtransaccion from @DumpCC d
inner join Header_RecibosDA hDA
on d.socio=hda.socio and d.entidad=hda.entidad



GO
/****** Object:  StoredProcedure [dbo].[GetNextIdentity]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


CREATE proc [dbo].[GetNextIdentity] @ForTable Char(50), @Value int OUTPUT
AS
set nocount on
begin tran
/* if this is the first value generated for this table, start with zero */ 
  if not exists (select * from IdentityTable where ForTable = @ForTable)
    insert IdentityTable (ForTable, Value) values (@ForTable, 0)
/* update must be before select to issue a lock and prevent duplicates */ 
  update IdentityTable
    set Value = Value + 1 
    where ForTable = @ForTable
  select @Value = Value from IdentityTable
    where ForTable = @ForTable
commit tran
return @value

GO
/****** Object:  StoredProcedure [dbo].[GrabaPresentacion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE        Procedure [dbo].[GrabaPresentacion] -- 
-- GrabaPresentacion '20060131',1,200601,'Visa Enero 200601',0,0

-- exec GrabaPresentacion '20060831', 1, 200608, default, default, default

(
	@FechaPresentacion			char(8),
	@Tarjeta				Int	,
	@Aniomes				int	,
	@observacion				varchar(50)='Presentacion Debito'	,
	@idusuario				int=0,
	@idoperadortesoreria	int=0

)

as
-- Begin transaction 

declare @tarjetaPlan as int


set @observacion='Presentacion ' + case when @tarjeta=1 then 'Visa '
				      when @tarjeta=2 then 'MasterCard '
					  else 'Tarjeta de Credito ' end + cast(@aniomes as char(6))

declare @idOperacion int
--begin transaction

if @Tarjeta =1 
	select @tarjetaPlan=100
else
	select @tarjetaPlan=200

Declare @mes int = cast( substring(cast(@aniomes as varchar(6)),5,2) as int)
Declare @Trimestre varchar(2) = case when @mes in (1,2,3) then '01' when @mes in (4,5,6) then '02' when @mes in (7,8,9) then '03' when @mes in (10,11,12) then '04' end

insert into header_operaciones(fecha,tipodeoperacion,observacion,
idusuario,idoperadortesoreria,procesado,asientodiario,aniomes,tipoasiento,cuenta,comprobantenumero,serie,observacioncomprobante) 
values
(getdate(),60,@observacion,@idusuario,@idoperadortesoreria,
getdate(),0,@aniomes,0,@Tarjeta,0,'','')
select @idOperacion=@@identity

Delete from PresentacionesTarjetas
where tarjeta in (@tarjeta,@tarjetaPlan) and periodo=@Aniomes

insert into PresentacionesTarjetas
Select tarjeta,@aniomes as periodo,socio,entidad,Cargo,replace([numero de tarjeta] ,' ','') [numero de tarjeta] 
from fnGenerador_Cargos_Mes(@tarjeta,null,null,null,@aniomes)


DECLARE Conceptos CURSOR FOR 
(
Select 
pt.socio,pt.entidad, pt.importe,0 as numero,cc.idtransaccion,cc.cancelado
from  presentacionestarjetas pt
Inner join CuentasCorrientes cc
on cc.entidad=pt.entidad and cc.socio=pt.socio 
Where (cc.documentoNumero=substring(cast(@ANIOMES as char(6)),1,4) or (dbo.toaniomes(cc.fecha)=@Aniomes and cc.entidad=2)
or (cc.DocumentoNumero=@ANIOMES and cc.concepto='PTT')) 
and pt.tarjeta in (@tarjeta,@tarjetaPlan)
and (cc.concepto='MES' or concepto='CUO' or concepto='MAT' or concepto='CS'  or concepto='PTT')
and isnull(cc.cancelado,0)<cc.importe
and (documentoNumero=concat(substring(cast(@ANIOMES as char(6)),1,4),@Trimestre) or pt.periodo=@ANIOMES)
and pt.periodo=@ANIOMES																						
)
Union
(
Select pt.socio,pt.entidad,cc.importe,0 as numero,cc.idtransaccion,cc.cancelado
--,cc.documentoNumero,tj.mesaimputar
from  presentacionestarjetas pt
inner join complementoTarjetasCredito tj
on pt.socio=tj.socio and pt.Entidad=tj.Entidad and pt.periodo=tj.aniomes
Inner join CuentasCorrientes cc
on cc.entidad=tj.entidad and cc.socio=tj.socio and cc.documentonumero=tj.MesaImputar
Where 
pt.periodo=@aniomes and pt.tarjeta in (@tarjeta,@tarjetaPlan) and isnull(cc.cancelado,0)<cc.importe and (cc.concepto='MES' or concepto='CUO' or concepto='MAT' or concepto='CS'  or concepto='PTT')
)
order by pt.entidad, pt.socio

Declare @Socio int
Declare @Entidad int
Declare @Cargo numeric(18,2)
Declare @Numero numeric(18,0)
Declare @idTransaccionOrigen numeric(18,0)
Declare @Cancelado numeric(18,2)
--  Abro el Cursor 
OPEN Conceptos
FETCH NEXT FROM Conceptos INTO @Socio,@Entidad, @Cargo,@Numero,@idTransaccionOrigen,@Cancelado
Declare @idTransaccion int
-- Recorro el Cursor 
WHILE @@FETCH_STATUS = 0
BEGIN

	insert into CuentasCorrientes 
	(socio,entidad,fecha,Concepto,DocumentoNumero,Importe,Cancelado)
	values
	(@Socio,@entidad,@FechaPresentacion,'DA',@aniomes,@Cargo,@Cargo)
	select @idtransaccion=@@identity
	
	insert into Detalle_Operaciones 
	values (@idOperacion,0,@idTransaccion,0)

	insert into AplicacionesCuentasCorrientes 
	values (@idtransaccion,1,@idtransaccionOrigen,@cargo)

	Update CuentasCorrientes 
	set cancelado=(select sum(isnull(importe,0)) from aplicacionescuentascorrientes 
			where idtransaccioncancelada=@idtransaccionOrigen)
	where idtransaccion=@idtransaccionOrigen

	FETCH NEXT FROM Conceptos INTO @Socio,@Entidad, @Cargo,@Numero,@idtransaccionOrigen,@Cancelado

END

CLOSE Conceptos
DEALLOCATE Conceptos

-- Commit transaction




GO
/****** Object:  StoredProcedure [dbo].[Guarda_Novedades]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create Procedure [dbo].[Guarda_Novedades] (@Periodo int, @Aniomes int)
as
Update ConceptosLegajosNovedades 
set aniomes=@Aniomes, periodo=@Periodo

Delete ConceptosLegajosNovedadesDiciembreFinal
Where aniomes=@Aniomes and periodo=@Periodo

insert into ConceptosLegajosNovedadesDiciembreFinal
Select * from ConceptosLegajosNovedades 



GO
/****** Object:  StoredProcedure [dbo].[GuardaCambiosCV]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE   Procedure [dbo].[GuardaCambiosCV]
(
	@idOperacion int
)
as
Declare @tipodeOperacion int
Select @tipodeOperacion=tipodeOperacion from Header_operaciones where idOperacion=@idOperacion
Insert into asientosdiariositemsCVAnulados
Select ai.*,Getdate() from Header_operaciones ho
inner join asientosdiariositems ai 
on ho.asientoDiario=ai.asiento and ho.aniomes=ai.aniomes and ho.tipoasiento=ai.tipoasiento
where idOperacion=@idOperacion

Delete ai from Header_operaciones ho
inner join asientosdiariositems ai 
on ho.asientoDiario=ai.asiento and ho.aniomes=ai.aniomes and ho.tipoasiento=ai.tipoasiento
where idOperacion=@idOperacion

Insert into CompProvitemsAnulados
Select cpi.*,Getdate() from Header_operaciones ho
inner join Detalle_operaciones do
on ho.idOperacion=do.idOperacion
inner join CompProvItems cpi 
on do.idtransaccion=cpi.idtransaccion 
where ho.idOperacion=@idOperacion
and idTipoTransaccion=1

Delete cpi from Header_operaciones ho
inner join Detalle_operaciones do
on ho.idOperacion=do.idOperacion
inner join CompProvItems cpi 
on do.idtransaccion=cpi.idtransaccion 
where ho.idOperacion=@idOperacion
and idTipoTransaccion=1

Insert into VenCliitemsAnulados
Select cpi.*,Getdate() from Header_operaciones ho
inner join Detalle_operaciones do
on ho.idOperacion=do.idOperacion
inner join VenCliitems cpi 
on do.idtransaccion=cpi.idtransaccion 
where ho.idOperacion=@idOperacion
and idTipoTransaccion=0

Delete cpi from Header_operaciones ho
inner join Detalle_operaciones do
on ho.idOperacion=do.idOperacion
inner join VenCliitems cpi 
on do.idtransaccion=cpi.idtransaccion 
where ho.idOperacion=@idOperacion
and idTipoTransaccion=0

Insert into EstadisticaArticulosPreciosAnulados
Select cppi.*,Getdate() from Header_operaciones ho
inner join EstadisticaArticulos cpi 
on ho.idOperacion=cpi.idOperacion
inner join EstadisticaArticulosPrecios cppi 
on cpi.idCampo=cppi.idcampo
where ho.idOperacion=@idOperacion

Delete cppi from Header_operaciones ho
inner join EstadisticaArticulos cpi 
on ho.idOperacion=cpi.idOperacion
inner join EstadisticaArticulosPrecios cppi 
on cpi.idCampo=cppi.idcampo
where ho.idOperacion=@idOperacion

Insert into EstadisticaArticulosAnulados
Select cpi.*,Getdate() from Header_operaciones ho
inner join EstadisticaArticulos cpi 
on ho.idOperacion=cpi.idOperacion
where ho.idOperacion=@idOperacion

Delete cpi from Header_operaciones ho
inner join EstadisticaArticulos cpi 
on ho.idOperacion=cpi.idOperacion
where ho.idOperacion=@idOperacion




GO
/****** Object:  StoredProcedure [dbo].[GuardaCambiosCVDiario]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create Procedure [dbo].[GuardaCambiosCVDiario]
(
	@aniomes int,
	@Comprobante int
)
as

Insert into CompProvitemsAnulados
Select cpi.*,Getdate() from CompProvItems cpi 
where Comprobante=@Comprobante and aniomes=@aniomes

Delete cpi from CompProvItems cpi 
where Comprobante=@Comprobante and aniomes=@aniomes


GO
/****** Object:  StoredProcedure [dbo].[Header_Obra]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE Procedure [dbo].[Header_Obra]
(
	@idObra	int=7872,
	@Dia	int=7,	
	@Mes	int=7,
	@AA		int=2009,
	@nFac	varchar(13)='',
	@idOperacion	int=0
)
as
Select cl.codigo,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))>0 then RazonSocial else '' end as RazonSocial,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))=0 then RazonSocial else cl.adicional end as adicional,
Domicilio,codigopostal,localidad,p.descripcion provincia,
t.detalle,t.precio*case when tipoFactura='B' then 1 /* 1.1 */ /* 1.21 */ else 1 end,t.idcampo, 'Anexo de Materiales - Factura Numero ',case when isnull(vh.moneda,isnull(MonedaPre,0))=0 then '$' else 'u$s' end Signo,
case when len(ltrim(rtrim(codigopostal)))>0 then ltrim(rtrim(CodigoPostal)) + ' - ' + localidad else localidad end cposloc,
ho.fecha,cl.cuit, ci.descripcion

from obras o
inner join matriculas m
on o.idmatricula=m.idmatricula
inner join clientes cl
on m.idcliente=cl.codigo
left join provincias p
on cl.idprovincia=p.provincia
inner join TempFacturacionMO t 
on o.idObra=t.idobra
left join Header_operaciones ho 
on t.idOperacion=ho.idOperacion
--
left join detalle_operaciones do
on ho.idOPeracion=do.idOperacion
left join Vencliheader vh
on do.idtransaccion=vh.idtransaccion
left join categorias_Iva ci
on ci.idciva=cl.civa

where o.idoBra=@idobra
and isnull(t.idOPeracion,0)=@idOperacion
and isnull(do.idtipotransaccion,0)=0








GO
/****** Object:  StoredProcedure [dbo].[Header_Obra_Materiales]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE Procedure [dbo].[Header_Obra_Materiales]
(
	@idObra	int=8411,
	@Dia	int=7,	
	@Mes	int=7,
	@AA		int=2009,
	@nFac	varchar(13)='0001-00001234',
	@idOperacion	int=270401
)
as
Select cl.codigo,-- ho.fecha,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))>0 then RazonSocial else '' end as RazonSocial,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))=0 then RazonSocial else cl.adicional end as adicional
,Domicilio,codigopostal,localidad,p.descripcion provincia
,substring(t.descripcion,1,19) descripcion,t.PartNumber, 'Anexo de Materiales - Factura Numero: ' Blableta,
ROUND(round(round(t.precio*coeficiente,2)*case 
when tipoFactura='B' then 1.21 else 1 end + case when t.partnumber='100-389018-23' and t.idoperacion=226610 then -.04 else 0 end ,3),2) precio,
t.PartNumber ArticuloProveedor
,case when avg(t.afacturarmanual)=0 then SUM(t.cantidad) else avg(t.afacturarmanual) end cantidad,
--,SUM(t.cantidad) cantidad,
ROUND(case when avg(t.afacturarmanual)=0 then SUM(t.cantidad) else avg(t.afacturarmanual) end*round(round(t.precio*coeficiente,2)*case 
when tipoFactura='B' then 1.21 else 1 end + case when t.partnumber='100-389018-23' and t.idoperacion=226610 then -.04 else 0 end,3),2) as Subtotal,
case when isnull(vh.moneda,1)=0 then '$' else 'u$s' end Signo,
case when len(ltrim(rtrim(codigopostal)))>0 then ltrim(rtrim(CodigoPostal)) + ' - ' + localidad else localidad end cposloc
,ho.fecha, cl.cuit, ci.descripcion dCiva /*, ( Select unitario from header_operaciones ho
inner join estadisticaArticulos do 
on ho.idoperacion=do.idoperacion
inner join estadisticaarticulosPrecios eap
on do.idcampo=eap.idcampo


where  ho.idoperacion=@idOperacion
and eap.cuenta=430000 ) as Materiales
*/
from obras o
inner join matriculas m
on o.idmatricula=m.idmatricula
inner join clientes cl
on m.idcliente=cl.codigo
left join provincias p
on cl.idprovincia=p.provincia
inner join AnexoMateriales t 
on o.idObra=t.idobra
left join Header_operaciones ho 
on t.idOperacion=ho.idOperacion
--
left join detalle_operaciones do
on ho.idOPeracion=do.idOperacion
left join Vencliheader vh
on do.idtransaccion=vh.idtransaccion 
left join categorias_Iva ci
on ci.idciva=cl.civa

where o.idoBra=@idobra
and aFacturar<>0 and 
(isnull(t.idOperacion,0)=@idOperacion)

and isnull(do.idtipotransaccion,0)=0

Group by cl.codigo, ho.fecha,case when len(ltrim(rtrim(isnull(cl.adicional,''))))>0 then RazonSocial else '' end,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))=0 then RazonSocial else cl.adicional end,Domicilio,codigopostal,localidad,p.descripcion 
,substring(t.descripcion,1,19) ,t.PartNumber, 
round(round(t.precio*coeficiente,2)*case when tipoFactura='B' then 1.21 else 1 end+ case when t.partnumber='100-389018-23' and t.idoperacion=226610 then -.04 else 0 end,3),isnull(vh.moneda,1),
case when len(ltrim(rtrim(codigopostal)))>0 then ltrim(rtrim(CodigoPostal)) + ' - ' + localidad else localidad end,
cl.cuit, ci.descripcion

--Having SUM(cantidad)<>0












GO
/****** Object:  StoredProcedure [dbo].[Header_Obra_Materiales_Ok]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE Procedure [dbo].[Header_Obra_Materiales_Ok]
(
	@idObra	int=7787,
	@Dia	int=7,	
	@Mes	int=7,
	@AA		int=2009,
	@nFac	varchar(13)='0001-00001234',
	@idOperacion	int=252300
)
as
Select cl.codigo,-- ho.fecha,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))>0 then RazonSocial else '' end as RazonSocial,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))=0 then RazonSocial else cl.adicional end as adicional
,Domicilio,codigopostal,localidad,p.descripcion provincia
,substring(t.descripcion,1,19) descripcion,t.PartNumber, 'Anexo de Materiales - Factura Numero: ' Blableta,
ROUND(round(round(t.precio*coeficiente,2)*case 
when tipoFactura='B' then 1.21 else 1 end + case when t.partnumber='100-389018-23' and t.idoperacion=226610 then -.04 else 0 end ,3),2) precio,
t.PartNumber ArticuloProveedor
,SUM(t.cantidad) cantidad,
ROUND(SUM(cantidad)*round(round(t.precio*coeficiente,2)*case 
when tipoFactura='B' then 1.21 else 1 end + case when t.partnumber='100-389018-23' and t.idoperacion=226610 then -.04 else 0 end,3),2) as Subtotal,
case when isnull(vh.moneda,1)=0 then '$' else 'u$s' end Signo,
case when len(ltrim(rtrim(codigopostal)))>0 then ltrim(rtrim(CodigoPostal)) + ' - ' + localidad else localidad end cposloc
,ho.fecha, cl.cuit, ci.descripcion dCiva /*, ( Select unitario from header_operaciones ho
inner join estadisticaArticulos do 
on ho.idoperacion=do.idoperacion
inner join estadisticaarticulosPrecios eap
on do.idcampo=eap.idcampo


where  ho.idoperacion=@idOperacion
and eap.cuenta=430000 ) as Materiales
*/
from obras o
inner join matriculas m
on o.idmatricula=m.idmatricula
inner join clientes cl
on m.idcliente=cl.codigo
left join provincias p
on cl.idprovincia=p.provincia
inner join AnexoMateriales t 
on o.idObra=t.idobra
left join Header_operaciones ho 
on t.idOperacion=ho.idOperacion
--
left join detalle_operaciones do
on ho.idOPeracion=do.idOperacion
left join Vencliheader vh
on do.idtransaccion=vh.idtransaccion 
left join categorias_Iva ci
on ci.idciva=cl.civa

where o.idoBra=@idobra
and aFacturar<>0 and 
(isnull(t.idOperacion,0)=@idOperacion)

and isnull(do.idtipotransaccion,0)=0

Group by cl.codigo, ho.fecha,case when len(ltrim(rtrim(isnull(cl.adicional,''))))>0 then RazonSocial else '' end,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))=0 then RazonSocial else cl.adicional end,Domicilio,codigopostal,localidad,p.descripcion 
,substring(t.descripcion,1,19) ,t.PartNumber, 
round(round(t.precio*coeficiente,2)*case when tipoFactura='B' then 1.21 else 1 end+ case when t.partnumber='100-389018-23' and t.idoperacion=226610 then -.04 else 0 end,3),isnull(vh.moneda,1),
case when len(ltrim(rtrim(codigopostal)))>0 then ltrim(rtrim(CodigoPostal)) + ' - ' + localidad else localidad end,
cl.cuit, ci.descripcion

--Having SUM(cantidad)<>0










GO
/****** Object:  StoredProcedure [dbo].[Header_Obra_MaterialesPresupuesto]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE Procedure [dbo].[Header_Obra_MaterialesPresupuesto]
(
	@idObra	int=7155,
	@Dia	int=7,	
	@Mes	int=7,
	@AA		int=2009,
	@nFac	varchar(13)='0001-00001234',
	@idOperacion	int=224104
)
as
Select cl.codigo,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))>0 then RazonSocial else '' end as RazonSocial,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))=0 then RazonSocial else cl.adicional end as adicional
,Domicilio,codigopostal,localidad,p.descripcion provincia
,substring(t.descripcion,1,19) descripcion,t.PartNumber, 'Anexo de Materiales - Presupuesto Numero: ' Blableta,
ROUND(round(round(t.precio*coeficiente,2)*case when tipoFactura='B' then 1.21 else 1 end + case when t.partnumber='A-3044' and ho.idoperacion=216612 then -.01 else 0 end ,3),2) precio,t.PartNumber ArticuloProveedor
,case when avg(t.afacturarmanual)=0 then SUM(t.cantidad) else avg(t.afacturarmanual) end cantidad,ROUND(case when avg(t.afacturarmanual)=0 then SUM(t.cantidad) else avg(t.afacturarmanual) end*round(round(t.precio*coeficiente,2)*case when tipoFactura='B' then 1.21 else 1 end + case when t.partnumber='A-3044' and ho.idoperacion=216612 then -.01 else 0 end,3),2) as Subtotal,
case when isnull(vh.moneda,0)=0 then '$' else 'u$s' end Signo,
case when len(ltrim(rtrim(codigopostal)))>0 then ltrim(rtrim(CodigoPostal)) + ' - ' + localidad else localidad end cposloc

from obras o
inner join matriculas m
on o.idmatricula=m.idmatricula
inner join clientes cl
on m.idcliente=cl.codigo
left join provincias p
on cl.idprovincia=p.provincia
inner join AnexoMateriales t 
on o.idObra=t.idobra
left join Header_operaciones ho 
on t.idOperacionPresupuesto=ho.idOperacion
--
left join detalle_operaciones do
on ho.idOPeracion=do.idOperacion
left join Presupuestos vh
on do.idtransaccion=vh.idtransaccion 

where o.idoBra=@idobra
and aFacturar<>0 and 
(isnull(ho.idOperacion,0)=@idOperacion)

and isnull(do.idtipotransaccion,0)=10

Group by cl.codigo,case when len(ltrim(rtrim(isnull(cl.adicional,''))))>0 then RazonSocial else '' end,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))=0 then RazonSocial else cl.adicional end,Domicilio,codigopostal,localidad,p.descripcion 
,substring(t.descripcion,1,19) ,t.PartNumber, 
round(round(t.precio*coeficiente,2)*case when tipoFactura='B' then 1.21 else 1 end+ case when t.partnumber='A-3044' and ho.idoperacion=216612 then -.01 else 0 end,3),isnull(vh.moneda,0),
case when len(ltrim(rtrim(codigopostal)))>0 then ltrim(rtrim(CodigoPostal)) + ' - ' + localidad else localidad end 

--Having SUM(cantidad)<>0






GO
/****** Object:  StoredProcedure [dbo].[Header_Obra_MaterialesPresupuestoPost]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE Procedure [dbo].[Header_Obra_MaterialesPresupuestoPost]
(
	@idObra	int=7309,
	@Dia	int=7,	
	@Mes	int=7,
	@AA		int=2009,
	@nFac	varchar(13)='0001-00001234',
	@idOperacion	int=232818
)
as
Select cl.codigo,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))>0 then RazonSocial else '' end as RazonSocial,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))=0 then RazonSocial else cl.adicional end as adicional
,Domicilio,codigopostal,localidad,p.descripcion provincia
,substring(t.descripcion,1,19) descripcion,t.PartNumber, 'Anexo de Materiales - Factura Numero: ' Blableta,
ROUND(round(round(t.precio*coeficiente,2)*case when tipoFactura='B' then 1.21 else 1 end + case when t.partnumber='100-389018-23' and ho.idoperacion=226610 then -.04 else 0 end ,3),2) precio,t.PartNumber ArticuloProveedor
,SUM(t.cantidad) cantidad,ROUND(SUM(cantidad)*round(round(t.precio*coeficiente,2)*case when tipoFactura='B' then 1.21 else 1 end + case when t.partnumber='100-389018-23' and ho.idoperacion=226610 then -.04 else 0 end,3),2) as Subtotal,
case when isnull(vh.moneda,0)=0 then '$' else 'u$s' end Signo,
case when len(ltrim(rtrim(codigopostal)))>0 then ltrim(rtrim(CodigoPostal)) + ' - ' + localidad else localidad end cposloc,tipoFactura


from obras o
inner join matriculas m
on o.idmatricula=m.idmatricula
inner join clientes cl
on m.idcliente=cl.codigo
left join provincias p
on cl.idprovincia=p.provincia
inner join AnexoMateriales t 
on o.idObra=t.idobra
left join Header_operaciones ho 
on ho.idOperacion=@idOperacion
--
left join detalle_operaciones do
on ho.idOPeracion=do.idOperacion
left join Presupuestos vh
on do.idtransaccion=vh.idtransaccion 

where o.idoBra=@idobra
and aFacturar<>0 and 
(isnull(idOperacionPresupuesto,0)=@idOperacion)

and isnull(do.idtipotransaccion,0)=10

Group by cl.codigo,case when len(ltrim(rtrim(isnull(cl.adicional,''))))>0 then RazonSocial else '' end,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))=0 then RazonSocial else cl.adicional end,Domicilio,codigopostal,localidad,p.descripcion 
,substring(t.descripcion,1,19) ,t.PartNumber, 
round(round(t.precio*coeficiente,2)*case when tipoFactura='B' then 1.21 else 1 end+ case when t.partnumber='100-389018-23' and ho.idoperacion=226610 then -.04 else 0 end,3),isnull(vh.moneda,0),
case when len(ltrim(rtrim(codigopostal)))>0 then ltrim(rtrim(CodigoPostal)) + ' - ' + localidad else localidad end ,tipoFactura

--Having SUM(cantidad)<>0











GO
/****** Object:  StoredProcedure [dbo].[Header_Obra_MaterialesPresupuestoPostFC]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


Create Procedure [dbo].[Header_Obra_MaterialesPresupuestoPostFC]
(
	@idObra	int=6965,
	@Dia	int=7,	
	@Mes	int=7,
	@AA		int=2009,
	@nFac	varchar(13)='0001-00001234',
	@idOperacion	int=219450
)
as
Select cl.codigo,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))>0 then RazonSocial else '' end as RazonSocial,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))=0 then RazonSocial else cl.adicional end as adicional
,Domicilio,codigopostal,localidad,p.descripcion provincia
,substring(t.descripcion,1,19) descripcion,t.PartNumber, 'Anexo de Materiales - Factura Numero: ' Blableta,
ROUND(round(round(t.precio*coeficiente,2)*case when tipoFactura='B' then 1.21 else 1 end + case when t.partnumber='100-389018-23' and ho.idoperacion=226610 then -.04 else 0 end ,3),2) precio,t.PartNumber ArticuloProveedor
,SUM(t.cantidad) cantidad,ROUND(SUM(cantidad)*round(round(t.precio*coeficiente,2)*case when tipoFactura='B' then 1.21 else 1 end + case when t.partnumber='100-389018-23' and ho.idoperacion=226610 then -.04 else 0 end,3),2) as Subtotal,
case when isnull(vh.moneda,0)=0 then '$' else 'u$s' end Signo,
case when len(ltrim(rtrim(codigopostal)))>0 then ltrim(rtrim(CodigoPostal)) + ' - ' + localidad else localidad end cposloc


from obras o
inner join matriculas m
on o.idmatricula=m.idmatricula
inner join clientes cl
on m.idcliente=cl.codigo
left join provincias p
on cl.idprovincia=p.provincia
inner join AnexoMateriales t 
on o.idObra=t.idobra
left join Header_operaciones ho 
on t.idOperacion=ho.idOperacion
--
left join detalle_operaciones do
on ho.idOPeracion=do.idOperacion
left join Vencliheader vh
on do.idtransaccion=vh.idtransaccion 

where o.idoBra=@idobra
and aFacturar<>0 and 
(isnull(ho.idOperacion,0)=@idOperacion)

and isnull(do.idtipotransaccion,0)=0

Group by cl.codigo,case when len(ltrim(rtrim(isnull(cl.adicional,''))))>0 then RazonSocial else '' end,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))=0 then RazonSocial else cl.adicional end,Domicilio,codigopostal,localidad,p.descripcion 
,substring(t.descripcion,1,19) ,t.PartNumber, 
round(round(t.precio*coeficiente,2)*case when tipoFactura='B' then 1.21 else 1 end+ case when t.partnumber='100-389018-23' and ho.idoperacion=226610 then -.04 else 0 end,3),isnull(vh.moneda,0),
case when len(ltrim(rtrim(codigopostal)))>0 then ltrim(rtrim(CodigoPostal)) + ' - ' + localidad else localidad end 

--Having SUM(cantidad)<>0










GO
/****** Object:  StoredProcedure [dbo].[Header_Obra_Presupuesto]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE Procedure [dbo].[Header_Obra_Presupuesto]
(
	@idObra	int=7446,
	@Dia	int=7,	
	@Mes	int=7,
	@AA		int=2009,
	@nFac	varchar(13)='',
	@idOperacion	int=234657
	
)
as
Select cl.codigo,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))>0 then RazonSocial else '' end as RazonSocial,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))=0 then RazonSocial else cl.adicional end as adicional,
Domicilio,codigopostal,localidad,p.descripcion provincia,
t.detalle,t.precio*case when tipoFactura='B' then 1.21 else 1 end,t.idcampo, 'Anexo de Materiales - Factura Numero ',
case when isnull(vh.moneda,0)=0 then '$' else 'u$s' end Signo, 0 esMO, dp.observacion oPresupuesto,
 'Por los trabajos a realizar en vuestro avion ' + ltrim(rtrim(m.nombreAvion)) + ', matricula ' + ltrim(rtrim(m.matricula)) Header

from obras o
inner join matriculas m
on o.idmatricula=m.idmatricula
inner join clientes cl
on m.idcliente=cl.codigo
left join provincias p
on cl.idprovincia=p.provincia
inner join TempFacturacionMO t 
on o.idObra=t.idobra
left join Header_operaciones ho 
on t.idOperacionPresupuesto=ho.idOperacion
--
left join detalle_operaciones do
on ho.idOPeracion=do.idOperacion
left join Presupuestos vh
on do.idtransaccion=vh.idtransaccion 
left join datosPresupuesto dp
on ho.idoperacion=dp.idoperacion

where o.idoBra=@idobra
and isnull(ho.idOPeracion,0)=@idOperacion
and isnull(do.idtipotransaccion,0)=10

union

Select top 1 cl.codigo,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))>0 then RazonSocial else '' end as RazonSocial,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))=0 then RazonSocial else cl.adicional end as adicional,
Domicilio,codigopostal,localidad,p.descripcion provincia,
ead.descripcion detalle,eap.basecontable*case when tipoFactura='B' then 1.21 else 1 end  precio,9999999 idcampo, 'Anexo de Materiales - Factura Numero ',
case when isnull(vh.moneda,0)=0 then '$' else 'u$s' end Signo, 1 esMO, dp.observacion oPresupuesto,
'Por los trabajos a realizar en vuestro avion ' + ltrim(rtrim(m.nombreAvion)) + ', matricula ' + ltrim(rtrim(m.matricula)) Header
from obras o
inner join matriculas m
on o.idmatricula=m.idmatricula
inner join clientes cl
on m.idcliente=cl.codigo
left join provincias p
on cl.idprovincia=p.provincia
left join TempFacturacionMO t 
on o.idObra=t.idobra
left join Header_operaciones ho 
on @idOperacion=ho.idOperacion
--
left join detalle_operaciones do
on ho.idOPeracion=do.idOperacion
left join Presupuestos vh
on do.idtransaccion=vh.idtransaccion 
inner join estadisticaArticulosPresupuestos ea
on ea.idoperacion=ho.idoperacion 
left join estadisticaArticulosPreciosPresupuestos eap
on ea.idcampo=eap.idcampo
left join estadisticaArticulosDescripcionesPresupuestos ead
on ea.idcampo=ead.idcampo
left join datosPresupuesto dp
on ho.idoperacion=dp.idoperacion
where o.idoBra=@idobra
and isnull(ho.idOPeracion,0)=@idOperacion
and isnull(do.idtipotransaccion,0)=10
and ea.idarticulo=10287

Order by esmo,idcampo




GO
/****** Object:  StoredProcedure [dbo].[Header_Obra_PresupuestoPost]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



-- exec basecrm.dbo.Header_Obra_PresupuestoPost;1 7309,19,10,2010,'30',232818

CREATE Procedure [dbo].[Header_Obra_PresupuestoPost]
(
	@idObra	int=7339,
	@Dia	int=7,	
	@Mes	int=7,
	@AA		int=2009,
	@nFac	varchar(13)='',
	@idOperacion	int=233939
	
)
as
Select cl.codigo,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))>0 then RazonSocial else '' end as RazonSocial,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))=0 then RazonSocial else cl.adicional end as adicional,
Domicilio,codigopostal,localidad,p.descripcion provincia,
isnull(t.detalle,'Materiales a utilizar segun detalle') detalle,isnull(t.precio,vh.importeOrigen) precio,t.idcampo, 'Anexo de Materiales - Factura Numero ',
case when isnull(vh.moneda,0)=0 then '$' else 'u$s' end Signo, 0 esMO, dp.observacion oPresupuesto,
 'Por los trabajos a realizar en vuestro avion ' + ltrim(rtrim(m.nombreAvion)) + ', matricula ' + ltrim(rtrim(m.matricula)) Header

from obras o
inner join matriculas m
on o.idmatricula=m.idmatricula
inner join clientes cl
on m.idcliente=cl.codigo
left join provincias p
on cl.idprovincia=p.provincia
left join TempFacturacionMO t 
on o.idObra=t.idobra
left join Header_operaciones ho 
--on t.idOperacion=ho.idOperacion
on ho.idOperacion=@idOperacion
left join detalle_operaciones do
on ho.idOPeracion=do.idOperacion
left join Presupuestos vh
on do.idtransaccion=vh.idtransaccion 
left join datosPresupuesto dp
on ho.idoperacion=dp.idoperacion

where o.idoBra=@idobra
and isnull(ho.idOPeracion,0)=@idOperacion
and isnull(do.idtipotransaccion,0)=10

union

Select top 1 cl.codigo,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))>0 then RazonSocial else '' end as RazonSocial,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))=0 then RazonSocial else cl.adicional end as adicional,
Domicilio,codigopostal,localidad,p.descripcion provincia,
ead.descripcion detalle,eap.basecontable*case when tipoFactura='B' then 1.21 else 1 end  precio,9999999 idcampo, 'Anexo de Materiales - Factura Numero ',
case when isnull(vh.moneda,0)=0 then '$' else 'u$s' end Signo, 1 esMO, dp.observacion oPresupuesto,
'Por los trabajos a realizar en vuestro avion ' + ltrim(rtrim(m.nombreAvion)) + ', matricula ' + ltrim(rtrim(m.matricula)) Header

from obras o
inner join matriculas m
on o.idmatricula=m.idmatricula
inner join clientes cl
on m.idcliente=cl.codigo
left join provincias p
on cl.idprovincia=p.provincia
inner join TempFacturacionMO t 
on o.idObra=t.idobra
left join Header_operaciones ho 
on t.idOperacion=ho.idOperacion
--
left join detalle_operaciones do
on ho.idOPeracion=do.idOperacion
left join Vencliheader vh
on do.idtransaccion=vh.idtransaccion 
inner join estadisticaArticulos ea
on ea.idoperacion=ho.idoperacion 
left join estadisticaArticulosPrecios eap
on ea.idcampo=eap.idcampo
left join estadisticaArticulosDescripciones ead
on ea.idcampo=ead.idcampo
left join datosPresupuesto dp
on ho.idoperacion=dp.idoperacion
where o.idoBra=@idobra
and isnull(ho.idOPeracion,0)=@idOperacion
and isnull(do.idtipotransaccion,0)=0
and ea.idarticulo=10287

Order by esmo,idcampo





GO
/****** Object:  StoredProcedure [dbo].[Header_Obra_PresupuestoPostFC]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE Procedure [dbo].[Header_Obra_PresupuestoPostFC]
(
	@idObra	int=7339,
	@Dia	int=7,	
	@Mes	int=7,
	@AA		int=2009,
	@nFac	varchar(13)='',
	@idOperacion	int=233939
	
)
as
Select cl.codigo,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))>0 then RazonSocial else '' end as RazonSocial,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))=0 then RazonSocial else cl.adicional end as adicional,
Domicilio,codigopostal,localidad,p.descripcion provincia,
t.detalle,t.precio,t.idcampo, 'Anexo de Materiales - Factura Numero ',
case when isnull(vh.moneda,0)=0 then '$' else 'u$s' end Signo, 0 esMO, dp.observacion oPresupuesto,
 'Por los trabajos a realizar en vuestro avion ' + ltrim(rtrim(m.nombreAvion)) + ', matricula ' + ltrim(rtrim(m.matricula)) Header

from obras o
inner join matriculas m
on o.idmatricula=m.idmatricula
inner join clientes cl
on m.idcliente=cl.codigo
left join provincias p
on cl.idprovincia=p.provincia
inner join TempFacturacionMO t 
on o.idObra=t.idobra
left join Header_operaciones ho 
on t.idOperacion=ho.idOperacion
--
left join detalle_operaciones do
on ho.idOPeracion=do.idOperacion
left join Vencliheader vh
on do.idtransaccion=vh.idtransaccion 
left join datosPresupuesto dp
on ho.idoperacion=dp.idoperacion

where o.idoBra=@idobra
and isnull(ho.idOPeracion,0)=@idOperacion
and isnull(do.idtipotransaccion,0)=0

union



Select top 1 cl.codigo,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))>0 then RazonSocial else '' end as RazonSocial,
case when len(ltrim(rtrim(isnull(cl.adicional,''))))=0 then RazonSocial else cl.adicional end as adicional,
Domicilio,codigopostal,localidad,p.descripcion provincia,
'Materiales a utilizar segun detalle' detalle, eap.neto*case when tipoFactura='B' then 1.21 else 1 end  precio,9999999 idcampo, 'Anexo de Materiales - Factura Numero ',
case when isnull(vh.moneda,0)=0 then '$' else 'u$s' end Signo, 1 esMO, dp.observacion oPresupuesto,
'Por los trabajos a realizar en vuestro avion ' + ltrim(rtrim(m.nombreAvion)) + ', matricula ' + ltrim(rtrim(m.matricula)) Header

from obras o
inner join matriculas m
on o.idmatricula=m.idmatricula
inner join clientes cl
on m.idcliente=cl.codigo
left join provincias p
on cl.idprovincia=p.provincia
inner join TempFacturacionMO t 
on o.idObra=t.idobra
left join Header_operaciones ho 
on ho.idOperacion=@idOperacion
--
left join detalle_operaciones do
on ho.idOPeracion=do.idOperacion
left join Vencliheader vh
on do.idtransaccion=vh.idtransaccion 
inner join estadisticaArticulos ea
on ea.idoperacion=ho.idoperacion 
inner join estadisticaArticulosPrecios eap
on ea.idcampo=eap.idcampo
left join estadisticaArticulosDescripciones ead
on ea.idcampo=ead.idcampo
left join datosPresupuesto dp
on ho.idoperacion=dp.idoperacion
where o.idoBra=@idobra
and isnull(ho.idOPeracion,0)=@idOperacion
and isnull(do.idtipotransaccion,0)=0
and ea.idarticulo=10287

Order by esmo,idcampo

/*
Select * from estadisticaArticulos 
where idoperacion=216612
*/



GO
/****** Object:  StoredProcedure [dbo].[Header_OrdenProduccion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE    Procedure [dbo].[Header_OrdenProduccion]
(
	@idOrden	int=1
)
as
Select Fecha, ho.Descripcion ObservacionComprobante,ho.idorden,
ar.articulo, ar.descripcion,op.cantidad,
isnull(arc.articulo,ar.articulo) Componente, isnull(arc.descripcion,ar.Descripcion) dComponente,op.cantidad*isnull(fa.cantidad,1) Necesidad,
isnull(arc.idArticulo,0) Formula

from HeaderOrdenesProduccion ho
inner join DetalleOrdenesProduccion op 
on ho.idOrden=op.idOrden
inner join articulos ar
on op.idArticulo=ar.idarticulo
left join FormulasArticulos fa
on ar.idarticulo=fa.idarticulo
left join articulos arc
on fa.idComponente=arc.idarticulo
left join Articulos arb
on arc.idarticulobase=arb.idarticulo
where ho.idOrden=@idOrden



GO
/****** Object:  StoredProcedure [dbo].[Header_OrdenProduccionResumen]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO





CREATE      Procedure [dbo].[Header_OrdenProduccionResumen]
(
	@idOrden	int=1
)
as
Select 
isnull(arc.articulo,ar.articulo) Componente, 
isnull(arc.descripcion,ar.Descripcion) dComponente,
sum(op.cantidad*isnull(fa.cantidad,1)) Necesidad,
case when isnull(arc.unidadesxbase,0)<>0 then 
round(sum(op.cantidad*isnull(fa.cantidad,1))/arc.unidadesxbase,4) 
else 0 end base ,arc.unidadesxbase,arb.articulo aBase,arb.descripcion dBase

from HeaderOrdenesProduccion ho
inner join DetalleOrdenesProduccion op 
on ho.idOrden=op.idOrden
inner join articulos ar
on op.idArticulo=ar.idarticulo
left join FormulasArticulos fa
on ar.idarticulo=fa.idarticulo
left join articulos arc
on fa.idComponente=arc.idarticulo
left join Articulos arb
on arc.idarticulobase=arb.idarticulo
where ho.idOrden=@idOrden

Group by isnull(arc.articulo,ar.articulo), 
isnull(arc.descripcion,ar.Descripcion),arb.descripcion,arc.unidadesxbase,arb.Articulo



GO
/****** Object:  StoredProcedure [dbo].[header_Recibos_Sueldos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO






CREATE      Procedure [dbo].[header_Recibos_Sueldos] --41
(
	@idLiquidacion	int=109
)
as

Select * from dbo.fnheader_Recibos_Sueldos(@idLiquidacion)
order by legajo,fe



GO
/****** Object:  StoredProcedure [dbo].[HeaderFactura]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO

-- Select * from electronicos

-- HeaderFactura 238535

CREATE           Procedure [dbo].[HeaderFactura] 
(
	@idOperacion	int=0,
	@Desde		Char(8)='',
	@Hasta		Char(8)='',
	@idCliente	int=0,
	@idArticulo	int=0,
	@nroDesde	int=0,
	@nroHasta	int=0

)
as
Declare @sqlString nvarchar(4000)

Select @sqlString='Select distinct
case when tipodeOperacion between 44 and 45 then "FACTURA"
 when tipodeOperacion=46 then "NOTA DE CREDITO"
when tipodeOperacion=47	 then "NOTA DE DEBITO"
 when tipodeOperacion=49 then "FACTURA"
else "" end Comprobante,
ho.idOperacion,ho.fecha,ho.observacionComprobante,
cl.codigo,cl.domicilio, substring(vh.nrocomprobante,1,4)
pv,substring(vh.nrocomprobante,5,8) numero ,ho.comprobantenumero,
vh.totalimporte,descripcionImporte,localidad,pv.descripcion Provincia,
tipofactura, fecha1Venc vto, Leyenda,codigopostal,
Case when Vh.tc<>1 then "Forma de Pago: en pesos al cambio dolar libre tipo vendedor del dia anterior al dia de pago." else "" end FContab,
Case when Vh.tc<>1 then "Nota: Al solo efecto de registro del Iva " else "" end FContab1,
Case when dv.MO=1 and dv.Taxi=1 then "Nota: Mano de obra por trabajos realizados, operacion exenta segun apartado 28 inc h), articulo 6 Ley 23349 y modificatorias." else "" end Taxi,
Case when Vh.tc<>1 then "T. C. $" + replace(cast(vh.tc as varchar(7)),".",",") + " - TOTAL " + case when tipodeOperacion between 44 and 45 then "FACTURA"
 when tipodeOperacion=46 then "NOTA DE CREDITO"
when tipodeOperacion=47	 then "NOTA DE DEBITO"
 when tipodeOperacion=49 then "FACTURA"
else "" end + " $ " + replace(cast(vh.totalimporte as varchar(12)),".",",") else "" end FContab2,
case when isnull(dv.idObra,0)<>0 then "Por los trabajos realizados en vuestro avion " + ltrim(rtrim(mt.nombreAvion)) + ", matricula " + ltrim(rtrim(mt.matricula)) else "" end Header
, isnull(dv.idObra,0) idObra, cuit, vh.Moneda, Dias, fecha1Venc, ci.descripcion dCiva,
case when vh.moneda=0 then "$" else "u$s" end Signo, isnull(dv.idObra,0) idObra,dv.Coeficiente,isnull(MO,0) MO,isnull(MAT,0) Mat,
case when tipodeOperacion between 44 and 45 then "FC"
when tipodeOperacion=46 then "NC"
when tipodeOperacion=47	then "ND"
when tipodeOperacion=49 then "FC"
else "" end tComprobante,
case when len(ltrim(rtrim(isnull(cl.adicional,""))))>0 then RazonSocial else "" end as RazonSocial,
case when len(ltrim(rtrim(isnull(cl.adicional,""))))=0 then RazonSocial else cl.adicional end as adicional,
case when len(ltrim(rtrim(codigopostal)))>0 then ltrim(rtrim(CodigoPostal)) + " - " + localidad else localidad end cposloc,
CAE,el.Vencimiento Vencimiento_CAE,
cast("30552444759" as varchar(11)) Collate Latin1_General_CI_AS + substring(cast(100+isnull(el.tipocomprobante,1) as varchar),2,2) + substring(vh.nrocomprobante,1,4) + cast(cae as varchar(14))  Collate Latin1_General_CI_AS
+convert(varchar, ho.fecha, 112)+dbo.VerificaModulo10(cast("30552444759" as varchar(11)) Collate Latin1_General_CI_AS + substring(cast(100+isnull(el.tipocomprobante,1) as varchar),2,2) + substring(vh.nrocomprobante,1,4) + cast(cae as varchar(14))  Collate Latin1_General_CI_AS
+convert(varchar, ho.fecha, 112)) cBarras

from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join VenCliheader vh
on do.idtransaccion=vh.idtransaccion
inner join clientes cl 
on vh.cliente=cl.codigo
inner join EstadisticaArticulos ea
on do.idOperacion=ea.idOperacion
left join provincias pv
on cl.idprovincia=pv.provincia
inner join DatosVenta dv
on ho.idOPeracion=dv.idOperacion
Left join Leyendas l
on dv.idLeyenda=l.idLeyenda
left join Obras ob
on dv.idObra=ob.idObra
left join Matriculas mt 
on ob.idMatricula=mt.idmatricula
left join categorias_Iva ci
on ci.idciva=cl.civa
Left Join Electronicos el
on ho.idoperacion=el.idOperacion_Origen

where idTipoTransaccion=0 '
if @idOperacion<>0
	Select @sqlString=@sqlString + '
and ho.idOperacion=' + cast(@idOperacion as char(6)) 

if @Desde<>""
	Select @sqlString=@sqlString + 
' and ho.Fecha>="' + @Desde + '"'

if @Hasta<>""
	Select @sqlString=@sqlString + 
' and ho.Fecha<="' + @Hasta + '"'

if @idCliente<>0
	Select @sqlString=@sqlString + 
' and cl.codigo=' + cast(@idCliente as char(10)) 

if @idArticulo<>0
	Select @sqlString=@sqlString + 
' and ea.idArticulo=' + cast(@idArticulo as char(8)) 

if @nroDesde<>0
	Select @sqlString=@sqlString + 
' and Substring(nroComprobante,5,8)>=' + cast(@nroDesde as char(8)) 

if @nroHasta<>0
	Select @sqlString=@sqlString + 
' and Substring(nroComprobante,5,8)<=' + cast(@nroHasta as char(8)) 

	Select @sqlString=@sqlString + 'Order by ho.idOperacion '

exec sp_executesql @sqlString

GO
/****** Object:  StoredProcedure [dbo].[HeaderLegajoPago]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Procedure [dbo].[HeaderLegajoPago]
(
	@idOperacion	int=217584
)
as
Select 0 Original, p.codigo,isnull(pv.razonsocial,p.razonsocial) razonSocial,cp.fecha1Venc,comprobanteNumero,lp.idOperacion,
sum(cp.totalimporte*multiplicador) Subtotal from LegajosPago lp
inner join compProvHeader cp
on lp.idtransaccion=cp.idtransaccion
inner join proveedores p 
on cp.proveedor=p.codigo
inner join TipCompModHeader t
on cp.tipoComprobante=t.codigo
inner join header_operaciones ho
on lp.idOPeracion=ho.idOperacion
left join cphvarios cv
on cp.idtransaccion=cv.idtransaccion
left join provfondo pv
on cv.codigo=pv.proveedor
where lp.idOPeracion=@idOperacion
Group by p.codigo,isnull(pv.razonsocial,p.razonsocial),cp.fecha1Venc,comprobanteNumero,lp.idOperacion
union
Select 1 Original, p.codigo,isnull(pv.razonsocial,p.razonsocial) razonSocial,cp.fecha1Venc,comprobanteNumero,lp.idOperacion,
sum(cp.totalimporte*multiplicador) Subtotal from LegajosPago lp
inner join compProvHeader cp
on lp.idtransaccion=cp.idtransaccion
inner join proveedores p 
on cp.proveedor=p.codigo
inner join TipCompModHeader t
on cp.tipoComprobante=t.codigo
inner join header_operaciones ho
on lp.idOPeracion=ho.idOperacion
left join cphvarios cv
on cp.idtransaccion=cv.idtransaccion
left join provfondo pv
on cv.codigo=pv.proveedor
where lp.idOPeracion=@idOperacion
Group by p.codigo,isnull(pv.razonsocial,p.razonsocial),cp.fecha1Venc,comprobanteNumero,lp.idOperacion






GO
/****** Object:  StoredProcedure [dbo].[HeaderPedido]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO

CREATE    Procedure [dbo].[HeaderPedido]
(
	@idOperacion	int=0,
	@Desde		Char(8)='',
	@Hasta		Char(8)='',
	@idCliente	int=0,
	@idArticulo	int=0,
	@nroDesde	int=0,
	@nroHasta	int=0
)
as
Declare @sqlString nvarchar(4000)
Declare @sqlConcat nvarchar(20)

Select @sqlConcat=' and '

Select @sqlString='Select distinct
case when tipodeOperacion=43 then "Pedido"
else "" end Comprobante,
ho.idOperacion,ho.fecha,ho.observacionComprobante,
cl.codigo,cl.razonsocial,cl.domicilio, substring(vh.nrocomprobante,1,4)
pv,substring(vh.nrocomprobante,5,8) numero ,ho.comprobantenumero,
vh.totalimporte,descripcionImporte,localidad,pv.descripcion Provincia,
tipofactura

from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join Pedidos vh
on do.idtransaccion=vh.idtransaccion
inner join estadisticaArticulosPedidos ea
on ho.idOPeracion=ea.idOPeracion
inner join clientes cl 
on vh.cliente=cl.codigo
left join provincias pv
on cl.idprovincia=pv.provincia
where idTipoTransaccion=490'

if @idOperacion<>0
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' ho.idOperacion=' + cast(@idOperacion as char(6)) 
Select @sqlConcat=' and '
end
if @Desde<>""
begin
	Select @sqlString=@sqlString + @sqlConcat + 
' ho.Fecha>="' + @Desde + '"'
Select @sqlConcat=' and '
end

if @Hasta<>""
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' ho.Fecha<="' + @Hasta + '"'
Select @sqlConcat=' and '
end

if @idCliente<>0
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' cl.codigo=' + cast(@idCliente as char(10)) 
Select @sqlConcat=' and '
end


if @idArticulo<>0
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' ea.idArticulo=' + cast(@idArticulo as char(10)) 
Select @sqlConcat=' and '
end

if @nroDesde<>0
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' and Substring(nroComprobante,5,8)>=' + cast(@nroDesde as char(8)) 
Select @sqlConcat=' and '
end

if @nroHasta<>0
Begin
	Select @sqlString=@sqlString  + @sqlConcat + 
' and Substring(nroComprobante,5,8)<=' + cast(@nroHasta as char(8)) 
Select @sqlConcat=' and '
end

exec sp_executesql @sqlString





GO
/****** Object:  StoredProcedure [dbo].[HeaderPorder]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE  Procedure [dbo].[HeaderPorder]
(
	@idOperacion	int=74401,
	@Desde		Char(8)='',
	@Hasta		Char(8)='',
	@idCliente	int=0,
	@idArticulo	int=0,
	@nroDesde	int=0,
	@nroHasta	int=0
)
as
Declare @sqlString nvarchar(4000)
Declare @sqlConcat nvarchar(20)

Select @sqlConcat=' and '

Select @sqlString='Select distinct
case when tipodeOperacion=492 then "PO"
else "" end Comprobante,
ho.idOperacion,ho.fecha,ho.observacionComprobante,
cl.codigo,cl.razonsocial,cl.domicilio, substring(vh.nrocomprobante,1,4)
pv,substring(vh.nrocomprobante,5,8) numero ,ho.comprobantenumero,
vh.totalimporte,descripcionImporte,localidad,pv.descripcion Provincia,
tipofactura,PoInterna,POProveedor

from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join PO vh
on do.idtransaccion=vh.idtransaccion
inner join estadisticaArticulosPO ea
on ho.idOPeracion=ea.idOPeracion
inner join proveedores cl 
on vh.cliente=cl.codigo
left join provincias pv
on cl.idprovincia=pv.provincia
where TipodeOperacion=492'

if @idOperacion<>0
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' ho.idOperacion=' + cast(@idOperacion as char(6)) 
Select @sqlConcat=' and '
end
if @Desde<>""
begin
	Select @sqlString=@sqlString + @sqlConcat + 
' ho.Fecha>="' + @Desde + '"'
Select @sqlConcat=' and '
end

if @Hasta<>""
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' ho.Fecha<="' + @Hasta + '"'
Select @sqlConcat=' and '
end

if @idCliente<>0
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' cl.codigo=' + cast(@idCliente as char(10)) 
Select @sqlConcat=' and '
end


if @idArticulo<>0
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' ea.idArticulo=' + cast(@idArticulo as char(10)) 
Select @sqlConcat=' and '
end

if @nroDesde<>0
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' and Substring(nroComprobante,5,8)>=' + cast(@nroDesde as char(8)) 
Select @sqlConcat=' and '
end

if @nroHasta<>0
Begin
	Select @sqlString=@sqlString  + @sqlConcat + 
' and Substring(nroComprobante,5,8)<=' + cast(@nroHasta as char(8)) 
Select @sqlConcat=' and '
end

-- print @sqlString

exec sp_executesql @sqlString







GO
/****** Object:  StoredProcedure [dbo].[HeaderPresupuesto]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO

-- Select * from DatosVenta
-- Select * from header_operaciones order by idOperacion desc
-- HeaderFactura 12770

CREATE             Procedure [dbo].[HeaderPresupuesto] 
(
	@idOperacion	int=218540,
	@Desde		Char(8)='',
	@Hasta		Char(8)='',
	@idCliente	int=0,
	@idArticulo	int=0,
	@nroDesde	int=0,
	@nroHasta	int=0

)
as
Declare @sqlString nvarchar(4000)

Select @sqlString='Select distinct
case when tipodeOperacion=42 then "Presupuesto"
else "" end Comprobante,
ho.idOperacion,ho.fecha,ho.observacionComprobante,
cl.codigo,cl.domicilio, substring(vh.nrocomprobante,1,4)
pv,substring(vh.nrocomprobante,5,8) numero ,ho.comprobantenumero,
vh.totalimporte,descripcionImporte,localidad,pv.descripcion Provincia,
tipofactura, fecha1Venc vto, Leyenda,codigopostal,
Case when Vh.tc<>1 then "Forma de Pago: en pesos al cambio dolar libre tipo vendedor del dia anterior al dia de pago." else "" end FContab,
Case when Vh.tc<>1 then "Nota: Al solo efecto de registro del Iva " else "" end FContab1,
Case when dv.MO=1 and dv.Taxi=1 then "Nota: Mano de obra por trabajos realizados, operacion exenta segun apartado 28 inc h), articulo 6 Ley 23349 y modificatorias." else "" end Taxi,
Case when Vh.tc<>1 then "T. C. $" + replace(cast(vh.tc as varchar(7)),".",",") + " - TOTAL " + 
case when tipodeOperacion=42 then "Presupuesto"
else "" end + " $ " + replace(cast(vh.totalimporte as varchar(12)),".",",") else "" end FContab2,
case when isnull(dv.idObra,0)<>0 then "Por los trabajos realizados en vuestro avion " + ltrim(rtrim(mt.nombreAvion)) + ", matricula " + ltrim(rtrim(mt.matricula)) else "" end Header
, isnull(dv.idObra,0) idObra, cuit, vh.Moneda, Dias, fecha1Venc, ci.descripcion dCiva,
case when vh.moneda=0 then "$" else "u$s" end Signo, isnull(dv.idObra,0) idObra,dv.Coeficiente,isnull(MO,0) MO,isnull(MAT,0) Mat,
case when tipodeOperacion=42 then "PR"
else "" end tComprobante,
case when len(ltrim(rtrim(isnull(cl.adicional,""))))>0 then RazonSocial else "" end as RazonSocial,
case when len(ltrim(rtrim(isnull(cl.adicional,""))))=0 then RazonSocial else cl.adicional end as adicional,
case when len(ltrim(rtrim(codigopostal)))>0 then ltrim(rtrim(CodigoPostal)) + " - " + localidad else localidad end cposloc

from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join Presupuestos vh
on do.idtransaccion=vh.idtransaccion
inner join clientes cl 
on vh.cliente=cl.codigo
inner join EstadisticaArticulosPresupuestos ea
on do.idOperacion=ea.idOperacion
left join provincias pv
on cl.idprovincia=pv.provincia
inner join DatosVenta dv
on ho.idOPeracion=dv.idOperacion
Left join Leyendas l
on dv.idLeyenda=l.idLeyenda
left join Obras ob
on dv.idObra=ob.idObra
left join Matriculas mt 
on ob.idMatricula=mt.idmatricula
left join categorias_Iva ci
on ci.idciva=cl.civa


where idTipoTransaccion=10 '
if @idOperacion<>0
	Select @sqlString=@sqlString + '
and ho.idOperacion=' + cast(@idOperacion as char(6)) 

if @Desde<>""
	Select @sqlString=@sqlString + 
' and ho.Fecha>="' + @Desde + '"'

if @Hasta<>""
	Select @sqlString=@sqlString + 
' and ho.Fecha<="' + @Hasta + '"'

if @idCliente<>0
	Select @sqlString=@sqlString + 
' and cl.codigo=' + cast(@idCliente as char(10)) 

if @idArticulo<>0
	Select @sqlString=@sqlString + 
' and ea.idArticulo=' + cast(@idArticulo as char(8)) 

if @nroDesde<>0
	Select @sqlString=@sqlString + 
' and Substring(nroComprobante,5,8)>=' + cast(@nroDesde as char(8)) 

if @nroHasta<>0
	Select @sqlString=@sqlString + 
' and Substring(nroComprobante,5,8)<=' + cast(@nroHasta as char(8)) 

	Select @sqlString=@sqlString + 'Order by ho.idOperacion '

exec sp_executesql @sqlString















GO
/****** Object:  StoredProcedure [dbo].[HeaderRcCaja]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




-- HeaderRcCaja 102816

CREATE          Procedure [dbo].[HeaderRcCaja]
(
	@idOperacion int=84984
)
as
Declare @tSql nvarchar(4000)
Declare	@Entidad int

Select @entidad=cc.entidad 
from Detalle_operaciones do
inner join CuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion 
where do.idtipotransaccion=0 and idOperacion=@idOperacion


Set @tSql='Select /* distinct */ Top 1
	A01.idOperacion, A01.ObservacionComprobante, A01.Fecha, A01.AnioMes As Header_AnioMes, 
	A01.ComprobanteNumero, A01.Serie, /* A06.importe */
(select sum(c.importe) From Header_Operaciones a 
		inner join Detalle_Operaciones b 
		on a.idOperacion = b.idOperacion and b.idTipoTransaccion = 2 
		inner join ValoresTesoreria c on c.idTransaccion = b.idTransaccion 
		where a.idoperacion = A01.idOperacion) as ImportePago, a04.socio,
    dbo.Numlet((select sum(c.importe) From Header_Operaciones a 
		inner join Detalle_Operaciones b 
		on a.idOperacion = b.idOperacion and b.idTipoTransaccion = 2 
		inner join ValoresTesoreria c on c.idTransaccion = b.idTransaccion 
		where a.idoperacion = A01.idOperacion)) LETRAS,
	(select sum(c.importe) From Header_Operaciones a 
		inner join Detalle_Operaciones b 
		on a.idOperacion = b.idOperacion and b.idTipoTransaccion = 2 
		inner join ValoresTesoreria c on c.idTransaccion = b.idTransaccion 
		where a.idoperacion = A01.idOperacion) as ImporteRecibo, 
	A06.Cuenta, A06.Sucursal, A06.Numero, A06.FechaEmision as FechaCheque, 
	A07.Descripcion as DescPago, A07.Modalidad, A09.' + 
case when @entidad=0 then 'Socio Codigo, "Recibimos del Socio: " + ltrim(rtrim(cast(A09.socio as char(6)))) Tipo, ltrim(rtrim(A09.apellido)) + ", " + ltrim(rtrim(A09.nombre)) nyap ,A09.Cobrador ' 
	 when @entidad=1 then 'Adherente Codigo, "Recibimos del Adherente: " + ltrim(rtrim(cast(Adherente as char(6)))) Tipo, ltrim(rtrim(A09.apellido)) + ", " + ltrim(rtrim(A09.nombre)) nyap,A09.Cobrador ' 
	 when @entidad=2 then 'idAlumno Codigo, "Recibimos del Alumno: " + ltrim(rtrim(cast(idAlumno as char(6)))) Tipo , A09.nyap ," " Cobrador ' end
+ ', A10.Descripcion as DescBanco 
From Header_Operaciones A01 
	inner join Detalle_Operaciones A02 
		on A01.idOperacion = A02.idOperacion and A02.idTipoTransaccion = 0 
	inner join AplicacionesCuentasCorrientes A03 
		on A02.idTransaccion = A03.idTransaccion 
	inner join CuentasCorrientes A04 
		on A04.idTransaccion = A03.idTransaccionCancelada 
	inner join DetalleCuentasCorrientes A05 
		on A05.idTransaccion = A04.idTransaccion 
	inner join ValoresTesoreria A06 
		on A06.idTransaccionOrigen = A02.idTransaccion 
	inner join Conceptos_Tesoreria A07 
		on A06.idConcepto_Tesoreria = A07.idConcepto_Tesoreria '

if @Entidad=0
	Set @tSql=+@tSql+' Inner join socios A09 on A04.Socio = A09.socio '
else if @Entidad=1
	Set @tSql=+@tSql+' Inner join Adherentes A09 on A04.Socio = A09.adherente '
else if @Entidad=2
	Set @tSql=+@tSql+' Inner join Alumnos A09 on A04.Socio = A09.idAlumno '

Set @tSql=+@tSql+'left join Bancos A10 on A06.Banco = A10.Banco 
					Where A01.idOperacion =' + cast(@idOperacion as char(12))

exec sp_executesql @tSql

--print @tSql

--HeaderRcCaja 1,2








GO
/****** Object:  StoredProcedure [dbo].[HeaderRemito]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


--exec HeaderRemito 0, '20071101', '20071118', 6577, 0, 4, 4

CREATE       Procedure [dbo].[HeaderRemito]
(
	@idOperacion	int=0,
	@Desde		Char(8)='',
	@Hasta		Char(8)='',
	@idCliente	int=0,
	@idArticulo	int=0,
	@nroDesde	int=0,
	@nroHasta	int=0
)
as
Declare @sqlString nvarchar(4000)
Declare @sqlConcat nvarchar(20)

Select @sqlConcat=' Where '

Select @sqlString='Select distinct 
case 
When tipodeOperacion=45 then "Remito"
when tipodeOperacion=490 then "Remito Consignacion"
when tipodeOperacion=491 then "Remito Devolucion"
else "" end Comprobante,
ho.idOperacion,ho.fecha,ho.observacionComprobante,
cl.codigo,cl.razonsocial,cl.domicilio, substring(vh.nrocomprobante,1,4)
pv,substring(vh.nrocomprobante,5,8) numero ,ho.comprobantenumero,
vh.valorDeclarado,cl.localidad,pv.descripcion Provincia,t.razonsocial transporte,bultos,t.domicilio tDomicilio, t.localidad tLocalidad,
cl.cuit

from Header_operaciones ho
inner join HeaderRemitos vh
on ho.idoperacion=vh.idOperacion
inner join clientes cl 
on vh.idcliente=cl.codigo
left join provincias pv
on cl.idprovincia=pv.provincia
left join Transportes t
on vh.idtransporte=t.idtransporte ' 


if @idOperacion<>0
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' ho.idOperacion=' + cast(@idOperacion as char(6)) 
Select @sqlConcat=' and '
end
if @Desde<>""
begin
	Select @sqlString=@sqlString + @sqlConcat + 
' ho.Fecha>="' + @Desde + '"'
Select @sqlConcat=' and '
end

if @Hasta<>""
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' ho.Fecha<="' + @Hasta + '"'
Select @sqlConcat=' and '
end

if @idCliente<>0
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' cl.codigo=' + cast(@idCliente as char(10)) 
Select @sqlConcat=' and '
end

if @idArticulo<>0
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' ea.idArticulo=' + cast(@idArticulo as char(10)) 
Select @sqlConcat=' and '
end

if @nroDesde<>0
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' Substring(nroComprobante,5,8)>=' + cast(@nroDesde as char(8)) 
Select @sqlConcat=' and '
end

if @nroHasta<>0
Begin
	Select @sqlString=@sqlString  + @sqlConcat + 
' Substring(nroComprobante,5,8)<=' + cast(@nroHasta as char(8)) 
Select @sqlConcat=' and '
end

-- print @sqlString

exec sp_executesql @sqlString




GO
/****** Object:  StoredProcedure [dbo].[IIBBapercep]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE   Procedure [dbo].[IIBBapercep]
(
	@Desde Char(8)='20110101',
	@Hasta Char(8)='20110131'
)
as

Select v.fecha,t.comprobante Comp,substring(nrocomprobante,1,4) + '-' + Substring(nrocomprobante,5,8) nrocomprobante,tipofactura,isnull(cv.razonsocial,c.razonSocial) razonsocial,isnull(cv.cuit,c.cuit) cuit,ci.resumido dciva,
totalimporte*multiplicador total,
case when v.tipofactura<>'C' and v.tipofactura<>'M' then isnull(
(select sum(baseContable) 

from CompProvitems
where idtransaccion=v.idtransaccion and concepto='NG ')*multiplicador,0) else 0 end Neto,
isnull(
(select sum(baseContable) 
from CompProvitems
where idtransaccion=v.idtransaccion and ((concepto='EXE' or (concepto='NG ' and alicuota=0)) and (v.tipofactura<>'C' and v.tipofactura<>'M')))*multiplicador,0) Exento,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='IVG')*multiplicador,0) Iva,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=21)*multiplicador,0) NG21,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='I27')*multiplicador,0) Iva27,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=27)*multiplicador,0) NG27,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='I10')*multiplicador,0) Iva10,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=10.5)*multiplicador,0) NG105,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=0)*multiplicador,0) NG0,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='I05')*multiplicador,0) Iva5,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='IBC')*multiplicador,0) PibC,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PIV')*multiplicador,0) PIV,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='IBB')*multiplicador,0) PIB,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PAB')*multiplicador,0) PAB,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PAC')*multiplicador,0) PAC,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='II')*multiplicador,0) II,
isnull((select sum(base) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='II')*multiplicador,0) BII,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and (concepto='GSI' or concepto='PGI' or concepto='PBB' or concepto='PBA'))*multiplicador,0) GSI,
case when v.tipofactura='C' or v.tipofactura='M' then isnull(
(select sum(baseContable)
from CompProvitems
where idtransaccion=v.idtransaccion and (concepto='NG ' or concepto='EXE'))*multiplicador,0) else 0 end Monotributo,
idoperacion, 202246.62 as totalNeto

into baseSifere

from CompProVHeader v
left join cphVarios vv
on v.idtransaccion=vv.idtransaccion
inner join TipCompModHeader t
on v.tipocomprobante=t.codigo
Left join Proveedores c
on isnull(vv.Codigo,v.Proveedor)=c.codigo
Left join Provfondo cv
on isnull(vv.Codigo,v.Proveedor)=cv.proveedor
left join categorias_iva ci
on c.civa=ci.idciva
left join detalle_Operaciones do
on v.idtransaccion=do.idtransaccion and do.idtipotransaccion=1
where v.fecha between @Desde and @Hasta
and ivaCompras='S'
--and isnull(idtipotransaccion,1)=1
and v.proveedor<212000

union

Select v.fecha,t.comprobante Comp,substring(nrocomprobante,1,4) + '-' + Substring(nrocomprobante,5,8) nrocomprobante,tipofactura,isnull(cv.razonsocial,c.razonSocial) razonsocial,isnull(cv.cuit,c.cuit) cuit,ci.resumido dciva,
totalimporte*multiplicador total,
case when v.tipofactura<>'C' and v.tipofactura<>'M' then isnull(
(select sum(Neto) 
from compfondositems
where idtransaccion=v.idtransaccion and concepto='NG ')*multiplicador,0) else 0 end Neto,
isnull(
(select sum(Neto) 
from compfondositems
where idtransaccion=v.idtransaccion and concepto='EXE' and v.tipoFactura<>'C' and v.tipoFactura<>'M')*multiplicador,0) Exento,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='IVG')*multiplicador,0) Iva,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=21 )*multiplicador,0) NG21,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='I27')*multiplicador,0) Iva27,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=27)*multiplicador,0) NG27,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='I10')*multiplicador,0) Iva10,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=10.5)*multiplicador,0) NG10,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='EXE')*multiplicador,0) NG0,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='I05')*multiplicador,0) Iva5,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='IBC')*multiplicador,0) PibC,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='PIV')*multiplicador,0) PIV,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='IBB')*multiplicador,0) PIB,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='PAB')*multiplicador,0) PAB,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='PAC')*multiplicador,0) PAC,
isnull((select sum(Neto) from compfondositems 

where idtransaccion=v.idtransaccion and concepto='II')*multiplicador,0) II,
isnull((select sum(base) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='II')*multiplicador,0) BII,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and (concepto='GSI' or concepto='PGI' or concepto='PBB' or concepto='PBA'))*multiplicador,0) GSI,
case when v.tipofactura='C' or v.tipofactura='M' then isnull(
(select sum(Neto) 
from compfondositems
where idtransaccion=v.idtransaccion and (concepto='NG ' or concepto='EXE'))*multiplicador,0) else 0 end Monotributo, idOperacion
,202246.62 as totalNeto
from CompFondosHeader v
left join cphVarios vv
on v.idtransaccion=vv.idtransaccion
inner join TipCompModHeader t
on v.tipocomprobante=t.codigo
Left join Proveedores c
on isnull(vv.Codigo,v.Proveedor)=c.codigo
Left join Provfondo cv
on isnull(vv.Codigo,v.Proveedor)=cv.proveedor
left join categorias_iva ci
on c.civa=ci.idciva
inner join detalle_Operaciones do
on v.idtransaccion=do.idtransaccion and do.idtipotransaccion=3

where v.fecha between @Desde and @Hasta
and ivaCompras='S'
--and isnull(idtipotransaccion,1)=1
and v.proveedor<212000

order by v.fecha,nrocomprobante

GO
/****** Object:  StoredProcedure [dbo].[IIBBpercep]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE   Procedure [dbo].[IIBBpercep]
(
	@Desde Char(8)='20101201',
	@Hasta Char(8)='20101231'
)
as

Select v.fecha,t.comprobante Comp,substring(nrocomprobante,1,4) + '-' + Substring(nrocomprobante,5,8) nrocomprobante,tipofactura,isnull(cv.razonsocial,c.razonSocial) razonsocial,isnull(cv.cuit,c.cuit) cuit,ci.resumido dciva,
totalimporte*multiplicador total,
case when v.tipofactura<>'C' and v.tipofactura<>'M' then isnull(
(select sum(baseContable) 

from CompProvitems
where idtransaccion=v.idtransaccion and concepto='NG ')*multiplicador,0) else 0 end Neto,
isnull(
(select sum(baseContable) 
from CompProvitems
where idtransaccion=v.idtransaccion and ((concepto='EXE' or (concepto='NG ' and alicuota=0)) and (v.tipofactura<>'C' and v.tipofactura<>'M')))*multiplicador,0) Exento,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='IVG')*multiplicador,0) Iva,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=21)*multiplicador,0) NG21,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='I27')*multiplicador,0) Iva27,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=27)*multiplicador,0) NG27,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='I10')*multiplicador,0) Iva10,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=10.5)*multiplicador,0) NG105,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=0)*multiplicador,0) NG0,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='I05')*multiplicador,0) Iva5,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='IBC')*multiplicador,0) PibC,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PIV')*multiplicador,0) PIV,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='IBB')*multiplicador,0) PIB,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PAB')*multiplicador,0) PAB,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PAC')*multiplicador,0) PAC,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='II')*multiplicador,0) II,
isnull((select sum(base) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='II')*multiplicador,0) BII,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and (concepto='GSI' or concepto='PGI' or concepto='PBB' or concepto='PBA'))*multiplicador,0) GSI,
case when v.tipofactura='C' or v.tipofactura='M' then isnull(
(select sum(baseContable)
from CompProvitems
where idtransaccion=v.idtransaccion and (concepto='NG ' or concepto='EXE'))*multiplicador,0) else 0 end Monotributo,
idoperacion, 202246.62 as totalNeto

into baseSifere

from CompProVHeader v
left join cphVarios vv
on v.idtransaccion=vv.idtransaccion
inner join TipCompModHeader t
on v.tipocomprobante=t.codigo
Left join Proveedores c
on isnull(vv.Codigo,v.Proveedor)=c.codigo
Left join Provfondo cv
on isnull(vv.Codigo,v.Proveedor)=cv.proveedor
left join categorias_iva ci
on c.civa=ci.idciva
left join detalle_Operaciones do
on v.idtransaccion=do.idtransaccion and do.idtipotransaccion=1
where v.fecha between @Desde and @Hasta
and ivaCompras='S'
--and isnull(idtipotransaccion,1)=1
and v.proveedor<212000

union

Select v.fecha,t.comprobante Comp,substring(nrocomprobante,1,4) + '-' + Substring(nrocomprobante,5,8) nrocomprobante,tipofactura,isnull(cv.razonsocial,c.razonSocial) razonsocial,isnull(cv.cuit,c.cuit) cuit,ci.resumido dciva,
totalimporte*multiplicador total,
case when v.tipofactura<>'C' and v.tipofactura<>'M' then isnull(
(select sum(Neto) 
from compfondositems
where idtransaccion=v.idtransaccion and concepto='NG ')*multiplicador,0) else 0 end Neto,
isnull(
(select sum(Neto) 
from compfondositems
where idtransaccion=v.idtransaccion and concepto='EXE' and v.tipoFactura<>'C' and v.tipoFactura<>'M')*multiplicador,0) Exento,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='IVG')*multiplicador,0) Iva,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=21 )*multiplicador,0) NG21,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='I27')*multiplicador,0) Iva27,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=27)*multiplicador,0) NG27,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='I10')*multiplicador,0) Iva10,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=10.5)*multiplicador,0) NG10,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='EXE')*multiplicador,0) NG0,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='I05')*multiplicador,0) Iva5,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='IBC')*multiplicador,0) PibC,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='PIV')*multiplicador,0) PIV,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='IBB')*multiplicador,0) PIB,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='PAB')*multiplicador,0) PAB,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='PAC')*multiplicador,0) PAC,
isnull((select sum(Neto) from compfondositems 

where idtransaccion=v.idtransaccion and concepto='II')*multiplicador,0) II,
isnull((select sum(base) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='II')*multiplicador,0) BII,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and (concepto='GSI' or concepto='PGI' or concepto='PBB' or concepto='PBA'))*multiplicador,0) GSI,
case when v.tipofactura='C' or v.tipofactura='M' then isnull(
(select sum(Neto) 
from compfondositems
where idtransaccion=v.idtransaccion and (concepto='NG ' or concepto='EXE'))*multiplicador,0) else 0 end Monotributo, idOperacion
,202246.62 as totalNeto
from CompFondosHeader v
left join cphVarios vv
on v.idtransaccion=vv.idtransaccion
inner join TipCompModHeader t
on v.tipocomprobante=t.codigo
Left join Proveedores c
on isnull(vv.Codigo,v.Proveedor)=c.codigo
Left join Provfondo cv
on isnull(vv.Codigo,v.Proveedor)=cv.proveedor
left join categorias_iva ci
on c.civa=ci.idciva
inner join detalle_Operaciones do
on v.idtransaccion=do.idtransaccion and do.idtipotransaccion=3

where v.fecha between @Desde and @Hasta
and ivaCompras='S'
--and isnull(idtipotransaccion,1)=1
and v.proveedor<212000

order by v.fecha,nrocomprobante
















GO
/****** Object:  StoredProcedure [dbo].[Impresion_Presentacion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[Impresion_Presentacion]

-- Impresion_Presentacion 200405,1
(
	@Aniomes	int,
	@Tarjeta	int
)
as
Select  Sc.socio as [Socio]	, 
				0 as Entidad				,
				'Socios' as Dentidad,
				Sc.apellido as [Apellido]	,
				Sc.nombre as [Nombre]		,
				pt.tarjeta					,
				pt.numero as [Numero de Tarjeta]	,
				Sc.vencimiento as [Vencimiento]	,
				importe as cargo
from PresentacionesTarjetas pt
inner join Socios sc
on pt.socio=sc.socio
where periodo=@Aniomes and pt.tarjeta=@Tarjeta
and entidad=0

union

Select Sc.adherente as [Socio]	, 
				1 as Entidad				,
				'Fopros' as Dentidad,
				Sc.apellido as [Apellido]	,
				Sc.nombre as [Nombre]		,
				pt.tarjeta					,
				pt.numero as [Numero de Tarjeta]	,
				Sc.vencimiento as [Vencimiento]	,
				importe as cargo
from PresentacionesTarjetas pt
inner join Adherentes sc
on pt.socio=sc.Adherente
where periodo=@Aniomes and pt.tarjeta=@tarjeta
and entidad=1

order by entidad,apellido,nombre

GO
/****** Object:  StoredProcedure [dbo].[ImpresionRecibosDebitos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE   Procedure [dbo].[ImpresionRecibosDebitos] 
-- ImpresionRecibosDebitos 0,0,0,9
(
	@idOperacion 	int=0,
	@dSocio		int=0,
	@hSocio		int=0,
	@Entidad	int=9
)
as
Select hda.fecha,hda.idrecibo,hDa.Socio,hda.Entidad,
ltrim(rtrim(isnull(sc.apellido,isnull(ad.apellido,al.nyap))))+ ' ' +
ltrim(rtrim(isnull(sc.Nombre,isnull(ad.NOmbre,'')))) nyap,
cc.documentoNumero,dcc.concepto,dcc.importe,
isnull(co.Descripcion,nc.Descripcion) descripcio,hDa.idOperacion,dbo.numlet(hDA.importe) ImporteLetras,
pDesde,pHasta

from Header_RecibosDA hDA
inner join Detalle_recibosDA dDa
on hDa.idrecibo=dDa.idrecibo
inner join recibosDA rDa
on hDa.idOperacion=rDa.idOperacion
inner join AplicacionesCuentasCorrientes acc
on dda.idtransaccion=acc.idtransaccion
inner join CuentasCorrientes cc
on acc.idtransaccionCancelada=cc.idtransaccion
inner join DetalleCuentasCorrientes dcc
on cc.idtransaccion=dcc.idtransaccion
Left Join socios sc
on sc.socio=hDa.socio and hDA.entidad=0
Left Join Adherentes ad
on hDa.socio=ad.Adherente and hDA.entidad=1
Left Join Alumnos al
on hDa.socio=al.idAlumno and hDA.entidad=2
left join Conceptos co 
on cast(dcc.Concepto as char(3))=co.concepto
left join Horarios ho 
on cast(dcc.Concepto as char(3))=cast(ho.idCurso as char(3))
left join nominacursos nc
on cast(ho.idCurso as char(3))=cast(nc.idcurso as char(3))

where (hda.idOperacion=@idOperacion or @idOperacion=0)
and (hda.Entidad=@Entidad or @Entidad=9)
and (
(hda.socio between @dSocio and @hSocio)
or (@dSocio=0 and hda.socio<=@hSocio)
or (@hSocio=0 and hda.socio>=@dSocio)
or (@dSocio=0 and @hSocio=0)
)
order by hda.idrecibo,hda.socio,hda.entidad,cc.DocumentoNumero



GO
/****** Object:  StoredProcedure [dbo].[ImpuestosFactura]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE  Procedure [dbo].[ImpuestosFactura] 
(
	@idOperacion	int=12788
)
as

Select 3 Modo, vh.idtransaccion,vh.comprobante,vh.aniomes,vh.item, Case when Concepto='IVA' then 'IVA 21%' else COncepto end concepto,0 Subtotal ,Importe,0,0,null,0,vh.grilla,0,
case when vch.moneda=0 then '$' else 'u$s' end Signo,vch.tipofactura
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join VenCliItems vh
on do.idtransaccion=vh.idtransaccion
inner join VenCliHeader vch 
on vh.idtransaccion=vch.idtransaccion
inner join datosVenta dv
on ho.idOperacion=dv.idOperacion
where ho.idOperacion=@idOperacion
and idTipoTransaccion=0 -- and  vch.tipoFactura='B'
and ((vch.tipoFactura='A' or vh.Concepto<>'IVA') and vh.concepto<>'PIB' )
Union
Select 5 Modo, vh.idtransaccion,vh.comprobante,vh.aniomes,vh.item, Case when Concepto='PIB' then 'Percep IB Bs.As.' else COncepto end concepto,0 ,Importe,0,0,null,0,vh.grilla,0,
case when vch.moneda=0 then '$' else 'u$s' end Signo,vch.tipofactura

from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join VenCliItems vh
on do.idtransaccion=vh.idtransaccion
inner join VenCliHeader vch 
on vh.idtransaccion=vch.idtransaccion
inner join datosVenta dv
on ho.idOperacion=dv.idOperacion
where ho.idOperacion=@idOperacion
and idTipoTransaccion=0 -- and  vch.tipoFactura='B'
and (vh.concepto='PIB')
union
Select top 1 1 Modo, vh.idtransaccion,vh.comprobante,vh.aniomes,vh.item,'Importe Exento' Concepto,0,0,0,0,null,0,vh.grilla,0,
case when vch.moneda=0 then '$' else 'u$s' end Signo,vch.tipofactura
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join VenCliItems vh
on do.idtransaccion=vh.idtransaccion
inner join VenCliHeader vch 
on vh.idtransaccion=vch.idtransaccion
inner join datosVenta dv
on ho.idOperacion=dv.idOperacion
where ho.idOperacion=@idOperacion
and idTipoTransaccion=0 -- and  vch.tipoFactura='B'
and (vch.tipoFactura='A' or vh.Concepto<>'IVA')
Union
Select top 1 4 Modo, vh.idtransaccion,vh.comprobante,vh.aniomes,vh.item,'IVA 10.5%' Concepto,0,0,0,0,null,0,vh.grilla,0,
case when vch.moneda=0 then '$' else 'u$s' end Signo,vch.tipofactura
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join VenCliItems vh
on do.idtransaccion=vh.idtransaccion
inner join VenCliHeader vch 
on vh.idtransaccion=vch.idtransaccion
inner join datosVenta dv
on ho.idOperacion=dv.idOperacion
where ho.idOperacion=@idOperacion
and idTipoTransaccion=0 -- and  vch.tipoFactura='B'
and (vch.tipoFactura='A' or vh.Concepto<>'IVA') and  vch.tipoFactura<>'B'
union
Select top 1 0 Modo, vh.idtransaccion,vh.comprobante,vh.aniomes,vh.item,'Importe Gravado' Concepto,0 ,dv.vDeclarado Importe,0,0,null,0,vh.grilla,0,
case when vch.moneda=0 then '$' else 'u$s' end Signo,vch.tipofactura
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join VenCliItems vh
on do.idtransaccion=vh.idtransaccion
inner join VenCliHeader vch 
on vh.idtransaccion=vch.idtransaccion
inner join datosVenta dv
on ho.idOperacion=dv.idOperacion
where ho.idOperacion=@idOperacion
and idTipoTransaccion=0 -- and  vch.tipoFactura='B'
and (vch.tipoFactura='A')
union
Select top 1 2 Modo, vh.idtransaccion,vh.comprobante,vh.aniomes,vh.item,'SUB-TOTAL' Concepto,dv.vDeclarado ,0, 0,0,null,0,vh.grilla,0,
case when vch.moneda=0 then '$' else 'u$s' end Signo,vch.tipofactura
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join VenCliItems vh
on do.idtransaccion=vh.idtransaccion
inner join VenCliHeader vch 
on vh.idtransaccion=vch.idtransaccion
inner join datosVenta dv
on ho.idOperacion=dv.idOperacion
where ho.idOperacion=@idOperacion
and idTipoTransaccion=0 -- and  vch.tipoFactura='B'
and (vch.tipoFactura='A')
Union
Select top 1 0 Modo, vh.idtransaccion,vh.comprobante,vh.aniomes,vh.item,'Importe Gravado' Concepto,0,dv.vDeclarado+vh.importe,0,0,null,0,vh.grilla,0,
case when vch.moneda=0 then '$' else 'u$s' end Signo,vch.tipofactura
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join VenCliItems vh
on do.idtransaccion=vh.idtransaccion
inner join VenCliHeader vch 
on vh.idtransaccion=vch.idtransaccion
inner join datosVenta dv
on ho.idOperacion=dv.idOperacion
where ho.idOperacion=@idOperacion
and idTipoTransaccion=0 -- and  vch.tipoFactura='B'
and ((vch.tipoFactura='B' or vch.tipoFactura='E') and vh.Concepto='IVA')
union
Select top 1 2 Modo, vh.idtransaccion,vh.comprobante,vh.aniomes,vh.item,'SUB-TOTAL' Concepto,dv.vDeclarado+vh.Importe ,0, 0,0,null,0,vh.grilla,0,
case when vch.moneda=0 then '$' else 'u$s' end Signo,vch.tipofactura
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join VenCliItems vh
on do.idtransaccion=vh.idtransaccion
inner join VenCliHeader vch 
on vh.idtransaccion=vch.idtransaccion
inner join datosVenta dv
on ho.idOperacion=dv.idOperacion
where ho.idOperacion=@idOperacion
and idTipoTransaccion=0 -- and  vch.tipoFactura='B'
and ((vch.tipoFactura='B' or vch.tipoFactura='E') and vh.Concepto='IVA')













GO
/****** Object:  StoredProcedure [dbo].[ImpuestosPedido]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE   Procedure [dbo].[ImpuestosPedido] 
(
	@idOperacion	int=29775
)
as
Select vh.*
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join VenCliItemsPedidos vh
on do.idtransaccion=vh.idtransaccion


where ho.idOperacion=@idOperacion
and idTipoTransaccion=490



GO
/****** Object:  StoredProcedure [dbo].[ImpuestosPresupuesto]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE  Procedure [dbo].[ImpuestosPresupuesto] 
(
	@idOperacion	int=12788
)
as

Select 3 Modo, vh.idtransaccion,vh.comprobante,vh.aniomes,vh.item, Case when Concepto='IVA' then 'IVA 21%' else COncepto end concepto,0 Subtotal ,Importe,0,0,null,0,vh.grilla,0,
case when vch.moneda=0 then '$' else 'u$s' end Signo,vch.tipofactura
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join VenCliItemsPresupuestos vh
on do.idtransaccion=vh.idtransaccion
inner join Presupuestos vch 
on vh.idtransaccion=vch.idtransaccion
inner join datosVenta dv
on ho.idOperacion=dv.idOperacion
where ho.idOperacion=@idOperacion
and idTipoTransaccion=10 -- and  vch.tipoFactura='B'
and ((vch.tipoFactura='A' or vh.Concepto<>'IVA') and vh.concepto<>'PIB' )
Union
Select 5 Modo, vh.idtransaccion,vh.comprobante,vh.aniomes,vh.item, Case when Concepto='PIB' then 'Percep IB Bs.As.' else COncepto end concepto,0 ,Importe,0,0,null,0,vh.grilla,0,
case when vch.moneda=0 then '$' else 'u$s' end Signo,vch.tipofactura

from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join VenCliItemsPresupuestos vh
on do.idtransaccion=vh.idtransaccion
inner join Presupuestos vch 
on vh.idtransaccion=vch.idtransaccion
inner join datosVenta dv
on ho.idOperacion=dv.idOperacion
where ho.idOperacion=@idOperacion
and idTipoTransaccion=10 -- and  vch.tipoFactura='B'
and (vh.concepto='PIB')
union
Select top 1 1 Modo, vh.idtransaccion,vh.comprobante,vh.aniomes,vh.item,'Importe Exento' Concepto,0,0,0,0,null,0,vh.grilla,0,
case when vch.moneda=0 then '$' else 'u$s' end Signo,vch.tipofactura
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join VenCliItemsPresupuestos vh
on do.idtransaccion=vh.idtransaccion
inner join Presupuestos vch 
on vh.idtransaccion=vch.idtransaccion
inner join datosVenta dv
on ho.idOperacion=dv.idOperacion
where ho.idOperacion=@idOperacion
and idTipoTransaccion=10 -- and  vch.tipoFactura='B'
and (vch.tipoFactura='A' or vh.Concepto<>'IVA')
Union
Select top 1 4 Modo, vh.idtransaccion,vh.comprobante,vh.aniomes,vh.item,'IVA 10.5%' Concepto,0,0,0,0,null,0,vh.grilla,0,
case when vch.moneda=0 then '$' else 'u$s' end Signo,vch.tipofactura
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join VenCliItemsPresupuestos vh
on do.idtransaccion=vh.idtransaccion
inner join Presupuestos vch 
on vh.idtransaccion=vch.idtransaccion
inner join datosVenta dv
on ho.idOperacion=dv.idOperacion
where ho.idOperacion=@idOperacion
and idTipoTransaccion=10 -- and  vch.tipoFactura='B'
and (vch.tipoFactura='A' or vh.Concepto<>'IVA') and  vch.tipoFactura<>'B'
union
Select top 1 0 Modo, vh.idtransaccion,vh.comprobante,vh.aniomes,vh.item,'Importe Gravado' Concepto,0 ,dv.vDeclarado Importe,0,0,null,0,vh.grilla,0,
case when vch.moneda=0 then '$' else 'u$s' end Signo,vch.tipofactura
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join VenCliItemsPresupuestos vh
on do.idtransaccion=vh.idtransaccion
inner join Presupuestos vch 
on vh.idtransaccion=vch.idtransaccion
inner join datosVenta dv
on ho.idOperacion=dv.idOperacion
where ho.idOperacion=@idOperacion
and idTipoTransaccion=10 -- and  vch.tipoFactura='B'
and (vch.tipoFactura='A')
union
Select top 1 2 Modo, vh.idtransaccion,vh.comprobante,vh.aniomes,vh.item,'SUB-TOTAL' Concepto,dv.vDeclarado ,0, 0,0,null,0,vh.grilla,0,
case when vch.moneda=0 then '$' else 'u$s' end Signo,vch.tipofactura
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join VenCliItemsPresupuestos vh
on do.idtransaccion=vh.idtransaccion
inner join Presupuestos vch 
on vh.idtransaccion=vch.idtransaccion
inner join datosVenta dv
on ho.idOperacion=dv.idOperacion
where ho.idOperacion=@idOperacion
and idTipoTransaccion=10 -- and  vch.tipoFactura='B'
and (vch.tipoFactura='A')
Union
Select top 1 0 Modo, vh.idtransaccion,vh.comprobante,vh.aniomes,vh.item,'Importe Gravado' Concepto,0,dv.vDeclarado+vh.importe,0,0,null,0,vh.grilla,0,
case when vch.moneda=0 then '$' else 'u$s' end Signo,vch.tipofactura
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join VenCliItemsPresupuestos vh
on do.idtransaccion=vh.idtransaccion
inner join Presupuestos vch 
on vh.idtransaccion=vch.idtransaccion
inner join datosVenta dv
on ho.idOperacion=dv.idOperacion
where ho.idOperacion=@idOperacion
and idTipoTransaccion=10 -- and  vch.tipoFactura='B'
and ((vch.tipoFactura='B' or vch.tipoFactura='E') and vh.Concepto='IVA')
union
Select top 1 2 Modo, vh.idtransaccion,vh.comprobante,vh.aniomes,vh.item,'SUB-TOTAL' Concepto,dv.vDeclarado+vh.Importe ,0, 0,0,null,0,vh.grilla,0,
case when vch.moneda=0 then '$' else 'u$s' end Signo,vch.tipofactura
from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join VenCliItemsPresupuestos vh
on do.idtransaccion=vh.idtransaccion
inner join Presupuestos vch 
on vh.idtransaccion=vch.idtransaccion
inner join datosVenta dv
on ho.idOperacion=dv.idOperacion
where ho.idOperacion=@idOperacion
and idTipoTransaccion=10 -- and  vch.tipoFactura='B'
and ((vch.tipoFactura='B' or vch.tipoFactura='E') and vh.Concepto='IVA')














GO
/****** Object:  StoredProcedure [dbo].[Imputa_Rendiciones]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE   Procedure [dbo].[Imputa_Rendiciones] (@Aniomes int)
as

DECLARE @idOperacion 	as int
/*** Declaro el Cursor de los Conceptos ***/
DECLARE Rendiciones CURSOR FOR 
	SELECT idOperacion FROM Header_Operaciones where 
(tipodeOperacion=19 or tipodeOperacion=17) and aniomes=@Aniomes

/*** Abro el Cursor ***/
OPEN Rendiciones
FETCH NEXT FROM Rendiciones INTO @idOperacion

/*** Recorro el Cursor ***/
WHILE @@FETCH_STATUS = 0
BEGIN

	Print @idOperacion

	execute Asiento_rendicion @idOperacion

	FETCH NEXT FROM Rendiciones INTO @idOperacion
END

CLOSE Rendiciones
DEALLOCATE Rendiciones




GO
/****** Object:  StoredProcedure [dbo].[Imputacion_Anses]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE           Procedure [dbo].[Imputacion_Anses] (@Periodo int,@PeriodoAnses char(4))
as
 
Select '20'+substring(col002,40,2)+substring(col002,38,2) as Periodo,
Socio,Apellido,Nombre,
sum(cast(Substring(col002,32,6) as numeric(18,2))/100)/(1+(select Count(*) from complementoAnses ca where ca.socio=sc.socio and aniomes=@Periodo)) as MES,
(Select Importe/(1+(select Count(*) from complementoAnses where socio=sc.socio))
 from cuentasCorrientes where socio=sc.socio and documentoNumero=@Periodo and entidad=0 and concepto='MES'),
(Select Cancelado from cuentasCorrientes where socio=sc.socio and documentoNumero=@Periodo and entidad=0 and concepto='MES'),
(Select idTransaccion from cuentasCorrientes where socio=sc.socio and documentoNumero=@Periodo and entidad=0 and concepto='MES')
from memm mm
Left join 
socios sc on sc.FichaMun=Substring(mm.col001,3,8)
where 
((isnull(sc.socio,0)<>6811 and isnull(sc.socio,0)<>11381 and isnull(sc.socio,0)<>17950
and isnull(sc.socio,0)<>6912))
--and sc.apellido is null
--and sc.socio=7349
Group by Socio,Apellido,Nombre
,'20'+substring(col002,40,2)+substring(col002,38,2)

union
Select ca.mesaimputar,
sc.Socio,Apellido,Nombre,
sum(cast(Substring(col002,32,6) as numeric(18,2))/100)/(1+(select Count(*) from complementoAnses ca where ca.socio=sc.socio and aniomes=@Periodo)) as MES,
(Select Importe from cuentasCorrientes cc where cc.socio=sc.socio and documentoNumero=@Periodo and entidad=0 and concepto='MES'),
(Select Cancelado from cuentasCorrientes cc where cc.socio=sc.socio and documentoNumero=@Periodo and entidad=0 and concepto='MES'),
(Select idTransaccion from cuentasCorrientes cc where cc.socio=sc.socio and documentoNumero=@Periodo and entidad=0 and concepto='MES')

from memm mm
Left join 
socios sc on sc.FichaMun=Substring(mm.col001,3,8)
inner join complementoAnses ca on ca.socio=sc.socio 
where 
((isnull(sc.socio,0)<>6811 and isnull(sc.socio,0)<>11381 and isnull(sc.socio,0)<>17950
and isnull(sc.socio,0)<>6912))
and aniomes=@Periodo
--and sc.socio=7349
--and sc.apellido is null
Group by sc.Socio,Apellido,Nombre,ca.mesaimputar
,'20'+substring(col002,40,2)+substring(col002,38,2)



GO
/****** Object:  StoredProcedure [dbo].[Imputacion_Egreso]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  Procedure [dbo].[Imputacion_Egreso] (@idOperacion int)
as
Select ho1.Observacion,ho1.asientodiario,ho1.tipoasiento,ho1.aniomes,ho1.fecha,ho1.observacion,
ai.cuenta,ai.debe,ai.haber,ai.centrocosto,ai.observacion as detalleCuenta,ct.descripcion as descripcioncuenta
from Header_operaciones ho
inner join Detalle_operaciones do
on ho.idOperacion=do.idOperacion
lEFT join AplicacionesCuentasaPagar acp
on do.idtransaccion=acp.idtransaccion
left join Detalle_operaciones do1
on acp.idtransaccionCancelada=do1.idTransaccion
left join Header_operaciones ho1
on ho1.idOperacion=do1.idOperacion
left join asientosdiariosHeader ah
on ah.asiento=ho1.asientodiario and ah.tipoasiento=ho1.tipoasiento and ah.aniomes=ho1.aniomes
left join asientosdiariositems ai
on ai.asiento=ah.asiento and ai.tipoasiento=ah.tipoasiento and ai.aniomes=ah.aniomes
left join cuentas ct
on ai.cuenta=ct.cuenta
where ho.idOperacion=@idOperacion
and do.idTipotransaccion=1
and do1.idTipotransaccion=1
and ho1.tipoasiento=3


GO
/****** Object:  StoredProcedure [dbo].[Imputacion_Muni]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE                             Procedure [dbo].[Imputacion_Muni](@anioMes int,@Complemento int)
as
/*** Declaro Variables Imputacion ***/
DECLARE @socio 			as int
DECLARE @Meses 			as int
DECLARE @Total		 	as Numeric(18,2)
DECLARE @Parcial 		as Numeric(18,2)
DECLARE @Grupo			as Char(1)
DECLARE @MesComplemento		as int
DECLARE @boolWhere		as char(1)
Declare @Dump			as Int

/*** Declaro el Cursor de los Conceptos ***/
DECLARE Conceptos CURSOR FOR 
	Select --sc.CuilMuni, 
	isnull((Select max(socio) from socios where cuilMuni=sc.cuilMuni),
	(Select MAx(Socio) from socios where cuilMuni=sc.cuilMuni))
	as Socio,
	dbo.DeudasHospitales(@Complemento,(Select max(Socio) from socios where cuilMuni=sc.cuilMuni)) as Descuentos,
	sum(cast(substring(col002,38,6) as numeric(18,2))/100) as Importe_Total,
	sum(cast(substring(col002,38,6) as numeric(18,2))/100)/dbo.DeudasHospitales(@Complemento,(Select max(Socio) from socios where cuilMuni=sc.cuilMuni)) as DescuentoPeriodo,
	(Select Grupo from socios where socio=(Select max(Socio) from socios where cuilMuni=sc.cuilMuni)) as Grupo
	from ldsp580 ida
	Left join Socios sc on ida.col003=sc.cuilMuni

--    where (sc.socio=20914 or sc.socio=23974)

/*	R E T R O A C T I V O S 
((cast(substring(col004,1,8) as int)<>0 
or cast(substring(col004,10,8) as int)=0) or @Retroactivo=0) 
*/


	Group by col003,sc.CuilMuni
 /*	R E T R O A C T I V O S 
 Union
	Select --sc.CuilMuni, 
	isnull((Select Socio from socios where cuilMuni=sc.cuilMuni),
	(Select MAx(Socio) from socios where cuilMuni=sc.cuilMuni))
	as Socio,
--	dbo.DeudasHospitales(@Complemento,(Select Socio from socios where cuilMuni=sc.cuilMuni)) as Descuentos,
	3 as descuentos,
	sum(cast(substring(col002,38,6) as numeric(18,2))/100) as Importe_Total,
	sum(cast(substring(col002,38,6) as numeric(18,2))/100)/dbo.DeudasHospitales(@Complemento,(Select Socio from socios where cuilMuni=sc.cuilMuni)) as DescuentoPeriodo,
	(Select Grupo from socios where cuilMuni=sc.cuilMuni) as Grupo
	from ldsp580 ida
	Left join Socios sc on ida.col003=sc.cuilMuni
	where 
	cast(substring(col004,10,8) as int)<>0 
	and cast(substring(col004,1,8) as int)=0

	Group by col003,sc.CuilMuni
*/
/*** Borro TempImputaciones ***/
Delete from Temp_Imputacion

/*** Abro el Cursor ***/
OPEN Conceptos
FETCH NEXT FROM Conceptos INTO @Socio, @Meses,@Total,@Parcial,@Grupo

Select @Dump=@Aniomes

/*** Recorro el Cursor ***/
WHILE @@FETCH_STATUS = 0
BEGIN
	Select @Parcial=@Total
/*	print @Socio
	Print @Meses
	Print @Total
	Print @Parcial
	Print @Grupo */
	IF @meses>1 
		select	@Parcial=Round(@Total/@Meses,2)

	IF @meses<>3
		insert into Temp_imputacion
		Select * from Conceptos_Activos_Muni(0,@Socio,@anioMes,@Aniomes,@Parcial)

	if @Meses=2
		Begin
			select	@Parcial=@Total-@Parcial
			Select @MesComplemento=(Select MesaImputar From ComplementoHospitales Where socio=@Socio and aniomes=@Complemento)
			insert into Temp_imputacion
			Select * from Conceptos_Activos_Muni(0,@Socio,@anioMes,@MesComplemento,@Parcial)
		end

	if @meses=3
		Begin
			insert into Temp_imputacion
			Select * from Conceptos_Activos_Muni(0,@Socio,200308,200306,@Parcial)
			insert into Temp_imputacion
			Select * from Conceptos_Activos_Muni(0,@Socio,200308,200307,@Parcial)
			select	@Parcial=@Total-(@Parcial+@Parcial)
			insert into Temp_imputacion
			Select * from Conceptos_Activos_Muni(0,@Socio,200308,200308,@Parcial)
		end

	FETCH NEXT FROM Conceptos INTO @Socio, @Meses,@Total,@Parcial,@Grupo
END

CLOSE Conceptos
DEALLOCATE Conceptos

/*** Declaro Variables Imputacion ***/
Declare @item			as int
Declare @xSocio			as int
Declare @xPeriodo		as int
Declare @xParcial		as numeric(18,2)
Declare @Periodo		as int
Declare @Descripcion		as char(20)
Declare @Concepto		as Char(3)
Declare @Modalidad		as char(1)
Declare @Importe		as numeric(18,2)
Declare	@Mes			as numeric(18,2)
Declare @Conceptos 		as Int
Declare @TotalPorcentaje	as Numeric(18,2)
Declare @Calculo		as Numeric(18,2)

Select @xSocio=0
Select @xPeriodo=0
Select @xParcial=0
Select @Item=0

/*** Declaro el Cursor de los Conceptos ***/
DECLARE Conceptos_II CURSOR for
Select Periodo,Socio,Concepto,Modalidad,Importe,Mes,Conceptos,TotalPorcentaje from Temp_imputacion order by Socio,Periodo,Modalidad,Concepto

OPEN Conceptos_II
FETCH NEXT FROM Conceptos_II INTO @Periodo,@Socio,@Concepto,@Modalidad,@Importe,@Mes,@Conceptos,@TotalPorcentaje

Declare @MesParcial numeric(18,2)

WHILE @@FETCH_STATUS = 0
BEGIN
	if @xsocio<>@Socio or @xPeriodo<>@Periodo

		begin
			Select @item=0
			select @xSocio=@socio
			Select @xPeriodo=@Periodo
			Select @xParcial=0
			Select @MesParcial=@Mes
		end

--	Else

/*	Print @Concepto
	Print @modalidad
	Print @MesParcial
	Print @Importe
*/
	Select @item=@item+1
	if @Modalidad='I'
		begin
			Select @xParcial=@xParcial+@Importe
			Select @MesParcial=@MesParcial-@Importe	
		end
	else
		begin
			if @item=@conceptos
				select @Calculo=@Mes-@xParcial
			else
				select @Calculo=Round(@MesParcial/@TotalPorcentaje*@Importe,2)
				Select @xParcial=@xParcial+@Calculo
	
			UPDATE Temp_Imputacion SET Importe = @Calculo
			WHERE socio=@Socio and periodo=@Periodo and concepto=@Concepto
	
		end			

	FETCH NEXT FROM Conceptos_II INTO @Periodo,@Socio,@Concepto,@Modalidad,@Importe,@Mes,@Conceptos,@TotalPorcentaje
END

CLOSE Conceptos_II
DEALLOCATE Conceptos_II

/*** Incorporo Hospitales a Hospitales Socios ***/
Insert into Hospitales_Socios
Select Distinct(sc.socio),'2'+substring(ih.col001,7,8) from ldsp580 ih
Left Join socios sc on ih.col003=sc.cuilmuni
left Join Hospitales_socios hs on hs.socio=sc.socio
where hs.socio is null



GO
/****** Object:  StoredProcedure [dbo].[Inconsistencias_Muni]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


--Inconsistencias_Muni 200606

CREATE Procedure [dbo].[Inconsistencias_Muni] (@Periodo int)
as
/*
Delete from n580
insert into n580
select Col001,col002 from n580_Historico
where periodo=@Periodo

Delete from ldsp580
Insert into ldsp580 
Select
Substring(texto,1,33) as col001,
Substring(texto,34,47) as col002, 
Substring(texto,81,13) as col003, 
Substring(texto,94,36) as col004 
from ldsp580_Historico where Periodo=@Periodo
*/
Declare @SqlStr nvarchar(800)

set @SqlStr='Select distinct sc.socio,sc.apellido,sc.Nombre,ih.col002,ih.col001,sc.grupo From N580_Historico ih
Left Join ldsp580_Historico tdc on Substring(tdc.texto,81,13)=ih.col001 and tdc.periodo=' + cast(@periodo as char(6)) + 
' Left join Socios sc on sc.CuilMuni=ih.col001
Left Join Socios sc1 on sc.Numedocto=substring(ih.col001,1,8)
Where tdc.texto is null and len(ltrim(rtrim(sc.CuilMuni)))>0' + --and tdc.periodo='  
' and ih.periodo=' + cast(@periodo as char(6)) +
' order by sc.socio '

--print @sqlstr
exec sp_executesql @sqlstr






GO
/****** Object:  StoredProcedure [dbo].[InfoGanancias]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Procedure [dbo].[InfoGanancias]
(
	@Desde varchar(8)='20100701',
	@Hasta varchar(8)='20110630'
)
as
Select vt.fechaEmision Fecha,cl.razonSocial RazonSocial,cl.cuit,
FechaRetencion,icg.idRegimen,
isnull(isnull(icg.importeRetencion,vt.importe),0) Importe, 
NumeroRetencion,
icg.idcampo, vt.idtransaccion,
vch.cliente
from ValoresTesoreria vt
full outer join infoComplementoGanancias icg
on icg.idtransaccion=vt.idtransaccion
inner join detalle_operaciones do 
on vt.idtransaccion=do.idtransaccion and idtipotransaccion=2
left join detalle_operaciones do1 
on do.idoperacion=do1.idoperacion and do1.idtipotransaccion=0
left join vencliheader vch
on do1.idtransaccion=vch.idtransaccion
left join clientes cl
on vch.cliente=cl.codigo
where 
(
(idconcepto_tesoreria=24) 
or 
(idcampo is not null and vt.idtransaccion is null)
)
and 
(
vt.fechaemision between @Desde and @Hasta
or
icg.fechaRetencion between @Desde and @Hasta
)

order by isnull(icg.FechaRetencion,vt.FechaEmision)


GO
/****** Object:  StoredProcedure [dbo].[Ingresa_Detalle]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


Create  Procedure [dbo].[Ingresa_Detalle] (@Socio int, @Periodo int, @idtransaccion int) 
as

Declare @DPeriodo Datetime,@IPeriodo int

Select @Dperiodo=(Select Fechabaja from Socios where 
socio=@Socio)

if @DPeriodo is not null
Begin
	Print 'Null'
	Select @Iperiodo=(Select 
	(convert(char(4),year(FechaBaja)) + right((convert(varchar(2),month(FechaBaja)) + 100),2))
	from socios 
	where socio=@Socio)
End
else
	Select @IPeriodo=@Periodo

Print @iPeriodo

/*Delete from DetalleCuentas*/
Insert into DetalleCuentasCorrientes
Select @IdTransaccion as idtransaccion,1 as item,concepto,0 as cantidad, importe 
from Conceptos_Activos_Muni(0,@Socio,@iPeriodo,@Periodo,0)


GO
/****** Object:  StoredProcedure [dbo].[Ingresa_Detalle_Anses]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



Create  Procedure [dbo].[Ingresa_Detalle_Anses] (@Socio int, @Periodo int, @idtransaccion int) 
as

Declare @DPeriodo Datetime,@IPeriodo int

Select @Dperiodo=(Select Fechabaja from Socios where 
socio=@Socio)

if @DPeriodo is not null
Begin
	Print 'Null'
	Select @Iperiodo=(Select 
	(convert(char(4),year(FechaBaja)) + right((convert(varchar(2),month(FechaBaja)) + 100),2))
	from socios 
	where socio=@Socio)
End
else
	Select @IPeriodo=@Periodo

Print @iPeriodo

/*Delete from DetalleCuentas*/
Insert into DetalleCuentasCorrientes
Select @IdTransaccion as idtransaccion,1 as item,concepto,0 as cantidad, importe 
from Conceptos_Activos_Anses(0,@Socio,@iPeriodo,@Periodo,0)



GO
/****** Object:  StoredProcedure [dbo].[Ingresa_diskette_anses]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[Ingresa_diskette_anses] (@Periodo int)
as
-- Diskette Anses. el Txt que vuelve del anses debe ingresarse en esta tabla
Delete from anses where Periodo=@Periodo
Insert into Anses
Select 
(Select Max(Socio) from socios sc where cast(substring(ida.col001,3,8) as numeric(18,0) )=sc.Fichamun) as Socio,
dbo.DeudasHospitales(200212,(Select Socio from socios where socio=(Select Max(Socio) from socios sc where cast(substring(ida.col001,3,8) as numeric(18,0) )=sc.Fichamun))) as Descuentos,
round(cast(substring(col002,32,6) as numeric(18,2))/100,2) as Importe_Total,
@Periodo as Periodo
from DisketteAnses ida





GO
/****** Object:  StoredProcedure [dbo].[IngresoEgresoDia]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[IngresoEgresoDia](@dtfecha datetime=null)
as
begin
  if @dtfecha is null set @dtfecha=getdate()
  select a.idOperacion,a.Fecha,a.idConcepto,b.descripcion [Desc. Concepto],
  a.tipooperacion,c.descripcion [Desc. Tipo Oper.],a.moneda,d.descripcion [Desc. Moneda],
  a.Cantidad,a.MonedaNeto,a.Observacion,NULL cliente,NULL [Razon Social]
  from movimientos a
  inner join conceptos b on a.idconcepto=b.idconcepto
  inner join operaciones c on a.tipooperacion=c.idTipoOperacion
  inner join monedas d on a.moneda=d.idmoneda
  where a.tipooperacion in (2,3) and day(a.fecha)=day(@dtfecha) 
  and month(a.fecha)=month(@dtfecha) and year(a.fecha)=year(@dtfecha)
  union all
  select a.idOperacion,a.Fecha,NULL idConcepto,NULL [Desc. Concepto],
  a.tipooperacion,c.descripcion [Desc. Tipo Oper.],a.moneda,d.descripcion [Desc. Moneda],
  a.Cantidad,a.MonedaNeto,a.Observacion,a.cliente,b.Razon_Social [Razon Social]
  from movimientos a
  inner join clientes b on a.cliente=b.codigo
  inner join operaciones c on a.tipooperacion=c.idTipoOperacion
  inner join monedas d on a.moneda=d.idmoneda
  where a.tipooperacion in (2,3) and day(a.fecha)=day(@dtfecha) 
  and month(a.fecha)=month(@dtfecha) and year(a.fecha)=year(@dtfecha)
  order by [Razon Social],d.descripcion,a.tipooperacion,a.fecha
end


GO
/****** Object:  StoredProcedure [dbo].[InicioLibro]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create Procedure [dbo].[InicioLibro] (
	@Concepto int ,
	@Fecha char(8)
)
as

Select 
(Select sum(Importe) 
from ValoresTesoreria
where tipomovimiento=1
and idConcepto_Tesoreria=@Concepto
and fechaEmision<=@Fecha
)+
(Select sum(-Importe) 
from ValoresTesoreria
where tipomovimiento=2
and idConcepto_Tesoreria=@Concepto
and fechaEmision<=@Fecha
)


GO
/****** Object:  StoredProcedure [dbo].[InsItemLiquidacion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE   Procedure [dbo].[InsItemLiquidacion]
	@idLiq int,
	@Legajo int,
	@Concepto int,
	@Horas numeric(18,2),
	@Importe numeric(18,2),
	@TipoCalculo char(1),
	@origen char(1)

as 

insert into Items_Liquidaciones (idLiquidacion, Legajo, Concepto, Horas, Importe, TipoCalculo, Origen)
values (@idLiq, @Legajo, @Concepto, @horas, @Importe,@TipoCalculo,@Origen)


GO
/****** Object:  StoredProcedure [dbo].[Internos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE  Procedure [dbo].[Internos] 
(
	@idOperacion int=38620
)
as
Select numerointerno,FechaEmision,Vencimiento,b.banco,numero,importe,Descripcion dbanco,ho.observacion
from parametrosgeneralessueldos,header_operaciones ho 
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
Inner join ValoresTesoreria vt
on do.idtransaccion=vt.idtransaccion 
left join bancos b
on vt.banco=b.banco
where ho.idOperacion=@idOperacion
and idConcepto_tesoreria=cheques

GO
/****** Object:  StoredProcedure [dbo].[IvaCompras]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE   Procedure [dbo].[IvaCompras]
(
	@Desde Char(8)='20150101',
	@Hasta Char(8)='20150131'
)
as

Select v.fecha,t.comprobante Comp,substring(nrocomprobante,1,4) + '-' + Substring(nrocomprobante,5,8) nrocomprobante,tipofactura,isnull(cv.razonsocial,c.razonSocial) razonsocial,isnull(cv.cuit,c.cuit) cuit,ci.resumido dciva,
totalimporte*multiplicador total,
case when v.tipofactura<>'C' and v.tipofactura<>'M' then isnull(
(select sum(baseContable) 
from CompProvitems
where idtransaccion=v.idtransaccion and concepto='NG ' and v.tipofactura<>'C' and v.tipofactura<>'M')*multiplicador,0) else 0 end Neto,
isnull(
(select sum(baseContable) 
from CompProvitems
where idtransaccion=v.idtransaccion and ((concepto='EXE' or (concepto='NG ' and alicuota=0)) and (v.tipofactura<>'C' and v.tipofactura<>'M')))*multiplicador,0) Exento,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='IVG')*multiplicador,0) Iva,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=21)*multiplicador,0) NG21,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='I27')*multiplicador,0) Iva27,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=27)*multiplicador,0) NG27,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='I10')*multiplicador,0) Iva10,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=10.5)*multiplicador,0) NG105,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=0)*multiplicador,0) NG0,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='I05')*multiplicador,0) Iva5,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='IBC')*multiplicador,0) PibC,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PIV')*multiplicador,0) PIV,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='IBB')*multiplicador,0) PIB,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PAB')*multiplicador,0) PAB,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PAC')*multiplicador,0) PAC,
isnull((select sum(baseContable) from CompProvItems 
/*
where idtransaccion=v.idtransaccion and concepto='PGI')*multiplicador,0) PGI,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PBB')*multiplicador,0) PBB,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PBC')*multiplicador,0) PBC,
isnull((select sum(baseContable) from CompProvItems 
*/
where idtransaccion=v.idtransaccion and concepto='II')*multiplicador,0) II,
isnull((select sum(base) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='II')*multiplicador,0) BII,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and (concepto='GSI' or concepto='PGI' or concepto='PBB' or concepto='PBA'))*multiplicador,0) GSI,
case when v.tipofactura='C' or v.tipofactura='M' then isnull(
(select sum(baseContable)
from CompProvitems
where idtransaccion=v.idtransaccion and (concepto='NG ' or concepto='EXE'))*multiplicador,0) else 0 end Monotributo,
idoperacion, 202246.62 as totalNeto

--into tIvacompras
-- into controlMayor

from CompProVHeader v
left join cphVarios vv
on v.idtransaccion=vv.idtransaccion
inner join TipCompModHeader t
on v.tipocomprobante=t.codigo
Left join Proveedores c
on isnull(vv.Codigo,v.Proveedor)=c.codigo
Left join Provfondo cv
on isnull(vv.Codigo,v.Proveedor)=cv.proveedor
left join categorias_iva ci
on c.civa=ci.idciva
left join detalle_Operaciones do
on v.idtransaccion=do.idtransaccion and do.idtipotransaccion=1
where v.fecha between @Desde and @Hasta
and ivaCompras='S'
--and isnull(idtipotransaccion,1)=1
and v.proveedor<212000

union

Select v.fecha,t.comprobante Comp,substring(nrocomprobante,1,4) + '-' + Substring(nrocomprobante,5,8) nrocomprobante,tipofactura,isnull(cv.razonsocial,c.razonSocial) razonsocial,isnull(cv.cuit,c.cuit) cuit,ci.resumido dciva,
totalimporte*multiplicador total,
case when v.tipofactura<>'C' and v.tipofactura<>'M' then isnull(
(select sum(Neto) 
from compfondositems
where idtransaccion=v.idtransaccion and concepto='NG ')*multiplicador,0) else 0 end Neto,
isnull(
(select sum(Neto) 
from compfondositems
where idtransaccion=v.idtransaccion and concepto='EXE' and v.tipoFactura<>'C' and v.tipoFactura<>'M')*multiplicador,0) Exento,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='IVG')*multiplicador,0) Iva,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=21 )*multiplicador,0) NG21,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='I27')*multiplicador,0) Iva27,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=27)*multiplicador,0) NG27,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='I10')*multiplicador,0) Iva10,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=10.5)*multiplicador,0) NG10,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='EXE')*multiplicador,0) NG0,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='I05')*multiplicador,0) Iva5,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='IBC')*multiplicador,0) PibC,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='PIV')*multiplicador,0) PIV,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='IBB')*multiplicador,0) PIB,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='PAB')*multiplicador,0) PAB,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='PAC')*multiplicador,0) PAC,
isnull((select sum(Neto) from compfondositems 
/*
where idtransaccion=v.idtransaccion and concepto='PGI')*multiplicador,0) PGI,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='PBB')*multiplicador,0) PBB,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='PBC')*multiplicador,0) PBC,
isnull((select sum(Neto) from compfondositems 
*/
where idtransaccion=v.idtransaccion and concepto='II')*multiplicador,0) II,
isnull((select sum(base) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='II')*multiplicador,0) BII,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and (concepto='GSI' or concepto='PGI' or concepto='PBB' or concepto='PBA'))*multiplicador,0) GSI,
case when v.tipofactura='C' or v.tipofactura='M' then isnull(
(select sum(Neto) 
from compfondositems
where idtransaccion=v.idtransaccion and (concepto='NG ' or concepto='EXE'))*multiplicador,0) else 0 end Monotributo, idOperacion
,202246.62 as totalNeto
from CompFondosHeader v
left join cphVarios vv
on v.idtransaccion=vv.idtransaccion
inner join TipCompModHeader t
on v.tipocomprobante=t.codigo
Left join Proveedores c
on isnull(vv.Codigo,v.Proveedor)=c.codigo
Left join Provfondo cv
on isnull(vv.Codigo,v.Proveedor)=cv.proveedor
left join categorias_iva ci
on c.civa=ci.idciva
inner join detalle_Operaciones do
on v.idtransaccion=do.idtransaccion and do.idtipotransaccion=3

where v.fecha between @Desde and @Hasta
and ivaCompras='S'
--and isnull(idtipotransaccion,1)=1
and v.proveedor<212000

order by v.fecha,nrocomprobante






























GO
/****** Object:  StoredProcedure [dbo].[IvaComprasAuditron]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Procedure [dbo].[IvaComprasAuditron]
(
	@Periodo int=200712
)
as

Select v.fecha,comp,nrocomprobante,tipofactura,razonSocial,ci.descripcion dciva,totalimporte*multiplicador,isnull(
(select sum(baseContable) 
from CompProvitems
where idtransaccion=v.idtransaccion and concepto=' NG')*multiplicador,0),
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='IVA')*multiplicador,0) 
from CompProVHeader v
inner join TipCompModHeader t
on v.tipocomprobante=t.codigo
inner join Proveedores c
on v.Proveedor=c.codigo
inner join categorias_iva ci
on c.civa=ci.idciva

where v.aniomes=@Periodo
and ivaCompras='S'
--and isnull(idtipotransaccion,1)=1
order by v.fecha,nrocomprobante

Select * from CompProvItems
where importe=104.99

Select * from CompProvHeader
where idtransaccion between 25369 and 25372
and tipoComproBante<>12

GO
/****** Object:  StoredProcedure [dbo].[IvaComprasControl]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[IvaComprasControl]
(
	@Desde Char(8)='20100401',
	@Hasta Char(8)='20100430'
)
as

Drop table ControlMayor

Select v.fecha,t.comprobante Comp,substring(nrocomprobante,1,4) + '-' + Substring(nrocomprobante,5,8) nrocomprobante,tipofactura,isnull(cv.razonsocial,c.razonSocial) razonsocial,isnull(cv.cuit,c.cuit) cuit,ci.resumido dciva,
totalimporte*multiplicador total,
case when v.tipofactura<>'C' and v.tipofactura<>'M' then isnull(
(select sum(baseContable) 
from CompProvitems
where idtransaccion=v.idtransaccion and concepto='NG ')*multiplicador,0) else 0 end Neto,
isnull(
(select sum(baseContable) 
from CompProvitems
where idtransaccion=v.idtransaccion and ((concepto='EXE' or (concepto='NG ' and alicuota=0)) and (v.tipofactura<>'C' and v.tipofactura<>'M')))*multiplicador,0) Exento,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='IVG')*multiplicador,0) Iva,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=21)*multiplicador,0) NG21,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='I27')*multiplicador,0) Iva27,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=27)*multiplicador,0) NG27,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='I10')*multiplicador,0) Iva10,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=10.5)*multiplicador,0) NG105,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=0)*multiplicador,0) NG0,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='I05')*multiplicador,0) Iva5,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='IBC')*multiplicador,0) PibC,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PIV')*multiplicador,0) PIV,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='IBB')*multiplicador,0) PIB,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PGI')*multiplicador,0) PGI,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PAB')*multiplicador,0) PAB,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PAC')*multiplicador,0) PAC,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PBB')*multiplicador,0) PBB,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PBC')*multiplicador,0) PBC,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='II')*multiplicador,0) II,
isnull((select sum(base) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='II')*multiplicador,0) BII,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='GSI')*multiplicador,0) GSI,
case when v.tipofactura='C' or v.tipofactura='M' then isnull(
(select sum(baseContable)
from CompProvitems
where idtransaccion=v.idtransaccion and (concepto='NG ' or concepto='EXE'))*multiplicador,0) else 0 end Monotributo,
idoperacion

into controlMayor

from CompProVHeader v
left join cphVarios vv
on v.idtransaccion=vv.idtransaccion
inner join TipCompModHeader t
on v.tipocomprobante=t.codigo
Left join Proveedores c
on isnull(vv.Codigo,v.Proveedor)=c.codigo
Left join Provfondo cv
on isnull(vv.Codigo,v.Proveedor)=cv.proveedor
left join categorias_iva ci
on c.civa=ci.idciva
left join detalle_Operaciones do
on v.idtransaccion=do.idtransaccion and do.idtipotransaccion=1
where v.fecha between @Desde and @Hasta
and ivaCompras='S'
--and isnull(idtipotransaccion,1)=1
and v.proveedor<212000

union

Select v.fecha,t.comprobante Comp,substring(nrocomprobante,1,4) + '-' + Substring(nrocomprobante,5,8) nrocomprobante,tipofactura,isnull(cv.razonsocial,c.razonSocial) razonsocial,isnull(cv.cuit,c.cuit) cuit,ci.resumido dciva,
totalimporte*multiplicador total,
case when v.tipofactura<>'C' and v.tipofactura<>'M' then isnull(
(select sum(Neto) 
from compfondositems
where idtransaccion=v.idtransaccion and concepto='NG ')*multiplicador,0) else 0 end Neto,
isnull(
(select sum(Neto) 
from compfondositems
where idtransaccion=v.idtransaccion and concepto='EXE' and v.tipoFactura<>'C')*multiplicador,0) Exento,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='IVG')*multiplicador,0) Iva,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='NG ' )*multiplicador,0) NG21,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='I27')*multiplicador,0) Iva27,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=27)*multiplicador,0) NG27,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='I10')*multiplicador,0) Iva10,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=10.5)*multiplicador,0) NG10,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='EXE')*multiplicador,0) NG0,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='I05')*multiplicador,0) Iva5,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='IBC')*multiplicador,0) PibC,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='PIV')*multiplicador,0) PIV,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='IBB')*multiplicador,0) PIB,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='PGI')*multiplicador,0) PGI,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='PAB')*multiplicador,0) PAB,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='PAC')*multiplicador,0) PAC,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='PBB')*multiplicador,0) PBB,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='PBC')*multiplicador,0) PBC,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='II')*multiplicador,0) II,
isnull((select sum(base) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='II')*multiplicador,0) BII,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='GSI')*multiplicador,0) GSI,
case when v.tipofactura='C' or v.tipofactura='M' then isnull(
(select sum(Neto) 
from compfondositems
where idtransaccion=v.idtransaccion and (concepto='NG ' or concepto='EXE'))*multiplicador,0) else 0 end Monotributo, idOperacion

from CompFondosHeader v
left join cphVarios vv
on v.idtransaccion=vv.idtransaccion
inner join TipCompModHeader t
on v.tipocomprobante=t.codigo
Left join Proveedores c
on isnull(vv.Codigo,v.Proveedor)=c.codigo
Left join Provfondo cv
on isnull(vv.Codigo,v.Proveedor)=cv.proveedor
left join categorias_iva ci
on c.civa=ci.idciva
inner join detalle_Operaciones do
on v.idtransaccion=do.idtransaccion and do.idtipotransaccion=3

where v.fecha between @Desde and @Hasta
and ivaCompras='S'
--and isnull(idtipotransaccion,1)=1
and v.proveedor<212000

order by v.fecha,nrocomprobante














GO
/****** Object:  StoredProcedure [dbo].[IvaComprasControlII]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO





Create   Procedure [dbo].[IvaComprasControlII]
(
	@Desde Char(8)='20110901',
	@Hasta Char(8)='20110930'
)
as

Select v.fecha,t.comprobante Comp,substring(nrocomprobante,1,4) + '-' + Substring(nrocomprobante,5,8) nrocomprobante,tipofactura,isnull(cv.razonsocial,c.razonSocial) razonsocial,isnull(cv.cuit,c.cuit) cuit,ci.resumido dciva,
totalimporte*multiplicador total,
case when v.tipofactura<>'C' and v.tipofactura<>'M' then isnull(
(select sum(baseContable) 
from CompProvitems
where idtransaccion=v.idtransaccion and concepto='NG ')*multiplicador,0) else 0 end Neto,
isnull(
(select sum(baseContable) 
from CompProvitems
where idtransaccion=v.idtransaccion and ((concepto='EXE' or (concepto='NG ' and alicuota=0)) and (v.tipofactura<>'C' and v.tipofactura<>'M')))*multiplicador,0) Exento,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='IVG')*multiplicador,0) Iva,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=21)*multiplicador,0) NG21,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='I27')*multiplicador,0) Iva27,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=27)*multiplicador,0) NG27,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='I10')*multiplicador,0) Iva10,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=10.5)*multiplicador,0) NG105,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=0)*multiplicador,0) NG0,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='I05')*multiplicador,0) Iva5,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='IBC')*multiplicador,0) PibC,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PIV')*multiplicador,0) PIV,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='IBB')*multiplicador,0) PIB,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PAB')*multiplicador,0) PAB,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PAC')*multiplicador,0) PAC,
isnull((select sum(baseContable) from CompProvItems 
/*
where idtransaccion=v.idtransaccion and concepto='PGI')*multiplicador,0) PGI,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PBB')*multiplicador,0) PBB,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PBC')*multiplicador,0) PBC,
isnull((select sum(baseContable) from CompProvItems 
*/
where idtransaccion=v.idtransaccion and concepto='II')*multiplicador,0) II,
isnull((select sum(base) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='II')*multiplicador,0) BII,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and (concepto='GSI' or concepto='PGI' or concepto='PBB' or concepto='PBA'))*multiplicador,0) GSI,
case when v.tipofactura='C' or v.tipofactura='M' then isnull(
(select sum(baseContable)
from CompProvitems
where idtransaccion=v.idtransaccion and (concepto='NG ' or concepto='EXE'))*multiplicador,0) else 0 end Monotributo,
idoperacion, 202246.62 as totalNeto


-- into controlMayor

from CompProVHeader v
left join cphVarios vv
on v.idtransaccion=vv.idtransaccion
inner join TipCompModHeader t
on v.tipocomprobante=t.codigo
Left join Proveedores c
on isnull(vv.Codigo,v.Proveedor)=c.codigo
Left join Provfondo cv
on isnull(vv.Codigo,v.Proveedor)=cv.proveedor
left join categorias_iva ci
on c.civa=ci.idciva
left join detalle_Operaciones do
on v.idtransaccion=do.idtransaccion and do.idtipotransaccion=1
where v.fecha between @Desde and @Hasta
and ivaCompras='S'
--and isnull(idtipotransaccion,1)=1
and v.proveedor<212000

union

Select v.fecha,t.comprobante Comp,substring(nrocomprobante,1,4) + '-' + Substring(nrocomprobante,5,8) nrocomprobante,tipofactura,isnull(cv.razonsocial,c.razonSocial) razonsocial,isnull(cv.cuit,c.cuit) cuit,ci.resumido dciva,
totalimporte*multiplicador total,
case when v.tipofactura<>'C' and v.tipofactura<>'M' then isnull(
(select sum(Neto) 
from compfondositems
where idtransaccion=v.idtransaccion and concepto='NG ')*multiplicador,0) else 0 end Neto,
isnull(
(select sum(Neto) 
from compfondositems
where idtransaccion=v.idtransaccion and concepto='EXE' and v.tipoFactura<>'C' and v.tipoFactura<>'M')*multiplicador,0) Exento,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='IVG')*multiplicador,0) Iva,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=21 )*multiplicador,0) NG21,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='I27')*multiplicador,0) Iva27,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=27)*multiplicador,0) NG27,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='I10')*multiplicador,0) Iva10,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=10.5)*multiplicador,0) NG10,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='EXE')*multiplicador,0) NG0,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='I05')*multiplicador,0) Iva5,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='IBC')*multiplicador,0) PibC,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='PIV')*multiplicador,0) PIV,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='IBB')*multiplicador,0) PIB,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='PAB')*multiplicador,0) PAB,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='PAC')*multiplicador,0) PAC,
isnull((select sum(Neto) from compfondositems 
/*
where idtransaccion=v.idtransaccion and concepto='PGI')*multiplicador,0) PGI,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='PBB')*multiplicador,0) PBB,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='PBC')*multiplicador,0) PBC,
isnull((select sum(Neto) from compfondositems 
*/
where idtransaccion=v.idtransaccion and concepto='II')*multiplicador,0) II,
isnull((select sum(base) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='II')*multiplicador,0) BII,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and (concepto='GSI' or concepto='PGI' or concepto='PBB' or concepto='PBA'))*multiplicador,0) GSI,
case when v.tipofactura='C' or v.tipofactura='M' then isnull(
(select sum(Neto) 
from compfondositems
where idtransaccion=v.idtransaccion and (concepto='NG ' or concepto='EXE'))*multiplicador,0) else 0 end Monotributo, idOperacion
,202246.62 as totalNeto
from CompFondosHeader v
left join cphVarios vv
on v.idtransaccion=vv.idtransaccion
inner join TipCompModHeader t
on v.tipocomprobante=t.codigo
Left join Proveedores c
on isnull(vv.Codigo,v.Proveedor)=c.codigo
Left join Provfondo cv
on isnull(vv.Codigo,v.Proveedor)=cv.proveedor
left join categorias_iva ci
on c.civa=ci.idciva
inner join detalle_Operaciones do
on v.idtransaccion=do.idtransaccion and do.idtipotransaccion=3

where v.fecha between @Desde and @Hasta
and ivaCompras='S'
--and isnull(idtipotransaccion,1)=1
and v.proveedor<212000

order by v.fecha,nrocomprobante























GO
/****** Object:  StoredProcedure [dbo].[IvaComprasTXT]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE   Procedure [dbo].[IvaComprasTXT]
(
	@Desde Char(8)='20150101',
	@Hasta Char(8)='20150131'
)
as
Select * from 
(
Select v.fecha,t.comprobante Comp,substring(nrocomprobante,1,4) + '-' + Substring(nrocomprobante,5,8) nrocomprobante,tipofactura,isnull(cv.razonsocial,c.razonSocial) razonsocial,isnull(cv.cuit,c.cuit) cuit,ci.resumido dciva,
totalimporte*multiplicador total,
case when v.tipofactura<>'C' and v.tipofactura<>'M' then isnull(
(select sum(baseContable) 
from CompProvitems
where idtransaccion=v.idtransaccion and concepto='NG ' and v.tipofactura<>'C' and v.tipofactura<>'M')*multiplicador,0) else 0 end Neto,
isnull(
(select sum(baseContable) 
from CompProvitems
where idtransaccion=v.idtransaccion and ((concepto='EXE' or (concepto='NG ' and alicuota=0)) and (v.tipofactura<>'C' and v.tipofactura<>'M')))*multiplicador,0) Exento,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='IVG')*multiplicador,0) Iva,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=21)*multiplicador,0) NG21,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='I27')*multiplicador,0) Iva27,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=27)*multiplicador,0) NG27,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='I10')*multiplicador,0) Iva10,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=10.5)*multiplicador,0) NG105,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=0)*multiplicador,0) NG0,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='I05')*multiplicador,0) Iva5,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='IBC')*multiplicador,0) PibC,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PIV')*multiplicador,0) PIV,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='IBB')*multiplicador,0) PIB,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PAB')*multiplicador,0) PAB,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PAC')*multiplicador,0) PAC,
isnull((select sum(baseContable) from CompProvItems 
/*
where idtransaccion=v.idtransaccion and concepto='PGI')*multiplicador,0) PGI,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PBB')*multiplicador,0) PBB,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='PBC')*multiplicador,0) PBC,
isnull((select sum(baseContable) from CompProvItems 
*/
where idtransaccion=v.idtransaccion and concepto='II')*multiplicador,0) II,
isnull((select sum(base) from CompProvItems 
where idtransaccion=v.idtransaccion and concepto='II')*multiplicador,0) BII,
isnull((select sum(baseContable) from CompProvItems 
where idtransaccion=v.idtransaccion and (concepto='GSI' or concepto='PGI' or concepto='PBB' or concepto='PBA'))*multiplicador,0) GSI,
case when v.tipofactura='C' or v.tipofactura='M' then isnull(
(select sum(baseContable)
from CompProvitems
where idtransaccion=v.idtransaccion and (concepto='NG ' or concepto='EXE'))*multiplicador,0) else 0 end Monotributo,
idoperacion, 202246.62 as totalNeto

--into tIvacompras
-- into controlMayor

from CompProVHeader v
left join cphVarios vv
on v.idtransaccion=vv.idtransaccion
inner join TipCompModHeader t
on v.tipocomprobante=t.codigo
Left join Proveedores c
on isnull(vv.Codigo,v.Proveedor)=c.codigo
Left join Provfondo cv
on isnull(vv.Codigo,v.Proveedor)=cv.proveedor
left join categorias_iva ci
on c.civa=ci.idciva
left join detalle_Operaciones do
on v.idtransaccion=do.idtransaccion and do.idtipotransaccion=1
where v.fecha between @Desde and @Hasta
and ivaCompras='S'
--and isnull(idtipotransaccion,1)=1
and v.proveedor<212000

union

Select v.fecha,t.comprobante Comp,substring(nrocomprobante,1,4) + '-' + Substring(nrocomprobante,5,8) nrocomprobante,tipofactura,isnull(cv.razonsocial,c.razonSocial) razonsocial,isnull(cv.cuit,c.cuit) cuit,ci.resumido dciva,
totalimporte*multiplicador total,
case when v.tipofactura<>'C' and v.tipofactura<>'M' then isnull(
(select sum(Neto) 
from compfondositems
where idtransaccion=v.idtransaccion and concepto='NG ')*multiplicador,0) else 0 end Neto,
isnull(
(select sum(Neto) 
from compfondositems
where idtransaccion=v.idtransaccion and concepto='EXE' and v.tipoFactura<>'C' and v.tipoFactura<>'M')*multiplicador,0) Exento,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='IVG')*multiplicador,0) Iva,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=21 )*multiplicador,0) NG21,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='I27')*multiplicador,0) Iva27,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=27)*multiplicador,0) NG27,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='I10')*multiplicador,0) Iva10,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='NG ' and alicuota=10.5)*multiplicador,0) NG10,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='EXE')*multiplicador,0) NG0,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='I05')*multiplicador,0) Iva5,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='IBC')*multiplicador,0) PibC,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='PIV')*multiplicador,0) PIV,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='IBB')*multiplicador,0) PIB,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='PAB')*multiplicador,0) PAB,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='PAC')*multiplicador,0) PAC,
isnull((select sum(Neto) from compfondositems 
/*
where idtransaccion=v.idtransaccion and concepto='PGI')*multiplicador,0) PGI,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='PBB')*multiplicador,0) PBB,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='PBC')*multiplicador,0) PBC,
isnull((select sum(Neto) from compfondositems 
*/
where idtransaccion=v.idtransaccion and concepto='II')*multiplicador,0) II,
isnull((select sum(base) from compfondositems 
where idtransaccion=v.idtransaccion and concepto='II')*multiplicador,0) BII,
isnull((select sum(Neto) from compfondositems 
where idtransaccion=v.idtransaccion and (concepto='GSI' or concepto='PGI' or concepto='PBB' or concepto='PBA'))*multiplicador,0) GSI,
case when v.tipofactura='C' or v.tipofactura='M' then isnull(
(select sum(Neto) 
from compfondositems
where idtransaccion=v.idtransaccion and (concepto='NG ' or concepto='EXE'))*multiplicador,0) else 0 end Monotributo, idOperacion
,202246.62 as totalNeto
from CompFondosHeader v
left join cphVarios vv
on v.idtransaccion=vv.idtransaccion
inner join TipCompModHeader t
on v.tipocomprobante=t.codigo
Left join Proveedores c
on isnull(vv.Codigo,v.Proveedor)=c.codigo
Left join Provfondo cv
on isnull(vv.Codigo,v.Proveedor)=cv.proveedor
left join categorias_iva ci
on c.civa=ci.idciva
inner join detalle_Operaciones do
on v.idtransaccion=do.idtransaccion and do.idtipotransaccion=3

where v.fecha between @Desde and @Hasta
and ivaCompras='S'
--and isnull(idtipotransaccion,1)=1
and v.proveedor<212000
) as compras






























GO
/****** Object:  StoredProcedure [dbo].[ivaVentas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO









CREATE     Procedure [dbo].[ivaVentas]
(
	@Desde char(8)='20150211',
	@Hasta char(8)='20150211'
)
as

Select Fecha,cuit,razonsocial,comp,substring(nrocomprobante,1,4) + '-' + substring(nrocomprobante,5,8) as nrocomprobante ,tipofactura,dciva,
case 
when idtransaccion=115694 then 10878.63
when iva<>0 and idtransaccion <>108225 then neto 
else 0.00 end NetoGravado,
case when alicuota=21 then 
case 
when idtransaccion=115694 then 2284.51
else iva end  else 0.00 end iva,
case when alicuota=10.5 then iva else 0.00 end iva10, 
pib, 
case 
when idtransaccion=115694 then 10125
when (iva=0 and tipoFactura<>'E') or (idtransaccion=108225) then neto else 0 end Exento,
case when tipofactura='E' then neto else 0 end Expo, total,
case when jurisdiccion=1 and tipofactura<>'E' then neto else 0 end netoCapital,
case when jurisdiccion<>1 and tipofactura<>'E' then 
case 
when idtransaccion=115694 then 10878.63+10125
else neto end 
 else 0 end netoProvincia,
0 chRech
from vBaseIva
where fecha between @Desde and @Hasta
order by v.fecha,nrocomprobante












GO
/****** Object:  StoredProcedure [dbo].[IvaVentasAuditron]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE   Procedure [dbo].[IvaVentasAuditron]
(
	@Periodo int=200801
)
as

Select v.fecha,comp,nrocomprobante,tipofactura,razonSocial,ci.descripcion dciva,totalimporte*multiplicador,isnull(
isnull(netogravado,(select sum(baseContable) from vencliitems 
where idtransaccion=v.idtransaccion and concepto=' NG'))*multiplicador,0),
isnull((select sum(baseContable) from vencliitems 
where idtransaccion=v.idtransaccion and concepto='IVA')*multiplicador,0),
idProvincia,p.Descripcion dProvincia

from VenCliHeader v
inner join TipVentModHeader t
on v.tipocomprobante=t.codigo
inner join Clientes c
on v.cliente=c.codigo
inner join categorias_iva ci
on c.civa=ci.idciva
left join Detalle_operaciones do 
on do.idtransaccion=v.idtransaccion
left join datosventa dv
on do.idoperacion=dv.idoperacion
left join provincias p 
on c.idProvincia=p.provincia
where ivaventas='S'
and v.aniomes=@Periodo
and isnull(idtipotransaccion,0)=0
order by v.fecha,nrocomprobante



GO
/****** Object:  StoredProcedure [dbo].[IvaVentasResumen]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE Procedure [dbo].[IvaVentasResumen]
(
	@Desde char(8)='20080201',
	@Hasta char(8)='20080229'
)
as

Select alicuota,sum(Neto) Neto,sum(iva) Iva,sum(total) Total
from vIvaVentas
where fecha between @Desde and @Hasta
--and alicuota<>0
Group by alicuota







GO
/****** Object:  StoredProcedure [dbo].[lCias]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


--Select * from listadosCompanias
CREATE   Procedure [dbo].[lCias] (@Inicio char(8)='20060602', @Cierre char(8)='20060701')
as
-- Select @cobertura='60'
-- Socios Fondo
insert into listadosCompanias
select distinct 0 Entidad,@Cierre Periodo ,ad.socio,/*ad.apellido,ad.nombre,*/cb.cobrador,/*cb.nombre dCobrador,*/ad.Grupo,250 cobertura
from socios ad 
inner join Cobradores cb on ad.cobrador=cb.cobrador
where (select count(*) from conceptos_Socios ca 
inner join conceptos co on ca.concepto=co.concepto
where 
(ca.fechabaja is null or ca.fechabaja > @Inicio) 
and ca.FechaVigencia <= @Inicio and co.Cobertura=co.cobertura and ad.socio=ca.socio)>0
union
select distinct 1 Socios,@Cierre,ad.Adherente,/*ad.apellido,ad.nombre,*/cb.cobrador,/*cb.nombre,*/isnull(ad.Grupo,'') Grupo,60
from Adherentes ad 
inner join Cobradores cb on ad.cobrador=cb.cobrador
where (select count(*) from conceptos_Adherentes ca 
inner join conceptos co on ca.concepto=co.concepto
where 
(ca.fechabaja is null or ca.fechabaja > @Inicio) 
and ca.FechaVigencia <= @Inicio and co.Cobertura=60 and ad.Adherente=ca.Adherente)>0
union
select distinct 1 Socios,@Cierre,ad.Adherente,/*ad.apellido,ad.nombre,*/cb.cobrador,/*cb.nombre,*/isnull(ad.Grupo,'') Grupo,100
from Adherentes ad 
inner join Cobradores cb on ad.cobrador=cb.cobrador
where (select count(*) from conceptos_Adherentes ca 
inner join conceptos co on ca.concepto=co.concepto
where 
(ca.fechabaja is null or ca.fechabaja > @Inicio) 
and ca.FechaVigencia <= @Inicio and co.Cobertura=100 and ad.Adherente=ca.Adherente)>0
union
select distinct 1 Socios,@Cierre,ad.Adherente,/*ad.apellido,ad.nombre,*/cb.cobrador,/*cb.nombre,*/isnull(ad.Grupo,'') Grupo,150
from Adherentes ad 
inner join Cobradores cb on ad.cobrador=cb.cobrador
where (select count(*) from conceptos_Adherentes ca 
inner join conceptos co on ca.concepto=co.concepto
where 
(ca.fechabaja is null or ca.fechabaja > @Inicio) 
and ca.FechaVigencia <= @Inicio and co.Cobertura=150 and ad.Adherente=ca.Adherente)>0
union
select distinct 1 Socios,@Cierre,ad.Adherente,/*ad.apellido,ad.nombre,*/cb.cobrador,/*cb.nombre,*/isnull(ad.Grupo,'') Grupo,200
from Adherentes ad 
inner join Cobradores cb on ad.cobrador=cb.cobrador
where (select count(*) from conceptos_Adherentes ca 
inner join conceptos co on ca.concepto=co.concepto
where 
(ca.fechabaja is null or ca.fechabaja > @Inicio) 
and ca.FechaVigencia <= @Inicio and co.Cobertura=200 and ad.Adherente=ca.Adherente)>0


GO
/****** Object:  StoredProcedure [dbo].[Libro_Tesoreria]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE        Procedure [dbo].[Libro_Tesoreria](
@Concepto int=1 ,
@Inicio char(8),
@Cierre char(8),
@idOperador int=0
)
as
( -- Apertura
Select 
0 as Grupo,
0 as tipo,
@Inicio as FechaEmision,
0 as numero,
0 as Inicio,
(
( -- Depositos y Movimientos Tesoreria
Select 
isnull(sum(case TipoMovimiento when 1 then importe else -importe end),0)
from valoresTesoreria vt
inner join conceptos_Tesoreria ct
on vt.idConcepto_tesoreria=ct.idConcepto_tesoreria
inner join Detalle_Operaciones do
on do.idtransaccion=vt.idtransaccion 
inner join Header_Operaciones ho 
on ho.idOperacion=do.idOperacion

where isnull(ct.idConcepto_tesoreria,ct.idConcepto_tesoreria)=@Concepto
and isnull(do.idtipotransaccion,2)=2
and (@idOperador=0 or @idOperador=vt.idOperador)
and (Fecha<@Inicio) -- Fecha Emision
and (TipodeOperacion<>11 and tipodeOperacion<>15 and TipodeOperacion<>17 and tipodeOperacion<>19 and TipodeOperacion<>20)
and (tipodeOPeracion<>90 and tipodeOperacion<>94 and tipodeOperacion<>120)
)
+
( -- Ordenes de Pago a Proveedores
Select 
isnull(sum(case TipoMovimiento when 1 then importe else -importe end),0)
from valoresTesoreria vt
inner join conceptos_Tesoreria ct
on vt.idConcepto_tesoreria=ct.idConcepto_tesoreria
inner join Detalle_Operaciones do
on do.idtransaccion=vt.idtransaccion 
inner join Header_Operaciones ho 
on ho.idOperacion=do.idOperacion

where isnull(ct.idConcepto_tesoreria,ct.idConcepto_tesoreria)=@Concepto
and (@idOperador=0 or @idOperador=vt.idOperador)
and isnull(do.idtipotransaccion,2)=2
and (FechaEmision<@Inicio)
and (TipodeOperacion=20)
)
+
(
Select 
isnull(sum(case TipoMovimiento when 1 then importe else -importe end),0)
from valoresTesoreria vt
inner join conceptos_Tesoreria ct
on vt.idConcepto_tesoreria=ct.idConcepto_tesoreria
inner join Detalle_Operaciones do
on do.idtransaccion=vt.idtransaccion 
inner join Header_Operaciones ho 
on ho.idOperacion=do.idOperacion
where isnull(ct.idConcepto_tesoreria,ct.idConcepto_tesoreria)=@Concepto
and isnull(do.idtipotransaccion,2)=2
and (@idOperador=0 or @idOperador=vt.idOperador)
and (Fecha<@Inicio)
and (TipodeOperacion=11 or tipodeOperacion=15)
-- Group by ho.Fecha,vt.tipomovimiento
)
+
(
Select 
isnull(sum(-vt.importe),0)
From Header_Operaciones ho
inner join Detalle_Operaciones do
on ho.idOperacion=do.idOperacion
inner join aplicacionescuentascorrientes acc
on acc.idtransaccion=do.idtransaccion
inner join valoresTesoreria vt
on acc.idtransaccionCancelada=vt.idtransaccionOrigen
inner join conceptos_Tesoreria ct
on vt.idConcepto_tesoreria=ct.idConcepto_tesoreria
where isnull(ct.idConcepto_tesoreria,ct.idConcepto_tesoreria)=@Concepto
and (Fecha<@Inicio)
and (TipodeOperacion=82)
and do.idtipotransaccion=0
)
+
(
Select 
isnull(sum(case TipoMovimiento when 1 then importe else -importe end),0)
from valoresTesoreria vt
inner join conceptos_Tesoreria ct
on vt.idConcepto_tesoreria=ct.idConcepto_tesoreria
inner join Detalle_Operaciones do
on do.idtransaccion=vt.idtransaccion 
inner join Header_Operaciones ho 
on ho.idOperacion=do.idOperacion
where isnull(ct.idConcepto_tesoreria,ct.idConcepto_tesoreria)=@Concepto
and isnull(do.idtipotransaccion,2)=2

and (Fecha<@Inicio)
and (@idOperador=0 or @idOperador=vt.idOperador)
and (TipodeOperacion=17 or tipodeOperacion=19)
and (tipodeOPeracion<>90 and tipodeOperacion<>94 and tipodeOperacion<>120)
-- Group by ho.Fecha,vt.tipomovimiento,ho.tipodeOPeracion,ho.observacioncomprobante,ho.idOperacion,ho.comprobanteNumero
)
)
 as Debe,
0 as Haber,
 'Saldo Apertura ' as Detalle,
'' as ObservacionComprobante, 0 as idtransaccion
)
Union
( -- Anulados
Select 
0 as Grupo,
1 as tipo,
FechaEmision,Numero,
0 as inicio,
case TipoMovimiento when 1 then 0 
					else 0 end as Debe,
case TipoMovimiento when 2 then 0
					else 0 end as Haber,
ho.observacion as detalle, 
'A N U L A D O' as observacioncomprobante,vt.idtransaccion
from valoresTesoreriaOPanulados vt
inner join conceptos_Tesoreria ct
on vt.idConcepto_tesoreria=ct.idConcepto_tesoreria
inner join Detalle_Operaciones do
on do.idtransaccion=vt.idtransaccion 
inner join Header_Operaciones ho 
on ho.idOperacion=do.idOperacion

where isnull(ct.idConcepto_tesoreria,ct.idConcepto_tesoreria)=@Concepto
and isnull(do.idtipotransaccion,2)=2
and (@idOperador=0 or @idOperador=vt.idOperador)
and (FechaEmision>=@Inicio and FechaEmision<=@Cierre)
and (TipodeOperacion<>10 and tipodeOperacion<>15 and TipodeOperacion<>17 and tipodeOperacion<>19)
and (tipodeOPeracion<>90 and tipodeOperacion<>94 and tipodeOperacion<>120)
)
union
( -- Depositos y Movimientos Tesoreria
Select 
0 as Grupo,
1 as tipo,
Fecha,Numero, -- Fecha Emision
0 as inicio,
case TipoMovimiento when 1 then importe 
					else 0 end as Debe,
case TipoMovimiento when 2 then importe
					else 0 end as Haber,
ho.observacion as detalle, 
ho.observacioncomprobante,vt.idtransaccion
from valoresTesoreria vt
inner join conceptos_Tesoreria ct
on vt.idConcepto_tesoreria=ct.idConcepto_tesoreria
inner join Detalle_Operaciones do
on do.idtransaccion=vt.idtransaccion 
inner join Header_Operaciones ho 
on ho.idOperacion=do.idOperacion

where isnull(ct.idConcepto_tesoreria,ct.idConcepto_tesoreria)=@Concepto
and isnull(do.idtipotransaccion,2)=2
and (Fecha between @Inicio and @Cierre) -- Fecha Emision
and (@idOperador=0 or @idOperador=vt.idOperador)
and (TipodeOperacion<>11 and TipodeOperacion<>11 and tipodeOperacion<>15 and TipodeOperacion<>17 and tipodeOperacion<>19 and TipodeOperacion<>20)
and (tipodeOPeracion<>90 and tipodeOperacion<>94 and tipodeOperacion<>120)
)
union
( -- Ordenes de Pago a Proveedores
Select 
0 as Grupo,
1 as tipo,
FechaEmision,Numero,
0 as inicio,
case TipoMovimiento when 1 then importe 
					else 0 end as Debe,
case TipoMovimiento when 2 then importe
					else 0 end as Haber,
ho.observacion as detalle, 
(Select top 1 pv.razonsocial
from detalle_Operaciones do1

inner Join Compprovheader cph 
on do1.idtransaccion=cph.idtransaccion 
inner join proveedores pv
on pv.codigo=cph.proveedor
where do1.idOperacion=ho.idoperacion
and do1.idtipotransaccion=1)

as observacioncomprobante,vt.idtransaccion
from valoresTesoreria vt
inner join conceptos_Tesoreria ct
on vt.idConcepto_tesoreria=ct.idConcepto_tesoreria
inner join Detalle_Operaciones do
on do.idtransaccion=vt.idtransaccion 
inner join Header_Operaciones ho 
on ho.idOperacion=do.idOperacion

where isnull(ct.idConcepto_tesoreria,ct.idConcepto_tesoreria)=@Concepto
and isnull(do.idtipotransaccion,2)=2
and (@idOperador=0 or @idOperador=vt.idOperador)
and (FechaEmision>=@Inicio  and FechaEmision<=@Cierre)
and (TipodeOperacion=20)
) 
union
(
Select 
0 as Grupo,
1 as tipo,
ho.Fecha as fechaemision,null as Numero,
0 as inicio,
case TipoMovimiento when 1 then sum(importe)
					else 0 end as Debe,
case TipoMovimiento when 2 then Sum(importe)
					else 0 end as Haber,
'CAJA 1' as detalle, 
'' as observacioncomprobante,0 as idtransaccion
from valoresTesoreria vt
inner join conceptos_Tesoreria ct
on vt.idConcepto_tesoreria=ct.idConcepto_tesoreria
inner join Detalle_Operaciones do
on do.idtransaccion=vt.idtransaccion 
inner join Header_Operaciones ho 
on ho.idOperacion=do.idOperacion
where isnull(ct.idConcepto_tesoreria,ct.idConcepto_tesoreria)=@Concepto
and isnull(do.idtipotransaccion,2)=2
and (@idOperador=0 or @idOperador=vt.idOperador)
and (Fecha>=@Inicio and Fecha<=@Cierre)
and (TipodeOperacion=11 or tipodeOperacion=15)
Group by ho.Fecha,vt.tipomovimiento
)
union
(
Select 
0 as Grupo,
1 as tipo,
ho.Fecha as fechaemision,null as Numero,
0 as inicio,0 as debe,
sum(vt.importe) Haber,
'Reversion CAJA 1' as detalle, 
'' as observacioncomprobante,0 as idtransaccion
From Header_Operaciones ho
inner join Detalle_Operaciones do
on ho.idOperacion=do.idOperacion
inner join aplicacionescuentascorrientes acc
on acc.idtransaccion=do.idtransaccion
inner join valoresTesoreria vt
on acc.idtransaccionCancelada=vt.idtransaccionOrigen
inner join conceptos_Tesoreria ct
on vt.idConcepto_tesoreria=ct.idConcepto_tesoreria
where isnull(ct.idConcepto_tesoreria,ct.idConcepto_tesoreria)=@Concepto
and (Fecha>=@Inicio and Fecha<=@Cierre)
and (@idOperador=0 or @idOperador=vt.idOperador)
and (TipodeOperacion=82)
and do.idtipotransaccion=0
Group by ho.Fecha,vt.tipomovimiento
)
union
(
Select 
0 as Grupo,
1 as tipo,
ho.Fecha as fechaemision,null as Numero,
0 as inicio,
case TipoMovimiento when 1 then sum(importe)
					else 0 end as Debe,
case TipoMovimiento when 2 then sum(importe)
					else 0 end as Haber,
case tipodeOperacion when 17 then 'Rendicion Colegio No ' + cast(ho.comprobanteNumero as char(6))
else 'Rendicion Cobrador No ' + cast(ho.comprobanteNumero as char(6))end as detalle, 
'' as observacionComprobante,ho.tipodeOperacion
from valoresTesoreria vt
inner join conceptos_Tesoreria ct
on vt.idConcepto_tesoreria=ct.idConcepto_tesoreria
inner join Detalle_Operaciones do
on do.idtransaccion=vt.idtransaccion 
inner join Header_Operaciones ho 
on ho.idOperacion=do.idOperacion
where isnull(ct.idConcepto_tesoreria,ct.idConcepto_tesoreria)=@Concepto
and isnull(do.idtipotransaccion,2)=2
--and (FechaEmision>=@Inicio  and FechaEmision<=@Cierre)
and (Fecha>=@Inicio  and Fecha<=@Cierre)
and (@idOperador=0 or @idOperador=vt.idOperador)
and (TipodeOperacion=17 or tipodeOperacion=19)
--and (tipodeOPeracion<>90 and tipodeOperacion<>94 and tipodeOperacion<>120)
Group by ho.Fecha,vt.tipomovimiento,ho.tipodeOPeracion,ho.observacioncomprobante,ho.idOperacion,ho.comprobanteNumero
)
order by tipo,Fechaemision





GO
/****** Object:  StoredProcedure [dbo].[Libro_Tesoreria_Mejorado]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE Procedure [dbo].[Libro_Tesoreria_Mejorado](
@Concepto int ,
@Inicio char(8),
@Cierre char(8)
)
as
( -- Apertura
Select 
0 as Grupo,
0 as tipo,
@Inicio as FechaEmision,
0 as numero,
0 as Inicio,
(
( -- Depositos y Movimientos Tesoreria
Select 
isnull(sum(case TipoMovimiento when 1 then importe else -importe end),0)
from valoresTesoreria vt
inner join conceptos_Tesoreria ct
on vt.idConcepto_tesoreria=ct.idConcepto_tesoreria
inner join Detalle_Operaciones do
on do.idtransaccion=vt.idtransaccion 
inner join Header_Operaciones ho 
on ho.idOperacion=do.idOperacion

where Unificador=@Concepto
and isnull(do.idtipotransaccion,2)=2
and (FechaEmision<@Inicio)
and (TipodeOperacion<>11 and tipodeOperacion<>15 and TipodeOperacion<>17 and tipodeOperacion<>19 and TipodeOperacion<>20)
and (tipodeOPeracion<>90 and tipodeOperacion<>94 and tipodeOperacion<>120)
)
+
( -- Ordenes de Pago a Proveedores
Select 
isnull(sum(case TipoMovimiento when 1 then importe else -importe end),0)
from valoresTesoreria vt
inner join conceptos_Tesoreria ct
on vt.idConcepto_tesoreria=ct.idConcepto_tesoreria
inner join Detalle_Operaciones do
on do.idtransaccion=vt.idtransaccion 
inner join Header_Operaciones ho 
on ho.idOperacion=do.idOperacion

where Unificador=@Concepto
and isnull(do.idtipotransaccion,2)=2
and (FechaEmision<@Inicio)
and (TipodeOperacion=20)
)
+
(
Select 
isnull(sum(case TipoMovimiento when 1 then importe else -importe end),0)
from valoresTesoreria vt
inner join conceptos_Tesoreria ct
on vt.idConcepto_tesoreria=ct.idConcepto_tesoreria
inner join Detalle_Operaciones do
on do.idtransaccion=vt.idtransaccion 
inner join Header_Operaciones ho 
on ho.idOperacion=do.idOperacion
where Unificador=@Concepto
and isnull(do.idtipotransaccion,2)=2
and (Fecha<@Inicio)
and (TipodeOperacion=11 or tipodeOperacion=15)
-- Group by ho.Fecha,vt.tipomovimiento
)
+
(
Select 
isnull(sum(case TipoMovimiento when 1 then importe else -importe end),0)
from valoresTesoreria vt
inner join conceptos_Tesoreria ct
on vt.idConcepto_tesoreria=ct.idConcepto_tesoreria
inner join Detalle_Operaciones do
on do.idtransaccion=vt.idtransaccion 
inner join Header_Operaciones ho 
on ho.idOperacion=do.idOperacion
where Unificador=@Concepto
and isnull(do.idtipotransaccion,2)=2

and (Fecha<@Inicio)
and (TipodeOperacion=17 or tipodeOperacion=19)
and (tipodeOPeracion<>90 and tipodeOperacion<>94 and tipodeOperacion<>120)
-- Group by ho.Fecha,vt.tipomovimiento,ho.tipodeOPeracion,ho.observacioncomprobante,ho.idOperacion,ho.comprobanteNumero
)
)
 as Debe,
0 as Haber,
 'Saldo Apertura ' as Detalle,
'' as ObservacionComprobante, 0 as idtransaccion
)
Union
( -- Anulados
Select 
0 as Grupo,
1 as tipo,
FechaEmision,Numero,
0 as inicio,
case TipoMovimiento when 1 then 0 
					else 0 end as Debe,
case TipoMovimiento when 2 then 0
					else 0 end as Haber,
ho.observacion as detalle, 
'A N U L A D O' as observacioncomprobante,vt.idtransaccion
from valoresTesoreriaOPanulados vt
inner join conceptos_Tesoreria ct
on vt.idConcepto_tesoreria=ct.idConcepto_tesoreria
inner join Detalle_Operaciones do
on do.idtransaccion=vt.idtransaccion 
inner join Header_Operaciones ho 
on ho.idOperacion=do.idOperacion

where Unificador=@Concepto
and isnull(do.idtipotransaccion,2)=2
and (FechaEmision>=@Inicio and FechaEmision<=@Cierre)
and (TipodeOperacion<>10 and tipodeOperacion<>15 and TipodeOperacion<>17 and tipodeOperacion<>19)
and (tipodeOPeracion<>90 and tipodeOperacion<>94 and tipodeOperacion<>120)
)
union
( -- Depositos y Movimientos Tesoreria
Select 
0 as Grupo,
1 as tipo,
FechaEmision,Numero,
0 as inicio,
case TipoMovimiento when 1 then importe 
					else 0 end as Debe,
case TipoMovimiento when 2 then importe
					else 0 end as Haber,
ho.observacion as detalle, 
ho.observacioncomprobante,vt.idtransaccion
from valoresTesoreria vt
inner join conceptos_Tesoreria ct
on vt.idConcepto_tesoreria=ct.idConcepto_tesoreria
inner join Detalle_Operaciones do
on do.idtransaccion=vt.idtransaccion 
inner join Header_Operaciones ho 
on ho.idOperacion=do.idOperacion

where Unificador=@Concepto
and isnull(do.idtipotransaccion,2)=2
and (FechaEmision>=@Inicio  and FechaEmision<=@Cierre)
and (TipodeOperacion<>11 and tipodeOperacion<>15 and TipodeOperacion<>17 and tipodeOperacion<>19 and TipodeOperacion<>20)
and (tipodeOPeracion<>90 and tipodeOperacion<>94 and tipodeOperacion<>120)
)
union
( -- Ordenes de Pago a Proveedores
Select 
0 as Grupo,
1 as tipo,
FechaEmision,Numero,
0 as inicio,
case TipoMovimiento when 1 then importe 
					else 0 end as Debe,
case TipoMovimiento when 2 then importe
					else 0 end as Haber,
ho.observacion as detalle, 
(Select top 1 pv.razonsocial
from detalle_Operaciones do1

inner Join Compprovheader cph 
on do1.idtransaccion=cph.idtransaccion 
inner join proveedores pv
on pv.codigo=cph.proveedor
where do1.idOperacion=ho.idoperacion
and do1.idtipotransaccion=1)


 as observacioncomprobante,vt.idtransaccion
from valoresTesoreria vt
inner join conceptos_Tesoreria ct
on vt.idConcepto_tesoreria=ct.idConcepto_tesoreria
inner join Detalle_Operaciones do
on do.idtransaccion=vt.idtransaccion 
inner join Header_Operaciones ho 
on ho.idOperacion=do.idOperacion

where Unificador=@Concepto
and isnull(do.idtipotransaccion,2)=2
and (FechaEmision>=@Inicio  and FechaEmision<=@Cierre)
and (TipodeOperacion=20)
)
union
(
Select 
0 as Grupo,
1 as tipo,
ho.Fecha as fechaemision,null as Numero,
0 as inicio,
case TipoMovimiento when 1 then sum(importe)
					else 0 end as Debe,
case TipoMovimiento when 2 then Sum(importe)
					else 0 end as Haber,
'CAJA 1' as detalle, 
'' as observacioncomprobante,0 as idtransaccion
from valoresTesoreria vt
inner join conceptos_Tesoreria ct
on vt.idConcepto_tesoreria=ct.idConcepto_tesoreria
inner join Detalle_Operaciones do
on do.idtransaccion=vt.idtransaccion 
inner join Header_Operaciones ho 
on ho.idOperacion=do.idOperacion
where Unificador=@Concepto
and isnull(do.idtipotransaccion,2)=2
and (Fecha>=@Inicio and Fecha<=@Cierre)
and (TipodeOperacion=11 or tipodeOperacion=15)
Group by ho.Fecha,vt.tipomovimiento
)
union
(
Select 
0 as Grupo,
1 as tipo,
ho.Fecha as fechaemision,null as Numero,
0 as inicio,
case TipoMovimiento when 1 then sum(importe)
					else 0 end as Debe,
case TipoMovimiento when 2 then sum(importe)
					else 0 end as Haber,
case tipodeOperacion when 17 then 'Rendicion Colegio No ' + cast(ho.comprobanteNumero as char(6))
else 'Rendicion Cobrador No ' + cast(ho.comprobanteNumero as char(6))end as detalle, 
'' as observacionComprobante,ho.tipodeOperacion
from valoresTesoreria vt
inner join conceptos_Tesoreria ct
on vt.idConcepto_tesoreria=ct.idConcepto_tesoreria
inner join Detalle_Operaciones do
on do.idtransaccion=vt.idtransaccion 
inner join Header_Operaciones ho 
on ho.idOperacion=do.idOperacion
where Unificador=@Concepto
and isnull(do.idtipotransaccion,2)=2
--and (FechaEmision>=@Inicio  and FechaEmision<=@Cierre)
and (Fecha>=@Inicio  and Fecha<=@Cierre)
and (TipodeOperacion=17 or tipodeOperacion=19)
and (tipodeOPeracion<>90 and tipodeOperacion<>94 and tipodeOperacion<>120)
Group by ho.Fecha,vt.tipomovimiento,ho.tipodeOPeracion,ho.observacioncomprobante,ho.idOperacion,ho.comprobanteNumero
)
order by tipo,Fechaemision



GO
/****** Object:  StoredProcedure [dbo].[Libro_Tesoreria_Original]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



Create  Procedure [dbo].[Libro_Tesoreria_Original](
@Concepto int ,
@Inicio char(8),
@Cierre char(8)
)
as
( -- Apertura
Select 
0 as Grupo,
0 as tipo,
@Inicio as FechaEmision,
0 as numero,
0 as Inicio,
((Select 
--vt.idconcepto_tesoreria,FechaEmision,Numero,
sum(case tipomovimiento 
when 1 then Importe
When 2 then -importe end) as entradas
from ValoresTesoreria vt
inner join conceptos_tesoreria ct
on vt.idConcepto_Tesoreria=ct.idConcepto_Tesoreria
--
/*left join Detalle_Operaciones do
on do.idtransaccion=vt.idtransaccion 
left join Header_Operaciones ho 
on ho.idOperacion=do.idOperacion*/
--
where ct.Unificador=@Concepto and fechaEmision<@Inicio -- and do.idtipotransaccion=2
--and (TipodeOperacion<>17 and tipodeOperacion<>19)
group by ct.Unificador)
/*+
(Select 
--vt.idconcepto_tesoreria,FechaEmision,Numero,
sum(case tipomovimiento 
when 1 then Importe
When 2 then -importe end) as entradas
from ValoresTesoreria vt
inner join conceptos_tesoreria ct
on vt.idConcepto_Tesoreria=ct.idConcepto_Tesoreria
--
left join Detalle_Operaciones do
on do.idtransaccion=vt.idtransaccion 
left join Header_Operaciones ho 
on ho.idOperacion=do.idOperacion
--
where ct.Unificador=@Concepto and fecha<@Inicio and do.idtipotransaccion=2
and (TipodeOperacion=17 or tipodeOperacion=19)
group by ct.Unificador)*/)
 as Debe,
0 as Haber,
 'Saldo Apertura ' as Detalle,
'' as ObservacionComprobante, 0 as idtransaccion
)
Union
( -- Anulados
Select 
0 as Grupo,
1 as tipo,
FechaEmision,Numero,
0 as inicio,
case TipoMovimiento when 1 then 0 
					else 0 end as Debe,
case TipoMovimiento when 2 then 0
					else 0 end as Haber,
ho.observacion as detalle, 
'A N U L A D O' as observacioncomprobante,vt.idtransaccion
from valoresTesoreriaOPanulados vt
inner join conceptos_Tesoreria ct
on vt.idConcepto_tesoreria=ct.idConcepto_tesoreria
inner join Detalle_Operaciones do
on do.idtransaccion=vt.idtransaccion 
inner join Header_Operaciones ho 
on ho.idOperacion=do.idOperacion

where Unificador=@Concepto
and isnull(do.idtipotransaccion,2)=2
and (FechaEmision>=@Inicio and FechaEmision<=@Cierre)
and (TipodeOperacion<>10 and tipodeOperacion<>15 and TipodeOperacion<>17 and tipodeOperacion<>19)
and (tipodeOPeracion<>90 and tipodeOperacion<>94 and tipodeOperacion<>120)
)
union
( -- Depositos y Movimientos Tesoreria
Select 
0 as Grupo,
1 as tipo,
FechaEmision,Numero,
0 as inicio,
case TipoMovimiento when 1 then importe 
					else 0 end as Debe,
case TipoMovimiento when 2 then importe
					else 0 end as Haber,
ho.observacion as detalle, 
ho.observacioncomprobante,vt.idtransaccion
from valoresTesoreria vt
inner join conceptos_Tesoreria ct
on vt.idConcepto_tesoreria=ct.idConcepto_tesoreria
inner join Detalle_Operaciones do
on do.idtransaccion=vt.idtransaccion 
inner join Header_Operaciones ho 
on ho.idOperacion=do.idOperacion

where Unificador=@Concepto
and isnull(do.idtipotransaccion,2)=2
and (FechaEmision>=@Inicio  and FechaEmision<=@Cierre)
and (TipodeOperacion<>11 and tipodeOperacion<>15 and TipodeOperacion<>17 and tipodeOperacion<>19 and TipodeOperacion<>20)
and (tipodeOPeracion<>90 and tipodeOperacion<>94 and tipodeOperacion<>120)
)
union
( -- Ordenes de Pago a Proveedores
Select 
0 as Grupo,
1 as tipo,
FechaEmision,Numero,
0 as inicio,
case TipoMovimiento when 1 then importe 
					else 0 end as Debe,
case TipoMovimiento when 2 then importe
					else 0 end as Haber,
ho.observacion as detalle, 
(Select top 1 pv.razonsocial
from detalle_Operaciones do1

inner Join Compprovheader cph 
on do1.idtransaccion=cph.idtransaccion 
inner join proveedores pv
on pv.codigo=cph.proveedor
where do1.idOperacion=ho.idoperacion
and do1.idtipotransaccion=1)


 as observacioncomprobante,vt.idtransaccion
from valoresTesoreria vt
inner join conceptos_Tesoreria ct
on vt.idConcepto_tesoreria=ct.idConcepto_tesoreria
inner join Detalle_Operaciones do
on do.idtransaccion=vt.idtransaccion 
inner join Header_Operaciones ho 
on ho.idOperacion=do.idOperacion

where Unificador=@Concepto
and isnull(do.idtipotransaccion,2)=2
and (FechaEmision>=@Inicio  and FechaEmision<=@Cierre)
and (TipodeOperacion=20)
)
union
(
Select 
0 as Grupo,
1 as tipo,
ho.Fecha as fechaemision,null as Numero,
0 as inicio,
case TipoMovimiento when 1 then sum(importe)
					else 0 end as Debe,
case TipoMovimiento when 2 then Sum(importe)
					else 0 end as Haber,
'CAJA 1' as detalle, 
'' as observacioncomprobante,0 as idtransaccion
from valoresTesoreria vt
inner join conceptos_Tesoreria ct
on vt.idConcepto_tesoreria=ct.idConcepto_tesoreria
inner join Detalle_Operaciones do
on do.idtransaccion=vt.idtransaccion 
inner join Header_Operaciones ho 
on ho.idOperacion=do.idOperacion
where Unificador=@Concepto
and isnull(do.idtipotransaccion,2)=2
and (Fecha>=@Inicio and Fecha<=@Cierre)
and (TipodeOperacion=11 or tipodeOperacion=15)
Group by ho.Fecha,vt.tipomovimiento
)
union
(
Select 
0 as Grupo,
1 as tipo,
ho.Fecha as fechaemision,null as Numero,
0 as inicio,
case TipoMovimiento when 1 then sum(importe)
					else 0 end as Debe,
case TipoMovimiento when 2 then sum(importe)
					else 0 end as Haber,
case tipodeOperacion when 17 then 'Rendicion Colegio No ' + cast(ho.comprobanteNumero as char(6))
else 'Rendicion Cobrador No ' + cast(ho.comprobanteNumero as char(6))end as detalle, 
'' as observacionComprobante,ho.tipodeOperacion
from valoresTesoreria vt
inner join conceptos_Tesoreria ct
on vt.idConcepto_tesoreria=ct.idConcepto_tesoreria
inner join Detalle_Operaciones do
on do.idtransaccion=vt.idtransaccion 
inner join Header_Operaciones ho 
on ho.idOperacion=do.idOperacion
where Unificador=@Concepto
and isnull(do.idtipotransaccion,2)=2
--and (FechaEmision>=@Inicio  and FechaEmision<=@Cierre)
and (Fecha>=@Inicio  and Fecha<=@Cierre)
and (TipodeOperacion=17 or tipodeOperacion=19)
and (tipodeOPeracion<>90 and tipodeOperacion<>94 and tipodeOperacion<>120)
Group by ho.Fecha,vt.tipomovimiento,ho.tipodeOPeracion,ho.observacioncomprobante,ho.idOperacion,ho.comprobanteNumero
)
order by tipo,Fechaemision



GO
/****** Object:  StoredProcedure [dbo].[LibroSueldos_Footer]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE Procedure [dbo].[LibroSueldos_Footer]

	@Legajo		int

AS
Declare @C_String 	as nvarchar(4000)

Set @C_String = 'Select	A01.legajo, A01.apellnombre, A01.fecnac, 
			dbo.Edad(A01.fecnac, getdate()) as Edad,
			A02.Descripcion as Parentesco, A03.Descripcion as TipoDocu,
			A01.numero as NumeroDocu
		From FamiliaresLegajos A01
			inner join Parentescos A02
				on A01.Parentesco = A02.Parentesco
			inner join TiposDocumento A03
				on A01.TipoDoc = A03.TipoDocto
		Where A01.legajo = ' + convert(char(10),@Legajo)

Set @C_String = @C_String + ' order by ApellNombre'


/****************************************/
/* 	Ejecuto la consulta 		*/
/****************************************/
EXEC sp_executesql @C_String



GO
/****** Object:  StoredProcedure [dbo].[LibroSueldos_Header]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO





CREATE         Procedure [dbo].[LibroSueldos_Header]

	@idLiquidacion		int

AS
Declare @C_String 	as nvarchar(4000)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

Set @C_String = 'Select	Distinct A01.Legajo, (A01.Apellido + ", " + A01.Nombre) as ApeNombre, 
			A01.Domicilio, A01.CPostal, A01.Cuil, A01.FechaNacimiento, 
			A01.Numero as NumeroDocu, A02.Descripcion as CalificacionProfesional,
			A03.Fecha as FechaIngreso, A03B.Fecha as FechaEgreso, A04.Descripcion as Categoria, 
			A05.Descripcion as Nacionalidad, A06.Descripcion as EstadoCivil, 
			A07.Descripcion as TipoDocu, A08.Descripcion as Localidad,
			isnull((Select sum(B01.Importe) from Items_Liquidaciones B01 inner join ConceptosLiquidacion C on B01.concepto = C.concepto where B01.Legajo = A01.Legajo and idliquidacion=' + convert(char(10),@idLiquidacion) + ' and (C.tipoconcepto = 10 or C.tipoconcepto = 11)),0) as TotalRemuReten,
			isnull((Select sum(B01.Importe) from Items_Liquidaciones B01 inner join ConceptosLiquidacion C on B01.concepto = C.concepto where B01.Legajo = A01.Legajo and idliquidacion=' + convert(char(10),@idLiquidacion) + ' and (C.tipoconcepto = 20 or C.tipoconcepto = 30)),0) as TotalRemuExen,
			isnull((Select sum(B01.Importe) from Items_Liquidaciones B01 inner join ConceptosLiquidacion C on B01.concepto = C.concepto where B01.Legajo = A01.Legajo and idliquidacion=' + convert(char(10),@idLiquidacion) + ' and (C.tipoconcepto = 40)),0) as TotalDescuentos,
			Header.idLiquidacion as idLiquidacion 
		From Header_Liquidaciones Header
			inner join Items_Liquidaciones Items
				on Header.idLiquidacion = Items.idLiquidacion
			inner join MaestroPersonal A01
				on Items.Legajo = A01.Legajo
			inner join CalificProfesionales A02
				on A01.CalifProfesional = A02.CalifProfesional
			inner join FechasLegajos A03
				on A01.Legajo = A03.Legajo and A03.IndicativoAntiguedad = 1 and A03.Concepto = 0
			left join FechasLegajos A03B
				on A01.Legajo = A03B.Legajo and A03B.Concepto = 1
			inner join Categorias A04
				on A01.Categoria = A04.Categoria
			inner join Nacionalidades A05
				on A01.Nacionalidad = A05.Nacionalidad
			inner join EstadosCivil A06
				on A01.EstadoCivil = A06.EstadoCivil
			inner join TiposDocumento A07
				on A01.TipoDocumento = A07.TipoDocto
			inner join Localidades A08
				on A01.Localidad = A08.Localidad '


/********************************/
/*	Armo Condiciones	*/
/********************************/
if @idLiquidacion is not null and @idLiquidacion <> 0
	Set @C_String= @C_String + ' where Header.idLiquidacion = ' + convert(char(10),@idLiquidacion)

/*
if @LegajoDesde is not null and @LegajoDesde <> 0
	begin
		Set @boolWhere = 'S'	
		Set @C_String= @C_String + ' where A01.legajo >= ' + convert(char(10),@LegajoDesde)
	end

if @LegajoHasta is not null and @LegajoHasta <> 0
	begin
		if @boolWhere = 'S'
			Set @C_String= @C_String + ' and  A01.legajo <= ' + convert(char(10),@LegajoHasta)
		else
		begin
			Set @boolWhere = 'S'	
			Set @C_String= @C_String + ' where  A01.legajo <= ' + convert(char(10),@LegajoHasta)
		end
	end
*/

/****************************************/
/* 	Ejecuto la consulta 		*/
/****************************************/
--Print @C_String
EXEC sp_executesql @C_String











GO
/****** Object:  StoredProcedure [dbo].[LibroSueldos_Items]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE      Procedure [dbo].[LibroSueldos_Items]

	@Legajo		int,
	@idLiquidacion int

AS
Declare @C_String 	as nvarchar(4000)

Set @C_String = 'Select	A02.Legajo, A02.Concepto, A02.Horas, A02.Importe,
			A03.Descripcion as DescConcepto, A03.tipoconcepto,
			(Select sum(B.Importe) from Items_Liquidaciones B inner join ConceptosLiquidacion C on B.concepto = C.concepto where B.Legajo = A02.Legajo and B.idliquidacion = A02.idliquidacion and (C.tipoconcepto = 10 or C.tipoconcepto = 11)) as TotalRemuReten,
		        (Select sum(B.Importe) from Items_Liquidaciones B inner join ConceptosLiquidacion C on B.concepto = C.concepto where B.Legajo = A02.Legajo  and B.idliquidacion = A02.idliquidacion and (C.tipoconcepto = 20 or C.tipoconcepto = 30) ) as TotalRemuExen, 
            		(Select sum(B.Importe) from Items_Liquidaciones B inner join ConceptosLiquidacion C on B.concepto = C.concepto where B.Legajo = A02.Legajo and B.idliquidacion = A02.idliquidacion  and C.tipoconcepto = 40) as TotalDescuentos 
		From Items_Liquidaciones a02
			inner join ConceptosLiquidacion A03
				on A02.Concepto = A03.Concepto 
		where A02.legajo = ' + convert(char(10),@Legajo) + ' and a02.idliquidacion=' + convert(char(10),@idLiquidacion) +
		' order by A02.concepto '

/****************************************/
/* 	Ejecuto la consulta 		*/
/****************************************/
EXEC sp_executesql @C_String








GO
/****** Object:  StoredProcedure [dbo].[Limpia_Anses]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE      Procedure [dbo].[Limpia_Anses] (@Periodo int,@PeriodoAnses char(4))
as

Delete from memm

insert into memm
select substring(texto,1,35) as col001, substring(texto,36,41) as col002
from memm_Historico where periodo=@Periodo

GO
/****** Object:  StoredProcedure [dbo].[LimpiaTemporalDiario]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Procedure [dbo].[LimpiaTemporalDiario]
(
	@ComputerName varchar(50)='CASA-78CD17791F'
)
As

Delete ai
from asientosdiariositemsdiario ai
where usuario=@ComputerName

GO
/****** Object:  StoredProcedure [dbo].[Liq_Aguinaldos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE    Procedure [dbo].[Liq_Aguinaldos](@Periodo int, @AnioMes int)
as

/*
Delete from Header_liquidaciones where Periodo=@Periodo 
and aniomes=@aniomes
*/

Declare @idLiquidacion int

Set @idLiquidacion=(Select idliquidacion from Header_Liquidaciones where aniomes=@aniomes
and periodo=@periodo)

if (@idLiquidacion is not null) and (@idLiquidacion <> 0)
	begin
			Delete from items_liquidaciones where  idLiquidacion=@idLiquidacion
	
			Update Header_liquidaciones
			set fechaliq=getdate() where  aniomes=@aniomes
			and periodo=@periodo
	end
else
	begin
		Insert into Header_Liquidaciones
		(fechaliq,aniomes,Periodo)
		values
		(getdate(),@aniomes,@Periodo)
		select @idLiquidacion=@@identity
	end

-- 190 Concepto 190
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,190,0, (Select importe from ConceptosLegajosNovedadesAguinaldo clna where concepto=190 AND 
clna.legajo=a.legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1


-- 600 Jubilacion
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,600,0, Dbo.Jubil_aguinaldo(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()))
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1


	-- 601 ley19032
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,601,0, Dbo.Ley19032_Aguinaldo(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()))
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1


	-- 611 Familiar a Cargo
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,611,0, dbo.aCargo_Aguinaldo(a.legajo,Dbo.edad(FechasLegajos.fecha,getdate()))
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

	-- 603 Sindicato
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,603, 0, Dbo.sindicato_aguinaldo(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()))
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1


	-- 630 ObraSocial Ospedyc
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,630,0, Dbo.ObraSocial_aguinaldo(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()))
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=106005


	-- 632 ObraSocial OSPOCE
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,632,0, Dbo.ObraSocial_aguinaldo(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()))
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=406

	-- 634 ObraSocial OSCONA
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,634,0, Dbo.ObraSocial_aguinaldo(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()))
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=113809


	-- 636 ObraSocial OSTIG
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,636,0, Dbo.ObraSocial_aguinaldo(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()))
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=124506


	-- 638 ObraSocial OSSEG
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,638,0, Dbo.ObraSocial_aguinaldo(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()))
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=901


	-- 640 ObraSocial OSSEG
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,640,0, Dbo.ObraSocial_aguinaldo(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()))
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=126908


	-- 642 ObraSocial OSPACA
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,642,0, Dbo.ObraSocial_aguinaldo(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()))
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=101604


	-- 643 ObraSocial OSTEL
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,643,0, Dbo.ObraSocial_aguinaldo(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()))
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=120702

/*
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
Select @idliquidacion,mp.legajo,430,999,
(
select sum(isnull(importe*tcl.multiplicador,0)) 
	from items_Liquidaciones il
	inner join Conceptosliquidacion cl
	on il.concepto=cl.concepto
	inner join tipconcliq tcl on 
	tcl.concepto=cl.tipoconcepto
	where idLiquidacion=@idliquidacion and il.legajo=mp.legajo
	and (cl.tipoconcepto<>20 and cl.tipoconcepto<>40)
)
From MaestroPersonal mp
inner join FechasLegajos fl on 
fl.legajo = mp.legajo and (fl.concepto=2) and 
(dbo.toaniomes(fecha)<=@Aniomes and isnull(dbo.toaniomes(Finaliza),@Aniomes+1000)>@Aniomes)

Delete il
from items_liquidaciones il
inner join Conceptosliquidacion cl
on il.concepto=cl.concepto
inner join FechasLegajos fl on 
fl.legajo = il.legajo 
where (fl.concepto=2) and 
(dbo.toaniomes(fecha)<=@Aniomes and isnull(dbo.toaniomes(Finaliza),@Aniomes+1000)>@Aniomes)
and il.concepto<>430 
and idLiquidacion=@idliquidacion
and (cl.tipoconcepto<>20 and cl.tipoconcepto<>40)

*/

Delete from items_liquidaciones where importe=0

Delete from items_liquidaciones where importe is null





GO
/****** Object:  StoredProcedure [dbo].[Liq_Especial]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




--Liq_Especial 1,200412

CREATE                        Procedure [dbo].[Liq_Especial](@Periodo int, @AnioMes int)
as

/*
Delete from Header_liquidaciones where Periodo=@Periodo 
and aniomes=@aniomes
*/

Declare @idLiquidacion int

Set @idLiquidacion=(Select idliquidacion from Header_Liquidaciones where aniomes=@aniomes
and periodo=@periodo)

if (@idLiquidacion is not null) and (@idLiquidacion <> 0)
	begin
		Delete from items_liquidaciones where  idLiquidacion=@idLiquidacion
		
		Update Header_liquidaciones
		set fechaliq=getdate() where  aniomes=@aniomes
		and periodo=@periodo
	end
else
	begin
		Insert into Header_Liquidaciones
		(fechaliq,aniomes,Periodo)
		values
		(getdate(),@aniomes,@Periodo)
		select @idLiquidacion=@@identity
	end

Delete from novedades

insert into Novedades
select * from ConceptosLegajosNovedades
where Periodo=@Periodo and aniomes=@aniomes

	-- 104 Vacaciones
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,104,(Select importe from Novedades where concepto=104 AND 
Novedades.legajo=a.legajo), Dbo.Vacaciones(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),isnull((Select importe from Novedades where concepto=104 and legajo=a.legajo),0))
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo

	-- 190 Aguinaldos
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,190,0,(Select importe from Novedades where concepto=190 AND 
Novedades.legajo=a.legajo and Periodo=@Periodo and @aniomes=aniomes)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo 
Where indicativoantiguedad=1

	-- 155 Aguinaldos
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,114,0,(Select importe from Novedades where concepto=114 AND 
Novedades.legajo=a.legajo and Periodo=@Periodo and @aniomes=aniomes)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo 
Where indicativoantiguedad=1

	-- 155 Aguinaldos
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,113,0,(Select importe from Novedades where concepto=113 AND 
Novedades.legajo=a.legajo and Periodo=@Periodo and @aniomes=aniomes)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo 
Where indicativoantiguedad=1

	-- 155 Aguinaldos
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,155,0,(Select importe from Novedades where concepto=155 AND 
Novedades.legajo=a.legajo and Periodo=@Periodo and @aniomes=aniomes)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo 
Where indicativoantiguedad=1


	-- 155 Aguinaldos
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,161,0,(Select importe from Novedades where concepto=161 AND 
Novedades.legajo=a.legajo and Periodo=@Periodo and @aniomes=aniomes)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo 
Where indicativoantiguedad=1


	-- 155 Aguinaldos
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,162,0,(Select importe from Novedades where concepto=162 AND 
Novedades.legajo=a.legajo and Periodo=@Periodo and @aniomes=aniomes)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo 
Where indicativoantiguedad=1

insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,163,0,(Select importe from Novedades where concepto=163 AND 
Novedades.legajo=a.legajo and Periodo=@Periodo and @aniomes=aniomes)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo 
Where indicativoantiguedad=1

	-- 156 Aguinaldos
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,156,0,(Select importe from Novedades where concepto=156 AND 
Novedades.legajo=a.legajo and Periodo=@Periodo and @aniomes=aniomes)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo 
Where indicativoantiguedad=1

	-- 452 Indemnizacion Fallecimiento
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,462,0, (Select importe from Novedades where concepto=462 AND 
Novedades.legajo=a.legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

	-- 453 Indemnizacion Fallecimiento
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,463,0, (Select importe from Novedades where concepto=463 AND 
Novedades.legajo=a.legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

	-- 513 Concepto 513
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,513,0, dbo.c513(a.legajo,dbo.tofecha(cast(cast(@Aniomes as char(6))+'28' as smalldatetime)))
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
where dbo.c513(a.legajo,dbo.tofecha(cast(cast(@Aniomes as char(6))+'28' as smalldatetime)))<>0

	-- 600 Jubilacion
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,600,0, Dbo.Jubil_esp(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@idLiquidacion)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

	-- 601 ley19032
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,601,0, Dbo.Ley19032_esp(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@idLiquidacion)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1


	-- 603 Sindicato
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,603, 0, Dbo.sindicato_esp(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@idLiquidacion)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1


	-- 611 Familiar a Cargo
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,611,0, dbo.aCargo_Aguinaldo(a.legajo,Dbo.edad(FechasLegajos.fecha,getdate()))
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

	-- 630 ObraSocial Ospedyc
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,630,0, dbo.ObraSocial_esp(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@idLiquidacion)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=106005


	-- 632 ObraSocial OSPOCE
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,632,0, dbo.ObraSocial_esp(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@idLiquidacion)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=406

	-- 634 ObraSocial OSCONA
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,634,0, dbo.ObraSocial_esp(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@idLiquidacion)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=113809

	-- 636 ObraSocial OSTIG
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,636,0, dbo.ObraSocial_esp(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@idLiquidacion)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=124506


	-- 638 ObraSocial OSSEG
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,638,0, dbo.ObraSocial_esp(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@idLiquidacion)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=901


	-- 640 ObraSocial OSSEG
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,640,0, dbo.ObraSocial_esp(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@idLiquidacion)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=126908

	-- 642 ObraSocial OSPACA
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,642,0, dbo.ObraSocial_esp(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@idLiquidacion)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=101604


	-- 643 ObraSocial OSTEL
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,643,0, dbo.ObraSocial_esp(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@idLiquidacion)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=120702

	-- 644 ObraSocial OSTEL
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,644,0, dbo.ObraSocial_esp(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@idLiquidacion)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=107800

insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,690,0, (Select Importe from Novedades where concepto=690 and legajo=a.legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo 

insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,693,0, (Select Importe from Novedades where concepto=693 and legajo=a.legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo 

insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
Select @idliquidacion,mp.legajo,430,999,
(
select sum(isnull(importe*tcl.multiplicador,0)) 
	from items_Liquidaciones il
	inner join Conceptosliquidacion cl
	on il.concepto=cl.concepto
	inner join tipconcliq tcl on 
	tcl.concepto=cl.tipoconcepto
	where idLiquidacion=@idliquidacion and il.legajo=mp.legajo
	and (cl.tipoconcepto<>20 and cl.tipoconcepto<>40)
)
From MaestroPersonal mp
inner join FechasLegajos fl on 
fl.legajo = mp.legajo and (fl.concepto=2) and 
(dbo.toaniomes(fecha)<=@Aniomes and isnull(dbo.toaniomes(Finaliza),@Aniomes+1000)>@Aniomes)

Delete il
from items_liquidaciones il
inner join Conceptosliquidacion cl
on il.concepto=cl.concepto
inner join FechasLegajos fl on 
fl.legajo = il.legajo 
where (Select count(*) from FechasLegajos
where legajo=il.legajo and concepto=0 and finaliza is null)=0
and idLiquidacion=@idLiquidacion


Delete from items_liquidaciones where importe=0

Delete from items_liquidaciones where importe is null
















GO
/****** Object:  StoredProcedure [dbo].[Liquida]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE    Procedure [dbo].[Liquida](@Periodo int, @AnioMes int) -- Liquida 0,200608
as

Declare @idLiquidacion int

Set @idLiquidacion=(Select idliquidacion from Header_Liquidaciones where aniomes=@aniomes
and periodo=@periodo)

if (@idLiquidacion is not null) and (@idLiquidacion <> 0)
	begin
			Delete from items_liquidaciones where  idLiquidacion=@idLiquidacion
	
			Update Header_liquidaciones
			set fechaliq=getdate() where  aniomes=@aniomes
			and periodo=@periodo
	end
else
	begin

		Insert into Header_Liquidaciones
		(fechaliq,aniomes,Periodo)
		values
		(getdate(),@aniomes,@Periodo)
		select @idLiquidacion=@@identity

	end

Delete from novedades

insert into Novedades
select * from conceptosLegajosnovedades
where Periodo=@Periodo and aniomes=@aniomes

if @Periodo=0
Begin 
	Delete from Novedades where concepto='5010'

	insert into Novedades
	Select mp.legajo,20 as orden,5010 as concepto,
	case when dbo.Remuneracion_Habitual(mp.legajo,@aniomes,@idliquidacion) =2600 then 0
	     when dbo.Remuneracion_Habitual(mp.legajo,@aniomes,@idliquidacion) between 1800 and 2599
		then 30 * (select count(*) from familiaresLegajos
				where parentesco=2 and dbo.edad(fecnac,cast(cast(@Aniomes as char(6))+'28' as smalldatetime))<18
				and legajo=mp.legajo)
	     when dbo.Remuneracion_Habitual(mp.legajo,@aniomes,@idliquidacion) between 1200 and 1799
		then 45 * (select count(*) from familiaresLegajos
				where parentesco=2 and dbo.edad(fecnac,cast(cast(@Aniomes as char(6))+'28' as smalldatetime))<18
				and legajo=mp.legajo)
	     when dbo.Remuneracion_Habitual(mp.legajo,@aniomes,@idliquidacion) between 100 and 1199
		then 60 * (select count(*) from familiaresLegajos
				where parentesco=2 and dbo.edad(fecnac,cast(cast(@Aniomes as char(6))+'28' as smalldatetime))<18
				and legajo=mp.legajo)
	end as Importe,@Aniomes as Aniomes,0 as Periodo,null as tipo
	from MaestroPersonal mp Where mp.fechabaja is null and 
	(select count(*) from familiaresLegajos
	where parentesco=2 and dbo.edad(fecnac,cast(cast(@Aniomes as char(6))+'28' as smalldatetime))<18
	and legajo=mp.legajo)>0
	Group by mp.legajo,apellido,nombre
	
	having dbo.Remuneracion_Habitual(mp.legajo,@aniomes,@idliquidacion)<2600
end


DECLARE Conceptos CURSOR FOR 
Select distinct cl.concepto 
from Conceptosliquidacion cl
where cl.concepto>999 and cl.concepto between 1000 and 9999
order by cl.concepto

Declare @Concepto int

OPEN Conceptos
FETCH NEXT FROM Conceptos INTO @Concepto

WHILE @@FETCH_STATUS = 0
BEGIN
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
	Select @idLiquidacion,mp.Legajo,@Concepto,
Case 
when tipo=1 then nv.importe 
when @Concepto=1120 then Dbo.edad(FechaAntiguedad,
				cast(cast(@Aniomes as char(6))+'28' as smalldatetime))
else Null end,
	dbo.fnLiquidaItem(mp.Legajo,@Concepto,@Aniomes,@idliquidacion)*
case when tipo=1 then nv.importe else 1 end 
	from MaestroPersonal mp
	left join ConceptosLegajos cl
	on mp.legajo=cl.legajo and cl.Concepto=@Concepto
	left join Novedades nv
	on mp.legajo=nv.legajo and nv.Concepto=@Concepto

	where Fechabaja is null 
	and dbo.fnLiquidaItem(mp.Legajo,@Concepto,@Aniomes,@idliquidacion)<>0
	and dbo.fnLiquidaItem(mp.Legajo,@Concepto,@Aniomes,@idliquidacion)*case when tipo=1 then nv.importe else 1 end <>0
	
	FETCH NEXT FROM Conceptos INTO @Concepto
END

CLOSE Conceptos
DEALLOCATE Conceptos




GO
/****** Object:  StoredProcedure [dbo].[Liquida_anterior]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


Create Procedure [dbo].[Liquida_anterior](@Periodo int, @AnioMes int)
as

Declare @idLiquidacion int

Set @idLiquidacion=(Select idliquidacion from Header_Liquidaciones where aniomes=@aniomes
and periodo=@periodo)

if (@idLiquidacion is not null) and (@idLiquidacion <> 0)
	begin
			Delete from items_liquidaciones where  idLiquidacion=@idLiquidacion
	
			Update Header_liquidaciones
			set fechaliq=getdate() where  aniomes=@aniomes
			and periodo=@periodo
	end
else
	begin
		Insert into Header_Liquidaciones
		(fechaliq,aniomes,Periodo)
		values
		(getdate(),@aniomes,@Periodo)
		select @idLiquidacion=@@identity
	end
	-- 100 Basico
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo, 100, 0, Dbo.Basico(a.legajo) 
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

	-- 104 Vacaciones
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,104,(Select importe from ConceptosLegajosNovedades where concepto=104 AND 
conceptoslegajosnovedades.legajo=a.legajo), Dbo.Vacaciones(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),isnull((Select importe from ConceptosLegajosNovedades where concepto=104 and legajo=a.legajo),0))
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and FechasLegajos.indicativoantiguedad=1

	-- 305 Vacaciones ya abonadas
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,305,(Select importe from ConceptosLegajosNovedades where concepto=305 AND 
conceptoslegajosnovedades.legajo=a.legajo), Dbo.DiasNoTrabajados(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),isnull((Select importe from ConceptosLegajosNovedades where concepto=305 and legajo=a.legajo),0))
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo  and FechasLegajos.indicativoantiguedad=1


	-- 303 Vacaciones ya abonadas
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,303,(Select importe from ConceptosLegajosNovedades where concepto=303 AND 
conceptoslegajosnovedades.legajo=a.legajo), Dbo.VacacionesYaAbonadas(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),isnull((Select importe from ConceptosLegajosNovedades where concepto=303 and legajo=a.legajo),0))
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo  and FechasLegajos.indicativoantiguedad=1

	-- 105 Titulo Secundario
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,105,0, Dbo.Titulo(a.legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1


-- 106 Adicional
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,106,0, Dbo.Asistencia(a.Legajo,0)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

-- 107 Adicional
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,107,0, Dbo.IncentivoTrimestre(a.Legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and FechasLegajos.indicativoantiguedad=1

	-- 112 Antiguedad
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,112,Dbo.edad(FechasLegajos.fecha,getdate()), Dbo.antig(a.legajo,Dbo.edad(FechasLegajos.fecha,getdate()))
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and FechasLegajos.indicativoantiguedad=1


	-- 114 Adicional
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,114,0, Dbo.Adicional(a.legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and FechasLegajos.indicativoantiguedad=1

	-- 115 ManejoPC
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,115,0, Dbo.ManejoPC(a.legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

	-- 120 Adicional Cargo
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,120,0, dbo.adicionalCargo(a.legajo) 
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

	-- 121 Puntualidad
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,121,0, Dbo.Puntualidad(a.Legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

	-- 124 Vacaciones ya abonadas
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,124,0,isnull((Select importe from ConceptosLegajosNovedades where concepto=124 and legajo=a.legajo),0)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo  and FechasLegajos.indicativoantiguedad=1


-- 127 Incentivo
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,127,0, Dbo.Incentivo(a.legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

	-- 123 Falla de Caja
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,123,0, Dbo.FallaCaja(a.legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1


	-- 129 Titulo Universitario
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,129,0, Dbo.TituloUniv(a.legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

	-- 130 Horas extras al 50
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,130,(Select importe from ConceptosLegajosNovedades where concepto=130 AND 
conceptoslegajosnovedades.legajo=a.legajo), Dbo.Hora50(a.legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

	-- 132 Horas Extras al 100
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,132,(Select importe from ConceptosLegajosNovedades where concepto=132 AND 
conceptoslegajosnovedades.legajo=a.legajo), Dbo.Hora100(a.legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

	-- 134 Aguinaldo proporcional
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,134,0, dbo.AguinaldoProp(a.legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1



	-- 135 Concepto 135
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,135,0, (Select importe from ConceptosLegajosNovedades where concepto=135 AND 
conceptoslegajosnovedades.legajo=a.legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

	-- 136 Concepto 136
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,136,0, (Select importe from ConceptosLegajosNovedades where concepto=136 AND 
conceptoslegajosnovedades.legajo=a.legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1


	-- 140 Horas extras al 50 Dif
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,140,(Select importe from ConceptosLegajosNovedades where concepto=140 AND 
conceptoslegajosnovedades.legajo=a.legajo), Dbo.Hora50Dif(a.legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1


	-- 142 Concepto 142
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,142,0, (Select importe from ConceptosLegajosNovedades where concepto=142 AND 
conceptoslegajosnovedades.legajo=a.legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

	-- 143 Concepto 143
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,143,0, (Select importe from ConceptosLegajosNovedades where concepto=143 AND 
conceptoslegajosnovedades.legajo=a.legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

	-- 152 100 pesos 
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,152,999,(Select importe from ConceptosLegajos where concepto=152 AND 
conceptoslegajos.legajo=a.legajo and (Select count(*) from conceptosLegajosNovedades where concepto=303 and legajo=a.legajo)>-1 )
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

	-- 301 Concepto 301
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,301,0, (Select importe from ConceptosLegajosNovedades where concepto=301 AND 
conceptoslegajosnovedades.legajo=a.legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1


	-- 424 Vacaciones NG
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,424,0, dbo.VacacionesNG(a.legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

	-- 426 SAC Vacaciones NG
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,426,0, dbo.SACVacacionesNG(a.legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1


	-- 451 Indemnizacion Fallecimiento
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,451,0, dbo.IndemnizFallecimiento(a.legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

	-- 501 Hijo
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,501,0, dbo.Hijo(a.Legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

	-- 502 Hijo
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,502,0, dbo.Prenatal(a.Legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

	-- 513 Concepto 513
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,513,0, (Select importe from ConceptosLegajosNovedades where concepto=513 AND 
conceptoslegajosnovedades.legajo=a.legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

	-- 526 Concepto 526
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,526,0, (Select importe from ConceptosLegajosNovedades where concepto=526 AND 
conceptoslegajosnovedades.legajo=a.legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

	-- 515 Concepto 515
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,515,0, (Select importe from ConceptosLegajosNovedades where concepto=515 AND 
conceptoslegajosnovedades.legajo=a.legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1



	-- 611 Familiar a Cargo
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,611,0, dbo.aCargo(a.legajo,Dbo.edad(FechasLegajos.fecha,getdate()))
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1


	-- 693 Prestamo
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,693,0, Dbo.Prestamo(a.legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

	-- 600 Jubilacion
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,600,0, Dbo.Jubil(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@Periodo,600)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

	-- 601 ley19032
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,601,0, Dbo.Ley19032(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@Periodo,601)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1


	-- 603 Sindicato
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,603, 0, Dbo.sindicato(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()))
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

	-- 630 ObraSocial Ospedyc
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,630,0, Dbo.ObraSocial(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@Periodo,630)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=106005


	-- 632 ObraSocial OSPOCE
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,632,0, Dbo.ObraSocial(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@Periodo,632)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=406


	-- 634 ObraSocial OSCONA
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,634,0, Dbo.ObraSocial(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@Periodo,634)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=113809


	-- 636 ObraSocial OSTIG
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,636,0, Dbo.ObraSocial(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@Periodo,636)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=124506


	-- 638 ObraSocial OSSEG
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,638,0, Dbo.ObraSocial(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@Periodo,638)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=901


	-- 640 ObraSocial OSSEG
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,640,0, Dbo.ObraSocial(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@Periodo,640)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=126908

	-- 642 ObraSocial OSPACA
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,642,0, Dbo.ObraSocial(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@Periodo,642)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=101604

	-- 643 ObraSocial OSTEL
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,643,0, Dbo.ObraSocial(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@Periodo,643)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=120702

-- 601 ley 19032 200
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,601,999, Dbo.Ley19032_100(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@Periodo,601)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

	-- 630 ObraSocial Ospedyc
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,630,999, Dbo.ObraSocial_100(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@Periodo,630)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=106005
--Where (Select count(*) from conceptosLegajosNovedades where concepto=303 and legajo=a.legajo)=0


	-- 632 ObraSocial OSPOCE
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,632,999, Dbo.ObraSocial_100(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@Periodo,632)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=406
--Where (Select count(*) from conceptosLegajosNovedades where concepto=303 and legajo=a.legajo)=0

	-- 634 ObraSocial OSCONA
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,634,999, Dbo.ObraSocial_100(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@Periodo,634)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=113809
--Where (Select count(*) from conceptosLegajosNovedades where concepto=303 and legajo=a.legajo)=0

	-- 636 ObraSocial OSTIG
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,636,999, Dbo.ObraSocial_100(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@Periodo,636)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=124506
--Where (Select count(*) from conceptosLegajosNovedades where concepto=303 and legajo=a.legajo)=0

	-- 638 ObraSocial OSSEG
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,638,999, Dbo.ObraSocial_100(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@Periodo,638)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=901
--Where (Select count(*) from conceptosLegajosNovedades where concepto=303 and legajo=a.legajo)=0

	-- 640 ObraSocial OSSEG
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,640,999, Dbo.ObraSocial_100(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@Periodo,640)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=126908
--Where (Select count(*) from conceptosLegajosNovedades where concepto=303 and legajo=a.legajo)=0

	-- 642 ObraSocial OSPACA
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,642,999, Dbo.ObraSocial_100(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@Periodo,642)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=101604
--Where (Select count(*) from conceptosLegajosNovedades where concepto=303 and legajo=a.legajo)=0

	-- 643 ObraSocial OSTEL
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,643,999, Dbo.ObraSocial_100(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()),@aniomes,@Periodo,643)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
and a.obrasocial=120702
--Where (Select count(*) from conceptosLegajosNovedades where concepto=303 and legajo=a.legajo)=0

-- 603 Sindicato 200
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,603,999, Dbo.Sindicato_100(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate()))
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1
--Where (Select count(*) from conceptosLegajosNovedades where concepto=303 and legajo=a.legajo)=0

	-- 690 Retencion Ganancias
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
SELECT 
@idLiquidacion,a.legajo,690,0, Dbo.RG(a.Legajo)
FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1

Delete from items_liquidaciones where importe=0

Delete from items_liquidaciones where importe is null

insert into items_liquidaciones
(idliquidacion, legajo,concepto,horas,importe)
Select @idliquidacion,4,430,999,(Select sum(isnull((importe*tcl.multiplicador),0)) 
from items_Liquidaciones il
inner join Conceptosliquidacion cl
on il.concepto=cl.concepto
inner join tipconcliq tcl on 
tcl.concepto=cl.tipoconcepto
where idLiquidacion=@idliquidacion and legajo=4
and (cl.tipoconcepto<>20 and cl.tipoconcepto<>40))


insert into items_liquidaciones
(idliquidacion, legajo,concepto,horas,importe)
Select @idliquidacion, 61, 430, 999,
(Select sum(isnull(importe*tcl.multiplicador,0)) 
from items_Liquidaciones il
inner join Conceptosliquidacion cl
on il.concepto=cl.concepto
inner join tipconcliq tcl on 
tcl.concepto=cl.tipoconcepto
where idLiquidacion=@idliquidacion and legajo=61
and (cl.tipoconcepto<>20 and cl.tipoconcepto<>40)) 

Delete il
from items_liquidaciones il
inner join Conceptosliquidacion cl
on il.concepto=cl.concepto
where (legajo=4 or legajo=61)
and il.concepto<>430 
and idLiquidacion=21
and (cl.tipoconcepto<>20 and cl.tipoconcepto<>40)

Delete
from items_liquidaciones
from items_liquidaciones il
inner Join 
maestroPersonal mp on il.legajo=mp.legajo
inner join Fechaslegajos fl on fl.legajo=mp.legajo
where fl.Concepto=1 and idLiquidacion=@idLiquidacion




GO
/****** Object:  StoredProcedure [dbo].[Liquidador]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


CREATE  Procedure [dbo].[Liquidador](@Periodo int, @AnioMes int) -- Liquidador 0,200608
as

Declare @idLiquidacion int

Set @idLiquidacion=(Select idliquidacion from Header_Liquidaciones where aniomes=@aniomes
and periodo=@periodo)

if (@idLiquidacion is not null) and (@idLiquidacion <> 0)
	begin
			Delete from items_liquidaciones where  idLiquidacion=@idLiquidacion
	
			Update Header_liquidaciones
			set fechaliq=getdate() where  aniomes=@aniomes
			and periodo=@periodo
	end
else
	begin
/*		if @Periodo=0
			execute CargaHijos @Aniomes,@Periodo */

		Insert into Header_Liquidaciones
		(fechaliq,aniomes,Periodo)
		values
		(getdate(),@aniomes,@Periodo)
		select @idLiquidacion=@@identity

	end

Delete from novedades

insert into Novedades
select * from conceptosLegajosnovedades
where Periodo=@Periodo and aniomes=@aniomes

if @Periodo=0
Begin 
	Delete from Novedades where concepto='5010'

	insert into Novedades
	Select mp.legajo,20 as orden,5010 as concepto,
	case when dbo.Remuneracion_Habitual(mp.legajo,@aniomes,@idliquidacion) =2600 then 0
	     when dbo.Remuneracion_Habitual(mp.legajo,@aniomes,@idliquidacion) between 1800 and 2599
		then 30 * (select count(*) from familiaresLegajos
				where parentesco=2 and dbo.edad(fecnac,cast(cast(@Aniomes as char(6))+'28' as smalldatetime))<18
				and legajo=mp.legajo)
	     when dbo.Remuneracion_Habitual(mp.legajo,@aniomes,@idliquidacion) between 1200 and 1799
		then 45 * (select count(*) from familiaresLegajos
				where parentesco=2 and dbo.edad(fecnac,cast(cast(@Aniomes as char(6))+'28' as smalldatetime))<18
				and legajo=mp.legajo)
	     when dbo.Remuneracion_Habitual(mp.legajo,@aniomes,@idliquidacion) between 100 and 1199
		then 60 * (select count(*) from familiaresLegajos
				where parentesco=2 and dbo.edad(fecnac,cast(cast(@Aniomes as char(6))+'28' as smalldatetime))<18
				and legajo=mp.legajo)
	end as Importe,@Aniomes as Aniomes,0 as Periodo,null as tipo
	from MaestroPersonal mp Where mp.fechabaja is null and 
	(select count(*) from familiaresLegajos
	where parentesco=2 and dbo.edad(fecnac,cast(cast(@Aniomes as char(6))+'28' as smalldatetime))<18
	and legajo=mp.legajo)>0
	Group by mp.legajo,apellido,nombre
	
	having dbo.Remuneracion_Habitual(mp.legajo,@aniomes,@idliquidacion)<2600
end


DECLARE Conceptos CURSOR FOR 
Select distinct cl.concepto 
from Conceptosliquidacion cl
where cl.concepto>999 and cl.concepto between 1000 and 9999
order by cl.concepto

Declare @Concepto int

OPEN Conceptos
FETCH NEXT FROM Conceptos INTO @Concepto

WHILE @@FETCH_STATUS = 0
BEGIN
insert into items_liquidaciones
(idLiquidacion, legajo,concepto,horas,importe)
	Select @idLiquidacion,mp.Legajo,@Concepto,case when tipo=1 then nv.importe else Null end,
	dbo.fnLiquidaItem(mp.Legajo,@Concepto,@Aniomes,@idliquidacion)*
case when tipo=1 then nv.importe else 1 end 
	from MaestroPersonal mp
	left join ConceptosLegajos cl
	on mp.legajo=cl.legajo and cl.Concepto=@Concepto
	left join Novedades nv
	on mp.legajo=nv.legajo and nv.Concepto=@Concepto

	where Fechabaja is null and dbo.fnLiquidaItem(mp.Legajo,@Concepto,@Aniomes,@idliquidacion)<>0
	
	FETCH NEXT FROM Conceptos INTO @Concepto
END

CLOSE Conceptos
DEALLOCATE Conceptos


GO
/****** Object:  StoredProcedure [dbo].[Listado_Adherentes_Completo]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO

CREATE Procedure
[dbo].[Listado_Adherentes_Completo] 
-- Listado_Adherentes_Completo   0, "C.MEDICO DE MATANZA",0,9,"F11"
 --  Listado_Adherentes_Completo;1 0, 'ALL', 0, 3, '0', '0'
(
	@Sexo			int=0, -- 0 Todos
	@DomiCobro		char(30)='ALL', -- T Todos
	@Rango			int=0, -- 0 x Edad, 1 cada 5 2 cada 10
	@Especialidad	int=0, -- 0 Todos
	@ConceptoDesde	char(3)='ALL', -- ALL=Todos
	@ConceptoHasta	char(3)='ALL' -- ALL=Todos
)

as
Declare @Concatena char(7)
Declare @sqlStr nvarChar(4000)
set @Concatena=' Where '

Set @sqlStr = 'Select *,(select Top 1 es.Descripcion from especialidades_adherentes ea inner join especialidades es on ea.especialidad=es.especialidad where '
if @Especialidad<>0
		Set @sqlStr = @sqlStr + ' ea.especialidad='  + cast(@Especialidad as char(3)) + ' and '
		Set @sqlStr = @sqlStr + ' adherente=la.adherente) Especialidad
, case when 1=' + cast(@rango as char(1)) + ' then cada5 
     when 2=' + cast(@rango as char(1)) + ' then cada10
else 1 end as Grupo
from listadoAdherentes la '

if @Sexo<>0
	Begin
		Set @sqlStr = @sqlStr + @Concatena + 'idSexo=' + cast(@Sexo as char(1))
		Set @Concatena=' And '
	end
	
if @DomiCobro<>'ALL'
	Begin
		Set @sqlStr = @sqlStr + @Concatena + 'Domicilio_cobro="' + @DomiCobro + '"'
		Set @Concatena=' And '
	end

if @Especialidad<>0
	Begin
		Set @sqlStr = @sqlStr + @Concatena + '(select count(*) from especialidades_adherentes where Especialidad=' + Cast(@Especialidad as char(3)) + ' and adherente=la.adherente)>0 '
		Set @Concatena=' And '
	end

if @ConceptoDesde<>'ALL'
	BEGIN 
		IF @ConceptoHasta='ALL'
			Set @ConceptoHasta=@ConceptoDesde

		Set @sqlStr = @sqlStr + @Concatena + ' (select count(*) from Conceptos_adherentes where fechabaja is null and (Concepto between "' + @ConceptoDesde + '" and "' + @ConceptoHasta + '") and adherente=la.adherente)>0 '

	END

Set @sqlStr = @sqlStr + ' Order by apellido,Nombre '

--print @sqlstr
Exec sp_executesql @sqlStr




GO
/****** Object:  StoredProcedure [dbo].[Listado_Conceptos_Unicos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[Listado_Conceptos_Unicos] (@Periodo int)
as
SELECT socio,Grupo,Apellido,Nombre,(
SELECT Conceptos.descripcion FROM Conceptos_socios INNER JOIN
Conceptos ON Conceptos_socios.Concepto = Conceptos.Concepto
WHERE
(Conceptos_socios.socio = sc.socio) 
and 
((fechaBaja is null or fechabaja>@Periodo) and dbo.toaniomes(FechaVigencia)<=@Periodo)
) as Descripcion,
(
SELECT Conceptos_socios.Concepto	FROM Conceptos_socios INNER JOIN
Conceptos ON Conceptos_socios.Concepto = Conceptos.Concepto
WHERE
(Conceptos_socios.socio = sc.socio) 
and 
((fechaBaja is null or fechabaja>@Periodo) and dbo.toaniomes(FechaVigencia)<=@Periodo)
) as Concepto
from socios sc

where 
(
SELECT count(*)	FROM Conceptos_socios INNER JOIN
Conceptos ON Conceptos_socios.Concepto = Conceptos.Concepto
WHERE
(Conceptos_socios.socio = sc.socio) 
and 
((fechaBaja is null or fechabaja>@Periodo) and dbo.toaniomes(FechaVigencia)<=@Periodo)
)=1
and 
(
SELECT count(*)	FROM Conceptos_socios INNER JOIN
Conceptos ON Conceptos_socios.Concepto = Conceptos.Concepto
WHERE
(Conceptos_socios.socio = sc.socio) 
and 
((fechaBaja is null or fechabaja>@Periodo) and dbo.toaniomes(FechaVigencia)<=@Periodo)
and (Conceptos_socios.concepto='C01' or Conceptos_socios.concepto='C03' or Conceptos_socios.concepto='C05')
)=1
order by Grupo

GO
/****** Object:  StoredProcedure [dbo].[ListadoAdherentesConcEsp]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE    Procedure [dbo].[ListadoAdherentesConcEsp]

/*
	@SocioDesde		int = Null, 
	@SocioHasta		int = Null, 
	@Entidad		int	
 
*/
AS
Declare @C_String 	as nvarchar(4000)


Set @C_String='Select 	count(A01.adherente) as Adherentes, 
						A03.descripcion as DescEspecialidad, A04.Concepto, A05.descripcion as DescConcepto
				from adherentes A01
					inner join especialidades_adherentes A02
						on A01.adherente = A02.adherente
					inner join Especialidades A03
						on A02.especialidad = A03.especialidad
					inner join Conceptos_adherentes A04
						on A01.adherente = A04.adherente
					inner join Conceptos A05
						on A04.Concepto = A05.Concepto
				where A01.fechabaja is null '

	/**** Armo las condiciones ****/
/*
	if @SocioDesde is not null and @SocioDesde <> 0
		begin
			set @boolWhere = 'S'	
			Set @C_String= @C_String + ' where  A01.'+@Campo+' >= ' + convert(char(10),@SocioDesde)
		end
	if @SocioHasta is not null and @SocioHasta <> 0
		begin
			if @boolWhere = 'S'
				Set @C_String= @C_String + ' and  A01.'+@Campo+' <= ' + convert(char(10),@SocioHasta)			
			else
				Set @C_String= @C_String + ' where  A01.'+@Campo+' <= ' + convert(char(10),@SocioHasta)
		end
*/

	/**** Armo el orden de la consulta ****/
	Set @C_String=@C_String + ' group by A03.especialidad, A03.descripcion, A04.Concepto, A05.descripcion
								order by A04.concepto, A03.especialidad '

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String






GO
/****** Object:  StoredProcedure [dbo].[ListadoAfiliados]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


CREATE         Procedure [dbo].[ListadoAfiliados]
	@EA			char(1)='A', -- E ncabezado A filiados
	@SocioDesde		int = Null, 
	@SocioHasta		int = Null,
	@Cuantos		int = 500
 
AS
Declare @C_String 	as nvarchar(4000)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

Set @C_String='Select ' + case @EA when 'E' then ' top ' + cast(@Cuantos as char(6)) else '' end +

			  ' A01.nrosocio as Afiliado, A02.socio, A02.apellido, A02.nombre, 
						A02.Domicilio, A02.Localidad, A03.descripcion as TipoDocu, 
						A02.numedocto, A02.Nacido,
						(select top 1 grupo from grupos_socios b where b.socio = A02.socio order by idcampo) as Categoria,
						(select min(FechaAlta) from Conceptos_socios a where a.socio = A02.socio) as Ingreso,
						A02.FechaBaja as Egreso
				from temp_socios A01
					left join socios A02 
						on A01.nrosocio = A02.socio
					left join TiposDocumento A03
						on A03.tipodocto = A02.tipodocto '

	/**** Armo las condiciones ****/
	if @SocioDesde is not null and @SocioDesde <> 0
		begin
			set @boolWhere = 'S'	
			Set @C_String= @C_String + ' where  A01.NroSocio >= ' + convert(char(10),@SocioDesde)
		end
	if @SocioHasta is not null and @SocioHasta <> 0
		begin
			if @boolWhere = 'S'
				Set @C_String= @C_String + ' and  A01.NroSocio <= ' + convert(char(10),@SocioHasta)			
			else
				Set @C_String= @C_String + ' where  A01.NroSocio <= ' + convert(char(10),@SocioHasta)
		end

	Set @C_String= @C_String + ' and  A01.NroSocio <= 27411' -- + convert(char(10),@SocioHasta)			

	/**** Armo el orden de la consulta ****/
	Set @C_String=@C_String + 'Order by A01.NroSocio'

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String



GO
/****** Object:  StoredProcedure [dbo].[ListadoAguinaldos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE    Procedure [dbo].[ListadoAguinaldos]
(
	@AAAA	char(4),
	@Periodo int
)
as

Select cnh.Legajo,cnh.Apellido,cnh.nombre, aniomes, sum(acumulado) as importe
from MaestroPersonal cnh
inner join remuneracionesacumuladas rac
on cnh.legajo=rac.legajo
where aniomes between
cast(@AAAA + case when @Periodo=1 then '01' else '07' end as char(6)) -- Desde
and
cast(@AAAA + case when @Periodo=1 then '06' else '12' end as char(6)) -- Hasta
and (select count(*) from FechasLegajos fl where
fl.legajo = cnh.legajo and (fl.concepto=0 and finaliza is null))>0
group by cnh.legajo,cnh.Apellido,cnh.nombre,rac.aniomes
order by cnh.legajo,aniomes



GO
/****** Object:  StoredProcedure [dbo].[ListadoAltasCobertura]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE                       Procedure [dbo].[ListadoAltasCobertura]
	@Concepto char(3),
	@FechaDesde char(8),
	@FechaHasta char(8),
	@Cobrador int = NULL,
	@Especialidad int, --999:TODOS, 1:MEDICOS, 0:NO MEDICOS
	@Entidad int, 
	@Orden int
as

Declare @C_String as nvarchar(4000)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

if @Entidad = 1
	Set @C_String='Select ad.NroMatricula, ad.adherente, ad.Apellido, ad.Nombre 
	 				from Adherentes ad
						inner join Conceptos_adherentes ca 
							on ca.adherente = ad.adherente 
						left join Cobradores co
							on co.cobrador = ad.cobrador '
else
	Set @C_String='Select ad.NroMatricula, ad.socio, ad.Apellido, ad.Nombre
	 				from socios ad
						inner join Conceptos_socios ca 
							on ca.socio = ad.socio
						left join Cobradores co
							on co.cobrador = ad.cobrador
						left join hospitalesvoto hv
							on hv.hospitalvoto = ad.lugarvoto '

	----- Concepto -----
	Set @C_String= @C_String + ' where ca.concepto= "' + convert(char(3),@Concepto) + '"'

	----- ALTAS -----
	if @FechaDesde <> ''
		Set @C_String= @C_String + ' and  ca.FechaAlta >= "' + @FechaDesde + '"'

	if @FechaHasta <> ''
		Set @C_String= @C_String + ' and  ca.FechaAlta <= "' + @FechaHasta  + '"'

	----- Cobrador -----
	if @Cobrador is not null and @Cobrador <> 0
		Set @C_String= @C_String + ' and  ad.Cobrador = ' + rtrim(convert(char(5),@Cobrador))

	-- MEDICOS, NO MEDICOS
	if @Especialidad is not null and @Especialidad <> 999
		begin
			if @Entidad = 0
				Set @C_String= @C_String + ' and (Select top 1 es.Medico from Especialidades_Socios esoc inner join Especialidades es on esoc.especialidad = es.especialidad where esoc.Socio = ad.Socio) = ' + convert(char(1),@Especialidad)
			else
				Set @C_String= @C_String + ' and (Select top 1 es.Medico from Especialidades_Adherentes esad inner join Especialidades es on esad.especialidad = es.especialidad where esad.adherente = ad.Adherente) = ' + convert(char(1),@Especialidad)
		end		


	/**** Armo el orden de la consulta ****/
	if @Orden = 0
		--x Lugar de Cobro y alfabeto
		begin
			if @Entidad = 1 
				set @C_String =	@C_String + ' Order by 	rtrim(ltrim(dbo.DescHospitalVoto(ad.Domicilio_Cobro))), ad.apellido, ad.nombre '
			else
				Set @C_String=@C_String + ' Order by ad.LugarVoto, ad.apellido, ad.nombre'
		end
	else
		--x Alfabeto solamente
		begin
			if @Entidad = 1 
				Set @C_String=@C_String + ' Order by ad.Apellido, ad.Nombre'
			else
				Set @C_String=@C_String + ' Order by ad.Apellido, ad.Nombre'
		end
	
/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String















GO
/****** Object:  StoredProcedure [dbo].[ListadoAnses]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE       procedure [dbo].[ListadoAnses]
	
	@Periodo as char(6)

as
if @Periodo<200411
	(
	select so.grupo, so.fichamun, (co.importe * dbo.DeudasAnses(@Periodo,so.socio)) as Importe,
	so.apellido, so.nombre, '387' as CodigoCOncepto, so.cajaanses,so.socio
	from socios so 
	inner join conceptos_socios cs on cs.socio = so.socio and cs.fechabaja is null
	inner join conceptos co on cs.concepto = co.concepto
	where so.fechabaja is null
	and so.grupo = 'J'
	and so.cobrador<>8 and so.cobrador <> 4
	and (Select count(*) from cuentascorrientes cc where 
	cc.documentonumero= @Periodo
	and cc.entidad=0 and cc.socio=so.Socio)=0
	and so.fichamun <> 0
	and co.concepto = 'C03'
	)
	union
	(
	select so.grupo, so.fichamun, sum((co.importe * dbo.DeudasAnses(@Periodo, so.socio))) as importe, so.apellido, so.nombre, '397' as CodigoCOncepto, so.cajaanses,so.socio
	from socios so 
	inner join conceptos_socios cs on cs.socio = so.socio and cs.fechabaja is null
	inner join conceptos co on cs.concepto = co.concepto
	where so.fechabaja is null
	and so.grupo = 'J'
	and so.cobrador<>8 and so.cobrador <> 4
	and (Select count(*) from cuentascorrientes cc where 
	cc.documentonumero= @Periodo
	and cc.entidad=0 and cc.socio=so.Socio)=0
	and so.fichamun <> 0
	and co.concepto <> 'C03'
	group by so.grupo, so.fichamun, so.apellido, so.nombre, so.cajaanses,so.socio
	)
	order by so.fichamun

Else

	(
	select so.grupo, so.fichamun, (co.importe * dbo.DeudasAnses(@Periodo,so.socio)) as Importe,
	so.apellido, so.nombre, '387' as CodigoCOncepto, so.cajaanses,so.socio
	from socios so 
	inner join conceptos_socios cs on cs.socio = so.socio and cs.fechabaja is null
	inner join conceptos_aumento co on cs.concepto = co.concepto
	where so.fechabaja is null
	and so.grupo = 'J'
	and so.cobrador<>8 and so.cobrador <> 4
	and (Select count(*) from cuentascorrientes cc where 
	cc.documentonumero= @Periodo
	and cc.entidad=0 and cc.socio=so.Socio)=0
	and so.fichamun <> 0
	and co.concepto = 'C03'
	)
	union
	(
	select so.grupo, so.fichamun, sum((co.importe * dbo.DeudasAnses(@Periodo, so.socio))) as importe, so.apellido, so.nombre, '397' as CodigoCOncepto, so.cajaanses,so.socio
	from socios so 
	inner join conceptos_socios cs on cs.socio = so.socio and cs.fechabaja is null
	inner join conceptos_aumento co on cs.concepto = co.concepto
	where so.fechabaja is null
	and so.grupo = 'J'
	and so.cobrador<>8 and so.cobrador <> 4
	and (Select count(*) from cuentascorrientes cc where 
	cc.documentonumero= @Periodo
	and cc.entidad=0 and cc.socio=so.Socio)=0
	and so.fichamun <> 0
	and co.concepto <> 'C03'
	group by so.grupo, so.fichamun, so.apellido, so.nombre, so.cajaanses,so.socio
	)
	order by so.fichamun



GO
/****** Object:  StoredProcedure [dbo].[ListadoApoyoAdherentes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE                   Procedure [dbo].[ListadoApoyoAdherentes] -- ListadoApoyoAdherentes 1

	@Cobrador		int = Null

AS
Declare @C_String 	as nvarchar(4000)


Set @C_String='Select ad.Adherente,ad.Apellido,ad.Nombre,case when len(ltrim(rtrim(Ad.Telefono_Cobro)))>0 then ad.telefono_cobro else Ad.Telefono end telefono,
						cc.documentonumero,cc.importe, 
						dbo.CodigoHospitalVoto(ad.Domicilio_Cobro) as CodHOspital,re.idtransaccionrecibo,
						rtrim(ltrim(dbo.DescHospitalVoto(ad.Domicilio_Cobro))) as Domicilio_Cobro,
						(Select top 1 B01.Especialidad from Especialidades_adherentes B01 where B01.adherente = ad.Adherente) as Especialidad,
						(Select top 1 B02.Descripcion from Especialidades_adherentes B01 inner join Especialidades B02 on B01.especialidad = B02.especialidad
						where B01.adherente = Ad.Adherente) as DescEspecialidad, re.numero, isnull(re.activo,0) as Activo, ("SF" + right(year(re.Fecha),2)) as Serie

		From Recibos re
			inner join cuentascorrientes cc
				on re.idTransaccionMes = cc.idTransaccion
			inner join Adherentes ad
				on cc.socio = ad.Adherente
		where cc.entidad = 1 and (cc.cancelado=0 or (re.idtransaccionrecibo<>0 and dbo.toaniomes(re.Fecha)=dbo.toaniomes(getdate()))) and ad.fechabaja is null and isnull(ad.tarjeta,0)=0 '


	if @Cobrador is not null and @Cobrador <> 0
			Set @C_String= @C_String + ' and ad.cobrador = ' + convert(char(2),@Cobrador)

	/**** Armo el orden de la consulta ****/
	Set @C_String=@C_String + ' order by 	rtrim(ltrim(dbo.DescHospitalVoto(ad.Domicilio_Cobro))),
											ad.apellido, ad.nombre, re.Numero'


/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String





















GO
/****** Object:  StoredProcedure [dbo].[ListadoApoyoAdherentes_ENERO2003]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO










CREATE          Procedure [dbo].[ListadoApoyoAdherentes_ENERO2003]

	@Cobrador		int = Null,
	@Periodo		char(6)

AS
Declare @C_String 	as nvarchar(4000)


Set @C_String='Select	ad.Adherente,ad.Apellido,ad.Nombre,ad.telefono,
						cc.documentonumero,cc.importe, 
						dbo.CodigoHospitalVoto(ad.Domicilio_Cobro) as CodHOspital,
						rtrim(ltrim(dbo.DescHospitalVoto(ad.Domicilio_Cobro))) as Domicilio_Cobro,
						(Select top 1 B01.Especialidad from Especialidades_adherentes B01 where B01.adherente = ad.Adherente) as Especialidad,
						(Select top 1 B02.Descripcion from Especialidades_adherentes B01 inner join Especialidades B02 on B01.especialidad = B02.especialidad
						where B01.adherente = Ad.Adherente) as DescEspecialidad, re.numero

		From Recibos re
			inner join cuentascorrientes cc
				on re.idTransaccionMes = cc.idTransaccion
			inner join Adherentes ad
				on cc.socio = ad.Adherente
		where cc.entidad = 1 and isnull(cc.Cancelado,0) = 0 and ad.fechabaja is null '


/*
		from CuentasCorrientes cc
			inner join adherentes ad on cc.socio=ad.adherente
			inner join recibos re on cc.idtransaccion = re.idtransaccionmes
		Where Concepto = "MES" and entidad=1 and Importe <> isNull(Cancelado,0) 
		and ad.fechabaja is null '

*/

	if @Cobrador is not null and @Cobrador <> 0
			Set @C_String= @C_String + ' and re.cobrador = ' + convert(char(2),@Cobrador)



	/**** Armo el orden de la consulta ****/
	Set @C_String=@C_String + ' order by 	rtrim(ltrim(dbo.DescHospitalVoto(ad.Domicilio_Cobro))),
											ad.apellido, ad.nombre, re.Numero'


/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String












GO
/****** Object:  StoredProcedure [dbo].[ListadoApoyoDctos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


CREATE           Procedure [dbo].[ListadoApoyoDctos] 
	
	@AnioMes char(6)

AS
Declare @C_String as nvarchar(4000)

Set @C_String = '(Select distinct socios.numedocto as Documento, gru_socios.subnumero,
	socios.tipodocto as TipoDocumento, 
	"580" as Codigo, 
	socios.cuil, 
	((select sum(c.importe) from conceptos_Socios cs
		inner join conceptos c on c.concepto=cs.concepto
		where socios.socio=cs.socio and c.seguro = 0 and cs.fechabaja is null and dbo.toaniomes(cs.fechavigencia)<=' + @Aniomes + ') * dbo.DeudasHospitales("' + @AnioMes + '", socios.socio)) as Importe,
(select count(con.concepto) 
from conceptos con inner join conceptos_socios conso on con.concepto = conso.concepto 
where conso.fechabaja is null and con.seguro = 1 and conso.socio = socios.socio and dbo.toaniomes(conso.fechavigencia)<=' + @Aniomes +') * dbo.DeudasHospitales("' + @AnioMes + '", socios.socio) as Seguro
from socios
	inner join grupos_socios as gru_socios
		on socios.socio = gru_socios.socio
	inner join grupos gru
		on gru.grupo = gru_socios.grupo and gru.modo = 1
	inner join conceptos_socios as con_socios
		on socios.socio = con_socios.socio 
	inner join conceptos co
		on co.concepto = con_socios.concepto 
 where socios.fechabaja is null'
if @aniomes='200305'
Set @C_String = @C_String + ' and (socios.socio<>18473 and socios.socio<>24674 and socios.socio<>24675 and socios.socio<>24676 and socios.socio<>24679 and socios.socio<>24681)'
Set @C_String = @C_String + ' and con_socios.fechabaja is null 
	and socios.cuil <> "" and socios.numedocto<>0
	and dbo.toaniomes(con_socios.fechavigencia)<=' + @Aniomes+ ' 
	and (select count(*) from conceptos_Socios cs
		inner join conceptos c on c.concepto=cs.concepto
		where socios.socio=cs.socio and c.modalidad="P" and cs.fechabaja is null and dbo.toaniomes(cs.fechavigencia)<=' + @Aniomes+ ' )>0 
	and socios.grupo="R" 
group by socios.numedocto, co.seguro, gru_socios.subnumero, socios.tipodocto, gru_socios.subnumero,
	socios.cuil, socios.socio
having co.seguro = "0" '


Set @C_String = @C_String + ' )Order By socios.cuil '

EXEC sp_executesql @C_String
--print @C_String





GO
/****** Object:  StoredProcedure [dbo].[ListadoApoyoDctosGuardias]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




--ListadoApoyoDctosGuardias 200509

CREATE        Procedure [dbo].[ListadoApoyoDctosGuardias]
	
	@AnioMes char(6)

AS
Declare @C_String as nvarchar(4000)

Set @C_String = '(Select distinct socios.numedocto as Documento, Substring(col002,10,2) subnumero,
	socios.tipodocto as TipoDocumento, 
	Substring(col002,12,3) as Codigo, 
	socios.cuil
--	((select sum(c.importe) from conceptos_Socios cs
--		inner join conceptos c on c.concepto=cs.concepto
--		where socios.socio=cs.socio and c.seguro = 0 and cs.fechabaja is null and dbo.toaniomes(cs.fechavigencia)<=' + @Aniomes + ') * dbo.DeudasHospitales("' + @AnioMes + '", socios.socio)) ,
,2.5 
as Importe,
--(select count(con.concepto) 
--from conceptos con inner join conceptos_socios conso on con.concepto = conso.concepto 
--where conso.fechabaja is null and con.seguro = 1 and conso.socio = socios.socio and dbo.toaniomes(conso.fechavigencia)<=' + @Aniomes +') * dbo.DeudasHospitales("' + @AnioMes + '", socios.socio) 
0
as Seguro, c.idcampo
from socios
	inner join grupos_socios as gru_socios
		on socios.socio = gru_socios.socio
	left join grupos gru
		on gru.grupo = gru_socios.grupo and gru.modo = 1
	inner join conceptos_socios as con_socios
		on socios.socio = con_socios.socio 
	inner join c580Guardias_Historico c
		on socios.cuilmuni=c.col001
	inner join conceptos co
		on co.concepto = con_socios.concepto 
where (socios.fechabaja is null  or socios.fechabaja>"' + cast(ltrim(rtrim(@AnioMes)) as char(6)) + '01") 
and periodo=' + cast(ltrim(rtrim(@AnioMes)) as char(6))
/*
if @aniomes='200305'
Set @C_String = @C_String + ' and (socios.socio<>18473 and socios.socio<>24674 and socios.socio<>24675 and socios.socio<>24676 and socios.socio<>24679 and socios.socio<>24681)'
*/

Set @C_String = @C_String + ' group by socios.numedocto, co.seguro, Substring(col002,12,3), socios.tipodocto, Substring(col002,10,2),
	socios.cuil, socios.socio,

col002, c.idcampo -- Tocado para el script de suplentes

having co.seguro = "0" '


Set @C_String = @C_String + ' ) Order By socios.cuil '

EXEC sp_executesql @C_String
--print @C_String







GO
/****** Object:  StoredProcedure [dbo].[ListadoApoyoSocios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


CREATE                Procedure [dbo].[ListadoApoyoSocios] -- ListadoApoyoSocios 8

	@Cobrador		int = Null

AS
Declare @C_String 	as nvarchar(4000)


Set @C_String='Select	ad.socio,ad.Apellido,ad.Nombre,ad.telefono, ad.domicilio, ltrim(rtrim(ad.domicilio_cobro)) as DomicilioCobro, ad.localidad, ltrim(rtrim(ad.localidad_cobro)) as LocalidadCobro,
						cc.documentonumero,cc.importe,re.idtransaccionrecibo,
						(Select top 1 B01.Especialidad from Especialidades_socios B01 where B01.socio = ad.socio) as Especialidad,
						(Select top 1 B02.Descripcion from Especialidades_socios B01 inner join Especialidades B02 on B01.especialidad = B02.especialidad
						where B01.socio = Ad.socio) as DescEspecialidad, re.numero, ("SC" + right(year(re.Fecha),2)) as Serie

				From Recibos re
					inner join cuentascorrientes cc
						on re.idTransaccionMes = cc.idTransaccion
					inner join Socios ad
						on cc.socio = ad.socio
				where cc.entidad = 0 and (cc.cancelado=0 or (re.idtransaccionrecibo<>0 and dbo.toaniomes(re.Fecha)=dbo.toaniomes(getdate()))) and ad.fechabaja is null and isnull(ad.tarjeta,0)=0 '


	if @Cobrador is not null and @Cobrador <> 0
			Set @C_String= @C_String + ' and ad.cobrador = ' + convert(char(2),@Cobrador)

	/**** Armo el orden de la consulta ****/
	Set @C_String=@C_String + ' order by ad.apellido, ad.nombre	'


/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String


















GO
/****** Object:  StoredProcedure [dbo].[ListadoApoyoSocios_ENERO2003]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO









CREATE         Procedure [dbo].[ListadoApoyoSocios_ENERO2003]

	@Cobrador		int = Null

AS
Declare @C_String 	as nvarchar(4000)


Set @C_String='Select	ad.socio,ad.Apellido,ad.Nombre,ad.telefono, ad.domicilio,
						cc.documentonumero,cc.importe, ltrim(IsNull(ho.nombre, "")) as DomicilioCobro,
						(Select top 1 B01.Especialidad from Especialidades_socios B01 where B01.socio = ad.socio) as Especialidad,
						(Select top 1 B02.Descripcion from Especialidades_socios B01 inner join Especialidades B02 on B01.especialidad = B02.especialidad
						where B01.socio = Ad.socio) as DescEspecialidad, re.numero
				from CuentasCorrientes cc
					inner join socios ad on cc.socio=ad.socio
					inner join recibos re on cc.idtransaccion = re.idtransaccionmes
					left join hospitales ho
						on convert(char(10),ho.hospital) = convert(char(10),ad.domicilio_cobro)
				Where Concepto = "MES" and entidad=0 and Importe <> isNull(Cancelado,0) 
				and ad.fechabaja is null '

	if @Cobrador is not null and @Cobrador <> 0
			Set @C_String= @C_String + ' and ad.cobrador = ' + convert(char(2),@Cobrador)

	/**** Armo el orden de la consulta ****/
	Set @C_String=@C_String + ' order by ad.apellido, ad.nombre	'


/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String











GO
/****** Object:  StoredProcedure [dbo].[ListadoArqueoDeCaja]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO






CREATE                          Procedure [dbo].[ListadoArqueoDeCaja] /* 1,'20031212','20031212',1 */

	@Cajero			int = Null,
	@FechaDesde		varchar(10),
	@FechaHasta		varchar(10),
	@Caja			int

AS
Declare @C_String nvarchar(4000)
Declare @boolWhere char(1)

set @boolWhere = 'N'

set @C_String = 'Select Modalidad, ct.descripcion as DescPago, sum(Importe) as Importe,
					vt.cuenta, sucursal, numero, vt.fechaemision as fechacheque, ba.descripcion as DescBanco
				from valoresTesoreria vt
					inner join detalle_operaciones do 
						on Do.idTransaccion=vt.idTransaccion
					inner join Header_operaciones Ho 
						on ho.idOperacion=do.idOperacion
					inner join usuarios_tesoreria ut
						on ut.idUsuario = ho.idOperadorTesoreria
					left join Bancos ba 
						on vt.Banco = ba.Banco 
					inner join Conceptos_Tesoreria CT
						on CT.idConcepto_Tesoreria = vt.idConcepto_Tesoreria 
				where  idTipoTransaccion=2 and isnull(vt.corregido,"N") <> "S" '
	if @Caja<>2
		set @C_String = @C_String + ' and ho.TipodeOperacion <> 90 and ho.TipodeOperacion <> 94 '

	if @Caja=2
		set @C_String = @C_String + ' and (ho.TipodeOperacion = 17 or ho.TipodeOperacion=19) '

	if @Caja <> 0
		set @C_String = @C_String + ' and ut.caja = ' + convert(char(1),@Caja)

	if @Cajero is not null and @Cajero <> 0
		set @C_String =	@C_String + ' and ho.idOperadorTesoreria = ' + rtrim(convert(char(3),@Cajero))

	if @FechaDesde <> ''
		Set @C_String=@C_String + ' AND ho.Fecha >= convert(datetime,"' + @FechaDesde + '",103)'
	
	if @FechaHasta <> ''
		Set @C_String=@C_String + ' AND ho.Fecha <= convert(datetime,"' + @FechaHasta + '",103)'

set @C_String =	@C_String + ' group by Modalidad, ct.descripcion, vt.cuenta, sucursal, numero, vt.fechaemision, ba.descripcion '

if @caja<>2 
	Begin

	set @C_String =	@C_String + ' Union 

	Select Modalidad, ct.descripcion as DescPago, -sum(vt.Importe) as Importe,
						vt.cuenta, sucursal, numero, vt.fechaemision as fechacheque, "Reversion" as DescBanco
	From Header_Operaciones ho
		inner join Detalle_Operaciones do on ho.idOperacion = do.idOperacion 
		Inner join aplicacionesCuentasCorrientes acc on do.idtransaccion=acc.idtransaccion
		inner join ValoresTesoreria vt on vt.idTransaccionorigen = Acc.idTransaccionCancelada
		inner join usuarios_tesoreria ut
			on ut.idUsuario = ho.idOperadorTesoreria
						left join Bancos ba 
							on vt.Banco = ba.Banco 
						inner join Conceptos_Tesoreria CT
							on CT.idConcepto_Tesoreria = vt.idConcepto_Tesoreria 
					where vt.corregido <> "S" and ho.TipodeOperacion <> 90 and ho.TipodeOperacion <> 94 '
	
		if @Caja <> 0
			set @C_String = @C_String + ' and ut.caja = ' + convert(char(1),@Caja)
	
		if @Cajero is not null and @Cajero <> 0
			set @C_String =	@C_String + ' and ho.idOperadorTesoreria = ' + rtrim(convert(char(3),@Cajero))

		if @FechaDesde <> ''
			Set @C_String=@C_String + ' AND ho.Fecha >= convert(datetime,"'+@FechaDesde+'",103)'
		
		if @FechaHasta <> ''
			Set @C_String=@C_String + ' AND ho.Fecha <= convert(datetime,"'+@FechaHasta+'",103)'
		set @C_String =	@C_String + ' group by Modalidad, ct.descripcion, vt.cuenta, sucursal, numero, vt.fechaemision, ba.descripcion'
	end

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String






GO
/****** Object:  StoredProcedure [dbo].[ListadoAsistencia]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE Procedure [dbo].[ListadoAsistencia]
(
	@idCurso	int
)	
as
Select l.idAlumno,Numero,Nyap from listas l
inner join alumnos a
on l.idalumno=a.idalumno
where idHorario=150
order by nyap


GO
/****** Object:  StoredProcedure [dbo].[ListadoBajasConceptos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


CREATE          Procedure [dbo].[ListadoBajasConceptos] 
	@Concepto char(3)='F18',
	@ConceptoHasta char(3)='F18',
	@FechaDesde char(8)='20060701',
	@FechaHasta char(8)='20060731',
	@CobradorDesde int = 0,
	@CobradorHasta int = 0,
	@Activos int = 1,
	@Entidad int=1, 
	@Matricula int=1, --1:SI, 0:NO
	@Cuit int=1, --1:SI, 0:NO
	@Especialidad int=999, --999:TODOS, 1:MEDICOS, 0:NO MEDICOS
	@Cambios	char(1)='N',
	@igrupo	Char(1)='S',
	@Resumen Char(1)='N'
as

Declare @C_String as nvarchar(4000)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

if @Entidad = 1
	Begin
	Set @C_String='Select 1 as Cantidad, ad.NroMatricula, ad.adherente as socio, ad.Apellido, ad.Nombre, ca.FechaAlta, ca.FechaBaja,
				mb.nombre as MotivoBaja, ca.concepto,case 
when len(ltrim(rtrim(cuil)))=0 then cuil
else substring(cast(cuil as char(11)),1,2)+"-"+substring(cast(cuil as char(11)),3,8)
+ "-" +substring(cast(cuil as char(11)),11,1) end cuil, '  
/*if @igrupo='N'
	Set @C_String= @C_String + '1 cobrador,"Completo" nombre, '
else*/
	Set @C_String= @C_String + 'co.cobrador,co.nombre,'


	Set @C_String= @C_String + 'mb.Motivo, ' + convert(char(1),@Activos) + 'as Activos,rtrim(ltrim(dbo.DescHospitalVoto(ad.Domicilio_Cobro))) as DomicCobro,
				(Select top 1 es.Medico from Especialidades_Adherentes esad inner join Especialidades es on esad.especialidad = es.especialidad
				where esad.adherente = ad.Adherente) as Medico

	 				from Adherentes ad
						inner join Conceptos_adherentes ca 
							on ca.adherente = ad.adherente 
						left join Cobradores co
							on co.cobrador = ad.cobrador
						left join MotivosBaja mb
							on mb.motivo = ca.MotivoBaja '
	end
else
	Begin

	Set @C_String='Select 1 as Cantidad, ad.NroMatricula, ad.socio, ad.Apellido, ad.Nombre, ca.FechaAlta, ca.FechaBaja,
				mb.nombre as MotivoBaja, ca.concepto,case 
when len(ltrim(rtrim(cuil)))=0 then cuil
else substring(cast(cuil as char(11)),1,2)+"-"+substring(cast(cuil as char(11)),3,8)
+ "-" +substring(cast(cuil as char(11)),11,1) end cuil,'
/*if @igrupo='N'
	Set @C_String= @C_String + '1 cobrador,"Completo" nombre,'
else*/
	Set @C_String= @C_String + 'co.cobrador,co.nombre,'


	Set @C_String= @C_String + 'ad.lugarvoto, hv.nombre as DescLugarVoto, mb.Motivo, ' +  
				convert(char(1),@Activos) + 'as Activos,rtrim(ltrim(dbo.DescHospitalVoto(ad.Domicilio_Cobro))) as DomicCobro,
				(Select top 1 es.Medico from Especialidades_Socios esoc inner join Especialidades es on esoc.especialidad = es.especialidad
				where esoc.Socio = ad.Socio) as Medico

	 				from socios ad
						inner join Conceptos_socios ca 
							on ca.socio = ad.socio
						left join Cobradores co
							on co.cobrador = ad.cobrador
						left join MotivosBaja mb
							on mb.motivo = ca.MotivoBaja 
						left join hospitalesvoto hv
							on hv.hospitalvoto = ad.lugarvoto '
	end

	if @Entidad = 1 
		Set @C_String= @C_String + ' where ca.concepto= "' + convert(char(3),@Concepto) + '"'
	else
		begin 
			Set @C_String= @C_String + ' where ca.concepto >= "' + convert(char(3),@Concepto) + '"'
	
			if @ConceptoHasta <> "0"
				Set @C_String= @C_String + ' and ca.concepto <= "' + convert(char(3),@ConceptoHasta) + '"'
		end 


	if @Activos = 1 
		-----------------
		----- ALTAS -----
		-----------------
		begin
			if @FechaDesde <> ''
				Set @C_String= @C_String + ' and  ca.FechaAlta >= "' + @FechaDesde + '"'
		
			if @FechaHasta <> ''
				Set @C_String= @C_String + ' and  ca.FechaAlta <= "' + @FechaHasta  + '"'

			--- Verifica que NO sean altas por cambio de concepto ---
			if @Entidad = 0
				begin
					if @cambios='N'
						Begin 
							Set @C_String= @C_String + ' and 
							(select count(*) from conceptos_socios cs where cs.socio = ad.socio
							and cs.fechabaja is not null and cs.fechabaja>= "' + @FechaDesde + '" 
								and cs.fechabaja <= "' + @FechaHasta + '"'
			
		 					Set @C_String= @C_String + ' and (cs.motivobaja = 17 or cs.motivobaja = 5)'
					
		 					Set @C_String= @C_String + ') = 0 ' 
					end	
				end

		end 
	else
		-----------------
		----- BAJAS -----
		-----------------
		begin

			if @cambios='N'
				Begin 

					Set @C_String= @C_String + ' and ca.fechabaja is not null  and mb.Motivo <> 17 and mb.Motivo <> 5 '

				end	

			if @FechaDesde <> ''
				Set @C_String= @C_String + ' and  ca.FechaBaja >= "' + @FechaDesde + '"'
		
			if @FechaHasta <> ''
				Set @C_String= @C_String + ' and  ca.FechaBaja <= "' + @FechaHasta  + '"'

		end

	-- COBRADOR DESDE
	if @CobradorDesde is not null and @CobradorDesde <> 0
		Set @C_String= @C_String + ' and  ad.Cobrador >= ' + rtrim(convert(char(5),@CobradorDesde))

	-- COBRADOR HASTA
	if @CobradorHasta is not null and @CobradorHasta <> 0
		Set @C_String= @C_String + ' and  ad.Cobrador <= ' + rtrim(convert(char(5),@CobradorHasta))


	-- MEDICOS, NO MEDICOS
	if @Especialidad is not null and @Especialidad <> 999
		begin
			if @Entidad = 0
				Set @C_String= @C_String + ' and (Select top 1 es.Medico from Especialidades_Socios esoc inner join Especialidades es on esoc.especialidad = es.especialidad where esoc.Socio = ad.Socio) = ' + convert(char(1),@Especialidad)
			else
				Set @C_String= @C_String + ' and (Select top 1 es.Medico from Especialidades_Adherentes esad inner join Especialidades es on esad.especialidad = es.especialidad where esad.adherente = ad.Adherente) = ' + convert(char(1),@Especialidad)
		end		


	/**** Armo el orden de la consulta ****/
	if @Entidad = 1
		Set @C_String=@C_String + ' Order by ad.Cobrador, case when (ad.cobrador=1 or ad.cobrador=7 or ad.cobrador=8) then rtrim(ltrim(dbo.DescHospitalVoto(ad.Domicilio_Cobro))) else "" end,ad.apellido, ad.nombre'
	else
		Set @C_String=@C_String + ' Order by hv.nombre,ad.apellido,ca.concepto,ad.nombre'



/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
-- Print @C_String











GO
/****** Object:  StoredProcedure [dbo].[ListadoBajasConceptosAgrupado]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO





CREATE Procedure [dbo].[ListadoBajasConceptosAgrupado]
(	@Concepto char(3)='C06',
	@ConceptoHasta char(3)='F51',
	@FechaDesde char(8)='20060701',
	@FechaHasta char(8)='20060731',
	@CobradorDesde int = 0,
	@CobradorHasta int = 0,
	@Activos int = 0,
	@Entidad int=0, 
	@Matricula int=1, --1:SI, 0:NO
	@Cuit int=1, --1:SI, 0:NO
	@Especialidad int=999, --999:TODOS, 1:MEDICOS, 0:NO MEDICOS
	@Cambios	char(1)='S',
	@igrupo	Char(1)='S',
	@Resumen Char(1)='N' )
as

Declare @C_String as nvarchar(4000)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

if @Entidad = 1
	Begin
	Set @C_String='Select Distinct ad.adherente as socio, mb.nombre as MotivoBaja, co.cobrador,co.nombre,rtrim(ltrim(dbo.DescHospitalVoto(ad.Domicilio_Cobro))) as DomicCobro,mb.Motivo

	 				from Adherentes ad
						inner join Conceptos_adherentes ca 
							on ca.adherente = ad.adherente 
						left join Cobradores co
							on co.cobrador = ad.cobrador
						left join MotivosBaja mb
							on mb.motivo = ca.MotivoBaja '
	end
else
	Begin

	Set @C_String='Select Distinct ad.socio,mb.nombre as MotivoBaja, co.cobrador,co.nombre,rtrim(ltrim(dbo.DescHospitalVoto(ad.Domicilio_Cobro))) as DomicCobro,mb.Motivo

	 				from socios ad
						inner join Conceptos_socios ca 
							on ca.socio = ad.socio
						left join Cobradores co
							on co.cobrador = ad.cobrador
						left join MotivosBaja mb
							on mb.motivo = ca.MotivoBaja 
						left join hospitalesvoto hv
							on hv.hospitalvoto = ad.lugarvoto '
	end

	if @Entidad = 1 
		Set @C_String= @C_String + ' where ca.concepto= "' + convert(char(3),@Concepto) + '"'
	else
		begin 
			Set @C_String= @C_String + ' where ca.concepto >= "' + convert(char(3),@Concepto) + '"'
	
			if @ConceptoHasta <> "0"
				Set @C_String= @C_String + ' and ca.concepto <= "' + convert(char(3),@ConceptoHasta) + '"'
		end 


	if @Activos = 1 
		-----------------
		----- ALTAS -----
		-----------------
		begin
			if @FechaDesde <> ''
				Set @C_String= @C_String + ' and  ca.FechaAlta >= "' + @FechaDesde + '"'
		
			if @FechaHasta <> ''
				Set @C_String= @C_String + ' and  ca.FechaAlta <= "' + @FechaHasta  + '"'

			--- Verifica que NO sean altas por cambio de concepto ---
			if @Entidad = 0
				begin
					if @cambios='N'
						Begin 
							Set @C_String= @C_String + ' and 
							(select count(*) from conceptos_socios cs where cs.socio = ad.socio
							and cs.fechabaja is not null and cs.fechabaja>= "' + @FechaDesde + '" 
								and cs.fechabaja <= "' + @FechaHasta + '"'
			
		 					Set @C_String= @C_String + ' and (cs.motivobaja = 17 or cs.motivobaja = 5)'
					
		 					Set @C_String= @C_String + ') = 0 ' 
					end	
				end

		end 
	else
		-----------------
		----- BAJAS -----
		-----------------
		begin

			if @cambios='N'
				Begin 

					Set @C_String= @C_String + ' and ca.fechabaja is not null  and mb.Motivo <> 17 and mb.Motivo <> 5 '

				end	

			if @FechaDesde <> ''
				Set @C_String= @C_String + ' and  ca.FechaBaja >= "' + @FechaDesde + '"'
		
			if @FechaHasta <> ''
				Set @C_String= @C_String + ' and  ca.FechaBaja <= "' + @FechaHasta  + '"'

		end

	-- COBRADOR DESDE
	if @CobradorDesde is not null and @CobradorDesde <> 0
		Set @C_String= @C_String + ' and  ad.Cobrador >= ' + rtrim(convert(char(5),@CobradorDesde))

	-- COBRADOR HASTA
	if @CobradorHasta is not null and @CobradorHasta <> 0
		Set @C_String= @C_String + ' and  ad.Cobrador <= ' + rtrim(convert(char(5),@CobradorHasta))


	-- MEDICOS, NO MEDICOS
	if @Especialidad is not null and @Especialidad <> 999
		begin
			if @Entidad = 0
				Set @C_String= @C_String + ' and (Select top 1 es.Medico from Especialidades_Socios esoc inner join Especialidades es on esoc.especialidad = es.especialidad where esoc.Socio = ad.Socio) = ' + convert(char(1),@Especialidad)
			else
				Set @C_String= @C_String + ' and (Select top 1 es.Medico from Especialidades_Adherentes esad inner join Especialidades es on esad.especialidad = es.especialidad where esad.adherente = ad.Adherente) = ' + convert(char(1),@Especialidad)
		end		


	/**** Armo el orden de la consulta ****/
	Set @C_String=@C_String + ' Order by mb.nombre'



/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
-- Print @C_String










GO
/****** Object:  StoredProcedure [dbo].[ListadoBajasConceptosMotivos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO







CREATE  Procedure [dbo].[ListadoBajasConceptosMotivos] 
	@Concepto char(3)='F10',
	@ConceptoHasta char(3)='F10',
	@FechaDesde char(8)='20050601',
	@FechaHasta char(8)='20050630',
	@CobradorDesde int = NULL,
	@CobradorHasta int = NULL,
	@Activos int = 0,
	@Entidad int=1, 
	@Matricula int=1, --1:SI, 0:NO
	@Cuit int=1, --1:SI, 0:NO
	@Especialidad int=999, --999:TODOS, 1:MEDICOS, 0:NO MEDICOS
	@Cambios	char(1)='S',
	@igrupo	Char(1)='S'
as



Declare @C_String as nvarchar(4000)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

if @Entidad = 1
	Begin
	Set @C_String='Select Distinct ad.adherente,mb.nombre
	 				from Adherentes ad
						inner join Conceptos_adherentes ca 
							on ca.adherente = ad.adherente 
						left join Cobradores co
							on co.cobrador = ad.cobrador
						left join MotivosBaja mb
							on mb.motivo = ca.MotivoBaja '
	end
else
	Begin

	Set @C_String='Select Distinct ad.socio adherente,mb.nombre
	 				from socios ad
						inner join Conceptos_socios ca 
							on ca.socio = ad.socio
						left join Cobradores co
							on co.cobrador = ad.cobrador
						left join MotivosBaja mb
							on mb.motivo = ca.MotivoBaja 
						left join hospitalesvoto hv
							on hv.hospitalvoto = ad.lugarvoto '
	end

	if @Entidad = 1 
		Set @C_String= @C_String + ' where ca.concepto= "' + convert(char(3),@Concepto) + '"'
	else
		begin 
			Set @C_String= @C_String + ' where ca.concepto >= "' + convert(char(3),@Concepto) + '"'
	
			if @ConceptoHasta <> "0"
				Set @C_String= @C_String + ' and ca.concepto <= "' + convert(char(3),@ConceptoHasta) + '"'
		end 


	if @Activos = 1 
		-----------------
		----- ALTAS -----
		-----------------
		begin
			if @FechaDesde <> ''
				Set @C_String= @C_String + ' and  ca.FechaAlta >= "' + @FechaDesde + '"'
		
			if @FechaHasta <> ''
				Set @C_String= @C_String + ' and  ca.FechaAlta <= "' + @FechaHasta  + '"'

			--- Verifica que NO sean altas por cambio de concepto ---
			if @Entidad = 0
				begin
					if @cambios='N'
						Begin 
							Set @C_String= @C_String + ' and 
							(select count(*) from conceptos_socios cs where cs.socio = ad.socio
							and cs.fechabaja is not null and cs.fechabaja>= "' + @FechaDesde + '" 
								and cs.fechabaja <= "' + @FechaHasta + '"'
			
		 					Set @C_String= @C_String + ' and (cs.motivobaja = 17 or cs.motivobaja = 5)'
					
		 					Set @C_String= @C_String + ') = 0 ' 
					end	
				end

		end 
	else
		-----------------
		----- BAJAS -----
		-----------------
		begin

			if @cambios='N'
				Begin 

					Set @C_String= @C_String + ' and ca.fechabaja is not null  and mb.Motivo <> 17 and mb.Motivo <> 5 '

				end	

			if @FechaDesde <> ''
				Set @C_String= @C_String + ' and  ca.FechaBaja >= "' + @FechaDesde + '"'
		
			if @FechaHasta <> ''
				Set @C_String= @C_String + ' and  ca.FechaBaja <= "' + @FechaHasta  + '"'

		end

	-- COBRADOR DESDE
	if @CobradorDesde is not null and @CobradorDesde <> 0
		Set @C_String= @C_String + ' and  ad.Cobrador >= ' + rtrim(convert(char(5),@CobradorDesde))

	-- COBRADOR HASTA
	if @CobradorHasta is not null and @CobradorHasta <> 0
		Set @C_String= @C_String + ' and  ad.Cobrador <= ' + rtrim(convert(char(5),@CobradorHasta))


	-- MEDICOS, NO MEDICOS
	if @Especialidad is not null and @Especialidad <> 999
		begin
			if @Entidad = 0
				Set @C_String= @C_String + ' and (Select top 1 es.Medico from Especialidades_Socios esoc inner join Especialidades es on esoc.especialidad = es.especialidad where esoc.Socio = ad.Socio) = ' + convert(char(1),@Especialidad)
			else
				Set @C_String= @C_String + ' and (Select top 1 es.Medico from Especialidades_Adherentes esad inner join Especialidades es on esad.especialidad = es.especialidad where esad.adherente = ad.Adherente) = ' + convert(char(1),@Especialidad)
		end		


	/**** Armo el orden de la consulta ****/
		Set @C_String=@C_String + ' Order by mb.nombre'



/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
-- Print @C_String




GO
/****** Object:  StoredProcedure [dbo].[ListadoBajasEstadisticas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


--ListadoBajasEstadisticas '','','20060601','20060630',null,null,0,0


CREATE             Procedure [dbo].[ListadoBajasEstadisticas]
	@Concepto char(3)='F01',
	@ConceptoHasta char(3)='F51',
	@FechaDesde char(8)='20060601',
	@FechaHasta char(8)='20060630',
	@CobradorDesde int = NULL,
	@CobradorHasta int = NULL,
	@Activos int = NULL,
	@Entidad int=1
as

Declare @C_String as nvarchar(4000)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

if @Entidad = 1
	Set @C_String='	Select mb.nombre as MotivoBaja, co.cobrador, co.nombre, mb.Motivo 
	 				from Adherentes ad
						inner join Conceptos_adherentes ca 
							on ca.adherente = ad.adherente 
						left join Cobradores co
							on co.cobrador = ad.cobrador
						left join MotivosBaja mb
							on mb.motivo = ca.MotivoBaja '
else
	Set @C_String='Select mb.nombre as MotivoBaja, co.cobrador, co.nombre, ad.lugarvoto, 
							hv.nombre as DescLugarVoto, mb.Motivo 
	 				from socios ad
						inner join Conceptos_socios ca 
							on ca.socio = ad.socio
						left join Cobradores co
							on co.cobrador = ad.cobrador
						left join MotivosBaja mb
							on mb.motivo = ca.MotivoBaja 
						left join hospitalesvoto hv
							on hv.hospitalvoto = ad.lugarvoto '

	if @Entidad = 1 
		Set @C_String= @C_String + ' where ca.concepto= "' + convert(char(3),@Concepto) + '"'
	else
		begin 
			Set @C_String= @C_String + ' where ca.concepto >= "' + convert(char(3),@Concepto) + '"'
	
			if @ConceptoHasta <> "0"
				Set @C_String= @C_String + ' and ca.concepto <= "' + convert(char(3),@ConceptoHasta) + '"'
		end 

/*
******	NUEVA FORMA	*************

	if @Activos = 1
		begin
			--ALTAS
			if @FechaDesde <> ''
				Set @C_String= @C_String + ' and  ad.FechaIngreso >= "' + @FechaDesde + '"'
		
			if @FechaHasta <> ''
				Set @C_String= @C_String + ' and  ad.FechaIngreso <= "' + @FechaHasta  + '"'
		end 
	else
		begin
			--BAJAS
			Set @C_String= @C_String + ' and ca.fechabaja is not null and mb.Motivo <> 17 '

			if @FechaDesde <> ''
				Set @C_String= @C_String + ' and  ad.FechaBaja >= "' + @FechaDesde + '"'
		
			if @FechaHasta <> ''
				Set @C_String= @C_String + ' and  ad.FechaBaja <= "' + @FechaHasta  + '"'

		end

*/

	if @Activos = 1
		begin
			--ALTAS
			if @FechaDesde <> ''
				Set @C_String= @C_String + ' and  ca.FechaAlta >= "' + @FechaDesde + '"'
		
			if @FechaHasta <> ''
				Set @C_String= @C_String + ' and  ca.FechaAlta <= "' + @FechaHasta  + '"'
		end 
	else
		begin
			--BAJAS
			Set @C_String= @C_String + ' and ca.fechabaja is not null and mb.Motivo <> 17 '

			if @FechaDesde <> ''
				Set @C_String= @C_String + ' and  ca.FechaBaja >= "' + @FechaDesde + '"'
		
			if @FechaHasta <> ''
				Set @C_String= @C_String + ' and  ca.FechaBaja <= "' + @FechaHasta  + '"'

		end


	if @CobradorDesde is not null and @CobradorDesde <> 0
		Set @C_String= @C_String + ' and  ad.Cobrador >= ' + rtrim(convert(char(5),@CobradorDesde))

	if @CobradorHasta is not null and @CobradorHasta <> 0
		Set @C_String= @C_String + ' and  ad.Cobrador <= ' + rtrim(convert(char(5),@CobradorHasta))


/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String





GO
/****** Object:  StoredProcedure [dbo].[ListadoCertificadosCobradores]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO











CREATE                  Procedure [dbo].[ListadoCertificadosCobradores]
	@Concepto char(3),
	@FechaDesde char(8),
	@FechaHasta char(8),
	@Cobrador int = NULL,
	@Especialidad int, --999:TODOS, 1:MEDICOS, 0:NO MEDICOS
	@Entidad int,
	@Orden int -- 0: Alfabeto, 1: Cobrador
as


Declare @C_String as nvarchar(4000)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

	Set @C_String='Select ad.Adherente as Codigo,ad.TipoMatricula, tm.descripcion as DescMatricula, ad.NroMatricula, 
							ad.Apellido, ad.Nombre, ad.Cobrador, td.descripcion as TipoDocumento, ad.numedocto, '

	--Pone le lugar de cobro para los cobradores 1 y 7 solamente
	if @Cobrador is not null and @Cobrador <> 0 and (@Cobrador = 1 or @Cobrador = 7)
		Set @C_String= @C_String + ' dbo.CodigoHospitalVoto(ad.Domicilio_Cobro) as CodHospital,
									rtrim(ltrim(dbo.DescHospitalVoto(ad.Domicilio_Cobro))) as Domicilio_cobro '
	else
		Set @C_String= @C_String + ' 0 as CodHospital,
									"" as Domicilio_cobro '

	Set @C_String= @C_String + ' from Adherentes ad
								left join TiposMatricula tm
									on tm.tipomatricula = ad.tipomatricula
								inner join Conceptos_adherentes ca 
									on ca.adherente = ad.adherente 
								left join TiposDocumento td
									on td.tipodocto = ad.tipodocto
								where (ca.fechabaja is null or ca.fechabaja > "' + @FechaHasta + '")
									and ca.FechaVigencia <= "' + @FechaHasta + '"'

	----- ALTAS -----
	if @FechaDesde <> ''
		Set @C_String= @C_String + ' and  ca.FechaAlta >= "' + @FechaDesde + '"'

	if @FechaHasta <> ''
		Set @C_String= @C_String + ' and  ca.FechaAlta <= "' + @FechaHasta  + '"'

	if @Concepto <> '99' and @Concepto <> '999' 
		Set @C_String= @C_String + ' and  ca.Concepto ="' + @Concepto + '"'

	if @Concepto = '99' -- Para concept F10 y F13
		Set @C_String= @C_String + ' and  ca.Concepto = "F10" or ca.Concepto = "F13" '

	if @Concepto = '999' 	
		Set @C_String= @C_String + ' and  (ca.Concepto = "F10" or ca.Concepto = "F11" or ca.Concepto = "F12" or ca.Concepto = "F13") '


	if @Cobrador is not null and @Cobrador <> 0
		Set @C_String= @C_String + ' and  ad.Cobrador = ' + rtrim(convert(char(5),@Cobrador))


	-- MEDICOS, NO MEDICOS
	if @Especialidad is not null and @Especialidad <> 999
		Set @C_String= @C_String + ' and (Select top 1 es.Medico from Especialidades_Adherentes esad inner join Especialidades es on esad.especialidad = es.especialidad where esad.adherente = ad.Adherente) = ' + convert(char(1),@Especialidad)


	/**** Armo el orden de la consulta ****/
	if @Orden = 0
		--Alfabeto
		Set @C_String=@C_String + ' Order by ad.apellido, ad.nombre'
	else
		--Cobrador
		set @C_String =	@C_String + ' order by ad.Cobrador, rtrim(ltrim(dbo.DescHospitalVoto(ad.Domicilio_Cobro))) '


/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String






















GO
/****** Object:  StoredProcedure [dbo].[ListadoCertificadosEspeciales]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO












CREATE                   Procedure [dbo].[ListadoCertificadosEspeciales]
	@Concepto char(3),
	@FechaDesde char(8),
	@FechaHasta char(8),
	@Cobrador int = NULL,
	@Especialidad int, --999:TODOS, 1:MEDICOS, 0:NO MEDICOS
	@Entidad int
as

Declare @C_String as nvarchar(4000)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

if @Entidad = 0 
begin
	Set @C_String='Select ad.Socio as Codigo,ad.TipoMatricula, tm.descripcion as DescMatricula, ad.NroMatricula, 
							ad.Apellido, ad.Nombre, ad.Cobrador, td.descripcion as TipoDocumento, ad.numedocto
 					from socios ad
					left join TiposMatricula tm
						on tm.tipomatricula = ad.tipomatricula
					left join TiposDocumento td
						on td.tipodocto = ad.tipodocto
					where 
					(select count(*) from conceptos_socios cs1
					where (cs1.fechabaja is null or cs1.fechabaja > "' + @FechaHasta + '")
					and cs1.FechaVigencia <= "' + @FechaHasta + '"
					and cs1.socio = ad.socio '

	if @Concepto <> '0' 
		Set @C_String= @C_String + ' and  cs1.Concepto >="' + @Concepto + '"'


Set @C_String= @C_String + ') <> 0 '

end
else
begin
	Set @C_String='

Select ad.Adherente as Codigo,ad.NroMatricula, ad.Apellido, ad.Nombre
from Certificados_Adherentes ca
inner join Adherentes ad
on ad.adherente = ca.socio
inner join Conceptos_adherentes cad 
on cad.adherente = ad.adherente 
where (ca.fecha >= "' + @FechaDesde + '" or ca.fecha <= "' + @FechaHasta + '")'

	if @Concepto <> '99' and @Concepto <> '999' 
		Set @C_String= @C_String + ' and  cad.Concepto ="' + @Concepto + '"'

	if @Concepto = '99' -- Para concept F10 y F13
		Set @C_String= @C_String + ' and  cad.Concepto = "F10" or cad.Concepto = "F13" '

	if @Concepto = '999' 	
		Set @C_String= @C_String + ' and  cad.Concepto = "F10" or cad.Concepto = "F11" or cad.Concepto = "F12" or cad.Concepto = "F13" '
end

	--Filtros para Socios/Adherentes
	if @Cobrador is not null and @Cobrador <> 0
		Set @C_String= @C_String + ' and  ad.Cobrador >= ' + rtrim(convert(char(5),@Cobrador))


	-- MEDICOS, NO MEDICOS
	if @Especialidad is not null and @Especialidad <> 999
		begin
			if @Entidad = 0
				Set @C_String= @C_String + ' and (Select top 1 es.Medico from Especialidades_Socios esoc inner join Especialidades es on esoc.especialidad = es.especialidad where esoc.Socio = ad.Socio) = ' + convert(char(1),@Especialidad)
			else
				Set @C_String= @C_String + ' and (Select top 1 es.Medico from Especialidades_Adherentes esad inner join Especialidades es on esad.especialidad = es.especialidad where esad.adherente = ad.Adherente) = ' + convert(char(1),@Especialidad)
		end		



/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String























GO
/****** Object:  StoredProcedure [dbo].[ListadoClientesProveedores]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO



--Select * from Clientes

--ListadoClientesProveedores null,null,'P'

CREATE   Procedure [dbo].[ListadoClientesProveedores]

	@CodigoDesde		int = Null, 
	@CodigoHasta		int = Null, 
	@Tipo			char(1)	
 
AS
Declare @C_String 	as nvarchar(4000)
Declare @Base 		as varchar(20)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

/****************************************/
/* 	Armo campos segun entidad	*/
/****************************************/
if @Tipo = 'P'
	Set @Base = 'Proveedores'
else
	Set @Base = 'Clientes'

Set @C_String='(Select 	A01.codigo, A01.razonsocial, " " contacto, A01.domicilio,
			A01.Localidad, A03.descripcion as Provincia,
			A01.codigopostal cpostal, A01.telefono1 telefono, A04.descripcion as Cate_Iva, A01.cuit, A01.cuenta,c.Descripcion dCuenta
		from ' + @Base + ' A01
/*			left join localidades A02
				on A01.localidad = A02.localidad */
			left join provincias A03
				on A01.idprovincia = A03.provincia
			Left join Categorias_Iva A04
				on A01.civa = A04.idCiva 
			Left join Cuentas C
				on A01.cuenta = C.Cuenta'

	/**** Armo las condiciones ****/
	if @CodigoDesde is not null and @CodigoDesde <> 0
		begin
			set @boolWhere = 'S'	
			Set @C_String= @C_String + ' where  A01.codigo >= ' + convert(char(10),@CodigoDesde)
		end
	if @CodigoHasta is not null and @CodigoHasta <> 0
		begin
			if @boolWhere = 'S'
				Set @C_String= @C_String + ' and  A01.codigo <= ' + convert(char(10),@CodigoHasta)			
			else
				Set @C_String= @C_String + ' where  A01.codigo <= ' + convert(char(10),@CodigoHasta)
		end

	/**** Armo el orden de la consulta ****/
	Set @C_String=@C_String + ') Order by A01.razonsocial'

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String



GO
/****** Object:  StoredProcedure [dbo].[ListadoCompanias]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE                             Procedure [dbo].[ListadoCompanias] -- ListadoCompanias 1,'F10','F10','20040315'
	@Entidad int,
	@Concepto char(3),
	@ConceptoHasta char(3),
	@FechaHasta char(8),
	@CobradorDesde int = NULL,
	@CobradorHasta int = NULL,
	@Orden int=0, -- 0: Alfabeto, 1: Cobrador
	@Agrupado	char(1)='N'
as

Declare @C_String as nvarchar(4000)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

if @Entidad = 0 
begin
	Set @C_String='Select ad.Socio as Codigo,ad.TipoMatricula, tm.descripcion as DescMatricula, ad.NroMatricula, 
case 
when len(ltrim(rtrim(cuil)))=0 then cuil
else substring(cast(cuil as char(11)),1,2)+"-"+substring(cast(cuil as char(11)),3,8)
+ "-" +substring(cast(cuil as char(11)),11,1) end cuil,
	ad.Apellido, ad.Nombre, case when ' + cast(@Orden as char(1)) + ' = 0 then 0 else ad.Cobrador end as cobrador, td.descripcion as TipoDocumento, ad.numedocto,case when (ad.cobrador=1 or ad.cobrador=7 or ad.cobrador=8) and ' + cast(@Orden as char(1)) + ' = 2 then rtrim(ltrim(dbo.DescHospitalVoto(ad.Domicilio_Cobro))) else "" end as Domicilio_Cobro 
	from socios ad left join Cobradores cb on ad.cobrador=cb.cobrador 
	left join TiposMatricula tm on tm.tipomatricula = ad.tipomatricula
	left join TiposDocumento td on td.tipodocto = ad.tipodocto
	where (select count(*) from conceptos_socios ca
	where (ca.fechabaja is null or ca.fechabaja > "' + @FechaHasta + '")
	and ca.FechaVigencia <= "' + @FechaHasta + '"
	and ca.socio = ad.socio '
	
	if @Concepto <> '0' and @Concepto<>'99' and @Concepto<>'999' 
		Set @C_String= @C_String + ' and  ca.Concepto >="' + @Concepto + '"'

	if @ConceptoHasta <> '0' and @ConceptoHasta<>'99' and @ConceptoHasta<>'999' 
		Set @C_String= @C_String + ' and  ca.Concepto <="' + @ConceptoHasta + '"'

	if @Concepto = '99' -- Para concept F10 y F13
			Set @C_String= @C_String + ' and  (ca.Concepto = "C06" or ca.Concepto = "F01" or ca.Concepto = "F02" or ca.Concepto = "F03") '

	if @Concepto = '999' -- Para concept F10 y F13
			Set @C_String= @C_String + ' and  (ca.Concepto = "F04" or ca.Concepto = "F05" or ca.Concepto = "F06" or ca.Concepto = "F07" or ca.Concepto = "F09" or ca.Concepto = "F51" ) '


Set @C_String= @C_String + ') <> 0 '

end
else
begin
	Set @C_String='Select ad.Adherente as Codigo,ad.TipoMatricula, tm.descripcion as DescMatricula, ad.NroMatricula, 
case 
when len(ltrim(rtrim(cuil)))=0 then cuil
else substring(cast(cuil as char(11)),1,2)+"-"+substring(cast(cuil as char(11)),3,8)
+ "-" +substring(cast(cuil as char(11)),11,1) end cuil,
	ad.Apellido, ad.Nombre, case when ' + cast(@Orden as char(1)) + ' = 0 then 0 else ad.Cobrador end as cobrador, td.descripcion as TipoDocumento, ad.numedocto,case when (ad.cobrador=1 or ad.cobrador=7 or ad.cobrador=8) and ' + cast(@Orden as char(1)) + ' = 2 then rtrim(ltrim(dbo.DescHospitalVoto(ad.Domicilio_Cobro))) else "" end as Domicilio_Cobro 
	from Adherentes ad
	left join Cobradores cb
	on ad.cobrador=cb.cobrador
					left join TiposMatricula tm
						on tm.tipomatricula = ad.tipomatricula
					left join TiposDocumento td
						on td.tipodocto = ad.tipodocto
					where 
					(select count(*) from conceptos_Adherentes ca
					where (ca.fechabaja is null or ca.fechabaja > "' + @FechaHasta + '")
					and ca.FechaVigencia <= "' + @FechaHasta + '"
					and ca.Adherente = ad.Adherente '
if @Agrupado='S'
	begin
		if @Concepto <> 'F10' and @Concepto <> 'F11' and @Concepto <> 'F12' and @Concepto <> 'F18' and @Concepto <> '999' 
			Set @C_String= @C_String + ' and  ca.Concepto ="' + @Concepto + '"'
	
		if @Concepto = 'F10' -- Para concept F10 y F13
			Set @C_String= @C_String + ' and  (ca.Concepto = "F10" or ca.Concepto = "F13" or  ca.Concepto = "F14") '
	
		if @Concepto = 'F11' -- Para concept F10 y F13
			Set @C_String= @C_String + ' and  (ca.Concepto = "F11" or ca.Concepto = "F16") '
	
		if @Concepto = 'F12' -- Para concept F10 y F13
			Set @C_String= @C_String + ' and  (ca.Concepto = "F12" or ca.Concepto = "F15") '

		if @Concepto = 'F18' -- Para concept F10 y F13
			Set @C_String= @C_String + ' and  (ca.Concepto = "F18" or ca.Concepto = "F19" or ca.Concepto = "F22") '

	end
else
	begin
		if @Concepto <> '999' -- Para concept F10 y F13
			Set @C_String= @C_String + ' and  ca.Concepto ="' + @Concepto + '"'
		else
			Set @C_String= @C_String + ' and  (ca.Concepto = "F10" or ca.Concepto = "F11" or ca.Concepto = "F12" or ca.Concepto = "F13" or ca.Concepto = "F14" or ca.Concepto = "F15" or ca.Concepto = "F16" or ca.Concepto = "F18" or ca.Concepto = "F19" or ca.Concepto = "F22") '
	end

Set @C_String= @C_String + ') <> 0 '

end

/*
else
begin
	if @Concepto <> '0' 
		Set @C_String= @C_String + ' and  ca.Concepto >="' + @Concepto + '"'

	if @ConceptoHasta <> '0'
		Set @C_String= @C_String + ' and  ca.Concepto <="' + @ConceptoHasta + '"'
end
*/

	--Filtros para Socios/Adherentes
	if @CobradorDesde is not null and @CobradorDesde <> 0
		Set @C_String= @C_String + ' and  ad.Cobrador >= ' + rtrim(convert(char(5),@CobradorDesde))

	if @CobradorHasta is not null and @CobradorHasta <> 0
		Set @C_String= @C_String + ' and  ad.Cobrador <= ' + rtrim(convert(char(5),@CobradorHasta))


	/**** Armo el orden de la consulta ****/
	if @Orden = 0
		--Alfabeto
		Set @C_String=@C_String + ' Order by ad.apellido, ad.nombre'
	else
		--Cobrador
		Set @C_String=@C_String + ' Order by ad.Cobrador, case when (ad.cobrador=1 or ad.cobrador=7 or ad.cobrador=8) and ' + cast(@Orden as char(1)) + ' = 2 then rtrim(ltrim(dbo.DescHospitalVoto(ad.Domicilio_Cobro))) else "" end,ad.apellido, ad.nombre'

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String









GO
/****** Object:  StoredProcedure [dbo].[ListadoCompaniasAgrupado]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO





CREATE                     Procedure [dbo].[ListadoCompaniasAgrupado] 
	@Entidad int,
	@Concepto char(3),
	@ConceptoHasta char(3),
	@FechaHasta char(8),
	@CobradorDesde int = NULL,
	@CobradorHasta int = NULL,
	@Orden int,	 -- 0: Alfabeto, 1: Cobrador
	@Agrupado char(1)='S' 
as

Declare @C_String as nvarchar(4000)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

if @Entidad = 0 
	Set @C_String='Select ad.Cobrador,co.nombre,count(Distinct ad.Socio) AS Cantidad 
 					from socios ad
					left join TiposMatricula tm
						on tm.tipomatricula = ad.tipomatricula
					inner join Conceptos_socios ca 
						on ca.socio = ad.socio
					left join TiposDocumento td
						on td.tipodocto = ad.tipodocto
					left join cobradores co on 
						ad.cobrador=co.cobrador
					where (ca.fechabaja is null or ca.fechabaja > "' + @FechaHasta + '")
						and ca.FechaVigencia <= "' + @FechaHasta + '"'
else
	Set @C_String='Select ad.Cobrador,co.nombre,count(Distinct ad.Adherente) AS Cantidad 
					from Adherentes ad
					left join TiposMatricula tm
						on tm.tipomatricula = ad.tipomatricula
					inner join Conceptos_adherentes ca 
						on ca.adherente = ad.adherente 
					left join TiposDocumento td
						on td.tipodocto = ad.tipodocto
					left join cobradores co on 
						ad.cobrador=co.cobrador
					where (ca.fechabaja is null or ca.fechabaja > "' + @FechaHasta + '")
						and ca.FechaVigencia <= "' + @FechaHasta + '"'

if @Entidad = 1 
begin
	if @Agrupado='S'
		begin
			if @Concepto <> 'F10' and @Concepto <> 'F11' and @Concepto <> 'F12' and @Concepto <> 'F18' and @Concepto <> '999' 
				Set @C_String= @C_String + ' and  ca.Concepto ="' + @Concepto + '"'
		
			if @Concepto = 'F10' -- Para concept F10 y F13
				Set @C_String= @C_String + ' and  (ca.Concepto = "F10" or ca.Concepto = "F13" or  ca.Concepto = "F14") '
		
			if @Concepto = 'F11' -- Para concept F10 y F13
				Set @C_String= @C_String + ' and  (ca.Concepto = "F11" or ca.Concepto = "F16") '
		
			if @Concepto = 'F12' -- Para concept F10 y F13
				Set @C_String= @C_String + ' and  (ca.Concepto = "F12" or ca.Concepto = "F15") '

			if @Concepto = 'F18' -- Para concept F10 y F13
				Set @C_String= @C_String + ' and  (ca.Concepto = "F18" or ca.Concepto = "F19" or ca.Concepto = "F22") '
		end
	else
		begin
			if @Concepto <> '999' -- Para concept F10 y F13
				Set @C_String= @C_String + ' and  ca.Concepto ="' + @Concepto + '"'
			else
				Set @C_String= @C_String + ' and  (ca.Concepto = "F10" or ca.Concepto = "F11" or ca.Concepto = "F12" or ca.Concepto = "F13" or ca.Concepto = "F14" or ca.Concepto = "F15" or ca.Concepto = "F16" ) '
		end
end
else
begin
	if @Concepto <> '0' and @Concepto<>'99' and @Concepto<>'999' 
		Set @C_String= @C_String + ' and  ca.Concepto >="' + @Concepto + '"'

	if @ConceptoHasta <> '0' and @ConceptoHasta<>'99' and @ConceptoHasta<>'999' 
		Set @C_String= @C_String + ' and  ca.Concepto <="' + @ConceptoHasta + '"'

	if @Concepto = '99' -- Para concept F10 y F13
			Set @C_String= @C_String + ' and  (ca.Concepto = "C06" or ca.Concepto = "F01" or ca.Concepto = "F02" or ca.Concepto = "F03") '

	if @Concepto = '999' -- Para concept F10 y F13
			Set @C_String= @C_String + ' and  (ca.Concepto = "F04" or ca.Concepto = "F05" or ca.Concepto = "F06" or ca.Concepto = "F07" or ca.Concepto = "F09" or ca.Concepto = "F51" ) '

end


	if @CobradorDesde is not null and @CobradorDesde <> 0
		Set @C_String= @C_String + ' and  ad.Cobrador >= ' + rtrim(convert(char(5),@CobradorDesde))

	if @CobradorHasta is not null and @CobradorHasta <> 0
		Set @C_String= @C_String + ' and  ad.Cobrador <= ' + rtrim(convert(char(5),@CobradorHasta))

	Set @C_String=@C_String + ' group by  co.nombre,ad.cobrador'

	/**** Armo el orden de la consulta ****/
	Set @C_String=@C_String + ' Order by co.nombre'

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String

























GO
/****** Object:  StoredProcedure [dbo].[ListadoCompaniasCobertura]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE Procedure [dbo].[ListadoCompaniasCobertura] -- ListadoCompaniasCobertura 1,'60','60','20060301'
	@Entidad int=0,
	@Concepto char(3)='60',
	@ConceptoHasta char(3)='60',
	@FechaHasta char(8),
	@CobradorDesde int = NULL,
	@CobradorHasta int = NULL,
	@Orden int=0, -- 0: Alfabeto, 1: Cobrador
	@Agrupado	char(1)='N'
as

Declare @C_String as nvarchar(4000)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

if @Entidad = 0 
begin
	Set @C_String='Select ad.Socio as Codigo,ad.TipoMatricula, tm.descripcion as DescMatricula, ad.NroMatricula, 
case 
when len(ltrim(rtrim(cuil)))=0 then cuil
else substring(cast(cuil as char(11)),1,2)+"-"+substring(cast(cuil as char(11)),3,8)
+ "-" +substring(cast(cuil as char(11)),11,1) end cuil,
	ad.Apellido, ad.Nombre, case when ' + cast(@Orden as char(1)) + ' = 0 then 0 else ad.Cobrador end as cobrador, td.descripcion as TipoDocumento, ad.numedocto,case when (ad.cobrador=1 or ad.cobrador=7 or ad.cobrador=8) and ' + cast(@Orden as char(1)) + ' = 2 then rtrim(ltrim(dbo.DescHospitalVoto(ad.Domicilio_Cobro))) else "" end as Domicilio_Cobro 
	from socios ad left join Cobradores cb on ad.cobrador=cb.cobrador 
	left join TiposMatricula tm on tm.tipomatricula = ad.tipomatricula
	left join TiposDocumento td on td.tipodocto = ad.tipodocto
	where (select count(*) from conceptos_socios ca
	where (ca.fechabaja is null or ca.fechabaja > "' + @FechaHasta + '")
	and ca.FechaVigencia <= "' + @FechaHasta + '"
	and ca.socio = ad.socio '
	
	if @Concepto <> '0' and @Concepto<>'99' and @Concepto<>'999' 
		Set @C_String= @C_String + ' and  ca.Concepto >="' + @Concepto + '"'

	if @ConceptoHasta <> '0' and @ConceptoHasta<>'99' and @ConceptoHasta<>'999' 
		Set @C_String= @C_String + ' and  ca.Concepto <="' + @ConceptoHasta + '"'

	if @Concepto = '99' -- Para concept F10 y F13
			Set @C_String= @C_String + ' and  (ca.Concepto = "C06" or ca.Concepto = "F01" or ca.Concepto = "F02" or ca.Concepto = "F03") '

	if @Concepto = '999' -- Para concept F10 y F13
			Set @C_String= @C_String + ' and  (ca.Concepto = "F04" or ca.Concepto = "F05" or ca.Concepto = "F06" or ca.Concepto = "F07" or ca.Concepto = "F09" or ca.Concepto = "F51" ) '


Set @C_String= @C_String + ') <> 0 '

end
else
begin
	Set @C_String='Select ad.Adherente as Codigo,ad.TipoMatricula, tm.descripcion as DescMatricula, ad.NroMatricula, 
case 
when len(ltrim(rtrim(cuil)))=0 then cuil
else substring(cast(cuil as char(11)),1,2)+"-"+substring(cast(cuil as char(11)),3,8)
+ "-" +substring(cast(cuil as char(11)),11,1) end cuil,
	ad.Apellido, ad.Nombre, case when ' + cast(@Orden as char(1)) + ' = 0 then 0 else ad.Cobrador end as cobrador, td.descripcion as TipoDocumento, ad.numedocto,case when (ad.cobrador=1 or ad.cobrador=7 or ad.cobrador=8) and ' + cast(@Orden as char(1)) + ' = 2 then rtrim(ltrim(dbo.DescHospitalVoto(ad.Domicilio_Cobro))) else "" end as Domicilio_Cobro 
	from Adherentes ad
	left join Cobradores cb
	on ad.cobrador=cb.cobrador
					left join TiposMatricula tm
						on tm.tipomatricula = ad.tipomatricula
					left join TiposDocumento td
						on td.tipodocto = ad.tipodocto
					where 
					(select count(*) from conceptos_Adherentes ca
					where (ca.fechabaja is null or ca.fechabaja > "' + @FechaHasta + '")
					and ca.FechaVigencia <= "' + @FechaHasta + '"
					and ca.Adherente = ad.Adherente '
if @Agrupado='S'
	begin
		if @Concepto <> 'F10' and @Concepto <> 'F11' and @Concepto <> 'F12' and @Concepto <> 'F18' and @Concepto <> '999' 
			Set @C_String= @C_String + ' and  ca.Concepto ="' + @Concepto + '"'
	
		if @Concepto = 'F10' -- Para concept F10 y F13
			Set @C_String= @C_String + ' and  (ca.Concepto = "F10" or ca.Concepto = "F13" or  ca.Concepto = "F14") '
	
		if @Concepto = 'F11' -- Para concept F10 y F13
			Set @C_String= @C_String + ' and  (ca.Concepto = "F11" or ca.Concepto = "F16") '
	
		if @Concepto = 'F12' -- Para concept F10 y F13
			Set @C_String= @C_String + ' and  (ca.Concepto = "F12" or ca.Concepto = "F15") '

		if @Concepto = 'F18' -- Para concept F10 y F13
			Set @C_String= @C_String + ' and  (ca.Concepto = "F18" or ca.Concepto = "F19" or ca.Concepto = "F22") '

	end
else
	begin
		if @Concepto <> '999' -- Para concept F10 y F13
			Set @C_String= @C_String + ' and  ca.Concepto ="' + @Concepto + '"'
		else
			Set @C_String= @C_String + ' and  (ca.Concepto = "F10" or ca.Concepto = "F11" or ca.Concepto = "F12" or ca.Concepto = "F13" or ca.Concepto = "F14" or ca.Concepto = "F15" or ca.Concepto = "F16" or ca.Concepto = "F18" or ca.Concepto = "F19" or ca.Concepto = "F22") '
	end

Set @C_String= @C_String + ') <> 0 '

end

/*
else
begin
	if @Concepto <> '0' 
		Set @C_String= @C_String + ' and  ca.Concepto >="' + @Concepto + '"'

	if @ConceptoHasta <> '0'
		Set @C_String= @C_String + ' and  ca.Concepto <="' + @ConceptoHasta + '"'
end
*/

	--Filtros para Socios/Adherentes
	if @CobradorDesde is not null and @CobradorDesde <> 0
		Set @C_String= @C_String + ' and  ad.Cobrador >= ' + rtrim(convert(char(5),@CobradorDesde))

	if @CobradorHasta is not null and @CobradorHasta <> 0
		Set @C_String= @C_String + ' and  ad.Cobrador <= ' + rtrim(convert(char(5),@CobradorHasta))


	/**** Armo el orden de la consulta ****/
	if @Orden = 0
		--Alfabeto
		Set @C_String=@C_String + ' Order by ad.apellido, ad.nombre'
	else
		--Cobrador
		Set @C_String=@C_String + ' Order by ad.Cobrador, case when (ad.cobrador=1 or ad.cobrador=7 or ad.cobrador=8) and ' + cast(@Orden as char(1)) + ' = 2 then rtrim(ltrim(dbo.DescHospitalVoto(ad.Domicilio_Cobro))) else "" end,ad.apellido, ad.nombre'

/**** Ejecuto la consulta ****/
--EXEC sp_executesql @C_String
print @C_String










GO
/****** Object:  StoredProcedure [dbo].[ListadoCompaniasSeguro]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO






CREATE                 Procedure [dbo].[ListadoCompaniasSeguro] -- ListadoCompaniasSeguro 0,'S01','S01','20040229'
	@Entidad int,
	@Concepto char(3),
	@ConceptoHasta char(3),
	@FechaHasta char(8),
	@CobradorDesde int = NULL,
	@CobradorHasta int = NULL,
	@Orden int=0,  -- 0: Alfabeto, 1: Cobrador
	@Fallecido char(1)='N' -- 0: Alfabeto, 1: Cobrador
as

Declare @C_String as nvarchar(4000)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

if @Entidad = 0 
	Set @C_String='(Select distinct ad.Socio as Codigo,"A" as Condicion,
							ad.Apellido, ad.Nombre, ad.Cobrador, td.descripcion as TipoDocumento, ad.numedocto,
							ca.FechaAlta, ad.Nacido 
 					from socios ad
					inner join Conceptos_socios ca 
						on ca.socio = ad.socio
					left join TiposDocumento td
						on td.tipodocto = ad.tipodocto
					where (ca.fechabaja is null or ca.fechabaja > "' + @FechaHasta + '")
						and ca.FechaVigencia <= "' + @FechaHasta + '"'
else
	Set @C_String='(Select  distinct ad.Adherente as Codigo,"A" as Condicion,
							ad.Apellido, ad.Nombre, ad.Cobrador, td.descripcion as TipoDocumento, ad.numedocto,
							ca.FechaAlta, ad.Nacido 
					from Adherentes ad
					left join TiposMatricula tm
						on tm.tipomatricula = ad.tipomatricula
					inner join Conceptos_adherentes ca 
						on ca.adherente = ad.adherente 
					left join TiposDocumento td
						on td.tipodocto = ad.tipodocto
					where (ca.fechabaja is null or ca.fechabaja > "' + @FechaHasta + '")
						and ca.FechaAlta <= "' + @FechaHasta + '"'


if @Entidad = 1 
begin
	if @Concepto <> '99' and @Concepto <> '999' 
		Set @C_String= @C_String + ' and  ca.Concepto ="' + @Concepto + '"'

	if @Concepto = '99' -- Para concept F10 y F13
		Set @C_String= @C_String + ' and  ca.Concepto = "F10" or ca.Concepto = "F13" '

	if @Concepto = '999' 	
		Set @C_String= @C_String + ' and  ca.Concepto = "F10" or ca.Concepto = "F11" or ca.Concepto = "F12" or ca.Concepto = "F13" '
end
else
begin
	if @Concepto <> '0' 
		Set @C_String= @C_String + ' and  ca.Concepto >="' + @Concepto + '"'

	if @ConceptoHasta <> '0'
		Set @C_String= @C_String + ' and  ca.Concepto <="' + @ConceptoHasta + '"'
end

	if @CobradorDesde is not null and @CobradorDesde <> 0
		Set @C_String= @C_String + ' and  ad.Cobrador >= ' + rtrim(convert(char(5),@CobradorDesde))

	if @CobradorHasta is not null and @CobradorHasta <> 0
		Set @C_String= @C_String + ' and  ad.Cobrador <= ' + rtrim(convert(char(5),@CobradorHasta))

	Set @C_String= @C_String + ') '

	if @Entidad = 1 
		Set @C_String= @C_String + 'union
					(Select 0 as Codigo, "A" as Condicion,te.Apellido, te.Nombre, 0 as Cobrador, 
							td.descripcion as TipoDocumento, te.nrodocumento as numedocto,
							" " as FechaAlta, " " as Nacido 
					from Temp_Empleados te
					left join TiposDocumento td
						on td.tipodocto = te.tipodocumento)'


	if @Fallecido='S'
		Begin
			if @Entidad = 0 
				Set @C_String=@C_String + ' Union (Select distinct ad.Socio as Codigo,"F" as Condicion,
							ad.Apellido, ad.Nombre, ad.Cobrador, td.descripcion as TipoDocumento, ad.numedocto,
							ca.FechaAlta, ad.Nacido 
 					from socios ad
					inner join Conceptos_socios ca 
						on ca.socio = ad.socio
					left join TiposDocumento td
						on td.tipodocto = ad.tipodocto
					where (ca.motivobaja=6 and dbo.toaniomes(ca.fechabaja)=' + cast(dbo.toaniomes(@FechaHasta) as char(6)) + ') '
			else
				Set @C_String=@C_String + ' Union (Select  distinct ad.Adherente as Codigo,"F" as Condicion,
							ad.Apellido, ad.Nombre, ad.Cobrador, td.descripcion as TipoDocumento, ad.numedocto,
							ca.FechaAlta, ad.Nacido 
					from Adherentes ad
					left join TiposMatricula tm
						on tm.tipomatricula = ad.tipomatricula
					inner join Conceptos_adherentes ca 
						on ca.adherente = ad.adherente 
					left join TiposDocumento td
						on td.tipodocto = ad.tipodocto
					where (ca.motivobaja=6 and dbo.toaniomes(ca.fechabaja)=' + cast(dbo.toaniomes(@FechaHasta) as char(6)) + ') '

			if @Entidad = 1 
				begin
					if @Concepto <> '99' and @Concepto <> '999' 
						Set @C_String= @C_String + ' and  ca.Concepto ="' + @Concepto + '"'

					if @Concepto = '99' -- Para concept F10 y F13
						Set @C_String= @C_String + ' and  ca.Concepto = "F10" or ca.Concepto = "F13" '

					if @Concepto = '999' 	
						Set @C_String= @C_String + ' and  ca.Concepto = "F10" or ca.Concepto = "F11" or ca.Concepto = "F12" or ca.Concepto = "F13" '
				end
			else
				begin
					if @Concepto <> '0' 
						Set @C_String= @C_String + ' and  ca.Concepto >="' + @Concepto + '"'
	
					if @ConceptoHasta <> '0'
						Set @C_String= @C_String + ' and  ca.Concepto <="' + @ConceptoHasta + '"'
				end

			if @CobradorDesde is not null and @CobradorDesde <> 0
				Set @C_String= @C_String + ' and  ad.Cobrador >= ' + rtrim(convert(char(5),@CobradorDesde))
		
			if @CobradorHasta is not null and @CobradorHasta <> 0
				Set @C_String= @C_String + ' and  ad.Cobrador <= ' + rtrim(convert(char(5),@CobradorHasta))
		
			Set @C_String= @C_String + ') '

		end

	/**** Armo el orden de la consulta ****/
	if @Orden = 0
		--Alfabeto
		Set @C_String=@C_String + ' Order by ad.apellido, ad.nombre'
	else
		--Cobrador
		Set @C_String=@C_String + ' Order by ad.Cobrador'

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String





GO
/****** Object:  StoredProcedure [dbo].[ListadoConceptos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE  Procedure [dbo].[ListadoConceptos]

	@Modalidad	char(1),
	@Entidad	int=999 

AS
Declare @C_String as nvarchar(4000)
Declare @boolWhere as char(1)

Set @boolWhere = 'N'

/**** Armo la consulta ****/
Set @C_String = 'Select * from Conceptos'

/**** Armo el Where segun parametros ****/
if @Modalidad <> ''
	begin
		set @boolWhere = 'S'
		Set @C_String = @C_String + " Where Modalidad = '" + cast(@Modalidad as CHAR(1)) + "'"
	end

if @Entidad<>999
	begin
		if @boolWhere = 'S'
			Set @C_String = @C_String + ' And Entidad = ' + cast(@Entidad as CHAR(1))
		else
			Set @C_String = @C_String + ' Where Entidad = ' + cast(@Entidad as CHAR(1))
	end

/**** Armo el orden ****/
Set @C_String = @C_String + ' Order by Concepto'

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String



GO
/****** Object:  StoredProcedure [dbo].[ListadoConceptosLiquidacion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO





CREATE    Procedure [dbo].[ListadoConceptosLiquidacion]

	@ConceptoDesde		int = Null ,
	@ConceptoHasta		int = Null

AS
Declare @C_String 	as nvarchar(4000)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

Set @C_String='(Select 	A01.concepto, A01.descripcion, A01.cuentacontable, 
			A02.descripcion as TipoConcepto, A03.descripcion as ModoConcepto, 
			A04.descripcion as DescCuenta
		from ConceptosLiquidacion A01
			left join TipConcLiq A02
				on A01.tipoconcepto = A02.concepto
			left join ModoConcepLiq A03
				on A01.modo = A03.concepto
			left join cuentas A04
				on A01.cuentacontable = A04.cuenta '

	/**** Armo las condiciones ****/
	if @ConceptoDesde is not null and @ConceptoDesde <> 0
		begin
			set @boolWhere = 'S'	
			Set @C_String= @C_String + ' where A01.Concepto >= ' + convert(char(10),@ConceptoDesde)
		end
	if @ConceptoHasta is not null and @ConceptoHasta <> 0
		begin
			if @boolWhere = 'S'
				Set @C_String= @C_String + ' and  A01.Concepto <= ' + convert(char(10),@ConceptoHasta)
			else
				Set @C_String= @C_String + ' where  A01.Concepto <= ' + convert(char(10),@ConceptoHasta)
		end

	/**** Armo el orden de la consulta ****/
	Set @C_String=@C_String + ') order by A01.Concepto'

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String





GO
/****** Object:  StoredProcedure [dbo].[ListadoConceptosTesoreria]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE   Procedure [dbo].[ListadoConceptosTesoreria]

	@ConceptoDesde		int = Null ,
	@ConceptoHasta		int = Null
 
AS
Declare @C_String as nvarchar(4000)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

Set @C_String='(Select 	A01.*, A02.descripcion as Cuenta,
			A03.descripcion as DescModalidad  
		From dbo.Conceptos_tesoreria A01
			Left join cuentas A02
				on A01.imputacion_contable = A02.cuenta 
			left join tiposcuentacontable A03
				on A01.modalidad = A03.tipocuenta '

	/**** Armo las condiciones ****/
	if @ConceptoDesde is not null and @ConceptoDesde <> 0
		begin
			set @boolWhere = 'S'	
			Set @C_String= @C_String + ' where A01.idConcepto_Tesoreria >= ' + convert(char(10),@ConceptoDesde)
		end
	if @ConceptoHasta is not null and @ConceptoHasta <> 0
		begin
			if @boolWhere = 'S'
				Set @C_String= @C_String + ' and  A01.idConcepto_Tesoreria <= ' + convert(char(10),@ConceptoHasta)
			else
				Set @C_String= @C_String + ' where  A01.idConcepto_Tesoreria <= ' + convert(char(10),@ConceptoHasta)
		end

	/**** Armo el orden de la consulta ****/
	Set @C_String=@C_String + ')order by A01.descripcion'

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String



GO
/****** Object:  StoredProcedure [dbo].[ListadoConsultaCliPro]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE    Procedure [dbo].[ListadoConsultaCliPro]

	@Tipo	 	Char(1),
	@C_Modo		char(1) = 'T',
	@Desde		int = NULL, 
	@Hasta		int = Null

AS
Declare @C_String as nvarchar(4000)
Declare @TB as char(20)
Declare @TBC as char(20)
Declare @TBD as char(20)

/* Variables segun Cliente o Proveedor */
if @Tipo = 'C'
	begin
		Set @TB = ltrim(Rtrim('VenCliHeader'))
		Set @TBC = ltrim(Rtrim('Cliente'))
		Set @TBD = ltrim(Rtrim('Clientes'))
	end

if @Tipo='P'
	begin
		Set @TB = ltrim(Rtrim('CompProvHeader'))
		Set @TBC = ltrim(Rtrim('Proveedor'))
		Set @TBD = ltrim(Rtrim('Proveedores'))
	end

Set @C_String='
(
SELECT 
' + @TB + '.fecha, '

if @Tipo='C'
	Set @C_String=@C_String+'TipVentModHeader.comprobante AS TP, '
else
	Set @C_String=@C_String+'TipCompModHeader.comprobante AS TP, '

Set @C_String=@C_String+'SUBSTRING(' + @TB + '.nrocomprobante,1,4) as PV, 
SUBSTRING(' + @TB + '.nrocomprobante,5,8) as NCO,
' + @TB + '.tipofactura, 
0 AS DEBE ,
' + @TB + '.totalimporte as Haber, 
0 AS SALDO,
' + @TB + '.cancelado, 
' + @TB + '.fecha1venc as Vencimiento, 
0 as serie,
' + @TB + '.idTransaccion, 
' + @TB + '.' + @TBC + ',  
' + @TBD + '.RazonSocial  FROM ' + @TB  

/* Select segun Cliente o Proveedor */
if @Tipo='C'
	begin
		Set @C_String=@C_String + ' INNER JOIN TipVentModHeader ON ' + @TB + '.tipocomprobante = TipVentModHeader.codigo 
					    INNER JOIN ' + @TBD + ' ON ' + @TB + '.Cliente = ' + @TBD + '.codigo
		Where TipVentModHeader.signo=2 '
	end
else
	begin
		Set @C_String=@C_String + ' INNER JOIN TipCompModHeader ON ' + @TB + '.tipocomprobante = TipCompModHeader.codigo 
					    INNER JOIN ' + @TBD + ' ON ' + @TB + '.Proveedor = ' + @TBD + '.codigo
		Where TipCompModHeader.signo=2 '
	end

/* Codigo desde - hasta */
if @Desde is not null and @Desde <> 0 
	set @C_String = @C_String + ' AND ' + @TB + '.' + @TBC + '>=' + cast(@Desde as VARCHAR(6))

if @HAsta is not null and @HAsta <> 0 
	set @C_String = @C_String + ' AND '+ @TB + '.' + @TBC + '<=' + cast(@Hasta as VARCHAR(6))

/* Tipo de consulta */
if @C_Modo='A'
	begin
		Set @C_String=@C_String + 'and  (' + @TB + '.totalimporte<>' + @TB + '.Cancelado or ' + @TB + '.Cancelado is null )'
	end

Set @C_String=@C_String + ')
 Union
(
SELECT 
' + @TB + '.fecha, '

if @Tipo='C'
	Set @C_String = @C_String + 'TipVentModHeader.comprobante AS TP, '
else
	Set @C_String = @C_String + 'TipCompModHeader.comprobante AS TP, '
	Set @C_String = @C_String + ' SUBSTRING(' + @TB + '.nrocomprobante,1,4) as PV, 
	SUBSTRING(' + @TB + '.nrocomprobante,5,8) as NCO,
	' + @TB + '.tipofactura, 
	' + @TB + '.totalimporte AS DEBE 
	,0 as Haber, 
	0 AS SALDO,
	' + @TB + '.cancelado, 
	' + @TB + '.fecha1venc as Vencimiento,  
	0 as serie,
	' + @TB + '.idTransaccion, 
	' + @TB + '.' + @TBC + ',  
	' + @TBD + '.RazonSocial  FROM ' + @TB  

if @Tipo='C'
	begin
		Set @C_String = @C_String + ' INNER JOIN TipVentModHeader ON ' + @TB + '.tipocomprobante = TipVentModHeader.codigo 
					      INNER JOIN ' + @TBD + ' ON ' + @TB + '.Cliente = ' + @TBD + '.codigo
		Where TipVentModHeader.signo=1 '
	end
else
	begin
		Set @C_String = @C_String + ' INNER JOIN TipCompModHeader ON ' + @TB + '.tipocomprobante = TipCompModHeader.codigo 
					      INNER JOIN ' + @TBD + ' ON ' + @TB + '.Proveedor = ' + @TBD + '.codigo
		Where TipCompModHeader.signo=1 '
	end

/* Codigo desde - hasta */
if @Desde is not null and @Desde <> 0 
	set @C_String = @C_String + ' AND '+ @TB + '.' + @TBC + '>=' + cast(@Desde as VARCHAR(6))

if @HAsta is not null and @HAsta <> 0 
	set @C_String = @C_String + ' AND '+ @TB + '.' + @TBC + '<=' + cast(@Hasta as VARCHAR(6))

/* Tipo de consulta */
if @C_Modo='A'
	begin
		Set @C_String=@C_String + 'and  (' + @TB + '.totalimporte<>' + @TB + '.Cancelado or ' + @TB + '.Cancelado is null )'
	end

Set @C_String=@C_String + ')Order by Fecha'

/* Select @C_String */
EXEC sp_executesql @C_String


GO
/****** Object:  StoredProcedure [dbo].[ListadoControldeCarga]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE       Procedure [dbo].[ListadoControldeCarga] 
	@Concepto char(3),
	@FechaDesde char(8),
	@FechaHasta char(8),
	@Cobrador int = NULL
as

Declare @C_String as nvarchar(4000)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

	Set @C_String='Select ad.adherente as Codigo, ad.Apellido, ad.Nombre, ad.NroMatricula, co.concepto, co.descripcion as DescConcepto, ca.FechaAlta
					from Adherentes ad
						inner join conceptos_adherentes ca
							on ad.adherente = ca.adherente
						inner join conceptos co
							on ca.concepto = co.concepto
					where ca.FechaBaja is null '

	--Fecha Desde
	if @FechaDesde <> ''
		Set @C_String= @C_String + ' and ca.FechaAlta >= "' + @FechaDesde + '"'

	--Fecha Hasta
	if @FechaHasta <> ''
		Set @C_String= @C_String + ' and ca.FechaAlta <= "' + @FechaHasta + '"'

	--Cobrador
	if @Cobrador <> 0
		Set @C_String= @C_String + ' and ad.Cobrador = ' + convert(varchar(10),@Cobrador)

	--Concepto
	if @Concepto <> ''
		Set @C_String= @C_String + ' and co.Concepto = "' + @Concepto + '"'

	--Filtro para traer solamente los que son alta y no Cambios
	Set @C_String= @C_String + ' and (Select count(*) from conceptos_adherentes ca1
									where ((ca1.fechaalta >= "' + @FechaDesde + '" and ca1.FechaAlta <= "' + @FechaHasta + '") or
									(ca1.fechabaja >= "' + @FechaDesde + '" and ca1.Fechabaja <= "' + @FechaHasta + '"))
									and ca1.motivobaja = 17 and ca1.adherente = ca.adherente) = 0 '

	--Orden
	Set @C_String= @C_String + ' order by ad.adherente '


/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String












GO
/****** Object:  StoredProcedure [dbo].[ListadoControldeCarga_Cambios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE       Procedure [dbo].[ListadoControldeCarga_Cambios] 
	@Concepto char(3),
	@FechaDesde char(8),
	@FechaHasta char(8),
	@Cobrador int = NULL
as

Declare @C_String as nvarchar(4000)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

	Set @C_String='Select ad.adherente as Codigo, ad.Apellido, ad.Nombre, ad.NroMatricula, co.concepto, co.descripcion as DescConcepto, ca.FechaAlta,

						(Select Concepto from conceptos_adherentes ca1
						where ((ca1.fechaalta >= "' + @FechaDesde + '" and ca1.FechaAlta <= "' + @FechaHasta + '") or
						(ca1.fechabaja >= "' + @FechaDesde + '" and ca1.Fechabaja <= "' + @FechaHasta + '"))
						and ca1.motivobaja = 17
						and ca1.adherente = ca.adherente) as ConceptoAnt,

						(Select FechaAlta from conceptos_adherentes ca1
						where ((ca1.fechaalta >= "' + @FechaDesde + '" and ca1.FechaAlta <= "' + @FechaHasta + '") or
						(ca1.fechabaja >= "' + @FechaDesde + '" and ca1.Fechabaja <= "' + @FechaHasta + '"))
						and ca1.motivobaja = 17
						and ca1.adherente = ca.adherente) as FechaAltaAnt,

						(Select FechaBaja from conceptos_adherentes ca1
						where ((ca1.fechaalta >= "' + @FechaDesde + '" and ca1.FechaAlta <= "' + @FechaHasta + '") or
						(ca1.fechabaja >= "' + @FechaDesde + '" and ca1.Fechabaja <= "' + @FechaHasta + '"))
						and ca1.motivobaja = 17
						and ca1.adherente = ca.adherente) as FechaBajaAnt

					from Adherentes ad
						inner join conceptos_adherentes ca
							on ad.adherente = ca.adherente
						inner join conceptos co
							on ca.concepto = co.concepto
					where ca.FechaBaja is null '

	--Fecha Desde
	if @FechaDesde <> ''
		Set @C_String= @C_String + ' and ca.FechaAlta >= "' + @FechaDesde + '"'

	--Fecha Hasta
	if @FechaHasta <> ''
		Set @C_String= @C_String + ' and ca.FechaAlta <= "' + @FechaHasta + '"'

	--Cobrador
	if @Cobrador <> 0
		Set @C_String= @C_String + ' and ad.Cobrador = ' + convert(varchar(10),@Cobrador)

	--Concepto
	if @Concepto <> ''
		Set @C_String= @C_String + ' and co.Concepto = "' + @Concepto + '"'

	--Filtro para traer solamente los que son Cambios
	Set @C_String= @C_String + ' and (Select count(*) from conceptos_adherentes ca1
									where ((ca1.fechaalta >= "' + @FechaDesde + '" and ca1.FechaAlta <= "' + @FechaHasta + '") or
									(ca1.fechabaja >= "' + @FechaDesde + '" and ca1.Fechabaja <= "' + @FechaHasta + '"))
									and ca1.motivobaja = 17 and ca1.adherente = ca.adherente) = 1 '

	--Orden
	Set @C_String= @C_String + ' order by ad.adherente '


/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String












GO
/****** Object:  StoredProcedure [dbo].[ListadoControlRecibosRendiciones]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE     procedure [dbo].[ListadoControlRecibosRendiciones]

	@idOperacion int,
	@Entidad int

AS
Declare @C_String nvarchar(4000)
Declare @boolWhere char(1)

set @boolWhere = 'N'

set @C_String = 'Select do.idoperacion, do.idtransaccion, cc.idopcobrador, cc.socio, so.apellido, so.nombre, cc.importe,
cc.documentonumero as NumeroRecibo, cc1.documentonumero as Mes
from Detalle_Operaciones do
inner join CuentasCorrientes cc on cc.idTransaccion=do.idTransaccion and cc.entidad = ' + convert(char(1),@Entidad) + '
inner join AplicacionesCuentasCorrientes acc on acc.idTransaccion=cc.idTransaccion 
inner join CuentasCorrientes cc1 on cc1.idTransaccion=acc.idTransaccioncancelada '

if @Entidad = 0 
	set @C_String =  @C_String + ' inner join Socios so on cc.socio = so.Socio '
else
	set @C_String =  @C_String + ' inner join adherentes so on cc.socio = so.adherente '

set @C_String =  @C_String + ' Where idtipoTransaccion=0 and idOperacion= ' + convert(char(7), @idOperacion)

set @C_String =  @C_String + ' order by  convert(int,cc.documentonumero)'

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String























GO
/****** Object:  StoredProcedure [dbo].[ListadoCtasCursos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


/*
Select * from listas 
where idAlumno=49
*/
-- ListadoCtasCursos 178

CREATE                    Procedure [dbo].[ListadoCtasCursos] -- 123
(
/*	@Desde		char(8)='20060101',
	@Hasta		char(8)='20060331',*/
	@idCurso	int=153
	
)
as


Select al.idalumno,nyap,
sum(isnull(acc.importe,cc.importe) * case when idtipodemovimiento=1 then 1 else -1 end ) Saldo
,c.descripcion Curso,c.idCurso
From Alumnos al
inner join listas li on al.idAlumno=li.idalumno 
 Left join CuentasCorrientes cc on al.idalumno=cc.socio
 left join aplicacionesCuentasCorrientes acc on cc.idtransaccion=acc.idtransaccion 
 left join DetalleCuentasCorrientes dcc on acc.idtransaccioncancelada=dcc.idtransaccion
inner join NominaCursos c on c.idcurso=isnull(dcc.concepto,cc.idcancelada)

inner join ComprobantesCuentasCorrientes ccc on cc.concepto=ccc.comprobante 
where isnull(dcc.concepto,cc.idcancelada)=@idCurso
and cc.entidad=2
and li.idHorario=@idCurso
Group by al.idalumno,nyap,c.descripcion,c.idCurso

order by nyap







Select idalumno,idhorario,count(*) from listas
Group by idalumno,idhorario
having COunt(*)>1
order by idHorario





GO
/****** Object:  StoredProcedure [dbo].[ListadoCursos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO










-- ListadoCursos 157

CREATE                Procedure [dbo].[ListadoCursos] -- 123
(
	@Desde		char(8)='20060101',
	@Hasta		char(8)='20060331',
	@idCurso	int=153
	
)
as

Select Distinct al.idalumno,nyap,cc.fecha,isnull(sum(dcc.importe),avg(cc.importe)) importe,
c.descripcion,cc.documentoNumero,
(Select Sum(importe) from CuentasCorrientes cc
where socio=al.idalumno and (cc.concepto='CUO' or cc.concepto='MAT') and entidad=2
and idCancelada=@idCurso) aPagar,
(Select isnull(Sum(isnull(dcc.importe,cc.importe)),0) from CuentasCorrientes cc
inner join AplicacionesCuentasCorrientes acc
on cc.idtransaccion=acc.idtransaccion 
inner join DetalleCuentasCorrientes dcc
on acc.idtransaccionCancelada=dcc.idtransaccion
where socio=al.idalumno and (cc.concepto='COB' or cc.concepto='DA') and entidad=2
and cast(isnull(dcc.concepto,idCancelada)as char(3))=@idCurso) Cobrado,

cc.idtransaccion
from CuentasCorrientes cc
left join aplicacionesCuentasCorrientes acc 
on cc.idtransaccion=acc.idtransaccion 
left join DetalleCuentasCorrientes dcc
on acc.idtransaccioncancelada=dcc.idtransaccion
inner join alumnos al
on cc.socio=al.idAlumno
inner join NominaCursos c
on c.idcurso=isnull(dcc.concepto,cc.idcancelada)
left join aplicacionesCuentasCorrientes acc1
on cc.idtransaccion=acc1.idtransaccionCancelada
where isnull(dcc.concepto,cc.idcancelada)=@idCurso
and (cc.concepto='COB' or cc.concepto='DA') and entidad=2
and acc1.idtransaccion is null
and cc.fecha Between @desde and @hasta
Group by al.idalumno,nyap,cc.fecha,c.descripcion,cc.documentoNumero,cc.idtransaccion

order by nyap,fecha









GO
/****** Object:  StoredProcedure [dbo].[ListadoDetalleCtaCte]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE    Procedure [dbo].[ListadoDetalleCtaCte]

	@Modo		char(1),
	@SocioDesde	int = Null ,
	@SocioHasta	int = Null ,
	@Entidad	int = Null ,
	@FechaDesde	varchar(10),
	@FechaHasta	varchar(10),
	@Meses int,
	@Filtro varchar(3),
	@Debito int --1:SI, 0:NO


AS
Declare @C_String as nvarchar(4000)


-- (Select Count(*) from CuentasCorrientes c where c.entidad=0 and a.Socio=c.Socio and c.importe<>c.Cancelado)>=' + convert(char(3),@Meses) + '

Set @C_String='(SELECT  CuentasCorrientes.Fecha, CuentasCorrientes.Concepto, CuentasCorrientes.DocumentoNumero, CuentasCorrientes.FechaRendicion, 
                      	CuentasCorrientes.Rendicion, CuentasCorrientes.importe as Debe, 0 as Haber, 0 as Saldo, CuentasCorrientes.Cancelado, CuentasCorrientes.vencimiento, CuentasCorrientes.Serie, 
                      	CuentasCorrientes.IdTransaccion, CuentasCorrientes.socio, CuentasCorrientes.Entidad, ComprobantesCuentasCorrientes.idTipodeMovimiento,

						(Select right(day(convert(datetime,"'+@FechaDesde+'",103))+100,2)+"/"+right(month(convert(datetime,"'+@FechaDesde+'",103))+100,2)+"/"+right(year(convert(datetime,"'+@FechaDesde+'",103))+10000,4)) as Apertura,
						(select IsNull(sum(A01.importe)-0,0) from cuentascorrientes as A01 where A01.fecha <= convert(datetime,"'+@FechaDesde+'",103)
			    		AND A01.entidad=' + cast(@Entidad as VARCHAR(1)) + ' and A01.socio = cuentascorrientes.socio) as SaldoApertura, 
 						xx.apellido, xx.nombre, xx.domicilio '
	
		Set @C_String = @C_String + ' 
		FROM ComprobantesCuentasCorrientes 
			INNER JOIN TiposdeMovimiento 
				ON ComprobantesCuentasCorrientes.idTipodeMovimiento = TiposdeMovimiento.idTipodeMovimiento 
			INNER JOIN CuentasCorrientes 
				ON ComprobantesCuentasCorrientes.Comprobante = CuentasCorrientes.Concepto'

		/**** Armo el join dependiendo de la entidad ****/
		if @Entidad = 0
			Set @C_String = @C_String + ' INNER JOIN Socios xx ON CuentasCorrientes.socio = xx.socio '
		else
			Set @C_String = @C_String + ' INNER JOIN Adherentes xx ON CuentasCorrientes.socio = xx.Adherente '

		/**** Armo el Where ****/
		Set @C_String = @C_String + ' WHERE (ComprobantesCuentasCorrientes.idTipodeMovimiento = 1)  
					      			AND entidad='+cast(@Entidad as VARCHAR(1)) + '
									and xx.fechabaja is null '

		--Debito automatico
		if @Debito = 0
			Set @C_String = @C_String + ' and (xx.Tarjeta = 0 or xx.Tarjeta is Null) '
		

		/**** Establezco los filtros de socios o adherentes ****/
		if @SocioDesde is not null and @SocioDesde <> 0
			Set @C_String = @C_String + ' AND CuentasCorrientes.socio >= ' + cast(@SocioDesde as VARCHAR(7))

		if @SocioHasta is not null and @SocioHasta <> 0
			Set @C_String = @C_String + ' AND CuentasCorrientes.socio <= ' +  cast(@SocioHasta as VARCHAR(7))

		if @FechaDesde <> ''
			Set @C_String=@C_String + ' AND CuentasCorrientes.fecha >= convert(datetime,"'+@FechaDesde+'",103)'

		if @FechaHasta <> ''
			Set @C_String=@C_String + ' AND CuentasCorrientes.fecha <= convert(datetime,"'+@FechaHasta+'",103)'

		if @Modo='A'
			Set @C_String = @C_String + ' and (CuentasCorrientes.importe<>CuentasCorrientes.Cancelado or CuentasCorrientes.Cancelado is null)'

		--Filtro Meses
		if @Entidad = 0
			Set @C_String = @C_String + ' and (Select Count(*) from CuentasCorrientes cc where cc.entidad=0 and xx.Socio=cc.Socio and cc.importe<>cc.Cancelado)>=' + convert(char(3),@Meses) 
		else
			Set @C_String = @C_String + ' and (Select Count(*) from CuentasCorrientes cc where cc.entidad=1 and xx.adherente = cc.Socio and cc.importe<>cc.Cancelado)>=' + convert(char(3),@Meses) 

		--Grupo/Cobrador
		if @Entidad = 0
			begin		
		        If @Filtro <> 'T' 
        		    set @C_String = @C_String + ' and xx.grupo = "' + @Filtro + '"'
			end
		else
			begin
				If (@Filtro <> '0' and @Filtro <> '')
        		    set @C_String = @C_String + ' and xx.cobrador = ' + @Filtro 
			end


Set @C_String=@C_String + ' Union

	SELECT	CuentasCorrientes.Fecha, CuentasCorrientes.Concepto, CuentasCorrientes.DocumentoNumero, CuentasCorrientes.FechaRendicion, 
	       	CuentasCorrientes.Rendicion, 0 as Debe, CuentasCorrientes.importe as Haber ,  0 as Saldo, CuentasCorrientes.Cancelado, CuentasCorrientes.vencimiento, CuentasCorrientes.Serie, 
       		CuentasCorrientes.IdTransaccion, CuentasCorrientes.socio, CuentasCorrientes.Entidad, ComprobantesCuentasCorrientes.idTipodeMovimiento, 

			(Select right(day(convert(datetime,"'+@FechaDesde+'",103))+100,2)+"/"+right(month(convert(datetime,"'+@FechaDesde+'",103))+100,2)+"/"+right(year(convert(datetime,"'+@FechaDesde+'",103))+10000,4)) as Apertura,
			(select IsNull(sum(A01.importe),0) from cuentascorrientes as A01 where A01.fecha <= convert(datetime,"'+@FechaDesde+'",103) 
	    	AND A01.entidad=' + cast(@Entidad as VARCHAR(1)) + ' and A01.socio = cuentascorrientes.socio) as SaldoApertura, 
		 	xx.apellido, xx.nombre, xx.domicilio '

	Set @C_String = @C_String + ' 
	FROM ComprobantesCuentasCorrientes 
		INNER JOIN TiposdeMovimiento 
			ON ComprobantesCuentasCorrientes.idTipodeMovimiento = TiposdeMovimiento.idTipodeMovimiento 
		INNER JOIN CuentasCorrientes 
			ON ComprobantesCuentasCorrientes.Comprobante = CuentasCorrientes.Concepto'

	/**** Armo el join dependiendo de la entidad ****/
	if @Entidad = 0
		Set @C_String = @C_String + ' INNER JOIN Socios	xx ON CuentasCorrientes.socio = xx.socio '
	else
		Set @C_String = @C_String + ' INNER JOIN Adherentes xx ON CuentasCorrientes.socio = xx.Adherente '

	/**** Armo el Where ****/
	Set @C_String=@C_String + ' WHERE (ComprobantesCuentasCorrientes.idTipodeMovimiento = 2)  
							    AND entidad=' + cast(@Entidad as VARCHAR(1)) 

	--Debito automatico
	if @Debito = 0
		Set @C_String = @C_String + ' and (xx.Tarjeta = 0 or xx.Tarjeta is Null) '

	/**** Establezco los filtros de socios o adherentes ****/
	if @SocioDesde is not null
		Set @C_String=@C_String + ' AND CuentasCorrientes.socio >='+ cast(@SocioDesde as VARCHAR(7))

	if @SocioHasta is not null
		Set @C_String=@C_String + ' AND CuentasCorrientes.socio <='+ cast(@SocioHasta as VARCHAR(7))

	if @FechaDesde <> ''
		Set @C_String=@C_String + ' AND CuentasCorrientes.fecha >= convert(datetime,"'+@FechaDesde+'",103)'

	if @FechaHasta <> ''
		Set @C_String=@C_String + ' AND CuentasCorrientes.fecha <= convert(datetime,"'+@FechaHasta+'",103)'

	if @Modo='A'
		Set @C_String=@C_String + ' and (CuentasCorrientes.importe<>CuentasCorrientes.Cancelado or CuentasCorrientes.Cancelado is null)'

	--Filtro Meses
	if @Entidad = 0
		Set @C_String = @C_String + ' and (Select Count(*) from CuentasCorrientes cc where cc.entidad=0 and xx.Socio=cc.Socio and cc.importe<>cc.Cancelado)>=' + convert(char(3),@Meses) 
	else
		Set @C_String = @C_String + ' and (Select Count(*) from CuentasCorrientes cc where cc.entidad=1 and xx.adherente = cc.Socio and cc.importe<>cc.Cancelado)>=' + convert(char(3),@Meses) 

	--Grupo/Cobrador
	if @Entidad = 0
		begin		
	        If @Filtro <> 'T' 
    		    set @C_String = @C_String + ' and xx.grupo = "' + @Filtro + '"'
		end
	else
		begin
			If (@Filtro <> '0' and @Filtro <> '')
    		    set @C_String = @C_String + ' and xx.cobrador = ' + @Filtro 
		end


	/**** Armo el orden de la consulta ****/
	Set @C_String=@C_String + ')Order by xx.apellido, xx.nombre, Fecha'

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String





GO
/****** Object:  StoredProcedure [dbo].[ListadoDetalleCtaCteCliPro]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO






CREATE     Procedure [dbo].[ListadoDetalleCtaCteCliPro]

	@CliPro 	Char(1)='C',
	@C_Modo		char(1)='T',
	@Codigo		int=1134

AS
Declare @C_String as nvarchar(4000)
Declare @TB as char(20)
Declare @TBC as char(20)
Declare @TBD as char(20)

if @clipro='C'
	begin
		Set @TB = ltrim(Rtrim('VenCliHeader'))
		Set @TBC = ltrim(Rtrim('Cliente'))
		Set @TBD = ltrim(Rtrim('Clientes'))
	end

if @clipro='P'
	begin
		Set @TB = ltrim(Rtrim('CompProvHeader'))
		Set @TBC = ltrim(Rtrim('Proveedor'))
		Set @TBD = ltrim(Rtrim('Proveedores'))
	end

Set @C_String='
(
SELECT 
' + ltrim(rtrim(@TB)) + '.fecha, '

if @clipro='C'
	Set @C_String=@C_String+'TipVentModHeader.comprobante AS TP, '
else
	Set @C_String=@C_String+'TipCompModHeader.comprobante AS TP, '

Set @C_String=@C_String+'SUBSTRING(' + ltrim(rtrim(@TB)) + '.nrocomprobante,1,4) as PV, 
SUBSTRING(' + ltrim(rtrim(@TB)) + '.nrocomprobante,5,8) as NCO,
' + ltrim(rtrim(@TB)) + '.tipofactura, 
0 AS DEBE ,
' + ltrim(rtrim(@TB)) + '.totalimporte as Haber, 
0 AS SALDO,
' + ltrim(rtrim(@TB)) + '.cancelado, 
' + ltrim(rtrim(@TB)) + '.fecha1venc as Vencimiento, 
0 as serie,
' + ltrim(rtrim(@TB)) + '.idTransaccion, 
' + ltrim(rtrim(@TB)) + '.' + ltrim(rtrim(@TBC)) + ',  
' + ltrim(rtrim(@TBD)) + '.RazonSocial  FROM ' + ltrim(rtrim(@TB))  

if @clipro='C'
	begin
		Set @C_String=@C_String + ' INNER JOIN TipVentModHeader ON ' + ltrim(rtrim(@TB)) + '.tipocomprobante = TipVentModHeader.codigo 
					    INNER JOIN ' + ltrim(rtrim(@TBD)) + ' ON ' + ltrim(rtrim(@TB)) + '.Cliente = ' + ltrim(rtrim(@TBD)) + '.codigo
		Where TipVentModHeader.signo=2 and ' + ltrim(rtrim(@TBC)) + ' =' + cast(@Codigo as VARCHAR(6))
	end
else
	begin
		Set @C_String=@C_String + ' INNER JOIN TipCompModHeader ON ' + ltrim(rtrim(@TB)) + '.tipocomprobante = TipCompModHeader.codigo 
					    INNER JOIN ' + ltrim(rtrim(@TBD)) + ' ON ' + ltrim(rtrim(@TB)) + '.Proveedor = ' + ltrim(rtrim(@TBD)) + '.codigo
		Where TipCompModHeader.signo=2 and ' + ltrim(rtrim(@TBC)) + ' =' + cast(@Codigo as VARCHAR(6))
	end

if @C_Modo='A'
	begin
		Set @C_String=@C_String + 'and  (' + ltrim(rtrim(@TB)) + '.totalimporte<>' + ltrim(rtrim(@TB)) + '.Cancelado or ' + ltrim(rtrim(@TB)) + '.Cancelado is null )'
	end

Set @C_String=@C_String + ')
 Union
(
SELECT 
' + ltrim(rtrim(@TB)) + '.fecha, '

if @clipro='C'
	Set @C_String = @C_String + 'TipVentModHeader.comprobante AS TP, '
else
	Set @C_String = @C_String + 'TipCompModHeader.comprobante AS TP, '
	Set @C_String = @C_String + ' SUBSTRING(' + ltrim(rtrim(@TB)) + '.nrocomprobante,1,4) as PV, 
	SUBSTRING(' + ltrim(rtrim(@TB)) + '.nrocomprobante,5,8) as NCO,
	' + ltrim(rtrim(@TB)) + '.tipofactura, 
	' + ltrim(rtrim(@TB)) + '.totalimporte AS DEBE 
	,0 as Haber, 
	0 AS SALDO,
	' + ltrim(rtrim(@TB)) + '.cancelado, 
	' + ltrim(rtrim(@TB)) + '.fecha1venc as Vencimiento,  
	0 as serie,
	' + ltrim(rtrim(@TB)) + '.idTransaccion, 
	' + ltrim(rtrim(@TB)) + '.' + ltrim(rtrim(@TBC)) + ',  
	' + ltrim(rtrim(@TBD)) + '.RazonSocial  FROM ' + ltrim(rtrim(@TB))  

if @clipro='C'
	begin
		Set @C_String = @C_String + ' INNER JOIN TipVentModHeader ON ' + ltrim(rtrim(@TB)) + '.tipocomprobante = TipVentModHeader.codigo 
					      INNER JOIN ' + ltrim(rtrim(@TBD)) + ' ON ' + ltrim(rtrim(@TB)) + '.Cliente = ' + ltrim(rtrim(@TBD)) + '.codigo
		Where TipVentModHeader.signo=1 and ' + ltrim(rtrim(@TBC)) + ' =' + cast(@Codigo as VARCHAR(6))
	end
else
	begin
		Set @C_String = @C_String + ' INNER JOIN TipCompModHeader ON ' + ltrim(rtrim(@TB)) + '.tipocomprobante = TipCompModHeader.codigo 
					      INNER JOIN ' + ltrim(rtrim(@TBD)) + ' ON ' + ltrim(rtrim(@TB)) + '.Proveedor = ' + ltrim(rtrim(@TBD)) + '.codigo
		Where TipCompModHeader.signo=1 and ' + ltrim(rtrim(@TBC)) + ' =' + cast(@Codigo as VARCHAR(6))
	end

if @C_Modo='A'
	begin
		Set @C_String=@C_String + 'and  (' + ltrim(rtrim(@TB)) + '.totalimporte<>' + ltrim(rtrim(@TB)) + '.Cancelado or ' + ltrim(rtrim(@TB)) + '.Cancelado is null )'
	end
Set @C_String=@C_String + '
)
Order by ' + ltrim(rtrim(ltrim(rtrim(@TB)))) + '.Fecha
'

-- Print @C_String 

EXEC sp_executesql @C_String




GO
/****** Object:  StoredProcedure [dbo].[ListadoDetalleCtasCursos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


/*
Select * from listas 
where idAlumno=49
*/
-- ListadoCtasCursos 178

CREATE                   Procedure [dbo].[ListadoDetalleCtasCursos] -- 123
(
	@idCurso	int=153,
	@idAlumno	int=5173
)
as


Select 
cc.fecha,cc.concepto,cc.documentonumero,
isnull(acc.importe,cc.importe) * case when idtipodemovimiento=1 then 1 else 0 end Debe,
isnull(acc.importe,cc.importe) * case when idtipodemovimiento=1 then 0 else 1 end Haber,
al.idalumno,nyap,c.descripcion/*,
sum(isnull(acc.importe,cc.importe) * case when idtipodemovimiento=1 then 1 else -1 end )
*/
From Alumnos al
inner join listas li on al.idAlumno=li.idalumno 
 Left join CuentasCorrientes cc on al.idalumno=cc.socio
 left join aplicacionesCuentasCorrientes acc on cc.idtransaccion=acc.idtransaccion 
 left join DetalleCuentasCorrientes dcc on acc.idtransaccioncancelada=dcc.idtransaccion
inner join NominaCursos c on c.idcurso=isnull(dcc.concepto,cc.idcancelada)
/*left join aplicacionesCuentasCorrientes acc1 on cc.idtransaccion=acc1.idtransaccionCancelada*/
inner join ComprobantesCuentasCorrientes ccc on cc.concepto=ccc.comprobante 
where isnull(dcc.concepto,cc.idcancelada)=@idCurso
and cc.socio=@idAlumno
--and (cc.concepto='COB' or cc.concepto='DA') and entidad=2
--and cc.idtransaccion is null
--and cc.fecha Between @desde and @hasta
and cc.entidad=2
and li.idHorario=@idCurso
--Group by al.idalumno,nyap,c.descripcion

order by nyap







Select idalumno,idhorario,count(*) from listas
Group by idalumno,idhorario
having COunt(*)>1
order by idHorario




GO
/****** Object:  StoredProcedure [dbo].[ListadoDetalleMorosos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO





CREATE	 PROCEDURE [dbo].[ListadoDetalleMorosos]

	@Entidad int,
	@Meses int,
	@Filtro varchar(3)
		
AS

Declare @C_String nvarchar(4000)
Declare @Fecha datetime

set @Fecha = getdate()

if @Entidad = 0 
	begin
		set @C_String = 'SELECT a.Socio,Apellido,Nombre, a.cobrador,
	                    (Select Count(*) from CuentasCorrientes c where c.entidad=0 and a.Socio=c.Socio and c.importe<>c.Cancelado) as Meses, 
	                    (Select top 1 d.Observacion from Observaciones_Socios d where d.socio = a.Socio order by d.idCampo desc) as Observacion, 
	                    (Select max(cc.documentonumero) from cuentascorrientes cc where cc.concepto = "MES" and cc.cancelado <> 0 and cc.entidad = 0 and cc.socio = a.socio) as UltimoMesPago,
						(Select max(cc.fecha) from cuentascorrientes cc where (cc.concepto = "COB" or cc.concepto = "REN") and cc.cancelado <> 0 and cc.entidad = 0 and cc.socio = a.socio) as UltimaFechaPago, 
                    	(Select count(*) from conceptos_socios cs where cs.socio = a.socio and cs.fechabaja is null and cs.fechavigencia <= "' +  convert(varchar(50),@Fecha) + '")  as CantConceptos 
	                    FROM Socios a 
	                    Where (Select Count(*) from CuentasCorrientes c where c.entidad=0 and a.Socio=c.Socio and c.importe<>c.Cancelado)>=' + convert(char(3),@Meses) + '
	                    and a.fechabaja is null 
	                    and (a.Tarjeta = 0 or a.Tarjeta is Null) '

        If @Filtro <> 'T' 
            set @C_String = @C_String + ' and a.grupo = "' + @Filtro + '"'
	end
else
	begin
		set @C_String = 'SELECT a.Adherente,a.Apellido,a.Nombre, a.cobrador, 
                        (Select Count(*) from CuentasCorrientes c where c.entidad=1 and a.adherente=c.Socio and c.importe<>c.Cancelado) as Meses, 
                        (select top 1 d.Observacion from Observaciones_Adherentes d where d.Adherente = a.Adherente order by d.idCampo desc) as Observacion, 
                        (Select max(cc.documentonumero) from cuentascorrientes cc where cc.concepto = "MES" and cc.cancelado <> 0 and cc.entidad = 1 and cc.socio = a.adherente) as UltimoMesPago,
                        (Select max(cc.Fecha) from cuentascorrientes cc where (cc.concepto = "COB" or cc.concepto = "REN") and cc.cancelado <> 0 and cc.entidad = 1 and cc.socio = a.adherente) as UltimaFechaPago, 
                        (Select count(*) from conceptos_adherentes ca where ca.adherente = a.adherente and ca.fechabaja is null and ca.fechavigencia <= "' +  convert(varchar(50),@Fecha) + '") as CantConceptos 
                        FROM Adherentes a 
                        left join cobradores b on a.cobrador = b.cobrador 
	                  	Where (Select Count(*) from CuentasCorrientes c where c.entidad=1 and a.adherente=c.Socio and c.importe<>c.Cancelado)>=' + convert(varchar(3),@Meses) + '
	                         and a.fechabaja is null 
	                         and (a.Tarjeta = 0 or a.Tarjeta is Null) '

        If @Filtro <> 'T' 
            set @C_String = @C_String + ' and a.grupo = "' + @Filtro + '"'

	end

	set @C_String = @C_String + ' order by a.apellido, a.nombre ' 


/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String






GO
/****** Object:  StoredProcedure [dbo].[ListadoEdades]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO






CREATE      Procedure [dbo].[ListadoEdades]

	@Fecha		varchar(10),
	@Operador	char(1),
	@Edad		int,
	@Entidad	int,
	@Concepto	char(3)

AS
Declare @C_String 	as nvarchar(4000)
Declare @Base 		as varchar(20)
Declare @Campo 		as varchar(20)

/****************************************/
/* 	Armo campos segun entidad	*/
/****************************************/
if @Entidad = 0
	begin
		Set @Base = 'Socios'
		Set @Campo = 'socio'
	end
else
	begin
		Set @Base = 'Adherentes'
		Set @Campo = 'adherente'
	end


if @Entidad = 0
	begin
		Set @C_String = 'SELECT distinct so.Socio,Apellido,Nombre,Nacido,
						Domicilio, cpostal, localidad, telefono, numedocto, td.descripcion as DescDocu,  
						dbo.Edad(Nacido, convert(datetime,"' + @Fecha + '",103)) as Edad 
						FROM Socios so 
		                INNER JOIN Conceptos_Socios cs on so.socio = cs.socio 
						LEFT JOIN TiposDocumento td on so.tipodocto = td.tipodocto '

	end
else
	begin
		Set @C_String = 'SELECT distinct so.Adherente,Apellido,Nombre,Nacido,
						Domicilio, cpostal, localidad, telefono, numedocto, td.descripcion as DescDocu,  
						dbo.Edad(Nacido, convert(datetime,"' + @Fecha + '",103)) as Edad 
                		FROM Adherentes so 
                		INNER JOIN Conceptos_Adherentes cs on so.adherente = cs.adherente 
						LEFT JOIN TiposDocumento td on so.tipodocto = td.tipodocto '
	end


/****************************************/
/* Armo la sentencia Where		*/
/****************************************/
Set @C_String = @C_String + ' WHERE cs.fechabaja is null and dbo.Edad(Nacido, convert(datetime,"' + @Fecha + '",103)) '

if @Operador <> '*'
	Set @C_String = @C_String + @Operador + convert(char(3),@Edad)
else
	Set @C_String = @C_String + '=' + convert(char(3),@Edad)

if @Operador = '*'
	Set @C_String = @C_String + ' and month(nacido) = month(convert(datetime,"' + @Fecha + '",103))'


If @Concepto <> '' 
	Set @C_String = @C_String + ' and cs.concepto = "' + @Concepto + '"'


/****************************************/
/*	Armo el orden	 		*/
/****************************************/
Set @C_String = @C_String + ' ORDER BY apellido, nombre'


/****************************************/
/* 	Ejecuto la consulta 		*/
/****************************************/
EXEC sp_executesql @C_String







GO
/****** Object:  StoredProcedure [dbo].[ListadoEdadesSocios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  Procedure [dbo].[ListadoEdadesSocios]
as
Select socio,apellido,nombre,sx.descripcion,dbo.edad(nacido,getdate()) as edad 
from Socios sc
inner join sexos sx on 
sx.sexo=sc.sexo
where fechabaja is null
and dbo.edad(nacido,getdate()) between 20 and 65
order by apellido,nombre


GO
/****** Object:  StoredProcedure [dbo].[ListadoEdadesSocios_Resumen]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[ListadoEdadesSocios_Resumen]
as
Select s.descripcion,'21 a 25' as edad,count(*) as Cantidad
from socios ad
Left join sexos s
on ad.sexo=s.sexo
where fechabaja is null 
and dbo.edad(nacido,getdate()) between 21 and 25 
Group by s.descripcion
union
Select s.descripcion,'26 a 30' as edad,count(*) as Cantidad
from socios ad
Left join sexos s
on ad.sexo=s.sexo
where fechabaja is null 
and dbo.edad(nacido,getdate()) between 26 and 30
Group by s.descripcion
union
Select s.descripcion,'31 a 35' as edad,count(*) as Cantidad
from socios ad
Left join sexos s
on ad.sexo=s.sexo
where fechabaja is null 
and dbo.edad(nacido,getdate()) between 31 and 35
Group by s.descripcion
union
Select s.descripcion,'36 a 40' as edad,count(*) as Cantidad
from socios ad
Left join sexos s
on ad.sexo=s.sexo
where fechabaja is null 
and dbo.edad(nacido,getdate()) between 36 and 40
Group by s.descripcion
union
Select s.descripcion,'41 a 45' as edad,count(*) as Cantidad
from socios ad
Left join sexos s
on ad.sexo=s.sexo
where fechabaja is null 
and dbo.edad(nacido,getdate()) between 41 and 45
Group by s.descripcion
union
Select s.descripcion,'46 a 50' as edad,count(*) as Cantidad
from socios ad
Left join sexos s
on ad.sexo=s.sexo
where fechabaja is null 
and dbo.edad(nacido,getdate()) between 46 and 50
Group by s.descripcion
union
Select s.descripcion,'51 a 55' as edad,count(*) as Cantidad
from socios ad
Left join sexos s
on ad.sexo=s.sexo
where fechabaja is null 
and dbo.edad(nacido,getdate()) between 51 and 55
Group by s.descripcion
union
Select s.descripcion,'56 a 60' as edad,count(*) as Cantidad
from socios ad
Left join sexos s
on ad.sexo=s.sexo
where fechabaja is null 
and dbo.edad(nacido,getdate()) between 56 and 60
Group by s.descripcion
union
Select s.descripcion,'61 a 65' as edad,count(*) as Cantidad
from socios ad
Left join sexos s
on ad.sexo=s.sexo
where fechabaja is null 
and dbo.edad(nacido,getdate()) between 61 and 65
Group by s.descripcion



GO
/****** Object:  StoredProcedure [dbo].[ListadoEspecialidadesMedicos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE       Procedure [dbo].[ListadoEspecialidadesMedicos] 
	@Medico int, --0:Todos, 1:Medico, 2:No medico
	@Concepto char(3),
	@FechaHasta char(8),
	@CobradorDesde int = NULL,
	@CobradorHasta int = NULL
as

Declare @C_String as nvarchar(4000)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

if @medico<>4
	Begin
	Set @C_String='Select ad.TipoMatricula, tm.descripcion as DescMatricula, ad.NroMatricula, ad.Apellido, ad.Nombre, ad.Cobrador, '
	
				if @CobradorDesde = 1 or @CobradorDesde = 7 or @CobradorHasta = 1 or @CobradorHasta = 7 
					Set @C_String = @C_String + ' rtrim(ltrim(dbo.DescHospitalVoto(ad.Domicilio_Cobro))) as Domicilio_Cobro	'		
				else
					Set @C_String = @C_String + ' "" as Domicilio_Cobro	'		

	end


	if @Medico <> 0
		if @Medico = 1  --Medicos	
			Set @C_String= @C_String + ' where (select sum(b.medico) from especialidades_Adherentes a
													inner join especialidades b on a.especialidad = b.especialidad
													where a.adherente = ad.adherente) >= 1'
		else -- No medicos
			Set @C_String= @C_String + ' where (select sum(b.medico) from especialidades_Adherentes a
													inner join especialidades b on a.especialidad = b.especialidad
													where a.adherente = ad.adherente) = 0'

	if @CobradorDesde is not null and @CobradorDesde <> 0
		Set @C_String= @C_String + ' and  ad.Cobrador >= ' + rtrim(convert(char(5),@CobradorDesde))

	if @CobradorHasta is not null and @CobradorHasta <> 0
		Set @C_String= @C_String + ' and  ad.Cobrador <= ' + rtrim(convert(char(5),@CobradorHasta))

		/**** Armo el orden de la consulta ****/
		if @CobradorDesde = 1 or @CobradorDesde = 7 or @CobradorHasta = 1 or @CobradorHasta = 7 
			Set @C_String=@C_String + ' order by 	rtrim(ltrim(dbo.DescHospitalVoto(ad.Domicilio_Cobro))), ad.apellido, ad.nombre '
		else
			Set @C_String=@C_String + ' Order by ad.Cobrador, ad.apellido, ad.nombre'




/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String











GO
/****** Object:  StoredProcedure [dbo].[ListadoFondosFijos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO





CREATE      Procedure [dbo].[ListadoFondosFijos]

	@Operacion	int = Null,
	@Usuario	int

AS
Declare @C_String nvarchar(4000)

set @C_String = 'Select	A01.idOperacion, A01.fecha,	A01.cuenta as CuentaRecibo, A01.ComprobanteNumero, 
						A03.nrocomprobante, 
						A04.Importe as ImporteItem,		
						A05.comprobante as TipoComprobante,
						A06.proveedor, A06.razonsocial as DescProveedor,
						A07.cuenta, A07.descripcion as DescCuenta, 
						A08.descripcion as DescCuentaRecibo,
						A09.haber as ImporteTotal, upper(dbo.NumLet(A09.haber)) as DescImporte, 
						A10.uName as Usuario
					from Header_Operaciones A01 
						inner join Detalle_Operaciones A02
							on A01.idOperacion = A02.idOperacion
						inner join CompFondosHeader A03
							on A02.idTransaccion = A03.idTransaccion
						inner join CompFondosItems A04
							on A03.Comprobante = A04.Comprobante
						inner join TipCompModHeader A05
							on A03.tipocomprobante = A05.codigo
						inner join ProvFondo A06
							on A03.Proveedor = A06.Proveedor
						inner join Cuentas A07
							on A06.cuenta = A07.cuenta
						inner join Cuentas A08
							on A01.cuenta = A08.cuenta
						inner join AsientosDiariosItems A09
							on A01.AsientoDiario = A09.Asiento and A01.AnioMes = A09.AnioMes and A09.TipoAsiento = 0 and A09.Haber <> 0 
						left join Usuarios_Tesoreria A10
							on A10.idUsuario = ' + convert(char(10),@Usuario) + '
					Where A01.TipodeOperacion = 0 '

if @Operacion is not null and @Operacion <> 0
	set @C_String =	@C_String + ' and A01.idOperacion = ' + convert(char(10),@Operacion)

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String



GO
/****** Object:  StoredProcedure [dbo].[ListadoImputaMuni]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


--Select max(idOperacion) from Header_operaciones where tipodeOperacion=90

-- ListadoImputaMuni (Select max(idOperacion) from Header_operaciones where tipodeOperacion=90)


CREATE       Procedure [dbo].[ListadoImputaMuni]

	@idOperacion numeric(18,0)

AS

Select ltrim(ho.nombre) as DescHospital,im.Hospital,SUM(pESOS) as PesosTotal
,case Avg(Porcentaje)
When 6 then 1
Else 0
END as P6
,case Avg(Porcentaje)
When 5 then 1
Else 0
END as P5
,case Avg(Porcentaje)
When 4.5 then 1
Else 0
END  as P45
,case Avg(Porcentaje)
When 2.5 then 1
Else 0
END as P25
,CASE sum(seguro) 
when 0 then 0
Else 1
END as seguro ,
isnull(Sum(Seguro),0) as PesosSeguro
from 
ListadoMuni(@idOperacion) im
left join hospitales ho 
on im.hospital = convert(varchar(6),ho.reparticion) + right(convert(char(5),ho.hospital + 10000),4)

Group by socio,im.hospital,ho.nombre



/*
select --hs.hospital, ltrim(ho.nombre) as DescHospital, 
--(Select top 1 hospital from Hospitales_socios where socio=cc.socio) as Hospital,
sum(dbo.Porcentaje_25(cc.idtransaccion)) as Porcentaje_25,
sum(dbo.Porcentaje_45(cc.idtransaccion)) as Porcentaje_45,
sum(dbo.Porcentaje_5(cc.idtransaccion)) as Porcentaje_5,
sum(dbo.Porcentaje_6(cc.idtransaccion)) as Porcentaje_6,
sum(dbo.Porcentaje_Seguro(cc.idtransaccion)) as Porcentaje_Seguro,
sum(dbo.SumPorcentaje_25(cc.idtransaccion)) as SumPorcentaje_25,
sum(dbo.SumPorcentaje_45(cc.idtransaccion)) as SumPorcentaje_45,
sum(dbo.SumPorcentaje_5(cc.idtransaccion)) as SumPorcentaje_5,
sum(dbo.SumPorcentaje_6(cc.idtransaccion)) as SumPorcentaje_6,
sum(dbo.SumPorcentaje_Seguro(cc.idtransaccion)) as SumPorcentaje_Seguro
from detalle_operaciones do1
inner Join CuentasCorrientes cc on do1.idtransaccion=cc.idtransaccion and cc.entidad = 0
--inner join hospitales_socios hs on cc.socio = hs.socio
--left join hospitales ho 
--on hs.hospital = convert(varchar(6),ho.reparticion) + right(convert(char(5),ho.hospital + 10000),4)
where do1.idOperacion=14771
and do1.idtipotransaccion=0 and cc.concepto='COB'
--group by hs.hospital, ho.nombre

--group by Hospital

*/




GO
/****** Object:  StoredProcedure [dbo].[ListadoImputaMuni_Resumen]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE PROCEDURE [dbo].[ListadoImputaMuni_Resumen]

	@idOperacion numeric(18,0)	

AS

(select sum(dcc.importe) Importe, dcc.cantidad, co.descripcion
from detalle_operaciones do
inner Join CuentasCorrientes cc on do.idtransaccion=cc.idtransaccion and cc.entidad = 0 and cc.concepto='COB'
inner join aplicacionesCuentasCorrientes acc on cc.idtransaccion=acc.idtransaccion 
inner Join DetalleCuentasCorrientes dcc on acc.idtransaccionCancelada=dcc.idtransaccion 
inner join conceptos co on dcc.concepto = co.concepto
where do.idOperacion = @idOperacion
and do.idtipotransaccion=0 
and dcc.cantidad = 2.5 and dcc.concepto = 'C01'
group by dcc.cantidad, co.descripcion)
union
(select sum(dcc.importe) Importe, dcc.cantidad, 'F.E.M sin F.S.M.' as descripcion
from detalle_operaciones do
inner Join CuentasCorrientes cc on do.idtransaccion=cc.idtransaccion and cc.entidad = 0 and cc.concepto='COB'
inner join aplicacionesCuentasCorrientes acc on cc.idtransaccion=acc.idtransaccion 
inner Join DetalleCuentasCorrientes dcc on acc.idtransaccionCancelada=dcc.idtransaccion 
inner join conceptos co on dcc.concepto = co.concepto
where do.idOperacion = @idOperacion
and do.idtipotransaccion=0 
and dcc.cantidad = 2.5 and dcc.concepto <> 'C01'
group by dcc.cantidad, co.descripcion)
union
(select sum(dcc.importe) Importe, dcc.cantidad, co.descripcion
from detalle_operaciones do
inner Join CuentasCorrientes cc on do.idtransaccion=cc.idtransaccion and cc.entidad = 0 and cc.concepto='COB'
inner join aplicacionesCuentasCorrientes acc on cc.idtransaccion=acc.idtransaccion 
inner Join DetalleCuentasCorrientes dcc on acc.idtransaccionCancelada=dcc.idtransaccion 
inner join conceptos co on dcc.concepto = co.concepto
where do.idOperacion = @idOperacion
and do.idtipotransaccion=0 
and dcc.cantidad = 2
group by dcc.cantidad, co.descripcion)
union
(select sum(dcc.importe) Importe, dcc.cantidad, co.descripcion
from detalle_operaciones do
inner Join CuentasCorrientes cc on do.idtransaccion=cc.idtransaccion and cc.entidad = 0 and cc.concepto='COB'
inner join aplicacionesCuentasCorrientes acc on cc.idtransaccion=acc.idtransaccion 
inner Join DetalleCuentasCorrientes dcc on acc.idtransaccionCancelada=dcc.idtransaccion 
inner join conceptos co on dcc.concepto = co.concepto
where do.idOperacion = @idOperacion
and do.idtipotransaccion=0 
and dcc.cantidad = 1.5 
group by dcc.cantidad, co.descripcion)
order by importe desc





/*

select 

(select sum(dcc.importe) 
from detalle_operaciones do
inner Join CuentasCorrientes cc on do.idtransaccion=cc.idtransaccion and cc.entidad = 0 and cc.concepto='COB'
inner join aplicacionesCuentasCorrientes acc on cc.idtransaccion=acc.idtransaccion 
inner Join DetalleCuentasCorrientes dcc on acc.idtransaccionCancelada=dcc.idtransaccion 
where do.idOperacion = ho.idOperacion and do.idtipotransaccion=0 
and dcc.cantidad = 2.5 and dcc.concepto = 'C01') as P25,

(select sum(dcc.importe) 
from detalle_operaciones do
inner Join CuentasCorrientes cc on do.idtransaccion=cc.idtransaccion and cc.entidad = 0 and cc.concepto='COB'
inner join aplicacionesCuentasCorrientes acc on cc.idtransaccion=acc.idtransaccion 
inner Join DetalleCuentasCorrientes dcc on acc.idtransaccionCancelada=dcc.idtransaccion 
where do.idOperacion = ho.idOperacion and do.idtipotransaccion=0 
and dcc.cantidad = 2.5 and dcc.concepto <> 'C01') as P25_FEM,

(select sum(dcc.importe) 
from detalle_operaciones do
inner Join CuentasCorrientes cc on do.idtransaccion=cc.idtransaccion and cc.entidad = 0 and cc.concepto='COB'
inner join aplicacionesCuentasCorrientes acc on cc.idtransaccion=acc.idtransaccion 
inner Join DetalleCuentasCorrientes dcc on acc.idtransaccionCancelada=dcc.idtransaccion 
where do.idOperacion = ho.idOperacion and do.idtipotransaccion=0 
and dcc.cantidad = 2) as P2,

(select sum(dcc.importe) 
from detalle_operaciones do
inner Join CuentasCorrientes cc on do.idtransaccion=cc.idtransaccion and cc.entidad = 0 and cc.concepto='COB'
inner join aplicacionesCuentasCorrientes acc on cc.idtransaccion=acc.idtransaccion 
inner Join DetalleCuentasCorrientes dcc on acc.idtransaccionCancelada=dcc.idtransaccion 
where do.idOperacion = ho.idOperacion and do.idtipotransaccion=0 
and dcc.cantidad = 1.5) as P15

from Header_operaciones ho
where ho.idOperacion=@idOperacion

*/






GO
/****** Object:  StoredProcedure [dbo].[ListadoInconsistencias]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create procedure [dbo].[ListadoInconsistencias]
as
Select ih.col003 as cuil,ih.col001,ih.col002,ih.col004
--as Inconsistencias 
From ldsp580 ih
Left join Socios sc on sc.CuilMuni=ih.col003 
Left Join Socios sc1 on sc.Numedocto=substring(ih.col001,1,8) 
Where sc.socio Is Null 
Group by ih.col001,ih.col003,ih.col002,ih.col004


GO
/****** Object:  StoredProcedure [dbo].[ListadoInformeMensual_Altas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE            Procedure [dbo].[ListadoInformeMensual_Altas]
	@FechaDesde char(8)='20060701',
	@FechaHasta char(8)='20060731',
	@Cobrador int = NULL
as

Declare @C_String as nvarchar(4000)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

	Set @C_String='Select count(*) as CantRegistros, ad.Cobrador, cob.Nombre,isnull(cast(co.cobertura as char(3)),ca.concepto) Cobertura
					from Adherentes ad
						inner join conceptos_adherentes ca
							on ad.adherente = ca.adherente
						left join cobradores cob
							on ad.cobrador = cob.cobrador
						left join Conceptos co
							on ca.concepto=co.concepto
					where ca.Adherente=ca.Adherente ' -- ca.FechaBaja is null '

	--Fecha Desde
	if @FechaDesde <> ''
		Set @C_String= @C_String + ' and ca.FechaAlta >= "' + @FechaDesde + '"'

	--Fecha Hasta
	if @FechaHasta <> ''
		Set @C_String= @C_String + ' and ca.FechaAlta <= "' + @FechaHasta + '"'

	--Cobrador
	if @Cobrador <> 0
		Set @C_String= @C_String + ' and ad.Cobrador = ' + convert(varchar(10),@Cobrador)


	--Filtro para traer solamente los que son alta y no Cambios
	Set @C_String= @C_String + ' /* and (Select count(*) from conceptos_adherentes ca1
									where ((ca1.fechaalta >= "' + @FechaDesde + '" and ca1.FechaAlta <= "' + @FechaHasta + '") or
									(ca1.fechabaja >= "' + @FechaDesde + '" and ca1.Fechabaja <= "' + @FechaHasta + '"))
									and ca1.motivobaja = 17 and ca1.adherente = ca.adherente) = 0  */ '


	Set @C_String= @C_String + ' group by ad.Cobrador, cob.Nombre, isnull(cast(co.cobertura as char(3)),ca.concepto)'

	--Orden
	Set @C_String= @C_String + ' order by ad.Cobrador '


/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String

















GO
/****** Object:  StoredProcedure [dbo].[ListadoInformeMensual_Bajas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE             Procedure [dbo].[ListadoInformeMensual_Bajas]
	@FechaDesde char(8)='20050901',
	@FechaHasta char(8)='20050930',
	@Cobrador int = NULL
as

Declare @C_String as nvarchar(4000)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

	Set @C_String='Select count(*) as CantRegistros, ad.Cobrador, cob.Nombre, isnull(cast(co.cobertura as char(3)),ca.concepto) Cobertura,
						mb.Motivo, mb.Nombre as DescMotivoBaja, case when len(ltrim(rtrim(Global)))=0 then "I" when Global="G" then "C" else Global end Global
					from Adherentes ad
						inner join conceptos_adherentes ca
							on ad.adherente = ca.adherente
						left join cobradores cob
							on ad.cobrador = cob.cobrador
						left join MotivosBaja mb
							on mb.motivo = ca.MotivoBaja 
						left join Conceptos co
							on ca.concepto=co.concepto
					where ca.fechabaja is not null and ca.MotivoBaja <> 17  /* and ca.MotivoBaja <> 5 */ '

	--Fecha Desde
	if @FechaDesde <> ''
		Set @C_String= @C_String + ' and ca.FechaBaja >= "' + @FechaDesde + '"'

	--Fecha Hasta
	if @FechaHasta <> ''
		Set @C_String= @C_String + ' and ca.FechaBaja <= "' + @FechaHasta + '"'

	--Cobrador
	if @Cobrador <> 0
		Set @C_String= @C_String + ' and ad.Cobrador = ' + convert(varchar(10),@Cobrador)


	Set @C_String= @C_String + ' group by ad.Cobrador, cob.Nombre, isnull(cast(co.cobertura as char(3)),ca.concepto), mb.Motivo, mb.Nombre,case when len(ltrim(rtrim(Global)))=0 then "I" when Global="G" then "C" else Global end '

	--Orden
	Set @C_String= @C_String + ' order by 
case when len(ltrim(rtrim(Global)))=0 then "I" when Global="G" then "C" else Global end


,ad.Cobrador '


/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String


















GO
/****** Object:  StoredProcedure [dbo].[ListadoInformeMensual_Cambios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO



/*
Select * from Conceptos_adherentes 
where (motivobaja=17 or motivobaja=5)
and fechabaja between '20050901' and '20050930'
*/


CREATE         Procedure [dbo].[ListadoInformeMensual_Cambios] 
	@FechaDesde char(8)='20050901',
	@FechaHasta char(8)='20050930',
	@Cobrador int = NULL
as

Declare @C_String as nvarchar(4000)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

	Set @C_String='Select ca.concepto cConceptoActual,co.cobertura as ConceptoActual,ca1.concepto cConceptoAnt,co1.cobertura as ConceptoAnt,Count(*) casos,
			"de " + case when co1.cobertura=60 then " " else "" end + cast(co1.cobertura as char(3))+".000 a "+cast(co.cobertura as char(3))+".000" Grupo
					from Adherentes ad
						inner join conceptos_adherentes ca
							on ad.adherente = ca.adherente
						inner join conceptos_adherentes ca1
							on ca1.adherente = ca.adherente
								and ((ca1.fechaalta >= "' + @FechaDesde + '" and ca1.FechaAlta <= "' + @FechaHasta + '") or
									(ca1.fechabaja >= "' + @FechaDesde + '" and ca1.Fechabaja <= "' + @FechaHasta + '"))
									and (ca1.motivobaja = 17 or ca1.motivobaja = 5)
						left join Conceptos co
							on ca.concepto=co.concepto
						left join Conceptos co1
							on ca1.concepto=co1.concepto
					where ca.FechaBaja is null '

	--Fecha Desde
	if @FechaDesde <> ''
		Set @C_String= @C_String + ' and ca.FechaAlta >= "' + @FechaDesde + '"'

	--Fecha Hasta
	if @FechaHasta <> ''
		Set @C_String= @C_String + ' and ca.FechaAlta <= "' + @FechaHasta + '"'

	--Cobrador
	if @Cobrador <> 0
		Set @C_String= @C_String + ' and ad.Cobrador = ' + convert(varchar(10),@Cobrador)


	--Filtro para traer solamente los que son Cambios
	Set @C_String= @C_String + ' and (Select count(*) from conceptos_adherentes ca1
									where ((ca1.fechaalta >= "' + @FechaDesde + '" and ca1.FechaAlta <= "' + @FechaHasta + '") or
									(ca1.fechabaja >= "' + @FechaDesde + '" and ca1.Fechabaja <= "' + @FechaHasta + '"))
									and (ca1.motivobaja = 17 or ca1.motivobaja = 5) and ca1.adherente = ca.adherente) = 1 '

	-- Group by
	Set @C_String= @C_String + ' group by ca.concepto,co.cobertura,ca1.concepto, co1.cobertura '

	Set @C_String= @C_String + ' order by co.cobertura , co1.cobertura '		


/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String














GO
/****** Object:  StoredProcedure [dbo].[ListadoInformeMensual_MotivosBajas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE           Procedure [dbo].[ListadoInformeMensual_MotivosBajas]
	@FechaDesde char(8),
	@FechaHasta char(8),
	@Cobrador int = NULL
as

Declare @C_String as nvarchar(4000)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

	Set @C_String='Select count(*) as CantRegistros, mb.Motivo, mb.Nombre as DescMotivoBaja
					from Adherentes ad
						inner join conceptos_adherentes ca
							on ad.adherente = ca.adherente
						left join cobradores cob
							on ad.cobrador = cob.cobrador
						left join MotivosBaja mb
							on mb.motivo = ca.MotivoBaja 
						left join Conceptos co
							on ca.concepto=co.concepto
					where ca.fechabaja is not null and ca.MotivoBaja <> 17/*  and ca.MotivoBaja <> 5 */  '

	--Fecha Desde
	if @FechaDesde <> ''
		Set @C_String= @C_String + ' and ca.FechaBaja >= "' + @FechaDesde + '"'

	--Fecha Hasta
	if @FechaHasta <> ''
		Set @C_String= @C_String + ' and ca.FechaBaja <= "' + @FechaHasta + '"'

	--Cobrador
	if @Cobrador <> 0
		Set @C_String= @C_String + ' and ad.Cobrador = ' + convert(varchar(10),@Cobrador)


	Set @C_String= @C_String + ' group by mb.Motivo, mb.Nombre '

	--Orden
	Set @C_String= @C_String + ' order by mb.Nombre '


/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String




GO
/****** Object:  StoredProcedure [dbo].[ListadoInformeMensual_Vigentes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE             Procedure [dbo].[ListadoInformeMensual_Vigentes]
	@FechaHasta char(8)='20050731',
	@Cobrador int = NULL
as

Declare @C_String as nvarchar(4000)
Declare @boolWhere	as char(1)
Declare @fTitulo	as datetime

set @FechaHasta=cast(dbo.toaniomes(cast(@FechaHasta as datetime)+1) as char(6)) + '01'

set @fTitulo=cast(@FechaHasta as smalldatetime)

Set @boolWhere = 'N'

	Set @C_String='Select count(*) as CantRegistros, ad.Cobrador, cob.Nombre, 
	isnull(cast(co.cobertura as char(3)),ca.concepto) cobertura, 
	"01' + case when Month(@fTitulo) <10 then '0' else '' end+ rtrim(cast(Month(@fTitulo) as char(2))) + cast(year(@fTitulo) as char(4)) + '" as TopeVigentes
					from Adherentes ad
						inner join conceptos_adherentes ca
							on ad.adherente = ca.adherente
						left join cobradores cob
							on ad.cobrador = cob.cobrador
						left join Conceptos co
							on ca.concepto=co.concepto
					where (ca.fechabaja is null or ca.fechabaja > "' + @FechaHasta + '")
					and ca.FechaVigencia <= "' + @FechaHasta + '"'

	--Cobrador
	if @Cobrador <> 0
		Set @C_String= @C_String + ' and ad.Cobrador = ' + convert(varchar(10),@Cobrador)

	Set @C_String= @C_String + ' group by ad.Cobrador, cob.Nombre, isnull(cast(co.cobertura as char(3)),ca.concepto) '

	--Orden
	Set @C_String= @C_String + ' order by cob.Nombre '


/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String


















GO
/****** Object:  StoredProcedure [dbo].[ListadoIngresosRendiciones_Conceptos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO





CREATE      procedure [dbo].[ListadoIngresosRendiciones_Conceptos]
-- ListadoIngresosRendiciones_Conceptos 57461,1

	@idOperacion int,
	@Entidad int

AS
Declare @C_String nvarchar(4000)
Declare @boolWhere char(1)

set @boolWhere = 'N'

set @C_String = '
Select sum(dcc.importe) as Importe,count(*) Casos, dcc.concepto, co.descripcion as DescConcepto,dcc.importe Parcial
from Detalle_Operaciones do
inner join CuentasCorrientes cc on cc.idTransaccion=do.idTransaccion and cc.concepto = "COB" and cc.entidad = ' + convert(char(1),@Entidad) + '
inner join AplicacionesCuentasCorrientes acc on acc.idTransaccion=cc.idTransaccion 
inner join CuentasCorrientes cc1 on cc1.idTransaccion=acc.idTransaccioncancelada
inner join detalleCuentasCorrientes dcc on dcc.idTransaccion=cc1.idTransaccion 
inner join conceptos co on co.concepto = dcc.concepto
Where idtipoTransaccion=0 and idOperacion= ' + convert(char(7), @idOperacion) + '
group by dcc.concepto, co.descripcion,dcc.importe
order by dcc.concepto'


/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String
























GO
/****** Object:  StoredProcedure [dbo].[ListadoIngresosRendiciones_Header]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO





CREATE      procedure [dbo].[ListadoIngresosRendiciones_Header]

	@idOperacion int,
	@Entidad int

AS
Declare @C_String nvarchar(4000)
Declare @boolWhere char(1)

set @boolWhere = 'N'

set @C_String = 'Select do.idoperacion, do.idtransaccion, cc.idopcobrador, cc.socio, so.apellido, so.nombre, cc1.importe,
cc.documentonumero as NumeroRecibo, cc1.documentonumero as Mes, cc.serie
from Detalle_Operaciones do
inner join CuentasCorrientes cc on cc.idTransaccion=do.idTransaccion and cc.concepto = "COB" and cc.entidad = ' + convert(char(1),@Entidad) + '
inner join AplicacionesCuentasCorrientes acc on acc.idTransaccion=cc.idTransaccion 
inner join CuentasCorrientes cc1 on cc1.idTransaccion=acc.idTransaccioncancelada '

if @Entidad = 0 
	set @C_String =  @C_String + ' inner join Socios so on cc.socio = so.Socio '
else
	set @C_String =  @C_String + ' inner join adherentes so on cc.socio = so.adherente '

set @C_String =  @C_String + ' Where idtipoTransaccion=0 and idOperacion= ' + convert(char(7), @idOperacion)

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String
























GO
/****** Object:  StoredProcedure [dbo].[ListadoIngresosRendiciones_Operaciones]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO






CREATE       procedure [dbo].[ListadoIngresosRendiciones_Operaciones]

	@idOperacion int,
	@Entidad int
AS
Declare @C_String nvarchar(4000)
Declare @boolWhere char(1)

set @boolWhere = 'N'

set @C_String = 'Select distinct cc.idopcobrador, do.idoperacion, cc.entidad,
(Select count(*) from Detalle_Operaciones do1
inner join CuentasCorrientes cc1 on cc1.idTransaccion=do1.idTransaccion and cc1.entidad = ' + convert(char(1),@Entidad) + '
Where do1.idtipoTransaccion=0 and cc1.concepto = "COB" and do1.idOperacion=do.idOperacion) as CantRecibos,
(Select count(*) from Detalle_Operaciones do1
inner join ValoresTesoreria vt1 on vt1.idTransaccion=do1.idTransaccion
Where do1.idtipoTransaccion=2 and vt1.idconcepto_tesoreria = 6
and do1.idOperacion=do.idOperacion) as CantCheques,
(Select sum(importe) from Detalle_Operaciones do1
inner join ValoresTesoreria vt1 on vt1.idTransaccion=do1.idTransaccion
Where do1.idtipoTransaccion=2 and vt1.idconcepto_tesoreria = 6
and do1.idOperacion=do.idOperacion) as TotalCheques,
(Select sum(importe) from Detalle_Operaciones do1
inner join ValoresTesoreria vt1 on vt1.idTransaccion=do1.idTransaccion
Where do1.idtipoTransaccion=2 and vt1.idconcepto_tesoreria = 1 -- and vt1.idconcepto_tesoreria <> 10
and do1.idOperacion=do.idOperacion) as TotalEfectivo,
(Select sum(importe) from Detalle_Operaciones do1
inner join ValoresTesoreria vt1 on vt1.idTransaccion=do1.idTransaccion
Where do1.idtipoTransaccion=2 and vt1.idconcepto_tesoreria <> 1 and vt1.idconcepto_tesoreria <> 6
and do1.idOperacion=do.idOperacion) as TotalOtros,
(select sum(cc1.importe) from Detalle_Operaciones do1
inner join CuentasCorrientes cc1 on cc1.idTransaccion=do1.idTransaccion and cc1.entidad = ' + convert(char(1),@Entidad) + '
Where do1.idtipoTransaccion=0 and cc1.concepto = "COB" and do1.idOperacion=do.idOperacion) as TotalRendiciones
from Detalle_Operaciones do
inner join CuentasCorrientes cc on cc.idTransaccion=do.idTransaccion and cc.entidad = ' + convert(char(1),@Entidad) + '
Where idtipoTransaccion=0 and idOperacion= ' + convert(char(7), @idOperacion)

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String









GO
/****** Object:  StoredProcedure [dbo].[ListadoIngresosRendiciones_Valores]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE   procedure [dbo].[ListadoIngresosRendiciones_Valores]

	@idOperacion int

AS
Declare @C_String nvarchar(4000)
Declare @boolWhere char(1)

set @boolWhere = 'N'

set @C_String = 'Select vt.idopcobrador, vt.idconcepto_tesoreria, vt.fechaemision, vt.cuenta, vt.sucursal,
vt.numero, vt.importe, ba.descripcion as banco
from Detalle_Operaciones do
inner join ValoresTesoreria vt on vt.idTransaccion=do.idTransaccion
left join bancos ba on ba.banco = vt.banco
Where idtipoTransaccion=2 and idOperacion= ' + convert(char(7), @idOperacion)

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String






GO
/****** Object:  StoredProcedure [dbo].[ListadoIngresosTotales]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE   Procedure [dbo].[ListadoIngresosTotales] 
(
	@Desde		char(8)='20060301',
	@Hasta		char(8)='20060331',
	@Entidad	int=2,
	@idCurso	char(3)='170'
)
as
Select distinct fecha,cc.documentoNumero,cc.socio,nyap,acc.importe Importe,dcc.idtransaccion
from CuentasCorrientes cc
inner join aplicacionesCuentasCorrientes acc
on cc.idtransaccion=acc.idtransaccion
inner join DetalleCuentasCorrientes dcc
on acc.idtransaccioncancelada=dcc.idtransaccion
inner join alumnos al 
on cc.socio=al.idalumno 
where entidad=@Entidad
and fecha Between @desde and @hasta
and (cc.concepto='COB' or cc.concepto='DA')
and isnull(dcc.concepto,idcancelada)=@idcurso
order by fecha,cc.documentoNumero



GO
/****** Object:  StoredProcedure [dbo].[listadoJuicios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  Procedure [dbo].[listadoJuicios]
(
	@Desde		char(8)='20060101',
	@Hasta		char(8)='20060228'/*,
	@idJuicio	int=0*/
)
as
Select idjuicio,Caratula,Estado,
lHecho,Compania,jurisdiccion,Monto,isnull((Select sum(importe) from PagosJuicios
where idJuicio=bj.idjuicio),0) Pagos
from basejuicios bj
where dCarga between @Desde and @Hasta
--and (bj.idjuicio=@idJuicio or @idJuicio=0)


GO
/****** Object:  StoredProcedure [dbo].[listadoJuiciosFechas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[listadoJuiciosFechas]
(
	@idJuicio	int=0
)
as
Select bj.idjuicio,desde,hasta
from basejuicios bj
inner join fechasjuicios fj on bj.idJuicio=fj.idjuicio
where bj.idjuicio=@idJuicio








GO
/****** Object:  StoredProcedure [dbo].[listadoJuiciosSocios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  Procedure [dbo].[listadoJuiciosSocios]
(
	@idJuicio	int=0
)
as
Select idjuicio,Caratula,Estado,rtrim(isnull(sc.apellido,ad.apellido))+ ', '+ rtrim(isnull(sc.nombre,ad.nombre)) Nyap,
case when sc.socio is null then 'Adherente' else 'Socio' end Calidad, 
isnull(sc.socio,ad.Adherente) Socio,
lHecho,Compania,jurisdiccion,Monto
from basejuicios bj
inner join sociosbasejuicios sbj on bj.idjuicio=sbj.juicio
Left join socios sc on sc.socio=sbj.socio and sbj.entidad=0
Left join Adherentes ad on ad.adherente=sbj.socio and sbj.entidad=1
where bj.idjuicio=@idJuicio




GO
/****** Object:  StoredProcedure [dbo].[ListadoMaestroPersonal]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE   Procedure [dbo].[ListadoMaestroPersonal]

	@LegajoDesde		int = Null, 
	@LegajoHasta		int = Null
 
AS
Declare @C_String as nvarchar(4000)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

Set @C_String='(Select 	A01.legajo, A01.apellido, A01.nombre, A02.descripcion as TipoDocu,
			A01.numero as NumeroDocu, A01.fechanacimiento, A01.cuil, 
			A01.domicilio, A01.obrasocial, A01.cpostal, A01.telefono, 
			A03.descripcion as Localidad, A04.descripcion as EstadoCivil, 
			A05.descripcion as CalifProfesional, A06.descripcion as Categoria
		From maestropersonal A01
			Inner join TiposDocumento A02
				on A02.tipodocto = A01.tipodocumento
			inner join Localidades A03
				on A03.localidad = A01.localidad
			inner join EstadosCivil A04
				on A04.estadocivil = A01.estadocivil
			inner join CalificProfesionales A05
				on A05.califprofesional = A01.califprofesional
			inner join Categorias A06
				on A06.categoria = A01.categoria '

	/**** Armo las condiciones ****/
	if @LegajoDesde is not null and @LegajoDesde <> 0
		begin
			set @boolWhere = 'S'	
			Set @C_String= @C_String + ' where A01.legajo >= ' + convert(char(10),@LegajoDesde)
		end

	if @LegajoHasta is not null and @LegajoHasta <> 0
		begin
			if @boolWhere = 'S'
				Set @C_String= @C_String + ' and  A01.legajo <= ' + convert(char(10),@LegajoHasta)
			else
				Set @C_String= @C_String + ' where  A01.legajo <= ' + convert(char(10),@LegajoHasta)
		end

	/**** Armo el orden de la consulta ****/
	Set @C_String=@C_String + ')Order by apellido, nombre'

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String




GO
/****** Object:  StoredProcedure [dbo].[ListadoMaestroPersonalAmpliado]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE   Procedure [dbo].[ListadoMaestroPersonalAmpliado]

	@LegajoDesde		int = Null, 
	@LegajoHasta		int = Null
 
AS
Declare @C_String 	as nvarchar(4000)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

Set @C_String='(Select 	A01.Legajo, A01.Apellido, A01.Nombre, A02.Descripcion as DescEstadoPersonal, A03.Descripcion as DescCentroCosto,
	A04.Descripcion as DescModalidad, A01.jornalBasico, A01.JornalaCuenta,
	A01.Telefono, A01.Domicilio, A05.Descripcion as Localidad, A01.CPostal,
	A06.descripcion as TipoDocu, A01.numero as NumeroDocu, A01.Cuil,
	A01.FechaNacimiento, A07.descripcion as EstadoCivil, A01.Adherentes,
	A08.Descripcion as ObraSocial, A09.Descripcion as Sindicato,
	A10.descripcion as CalifProfesional, A11.Descripcion as Categoria,
	A12.Descripcion as TareaCumplida, A13.Descripcion as CodigoActividad,
	A14.Descripcion as ZonaGeografica, A15.Descripcion as Situacion,
	A16.Descripcion as Condicion, A17.Descripcion as ModoAntiguedad,
	A18.Descripcion as SistemaJubilacion, A01.Jubilado
From maestropersonal A01
	inner join EstadosPersonal A02
		on A01.Estado = A02.Estado
	inner join CentrosdeCostos A03
		on A01.centrocosto = A03.centrocosto
	inner join ModalidadesPersonal A04
		on A01.Modalidad = A04.Modalidad
	inner join Localidades A05
		on A01.Localidad = A05.Localidad
	Inner join TiposDocumento A06
		on A06.tipodocto = A01.tipodocumento
	inner join EstadosCivil A07
		on A07.estadocivil = A01.estadocivil
	inner join ObrasSociales A08
		on A08.ObraSocial = A01.ObraSocial
	inner join Sindicatos A09
		on A09.sindicato = A01.sindicato
	inner join CalificProfesionales A10
		on A10.califprofesional = A01.califprofesional
	inner join Categorias A11
		on A11.categoria = A01.categoria 
	inner join TareasCumplidas A12
		on A01.TareaCumplida = A12.TareaCumplida
	inner join CodigosActividades A13
		on A01.CodigoActividad = A13.CodigoActividad
	inner join ZonasGeograficas A14
		on A01.ZonaGeografica = A14.ZonaGeografica
	inner join Situaciones A15
		on A01.Situacion = A15.Situacion
	inner join Condiciones A16
		on A01.Condicion = A16.Condicion
	inner join ModoAntiguedad A17
		on A01.ModoAntiguedad = A17.ModoAntiguedad
	inner join SistemasJubilacion A18
		on A18.SistemaJubilacion = A01.SistemaJubilacion '

	/**** Armo las condiciones ****/
	if @LegajoDesde is not null and @LegajoDesde <> 0
		begin
			set @boolWhere = 'S'	
			Set @C_String= @C_String + ' where A01.legajo >= ' + convert(char(10),@LegajoDesde)
		end

	if @LegajoHasta is not null and @LegajoHasta <> 0
		begin
			if @boolWhere = 'S'
				Set @C_String= @C_String + ' and  A01.legajo <= ' + convert(char(10),@LegajoHasta)
			else
				Set @C_String= @C_String + ' where  A01.legajo <= ' + convert(char(10),@LegajoHasta)
		end

	/**** Armo el orden de la consulta ****/
	Set @C_String=@C_String + ')Order by apellido, nombre'

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String




GO
/****** Object:  StoredProcedure [dbo].[ListadoMorosos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO






CREATE	 PROCEDURE [dbo].[ListadoMorosos] -- 1,3,'T'

	@Entidad int,
	@Meses int,
	@Filtro varchar(3)
		
AS

Declare @C_String nvarchar(4000)
Declare @Fecha datetime

set @Fecha = getdate()

if @Entidad = 0 
	begin
		set @C_String = 'SELECT a.Socio,Apellido,Nombre, a.cobrador,
	                    (Select Count(*) from CuentasCorrientes c where c.entidad=0 and a.Socio=c.Socio and c.importe<>c.Cancelado) as Meses, 
	                    (Select top 1 cast(d.Observacion as varchar(500)) as Observacion from Observaciones_Socios d where d.socio = a.Socio order by d.idCampo desc) as Observacion, 
	                    (Select max(cc.documentonumero) from cuentascorrientes cc where cc.concepto = "MES" and cc.cancelado <> 0 and cc.entidad = 0 and cc.socio = a.socio) as UltimoMesPago,
						(Select max(cc.fecha) from cuentascorrientes cc where (cc.concepto = "COB" or cc.concepto = "REN") and cc.cancelado <> 0 and cc.entidad = 0 and cc.socio = a.socio) as UltimaFechaPago, 
                    	(Select count(*) from conceptos_socios cs where cs.socio = a.socio and cs.fechabaja is null and cs.fechavigencia <= "' +  convert(varchar(50),@Fecha) + '")  as CantConceptos 
	                    FROM Socios a 
	                    Where (Select Count(*) from CuentasCorrientes c where c.entidad=0 and a.Socio=c.Socio and c.importe<>c.Cancelado)>=' + convert(char(3),@Meses) + '
	                    and a.fechabaja is null 
	                    and (a.Tarjeta = 0 or a.Tarjeta is Null) '

        If @Filtro <> 'T' 
            set @C_String = @C_String + ' and a.grupo = "' + @Filtro + '"'
	end
else
	begin
		set @C_String = 'SELECT a.Adherente as socio,a.Apellido,a.Nombre, a.cobrador, 
                        (Select Count(*) from CuentasCorrientes c where c.entidad=1 and a.adherente=c.Socio and c.importe<>c.Cancelado) as Meses, 
	                    (Select top 1 cast(d.Observacion as varchar(500)) as Observacion from Observaciones_Adherentes d where d.Adherente = a.Adherente order by d.idCampo desc) as Observacion, 
                        (Select max(cc.documentonumero) from cuentascorrientes cc where cc.concepto = "MES" and cc.cancelado <> 0 and cc.entidad = 1 and cc.socio = a.adherente) as UltimoMesPago,
                        (Select max(cc.Fecha) from cuentascorrientes cc where (cc.concepto = "COB" or cc.concepto = "REN") and cc.cancelado <> 0 and cc.entidad = 1 and cc.socio = a.adherente) as UltimaFechaPago, 
                        (Select count(*) from conceptos_adherentes ca where ca.adherente = a.adherente and ca.fechabaja is null and ca.fechavigencia <= "' +  convert(varchar(50),@Fecha) + '") as CantConceptos 
                        FROM Adherentes a 
                        left join cobradores b on a.cobrador = b.cobrador 
	                  	Where (Select Count(*) from CuentasCorrientes c where c.entidad=1 and a.adherente=c.Socio and c.importe<>c.Cancelado)>=' + convert(varchar(3),@Meses) + '
	                         and a.fechabaja is null 
	                         and (a.Tarjeta = 0 or a.Tarjeta is Null) '

/*		If @Filtro <> '0'
            set @C_String = @C_String + ' and a.cobrador = ' + @Filtro  */

        If @Filtro <> 'T' 
            set @C_String = @C_String + ' and a.cobrador = "' + @Filtro + '"'


	end

	set @C_String = @C_String + ' order by a.apellido, a.nombre ' 


/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String







GO
/****** Object:  StoredProcedure [dbo].[ListadoNovedadesyConceptos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO






CREATE      Procedure [dbo].[ListadoNovedadesyConceptos]

	@TipoConsulta		char(1),
	@LegajoDesde		int = Null, 
	@LegajoHasta		int = Null,
	@ConceptoDesde		int = null,
	@ConceptoHasta		int = null
 
AS
Declare @C_String as nvarchar(4000)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

/****************************************************************/
/*  		Consulta para Novedades solamente  		*/
/****************************************************************/
if @TipoConsulta = 'N' -- Novedades
begin
	Set @C_String = 'Select	A01.Legajo, A03.Apellido, A03.Nombre,
				A01.Concepto, A02.Descripcion as DescConcepto, A01.Importe,
				"NOVEDAD" as Tipo
			from ConceptosLegajosNovedades A01
				inner join ConceptosLiquidacion A02
					on A01.concepto = A02.concepto
				inner join MaestroPersonal A03
					on A01.legajo = A03.legajo '
end

/****************************************************************/
/*  		Consulta para Conceptos solamente  		*/
/****************************************************************/
if @TipoConsulta = 'S' -- Semifijos
begin
	Set @C_String='Select 	A01.Legajo, A03.Apellido, A03.Nombre,
				A01.Concepto, A02.Descripcion as DescConcepto, A01.Importe,
				"SEMIFIJO" as Tipo
			from ConceptosLegajos A01
				inner join ConceptosLiquidacion A02
					on A01.concepto = A02.concepto
				inner join MaestroPersonal A03
					on A01.legajo = A03.legajo '
end


/************************************************************************/
/* 	Armo las condiciones para las consultas Indivuduales 		*/
/************************************************************************/
if @ConceptoDesde is not null and @ConceptoDesde <> 0
	begin
		Set @boolWhere = 'S'	
		Set @C_String= @C_String + ' where A01.Concepto >= ' + convert(char(3),@ConceptoDesde)
	end

if @ConceptoHasta is not null and @ConceptoHasta <> 0
	begin
		if @boolWhere = 'S'
			Set @C_String= @C_String + ' and  A01.Concepto <= ' + convert(char(3),@ConceptoHasta)
		else
		begin
			Set @boolWhere = 'S'	
			Set @C_String= @C_String + ' where  A01.Concepto <= ' + convert(char(3),@ConceptoHasta)
		end
	end

if @LegajoDesde is not null and @LegajoDesde <> 0
	begin
		if @boolWhere = 'S'
			Set @C_String= @C_String + ' and A01.legajo >= ' + convert(char(10),@LegajoDesde)
		else
		begin
			Set @boolWhere = 'S'	
			Set @C_String= @C_String + ' where A01.legajo >= ' + convert(char(10),@LegajoDesde)
		end
	end

if @LegajoHasta is not null and @LegajoHasta <> 0
	begin
		if @boolWhere = 'S'
			Set @C_String= @C_String + ' and  A01.legajo <= ' + convert(char(10),@LegajoHasta)
		else
		begin
			Set @boolWhere = 'S'	
			Set @C_String= @C_String + ' where  A01.legajo <= ' + convert(char(10),@LegajoHasta)
		end
	end


/************************************************************************/
/*  		Consulta para Novedades y Coneceptos  			*/
/************************************************************************/
if @TipoConsulta = 'T' -- Todos
begin
	Set @C_String='Select 	A01.legajo, A01.Apellido, A01.Nombre,
				A02.Concepto, A03.Descripcion as DescConcepto, A02.Importe,
				"NOVEDAD" as Tipo
			from MaestroPersonal A01
				inner join ConceptosLegajosNovedades A02
					on A01.legajo = A02.legajo
				inner join ConceptosLiquidacion A03
					on A02.concepto = A03.concepto '

	/*** Armo las condiciones de concepto ***/
	if @ConceptoDesde is not null and @ConceptoDesde <> 0
		begin
			Set @boolWhere = 'S'	
			Set @C_String= @C_String + ' where A02.Concepto >= ' + convert(char(3),@ConceptoDesde)
		end
	
	if @ConceptoHasta is not null and @ConceptoHasta <> 0
		begin
			if @boolWhere = 'S'
				Set @C_String= @C_String + ' and  A02.Concepto <= ' + convert(char(3),@ConceptoHasta)
			else
			begin
				set @boolWhere = 'S'	
				Set @C_String= @C_String + ' where  A02.Concepto <= ' + convert(char(3),@ConceptoHasta)
			end
		end

	/***   Armo las condiciones para el Legajo  ***/
	if @LegajoDesde is not null and @LegajoDesde <> 0
		begin
			if @boolWhere = 'S'
				Set @C_String= @C_String + ' and A01.legajo >= ' + convert(char(10),@LegajoDesde)
			else
			begin
				set @boolWhere = 'S'	
				Set @C_String= @C_String + ' where A01.legajo >= ' + convert(char(10),@LegajoDesde)
			end
		end
	
	if @LegajoHasta is not null and @LegajoHasta <> 0
		begin
			if @boolWhere = 'S'
				Set @C_String= @C_String + ' and  A01.legajo <= ' + convert(char(10),@LegajoHasta)
			else
			begin
				set @boolWhere = 'S'	
				Set @C_String= @C_String + ' where  A01.legajo <= ' + convert(char(10),@LegajoHasta)
			end
		end

Set @C_String= @C_String + ' Union
				Select 	A01.legajo, A01.Apellido, A01.Nombre,
					A02.Concepto, A03.Descripcion as DescConcepto, A02.Importe,
					"SEMIFIJO" as Tipo
				from MaestroPersonal A01
					inner join ConceptosLegajos A02
						on A01.legajo = A02.legajo
					inner join ConceptosLiquidacion A03
						on A02.concepto = A03.concepto '

	/*** Armo las condiciones de concepto ***/
	if @ConceptoDesde is not null and @ConceptoDesde <> 0
		begin
			Set @boolWhere = 'S'	
			Set @C_String= @C_String + ' where A02.Concepto >= ' + convert(char(3),@ConceptoDesde)
		end
	
	if @ConceptoHasta is not null and @ConceptoHasta <> 0
		begin
			if @boolWhere = 'S'
				Set @C_String= @C_String + ' and  A02.Concepto <= ' + convert(char(3),@ConceptoHasta)
			else
			begin
				set @boolWhere = 'S'	
				Set @C_String= @C_String + ' where  A02.Concepto <= ' + convert(char(3),@ConceptoHasta)
			end
		end

	/***   Armo las condiciones para el Legajo  ***/
	if @LegajoDesde is not null and @LegajoDesde <> 0
		begin
			if @boolWhere = 'S'
				Set @C_String= @C_String + ' and A01.legajo >= ' + convert(char(10),@LegajoDesde)
			else
			begin
				set @boolWhere = 'S'	
				Set @C_String= @C_String + ' where A01.legajo >= ' + convert(char(10),@LegajoDesde)
			end
		end
	
	if @LegajoHasta is not null and @LegajoHasta <> 0
		begin
			if @boolWhere = 'S'
				Set @C_String= @C_String + ' and  A01.legajo <= ' + convert(char(10),@LegajoHasta)
			else
			begin
				set @boolWhere = 'S'	
				Set @C_String= @C_String + ' where  A01.legajo <= ' + convert(char(10),@LegajoHasta)
			end
		end
end


/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String






GO
/****** Object:  StoredProcedure [dbo].[ListadoOtrosConceptos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE  Procedure [dbo].[ListadoOtrosConceptos]

	@ConceptoDesde		int = Null ,
	@ConceptoHasta		int = Null

AS
Declare @C_String 	as nvarchar(4000)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

Set @C_String='(Select 	A01.*, A02.descripcion as DescCuenta 
		from OtrosConceptos A01
			Left join cuentas A02
				on A01.imputacion_contable = A02.cuenta '

	/**** Armo las condiciones ****/
	if @ConceptoDesde is not null and @ConceptoDesde <> 0
		begin
			set @boolWhere = 'S'	
			Set @C_String= @C_String + ' where A01.Concepto >= ' + convert(char(10),@ConceptoDesde)
		end
	if @ConceptoHasta is not null and @ConceptoHasta <> 0
		begin
			if @boolWhere = 'S'
				Set @C_String= @C_String + ' and  A01.Concepto <= ' + convert(char(10),@ConceptoHasta)
			else
				Set @C_String= @C_String + ' where  A01.Concepto <= ' + convert(char(10),@ConceptoHasta)
		end


	/**** Armo el orden de la consulta ****/
	Set @C_String=@C_String + ')order by A01.descripcion'

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String



GO
/****** Object:  StoredProcedure [dbo].[ListadoOtrosIngresos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[ListadoOtrosIngresos]
(
	@Concepto	int,
	@Desde		char(8),
	@Hasta		char(8)
)
as

Select 
oi.concepto,	
fecha,
ah.asientodiario		Asiento, 
oi.ApellidoNombre		nyap,
ah.Observacion			Comprobante,
ObservacionComprobante	Detalle,
haber					Importe,
coi.Descripcion			CuentaOI,
ct.descripcion			CuentaContable

from detalleOtrosingresos oi
inner join header_Operaciones ah
on oi.asiento=ah.asientoDiario
and oi.aniomes=ah.aniomes
and oi.tipoasiento=ah.tipoasiento
inner join asientosdiariositems ai
on oi.asiento=ai.asiento
and oi.aniomes=ai.aniomes
and oi.tipoasiento=ai.tipoasiento
and oi.item=ai.item
inner join OtrosConceptos coi
on oi.concepto=coi.concepto
inner join cuentas ct
on ct.cuenta=coi.imputacion_contable
Where 
(coi.Concepto=@Concepto)
and ah.fecha between @Desde and @Hasta
order by coi.Concepto,fecha




GO
/****** Object:  StoredProcedure [dbo].[ListadoRecibosAdherentes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO





CREATE     Procedure [dbo].[ListadoRecibosAdherentes]

/*
	@SocioDesde		int = Null, 
	@SocioHasta		int = Null, 
	@Entidad		int	
 
*/
AS
Declare @C_String 	as nvarchar(4000)


Set @C_String='Select 	count(A01.adherente) as Adherentes, 
						A03.descripcion as DescEspecialidad, A04.Concepto, A05.descripcion as DescConcepto
				from adherentes A01
					inner join especialidades_adherentes A02
						on A01.adherente = A02.adherente
					inner join Especialidades A03
						on A02.especialidad = A03.especialidad
					inner join Conceptos_adherentes A04
						on A01.adherente = A04.adherente
					inner join Conceptos A05
						on A04.Concepto = A05.Concepto
				where A01.fechabaja is null '

	/**** Armo las condiciones ****/
/*
	if @SocioDesde is not null and @SocioDesde <> 0
		begin
			set @boolWhere = 'S'	
			Set @C_String= @C_String + ' where  A01.'+@Campo+' >= ' + convert(char(10),@SocioDesde)
		end
	if @SocioHasta is not null and @SocioHasta <> 0
		begin
			if @boolWhere = 'S'
				Set @C_String= @C_String + ' and  A01.'+@Campo+' <= ' + convert(char(10),@SocioHasta)			
			else
				Set @C_String= @C_String + ' where  A01.'+@Campo+' <= ' + convert(char(10),@SocioHasta)
		end
*/

	/**** Armo el orden de la consulta ****/
	Set @C_String=@C_String + ' group by A03.especialidad, A03.descripcion, A04.Concepto, A05.descripcion
								order by A04.concepto, A03.especialidad '

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String







GO
/****** Object:  StoredProcedure [dbo].[ListadoRecibosDebitos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[ListadoRecibosDebitos] 
-- ImpresionRecibosDebitos 0,0,0,9
(
	@idOperacion 	int=0,
	@dSocio		int=0,
	@hSocio		int=0,
	@Entidad	int=9
)
as
Select hda.fecha,hda.idrecibo,hDa.Socio,hda.Entidad,cc.importe as ImportePeriodo,
ltrim(rtrim(isnull(sc.apellido,isnull(ad.apellido,al.nyap))))+ ' ' +
ltrim(rtrim(isnull(sc.Nombre,isnull(ad.NOmbre,'')))) nyap,
cc.documentoNumero,hda.importe,hDa.idOperacion,dbo.numlet(hDA.importe) ImporteLetras,
pDesde,pHasta,
Case when hda.Entidad=0 then 'Socios'
when hda.Entidad=1 then 'Foprosa'
when hda.Entidad=2 then 'IDHS'
end dEntidad
from Header_RecibosDA hDA
inner join Detalle_recibosDA dDa
on hDa.idrecibo=dDa.idrecibo
inner join recibosDA rDa
on hDa.idOperacion=rDa.idOperacion
inner join AplicacionesCuentasCorrientes acc
on dda.idtransaccion=acc.idtransaccion
inner join CuentasCorrientes cc
on acc.idtransaccionCancelada=cc.idtransaccion
Left Join socios sc
on sc.socio=hDa.socio and hDA.entidad=0
Left Join Adherentes ad
on hDa.socio=ad.Adherente and hDA.entidad=1
Left Join Alumnos al
on hDa.socio=al.idAlumno and hDA.entidad=2

where (hda.idOperacion=@idOperacion or @idOperacion=0)
and (hda.Entidad=@Entidad or @Entidad=9)
and (
(hda.socio between @dSocio and @hSocio)
or (@dSocio=0 and hda.socio<=@hSocio)
or (@hSocio=0 and hda.socio>=@dSocio)
or (@dSocio=0 and @hSocio=0)
)
order by hda.entidad,ltrim(rtrim(isnull(sc.apellido,isnull(ad.apellido,al.nyap))))+ ' ' +
ltrim(rtrim(isnull(sc.Nombre,isnull(ad.NOmbre,''))))




/* ,cc.DocumentoNumero*/







GO
/****** Object:  StoredProcedure [dbo].[ListadoRendicionesCobrador_Header]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO






CREATE      procedure [dbo].[ListadoRendicionesCobrador_Header]

@idOperacion int

as

-- Consulta Listado Rendicion

Select cc.idtransaccion, ho.idoperacion, ad.apellido, ad.nombre, dtcc.concepto, cn.Descripcion, cc.documentonumero, dtcc.importe, ad.cobrador,

isnull(((Select vt.importe 
From Detalle_Operaciones dcc
inner join Header_Operaciones ho1 on dcc.idOperacion=ho1.idOperacion
inner join ValoresTesoreria vt on dcc.idtransaccion=vt.idtransaccion and dcc.idTipoTransaccion=2
inner join Conceptos_Tesoreria ct on ct.idConcepto_Tesoreria = vt.idConcepto_Tesoreria and ct.idConcepto_Tesoreria = 10
where ho.idOperacion=ho1.idOperacion) * -1),0) as Bonificacion,

isnull(((Select vt.importe 
From Detalle_Operaciones dcc
inner join Header_Operaciones ho1 on dcc.idOperacion=ho1.idOperacion
inner join ValoresTesoreria vt on dcc.idtransaccion=vt.idtransaccion and dcc.idTipoTransaccion=2
inner join Conceptos_Tesoreria ct on ct.idConcepto_Tesoreria = vt.idConcepto_Tesoreria and ct.idConcepto_Tesoreria = 18
where ho.idOperacion=ho1.idOperacion) * -1),0) as Honorarios

From Detalle_Operaciones dcc
inner join Header_Operaciones ho 
	on dcc.idOperacion=ho.idOperacion 
inner join aplicacionesCuentasCorrientes acc 
	on dcc.idtransaccion=acc.idtransaccion 
inner join CuentasCorrientes cc 
	on cc.idtransaccion=acc.idtransaccionCancelada 
Inner Join DetalleCuentasCorrientes dtcc
	on dtcc.idtransaccion=cc.idtransaccion
inner join Adherentes ad
	on cc.socio=ad.adherente
inner join Conceptos cn
	on cn.concepto=dtcc.concepto
where dcc.idtipotransaccion = 0
and ho.idOperacion= @idOperacion
order by ad.Apellido, ad.nombre







GO
/****** Object:  StoredProcedure [dbo].[ListadoRendicionesCobrador_Valores]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE    procedure [dbo].[ListadoRendicionesCobrador_Valores]

@idOperacion int

as

Select vt.importe as ImportePago, 
vt.Cuenta, vt.Sucursal, vt.Numero, vt.FechaEmision as FechaCheque, vt.idConcepto_Tesoreria,
ct.Descripcion as DescPago, ct.Modalidad, bco.Descripcion as DescBanco, 1 as CantRegistro
From Detalle_Operaciones dcc
inner join Header_Operaciones ho 
	on dcc.idOperacion=ho.idOperacion
inner join ValoresTesoreria vt on dcc.idtransaccion=vt.idtransaccion and dcc.idTipoTransaccion=2
inner join Conceptos_Tesoreria ct on ct.idConcepto_Tesoreria = vt.idConcepto_Tesoreria and ct.idConcepto_Tesoreria <> 10 and ct.idConcepto_Tesoreria <> 18
left join Bancos bco on vt.Banco = bco.Banco 
where ho.idOperacion=@idOperacion




GO
/****** Object:  StoredProcedure [dbo].[ListadoResumenConceptosAnses]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE          procedure [dbo].[ListadoResumenConceptosAnses]

@idOperacion int

as

Select count(dtcc.concepto) as cantidad, dtcc.concepto, cn.Descripcion, 
sum(dtcc.importe) as Importe, --cc.documentonumero 

isnull(((Select vt.importe 
From Detalle_Operaciones dcc
inner join Header_Operaciones ho1 on dcc.idOperacion=ho1.idOperacion
inner join ValoresTesoreria vt on dcc.idtransaccion=vt.idtransaccion and dcc.idTipoTransaccion=2
inner join Conceptos_Tesoreria ct on ct.idConcepto_Tesoreria = vt.idConcepto_Tesoreria and ct.idConcepto_Tesoreria = 12
where ho.idOperacion=ho1.idOperacion) * -1),0) as Saldo

From Header_Operaciones ho 
inner join Detalle_Operaciones dcc
	on dcc.idOperacion=ho.idOperacion 
inner join CuentasCorrientes cc1
	on Dcc.idtransaccion=cc1.idtransaccioN
inner join aplicacionesCuentasCorrientes acc 
	on dcc.idtransaccion=acc.idtransaccion 
inner join CuentasCorrientes cc 
	on cc.idtransaccion=acc.idtransaccionCancelada 
Inner Join DetalleCuentasCorrientes dtcc
	on dtcc.idtransaccion=cc.idtransaccion
left join Conceptos cn
	on cn.concepto=dtcc.concepto
where dcc.idtipotransaccion = 0
and ho.tipodeoperacion = 94
and ho.idOperacion= @idOperacion
and cc1.concepto='COB'

group by ho.idoperacion, dtcc.concepto, cn.Descripcion --, cc.documentonumero

order by dtcc.concepto--, cc.documentonumero










GO
/****** Object:  StoredProcedure [dbo].[ListadoResumenPorConcepto]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE                      Procedure [dbo].[ListadoResumenPorConcepto]

	@Cajero			int = Null,
	@FechaDesde		varchar(10),
	@FechaHasta		varchar(10),
	@Caja			int,
	@TipoConsulta	char(1) -- T: Totales - P: Periodo

AS
Declare @C_String nvarchar(4000)
Declare @boolWhere char(1)

set @boolWhere = 'N'

	/* CONSULTA PARA CAJA */
	set @C_String = 'Select "' + @TipoConsulta + '" as TipoConsulta, dcc.Concepto,co.Descripcion As DescConcepto, sum(dcc.Importe) as Importe, count(*) as CantConcepto, '
	
	--Pone la fecha de Concepto si la consulta es por Periodo
	if @TipoConsulta = 'P'
		set @C_String = @C_String + ' cc1.documentonumero as FechaConcepto '
	else
		set @C_String = @C_String + ' "" as FechaConcepto '

	set @C_String = @C_String + ' 
	from CuentasCorrientes cc
		inner Join Detalle_Operaciones do on cc.idTransaccion=do.idTransaccion and do.idtipoTransaccion=0  
		inner Join Header_operaciones ho on ho.idOperacion=do.idOperacion
		inner join AplicacionesCuentasCorrientes acc on acc.idtransaccion=cc.idTransaccion
		inner join CuentasCorrientes cc1 on cc1.idTransaccion = acc.idTransaccionCancelada 
		inner join detalleCuentasCorrientes dcc ON acc.idtransaccionCancelada=dcc.idtransaccion
		inner join Conceptos co on cast(co.Concepto as char(3)) = cast(dcc.Concepto  as char(3))
		inner join usuarios_tesoreria ut on ut.idUsuario = ho.idOperadorTesoreria
	where (cc.concepto="COB" or cc.concepto="REN") and cc.entidad<2 '

	if @Caja = 1
		set @C_String = @C_String + 'and ut.caja = 1 and (ho.tipodeoperacion = 11 or ho.tipodeoperacion = 15) '

	if @Caja = 2
		set @C_String = @C_String + 'and ut.caja = 2 and (ho.tipodeoperacion = 17 or ho.tipodeoperacion = 19) '

	--Filtros
	if @Cajero is not null and @Cajero <> 0
		set @C_String =	@C_String + ' and ho.idOperadorTesoreria = ' + rtrim(convert(char(3),@Cajero))

	Set @C_String=@C_String + ' AND ho.Fecha Between "' + @FechaDesde + '" and "' + @FechaHasta + '" '

	--Group By
	set @C_String = @C_String + ' Group by dcc.Concepto,co.Descripcion '
	if @TipoConsulta = 'P'
		set @C_String = @C_String + ',cc1.documentonumero '

	--union
	set @C_String = @C_String + 'union 
    Select "' + @TipoConsulta + '" as TipoConsulta, dcc.Concepto,co.Descripcion As DescConcepto, sum(dcc.Importe) as Importe, count(*) as CantConcepto, '
	
	--Pone la fecha de Concepto si la consulta es por Periodo
	if @TipoConsulta = 'P'
		set @C_String = @C_String + ' cc1.documentonumero as FechaConcepto '
	else
		set @C_String = @C_String + ' "" as FechaConcepto '

	set @C_String = @C_String + ' 
	from CuentasCorrientes cc
		inner Join Detalle_Operaciones do on cc.idTransaccion=do.idTransaccion and do.idtipoTransaccion=0  
		inner Join Header_operaciones ho on ho.idOperacion=do.idOperacion
		inner join AplicacionesCuentasCorrientes acc on acc.idtransaccion=cc.idTransaccion
		inner join CuentasCorrientes cc1 on cc1.idTransaccion = acc.idTransaccionCancelada 
		inner join DetalleCuentasCorrientes dcc on dcc.idTransaccion = cc1.idTransaccion 
		inner join Horarios h
			on cast(h.idHorario as char(3))=cast(dcc.concepto as char(3))
		inner join NominaCursos n
			on n.idCurso=h.idCurso
		INNER JOIN OtrosConceptos co
			ON cast(n.concepto as char(3)) = cast(co.concepto  as char(3))
		inner join usuarios_tesoreria ut on ut.idUsuario = ho.idOperadorTesoreria
		where (cc.concepto="COB" or cc.concepto="REN") and cc.entidad=2'

	if @Caja = 1
		set @C_String = @C_String + 'and ut.caja = 1 and (ho.tipodeoperacion = 11 or ho.tipodeoperacion = 15) '

	if @Caja = 2
		set @C_String = @C_String + 'and ut.caja = 2 and (ho.tipodeoperacion = 17 or ho.tipodeoperacion = 19) '

	--Filtros
	if @Cajero is not null and @Cajero <> 0
		set @C_String =	@C_String + ' and ho.idOperadorTesoreria = ' + rtrim(convert(char(3),@Cajero))

	Set @C_String=@C_String + ' AND ho.Fecha Between "' + @FechaDesde + '" and "' + @FechaHasta + '" '

	--Group By
	set @C_String = @C_String + ' Group by dcc.Concepto,co.Descripcion '
	if @TipoConsulta = 'P'
		set @C_String = @C_String + ',cc1.documentonumero '

	set @C_String = @C_String + 'union '

	/*** CONSULTA PARA OTROS INGRESOS ***/
	set @C_String = @C_String + ' Select "' + @TipoConsulta + '" as TipoConsulta, oi.concepto, oc.Descripcion As DescConcepto, sum(Ai.Haber) as Importe,count(*) as CantConcepto, '

	--Pone la fecha de Concepto si la consulta es por Periodo
	if @TipoConsulta = 'P'
		set @C_String = @C_String + ' oi.aniomes as FechaConcepto '
	else
		set @C_String = @C_String + ' "" as FechaConcepto '

	set @C_String = @C_String + ' from Header_Operaciones ho
									inner join asientosDiariosItems ai on ho.asientoDiario=ai.asiento and ho.aniomes=ai.aniomes and ho.tipoasiento=ai.tipoasiento and ai.haber <> 0
									inner join DetalleOtrosIngresos OI on ho.asientoDiario=oi.asiento and ho.aniomes=oi.aniomes and ho.tipoasiento=oi.tipoasiento and oi.item = ai.item
									inner join OtrosConceptos oc  on oi.Concepto = oc.Concepto 
									inner join usuarios_tesoreria ut on ut.idUsuario = ho.idOperadorTesoreria 
								where tipodeOperacion=15 '
	if @Caja = 1
		set @C_String = @C_String + 'and ut.caja = 1 '

	if @Caja = 2
		set @C_String = @C_String + 'and ut.caja = 2 '

	--Filtros
	if @Cajero is not null and @Cajero <> 0
		set @C_String =	@C_String + ' and ho.idOperadorTesoreria = ' + rtrim(convert(char(3),@Cajero))

	Set @C_String=@C_String + ' AND ho.Fecha Between "' + @FechaDesde + '" and "' + @FechaHasta + '" '

	--Group By
	set @C_String = @C_String + ' group by oi.concepto, oc.Descripcion '
	if @TipoConsulta = 'P'
		set @C_String = @C_String + ',oi.aniomes '


/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
-- print @C_String




GO
/****** Object:  StoredProcedure [dbo].[ListadoSaldos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO

CREATE      Procedure [dbo].[ListadoSaldos]

	@Tipo		char(1)='C',
	@Desde		int = 0 ,
	@Hasta		int = 0 ,
	@Fecha		varchar(10)='20070731'
--	@Cobrador	int = Null ,
--	@Entidad	int = Null	
 
AS
Declare @C_String as nvarchar(4000)
Declare @Tabla as varchar(20)
Declare @Campo as varchar(20)

-- S : Socios
-- P : Proveedores
-- C : Clientes

/********************************************************/
/* 		Select para Socios	 		*/
/********************************************************/

/*if @Tipo = 'S'
	begin
		if @Entidad = 0 
			begin
				Set @Tabla = 'Socios'
				Set @Campo = 'socio'
			end
		else
			begin
				Set @Tabla = 'Adherentes'
				Set @Campo = 'adherente'
			end

		Set @C_String = 'SELECT  A01.socio,  
					A02.apellido, 
					A02.nombre,
					Sum(IsNull(A01.importe,0) - IsNull(A01.cancelado,0)) as Saldo
				FROM CuentasCorrientes A01
					INNER JOIN ' + @Tabla + ' A02	
						ON A01.socio = A02.' + @Campo + ' 
				 WHERE A01.entidad = ' + convert(char(1),@Entidad) + '
				        AND (IsNull(A01.importe,0) - IsNull(A01.cancelado,0)) <> 0
					AND A01.Fecha <= convert(datetime, "' + @Fecha + '", 103)'

		if @Desde is not Null and @Desde <> 0
			Set @C_String = @C_String + ' AND A01.socio >= ' + convert(char(10),@Desde)
		if @Hasta is not Null and @Hasta <> 0
			Set @C_String = @C_String + ' AND A01.socio <= ' + convert(char(10),@Hasta)
		if @Cobrador is not Null and @Cobrador <> 0
			Set @C_String = @C_String + ' AND A02.cobrador = ' + convert(char(4),@Cobrador)

		Set @C_String = @C_String + ' GROUP BY A01.socio, A02.apellido, A02.nombre'
	end

*/
/********************************************************/
/* 		Select para Proveedores 		*/
/********************************************************/
if @Tipo = 'P'
	begin
		Set @C_String = 'SELECT	A01.proveedor,
					A02.razonsocial,
					Sum(IsNull(A01.totalimporte,0) - IsNull(A01.cancelado,0)) as Saldo
				FROM CompProvHeader A01
					INNER JOIN Proveedores A02      
						ON A01.Proveedor = A02.codigo
				WHERE IsNull(A01.totalimporte,0) - IsNull(A01.cancelado,0) <> 0
					AND A01.Fecha <= convert(datetime, "' + @Fecha + '", 103)'
		if @Desde is not Null and @Desde <> 0		
			Set @C_String = @C_String + ' AND A01.proveedor >= ' + convert(char(6),@Desde)
		if @Hasta is not Null and @Hasta <> 0	
			Set @C_String = @C_String + ' AND A01.proveedor <= ' + convert(char(6),@Hasta)

		Set @C_String = @C_String + ' GROUP BY A01.proveedor, A02.razonsocial'
	end

/********************************************************/
/* 		Select para Clientes	 		*/
/********************************************************/
if @Tipo = 'C'
	begin
		Set @C_String = 'SELECT	A01.Cliente,
					A02.razonsocial,
					Sum(isnull(A01.totalimporte,0) - IsNull(A01.cancelado,0)) as Saldo
				FROM VenCliHeader A01
					INNER JOIN Clientes A02      
						ON A01.Cliente = A02.codigo
				WHERE IsNull(A01.totalimporte,0) - IsNull(A01.cancelado,0) <> 0
					AND A01.Fecha <= convert(datetime, "' + @Fecha + '", 103)'
		if @Desde is not Null or @Desde <> 0
			Set @C_String = @C_String + ' AND A01.Cliente >= ' + convert(char(6),@Desde)
		if @Hasta <> 0
			Set @C_String = @C_String + ' AND A01.Cliente <= ' + convert(char(6),@Hasta)

		Set @C_String = @C_String + ' GROUP BY A01.cliente, A02.razonsocial'
	end

/**** Ejecuto la consulta ****/

Print @C_String

EXEC sp_executesql @C_String





GO
/****** Object:  StoredProcedure [dbo].[ListadoSindicato]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  Procedure [dbo].[ListadoSindicato]
(
	@Concepto	int=null,
	@aniomes	int=null,
	@periodo	int=0
)
as
Select 	
il.Legajo,mp.Apellido, mp.Nombre, 
mp.Cuil,fl.Fecha as FechaIngreso,ct.descripcion as Categoria,Sum(il.importe) as Remuneracion,
(select sum(importe) from Items_Liquidaciones where 
concepto=@Concepto and idLiquidacion=hl.idliquidacion
and legajo=il.legajo) as Aporte
from Header_Liquidaciones hl
	inner join Items_Liquidaciones il
		on hl.idLiquidacion = il.idLiquidacion
	left join ConceptosLiquidacion cl
		on il.Concepto = cl.Concepto 
	inner join MaestroPersonal mp
		on il.legajo = mp.Legajo
	inner join CalificProfesionales cp
		on mp.CalifProfesional = cp.CalifProfesional
	inner join FechasLegajos fl
		on il.Legajo = fl.Legajo 
	inner join Categorias ct
		on mp.Categoria = ct.Categoria
where 
isnull(fl.IndicativoAntiguedad,1) = 1 and
hl.aniomes=@Aniomes and hl.periodo=@periodo and tipoconcepto=10
Group by il.Legajo,mp.Apellido, mp.Nombre, mp.Cuil,fl.Fecha,ct.descripcion,tipoConcepto,hl.idliquidacion
having 
(select sum(importe) from Items_Liquidaciones where 
concepto=@Concepto and idLiquidacion=hl.idliquidacion
and legajo=il.legajo)<>0

order by il.legajo





GO
/****** Object:  StoredProcedure [dbo].[ListadoSociosAdherentes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE      Procedure [dbo].[ListadoSociosAdherentes]

	@SocioDesde		int = Null, 
	@SocioHasta		int = Null, 
	@Entidad		int	  
 
AS
Declare @C_String 	as nvarchar(4000)
Declare @Base 		as varchar(20)
Declare @Campo 		as varchar(20)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

/****************************************/
/* 	Armo campos segun entidad	*/
/****************************************/
if @Entidad = 0
	begin
		Set @Base = 'Socios'
		Set @Campo = 'socio'
	end
else
	begin
		Set @Base = 'Adherentes'
		Set @Campo = 'adherente'
	end

Set @C_String='(Select 	A01.'+ @Campo+' as Codigo, A01.Apellido, A01.nombre, A01.domicilio, 
			A01.cpostal, A01.localidad, A02.Descripcion as Provincia, 
			A03.descripcion as TipoDocu, A01.numedocto, A01.NroMatricula, 
			A04.descripcion as TipoMatricula, FichaMun as FichaMunicipal, Cuil as Cuil 
		from '+@Base+' A01
			inner join provincias as A02
				on A02.provincia = A01.provincia
			inner join TiposDocumento A03
				on A03.tipodocto = A01.tipodocto
			inner join TiposMatricula A04
				on A04.tipoMatricula = A01.tipoMatricula '

	/**** Armo las condiciones ****/
	if @SocioDesde is not null and @SocioDesde <> 0
		begin
			set @boolWhere = 'S'	
			Set @C_String= @C_String + ' where  A01.'+@Campo+' >= ' + convert(char(10),@SocioDesde)
		end

	if @SocioHasta is not null and @SocioHasta <> 0
		begin
			set @boolWhere = 'S'	
			if @boolWhere = 'S'
				Set @C_String= @C_String + ' and  A01.'+@Campo+' <= ' + convert(char(10),@SocioHasta)			
			else
				Set @C_String= @C_String + ' where  A01.'+@Campo+' <= ' + convert(char(10),@SocioHasta)
		end

	if @boolWhere = 'S'
		Set @C_String= @C_String + ' and  A01.Fechabaja is null '
	else
		Set @C_String= @C_String + ' where   A01.Fechabaja is null '

	/**** Armo el orden de la consulta ****/
	Set @C_String=@C_String + ')Order by A01.apellido, A01.nombre'

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String








GO
/****** Object:  StoredProcedure [dbo].[ListadoSociosAdherentesDoc]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


--ListadoSociosAdherentesDoc '20050228',0,0--,24023003,'V'

CREATE      Procedure [dbo].[ListadoSociosAdherentesDoc]

	@Hastael		Char(8) = NUll,
	@Entidad		int,
	@Divide			int,
	@Hospital		int,
	@VotoGrupo		char(1)='V'
 
AS
Declare @C_String 	as nvarchar(4000)
Declare @Base 		as varchar(20)
Declare @Campo 		as varchar(20)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

/****************************************/
/* 	Armo campos segun entidad	*/
/****************************************/
if @Entidad = 0
	begin
		Set @Base = 'Socios'
		Set @Campo = 'socio'
	end
else
	begin
		Set @Base = 'Adherentes'
		Set @Campo = 'adherente'
	end

Set @C_String='(Select 	A01.'+ @Campo+' as Codigo, A01.Apellido, A01.nombre, A01.domicilio, 
			A01.cpostal, A01.localidad, A02.Descripcion as Provincia, 
			A03.descripcion as TipoDocu, A01.numedocto, A01.NroMatricula, 
			A04.descripcion as TipoMatricula, FichaMun as FichaMunicipal, Cuil as Cuil,hv.Nombre DescHopital,
			case when ' + cast(@Divide as char(1)) + ' = 0 then "Listado de Completo           " else hv.Nombre end dHospital
 
		from '+@Base+' A01
			left join provincias as A02
				on A02.provincia = A01.provincia
			left join TiposDocumento A03
				on A03.tipodocto = A01.tipodocto
			left join TiposMatricula A04
				on A04.tipoMatricula = A01.tipoMatricula 
			Left join HospitalesVoto hv
				on a01.LugarVoto=hv.HospitalVoto'


	/**** Armo las condiciones ****/

	if len(ltrim(@Hastael))=0
		begin
		if @boolWhere = 'S'
			Set @C_String= @C_String + ' and  A01.Fechabaja is null '
		else
			Set @C_String= @C_String + ' where   A01.Fechabaja is null '
		end
	else
		begin
		if @boolWhere = 'S'
			Set @C_String= @C_String + ' and  dbo.ActivosaFecha(0 , a01.socio ,"' + @Hastael + '" )>0 '
		else
			Set @C_String= @C_String + ' where  dbo.ActivosaFecha(0 , a01.socio , "' + @Hastael + '" )>0 '
		end
	/**** Armo el orden de la consulta ****/
	Set @C_String=@C_String + ') Order by case when ' + cast(@Divide as char(1)) + ' = 0 then "Listado de Completo           " else hv.Nombre end,A01.apellido, A01.nombre'

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String






GO
/****** Object:  StoredProcedure [dbo].[ListadoSociosAdherentesVoto]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO







--ListadoSociosAdherentesVoto 'T',0,'T','S',default,default,default,"S01",'20050101'

CREATE                     Procedure [dbo].[ListadoSociosAdherentesVoto]

	@Grupo			Char(1) = Null, 
	@Entidad		int	  ,
	@Hospital		char(4) = Null,
	@rHospital		char(1) = Null,
	@SoloMail		char(1) = Null, -- Si @Solo mail='S','T' Mail pero todos va solo mail
	@Ficha			char(1)	= NUll, -- Si @Ficha    ='S' va Ficha Municipal en el listado
	@Corte 			char(1) = Null, -- Permite Corte por Hospital
	@concepto		char(3) = Null,  -- Datos Ficha Periodista
	@Hasta			char(8) = Null
 
AS
Declare @C_String 	as nvarchar(4000)
Declare @Base 		as varchar(20)
Declare @Campo 		as varchar(20)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

/****************************************/
/* 	Armo campos segun entidad	*/
/****************************************/
if @Entidad = 0
	begin
		Set @Base = 'Socios'
		Set @Campo = 'socio'
	end
else
	begin
		Set @Base = 'Adherentes'
		Set @Campo = 'adherente'
	end

Set @C_String='(Select 	A01.'+ @Campo+' as Codigo, A01.Apellido, A01.nombre, A01.domicilio, 
			A01.cpostal, A01.localidad, A02.Descripcion as Provincia, 
			A03.descripcion as TipoDocu, A01.numedocto, A01.NroMatricula, telefono,
			A04.descripcion as TipoMatricula, hs.nombre as nombreRealHospital'
if @Corte='S' and @rHospital='N'
	Set @C_String=@C_String + ', hs.nombre as nombreHospital'
else
	Set @C_String=@C_String + ', "AMM" as nombreHospital'

Set @C_String=@C_String + ', A01.fechaingreso,
			a01.nacido,a01.fichamun ,a01.telefono, Email,telefono 
		from '+@Base+' A01
			inner join provincias as A02
				on A02.provincia = A01.provincia
			inner join TiposDocumento A03
				on A03.tipodocto = A01.tipodocto
			inner join TiposMatricula A04
				on A04.tipoMatricula = A01.tipoMatricula
			Left join hospitalesVoto hs 
				on a01.lugarvoto=hs.hospitalvoto
 '

	/**** Armo las condiciones ****/
	if @Grupo is not null and @Grupo <> 'T'
		begin
			set @boolWhere = 'S'	
			Set @C_String= @C_String + ' where A01.Grupo = "' + @Grupo + '" '
		end

	if @Hospital is not null and @Hospital<>'0' and @Hospital<>'' and @Hospital<>'T'
		begin
			if @boolWhere = 'S'
				Set @C_String= @C_String + ' and A01.LugarVoto="' + @Hospital + '" '
			else
				begin
					set @boolWhere = 'S'	
					Set @C_String= @C_String + ' where  A01.LugarVoto="' + @Hospital + '" '
				end
		end

	if @Concepto<>'T'
		begin
			if @boolWhere = 'S'
				Set @C_String= @C_String + ' and (Select Count(*) from Conceptos_socios where socio=a01.socio and concepto="' + @Concepto + '" and fechabaja is null)>0 '
			else
				begin 
					set @boolWhere = 'S'	
					Set @C_String= @C_String + ' where (Select Count(*) from Conceptos_socios where socio=a01.socio and concepto="' + @Concepto + '" and fechabaja is null)>0 '
				end
		end
	
	if isnull(@SoloMail,'N')='S' 
		Set @C_String= @C_String + ' and isnull(a01.Email,"")<>"" '

	if len(ltrim(rtrim(@Hasta)))>0
		if @boolWhere = 'S'
			Set @C_String= @C_String + ' and dbo.activoal(a01.' + @Campo + ',0,"' + @Hasta + '")>0 '
		else
			begin
				set @boolWhere = 'S'	
				Set @C_String= @C_String + ' where dbo.activoal(a01.' + @Campo + ',0,"' + @Hasta + '")>0 '
			end
	else
		begin
			if @boolWhere = 'S'
				Set @C_String= @C_String + ' and  A01.Fechabaja is null '
			else
				begin
					set @boolWhere = 'S'	
					Set @C_String= @C_String + ' where A01.Fechabaja is null '
				end
		end
		

/**** Armo el orden de la consulta ****/
if @rHospital="S"
	Set @C_String=@C_String + ') Order by A01.apellido, A01.nombre,NombreHospital'
else
begin
	if @Hospital is not null and @Hospital<>'0' and @Hospital<>''
		Set @C_String=@C_String + ') Order by NombreHospital,A01.apellido, A01.nombre'
	else
		Set @C_String=@C_String + ') Order by A01.apellido, A01.nombre'
end
/**** Ejecuto la consulta ****/
 EXEC sp_executesql @C_String
-- print @C_String







GO
/****** Object:  StoredProcedure [dbo].[ListadoSociosAdherentesVotoActas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


CREATE               Procedure [dbo].[ListadoSociosAdherentesVotoActas]

	@Grupo			Char(1) = Null, 
	@Entidad		int	  
/*	,@Hospital		char(4) = Null,
	@SoloMail		char(1) = Null, -- Si @Solo mail='S' va solo mail
	@Ficha			char(1)	= NUll, -- Si @Ficha    ='S' va Ficha Municipal en el listado
	@Corte 			char(1) = Null -- , -- Permite Corte por Hospital
--	@Teficha		char(1) = Null  -- Datos Ficha Periodista
 */
AS
Declare @C_String 	as nvarchar(4000)
Declare @Base 		as varchar(20)
Declare @Campo 		as varchar(20)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

/****************************************/
/* 	Armo campos segun entidad	*/
/****************************************/
if @Entidad = 0
	begin
		Set @Base = 'Socios'
		Set @Campo = 'socio'
	end
else
	begin
		Set @Base = 'Adherentes'
		Set @Campo = 'adherente'
	end

Set @C_String='(Select 	A01.'+ @Campo+' as Codigo, A01.Apellido, A01.nombre, A01.domicilio, 
			A01.cpostal, A01.localidad, A02.Descripcion as Provincia, 
			A03.descripcion as TipoDocu, A01.numedocto, A01.NroMatricula, 
			A04.descripcion as TipoMatricula'
--if @Corte='S'
	Set @C_String=@C_String + ', hs.nombre as nombreHospital'

/* else
	Set @C_String=@C_String + ', "AMM" as nombreHospital' */

Set @C_String=@C_String + ', A01.fechaingreso,
			a01.nacido,a01.fichamun ,a01.telefono, Email,telefono 
		from '+@Base+' A01
			inner join provincias as A02
				on A02.provincia = A01.provincia
			inner join TiposDocumento A03
				on A03.tipodocto = A01.tipodocto
			inner join TiposMatricula A04
				on A04.tipoMatricula = A01.tipoMatricula
			Left join hospitalesVoto hs 
				on a01.lugarvoto=hs.hospitalvoto

 '

	/**** Armo las condiciones ****/
	if @Grupo is not null and @Grupo <> 'T'
		begin
			set @boolWhere = 'S'	
			Set @C_String= @C_String + ' where A01.Grupo = "' + @Grupo + '" '
		end

/*	if @Hospital is not null and @Hospital<>'0' and @Hospital<>''
		begin
			if @boolWhere = 'S'
				Set @C_String= @C_String + ' and A01.LugarVoto=' + @Hospital + ' '
			else
				begin
					set @boolWhere = 'S'	
					Set @C_String= @C_String + ' where  A01.LugarVoto=' + @Hospital + ' '
			end
		end
*/
	if @boolWhere = 'S'
		Set @C_String= @C_String + ' and  A01.Fechabaja is null '
	else
		Set @C_String= @C_String + ' where A01.Fechabaja is null '

/*	if isnull(@SoloMail,'N')='S' 
		Set @C_String= @C_String + ' and isnull(a01.Email,"")<>""

 '
*/
/**** Armo el orden de la consulta ****/
/* if @Hospital is not null and @Hospital<>'0' and @Hospital<>''
	Set @C_String=@C_String + ') Order by NombreHospital,A01.apellido, A01.nombre'
else */
	Set @C_String=@C_String + ') Order by A01.apellido, A01.nombre'
/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String






GO
/****** Object:  StoredProcedure [dbo].[ListadoSociosAdherentesVotoHospitales]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


CREATE Procedure [dbo].[ListadoSociosAdherentesVotoHospitales]

	@Grupo			Char(1) = Null, 
	@Entidad		int	  ,
	@Hospital		char(4) = Null
 
AS
Declare @C_String 	as nvarchar(4000)
Declare @Base 		as varchar(20)
Declare @Campo 		as varchar(20)
Declare @boolWhere	as char(1)

Set @boolWhere = 'N'

/****************************************/
/* 	Armo campos segun entidad	*/
/****************************************/
if @Entidad = 0
	begin
		Set @Base = 'Socios'
		Set @Campo = 'socio'
	end
else
	begin
		Set @Base = 'Adherentes'
		Set @Campo = 'adherente'
	end

Set @C_String='(Select 	A01.'+ @Campo+' as Codigo, A01.Apellido, A01.nombre, A01.domicilio, 
			A01.cpostal, A01.localidad, A02.Descripcion as Provincia, 
			A03.descripcion as TipoDocu, A01.numedocto, A01.NroMatricula, 
			A04.descripcion as TipoMatricula, hs.nombre as hospital
		from '+@Base+' A01
			inner join provincias as A02
				on A02.provincia = A01.provincia
			inner join TiposDocumento A03
				on A03.tipodocto = A01.tipodocto
			inner join TiposMatricula A04
				on A04.tipoMatricula = A01.tipoMatricula
			Left join Grupos_Socios gs 
				on gs.socio=a01.socio
			Left join hospitales hs 
				on gs.reparticion=hs.reparticion and gs.lugarpago=hs.hospital

 '

	/**** Armo las condiciones ****/
	if @Grupo is not null and @Grupo <> 'T'
		begin
			set @boolWhere = 'S'	
			Set @C_String= @C_String + ' where A01.Grupo = "' + @Grupo + '" '
		end

	if @Hospital is not null and @Hospital<>'0'
		begin
			if @boolWhere = 'S'
				Set @C_String= @C_String + ' and A01.LugarVoto=' + @Hospital + ' '
			else
				begin
					set @boolWhere = 'S'	
					Set @C_String= @C_String + ' where  A01.LugarVoto=' + @Hospital + ' '
			end
		end

	if @boolWhere = 'S'
		Set @C_String= @C_String + ' and  A01.Fechabaja is null '
	else
		Set @C_String= @C_String + ' where A01.Fechabaja is null '

	/**** Armo el orden de la consulta ****/
	Set @C_String=@C_String + ') Order by hs.nombre,A01.apellido, A01.nombre'

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String











GO
/****** Object:  StoredProcedure [dbo].[ListadoSociosConcEsp]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


CREATE    Procedure [dbo].[ListadoSociosConcEsp]

/*
	@SocioDesde		int = Null, 
	@SocioHasta		int = Null, 
	@Entidad		int	
 
*/
AS
Declare @C_String 	as nvarchar(4000)


Set @C_String='Select 	count(A01.socio) as Socios, 
						A03.descripcion as DescEspecialidad
				from socios A01
					inner join especialidades_socios A02
						on A01.socio = A02.socio
					inner join Especialidades A03
						on A02.especialidad = A03.especialidad
				where A01.fechabaja is null	'

	/**** Armo las condiciones ****/
/*
	if @SocioDesde is not null and @SocioDesde <> 0
		begin
			set @boolWhere = 'S'	
			Set @C_String= @C_String + ' where  A01.'+@Campo+' >= ' + convert(char(10),@SocioDesde)
		end
	if @SocioHasta is not null and @SocioHasta <> 0
		begin
			if @boolWhere = 'S'
				Set @C_String= @C_String + ' and  A01.'+@Campo+' <= ' + convert(char(10),@SocioHasta)			
			else
				Set @C_String= @C_String + ' where  A01.'+@Campo+' <= ' + convert(char(10),@SocioHasta)
		end
*/

	/**** Armo el orden de la consulta ****/
	Set @C_String=@C_String + ' group by A03.especialidad, A03.descripcion
								order by A03.descripcion '

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String






GO
/****** Object:  StoredProcedure [dbo].[ListadoSociosGrupos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO

CREATE Procedure [dbo].[ListadoSociosGrupos]
(
	@Grupo		char(1)=null,
	@Hospital	int=null,
	@DT			char(1)='T',
	@Cobrador	int=null 	-- T otales D etalle
)
as
Declare @sqlst as nvarchar(4000)
if @dt='D'
	begin
		select @sqlst='
		Select * from dbo.GruposSocios() '
	
		if len(rtrim(ltrim(@Grupo)))>0
		select @sqlst=@sqlst + ' where Grupo="' + @grupo + '"'
	end
else
	begin
		select @sqlst='
		Select dgrupo,Grupo,GrupoConceptos,Count(*) as Cantidad, avg(importe) as Importe, avg(Porcentaje) as Porcentaje ,avg(Seguro) as seguro from dbo.GruposSocios() '
	
		if len(rtrim(ltrim(@Grupo)))>0
			select @sqlst=@sqlst + ' where Grupo="' + @grupo + '" '
	
			select @sqlst=@sqlst + ' Group by dgrupo,Grupo,GrupoConceptos order by Grupo,GrupoConceptos'

	end
EXEC sp_executesql @sqlst

GO
/****** Object:  StoredProcedure [dbo].[ListadoSubdiarioIngresos_Correcciones]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


CREATE	Procedure [dbo].[ListadoSubdiarioIngresos_Correcciones]

	@Cajero			int = Null,
	@FechaDesde		varchar(10),
	@FechaHasta		varchar(10)

AS
Declare @C_String nvarchar(4000)
Declare @boolWhere char(1)

set @C_String = 'Select * 
				from header_operaciones ho	
					inner join detalle_operaciones do
						on ho.idoperacion = do.idOperacion and idTipoTransaccion = 2
					inner join ValoresTesoreria vt
						on do.idTransaccion = vt.idTransaccion	
					inner join Conceptos_Tesoreria ct
						on vt.idConcepto_Tesoreria = ct.idConcepto_Tesoreria
				where vt.corregido = "S" and vt.TipoMovimiento = 2'

	if @Cajero is not null and @Cajero <> 0
		set @C_String =	@C_String + ' and ho.idOperadorTesoreria = ' + convert(varchar(3),@Cajero)

	if @FechaDesde <> ''
		Set @C_String=@C_String + ' AND ho.Fecha >= convert(datetime,"'+@FechaDesde+'",103)'

	if @FechaHasta <> ''
		Set @C_String=@C_String + ' AND ho.Fecha <= convert(datetime,"'+@FechaHasta+'",103)'


	/* Orden de la consulta */
	Set @C_String=@C_String + ' order by ho.ComprobanteNumero'

	
/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String




GO
/****** Object:  StoredProcedure [dbo].[ListadoSubdiarioIngresos_Header]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO





/****************************/	 
/*	Header de subdiarios 	*/
/****************************/	 

CREATE               Procedure [dbo].[ListadoSubdiarioIngresos_Header]

	@Cajero			int = Null, 	-- 
	@FechaDesde		varchar(10),
	@FechaHasta		varchar(10),
	@Caja			int = null		-- 1 Mostrador, 2 Foprosa

AS
/*
Declare @C_String nvarchar(4000)
Declare @boolWhere char(1)

set @boolWhere = 'N'

***************************************************************************
******* 	Caja para Adherentes 	***************************************
***************************************************************************

***************************************************************************
******* Anulaciones para Adherentes 	***********************************
***************************************************************************
set @C_String = @C_String + 'Select ho.idOperacion, cc.idtransaccion, 
cc.entidad, cc.socio, (rtrim(ad.apellido) + ", " + rtrim(ad.Nombre)) as ApellidoNombre ,cc.Fecha, cc.Concepto, "REV" as serie, cc1.Documentonumero ,
-cc1.importe, ad.Cobrador, cast(cc1.Documentonumero as char(6)) + "TEV" as Gruporpt
from CuentasCorrientes cc
inner Join Detalle_Operaciones do on cc.idTransaccion=do.idTransaccion and do.idtipoTransaccion=0 
inner Join Header_operaciones ho on ho.idOperacion=do.idOperacion
inner join adherentes ad on ad.adherente = cc.socio
inner join usuarios_tesoreria ut on ut.idUsuario = ho.idOperadorTesoreria
inner join aplicacionescuentascorrientes acc 
on cc.idtransaccion=acc.idtransaccion
inner join cuentascorrientes cc1
on cc1.idtransaccion=acc.idtransaccionCancelada

where cc.entidad = 1 '

	if @Caja = 1
		set @C_String = @C_String + 'and ut.caja = 1 and (ho.tipodeoperacion = 82 ) '

	if @Caja = 2
		set @C_String = @C_String + 'and ut.caja = 2 and (ho.tipodeoperacion = 82 ) '

	if @Cajero is not null and @Cajero <> 0
		set @C_String =	@C_String + ' and ho.idOperadorTesoreria = ' + rtrim(convert(char(3),@Cajero))

	if @FechaDesde <> ''
		Set @C_String=@C_String + ' AND ho.Fecha >= convert(datetime,"'+@FechaDesde+'",103)'

	if @FechaHasta <> ''
		Set @C_String=@C_String + ' AND ho.Fecha <= convert(datetime,"'+@FechaHasta+'",103)'

--set @C_String =	@C_String + ' union ' 

************************************************************************
******* Anulaciones para Socios    	************************************
************************************************************************
set @C_String = @C_String + 'Select ho.idOperacion, cc.idtransaccion, 
cc.entidad, cc.socio, (rtrim(ad.apellido) + ", " + rtrim(ad.Nombre)) as ApellidoNombre ,cc.Fecha, cc.Concepto, "REV" as serie, cc1.Documentonumero ,
-cc1.importe, ad.Cobrador, cast(cc1.Documentonumero as char(6)) + "TEV" as Gruporpt
from CuentasCorrientes cc
inner Join Detalle_Operaciones do on cc.idTransaccion=do.idTransaccion and do.idtipoTransaccion=0 
inner Join Header_operaciones ho on ho.idOperacion=do.idOperacion
inner join socios ad on ad.socio = cc.socio
inner join usuarios_tesoreria ut on ut.idUsuario = ho.idOperadorTesoreria
inner join aplicacionescuentascorrientes acc 
on cc.idtransaccion=acc.idtransaccion
inner join cuentascorrientes cc1
on cc1.idtransaccion=acc.idtransaccionCancelada

where cc.entidad = 0 '

	if @Caja = 1
		set @C_String = @C_String + 'and ut.caja = 1 and (ho.tipodeoperacion = 82 ) '

	if @Caja = 2
		set @C_String = @C_String + 'and ut.caja = 2 and (ho.tipodeoperacion = 82 ) '

	if @Cajero is not null and @Cajero <> 0
		set @C_String =	@C_String + ' and ho.idOperadorTesoreria = ' + rtrim(convert(char(3),@Cajero))

	if @FechaDesde <> ''
		Set @C_String=@C_String + ' AND ho.Fecha >= convert(datetime,"'+@FechaDesde+'",103)'

	if @FechaHasta <> ''
		Set @C_String=@C_String + ' AND ho.Fecha <= convert(datetime,"'+@FechaHasta+'",103)'


	if isnull(@Cajero,0)= 0
		Begin
	set @C_String =	@C_String + ' union  Select ho.idOperacion, 0 as idtransaccion, 
	99 as entidad, 0 as socio, "RECIBO ANULADO" As ApellidoNombre, ho.Fecha, "RA" as Concepto, "SAN01" serie, ho.ComprobanteNumero,
	0 as importe, 0 as Cobrador, cast(ho.Comprobantenumero as char(6)) + ho.Serie as Gruporpt
	from Header_Operaciones ho
	where (TipodeOperacion=11) and asientodiario is null '
	
		if @FechaDesde <> ''
			Set @C_String=@C_String + ' AND ho.Fecha >="' + @FechaDesde + '" '

	end

***************************************************************************
******* 	Otros Ingresos 			***************************************
***************************************************************************
set @C_String =	@C_String + ' union ' 

set @C_String =	@C_String + 
	' Select ho.idOperacion, 0 as idtransaccion, 
99 as entidad, 0 as socio, oi.ApellidoNombre, ho.Fecha, "OI" as Concepto, ho.serie, ho.ComprobanteNumero,
(select sum(debe) from asientosDiariosItems ai where ho.asientoDiario=ai.asiento and ho.aniomes=ai.aniomes and ho.tipoasiento=ai.tipoasiento
) as importe, 0 as Cobrador, cast(ho.Comprobantenumero as char(6)) + ho.Serie as Gruporpt
from Header_Operaciones ho
inner join asientosDiariosItems ai on ho.asientoDiario=ai.asiento and ho.aniomes=ai.aniomes and ho.tipoasiento=ai.tipoasiento and ai.haber <> 0
inner join DetalleOtrosIngresos OI on ho.asientoDiario=oi.asiento and ho.aniomes=oi.aniomes and ho.tipoasiento=oi.tipoasiento and oi.item = ai.item
inner join usuarios_tesoreria ut on ut.idUsuario = ho.idOperadorTesoreria
where tipodeOperacion=15 and ut.caja = ' + cast(@Caja as char(1))

	if @Cajero is not null and @Cajero <> 0
		set @C_String =	@C_String + ' and ho.idOperadorTesoreria = ' + rtrim(convert(char(3),@Cajero))

	if @FechaDesde <> ''
		Set @C_String=@C_String + ' AND ho.Fecha >= convert(datetime,"'+@FechaDesde+'",103)'
	
	if @FechaHasta <> ''
		Set @C_String=@C_String + ' AND ho.Fecha <= convert(datetime,"'+@FechaHasta+'",103)'  
	Set @C_String=@C_String + ' order by ho.ComprobanteNumero' */

Select * from dbo.Items_Subdiarios(@Fechadesde,@fechaHasta,@Caja,@Cajero)
order by ComprobanteNumero


	
/**** Ejecuto la consulta ****/
-- exEC sp_executesql @C_String
-- print @C_String 


GO
/****** Object:  StoredProcedure [dbo].[ListadoSubdiarioIngresos_Items]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO



-- ListadoSubdiarioIngresos_Items 51642

/****************************/	 
/*	Items de subdiarios 	*/
/****************************/	 

CREATE                        Procedure [dbo].[ListadoSubdiarioIngresos_Items]

	@idOperacion		int = Null

AS
Declare @C_String nvarchar(4000)
Declare @boolWhere char(1)

set @boolWhere = 'N'

/***************************************************************************/
/******* 	Caja 				 	****************************************/
/***************************************************************************/
set @C_String = 'Select	"CAJA" as TipoCob,A.idOperacion,A.Fecha,D.documentonumero as FechaConcepto,E.Concepto,H.Descripcion As DescConcepto,E.Importe as ImporteConcepto,D.entidad,A.Serie,A.ComprobanteNumero
From Header_Operaciones A 
inner join Detalle_Operaciones B on A.idOperacion = B.idOperacion and B.idTipoTransaccion = 0 
inner join AplicacionesCuentasCorrientes C on B.idTransaccion = C.idTransaccion  
inner join CuentasCorrientes D on D.idTransaccion = C.idTransaccionCancelada 
inner join DetalleCuentasCorrientes E on E.idTransaccion = D.idTransaccion 
inner join Conceptos H on E.Concepto = H.Concepto 
inner join usuarios_tesoreria ut on ut.idUsuario = A.idOperadorTesoreria
where d.entidad<2 and A.idOperacion = ' + convert(char(6),@idOperacion)

set @C_String =	@C_String + ' union 
Select	"CAJA" as TipoCob,A.idOperacion,A.Fecha,D.documentonumero as FechaConcepto,E.Concepto,H.Descripcion As DescConcepto,E.Importe as ImporteConcepto,D.entidad,A.Serie,A.ComprobanteNumero
From Header_Operaciones A 
inner join Detalle_Operaciones B on A.idOperacion = B.idOperacion and B.idTipoTransaccion = 0 
inner join AplicacionesCuentasCorrientes C on B.idTransaccion = C.idTransaccion  
inner join CuentasCorrientes D on D.idTransaccion = C.idTransaccionCancelada 
--inner join DetalleCuentasCorrientes E on E.idTransaccion = D.idTransaccion 
--inner join Conceptos H on E.Concepto = H.Concepto 
inner join DetalleCuentasCorrientes E on E.idTransaccion = D.idTransaccion 
	inner join Horarios h1
		on cast(h1.idHorario as char(3))=E.concepto
	inner join NominaCursos n
		on n.idCurso=h1.idCurso
	INNER JOIN OtrosConceptos h
		ON cast(n.concepto as char(3)) = Cast(h.concepto as char(3))
inner join usuarios_tesoreria ut on ut.idUsuario = A.idOperadorTesoreria
where d.entidad=2 and A.idOperacion = ' + convert(char(6),@idOperacion)

set @C_String =	@C_String + ' union '

/***************************************************************************/
/******* 	Otros Ingresos 			****************************************/
/***************************************************************************/
set @C_String =	@C_String + ' Select "OTROS INGRESOS" as TipoCob,A.idOperacion,A.Fecha,"" as FechaConcepto,G.Concepto,G.Descripcion As DescConcepto,C.haber as ImporteConcepto,999 as Entidad,A.Serie,A.ComprobanteNumero
From Header_Operaciones A 
inner join Detalle_Operaciones B on A.idOperacion = B.idOperacion and B.idTipoTransaccion = 2 
inner join AsientosDiariosItems C on A.asientodiario = C.asiento and A.aniomes = C.aniomes and C.tipoasiento = 1 and C.Debe=0  
inner join DetalleOtrosIngresos D  on C.asiento = D.asiento and C.aniomes = D.aniomes and C.item = D.item 
inner join OtrosConceptos G  on D.Concepto = G.Concepto 
inner join usuarios_tesoreria ut on ut.idUsuario = A.idOperadorTesoreria
left join Recibos J  on B.idTransaccion = J.idTransaccion 
where A.idOperacion = ' + convert(char(6),@idOperacion)

	
/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
-- print @C_String


















GO
/****** Object:  StoredProcedure [dbo].[ListadoSubdiarioIngresos_Valores]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




/****************************/	 
/*	Items de subdiarios 	*/
/****************************/	 

CREATE                      Procedure [dbo].[ListadoSubdiarioIngresos_Valores]

	@idOperacion		int = Null

AS
Declare @C_String nvarchar(4000)
Declare @boolWhere char(1)

set @boolWhere = 'N'

/***************************************************************************/
/******* 	Caja 				 	****************************************/
/***************************************************************************/
set @C_String = 'Select A01.idOperacion, A06.idtransaccion, A01.Fecha, 
A01.AnioMes As Header_AnioMes, A01.ObservacionComprobante, 
(select case a.tipodeOperacion when 82 then -sum(c.importe) else sum(c.importe) end
From Header_Operaciones a 
inner join Detalle_Operaciones b 
on a.idOperacion = b.idOperacion and b.idTipoTransaccion = 2 
inner join ValoresTesoreria c on c.idTransaccion = b.idTransaccion 
where tipomovimiento=1 and a.idoperacion = A01.idOperacion group by a.tipodeOperacion) as ImporteRecibo,
A01.Serie, A06.importe as ImportePago, 
A06.Cuenta, A06.Sucursal, A06.Numero, A06.FechaEmision as FechaCheque, 
A07.Descripcion as DescPago, A07.Modalidad, A10.Descripcion as DescBanco, 
A06.TipoMovimiento, A06.corregido
From Header_Operaciones A01 
inner join Detalle_Operaciones A02 on A01.idOperacion = A02.idOperacion 
and A02.idTipoTransaccion = 2 
inner join ValoresTesoreria A06 on A06.idTransaccion = A02.idTransaccion 
inner join Conceptos_Tesoreria A07 on A06.idConcepto_Tesoreria = A07.idConcepto_Tesoreria 
inner join usuarios_tesoreria ut on ut.idUsuario = A01.idOperadorTesoreria
left join Bancos A10 on A06.Banco = A10.Banco 
where tipomovimiento=1 and a01.tipodeOperacion<>82 and A01.idOperacion = ' + convert(char(6),@idOperacion) + ' union 
Select A01.idOperacion, A06.idtransaccion, A01.Fecha, 
A01.AnioMes As Header_AnioMes, A01.ObservacionComprobante, 
(select case a.tipodeOperacion when 82 then -sum(c.importe) else sum(c.importe) end
From Header_Operaciones a 
inner join Detalle_Operaciones b 
on a.idOperacion = b.idOperacion and b.idTipoTransaccion = 2 
inner join ValoresTesoreria c on c.idTransaccion = b.idTransaccion 
where tipomovimiento=1 and a.idoperacion = A01.idOperacion group by a.tipodeOperacion) as ImporteRecibo,
A01.Serie, -A06.importe as ImportePago, 
A06.Cuenta, A06.Sucursal, A06.Numero, A06.FechaEmision as FechaCheque, 
A07.Descripcion as DescPago, A07.Modalidad, A10.Descripcion as DescBanco, 
A06.TipoMovimiento, A06.corregido
From Header_Operaciones A01 
inner join Detalle_Operaciones A02 on A01.idOperacion = A02.idOperacion 
Inner join aplicacionesCuentasCorrientes acc on a02.idtransaccion=acc.idtransaccion
inner join ValoresTesoreria A06 on A06.idTransaccionorigen = Acc.idTransaccionCancelada
inner join Conceptos_Tesoreria A07 on A06.idConcepto_Tesoreria = A07.idConcepto_Tesoreria 
inner join usuarios_tesoreria ut on ut.idUsuario = A01.idOperadorTesoreria
left join Bancos A10 on A06.Banco = A10.Banco 
where tipomovimiento=1 and a01.tipodeOperacion=82 and A01.idOperacion = ' + convert(char(6),@idOperacion) + ' and a02.idtipotransaccion=0 '

	
/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String


















GO
/****** Object:  StoredProcedure [dbo].[ListadoSubdiarioIngresosCaja]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




/************************************************************************************/
/*	NOTA IMOPORTANTE !!!															*/
/*	A partir de este Stored Procedure se genera la vista "SubdiarioIngresos". 		*/
/*	Con lo cual, calquier cambio en la consulta que se realiza aca, 				*/
/*	se debera realizar en la vista para que queden los datos en forma coherente.	*/
/************************************************************************************/


CREATE            Procedure [dbo].[ListadoSubdiarioIngresosCaja]

	@Cajero			int = Null,
	@FechaDesde		varchar(10),
	@FechaHasta		varchar(10)

AS
Declare @C_String nvarchar(4000)
Declare @boolWhere char(1)

set @boolWhere = 'N'

/***************************************************************************/
/******* 	Caja para Adherentes 	****************************************/
/***************************************************************************/
set @C_String = 'Select	"CAJA" as TipoCob,A.idOperacion,G.Modalidad,I.Cobrador,A.Fecha,G.Descripcion as DescPago,F.idOperador,K.uName,D.Fecha as FechaConcepto,E.Concepto,H.Descripcion As DescConcepto,E.Importe as ImporteConcepto,F.Cuenta,F.Sucursal,F.Numero,F.FechaEmision as FechaCheque,J.Descripcion as DescBanco,D.entidad,I.Adherente as Codigo,(rtrim(I.Apellido) + ", " + rtrim(I.Nombre)) as ApellidoNombre,A.Serie,A.ComprobanteNumero,D.Cancelado as ImporteRecibo 
	From Header_Operaciones A inner join Detalle_Operaciones B on A.idOperacion = B.idOperacion and B.idTipoTransaccion = 0 inner join AplicacionesCuentasCorrientes C on B.idTransaccion = C.idTransaccion  inner join CuentasCorrientes D on D.idTransaccion = C.idTransaccionCancelada inner join DetalleCuentasCorrientes E on E.idTransaccion = D.idTransaccion inner join ValoresTesoreria F on F.idTransaccionOrigen = B.idTransaccion inner join Conceptos_Tesoreria G on F.idConcepto_Tesoreria = G.idConcepto_Tesoreria  inner join Conceptos H on E.Concepto = H.Concepto inner join Adherentes I on D.Socio = I.Adherente left join Bancos J on F.Banco = J.Banco left join Usuarios_Tesoreria K on K.idUsuario = F.idOperador where D.entidad = 1'

	if @Cajero is not null and @Cajero <> 0
		set @C_String =	@C_String + ' and F.idOperador = ' + rtrim(convert(char(3),@Cajero))

	if @FechaDesde <> ''
		Set @C_String=@C_String + ' AND A.Fecha >= convert(datetime,"'+@FechaDesde+'",103)'

	if @FechaHasta <> ''
		Set @C_String=@C_String + ' AND A.Fecha <= convert(datetime,"'+@FechaHasta+'",103)'

set @C_String =	@C_String + ' union'

/***************************************************************************/
/******* 	Caja para Socios 		****************************************/
/***************************************************************************/
set @C_String =	@C_String + 
	' Select "CAJA" as TipoCob,A.idOperacion,G.Modalidad,I.Cobrador,A.Fecha,G.Descripcion as DescPago,F.idOperador,K.uName,D.Fecha as FechaConcepto,E.Concepto,H.Descripcion As DescConcepto,E.Importe as ImporteConcepto,F.Cuenta,F.Sucursal,F.Numero,F.FechaEmision as FechaCheque,J.Descripcion as DescBanco,D.entidad,I.Socio as Codigo,(rtrim(I.Apellido) + ", " + rtrim(I.Nombre)) as ApellidoNombre,A.Serie,A.ComprobanteNumero,D.Cancelado as ImporteRecibo
	From Header_Operaciones A inner join Detalle_Operaciones B on A.idOperacion = B.idOperacion and B.idTipoTransaccion = 0 inner join AplicacionesCuentasCorrientes C on B.idTransaccion = C.idTransaccion  inner join CuentasCorrientes D on D.idTransaccion = C.idTransaccionCancelada inner join DetalleCuentasCorrientes E  on E.idTransaccion = D.idTransaccion inner join ValoresTesoreria F  on F.idTransaccionOrigen = B.idTransaccion inner join Conceptos_Tesoreria G  on F.idConcepto_Tesoreria = G.idConcepto_Tesoreria  inner join Conceptos H  on E.Concepto = H.Concepto  inner join Socios I  on D.Socio = I.Socio left join Bancos J  on F.Banco = J.Banco left join Usuarios_Tesoreria K  on K.idUsuario = F.idOperador where D.entidad = 0'

	if @Cajero is not null and @Cajero <> 0
		set @C_String =	@C_String + ' and F.idOperador = ' + rtrim(convert(char(3),@Cajero))

	if @FechaDesde <> ''
		Set @C_String=@C_String + ' AND A.Fecha >= convert(datetime,"'+@FechaDesde+'",103)'

	if @FechaHasta <> ''
		Set @C_String=@C_String + ' AND A.Fecha <= convert(datetime,"'+@FechaHasta+'",103)'

set @C_String =	@C_String + ' union'


/***************************************************************************/
/******* 	Otros Ingresos 			****************************************/
/***************************************************************************/
set @C_String =	@C_String + 
	' Select "OTROS INGRESOS" as TipoCob,A.idOperacion,F.Modalidad,"" as Cobrador,A.Fecha,F.Descripcion as DescPago,E.idOperador,I.uName, A.Fecha as FechaConcepto,G.Concepto,G.Descripcion As DescConcepto,C.haber as ImporteConcepto,E.Cuenta,E.Sucursal,E.Numero,E.FechaEmision as FechaCheque,H.Descripcion as DescBanco,999 as Entidad,"" as Codigo,D.ApellidoNombre,A.Serie,A.ComprobanteNumero,E.Cancelado as ImporteRecibo
	From Header_Operaciones A inner join Detalle_Operaciones B on A.idOperacion = B.idOperacion and B.idTipoTransaccion = 2 inner join AsientosDiariosItems C on A.asientodiario = C.asiento and A.aniomes = C.aniomes and C.tipoasiento = 1 and C.Debe=0  inner join DetalleOtrosIngresos D  on C.asiento = D.asiento and C.aniomes = D.aniomes and C.item = D.item inner join ValoresTesoreria E  on E.idTransaccion = B.idTransaccion left join Conceptos_Tesoreria F on E.idConcepto_Tesoreria = F.idConcepto_Tesoreria inner join OtrosConceptos G  on D.Concepto = G.Concepto left join Bancos H  on E.Banco = H.Banco left join Usuarios_Tesoreria I  on I.idUsuario = E.idOperador left join Recibos J  on B.idTransaccion = J.idTransaccion '

	if @Cajero is not null and @Cajero <> 0
		begin 
			set @boolWhere = 'S'
			set @C_String =	@C_String + ' where E.idOperador = ' + rtrim(convert(char(3),@Cajero))
		end 

	if @FechaDesde <> ''
		if @boolWhere = 'N'
			begin
				Set @C_String=@C_String + ' where A.Fecha >= convert(datetime,"'+@FechaDesde+'",103)'
				set @boolWhere = 'S'
			end
		else
			Set @C_String=@C_String + ' AND A.Fecha >= convert(datetime,"'+@FechaDesde+'",103)'
	
	if @FechaHasta <> ''
		if @boolWhere = 'N'
			begin
				Set @C_String=@C_String + ' where A.Fecha <= convert(datetime,"'+@FechaHasta+'",103)'
				set @boolWhere = 'S'
			end
		else
			Set @C_String=@C_String + ' AND A.Fecha <= convert(datetime,"'+@FechaHasta+'",103)'
	
/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print len(@C_String)











GO
/****** Object:  StoredProcedure [dbo].[ListadoSubdiarioSocios_FaseI]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


/****************************/	 
/*	Header de subdiarios 	*/
/****************************/	 

Create Procedure [dbo].[ListadoSubdiarioSocios_FaseI]

	@Cajero			int = Null, 	-- 
	@FechaDesde		varchar(10),
	@FechaHasta		varchar(10),
	@Caja			int		-- 1 Mostrador, 2 Foprosa

AS
Declare @C_String nvarchar(4000)
Declare @boolWhere char(1)

set @boolWhere = 'N'

/***************************************************************************/
/******* 	Caja para Adherentes 	****************************************/
/***************************************************************************/

set @C_String =	@C_String + ' union '

/***************************************************************************/
/******* 	Caja para Socios 		****************************************/
/***************************************************************************/
set @C_String =	@C_String + 
' Select ho.idOperacion, cc.idtransaccion, cc.entidad, cc.socio, (rtrim(so.apellido) + ", " + rtrim(so.Nombre)) as ApellidoNombre, cc.Fecha, cc.Concepto, ho.serie, ho.ComprobanteNumero ,importe, so.Cobrador, cast(ho.Comprobantenumero as char(6)) + ho.Serie as Gruporpt
from CuentasCorrientes cc inner Join Detalle_Operaciones do on cc.idTransaccion=do.idTransaccion and do.idtipoTransaccion=0  
inner Join Header_operaciones ho on ho.idOperacion=do.idOperacion inner join socios so on so.socio = cc.socio
inner join usuarios_tesoreria ut on ut.idUsuario = ho.idOperadorTesoreria where cc.entidad = 0 and (cc.concepto="COB" or cc.concepto="REN") '

	if @Caja = 1
		set @C_String = @C_String + ' and ut.caja = 1 and (ho.tipodeoperacion = 11 or ho.tipodeoperacion = 15) '

	if @Caja = 2
		set @C_String = @C_String + ' and ut.caja = 2 and (ho.tipodeoperacion = 17 or ho.tipodeoperacion = 19) '

	if @Cajero is not null and @Cajero <> 0
		set @C_String =	@C_String + ' and ho.idOperadorTesoreria = ' + rtrim(convert(char(3),@Cajero))

	if @FechaDesde <> ''
		Set @C_String=@C_String + ' AND ho.Fecha >= convert(datetime,"'+@FechaDesde+'",103)'

	if @FechaHasta <> ''
		Set @C_String=@C_String + ' AND ho.Fecha <= convert(datetime,"'+@FechaHasta+'",103)'

Execute sp_executesql @C_String

GO
/****** Object:  StoredProcedure [dbo].[ListadoValores]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE    Procedure [dbo].[ListadoValores] (
	@Inicio char(8)=null ,
	@Cierre char(8)=null ,
	@Concepto_Tesoreria int=0,
	@TipoMovimiento char(1)=null,	--	E Entradas S Salidas T Todos
	@Estado	char(1)=null, 			--	T Todos P pendientes 
	@Opcion	Char(1)		 			--	O Fecha de OPeracion E de Emision
)
as
Declare @Sql as nvarchar(4000)
Set @Sql='Select ho.Fecha as Fecha_Operacion,fechaEmision as Fecha_Emision
,ct.Descripcion as Descripcion_Valor,bc.Descripcion as Descripcion_Banco
,importe,ho.Observacion as Observacion_Header_OP
,ho.ObservacionComprobante as observacion_Comprobante,
case vt.tipomovimiento when 1 then "Entrada" else "Salida" end as tipoMovimiento,
case vt.tipomovimiento when 1 then vt.Importe else vt.importe*-1 end as signo,
case vt.tipomovimiento when 1 then vt.Importe else 0 end as Debe,
case vt.tipomovimiento when 1 then 0 else vt.importe end as Haber
 
from ValoresTesoreria vt
inner Join Conceptos_tesoreria ct
on ct.idConcepto_Tesoreria=vt.idConcepto_Tesoreria
inner join Detalle_Operaciones do 
on do.idtransaccion=vt.idtransaccion
Left join Bancos bc 
on vt.banco=bc.banco
inner join Header_Operaciones ho 
on do.idOperacion=ho.idOperacion

where idtipotransaccion=2' 

Declare @Campo as varchar(20)
Set @Campo=case @Opcion When 'E' then 'FechaEmision' else 'ho.Fecha' end

if len(rtrim(ltrim(@Inicio)))>0
	Set @sql=@Sql + ' and ' + @Campo + '>="' + @inicio + '" '

if len(rtrim(ltrim(@Cierre)))>0
	Set @sql=@Sql + ' and ' + @Campo + '<="' + @Cierre + '" '

if @Concepto_Tesoreria>0
	Set @sql=@Sql + ' and vt.idConcepto_Tesoreria=' + cast(@Concepto_Tesoreria as char(2))

if len(rtrim(ltrim(@TipoMovimiento)))>0 and @TipoMovimiento<>'T'
	Set @sql=@Sql + ' and vt.Tipomovimiento=' + cast(case @TipoMovimiento 	when 'E' then 1 
																		when 'S' then 2 end as char(1))

if @Estado='P'
	Set @sql=@Sql + ' and isnull(vt.Cancelado,0)=0'

Set @sql=@Sql + case @Opcion When 'E' then ' order by FechaEmision' else 'order by ho.Fecha' end

EXEC sp_executesql @sql




GO
/****** Object:  StoredProcedure [dbo].[ListaMatriculas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Procedure [dbo].[ListaMatriculas]
as
Select Matricula,isnull(nombreAvion,'') Avion,RazonSocial from Matriculas mt
inner join clientes cl 
on cl.codigo=mt.idcliente

Order by Matricula
GO
/****** Object:  StoredProcedure [dbo].[listaObras]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create procedure [dbo].[listaObras]
(
	@AC	varchar(1)='A', -- Abiertas Cerradas Todas
	@Desde	varchar(8)=Null,
	@Hasta	varchar(8)=Null
)
as
Select o.idObra,mt.Matricula,o.idcliente,razonsocial,nombreavion
from obras o
inner join clientes cl
on o.idcliente=cl.codigo
inner join Matriculas mt
on o.idMatricula=mt.idmatricula
where ((@AC='A' AND cierre is null) or (@AC='C' AND cierre is not null) or (@AC='T'))

order by idobra
GO
/****** Object:  StoredProcedure [dbo].[ListaPendientes]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE Procedure [dbo].[ListaPendientes]
as
Select lp.*,codigo,razonSocial,mt.nombreAvion
from listadoPendientes lp 
inner join matriculas mt 
on lp.idmatricula=mt.idmatricula
inner join Clientes cl 
on mt.idcliente=cl.codigo

order by idObra

GO
/****** Object:  StoredProcedure [dbo].[listarMovimientos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO

Create  Procedure [dbo].[listarMovimientos]
(
	@filtro			Varchar(100)='',
	@Desde			char(8)='20080301',
	@Hasta			char(8)='20080331'
)	
as
Declare @sql nvarchar(2000)

select @Sql='Select idOperacion,Fecha,observacion from header_operaciones 
where fecha between "' + @Desde + '" and "' + @Hasta + '"'

if @filtro<>''
	select @Sql=@Sql+ ' and ' + @Filtro

exec sp_executesql @Sql

GO
/****** Object:  StoredProcedure [dbo].[ListasdePrecios]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE     Procedure [dbo].[ListasdePrecios]
(
	@idLista	int=1,
	@Coeficiente	numeric(18,2)=0,
	@idLinea	int=0,
	@idSublinea	int=0,
	@idMarca	int=0,
	@adesde		varchar(20)='',
	@ahasta		varchar(20)='',
	@idModalidad	int=0,
	@Activos	int=0
)
as
Select Articulo,a.Descripcion dArticulo,Notas Notas,l.descripcion dLinea
,sl.descripcion dsublinea,presentacion,xCaja,xMetro,unidades,Neto,
a.idLinea,a.idSubLinea,a.idLinea*100+a.idSubLinea gRPT


from articulos a
left join Detalle_listas dl 
on a.idArticulo=dl.idArticulo
left join lineas l 
on a.idLinea=l.idlinea
left join Sublineas sl 
on a.idSubLinea=sl.idSublinea
where isNull(dl.idlista,@idLista)=@idLista
and (a.fechainactivo is null or @Activos=1)
and (@idLinea=0 or a.idlinea=@idlinea)
and (@idsubLinea=0 or a.idsublinea=@idsublinea)
and (@idMarca=0 or a.idMarca=@idMarca)
and (@adesde='' or articulo>=@adesde)
and (@ahasta='' or articulo<=@aHasta)







GO
/****** Object:  StoredProcedure [dbo].[livendia]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE  Procedure [dbo].[livendia] 
(
	@codigo int=0,
	@Fecha char(8)='20080515',
	@TipoCuenta int=0
)
as
Select 
Codigo,RazonSocial,(
	Select isnull(sum(totalimporte*Multiplicador),0)
	from vencliheader cph
	inner join tipventModHeader tcmh
	on cph.tipocomprobante=tcmh.codigo
	where Cliente=pv.codigo) as saldo,
(
	Select isnull(sum((totalimporte-isnull(cancelado,0))*Multiplicador),0)
	from vencliheader cph
	inner join tipventModHeader tcmh
	on cph.tipocomprobante=tcmh.codigo
	where Cliente=pv.codigo) as analizado,
(
	Select isnull(sum((totalimporte-isnull(cancelado,0))*Multiplicador),0)
	from vencliheader cph
	inner join tipventModHeader tcmh
	on cph.tipocomprobante=tcmh.codigo
	where Cliente=pv.codigo and multiplicador=1 and isnull(fecha1venc,'19000101')<cast(@fecha as smalldatetime) ) vdo
,
(
	Select isnull(sum((totalimporte-isnull(cancelado,0))*Multiplicador),0)
	from vencliheader cph
	inner join tipventModHeader tcmh
	on cph.tipocomprobante=tcmh.codigo
	where Cliente=pv.codigo and multiplicador=1 and fecha1venc between @fecha and cast(@fecha as smalldatetime)+15) as v15,
(
	Select isnull(sum((totalimporte-isnull(cancelado,0))*Multiplicador),0)
	from vencliheader cph
	inner join tipventModHeader tcmh
	on cph.tipocomprobante=tcmh.codigo
	where Cliente=pv.codigo and multiplicador=1 and fecha1venc between cast(@fecha as smalldatetime)+16 and cast(@fecha as smalldatetime)+30) as v30,
(
	Select isnull(sum((totalimporte-isnull(cancelado,0))*Multiplicador),0)
	from vencliheader cph
	inner join tipventModHeader tcmh
	on cph.tipocomprobante=tcmh.codigo
	where Cliente=pv.codigo and multiplicador=1 and fecha1venc>cast(@fecha as smalldatetime)+30 ) vm30,
(
	Select isnull(sum((totalimporte-isnull(cancelado,0))*Multiplicador),0)
	from vencliheader cph
	inner join tipventModHeader tcmh
	on cph.tipocomprobante=tcmh.codigo
	where Cliente=pv.codigo and multiplicador=-1) cna
from Clientes pv
where ((
	Select isnull(sum(totalimporte*Multiplicador),0)
	from vencliheader cph
	inner join tipventModHeader tcmh
	on cph.tipocomprobante=tcmh.codigo
	where Cliente=pv.codigo)<>0)	
and (pv.codigo=@Codigo or @Codigo=0)
and (@tipocuenta=0 or tipocuenta=@tipocuenta)
ORDER BY RAZONSOCIAL


GO
/****** Object:  StoredProcedure [dbo].[MaterialesPendientesFacturar]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO

CREATE Procedure [dbo].[MaterialesPendientesFacturar]
as

Select isnull(a.notas,"") partNumber,
substring(a.descripcion,1,19) descripcion,ea.cantidad*-1*signo as cantidad, a.precio,
isnull(amt.idCampo,0) as idCampoAmt, ea.idCampo idCampoEa,
isnull(ea.idObra,ho.idObra) idObra, mt.matricula, mt.idMatricula, hop.Fecha
into W99LF
from BaseCrm..estadisticaArticulos ea
left join BaseCrm..HeaderMovimientosStock ho on ea.idOPeracion=ho.idOPeracion
left join BaseCrm..Header_Operaciones hop on ea.idOPeracion=hop.idOPeracion
inner join BaseCrm..TiposMovimientoStock t on ea.tipomovimiento=t.idTipomovimientoStock
inner join BaseCrm..Articulos a on ea.idArticulo=a.idarticulo
left join BaseCrm..anexoMateriales amt on ea.idcampoAnexo=amt.idcampo
Left join baseCRM..obras bo on ea.idObra=bo.idobra
Left join baseCRM..obras bo1 on ho.idObra=bo1.idobra
inner join matriculas mt on Isnull(bo.idmatricula,bo1.idMatricula)=mt.idmatricula
where ea.fecfactura is null  and isnull(amt.idOperacion,0)=0  and isnull(bo.idObra,bo1.idObra)<>0 and isnull(bo.cierreFC,bo1.cierreFC) is null
and isnull(bo.idObra,bo1.idObra)>200
union
Select isnull(a.notas,"") partNumber,substring(a.descripcion,1,19) descripcion,ea.cantidad*-1*signo as cantidad, a.precio,
isnull(amt.idCampo,0) as idCampoAmt, ea.idCampo idCampoEa,isnull(ea.idObra,ho.idObra) idObra , mt.matricula, mt.idMatricula, hop.Fecha
from store..estadisticaArticulos ea
left join Store..HeaderMovimientosStock ho on ea.idOPeracion=ho.idOPeracion
left join Store..Header_Operaciones hop on ea.idOPeracion=hop.idOPeracion
inner join BaseCrm..TiposMovimientoStock t on ea.tipomovimiento=t.idTipomovimientoStock
inner join Store..Articulos a on ea.idArticulo=a.idarticulo
left join BaseCrm..anexoMateriales amt on ea.idcampoAnexo=amt.idcampo
Left join baseCRM..obras bo on ea.idObra=bo.idobra
Left join baseCRM..obras bo1 on ho.idObra=bo1.idobra
inner join matriculas mt on Isnull(bo.idmatricula,bo1.idMatricula)=mt.idmatricula

where ea.fecfactura is null  and isnull(amt.idOperacion,0)=0  and isnull(ea.idObra,ho.idObra)<>0 and isnull(bo.cierreFC,bo1.cierreFC) is null
and isnull(ea.idObra,ho.idObra)>200

order by isnull(ea.idObra,ho.idObra), isnull(a.notas,"")

Drop Table ListadoPendientes

Select idobra,partnumber,descripcion,precio, sum(cantidad) Cantidad, sum(cantidad*Precio) Subtotal, Matricula,idMatricula,Fecha
Into ListadoPendientes
from w99lf

Group by idobra,partnumber,descripcion,Precio, Matricula, idMatricula,fecha

Having sum(cantidad)<>0


Drop table w99LF



GO
/****** Object:  StoredProcedure [dbo].[Modificacion_Operacion]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[Modificacion_Operacion](
@N_idOperacion as int,
@N_Cliente as int=null,
@N_Topera as int,
@N_Moneda as int,
@N_Cantidad as numeric (18,2),
@N_Precio as numeric (18,4),
@N_Neto as numeric (18,4),
@N_Precio_Contacto as numeric (18,2),
@N_Contacto as int,
@N_idOpCalce as int,
@N_Confirmada as int = 1,
@C_Hora as char(5),
@operador int,
@idConcepto int=NULL,
@Observacion varchar(50)=NULL)
as
begin
  update Movimientos set 
  fecha=GetDate(),Cliente=@N_Cliente,TipoOperacion=@N_Topera,Moneda=@N_Moneda,
  Cantidad=@N_Cantidad,Precio=@N_Precio,Neto=@N_Neto,Precio_Contacto=@N_Precio_Contacto,
  idContacto=@N_Contacto,idOperacionCalce=@N_idOpCalce,estado=@N_Confirmada,Hora=@C_Hora,
  operador=@operador,idConcepto=@idConcepto,Observacion=@observacion
  where idOperacion=@N_idoperacion 
end

GO
/****** Object:  StoredProcedure [dbo].[ModificaCursos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  procedure [dbo].[ModificaCursos]
(
	@idtransaccion 		numeric(18,0),
	@importe 		numeric(18,2),
	@Modo 			int,
	@idOperacion		numeric(18,0)
)
as
Declare @Socio int
Declare @curso int
Declare @Concepto Char(3)

Select 
@Concepto=concepto,@curso=idCancelada, @Socio=socio 
from CuentasCorrientes where idtransaccion=@idtransaccion

Update Listas 
set Matricula=case when @Concepto='MAT' then @Importe else Matricula end,
    ImporteCuotas=case	when @Concepto='CUO' then @Importe else ImporteCuotas end
Where idAlumno=@Socio and idHorario=@Curso


insert into Detalle_operaciones (idOperacion,idtipotransaccion,idtransaccion,itemDiario)
values( @idOperacion,0,@idtransaccion,null)

if @modo=0 
	Begin
		Insert into CuentasCorrientesCursosCambios
		Select * from CuentasCorrientes where idtransaccion=@idtransaccion
		
		Update CuentasCorrientes set importe=@Importe where idtransaccion=@idtransaccion
		
		Insert into DetalleCuentasCorrientesCursosCambios
		Select * from DetalleCuentasCorrientes where idtransaccion=@idtransaccion
		
		Update DetalleCuentasCorrientes set importe=@Importe where idtransaccion=@idtransaccion
	End
else
	Begin
	
		Insert into CuentasCorrientesCursosCambios
		Select * from CuentasCorrientes where idtransaccion=@idtransaccion
		
		Delete CuentasCorrientes where idtransaccion=@idtransaccion
		
		Insert into DetalleCuentasCorrientesCursosCambios
		Select * from DetalleCuentasCorrientes where idtransaccion=@idtransaccion
	
		Delete DetalleCuentasCorrientes where idtransaccion=@idtransaccion	
	End


GO
/****** Object:  StoredProcedure [dbo].[MovimientosxArticulo]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



--Select * from tiposMovimientoStock

CREATE        Procedure [dbo].[MovimientosxArticulo] 
(
		@Desde				char(8)='20090701',
		@Hasta				char(8)='20091201',
		@ESA				char(1)='E',
		@AIT				char(1)='A',
		@Orden				char(1)='C'
)
as

Select a.articulo,a.notas,a.descripcion,sum(case when ESA='E' then cantidad else 0 end) entradas,
sum(case when ESA='S' then cantidad else 0 end) Salidas,dbo.stock(a.idarticulo) as Stock
from estadisticaarticulos ea
inner join tiposMovimientoStock t
on ea.tipomovimiento=t.idTipomovimientoStock
inner join Articulos a
on ea.idarticulo=a.idarticulo
left join Header_operaciones ho
on ho.idoperacion=ea.idoperacion
left join HeaderMovimientosStock hms
on ho.idOperacion=hms.idOperacion

where (t.ESA=@Esa or (@Esa='A' and t.esa<>'')) and isnull(FechaDOS,ho.fecha) between @Desde and @Hasta
AND ((@AIT='A' and fechainactivo is null) or (@AIT='I' and fechainactivo is not null) or @AIT='T')

Group by a.articulo,a.notas,a.descripcion,a.idarticulo

order by case 
when @Orden='C' then a.Articulo
when @Orden='P' then a.Notas
when @Orden='D' then a.Descripcion
end
GO
/****** Object:  StoredProcedure [dbo].[MultipleParts]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE  Procedure [dbo].[MultipleParts]
(
	@PartNbr	as varchar(20)='MS29513-11',
	@idLista	int=10
)
as
Select ap.idArticulo,a.articulo,articuloProveedor,descripcion,
0 nf,
--isnull(dbo.Precio(@idLista,a.idArticulo,'N'),0) nf,
-- dbo.Precio(@idLista,a.idArticulo,'N') precio
0 precio

from ArticulosProveedor ap
inner join articulos a
on ap.idarticulo=a.idarticulo

where articuloProveedor=@PartNbr

order by a.articulo





GO
/****** Object:  StoredProcedure [dbo].[Nota_de_credito]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  Procedure [dbo].[Nota_de_credito](@idTransaccion int, @idOperacion int, @idOperacionOrigen int) 
as

Declare @trCtaCte int
Insert Into CuentasCorrientes
(socio, Entidad, Fecha, Concepto, 
PuntodeVenta, DocumentoNumero, FechaRendicion, 
Rendicion, importe, Cancelado, vencimiento, Cobrador,
serie,idOpcobrador)
Select socio, Entidad, fecha, Concepto, 
PuntodeVenta, DocumentoNumero, FechaRendicion, 
Rendicion, importe, Cancelado, vencimiento, Cobrador,
serie,idOpcobrador from CuentasCorrientes where idtransaccion=@idtransaccion
Select @trCtaCte=@@identity

update CuentasCorrientes
set cancelado=importe where idtransaccion=@idtransaccion
update CuentasCorrientes
set cancelado=importe,Concepto='NC',Fecha=getdate() where idtransaccion=@trCtaCte

Declare @Importe numeric(18,2)

Set @Importe=(Select importe from CuentasCorrientes where idtransaccion=@idtransaccion)

Insert into AplicacionesCuentasCorrientes
(idtransaccion,idTransaccionCancelada,importe)
values
(@trCtaCte,@idtransaccion,@importe)

insert into detalle_operaciones 
(IdOperacion,IdTipoTransaccion,idTransaccion,itemdiario)
values
(@IdOperacion,0,@trCtaCte,0)







GO
/****** Object:  StoredProcedure [dbo].[Notas_Imputacion_200309]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE      Procedure [dbo].[Notas_Imputacion_200309]
as
Select 
sc.socio as socio,
sc.apellido,
sc.nombre,
cc.documentoNumero as Mes,
cc.Importe as Subtotal,
(select sum(importeNC) from NotasImputacion ni1
where socio=sc.socio) as total,
dbo.numlet((select sum(importeNC) from NotasImputacion ni1
where socio=sc.socio)) as letras
from NotasImputacion ni
Inner join socios sc on ni.socio=sc.socio
inner join CuentasCorrientes cc
on ni.idtransaccionMes=cc.idtransaccion
where cc.fecha>'20060310'
GO
/****** Object:  StoredProcedure [dbo].[Notas_Imputacion_200309_Detalle]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


CREATE  Procedure [dbo].[Notas_Imputacion_200309_Detalle] (
	@Socio int
)
as
Select 
sc.socio as socio,
sc.apellido,
sc.nombre,
cc.documentoNumero as Mes,
ImporteNc as Subtotal,
(select sum(importeNC) from NotasImputacion ni1
where socio=sc.socio) as total,
dbo.numlet((select sum(importeNC) from NotasImputacion ni1
where socio=sc.socio)) as letras

from NotasImputacion ni
inner join socios sc on ni.socio=sc.socio
inner join CuentasCorrientes cc
on ni.idtransaccionMes=cc.idtransaccion
where ni.socio=@Socio

GO
/****** Object:  StoredProcedure [dbo].[Notas_Imputacion_200309_Header]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO





CREATE             Procedure [dbo].[Notas_Imputacion_200309_Header]
as
Select Distinct
sc.adherente as socio,
--sc.socio,
sc.apellido,
sc.nombre,
(select sum(importeNC) from NotasImputacion ni1
where socio=sc.Adherente) as total,
--where socio=sc.socio) as total,
dbo.numlet((select sum(importeNC) from NotasImputacion ni1
where socio=sc.adherente)) as letras
--where socio=sc.socio)) as letras
from NotasImputacion ni
--inner join socios sc on ni.socio=sc.socio
inner join adherentes sc on ni.socio=sc.adherente
inner join CuentasCorrientes cc
on ni.idtransaccionMes=cc.idtransaccion

where ingreso>200506


GO
/****** Object:  StoredProcedure [dbo].[NovedadesSM]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE procedure [dbo].[NovedadesSM]
as

/*
Select item,sc.socio,sc.Grupo,sc.apellido,sc.nombre,sc.numedocto,sc.nroMatricula,sc.NroMatricula2, 
baseCrm.dbo.saldo(sc.socio,getdate()) saldo, 'Nomina' Nomina,sm.detalle
into #Nomina
from (
Select item,
replace(REVERSE(SUBSTRING(REVERSE(detalle),0,CHARINDEX(' ',REVERSE(detalle)))),'.','') numeDocto,detalle
 
from concilia.[dbo].[sm])
as sm
left join basecrm..socios sc
on sm.numedocto=sc.numedocto

--where Grupo not in ('F','R','M','B')
-- and dbo.saldo(sc.socio,getdate())>0

Select item,sc.socio,sc.Grupo,sc.apellido,sc.nombre,sc.numedocto,sc.nroMatricula,sc.NroMatricula2, 
baseCrm.dbo.saldo(sc.socio,getdate()) saldo, 'Retro' Nomina,
sm.detalle
into #NominaRetro
from (
Select item,
replace(REVERSE(SUBSTRING(REVERSE(detalle),0,CHARINDEX(' ',REVERSE(detalle)))),'.','') numeDocto,detalle
 
from concilia.[dbo].[smRetro])
as sm
left join basecrm..socios sc
on sm.numedocto=sc.numedocto
*/

Select item,sc.socio,sc.Grupo,sc.apellido,sc.nombre,sc.numedocto,sc.nroMatricula,sc.NroMatricula2, 
baseCrm.dbo.saldo(sc.socio,getdate()) saldo, '' Nomina, --'Retro' Nomina,
sm.detalle 
into #Nomina
from concilia..SM
left join basecrm..socios sc
on sm.numedocto=sc.numedocto


Select *
from (
Select * from #Nomina 
/*union 
Select * from #NominaRetro*/
) nominas 
Where grupo in ('R','F','M','B')
order by apellido,nombre,socio,nomina

Select sc.socio,sc.numedocto,sc.apellido,sc.nombre,sc.nroMatricula, sc.NroMatricula2 
from socios sc 
left join (
Select * from #Nomina 
/*union 
Select * from #NominaRetro*/
) as nominas
on sc.numedocto=nominas.numedocto
Where sc.grupo not in ('R','F','M','B')
and nominas.numedocto is null
and dbo.saldo(sc.socio,getdate())=0
and not exists (Select * from conceptos_socios where socio=sc.socio and concepto='RMP')
and sc.grupo not in ('V','H')
order by sc.apellido,sc.nombre,sc.socio,nomina

/*
Select * from conceptos_socios 
where concepto like 'SMP'
*/
GO
/****** Object:  StoredProcedure [dbo].[ObrasCerradas]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO







CREATE Procedure [dbo].[ObrasCerradas]
	@idObra	int=0,
	@Cierre	varchar(8)='20120313',
	@Desde	varchar(8)='',
	@Hasta	varchar(8)='',
	@TC		numeric(18,4)=4.39,
	@AL		varchar(1)='A'
as

Select case when ea.tipoMovimiento=22 then 0 else 1 end Modo,ea.idcampo idCampoEA,
a.notas,a.articulo,ea.docum,isnull(fechaDos,ho.fecha) fecha,substring(a.descripcion,1,19) descripcion,
ea.cantidad*ts.Signo*-1 Cantidad,case when ea.tipomovimiento=22 then ea.cantidad else isnull(bi.precio,a.precio) end precio,
case when ea.tipomovimiento=22 then ea.cantidad else ea.cantidad*isnull(bi.precio,a.precio)*ts.Signo*-1 end subtotalDolares,
case when ea.tipomovimiento=22 then ea.cantidad else ea.cantidad*isnull(bi.precio,a.precio)*ts.Signo*-1*@TC end Pesos,
ea.tipomovimiento,isnull(ea.idObra,hm.idobra) idobra,
cl.razonSocial,
ea.idProveedor,ea.fcProv,
ho1.fecha fechaFc,right(vch1.nrocomprobante,8) + ' ' +  vch1.tipofactura Observacion,ea.idcampoAnexo,mt.idcampo, mt.idoperacion,pv.razonsocial RazonSocialProveedor,nombreAvion,mat.matricula,
0 as tabla, 0 Moneda
-- Drop Table CierreJulio
-- into Cierrejulio
from EstadisticaArticulos ea
left join headerMovimientosStock hm
on ea.idoperacion=hm.idoperacion
left join Header_operaciones ho 
on hm.idOperacion=ho.idoperacion
inner join tiposMovimientoStock t
on ea.tipomovimiento=t.idtipoMovimientoStock
left join Articulos a
on ea.idArticulo=a.idArticulo
left join baseinventarios bi
on a.idarticulo=bi.idarticulo and substring(@Cierre,1,6) between vigenciadesde and vigenciaHasta
inner join cuentas ct
on ct.cuenta=132000
left join anexoMateriales mt 
on ea.idcampoanexo=mt.idcampo and mt.partNumber=ea.articuloProveedor and mt.idOperacion is not null
left join Header_operaciones ho1
on mt.idOPeracion=ho1.idoperacion
left join detalle_operaciones do1
on ho1.idoperacion=do1.idoperacion and idtipotransaccion=0
left join vencliheader vch1
on do1.idtransaccion=vch1.idtransaccion and vch1.fecha<@Cierre
inner join obras o
on isnull(ea.idObra,hm.idobra)=o.idObra
inner join clientes cl
on o.idcliente=cl.codigo
left join proveedores pv
on ea.idproveedor=pv.codigo
inner join tiposMovimientoStock ts
on ea.tipoMovimiento=ts.idtipomovimientoStock
inner join matriculas mat
on o.idmatricula=mat.idmatricula
where --isnull(fechaDos,ho.fecha)<=@Cierre and isnull(ea.fecfactura,'29001231')>@Cierre and 
(tipoMovimiento=4 or TipoMovimiento=9 or TipoMovimiento=22)
and (@idObra=0 or o.idObra=@idOBra)
-- and o.cierre is null
and year(FecFactura)=year(@Cierre) and month(FecFactura)=month(@Cierre)
-- and case when @Hasta='' then '29000101' else @Hasta end 

union 

Select 
0 Modo,cph.idtransaccion idCampoEA,
'' notas,'' articulo,0 docum,ho.fecha fecha,'' descripcion,
1 Cantidad,cpi.importe precio,0 subtotalDolares,
tmh.Multiplicador*cpi.importe*case when moneda=1 then TC else 1 end Pesos,
cph.tipoComprobante tipomovimiento,cpi.area idobra,
cl.razonsocial razonSocial,
isnull(pv.codigo,pf.proveedor) idproveedor,right(cph.nroComprobante,8) nrocomprobante,
cph.fecha fechaFc,'' Observacion,0 idcampoAnexo,0 idcampo, 0 idoperacion,
isnull(pv.razonSocial,pf.razonsocial) razonSocialProveedor,nombreAvion,mat.matricula, 1 as tabla,
cph.Moneda
from header_operaciones ho 
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion 
inner join CompProvHeader cph
on do.idtransaccion=cph.idtransaccion 
inner join tipCompModHeader tmh 
on cph.tipoComprobante=tmh.codigo
inner join compProvItems cpi
on cph.idtransaccion=cpi.idtransaccion 
left join proveedores pv
on cph.proveedor=pv.codigo
left join provFondo pf
on cph.proveedor=pf.proveedor
inner join obras o
on cpi.area=o.idObra
inner join clientes cl
on o.idcliente=cl.codigo
inner join matriculas mat
on o.idmatricula=mat.idmatricula
where idtipotransaccion=1 
-- and ho.fecha<=@Cierre and isnull(cpi.FechaCierre,'29001231')>@Cierre
and (@idObra=0 or cpi.Area=@idOBra)
and year(cpi.FechaCierre)=year(@Cierre) and month(cpi.FechaCierre)=month(@Cierre)
and ho.fecha between case when @Desde='' then '19000101' else @Desde end 
and case when @Hasta='' then '29000101' else @Hasta end 
AND cpi.cuenta=132000

union 

Select 
0 Modo,cph.idtransaccion idCampoEA,
'' notas,'' articulo,0 docum,ho.fecha fecha,'' descripcion,
1 Cantidad,cpi.importe precio,0 subtotalDolares,
tmh.Multiplicador*cpi.importe Pesos,
cph.tipoComprobante tipomovimiento,cpi.area idobra,
cl.razonSocial,
isnull(pv.codigo,pf.proveedor) idproveedor,right(cph.nroComprobante,8) nrocomprobante,
cph.fecha fechaFc,'' Observacion,0 idcampoAnexo,0 idcampo, 0 idoperacion,
isnull(pv.razonSocial,pf.razonsocial) razonSocialProveedor,nombreAvion,mat.matricula, 2 as tabla,
0 Moneda
from header_operaciones ho 
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion 
inner join CompFondosHeader cph
on do.idtransaccion=cph.idtransaccion 
inner join tipCompModHeader tmh 
on cph.tipoComprobante=tmh.codigo
inner join compFondosItems cpi
on cph.idtransaccion=cpi.idtransaccion 
left join proveedores pv
on cph.proveedor=pv.codigo
left join provFondo pf
on cph.proveedor=pf.proveedor
inner join obras o
on cpi.area=o.idObra
inner join clientes cl
on o.idcliente=cl.codigo
inner join matriculas mat
on o.idmatricula=mat.idmatricula
where idtipotransaccion=3 
--and ho.fecha<=@Cierre and isnull(cpi.FechaCierre,'29001231')>@Cierre
and (@idObra=0 or cpi.Area=@idOBra)
and year(cpi.FechaCierre)=year(@Cierre) and month(cpi.FechaCierre)=month(@Cierre)
and ho.fecha between case when @Desde='' then '19000101' else @Desde end 
and case when @Hasta='' then '29000101' else @Hasta end 
AND cpi.cuentaneto=132000

order by idObra,Modo











GO
/****** Object:  StoredProcedure [dbo].[ObrasEnCurso]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE Procedure [dbo].[ObrasEnCurso]
	@idObra	int=0,
	@Cierre	varchar(8)='20140630',
	@Desde	varchar(8)='',
	@Hasta	varchar(8)='',
	@TC		float=8.133,
	@CR     varchar(1)='C',
	@AL		varchar(1)='L'
as
Select @TC tc ,case when ea.tipoMovimiento=22 then 0 else 1 end Modo,ea.idcampo idCampoEA,
a.notas,a.articulo,ea.docum,isnull(fechaDos,ho.fecha) fecha,substring(a.descripcion,1,19) descripcion,
ea.cantidad*ts.Signo*-1 Cantidad,case when ea.tipomovimiento=22 then ea.cantidad else case when @Cierre='20090630' then iv3006.uspunit else isnull(bi.precio,a.precio) end end precio,
case when ea.tipomovimiento=22 then ea.cantidad else ea.cantidad*case when @Cierre='20090630' then iv3006.uspunit else isnull(bi.precio,a.precio) end*ts.Signo*-1 end subtotalDolares,

case when ea.tipomovimiento=22 then ea.cantidad else ea.cantidad*case when @Cierre='20090630' then iv3006.uspunit else isnull(bi.precio,a.precio) end*ts.Signo*-1*@TC end Pesos,
ea.tipomovimiento,isnull(ea.idObra,hm.idobra) idobra,
cl.razonSocial,
ea.idProveedor,ea.fcProv,
ho1.fecha fechaFc,right(vch1.nrocomprobante,8) + ' ' +  vch1.tipofactura Observacion,ea.idcampoAnexo,mt.idcampo, mt.idoperacion,pv.razonsocial RazonSocialProveedor,nombreAvion,mat.matricula,
0 as tabla
from EstadisticaArticulos ea
left join headerMovimientosStock hm
on ea.idoperacion=hm.idoperacion
left join Header_operaciones ho 
on hm.idOperacion=ho.idoperacion
inner join tiposMovimientoStock t
on ea.tipomovimiento=t.idtipoMovimientoStock
left join articulos a
on ea.idArticulo=a.idArticulo
left join baseinventarios bi
on a.idarticulo=bi.idarticulo and substring(@Cierre,1,6) between vigenciadesde and vigenciaHasta
left join baires..inventar iv3006
on cast(a.articulo as varchar(6))=cast(iv3006.articulo  as varchar(6))
inner join cuentas ct
on ct.cuenta=132000
left join anexoMateriales mt 
on ea.idcampoanexo=mt.idcampo and mt.partNumber=ea.articuloProveedor and mt.idOperacion is not null
left join Header_operaciones ho1
on mt.idOPeracion=ho1.idoperacion
left join detalle_operaciones do1
on ho1.idoperacion=do1.idoperacion and idtipotransaccion=0
left join vencliheader vch1
on do1.idtransaccion=vch1.idtransaccion and vch1.fecha<@Cierre
inner join obras o
on hm.idobra=o.idObra
inner join clientes cl
on o.idcliente=cl.codigo
left join proveedores pv
on ea.idproveedor=pv.codigo
inner join tiposMovimientoStock ts
on ea.tipoMovimiento=ts.idtipomovimientoStock
inner join matriculas mat
on o.idmatricula=mat.idmatricula
where isnull(fechaDos,ho.fecha)<=@Cierre and isnull(ea.fecfactura,'29001231')>@Cierre
and (tipoMovimiento=4 or TipoMovimiento=9 or TipoMovimiento=22)
and (@idObra=0 or o.idObra=@idOBra)
and (isnull(fechaDos,ho.fecha)>isnull(o.cierre,'19000101'))
and isnull(fechaDos,ho.fecha) between case when @Desde='' then '19000101' else @Desde end 
and case when @Hasta='' then '29000101' else @Hasta end 
union 
Select @TC,case when ea.tipoMovimiento=22 then 0 else 1 end Modo,ea.idcampo idCampoEA,
a.notas,a.articulo,ea.docum,isnull(fechaDos,ho.fecha) fecha,substring(a.descripcion,1,19) descripcion,
ea.cantidad*ts.Signo*-1 Cantidad,case when ea.tipomovimiento=22 then ea.cantidad else case when @Cierre='20090630' then iv3006.uspunit else isnull(bi.precio,a.precio) end end precio,

case when ea.tipomovimiento=22 then ea.cantidad else ea.cantidad*case when @Cierre='20090630' then iv3006.uspunit else isnull(bi.precio,a.precio) end*ts.Signo*-1 end subtotalDolares,
case when ea.tipomovimiento=22 then ea.cantidad else ea.cantidad*case when @Cierre='20090630' then iv3006.uspunit else isnull(bi.precio,a.precio) end*ts.Signo*-1*@TC end Pesos,
ea.tipomovimiento,isnull(ea.idObra,hm.idobra) idobra,
cl.razonSocial,
ea.idProveedor,ea.fcProv,
ho1.fecha fechaFc,right(vch1.nrocomprobante,8) + ' ' +  vch1.tipofactura Observacion,ea.idcampoAnexo,mt.idcampo, mt.idoperacion,pv.razonsocial RazonSocialProveedor,nombreAvion,mat.matricula,
0 as tabla
from EstadisticaArticulos ea
left join headerMovimientosStock hm
on ea.idoperacion=hm.idoperacion
left join Header_operaciones ho 
on hm.idOperacion=ho.idoperacion
inner join tiposMovimientoStock t
on ea.tipomovimiento=t.idtipoMovimientoStock
left join Articulos a
on ea.idArticulo=a.idArticulo
left join baseinventarios bi
on a.idarticulo=bi.idarticulo and substring(@Cierre,1,6) between vigenciadesde and vigenciaHasta
left join baires..inventar iv3006
on cast(a.articulo as varchar(6))=cast(iv3006.articulo  as varchar(6))
inner join cuentas ct
on ct.cuenta=132000
left join anexoMateriales mt 
on ea.idcampoanexo=mt.idcampo and mt.partNumber=ea.articuloProveedor and mt.idOperacion is not null
left join Header_operaciones ho1
on mt.idOPeracion=ho1.idoperacion
left join detalle_operaciones do1
on ho1.idoperacion=do1.idoperacion and idtipotransaccion=0
left join vencliheader vch1
on do1.idtransaccion=vch1.idtransaccion and vch1.fecha<@Cierre
inner join obras o
on ea.idObra=o.idObra
inner join clientes cl
on o.idcliente=cl.codigo
left join proveedores pv
on ea.idproveedor=pv.codigo
inner join tiposMovimientoStock ts
on ea.tipoMovimiento=ts.idtipomovimientoStock
inner join matriculas mat
on o.idmatricula=mat.idmatricula
where isnull(fechaDos,ho.fecha)<=@Cierre and isnull(ea.fecfactura,'29001231')>@Cierre
and (tipoMovimiento=4 or TipoMovimiento=9 or TipoMovimiento=22)
and (@idObra=0 or o.idObra=@idOBra)
and (isnull(fechaDos,ho.fecha)>isnull(o.cierre,'19000101'))
and isnull(fechaDos,ho.fecha) between case when @Desde='' then '19000101' else @Desde end 
and case when @Hasta='' then '29000101' else @Hasta end 
union 
Select @TC,
0 Modo,cph.idtransaccion idCampoEA,
'' notas,'' articulo,0 docum,ho.fecha fecha,'' descripcion,
1 Cantidad,cpi.importe precio,0 subtotalDolares,
tmh.Multiplicador*cpi.importe*case when moneda=1 then TC else 1 end Pesos,
cph.tipoComprobante tipomovimiento,cpi.area idobra,
cl.razonsocial razonSocial,
isnull(pv.codigo,pf.proveedor) idproveedor,right(cph.nroComprobante,8) nrocomprobante,
cph.fecha fechaFc,'' Observacion,0 idcampoAnexo,0 idcampo, 0 idoperacion,
isnull(pv.razonSocial,pf.razonsocial) razonSocialProveedor,nombreAvion,mat.matricula, 1 as tabla
from header_operaciones ho 
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion 
inner join CompProvHeader cph
on do.idtransaccion=cph.idtransaccion 
inner join tipCompModHeader tmh 
on cph.tipoComprobante=tmh.codigo
inner join compProvItems cpi
on cph.idtransaccion=cpi.idtransaccion 
left join proveedores pv
on cph.proveedor=pv.codigo
left join provFondo pf
on cph.proveedor=pf.proveedor
inner join obras o
on cpi.area=o.idObra
inner join clientes cl
on o.idcliente=cl.codigo
inner join matriculas mat
on o.idmatricula=mat.idmatricula
where idtipotransaccion=1 
and ho.fecha<=@Cierre 
and isnull(cpi.FechaCierre,'29001231')>@Cierre
and (@idObra=0 or cpi.Area=@idOBra)
and ho.fecha between case when @Desde='' then '19000101' else @Desde end 

and case when @Hasta='' then '29000101' else @Hasta end 
AND cpi.cuenta=132000

union 
Select @TC,
0 Modo,cph.idtransaccion idCampoEA,
'' notas,'' articulo,0 docum,ho.fecha fecha,'' descripcion,
1 Cantidad,cpi.importe precio,0 subtotalDolares,
tmh.Multiplicador*cpi.importe Pesos,
cph.tipoComprobante tipomovimiento,cpi.area idobra,
cl.razonSocial,
isnull(pv.codigo,pf.proveedor) idproveedor,right(cph.nroComprobante,8) nrocomprobante,
cph.fecha fechaFc,'' Observacion,0 idcampoAnexo,0 idcampo, 0 idoperacion,
isnull(pv.razonSocial,pf.razonsocial) razonSocialProveedor,nombreAvion,mat.matricula, 2 as tabla
from header_operaciones ho 
inner join detalle_operaciones do 
on ho.idOperacion=do.idOperacion 
inner join CompFondosHeader cph
on do.idtransaccion=cph.idtransaccion 
inner join tipCompModHeader tmh 
on cph.tipoComprobante=tmh.codigo
inner join compFondosItems cpi
on cph.idtransaccion=cpi.idtransaccion 
left join proveedores pv
on cph.proveedor=pv.codigo
left join provFondo pf
on cph.proveedor=pf.proveedor
inner join obras o
on cpi.area=o.idObra
inner join clientes cl
on o.idcliente=cl.codigo
inner join matriculas mat
on o.idmatricula=mat.idmatricula
where idtipotransaccion=3 
and ho.fecha<=@Cierre and isnull(cpi.FechaCierre,'29001231')>@Cierre
and (@idObra=0 or cpi.Area=@idOBra)
and ho.fecha between case when @Desde='' then '19000101' else @Desde end 
and case when @Hasta='' then '29000101' else @Hasta end 
AND cpi.cuentaneto=132000

order by idObra,Modo,a.descripcion,a.notas


/*




Select * from obrasab
order by idobra

Select * from obras

Select * from matriculas

Select * from clientes 
where codigo=121900

*/
GO
/****** Object:  StoredProcedure [dbo].[ObrasEnCursoResumido]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE Procedure [dbo].[ObrasEnCursoResumido]
	@Cierre			varchar(8)='20120131',
	@ComputerName	varchar(200)='SERVERBAIRES'
as
Select idobra,matricula,nombreavion,razonsocial,
sum(case when modo=0 then 1 else 0 end) MO,
sum(case when modo=1 then 1 else 0 end) MT,
sum(case when modo=1 and isnull(Fechafc,'29000101')<@Cierre then 1 else 0 end) MT
from obrasAB
where computerName=@ComputerName
Group by idobra,matricula,nombreavion,razonsocial






GO
/****** Object:  StoredProcedure [dbo].[OperacionesdelDia]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[OperacionesdelDia]
	@D_Fecha as DateTime=null
As
begin
if @D_Fecha is null
begin
	set @D_fecha=getdate()
end
(
SELECT Movimientos.Fecha, Movimientos.hora, 
    Clientes.Razon_Social, Monedas.Descripcion AS Moneda, 
    Movimientos.Cantidad AS Compra, 0 AS Venta, 
    Movimientos.Precio, Movimientos.Neto, 0 as Modificar,
    Movimientos.idOperacion, 
    Movimientos.idOperacionCalce, movimientos.Tipooperacion, movimientos.moneda,movimientos.cliente, 
    movimientos.idContacto, Movimientos.Precio_Contacto, Movimientos.estado
FROM Movimientos INNER JOIN
    Clientes ON 
    Movimientos.Cliente = Clientes.Codigo INNER JOIN
    Monedas ON 
    Movimientos.Moneda = Monedas.idMoneda INNER JOIN
    Operaciones ON 
    Movimientos.TipoOperacion = Operaciones.idTipoOperacion
WHERE (Movimientos.TipoOperacion = 0) and day(fecha)=day(@D_Fecha) and month(fecha)=month(@D_Fecha) and year(fecha)=year(@D_Fecha)
)
Union
(
SELECT Movimientos.Fecha, Movimientos.hora, 
    Clientes.Razon_Social, Monedas.Descripcion AS Moneda, 0 AS Compra,
    Movimientos.Cantidad AS Venta, 
    Movimientos.Precio, Movimientos.Neto, 0 as Modificar, 
    Movimientos.idOperacion, 
    Movimientos.idOperacionCalce, movimientos.Tipooperacion, movimientos.moneda,movimientos.cliente, movimientos.idContacto, Movimientos.Precio_Contacto, Movimientos.estado
FROM Movimientos INNER JOIN
    Clientes ON 
    Movimientos.Cliente = Clientes.Codigo INNER JOIN
    Monedas ON 
    Movimientos.Moneda = Monedas.idMoneda INNER JOIN
    Operaciones ON 
    Movimientos.TipoOperacion = Operaciones.idTipoOperacion
WHERE (Movimientos.TipoOperacion = 1) and day(fecha)=day(@D_Fecha) and month(fecha)=month(@D_Fecha) and year(fecha)=year(@D_Fecha)
)
Order by fecha
end

GO
/****** Object:  StoredProcedure [dbo].[Orden]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE    Procedure [dbo].[Orden]
as
Select p.Fecha,idPresupuesto,c.RazonSocial cliente,v.nyap vendedor,s.descripcion,
TipoConsulta,Observacion,idtransaccion from Presupuestos p
inner join clientes c
on p.Cliente=c.Codigo
inner join sistemas s
on s.idsistema=p.idsistema
inner join vendedores v
on p.idvendedor=v.idvendedor

where isnull(ok,0)=0

order by idpresupuesto



GO
/****** Object:  StoredProcedure [dbo].[OrdenesPagoHeader]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO

--OrdenesPagoHeader 16,1

CREATE          Procedure [dbo].[OrdenesPagoHeader]

	@Operacion	int = Null,
	@Usuario	int
AS
Declare @C_String nvarchar(4000)

/********************************************************************************/
/*			Consulta para los datos Header 				*/
/********************************************************************************/

set @C_String = 'Select	A04.Codigo as NumeroProveedor, A04.RazonSocial,
			A03.nrocomprobante as NumeroOP, A03.fecha, A03.totalimporte,
			A01.idOperacion, A05.uName as Usuario, A03.DescripcionImporte,
			A01.ObservacionComprobante,NombreEmpresa,p.domicilio,p.localidad,p.telefono,p.mail, a04.telefono1 as TelProv
		From Header_Operaciones A01
			inner join Detalle_Operaciones A02
				on A01.idOperacion = A02.idOperacion and A02.idTipotransaccion = 1
			inner join CompProvHeader A03 
				on A02.idTransaccion = A03.idTransaccion and A03.TipoComprobante = 0
			inner join Proveedores A04
				on A03.proveedor = A04.codigo 
			Left join ParametrosGeneralesSueldos p
				on p.nombreEmpresa=p.nombreEmpresa
			left join Usuarios_Tesoreria A05
				on A05.idUsuario = ' + convert(char(10),@Usuario) + '
		Where A01.TipodeOperacion = 20 '

if @Operacion is not null and @Operacion <> 0
	set @C_String =	@C_String + ' and A01.idOperacion = ' + convert(char(10),@Operacion)

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String

GO
/****** Object:  StoredProcedure [dbo].[OrdenesPagoItems]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO






--Select * from CompProvItems

-- exec Basecrm.dbo.OrdenesPagoItems 94

CREATE                Procedure [dbo].[OrdenesPagoItems]

	@Operacion	int
AS
Declare @C_String nvarchar(4000)

/********************************************************************************/
/*			Consulta para los datos Items 				*/
/********************************************************************************/

set @C_String = 'Select A05.tipofactura, A05.nrocomprobante, A05.fecha as Emision, 
			a04.importe*Multiplicador as Importe, A01.idOperacion, 
			0 Cuenta, "" Desc_Cuenta,"" Detalle /*a06.Detalle as detalle*/,
		(Select Sum(vt.importe)
from Detalle_operaciones do 
inner join ValoresTesoreria vt
on do.idtransaccion=vt.idtransaccion
where idOperacion=' + cast(@Operacion as char(6)) + ' and idtipotransaccion=2) Pago
		From Header_Operaciones A01
			inner join Detalle_Operaciones A02
				on A01.idOperacion = A02.idOperacion 
			inner join CompProvHeader A03 
				on A02.idTransaccion = A03.idTransaccion and A03.TipoComprobante = 0
			inner join aplicacionesCuentasapagar A04
				on A03.idTransaccion = A04.idTransaccion
			inner join CompProvHeader A05
				on A04.idTransaccionCancelada = A05.idTransaccion 
/*			left join CompProvItems A06
				on A06.comprobante = A05.comprobante and A06.aniomes = A05.aniomes
			left join Cuentas A07
				on A06.cuenta = A07.cuenta*/
			left join tipCompModHeader tcm
				on a05.tipoComprobante=tcm.codigo
'

if @Operacion is not null and @Operacion <> 0
	set @C_String =	@C_String + ' where signo=2 and A04.Importe<>0 and idTipoTransaccion=1 and A01.idOperacion = ' + convert(char(10),@Operacion)

set @C_String = @C_String +' union Select tcm.comprobante tipofactura, 
			A05.nrocomprobante, A05.fecha as Emision, 
			(a04.importe)*Multiplicador as Importe, A01.idOperacion, 
			0 as Cuenta, "Aplicacion OP" as Desc_Cuenta,"" Detalle ,/*	a06.Detalle as detalle ,*/
		(Select Sum(vt.importe)
from Detalle_operaciones do 
inner join ValoresTesoreria vt
on do.idtransaccion=vt.idtransaccion
where idOperacion=' + cast(@Operacion as char(6)) + ' and idtipotransaccion=2) Pago
		From Header_Operaciones A01
			inner join Detalle_Operaciones A02
				on A01.idOperacion = A02.idOperacion 
			inner join CompProvHeader A03 
				on A02.idTransaccion = A03.idTransaccion and A03.TipoComprobante = 0
			inner join aplicacionesCuentasapagar A04
				on A03.idTransaccion = A04.idTransaccion
			inner join CompProvHeader A05
				on A04.idTransaccionCancelada = A05.idTransaccion 
			left join CompProvItems A06
				on A06.comprobante = A05.comprobante and A06.aniomes = A05.aniomes
			left join Cuentas A07
				on A06.cuenta = A07.cuenta
			left join tipCompModHeader tcm
				on a05.tipoComprobante=tcm.codigo
'
if @Operacion is not null and @Operacion <> 0
	set @C_String =	@C_String + ' where signo=1 and A01.idOperacion = ' + convert(char(10),@Operacion)

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--Print @c_string








GO
/****** Object:  StoredProcedure [dbo].[OrdenesPagoValores]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO

/* Este Procedimiento se utiliza tanto para las ordenes de Pago, como para las Ordenes de Pago Varias */

-- OrdenesPagoValores 36564

CREATE        Procedure [dbo].[OrdenesPagoValores]

	@Operacion	int
AS

Declare @C_String nvarchar(4000)

/******************************************************************************************/
/*		Consulta para los datos de pagos				*/
/******************************************************************************************/

set @C_String = 'Select	a03.fechaemision as fechaEmision,A04.Descripcion, A03.importe, A01.idOperacion, A03.Cuenta, 
			A03.Sucursal, A03.Numero, A05.descripcion as Banco, A04.modalidad,
			A03.Observaciones,  a03.base,
			a03.tipocambio
		From Header_Operaciones A01
			inner join Detalle_Operaciones A02
				on A01.idOperacion = A02.idOperacion and A02.idTipotransaccion = 2
			inner join valoresTesoreria A03
				on A02.idTransaccion = A03.idTransaccion
			inner join Conceptos_Tesoreria A04
				on A03.idConcepto_Tesoreria = A04.idConcepto_Tesoreria 
			left join bancos A05
				on A03.banco = A05.banco '

if @Operacion is not null and @Operacion <> 0
	set @C_String =	@C_String + ' where tipomovimiento=2 and A01.idOperacion = ' + convert(char(10),@Operacion)

	set @C_String =	@C_String + ' Order by A04.Descripcion DESC '

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String





GO
/****** Object:  StoredProcedure [dbo].[OrdenesPagoVariosHeader]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO





CREATE           Procedure [dbo].[OrdenesPagoVariosHeader]

	@Operacion	int = Null,
	@Usuario	int =1
AS
Declare @C_String nvarchar(4000)

/********************************************************************************/
/*			Consulta para los datos Header 				*/
/********************************************************************************/

set @C_String = 'Select	A01.idOperacion, A03.Fecha, A03.detalle, A04.uName as Usuario, A01.ObservacionComprobante,
NombreEmpresa,p.domicilio,p.localidad,p.telefono,p.mail
		From Header_Operaciones A01
/*			inner join Detalle_Operaciones A02
				on A01.idOperacion = A02.idOperacion and A02.idTipotransaccion = 2 */
			inner join asientosdiariosheader A03
				on A01.asientodiario = A03.asiento and A01.aniomes = A03.aniomes and A03.tipoasiento = A01.tipoasiento
			Left join ParametrosGeneralesSueldos p
				on p.nombreEmpresa=p.nombreEmpresa
			left join Usuarios_Tesoreria A04
				on A04.idUsuario = ' + convert(char(10),@Usuario) 

if @Operacion is not null and @Operacion <> 0
	set @C_String =	@C_String + ' Where A01.idOperacion = ' + convert(char(10),@Operacion)

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--Print @C_String





GO
/****** Object:  StoredProcedure [dbo].[OrdenesPagoVariosItems]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE     Procedure [dbo].[OrdenesPagoVariosItems]

	@Operacion	int
AS
Declare @C_String nvarchar(4000)

/********************************************************************************/
/*			Consulta para los datos Items 				*/
/********************************************************************************/

set @C_String = 'Select A01.IdOperacion, A01.Fecha, A03.cuenta, A04.descripcion as DescCuenta, 
			A03.debe as Importe
		From Header_Operaciones A01 
			inner join AsientosDiariosHeader A02
				on A01.asientodiario = A02.asiento and A01.aniomes = A02.aniomes and A02.tipoasiento = a01.tipoasiento
			inner join AsientosDiariosItems A03
				on A02.asiento = A03.asiento and A02.aniomes = A03.aniomes and A03.tipoasiento = a02.tipoasiento and A03.haber = 0
			inner join Cuentas A04
				on A03.cuenta = A04.cuenta '

if @Operacion is not null and @Operacion <> 0
	set @C_String =	@C_String + ' where A01.idOperacion = ' + convert(char(10),@Operacion)

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--Print @C_String


GO
/****** Object:  StoredProcedure [dbo].[PadronaFecha]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE            Procedure [dbo].[PadronaFecha]
(
	@Fecha		char(8),
	@Divide		int,
	@Hospital	int=null,
	@Grupo		char(1)=null
)
as
Begin

if @Grupo='0'
	select @Grupo=null

Select * from fnPadronaFecha(@Fecha,@Divide,@Hospital,@Grupo)

order by Unificador ,Apellido,nombre 
end




GO
/****** Object:  StoredProcedure [dbo].[PadronaFecha_Base]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


-- PadronaFecha '20050505',0

CREATE         Procedure [dbo].[PadronaFecha_Base] 
(
	@Fecha		char(8),
	@Divide		int,
	@Hospital	int=null,
	@Grupo		char(1)=null

)
as

Select Distinct rm.Grupo gRpt, GrupoReporte=(case when @divide=1 then rm.Grupo else '                                                ' end)-- as GrupoReporte
,sc.socio,apellido,nombre,case when @divide=1 then unificador else 1 end Unificador,
sc.numedocto,td.descripcion as tipo,
case when @divide=1 then unialfa else 1 end unialfa,
case when @divide=1 then rm.Grupo else rm.resumido end as Hospital

from socios sc
inner join Grupos_Socios gs
on sc.socio=gs.socio
Inner join repMuni rm
on gs.reparticion=rm.codigo 
and gs.LugarPago =rm.subCodigo 
inner join TiposDocumento td
on td.tipodocto = sc.tipodocto
inner join TiposMatricula tm
on tm.tipoMatricula = sc.tipoMatricula 
where 
dbo.activosaFecha(0,sc.socio,@Fecha)>0
and sc.grupo=isnull(@Grupo,sc.grupo)
and unificador=isnull(@Hospital,unificador)

-- and sc.socio<>20783

order by case when @divide=1 then rm.Grupo else '                                                ' end ,Apellido,nombre 








GO
/****** Object:  StoredProcedure [dbo].[PadronaFechaMails]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE            Procedure [dbo].[PadronaFechaMails]
(
	@Fecha		char(8),
	@Divide		int,
	@Hospital	int=null,
	@Grupo		char(1)=null
)
as

Select * from fnPadronaFechaMails(@Fecha,@Divide,@Hospital,@Grupo)

order by Unificador ,Apellido,nombre 





GO
/****** Object:  StoredProcedure [dbo].[PasaHospitales]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create Procedure [dbo].[PasaHospitales] 
as

Select 
Substring(col001,32,1),
substring(col002,1,2),
substring(col002,3,3),
substring(col001,24,2),
'2'+substring(col001,7,4),
'00'+substring(col001,12,3),
col001,col002,col003 from ldsp580
where col002 like '%DE MARCO%'


GO
/****** Object:  StoredProcedure [dbo].[pendienteObra]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE   Procedure [dbo].[pendienteObra]
(
	@idObra	 int=6784,
	@SC		 char(1)='S',
	@idOperacion	int=0,
	@coeficiente	numeric(18,2)=1.8
)
as
Declare @sqlString nvarchar(4000)
Declare @sqlConcat varchar(7)
set @sqlConcat=' Where '


set @sqlString='Select ax.partNumber,substring(ax.descripcion,1,19) as Descripcion,ax.idOperacion,round(ax.precio*' + cast(@coeficiente as varchar(12)) + ',2) as Neto, sum(isnull(ax.cantidad,0)) as Cantidad, case when sum(isnull(ax.afacturar,0)) <>0 then 1 else 0 end  as afacturar, 
round(ax.precio*' + cast(@coeficiente as varchar(12)) + ',2)*Sum(ax.Cantidad) Subtotal, avg(afacturarmanual) afacturarmanual  

from AnexoMateriales ax

'
if @idObra<>0
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' isnull(ax.idobra,0)=' + cast(@idObra as char(10)) 
Select @sqlConcat=' and '
end


if @idOperacion<>0
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' ax.idOPeracion=' + cast(@idOperacion as char(10)) 
Select @sqlConcat=' and '
end
else
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' isnull(ax.idOPeracion,0)=0' -- cast(@idOperacion as char(10)) 
Select @sqlConcat=' and '
end

set @sqlString=@sqlString + ' group by ax.partNumber,substring(ax.descripcion,1,19),ax.idOperacion,round(ax.precio*' + cast(@coeficiente as varchar(12)) + ',2) 

Having sum(cantidad)<>0

'

Set @sqlString=@sqlString + ' Order by a.descripcion,e.partNumber '

--print @sqlString

exec sp_executesql @sqlString















GO
/****** Object:  StoredProcedure [dbo].[pendienteObraMO]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


CREATE   Procedure [dbo].[pendienteObraMO]
(
	@idObra	 int=8634,
	@idOperacion	int=0
--,
--	@SC		 char(1)='S',
--	@Desde		Char(8)='',
--	@Hasta		Char(8)='',
--	@idArticulo	int=0,


)
as



Declare @sqlString nvarchar(4000)
Declare @sqlConcat varchar(7)
set @sqlConcat=' Where '

set @sqlString='Select getdate() fecha,"Movimiento Mano de Obra" observacion,0 comprobantenumero,1 Deposito,0 idarticulo,"MO" Articulo,"" articuloProveedor,
Detalle descripcion,"" serial,cantidad,idcampo, 1 as pedido, 1 entregado,0 idOperacion,
-- razonsocial,
"" observacioncomprobante, precio Neto, idCampoOrigen
from TempFacturacionMO
where isnull(idOperacion,0)=' + cast(@idOperacion as varchar(8))  + ' and isnull(idCampoDestino,0)=0 and idObra=' + cast(@idObra as varchar(15)) +
' order by idCampoOrigen asc,idcampo '



-- print @sqlString

exec sp_executesql @sqlString












GO
/****** Object:  StoredProcedure [dbo].[pendienteObraMOPresupuestos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO

Create  Procedure [dbo].[pendienteObraMOPresupuestos]
(
	@idObra	 int=6800,
	@idOperacion	int=0
--,
--	@SC		 char(1)='S',
--	@Desde		Char(8)='',
--	@Hasta		Char(8)='',
--	@idArticulo	int=0,


)
as



Declare @sqlString nvarchar(4000)
Declare @sqlConcat varchar(7)
set @sqlConcat=' Where '

set @sqlString='Select getdate() fecha,"Movimiento Mano de Obra" observacion,0 comprobantenumero,1 Deposito,0 idarticulo,"MO" Articulo,"" articuloProveedor,
Detalle descripcion,"" serial,cantidad,idcampo, 1 as pedido, 1 entregado,0 idOperacion,
-- razonsocial,
"" observacioncomprobante, precio Neto, idCampoOrigen
from TempFacturacionMOPresupuestos
where isnull(idOperacion,0)=' + cast(@idOperacion as varchar(8))  + ' and isnull(idCampoDestino,0)=0 and idObra=' + cast(@idObra as varchar(15)) +
' order by idCampoOrigen asc,idcampo '



-- print @sqlString

exec sp_executesql @sqlString











GO
/****** Object:  StoredProcedure [dbo].[pendienteObraPresupuestos]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO

Create   Procedure [dbo].[pendienteObraPresupuestos]
(
	@idObra	 int=6784,
	@SC		 char(1)='S',
	@idOperacion	int=0,
	@coeficiente	numeric(18,2)=1.8
)
as
Declare @sqlString nvarchar(4000)
Declare @sqlConcat varchar(7)
set @sqlConcat=' Where '


set @sqlString='Select ax.partNumber,substring(ax.descripcion,1,19) as Descripcion,ax.idOperacion,round(ax.precio*' + cast(@coeficiente as varchar(12)) + ',2) as Neto, sum(isnull(ax.cantidad,0)) as Cantidad, case when sum(isnull(ax.afacturar,0)) <>0 then 1 else 0 end  as afacturar, 
round(ax.precio*' + cast(@coeficiente as varchar(12)) + ',2)*Sum(ax.Cantidad) Subtotal

from AnexoMaterialesPresupuestos ax

'


if @idObra<>0
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' isnull(ax.idobra,0)=' + cast(@idObra as char(10)) 
Select @sqlConcat=' and '
end


if @idOperacion<>0
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' ax.idOPeracion=' + cast(@idOperacion as char(10)) 
Select @sqlConcat=' and '
end
else
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' isnull(ax.idOPeracion,0)=0' -- cast(@idOperacion as char(10)) 
Select @sqlConcat=' and '
end

set @sqlString=@sqlString + ' group by ax.partNumber,substring(ax.descripcion,1,19),ax.idOperacion,round(ax.precio*' + cast(@coeficiente as varchar(12)) + ',2) 

Having sum(cantidad)<>0

'

Set @sqlString=@sqlString + ' Order by a.descripcion,e.partNumber '

-- print @sqlString

exec sp_executesql @sqlString
GO
/****** Object:  StoredProcedure [dbo].[pendientePedido]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


CREATE  Procedure [dbo].[pendientePedido]
(
	@idCliente	 int=0,
	@SC		 char(1)='S',
	@Desde		Char(8)='',
	@Hasta		Char(8)='',
	@idArticulo	int=0,
	@nroDesde	int=0,
	@nroHasta	int=0,
	@idOperacion	int=0

)
as
Declare @sqlString nvarchar(4000)
Declare @sqlConcat varchar(7)
set @sqlConcat=' Where '

set @sqlString='Select ho.fecha,ho.observacion,ho.comprobantenumero,e.Deposito,e.idarticulo,a.articulo,
a.descripcion,"" serial,e.cantidad-sum(isnull(ea.cantidad,0)) as cantidad,e.idcampo, e.cantidad as pedido, sum(isnull(ea.cantidad,0)) as entregado,ho.idOperacion,substring(vh.nrocomprobante,5,8) numero,cl.razonsocial,ho.observacioncomprobante
from estadisticaArticulosPedidos e
inner join estadisticaArticulosPreciosPedidos ep
on e.idcampo=ep.idcampo
inner join articulos a
on e.idarticulo=a.idarticulo
inner join Header_operaciones ho 
on e.idOperacion=ho.idOperacion
inner join detalle_operaciones do 
on do.idoperacion=ho.idoperacion
inner join Pedidos vh
on do.idtransaccion=vh.idtransaccion
inner join clientes cl
on e.deposito=cl.codigo
left join estadisticaArticulos ea
on e.idarticulo=ea.idarticulo and e.idcampo=ea.idcampoorigen'

if @Desde<>""
begin
	Select @sqlString=@sqlString + @sqlConcat + 
' ho.Fecha>="' + @Desde + '"'
Select @sqlConcat=' and '
end

if @Hasta<>""
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' ho.Fecha<="' + @Hasta + '"'
Select @sqlConcat=' and '
end

if @idCliente<>0
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' cl.codigo=' + cast(@idCliente as char(10)) 
Select @sqlConcat=' and '
end

if @idArticulo<>0
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' ea.idArticulo=' + cast(@idArticulo as char(10)) 
Select @sqlConcat=' and '
end

if @nroDesde<>0
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' Substring(nroComprobante,5,8)>=' + cast(@nroDesde as char(8)) 
Select @sqlConcat=' and '
end

if @nroHasta<>0
Begin
	Select @sqlString=@sqlString  + @sqlConcat + 
' Substring(nroComprobante,5,8)<=' + cast(@nroHasta as char(8)) 
Select @sqlConcat=' and '
end

if @idOperacion<>0
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' ho.idOPeracion=' + cast(@idOperacion as char(10)) 
Select @sqlConcat=' and '
end

set @sqlString=@sqlString + ' group by ho.fecha,ho.observacion,ho.comprobantenumero,e.Deposito,
e.idarticulo,a.articulo,a.descripcion,e.cantidad,e.idcampo,ho.idOperacion,substring(vh.nrocomprobante,5,8),cl.razonsocial,ho.observacioncomprobante '
if @SC='S'
	set @sqlString=@sqlString + ' having e.cantidad-sum(isnull(ea.cantidad,0))<>0'

exec sp_executesql @sqlString




GO
/****** Object:  StoredProcedure [dbo].[pendientePedidoHeader]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO

CREATE Procedure [dbo].[pendientePedidoHeader]
(
	@idOperacion	int=0,
	@idCliente	 int=0,
	@SC		 char(1)='S',
	@Desde		Char(8)='',
	@Hasta		Char(8)='',
	@idArticulo	int=0,
	@nroDesde	int=0,
	@nroHasta	int=0

)
as
Declare @sqlString nvarchar(4000)
Declare @sqlConcat varchar(7)
set @sqlConcat=' Where '

set @sqlString='Select distinct ho.fecha,ho.observacion,ho.comprobantenumero,e.Deposito,ho.idOperacion,substring(vh.nrocomprobante,5,8) numero,cl.razonsocial,ho.observacioncomprobante
from estadisticaArticulosPedidos e
inner join estadisticaArticulosPreciosPedidos ep
on e.idcampo=ep.idcampo
inner join articulos a
on e.idarticulo=a.idarticulo
inner join Header_operaciones ho 
on e.idOperacion=ho.idOperacion
inner join detalle_operaciones do 
on do.idoperacion=ho.idoperacion
inner join Pedidos vh
on do.idtransaccion=vh.idtransaccion
inner join clientes cl
on e.deposito=cl.codigo
left join estadisticaArticulos ea
on e.idarticulo=ea.idarticulo and e.idcampo=ea.idcampoorigen'

if @Desde<>""
begin
	Select @sqlString=@sqlString + @sqlConcat + 
' ho.Fecha>="' + @Desde + '"'
Select @sqlConcat=' and '
end

if @Hasta<>""
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' ho.Fecha<="' + @Hasta + '"'
Select @sqlConcat=' and '
end

if @idCliente<>0
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' cl.codigo=' + cast(@idCliente as char(10)) 
Select @sqlConcat=' and '
end

if @idArticulo<>0
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' ea.idArticulo=' + cast(@idArticulo as char(10)) 
Select @sqlConcat=' and '
end

if @nroDesde<>0
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' Substring(nroComprobante,5,8)>=' + cast(@nroDesde as char(8)) 
Select @sqlConcat=' and '
end

if @nroHasta<>0
Begin
	Select @sqlString=@sqlString  + @sqlConcat + 
' Substring(nroComprobante,5,8)<=' + cast(@nroHasta as char(8)) 
Select @sqlConcat=' and '
end

if @idOperacion<>0
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' ho.idOPeracion=' + cast(@idOperacion as char(10)) 
Select @sqlConcat=' and '
end

set @sqlString=@sqlString + ' group by ho.fecha,ho.observacion,ho.comprobantenumero,e.Deposito,
e.idarticulo,a.articulo,a.descripcion,e.cantidad,e.idcampo,ho.idOperacion,substring(vh.nrocomprobante,5,8),cl.razonsocial,ho.observacioncomprobante '
if @SC='S'
	set @sqlString=@sqlString + ' having e.cantidad-sum(isnull(ea.cantidad,0))<>0'

exec sp_executesql @sqlString



GO
/****** Object:  StoredProcedure [dbo].[pendientePedidoResumen]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


CREATE  Procedure [dbo].[pendientePedidoResumen]
(
	@idCliente	 int=0,
	@SC		 char(1)='S',
	@Desde		Char(8)='',
	@Hasta		Char(8)='',
	@idArticulo	int=0,
	@nroDesde	int=0,
	@nroHasta	int=0,
	@idOperacion	int=0

)
as
Declare @sqlString nvarchar(4000)
Declare @sqlConcat varchar(7)
set @sqlConcat=' Where '

set @sqlString='Select isnull(arc.articulo,ar.articulo) Componente, 
isnull(arc.descripcion,ar.Descripcion) dComponente, e.cantidad-sum(isnull(ea.cantidad,0)),
sum(isnull(fa.cantidad,1)) multiplicador,
case when isnull(arc.unidadesxbase,0)<>0 then 
round(sum(isnull(fa.cantidad,1))/arc.unidadesxbase,4) 
else 0 end base ,arc.unidadesxbase,arb.articulo aBase,arb.descripcion dBase
from estadisticaArticulosPedidos e
inner join estadisticaArticulosPreciosPedidos ep
on e.idcampo=ep.idcampo
inner join articulos ar
on e.idarticulo=ar.idarticulo
inner join Header_operaciones ho 
on e.idOperacion=ho.idOperacion
inner join detalle_operaciones do 
on do.idoperacion=ho.idoperacion
inner join Pedidos vh
on do.idtransaccion=vh.idtransaccion
inner join clientes cl
on e.deposito=cl.codigo
left join estadisticaArticulos ea
on e.idarticulo=ea.idarticulo and e.idcampo=ea.idcampoorigen
left join FormulasArticulos fa
on e.idarticulo=fa.idarticulo
left join articulos arc
on fa.idComponente=arc.idarticulo
left join Articulos arb
on arc.idarticulobase=arb.idarticulo '


if @Desde<>""
begin
	Select @sqlString=@sqlString + @sqlConcat + 
' ho.Fecha>="' + @Desde + '"'
Select @sqlConcat=' and '
end

if @Hasta<>""
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' ho.Fecha<="' + @Hasta + '"'
Select @sqlConcat=' and '
end

if @idCliente<>0
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' cl.codigo=' + cast(@idCliente as char(10)) 
Select @sqlConcat=' and '
end

if @idArticulo<>0
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' ea.idArticulo=' + cast(@idArticulo as char(10)) 
Select @sqlConcat=' and '
end

if @nroDesde<>0
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' Substring(nroComprobante,5,8)>=' + cast(@nroDesde as char(8)) 
Select @sqlConcat=' and '
end

if @nroHasta<>0
Begin
	Select @sqlString=@sqlString  + @sqlConcat + 
' Substring(nroComprobante,5,8)<=' + cast(@nroHasta as char(8)) 
Select @sqlConcat=' and '
end

if @idOperacion<>0
Begin
	Select @sqlString=@sqlString + @sqlConcat + 
' ho.idOPeracion=' + cast(@idOperacion as char(10)) 
Select @sqlConcat=' and '
end

set @sqlString=@sqlString + ' group by ho.fecha,ho.observacion,ho.comprobantenumero,e.Deposito,isnull(arc.articulo,ar.articulo),arc.unidadesxbase,arb.articulo,arb.descripcion,
e.idarticulo,ar.articulo,ar.descripcion,e.cantidad,e.idcampo,ho.idOperacion,substring(vh.nrocomprobante,5,8),cl.razonsocial,ho.observacioncomprobante,isnull(arc.descripcion,ar.Descripcion) '
if @SC='S'
	set @sqlString=@sqlString + ' having e.cantidad-sum(isnull(ea.cantidad,0))<>0'

exec sp_executesql @sqlString




GO
/****** Object:  StoredProcedure [dbo].[Percepcion_Aduana]    Script Date: 22/12/2025 17:04:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE procedure [dbo].[Percepcion_Aduana]
(
	@Desde	varchar(8)='20101116',
	@Hasta	varchar(8)='20101130',
	@Cuenta varchar(6)='127910',
	@jurisdiccion varchar(3)='901'
)
as

Select ho.idoperacion,ai.asiento,ai.tipoasiento,ai.aniomes,@jurisdiccion from asientosdiariositems ai 
inner join asientosdiariosheader ah 
on ai.asiento=ah.asiento and ai.aniomes=ah.aniomes and ai.tipoasiento=ah.tipoasiento
inner join header_Operaciones ho
on ho.asientoDiario=ah.asiento and ho.aniomes=ah.aniomes and ho.tipoasiento=ah.tipoasiento
where ai.cuenta=@Cuenta
and ah.Fecha between @Desde and @Hasta

Select * from detalle_operaciones
where idoperacion=234229
GO
/****** Object:  StoredProcedure [dbo].[Percepciones]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[Percepciones]
(
	@Desde	varchar(8)='20101116',
	@Hasta	varchar(8)='20101130'
)
as
Select cl.cuit,v.fecha, case when (Select i.Neto from vBaseiva i
where i.idtransaccion=v.idtransaccion)>0 then 'F' else 'C' end tComp,tipofactura,nrocomprobante,
(Select abs(i.Neto) from vBaseiva i
where i.idtransaccion=v.idtransaccion),
(Select abs(i.Pib) from vBaseiva i
where i.idtransaccion=v.idtransaccion)

 from Vencliheader v
inner join clientes cl
on v.cliente=cl.codigo
inner join vencliitems vi
on v.idtransaccion=vi.idtransaccion
where concepto='PIB'
and importe<>0
and v.fecha between @Desde and @Hasta


GO
/****** Object:  StoredProcedure [dbo].[pgJucios]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[pgJucios]
(
	@idJuicio	int
)
as
Select Fecha, Observacion,Descripcion,importe from PagosJuicios pj
inner join categoriasPagos cj
on pj.idcategoria=cj.idcategoria
where idJuicio=@idJuicio
order by fecha

GO
/****** Object:  StoredProcedure [dbo].[Planilla]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO








CREATE        Procedure [dbo].[Planilla]
as
SELECT
a.legajo AS Legajo, 
a.obrasocial AS Osoc, 
a.apellido AS Apellido, 
a.nombre AS Nombre, 
Dbo.edad(FechasLegajos.fecha,getdate()) AS Antig, 
a.cuil AS cuil,

Dbo.Basico(a.legajo) as Basico,
Dbo.Titulo(a.legajo) as Titulo,
Dbo.Asistencia(a.Legajo) as asistencia,
Dbo.Puntualidad(a.Legajo) as Puntualidad,
Dbo.antig(a.legajo,Dbo.edad(FechasLegajos.fecha,getdate())) as antiguedad,
Dbo.Adicional(a.legajo) as Adicional,
Dbo.ManejoPC(a.legajo) as ManejoPC, 
Dbo.Incentivo(a.legajo) as Incentivo,
Dbo.FallaCaja(a.legajo) as Falla,
Dbo.TituloUniv(a.legajo) as TituloUniv,
Dbo.Hora50(a.legajo) as Hora50, 
Dbo.Hora100(a.legajo) as Hora100, 
100 as AdicionalJulio, 
100 as AdicionalAgosto,
dbo.adicionalCargo(a.legajo) as adicCargo, 

dbo.Hijo(a.Legajo) as  Hijo,
dbo.aCargo(a.legajo) as aCargo,
 
Dbo.Remuneracion(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate())) as Remuneracion, 

Dbo.Prestamo(a.legajo) as Prestamo,
Dbo.Jubil(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate())) as Jubil,
Dbo.Ley19032(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate())) as ley19032,
Dbo.sindicato(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate())) as Sindicato,
Dbo.ObraSocial(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate())) as ObraSocial,
Dbo.Ley19032_100(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate())) as ley19032_100,
Dbo.ObraSocial_100(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate())) as ObraSocial_100,
Dbo.Sindicato_100(a.Legajo,Dbo.edad(FechasLegajos.fecha,getdate())) as Sindicato_100,
Dbo.RG(a.Legajo) as Retencion

FROM MaestroPersonal a
INNER JOIN                      
FechasLegajos ON FechasLegajos.legajo = a.legajo and indicativoantiguedad=1









GO
/****** Object:  StoredProcedure [dbo].[PlanillaHaberes]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO






CREATE              Procedure [dbo].[PlanillaHaberes]
	@idLiquidacion 	int,
	@LegajoDesde	int,
	@LegajoHasta	int
as
Declare @C_String as nvarchar(4000)

Set @C_String=' Select 	A01.*, A02.apellido, A02.nombre, A03.descripcion as DescConcepto,
			A04.Concepto as TipoConcepto, A04.Descripcion as DescTipoConcepto, A04.Multiplicador, A05.Concepto
		from items_liquidaciones A01
			inner join MaestroPersonal A02
				on A02.legajo = A01.legajo
			inner join ConceptosLiquidacion A03
				on A03.concepto = A01.concepto
			inner join TipConcLiq A04
				on A03.tipoconcepto = A04.CONCEPTO

			left join FechasLegajos A05
				on A02.legajo = A05.legajo and A05.concepto = 1

		where A01.idLiquidacion = ' + rtrim(convert(char(10),@idLiquidacion)) -- + 
--		' and isnull(A05.concepto,0) <> 1 '

	/**** Armo las condiciones ****/
	if @LegajoDesde is not null and @LegajoDesde <> 0
		Set @C_String= @C_String + ' and A01.Legajo >= ' + convert(char(10),@LegajoDesde)

	if @LegajoHasta is not null and @LegajoHasta <> 0
		Set @C_String= @C_String + ' and A01.Legajo <= ' + convert(char(10),@LegajoHasta)

	/**** Orden ****/
	Set @C_String= @C_String + ' order by A01.legajo, A01.concepto '

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String





GO
/****** Object:  StoredProcedure [dbo].[PorcentajesSexos]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE   Procedure [dbo].[PorcentajesSexos]
(
	@Fecha	char(8)=20050228
)
as
Select unificador,GrupoReporte,count(*) total,
(select count(*) From dbo.fnPadronaFecha(@Fecha,1,0) p1
inner join socios sc1
on p1.socio=sc1.socio
where sexo=1
and unificador=p.unificador) Hombres,
(select count(*) From dbo.fnPadronaFecha(@Fecha,1,0) p1
inner join socios sc1
on p1.socio=sc1.socio
where sexo=2
and unificador=p.unificador) Mujeres,
(select count(*) From dbo.fnPadronaFecha(@Fecha,1,0) p1
inner join socios sc1
on p1.socio=sc1.socio
where sexo=1 and jubilado<>0
and unificador=p.unificador) HombresJ,
(select count(*) From dbo.fnPadronaFecha(@Fecha,1,0) p1
inner join socios sc1
on p1.socio=sc1.socio
where sexo=2 and jubilado<>0
and unificador=p.unificador) MujeresJ


From dbo.fnPadronaFecha(@Fecha,1,0) p
Group by unificador,GrupoReporte
union
Select 1 unificador,'TOTAL PADRON ELECCION GENERAL' GrupoReporte,count(*) total,
(select count(*) From dbo.fnPadronaFecha(@Fecha,1,0) p1
inner join socios sc1
on p1.socio=sc1.socio
where sexo=1) Hombres,
(select count(*) From dbo.fnPadronaFecha(@Fecha,1,0) p1
inner join socios sc1
on p1.socio=sc1.socio
where sexo=2) Mujeres,0 Hombresj, 0 Mujeresj
From dbo.fnPadronaFecha(@Fecha,1,0) p
--Group by 'TOTAL PADRON'



GO
/****** Object:  StoredProcedure [dbo].[Premio_Asistencia]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[Premio_Asistencia]
(
	@Inicio	char(8),
	@Cierre Char(8)
)
as

	Delete from ConceptosLegajosNovedades
	where concepto=107 and aniomes=@Cierre and periodo=0
	
	insert into Conceptoslegajosnovedades
	Select legajo,98 as orden,107 as concepto,cast((Select round(Importe*15/100,2) from conceptoslegajos
	where legajo=premioasistencia.legajo and concepto=100)as numeric(18,2)) as importe,@Cierre as aniomes, 0 as periodo,
	null as tipo
	from premioAsistencia
	where aniomes>=@Inicio and aniomes<@Cierre
	and 
	(select count(*) from conceptosLegajosnovedades where Aniomes=@Cierre
	and (Concepto=106 or concepto=121) and legajo=PremioAsistencia.legajo)=0
	
	group by legajo
	having sum(Remuneracion)=4



GO
/****** Object:  StoredProcedure [dbo].[Presentaciones]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE      Procedure [dbo].[Presentaciones] --'20050101'
(
	@Desde	char(8)=null,
	@Hasta	char(8)=null
)
as
Declare @tsql nvarchar(4000)

select @tsql='
SELECT 
ho.idOperacion,
dbo.todate(ho.fecha) as Fecha,
ho.observacion,
sum(importe) as importe,
sum(case when tr.idtransaccion is null then 0 else cc.importe end) as rechazos
from 
Header_Operaciones ho
inner join Detalle_Operaciones do
on ho.idOperacion=do.idOperacion
inner join CuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion
left join transaccionesrechazadas tr
on cc.idtransaccion=tr.idtransaccion
 ' 

select @tsql=@tsql + '
where ho.tipodeOperacion=60
and idtipotransaccion=0 
and concepto="DA" 


'

if @Desde is not null
	select @tsql=@tsql + ' and cast(dbo.todate(ho.fecha) as datetime)>="' + @Desde + '"'

if @Hasta is not null
	select @tsql=@tsql + ' and cast(dbo.todate(ho.fecha) as datetime)<="' + @Hasta + '" '

	select @tsql=@tsql + ' Group by ho.idOperacion,ho.fecha,ho.observacion
Order by ho.idOPeracion desc'



EXEC sp_executesql @tsql
-- print @tsql



GO
/****** Object:  StoredProcedure [dbo].[ProcesaCentavos]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[ProcesaCentavos]
as
insert into asientosdiariositems
Select Asiento,9,aniomes,tipoasiento,830116,Debe,haber,'',0 from diferencias
where debe+haber between .01 and .01

Update vencliitems
set alicuota=21
--Select * from vencliitems
where alicuota=0
and aniomes>=dbo.toaniomes(getdate()-90)
and concepto='IVA' and importe<>0

-- Soluciona Bug detectado en ingreso de Movimientos de Stock
UPdate ea
set stock=0
from estadisticaArticulos ea
where tipomovimiento=23 and stock<>0


GO
/****** Object:  StoredProcedure [dbo].[procesaRechazosVisa]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
/*
truncate table import..rechazosVisa 

[procesaRechazosVisa] 202206

*/
CREATE  Procedure [dbo].[procesaRechazosVisa] (
	@aniomes int=202404
) 
as
Drop Table if exists #tempRechazos
Select cast(substring(texto,88,6) as int) socio, cast(substring(texto,94,1) as int) entidad , substring(texto,133,19) Motivo
/* ,substring(texto,130,3),substring(texto,133,19),s.socio,s.apellido,s.nombre,s.email,s.EmailAlt1 */
into  #tempRechazos
from rechazosVisa r
inner join socios s
on substring(texto,88,6)=socio
where substring(texto,130,3)<>'000' and
substring(texto,94,1) = 0 
union 
Select cast(substring(texto,88,6) as int) socio, cast(substring(texto,94,1) as int) entidad, substring(texto,133,19) Motivo
/* ,substring(texto,130,3),substring(texto,133,19),s.adherente,s.apellido,s.nombre,s.email,s.EmailAlt1 */
from rechazosVisa r
inner join Adherentes s
on substring(texto,88,6)=adherente
where substring(texto,130,3)<>'000' and
substring(texto,94,1) = 1

DECLARE @idOperacion 			as int
DECLARE @idtransaccion 			as int
DECLARE @texto					as varchar(50)


/*** Declaro el Cursor de los rechazos ***/
DECLARE rechazos CURSOR FOR
	Select do.idoperacion, p.IdTransaccion,r.Motivo
	from #tempRechazos r
	inner join CuentasCorrientes p 
	on r.socio=p.socio and r.entidad=p.entidad
	inner join Detalle_Operaciones do 
	on p.IdTransaccion=do.idTransaccion
	where DocumentoNumero=@aniomes and Concepto='DA'
	and idTipoTransaccion=0

OPEN rechazos
FETCH NEXT FROM rechazos 
INTO @idOperacion, @idtransaccion,@texto

WHILE @@FETCH_STATUS = 0
BEGIN
	-- (@idTransaccion int, @idOperacion int, @idOperacionOrigen int, @detalle varchar(50))
	exec BaseCrm..RechazoTarjeta @idtransaccion, @idOperacion, @idOperacion, @texto

	FETCH NEXT FROM rechazos 
	INTO @idOperacion, @idtransaccion,@texto
END

CLOSE rechazos
DEALLOCATE rechazos


/*
select sum(importe) 
From ( 
Select cast(cast(substring(texto,70,10) as int) as numeric(18,2))/100 importe, texto 
from RechazosVisa
where substring(texto,130,3)<>'000'
) as a
*/
/*
Select * 
from cuentascorrientes 
order by idtransaccion desc
*/
/*
Select t.*,s.apellido,s.nombre,s.tarjeta,'''' + s.numero,c.importe from #tempRechazos t
inner join socios s
on t.socio=s.socio
inner join cuentascorrientes c
on s.socio=c.socio and t.entidad=c.entidad
where t.entidad=0 and documentoNumero=202403 and concepto='DA'
*/
GO
/****** Object:  StoredProcedure [dbo].[ProcesoRechazosMaster]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Procedure [dbo].[ProcesoRechazosMaster]
(
	@aniomes int=202305
)
as

Drop table if exists #tempRechazos

Select socio,entidad,Motivo,Importe,pre
into #tempRechazos
from (
Select DISTINCT dbo.GetColumnValue(TextoMaster, '|', 1) as Referencia
			,left(dbo.GetColumnValue(TextoMaster, '|', 1),1) as pre
			,right(dbo.GetColumnValue(TextoMaster, '|', 1),1) as entidad
			,len(dbo.GetColumnValue(TextoMaster, '|', 1))-2 as largo			
			,cast(substring(dbo.GetColumnValue(TextoMaster, '|', 1),case when len(dbo.GetColumnValue(TextoMaster, '|', 1))<10 then 1 else 2 end,len(dbo.GetColumnValue(TextoMaster, '|', 1))-
			case when len(dbo.GetColumnValue(TextoMaster, '|', 1))<10 then 1 else 2 end) as int) socio
            ,dbo.GetColumnValue(TextoMaster, '|', 2) as NuevoNumeroTarjeta
            ,dbo.GetColumnValue(TextoMaster, '|', 3) as TarjetaenAMM
            ,dbo.GetColumnValue(TextoMaster, '|', 4) as Frecuencia
            ,dbo.GetColumnValue(TextoMaster, '|', 5) as CtasCobradas
            ,dbo.GetColumnValue(TextoMaster, '|', 6) as CuotasPlan
        	,dbo.GetColumnValue(TextoMaster, '|', 7) as Importe
            ,dbo.GetColumnValue(TextoMaster, '|', 8) as Motivo

FROM [Rechazos_master]
) as a
where Motivo not like 'Observado%'
order by entidad,socio
/*
Select * 
from #tempRechazos t
inner join medicos m 
on t.entidad=m.entidad and t.socio=m.socio
*/

DECLARE @idOperacion 			as int
DECLARE @idtransaccion 			as int
DECLARE @texto					as varchar(50)


/*** Declaro el Cursor de los rechazos ***/
DECLARE rechazos CURSOR FOR
	Select Distinct do.idoperacion, p.IdTransaccion,r.Motivo
	from #tempRechazos r
	inner join CuentasCorrientes p 
	on r.socio=p.socio and r.entidad=p.entidad
	inner join Detalle_Operaciones do 
	on p.IdTransaccion=do.idTransaccion
	where DocumentoNumero=@aniomes and Concepto='DA'
	and idTipoTransaccion=0

OPEN rechazos
FETCH NEXT FROM rechazos 
INTO @idOperacion, @idtransaccion,@texto

WHILE @@FETCH_STATUS = 0
BEGIN
	-- (@idTransaccion int, @idOperacion int, @idOperacionOrigen int, @detalle varchar(50))
	exec RechazoTarjeta @idtransaccion, @idOperacion, @idOperacion, @texto

	FETCH NEXT FROM rechazos 
	INTO @idOperacion, @idtransaccion,@texto
END

CLOSE rechazos
DEALLOCATE rechazos

select sum(cast(importe as numeric(18,2))) 
From #tempRechazos

/* -- SOCIOS -- */
insert into CambiosTarjetaMaster
(socio, entidad,numeroAnterior,numeroNuevo)
Select sc.socio, 0 entidad, sc.numero, NuevoNumeroTarjeta
from 
(
Select DISTINCT dbo.GetColumnValue(TextoMaster, '|', 1) as Referencia
			,left(dbo.GetColumnValue(TextoMaster, '|', 1),1) as pre
			,right(dbo.GetColumnValue(TextoMaster, '|', 1),1) as entidad
			,len(dbo.GetColumnValue(TextoMaster, '|', 1))-2 as largo			
			,cast(substring(dbo.GetColumnValue(TextoMaster, '|', 1),case when len(dbo.GetColumnValue(TextoMaster, '|', 1))<10 then 1 else 2 end,len(dbo.GetColumnValue(TextoMaster, '|', 1))-
			case when len(dbo.GetColumnValue(TextoMaster, '|', 1))<10 then 1 else 2 end) as int) socio
            ,dbo.GetColumnValue(TextoMaster, '|', 2) as NuevoNumeroTarjeta
            ,dbo.GetColumnValue(TextoMaster, '|', 3) as TarjetaenAMM
            ,dbo.GetColumnValue(TextoMaster, '|', 4) as Frecuencia
            ,dbo.GetColumnValue(TextoMaster, '|', 5) as CtasCobradas
            ,dbo.GetColumnValue(TextoMaster, '|', 6) as CuotasPlan
        	,dbo.GetColumnValue(TextoMaster, '|', 7) as Importe
            ,dbo.GetColumnValue(TextoMaster, '|', 8) as Motivo
FROM [Rechazos_master]
) as mr 
left join Socios sc
on mr.socio=sc.socio -- collate SQL_Latin1_General_CP1_CI_AS
where Motivo like 'Observa%' and entidad=0
and tarjeta=2

Update sc
set numero=NuevoNumeroTarjeta
from 
(
Select DISTINCT dbo.GetColumnValue(TextoMaster, '|', 1) as Referencia
			,left(dbo.GetColumnValue(TextoMaster, '|', 1),1) as pre
			,right(dbo.GetColumnValue(TextoMaster, '|', 1),1) as entidad
			,len(dbo.GetColumnValue(TextoMaster, '|', 1))-2 as largo			
			,cast(substring(dbo.GetColumnValue(TextoMaster, '|', 1),case when len(dbo.GetColumnValue(TextoMaster, '|', 1))<10 then 1 else 2 end,len(dbo.GetColumnValue(TextoMaster, '|', 1))-
			case when len(dbo.GetColumnValue(TextoMaster, '|', 1))<10 then 1 else 2 end) as int) socio
            ,dbo.GetColumnValue(TextoMaster, '|', 2) as NuevoNumeroTarjeta
            ,dbo.GetColumnValue(TextoMaster, '|', 3) as TarjetaenAMM
            ,dbo.GetColumnValue(TextoMaster, '|', 4) as Frecuencia
            ,dbo.GetColumnValue(TextoMaster, '|', 5) as CtasCobradas
            ,dbo.GetColumnValue(TextoMaster, '|', 6) as CuotasPlan
        	,dbo.GetColumnValue(TextoMaster, '|', 7) as Importe
            ,dbo.GetColumnValue(TextoMaster, '|', 8) as Motivo
FROM [Rechazos_master]
) as mr 
left join Socios sc
on mr.socio=sc.socio -- collate SQL_Latin1_General_CP1_CI_AS
where Motivo like 'Observa%' and entidad=0
and tarjeta=2

/* -- ADHERENTES -- */
insert into CambiosTarjetaMaster
(socio, entidad,numeroAnterior,numeroNuevo)
Select sc.Adherente, 0 entidad, sc.numero, NuevoNumeroTarjeta
from 
(
Select DISTINCT dbo.GetColumnValue(TextoMaster, '|', 1) as Referencia
			,left(dbo.GetColumnValue(TextoMaster, '|', 1),1) as pre
			,right(dbo.GetColumnValue(TextoMaster, '|', 1),1) as entidad
			,len(dbo.GetColumnValue(TextoMaster, '|', 1))-2 as largo			
			,cast(substring(dbo.GetColumnValue(TextoMaster, '|', 1),case when len(dbo.GetColumnValue(TextoMaster, '|', 1))<10 then 1 else 2 end,len(dbo.GetColumnValue(TextoMaster, '|', 1))-
			case when len(dbo.GetColumnValue(TextoMaster, '|', 1))<10 then 1 else 2 end) as int) socio
            ,dbo.GetColumnValue(TextoMaster, '|', 2) as NuevoNumeroTarjeta
            ,dbo.GetColumnValue(TextoMaster, '|', 3) as TarjetaenAMM
            ,dbo.GetColumnValue(TextoMaster, '|', 4) as Frecuencia
            ,dbo.GetColumnValue(TextoMaster, '|', 5) as CtasCobradas
            ,dbo.GetColumnValue(TextoMaster, '|', 6) as CuotasPlan
        	,dbo.GetColumnValue(TextoMaster, '|', 7) as Importe
            ,dbo.GetColumnValue(TextoMaster, '|', 8) as Motivo
FROM [Rechazos_master]
) as mr 
left join Adherentes sc
on mr.socio=sc.Adherente -- collate SQL_Latin1_General_CP1_CI_AS
where Motivo like 'Observa%' and entidad=1
and tarjeta=2

Update sc
set numero=NuevoNumeroTarjeta
from 
(
Select DISTINCT dbo.GetColumnValue(TextoMaster, '|', 1) as Referencia
			,left(dbo.GetColumnValue(TextoMaster, '|', 1),1) as pre
			,right(dbo.GetColumnValue(TextoMaster, '|', 1),1) as entidad
			,len(dbo.GetColumnValue(TextoMaster, '|', 1))-2 as largo			
			,cast(substring(dbo.GetColumnValue(TextoMaster, '|', 1),case when len(dbo.GetColumnValue(TextoMaster, '|', 1))<10 then 1 else 2 end,len(dbo.GetColumnValue(TextoMaster, '|', 1))-
			case when len(dbo.GetColumnValue(TextoMaster, '|', 1))<10 then 1 else 2 end) as int) socio
            ,dbo.GetColumnValue(TextoMaster, '|', 2) as NuevoNumeroTarjeta
            ,dbo.GetColumnValue(TextoMaster, '|', 3) as TarjetaenAMM
            ,dbo.GetColumnValue(TextoMaster, '|', 4) as Frecuencia
            ,dbo.GetColumnValue(TextoMaster, '|', 5) as CtasCobradas
            ,dbo.GetColumnValue(TextoMaster, '|', 6) as CuotasPlan
        	,dbo.GetColumnValue(TextoMaster, '|', 7) as Importe
            ,dbo.GetColumnValue(TextoMaster, '|', 8) as Motivo
FROM [Rechazos_master]
) as mr 
left join Adherentes sc
on mr.socio=sc.Adherente -- collate SQL_Latin1_General_CP1_CI_AS
where Motivo like 'Observa%' and entidad=1
and tarjeta=2

/* -- ALUMNOS -- */
insert into CambiosTarjetaMaster
(socio, entidad,numeroAnterior,numeroNuevo)
Select sc.idAlumno, 0 entidad, sc.numero, NuevoNumeroTarjeta
from 
(
Select DISTINCT dbo.GetColumnValue(TextoMaster, '|', 1) as Referencia
			,left(dbo.GetColumnValue(TextoMaster, '|', 1),1) as pre
			,right(dbo.GetColumnValue(TextoMaster, '|', 1),1) as entidad
			,len(dbo.GetColumnValue(TextoMaster, '|', 1))-2 as largo			
			,cast(substring(dbo.GetColumnValue(TextoMaster, '|', 1),case when len(dbo.GetColumnValue(TextoMaster, '|', 1))<10 then 1 else 2 end,len(dbo.GetColumnValue(TextoMaster, '|', 1))-
			case when len(dbo.GetColumnValue(TextoMaster, '|', 1))<10 then 1 else 2 end) as int) socio
            ,dbo.GetColumnValue(TextoMaster, '|', 2) as NuevoNumeroTarjeta
            ,dbo.GetColumnValue(TextoMaster, '|', 3) as TarjetaenAMM
            ,dbo.GetColumnValue(TextoMaster, '|', 4) as Frecuencia
            ,dbo.GetColumnValue(TextoMaster, '|', 5) as CtasCobradas
            ,dbo.GetColumnValue(TextoMaster, '|', 6) as CuotasPlan
        	,dbo.GetColumnValue(TextoMaster, '|', 7) as Importe
            ,dbo.GetColumnValue(TextoMaster, '|', 8) as Motivo
FROM [Rechazos_master]
) as mr 
left join Alumnos sc
on mr.socio=sc.idAlumno -- collate SQL_Latin1_General_CP1_CI_AS
where Motivo like 'Observa%' and entidad=2
and tarjeta=2

Update sc
set numero=NuevoNumeroTarjeta
from 
(
Select DISTINCT dbo.GetColumnValue(TextoMaster, '|', 1) as Referencia
			,left(dbo.GetColumnValue(TextoMaster, '|', 1),1) as pre
			,right(dbo.GetColumnValue(TextoMaster, '|', 1),1) as entidad
			,len(dbo.GetColumnValue(TextoMaster, '|', 1))-2 as largo			
			,cast(substring(dbo.GetColumnValue(TextoMaster, '|', 1),case when len(dbo.GetColumnValue(TextoMaster, '|', 1))<10 then 1 else 2 end,len(dbo.GetColumnValue(TextoMaster, '|', 1))-
			case when len(dbo.GetColumnValue(TextoMaster, '|', 1))<10 then 1 else 2 end) as int) socio
            ,dbo.GetColumnValue(TextoMaster, '|', 2) as NuevoNumeroTarjeta
            ,dbo.GetColumnValue(TextoMaster, '|', 3) as TarjetaenAMM
            ,dbo.GetColumnValue(TextoMaster, '|', 4) as Frecuencia
            ,dbo.GetColumnValue(TextoMaster, '|', 5) as CtasCobradas
            ,dbo.GetColumnValue(TextoMaster, '|', 6) as CuotasPlan
        	,dbo.GetColumnValue(TextoMaster, '|', 7) as Importe
            ,dbo.GetColumnValue(TextoMaster, '|', 8) as Motivo
FROM [Rechazos_master]
) as mr 
left join Alumnos sc
on mr.socio=sc.idAlumno -- collate SQL_Latin1_General_CP1_CI_AS
where Motivo like 'Observa%' and entidad=2
and tarjeta=2

GO
/****** Object:  StoredProcedure [dbo].[Proteccion]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE         Procedure [dbo].[Proteccion] -- Proteccion 200604
(
	@aniomes	char(6)
)
as

Select ltrim(rtrim(apellido)) + ', ' + ltrim(rtrim(Nombre)),nroMatricula
from socios
where dbo.Activonoalico (socios.Socio ,0 ,@aniomes)=0
and dbo.Activoal (socios.Socio ,0 ,@aniomes)>0
--and fechaingreso<>'20050118'
order by ltrim(rtrim(apellido)) + ', ' + ltrim(rtrim(Nombre))




GO
/****** Object:  StoredProcedure [dbo].[ramos]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE Procedure [dbo].[ramos]
as
Select Distinct sc.Socio,Apellido,NOmbre from socios sc
inner join grupos_socios gs
on sc.socio=gs.socio
left join ldsp580 ld on sc.cuil=col003 
where fechabaja is null
and reparticion=24022 and 
lugarpago=1000

order by apellido,nombre









GO
/****** Object:  StoredProcedure [dbo].[rankingClientesProveedores]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


CREATE Procedure [dbo].[rankingClientesProveedores]
(
	@Casos	int=10,
	@Desde	varchar(8)='20100701',
	@Hasta	varchar(8)='20110630',
	@CP		varchar(1)='C'
)
as
Declare @SqlStr nvarchar(4000)

if @Casos=0
	select @Casos=999999

if @CP='C'
Set @SqlStr='
Select top ' + cast(@Casos as varchar(max)) + 'vch.cliente,cl.razonSocial,count(*) Casos, sum(totalimporte*signo) Subtotal from clientes cl
inner join vencliheader vch
on cl.codigo=vch.cliente
inner join tipVentModHeader tvm
on vch.tipocomprobante=tvm.codigo

where vch.fecha between "' + @Desde + '" and "' + @Hasta + '"
and ivaVentas="S"
Group by vch.cliente,cl.razonSocial

order by sum(totalimporte*signo) desc'
else
Set @SqlStr='Select top ' + cast(@Casos as varchar(max)) + 'vch.proveedor as cliente,cl.razonSocial,count(*) Casos,sum(totalimporte*signo) Subtotal from proveedores cl
inner join compProvHeader vch
on cl.codigo=vch.proveedor
inner join tipCompModHeader tvm
on vch.tipocomprobante=tvm.codigo

where vch.fecha between "' + @Desde + '" and "' + @Hasta + '"
and ivaCompras="S"
Group by vch.proveedor,cl.razonSocial

order by sum(totalimporte*signo) desc'

exec sp_executesql @SqlStr



GO
/****** Object:  StoredProcedure [dbo].[RechazoTarjeta]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  Procedure [dbo].[RechazoTarjeta](@idTransaccion int, @idOperacion int, 
@idOperacionOrigen int, @detalle varchar(50)) 
as

-- RechazoTarjeta 3050302,32395,0,'Mal Numero de Tarjeta'

/* Select * from CuentasCorrientes 
where entidad=1 and socio=22440 and documentoNumero=200310

Select * from Detalle_operaciones
where idtransaccion=3050302 -- 32395 */

Insert into TransaccionesRechazadas
values
(@idtransaccion,@detalle)

-- Guardo Aplicaciones Anteriores
Insert into aplicacionesCuentasCorrientesAnuladas
Select * from aplicacionesCuentasCorrientes
where idtransaccion=@idtransaccion -- 2634550

-- Repongo valores de Aplicaciones CuentasCorrientes
Update CuentasCorrientes 
set cancelado=isnull((
Select SUM(importe) 
from AplicacionesCuentasCorrientes ac1 
where ac1.idTransaccionCancelada=acc.IdTransaccionCancelada 
and cc.idTransaccion=acc.IdTransaccionCancelada and ac1.idtransaccion<>do.idTransaccion),0) 
from Detalle_Operaciones do
inner Join AplicacionesCuentasCorrientes acc on acc.idtransaccion=do.idtransaccion and do.idtipotransaccion=0
inner join cuentascorrientes cc on cc.idTransaccion=acc.idtransaccionCancelada
where idOPeracion=@idOperacionOrigen
and do.idtransaccion=@idtransaccion

Delete from aplicacionesCuentasCorrientes 
where idtransaccion=@idtransaccion -- 2634550

Declare @trValor int

/* Insert Into ValorestesoreriaPresentaciones
(idTransaccionOrigen,TipoMovimiento,
 idConcepto_Tesoreria,FechaEmision,Vencimiento,Banco,Cuenta,Sucursal,Numero,Firma,
 importe,Cancelado,idoperador,numerointerno,observaciones,idOpCobrador,Corregido)
Select idTransaccionOrigen,TipoMovimiento,
 idConcepto_Tesoreria,FechaEmision,Vencimiento,Banco,Cuenta,Sucursal,Numero,Firma,
 importe,Cancelado,idoperador,numerointerno,observaciones,idOpCobrador,Corregido from ValoresTesoreriaPresentaciones where idtransaccionOrigen=@idtransaccion
Select trValor=@@identity
*/
/*
update valoresTesoreriaPresentaciones
set cancelado=importe where idtransaccion=@idtransaccion
update valoresTesoreriaPresentaciones
set cancelado=importe,tipomovimiento=2 where idtransaccion=@trValor
*/
Declare @trCtaCte int
Insert Into CuentasCorrientes
(socio, Entidad, Fecha, Concepto, 
PuntodeVenta, DocumentoNumero, FechaRendicion, 
Rendicion, importe, Cancelado, vencimiento, Cobrador,
serie,idOpcobrador)
Select socio, Entidad, Fecha, Concepto, 
PuntodeVenta, DocumentoNumero, FechaRendicion, 
Rendicion, importe, Cancelado, vencimiento, Cobrador,
serie,idOpcobrador from CuentasCorrientes where idtransaccion=@idtransaccion
Select @trCtaCte=@@identity

update CuentasCorrientes
set cancelado=importe where idtransaccion=@idtransaccion
update CuentasCorrientes
set cancelado=importe,Concepto='RDA', fecha=getdate() where idtransaccion=@trCtaCte

Declare @Importe numeric(18,2)

Set @Importe=(Select importe from CuentasCorrientes where idtransaccion=@idtransaccion)

Insert into AplicacionesCuentasCorrientes
(idtransaccion,idTransaccionCancelada,importe,item)
values
(@idtransaccion,@trCtaCte,@importe,0)

insert into detalle_operaciones 
(IdOperacion,IdTipoTransaccion,idTransaccion,itemdiario)
values
(@IdOperacion,0,@trCtaCte,0)

/*
insert into detalle_operaciones 
(IdOperacion,IdTipoTransaccion,idTransaccion,itemdiario)
values
(@IdOperacion,5,@trValor,0)
*/

/*
	Declare @asientoRev int
	Declare @Periodo int
	Declare @Table varchar(20)
	Select @Periodo=(Select dbo.toaniomes(getdate()))
	
	select @Table='as_1_'+cast(@Periodo as char(6))
	Execute getNextIdentity @Table, @Value=@asientoRev Output
	
	insert into asientosDiariosHeader
	Select @asientoRev as asiento ,@Periodo as aniomes, ai.tipoasiento as tipoasiento, getdate() as fecha,'Reversion Cobranza Ventanilla' ,ai.centrocosto as centrocosto,null as asientocierre from 
	header_operaciones ho
	inner Join AsientosDiariosHeader ai
	on ai.asiento=asientoDiario and ho.aniomes=ai.aniomes and ai.tipoasiento=isnull(ho.tipoasiento,1)
	where idOperacion=@idOperacionOrigen
	
	insert into asientosDiariosItems
	Select @asientoRev as asiento ,ai.item as item,@Periodo as aniomes, ai.tipoasiento as tipoasiento,ai.cuenta as cuenta ,ai.haber as debe,ai.debe as haber,ai.observacion as obsrevacion ,ai.centrocosto as centrocosto from 
	header_operaciones ho
	inner Join AsientosDiariosItems ai
	on ai.asiento=asientoDiario and ho.aniomes=ai.aniomes and ai.tipoasiento=isnull(ho.tipoasiento,1)
	where idOperacion=@idOperacionOrigen
	
	update Header_operaciones 
	set asientoDiario=@asientoRev, tipoasiento=1,aniomes=@Periodo 
	where IdOperacion=@IdOperacion
*/



GO
/****** Object:  StoredProcedure [dbo].[ReciboAdherentesHeader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO





-- ReciboAdherentesHeader 'S',0,0,1,200602,null

CREATE                              Procedure [dbo].[ReciboAdherentesHeader]

	@Directo		char(1) = 'N', -- Si, No
	@Desde			int,
	@Hasta			int,
	@Cobrador		int,
	@AnioMes		char(6),
	@idOperacion		numeric

AS
Declare @C_String nvarchar(4000)
Declare @boolWhere char(1)

set @boolWhere = 'N'

/********************************************************************/
/*		Consulta para los datos Header de Adherentes	    */
/********************************************************************/

/*
set @C_String = 'Select	A01.idOperacion, A01.Fecha, A01.AnioMes,
			A02.idTransaccion, A03.Importe, A03.DocumentoNumero,
			Upper(dbo.NumLet(A03.Importe)) as DescImporte,
		 	A04.Adherente, 
			dbo.CodigoHospitalVoto(A04.Domicilio_Cobro) as CodHospital,
			rtrim(ltrim(dbo.DescHospitalVoto(A04.Domicilio_Cobro))) as Domicilio_cobro,
			A04.Localidad_Cobro, A04.Apellido, 
		 	A04.Nombre, A04.Telefono, A04.Cobrador, A04.Observa1, A04.Observa2,
			(Select top 1 B01.Especialidad from Especialidades_Adherentes B01 where B01.Adherente = A04.Adherente) as Especialidad,
			(Select top 1 B02.Descripcion from Especialidades_Adherentes B01 inner join Especialidades B02 on B01.especialidad = B02.especialidad
			where B01.Adherente = A04.Adherente) as DescEspecialidad,
			A07.Numero as NumeroRecibo, A07.Cobrador, A07.idTransaccionMes, A01.Serie
		From header_operaciones A01
			inner join detalle_operaciones A02
				on A01.idOperacion = A02.idOperacion
			inner join Recibos A07
				on A02.idTransaccion = A07.idTransaccion
			inner join cuentascorrientes A03
				on A07.idTransaccionMes = A03.idTransaccion
			inner join Adherentes A04
				on A03.socio = A04.Adherente
		where A03.entidad = 1 and a03.cancelado=0 '
*/

set @C_String = 'Select	1 as idOperacion, getdate() as Fecha, A03.DocumentoNumero as AnioMes,
			2 as idTransaccion, A03.Importe, A03.DocumentoNumero,
			Upper(dbo.NumLet(A03.Importe)) as DescImporte,
		 	A04.Adherente,a07.idtransaccionrecibo,
			dbo.CodigoHospitalVoto(A04.Domicilio_Cobro) as CodHospital,
			rtrim(ltrim(dbo.DescHospitalVoto(A04.Domicilio_Cobro))) as Domicilio_cobro,
			A04.Localidad_Cobro, A04.Apellido, 
		 	A04.Nombre, case when len(ltrim(rtrim(A04.Telefono_Cobro)))>0 then a04.telefono_cobro else A04.Telefono end  Telefono, A04.Cobrador, A04.Observa1, A04.Observa2,
			(Select top 1 B01.Especialidad from Especialidades_Adherentes B01 where B01.Adherente = A04.Adherente) as Especialidad,
			(Select top 1 B02.Descripcion from Especialidades_Adherentes B01 inner join Especialidades B02 on B01.especialidad = B02.especialidad
			where B01.Adherente = A04.Adherente) as DescEspecialidad,
			A07.Numero as NumeroRecibo, A07.Cobrador, A07.idTransaccionMes, ("SF" + right(year(A07.Fecha),2)) as Serie
		From Recibos A07
			inner join cuentascorrientes A03
				on A07.idTransaccionMes = A03.idTransaccion
			inner join Adherentes A04
				on A03.socio = A04.Adherente
		where A03.entidad = 1 and (a03.cancelado=0 or (a07.idtransaccionrecibo<>0 and 
(dbo.toaniomes(a07.Fecha)=' + @aniomes + ' or dbo.toaniomes(a07.FechaRemplazo)=' + @aniomes + '))) and a04.fechaBaja is null and isnull(a04.tarjeta,0)=0 '

		/* a07.numero between 17517 and 17520 and idtransaccionrecibo<>0 */ -- Toque Recibo Emitido Definitivo SZ 186

		if @Cobrador is not null and @Cobrador <> 0
			set @C_String =	@C_String + ' and A04.cobrador = ' + convert(char(3),@Cobrador)


-- Compruebo si se filtra por medio de un valor de operacion o por medio de distintos 
-- valores ingresados por pantalla
-- El filtro por un valor de operacion se utiliza en el caso de que el recibo se imprime 
-- directamente, y el otro caso es cuando se dan varias opciones para la impresion.


/*
if @Directo = 'S'
	set @C_String =	@C_String + ' and A01.idOperacion = ' + convert(char(20),@idOperacion)	
else
	begin
		/* Armo condiciones */
*/

		if @Desde is not null and @Desde <> 0
			set @C_String =	@C_String + ' and A04.Adherente >= ' + convert(char(10),@Desde)
		
		if @Hasta is not null and @Hasta <> 0
			set @C_String =	@C_String + ' and A04.Adherente <= ' + convert(char(10),@Hasta)
/*		
		if @Cobrador is not null and @Cobrador <> 0
			set @C_String =	@C_String + ' and A07.cobrador = ' + convert(char(3),@Cobrador)
		
		if len(@AnioMes) > 0
			set @C_String =	@C_String + ' and A01.aniomes = ' + @Aniomes

	end
*/

/*	Orden de la consulta */
	set @C_String =	@C_String + ' order by 	rtrim(ltrim(dbo.DescHospitalVoto(A04.Domicilio_Cobro))), 
											A04.apellido, A04.nombre, A07.Numero'


/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--Print @C_String












GO
/****** Object:  StoredProcedure [dbo].[ReciboAdherentesHeader_ENERO2003]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO






CREATE               Procedure [dbo].[ReciboAdherentesHeader_ENERO2003]

	@Directo		char(1) = 'N', -- Si, No
	@Desde			int,
	@Hasta			int,
	@Cobrador		int,
	@AnioMes		char(6),
	@idOperacion		numeric

AS
Declare @C_String nvarchar(4000)
Declare @boolWhere char(1)

set @boolWhere = 'N'

/********************************************************************/
/*		Consulta para los datos Header de Adherentes				*/
/********************************************************************/

set @C_String = 'Select	A01.idOperacion, A01.Fecha, A01.AnioMes,
			A02.idTransaccion, A03.Importe, A03.DocumentoNumero,
			Upper(dbo.NumLet(A03.Importe)) as DescImporte,
		 	A04.Adherente, 
			dbo.CodigoHospitalVoto(A04.Domicilio_Cobro) as CodHospital,
			rtrim(ltrim(dbo.DescHospitalVoto(A04.Domicilio_Cobro))) as Domicilio_cobro,
			A04.Localidad_Cobro, A04.Apellido, 
		 	A04.Nombre, A04.Telefono, A04.Cobrador, A04.Observa1, A04.Observa2,
			(Select top 1 B01.Especialidad from Especialidades_Adherentes B01 where B01.Adherente = A04.Adherente) as Especialidad,
			(Select top 1 B02.Descripcion from Especialidades_Adherentes B01 inner join Especialidades B02 on B01.especialidad = B02.especialidad
			where B01.Adherente = A04.Adherente) as DescEspecialidad,
			A07.Numero as NumeroRecibo, A07.Cobrador, A07.idTransaccionMes, A01.Serie
		From header_operaciones A01
			inner join detalle_operaciones A02
				on A01.idOperacion = A02.idOperacion
			inner join Recibos A07
				on A02.idTransaccion = A07.idTransaccion
			inner join cuentascorrientes A03
				on A07.idTransaccionMes = A03.idTransaccion
			inner join Adherentes A04
				on A03.socio = A04.Adherente
		where A03.entidad = 1 and a03.cancelado=0 and a04.fechaBaja is null '


/*
****************	NO VA MAS **************

set @C_String = 'Select	1 as idOperacion, getdate() as Fecha, A03.DocumentoNumero as AnioMes,
			2 as idTransaccion, A03.Importe, A03.DocumentoNumero,
			Upper(dbo.NumLet(A03.Importe)) as DescImporte,
		 	A04.Adherente, 
			dbo.CodigoHospitalVoto(A04.Domicilio_Cobro) as CodHospital,
			rtrim(ltrim(dbo.DescHospitalVoto(A04.Domicilio_Cobro))) as Domicilio_cobro,
			A04.Localidad_Cobro, A04.Apellido, 
		 	A04.Nombre, A04.Telefono, A04.Cobrador, A04.Observa1, A04.Observa2,
			(Select top 1 B01.Especialidad from Especialidades_Adherentes B01 where B01.Adherente = A04.Adherente) as Especialidad,
			(Select top 1 B02.Descripcion from Especialidades_Adherentes B01 inner join Especialidades B02 on B01.especialidad = B02.especialidad
			where B01.Adherente = A04.Adherente) as DescEspecialidad,
			A07.Numero as NumeroRecibo, A07.Cobrador, A07.idTransaccionMes, "SF02" as Serie
		From Recibos A07
			inner join cuentascorrientes A03
				on A07.idTransaccionMes = A03.idTransaccion
			inner join Adherentes A04
				on A03.socio = A04.Adherente
		where A03.entidad = 1 and a03.cancelado=0 and a04.fechaBaja is null '

		if @Cobrador is not null and @Cobrador <> 0
			set @C_String =	@C_String + ' and A07.cobrador = ' + convert(char(3),@Cobrador)

*/

-- Compruebo si se filtra por medio de un valor de operacion o por medio de distintos 
-- valores ingresados por pantalla
-- El filtro por un valor de operacion se utiliza en el caso de que el recibo se imprime 
-- directamente, y el otro caso es cuando se dan varias opciones para la impresion.



if @Directo = 'S'
	set @C_String =	@C_String + ' and A01.idOperacion = ' + convert(char(20),@idOperacion)	
else
	begin
		/* Armo condiciones */

		if @Desde is not null and @Desde <> 0
			set @C_String =	@C_String + ' and A04.Adherente >= ' + convert(char(10),@Desde)
		
		if @Hasta is not null and @Hasta <> 0
			set @C_String =	@C_String + ' and A04.Adherente <= ' + convert(char(10),@Hasta)
		
		if @Cobrador is not null and @Cobrador <> 0
			set @C_String =	@C_String + ' and A07.cobrador = ' + convert(char(3),@Cobrador)
		
		if len(@AnioMes) > 0
			set @C_String =	@C_String + ' and A01.aniomes = ' + @Aniomes

	end


/*	Orden de la consulta */
	set @C_String =	@C_String + ' order by 	rtrim(ltrim(dbo.DescHospitalVoto(A04.Domicilio_Cobro))), 
											A04.apellido, A04.nombre, A07.Numero'


/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--Print @C_String







GO
/****** Object:  StoredProcedure [dbo].[ReciboClienteHeader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


--ReciboClienteHeader 37208,1


CREATE           Procedure [dbo].[ReciboClienteHeader]

	@Operacion	int = Null,
	@Usuario	int
AS
Declare @C_String nvarchar(4000)

/********************************************************************************/
/*			Consulta para los datos Header 				*/
/********************************************************************************/

set @C_String = 'Select	A04.Codigo as NumeroProveedor, A04.RazonSocial,
			A03.nrocomprobante as NumeroOP, A03.fecha, A03.totalimporte,
			A01.idOperacion, A05.uName as Usuario, A03.DescripcionImporte,
			A01.ObservacionComprobante,NombreEmpresa,a04.domicilio,a04.localidad,a04.telefono1 telefono,a04.mail, 
			a04.cuit
		From Header_Operaciones A01
			inner join Detalle_Operaciones A02
				on A01.idOperacion = A02.idOperacion and A02.idTipotransaccion = 0
			inner join vencliHeader A03 
				on A02.idTransaccion = A03.idTransaccion and A03.TipoComprobante = 0
			inner join Clientes A04
				on A03.Cliente = A04.codigo 
			Left join ParametrosGeneralesSueldos p
				on p.nombreEmpresa=p.nombreEmpresa
			left join Usuarios_Tesoreria A05
				on A05.idUsuario = ' + convert(char(10),@Usuario) + '
		Where A01.TipodeOperacion = 10 '

if @Operacion is not null and @Operacion <> 0
	set @C_String =	@C_String + ' and A01.idOperacion = ' + convert(char(10),@Operacion)

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String







GO
/****** Object:  StoredProcedure [dbo].[ReciboClienteItems]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO

--Select * from CompProvItems

-- exec Basecrm.dbo.ReciboClienteItems 36797

CREATE                Procedure [dbo].[ReciboClienteItems]

	@Operacion	int
AS
Declare @C_String nvarchar(4000)

/********************************************************************************/
/*			Consulta para los datos Items 				*/
/********************************************************************************/

set @C_String = 'Select A05.tipofactura, A05.nrocomprobante, A05.fecha as Emision, (a04.importeOrigen)*Multiplicador as ImporteOrigen,
			a04.importe*Multiplicador as Importe, A01.idOperacion, 
			0 Cuenta, "" Desc_Cuenta,"" Detalle /*a06.Detalle as detalle*/,
		(Select Sum(vt.importe)
from Detalle_operaciones do 
inner join ValoresTesoreria vt
on do.idtransaccion=vt.idtransaccion
where idOperacion=' + cast(@Operacion as char(6)) + ' and idtipotransaccion=2) Pago
		From Header_Operaciones A01
			inner join Detalle_Operaciones A02
				on A01.idOperacion = A02.idOperacion 
			inner join vencliheader A03 
				on A02.idTransaccion = A03.idTransaccion and A03.TipoComprobante = 0
			inner join aplicacionesCuentasacobrar A04
				on A03.idTransaccion = A04.idTransaccion
			inner join vencliheader A05
				on A04.idTransaccionCancelada = A05.idTransaccion 
			left join tipventModHeader tcm
				on a05.tipoComprobante=tcm.codigo
'



if @Operacion is not null and @Operacion <> 0
	set @C_String =	@C_String + ' where signo=1 and A04.Importe<>0 and A01.idOperacion = ' + convert(char(10),@Operacion)

set @C_String = @C_String +' union Select tcm.comprobante tipofactura, 
			A05.nrocomprobante, A05.fecha as Emision, (a04.importeOrigen)*Multiplicador as ImporteOrigen,
			(a04.importe)*Multiplicador as Importe, A01.idOperacion, 
			0 as Cuenta, "Aplicacion OP" as Desc_Cuenta,"" Detalle ,/*	a06.Detalle as detalle ,*/
		(Select Sum(vt.importe)
from Detalle_operaciones do 
inner join ValoresTesoreria vt
on do.idtransaccion=vt.idtransaccion
where idOperacion=' + cast(@Operacion as char(6)) + ' and idtipotransaccion=2) Pago
		From Header_Operaciones A01
			inner join Detalle_Operaciones A02
				on A01.idOperacion = A02.idOperacion 
			inner join vencliheader A03 
				on A02.idTransaccion = A03.idTransaccion and A03.TipoComprobante = 0
			inner join aplicacionesCuentasacobrar A04
				on A03.idTransaccion = A04.idTransaccion
			inner join vencliheader A05
				on A04.idTransaccionCancelada = A05.idTransaccion 
			left join vencliItems A06
				on A06.comprobante = A05.comprobante and A06.aniomes = A05.aniomes
			left join Cuentas A07
				on A06.cuenta = A07.cuenta
			left join tipventModHeader tcm
				on a05.tipoComprobante=tcm.codigo
'
if @Operacion is not null and @Operacion <> 0
	set @C_String =	@C_String + ' where signo=2 and A01.idOperacion = ' + convert(char(10),@Operacion)

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--Print @c_string


GO
/****** Object:  StoredProcedure [dbo].[ReciboClienteValores]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


/* Este Procedimiento se utiliza tanto para las ordenes de Pago, como para las Ordenes de Pago Varias */

-- ReciboClienteValores 36796

Create         Procedure [dbo].[ReciboClienteValores]

	@Operacion	int
AS

Declare @C_String nvarchar(4000)

/******************************************************************************************/
/*		Consulta para los datos de pagos				*/
/******************************************************************************************/

set @C_String = 'Select	a03.fechaemision as fechaEmision,A04.Descripcion, A03.importe, A01.idOperacion, A03.Cuenta, 
			A03.Sucursal, A03.Numero, A05.descripcion as Banco, A04.modalidad,
			A03.Observaciones,  a03.base,
			a03.tipocambio
		From Header_Operaciones A01
			inner join Detalle_Operaciones A02
				on A01.idOperacion = A02.idOperacion and A02.idTipotransaccion = 2
			inner join valoresTesoreria A03
				on A02.idTransaccion = A03.idTransaccion
			inner join Conceptos_Tesoreria A04
				on A03.idConcepto_Tesoreria = A04.idConcepto_Tesoreria 
			left join bancos A05
				on A03.banco = A05.banco '

if @Operacion is not null and @Operacion <> 0
	set @C_String =	@C_String + ' where tipomovimiento=1 and A01.idOperacion = ' + convert(char(10),@Operacion)

	set @C_String =	@C_String + ' Order by A04.Descripcion DESC '

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String






GO
/****** Object:  StoredProcedure [dbo].[ReciboDebitos_Conceptos]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE          procedure [dbo].[ReciboDebitos_Conceptos]
-- ReciboDebitos_Conceptos 22791,1,200306,200306
@Socio int,
@Entidad int, 
@PeriodoInicio int,
@PeriodoCierre int

as

-- Consulta Listado Rendicion

Select dcc.Concepto,cn.descripcion,cc.documentoNumero,dcc.importe
from Header_Operaciones ho

inner Join Detalle_operaciones do
on do.idOperacion=ho.idOperacion

Inner Join CuentasCorrientes cc0
on cc0.idtransaccion=do.idtransaccion


Inner Join AplicacionesCuentasCorrientes acc
on acc.idtransaccion=cc0.idtransaccion

Inner Join CuentasCorrientes cc
on cc.idtransaccion=acc.idtransaccionCancelada

Inner Join DetalleCuentasCorrientes dcc
on dcc.idtransaccion=cc.idtransaccion

inner Join Conceptos cn
on dcc.Concepto=cn.concepto

where (TipoDeOperacion=120 or TipoDeOperacion=60) and do.idtipotransaccion=0
and cc.socio=@Socio and cc.entidad=@Entidad
and (cc.documentoNumero>=@PeriodoInicio and cc.documentoNumero<=@PeriodoCierre)

order by cc.DocumentoNumero




GO
/****** Object:  StoredProcedure [dbo].[ReciboRendicion_Conceptos]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE        procedure [dbo].[ReciboRendicion_Conceptos]

@idOperacion int

as

-- Consulta Listado Rendicion

Select count(dtcc.concepto) as cantidad, dtcc.concepto, cn.Descripcion, cc.documentonumero, sum(dtcc.importe) as Importe,


isnull(((Select vt.importe 
From Detalle_Operaciones dcc
inner join Header_Operaciones ho1 on dcc.idOperacion=ho1.idOperacion
inner join ValoresTesoreria vt on dcc.idtransaccion=vt.idtransaccion and dcc.idTipoTransaccion=2
inner join Conceptos_Tesoreria ct on ct.idConcepto_Tesoreria = vt.idConcepto_Tesoreria and ct.idConcepto_Tesoreria = 10
where ho.idOperacion=ho1.idOperacion) * -1),0) as Bonificacion,

isnull(((Select vt.importe 
From Detalle_Operaciones dcc
inner join Header_Operaciones ho1 on dcc.idOperacion=ho1.idOperacion
inner join ValoresTesoreria vt on dcc.idtransaccion=vt.idtransaccion and dcc.idTipoTransaccion=2
inner join Conceptos_Tesoreria ct on ct.idConcepto_Tesoreria = vt.idConcepto_Tesoreria and ct.idConcepto_Tesoreria = 18
where ho.idOperacion=ho1.idOperacion) * -1),0) as Honorarios,

isnull(((Select vt.importe 
From Detalle_Operaciones dcc
inner join Header_Operaciones ho1 on dcc.idOperacion=ho1.idOperacion
inner join ValoresTesoreria vt on dcc.idtransaccion=vt.idtransaccion and dcc.idTipoTransaccion=2
inner join Conceptos_Tesoreria ct on ct.idConcepto_Tesoreria = vt.idConcepto_Tesoreria and ct.idConcepto_Tesoreria = 12
where ho.idOperacion=ho1.idOperacion) * -1),0) as Saldo

From Detalle_Operaciones dcc
inner join Header_Operaciones ho 
	on dcc.idOperacion=ho.idOperacion 
inner join aplicacionesCuentasCorrientes acc 
	on dcc.idtransaccion=acc.idtransaccion 
inner join CuentasCorrientes cc 
	on cc.idtransaccion=acc.idtransaccionCancelada 
Inner Join DetalleCuentasCorrientes dtcc
	on dtcc.idtransaccion=cc.idtransaccion
inner join Adherentes ad
	on cc.socio=ad.adherente
inner join Conceptos cn
	on cn.concepto=dtcc.concepto
where dcc.idtipotransaccion = 0
and ho.idOperacion= @idOperacion

group by ho.idoperacion, dtcc.concepto, cn.Descripcion, cc.documentonumero

order by dtcc.concepto, cc.documentonumero









GO
/****** Object:  StoredProcedure [dbo].[ReciboRendicion_Header]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE         procedure [dbo].[ReciboRendicion_Header]

@idOperacion int

as

-- Consulta Listado Rendicion
(
Select 1 item,'Original' as Copia,ho.idoperacion, 
upper(dbo.Numlet(sum(dtcc.importe) + 
isnull(((Select vt.importe 
From Detalle_Operaciones dcc
inner join Header_Operaciones ho1 on dcc.idOperacion=ho1.idOperacion
inner join ValoresTesoreria vt on dcc.idtransaccion=vt.idtransaccion and dcc.idTipoTransaccion=2
inner join Conceptos_Tesoreria ct on ct.idConcepto_Tesoreria = vt.idConcepto_Tesoreria and ct.idConcepto_Tesoreria = 10
where ho.idOperacion=ho1.idOperacion) * -1),0)
+
isnull(((Select vt.importe 
From Detalle_Operaciones dcc
inner join Header_Operaciones ho1 on dcc.idOperacion=ho1.idOperacion
inner join ValoresTesoreria vt on dcc.idtransaccion=vt.idtransaccion and dcc.idTipoTransaccion=2
inner join Conceptos_Tesoreria ct on ct.idConcepto_Tesoreria = vt.idConcepto_Tesoreria and ct.idConcepto_Tesoreria = 12
where ho.idOperacion=ho1.idOperacion) * -1),0)
)
) as DescImporte,
ho.fecha
From Detalle_Operaciones dcc
inner join Header_Operaciones ho 
	on dcc.idOperacion=ho.idOperacion 
inner join aplicacionesCuentasCorrientes acc 
	on dcc.idtransaccion=acc.idtransaccion 
inner join CuentasCorrientes cc 
	on cc.idtransaccion=acc.idtransaccionCancelada 
Inner Join DetalleCuentasCorrientes dtcc
	on dtcc.idtransaccion=cc.idtransaccion
inner join Adherentes ad
	on cc.socio=ad.adherente
inner join Conceptos cn
	on cn.concepto=dtcc.concepto
where dcc.idtipotransaccion = 0
and ho.idOperacion= @idOperacion
group by ho.idoperacion,ho.fecha
)
union
(
Select 2 item,'Duplicado' as Copia,ho.idoperacion, 
upper(dbo.Numlet(sum(dtcc.importe) + 
isnull(((Select vt.importe 
From Detalle_Operaciones dcc
inner join Header_Operaciones ho1 on dcc.idOperacion=ho1.idOperacion
inner join ValoresTesoreria vt on dcc.idtransaccion=vt.idtransaccion and dcc.idTipoTransaccion=2
inner join Conceptos_Tesoreria ct on ct.idConcepto_Tesoreria = vt.idConcepto_Tesoreria and ct.idConcepto_Tesoreria = 10
where ho.idOperacion=ho1.idOperacion) * -1),0)
+
isnull(((Select vt.importe 
From Detalle_Operaciones dcc
inner join Header_Operaciones ho1 on dcc.idOperacion=ho1.idOperacion
inner join ValoresTesoreria vt on dcc.idtransaccion=vt.idtransaccion and dcc.idTipoTransaccion=2
inner join Conceptos_Tesoreria ct on ct.idConcepto_Tesoreria = vt.idConcepto_Tesoreria and ct.idConcepto_Tesoreria = 12
where ho.idOperacion=ho1.idOperacion) * -1),0)
)
) as DescImporte,
ho.fecha
From Detalle_Operaciones dcc
inner join Header_Operaciones ho 
	on dcc.idOperacion=ho.idOperacion 
inner join aplicacionesCuentasCorrientes acc 
	on dcc.idtransaccion=acc.idtransaccion 
inner join CuentasCorrientes cc 
	on cc.idtransaccion=acc.idtransaccionCancelada 
Inner Join DetalleCuentasCorrientes dtcc
	on dtcc.idtransaccion=cc.idtransaccion
inner join Adherentes ad
	on cc.socio=ad.adherente
inner join Conceptos cn
	on cn.concepto=dtcc.concepto
where dcc.idtipotransaccion = 0
and ho.idOperacion= @idOperacion
group by ho.idoperacion,ho.fecha
)
Union
(
Select 3 item,' Triplicado' as Copia,ho.idoperacion, 
upper(dbo.Numlet(sum(dtcc.importe) + 
isnull(((Select vt.importe 
From Detalle_Operaciones dcc
inner join Header_Operaciones ho1 on dcc.idOperacion=ho1.idOperacion
inner join ValoresTesoreria vt on dcc.idtransaccion=vt.idtransaccion and dcc.idTipoTransaccion=2
inner join Conceptos_Tesoreria ct on ct.idConcepto_Tesoreria = vt.idConcepto_Tesoreria and ct.idConcepto_Tesoreria = 10
where ho.idOperacion=ho1.idOperacion) * -1),0)
+
isnull(((Select vt.importe 
From Detalle_Operaciones dcc
inner join Header_Operaciones ho1 on dcc.idOperacion=ho1.idOperacion
inner join ValoresTesoreria vt on dcc.idtransaccion=vt.idtransaccion and dcc.idTipoTransaccion=2
inner join Conceptos_Tesoreria ct on ct.idConcepto_Tesoreria = vt.idConcepto_Tesoreria and ct.idConcepto_Tesoreria = 12
where ho.idOperacion=ho1.idOperacion) * -1),0)
)
) as DescImporte,
ho.fecha
From Detalle_Operaciones dcc
inner join Header_Operaciones ho 
	on dcc.idOperacion=ho.idOperacion 
inner join aplicacionesCuentasCorrientes acc 
	on dcc.idtransaccion=acc.idtransaccion 
inner join CuentasCorrientes cc 
	on cc.idtransaccion=acc.idtransaccionCancelada 
Inner Join DetalleCuentasCorrientes dtcc
	on dtcc.idtransaccion=cc.idtransaccion
inner join Adherentes ad
	on cc.socio=ad.adherente
inner join Conceptos cn
	on cn.concepto=dtcc.concepto
where dcc.idtipotransaccion = 0
and ho.idOperacion= @idOperacion
group by ho.idoperacion,ho.fecha
)










GO
/****** Object:  StoredProcedure [dbo].[ReciboRendicion_Valores]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO






CREATE      procedure [dbo].[ReciboRendicion_Valores]

@idOperacion int

as

Select vt.importe as ImportePago, 
vt.Cuenta, vt.Sucursal, vt.Numero, vt.FechaEmision as FechaCheque, vt.idConcepto_Tesoreria,
ct.Descripcion as DescPago, ct.Modalidad, bco.Descripcion as DescBanco, 1 as CantRegistro
From Detalle_Operaciones dcc
inner join Header_Operaciones ho 
	on dcc.idOperacion=ho.idOperacion
inner join ValoresTesoreria vt on dcc.idtransaccion=vt.idtransaccion and dcc.idTipoTransaccion=2
inner join Conceptos_Tesoreria ct on ct.idConcepto_Tesoreria = vt.idConcepto_Tesoreria and ct.idConcepto_Tesoreria <> 10 and ct.idConcepto_Tesoreria <> 12 and ct.idConcepto_Tesoreria <> 18
left join Bancos bco on vt.Banco = bco.Banco 
where ho.idOperacion=@idOperacion






GO
/****** Object:  StoredProcedure [dbo].[Recibos_Debitos_Header]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO





Create    procedure [dbo].[Recibos_Debitos_Header]

@PeriodoInicio int,
@PeriodoCierre int,
@SocioDesde int,
@SocioHasta int

as

Declare @sqlString as varchar(4000)

Select cc.socio,cc.entidad,dbo.numlet(Sum(cc.importe)) as DescImporte,(ltrim(rtrim(sc.Apellido)) + ', ' + ltrim(rtrim(sc.Nombre))) as nyap
from Header_Operaciones ho

inner Join Detalle_operaciones do
on do.idOperacion=ho.idOperacion

Inner Join AplicacionesCuentasCorrientes acc
on acc.idtransaccion=do.idtransaccion

Inner Join CuentasCorrientes cc
on cc.idtransaccion=acc.idtransaccionCancelada

Inner Join Socios sc
on sc.socio=cc.socio 
where (TipoDeOperacion=120 or TipoDeOperacion=60) and do.idtipotransaccion=0 and cc.entidad=0

and (cc.DocumentoNumero>=@PeriodoInicio and cc.documentoNumero<=@PeriodoCierre) 
and (cc.socio>=@SocioDesde and cc.Socio<=@SocioHasta)

Group by cc.socio,cc.entidad,sc.apellido,sc.nombre

Union

Select cc.socio,cc.entidad,dbo.numlet(Sum(cc.importe)) as DescImporte,(ltrim(rtrim(sc.Apellido)) + ', ' + ltrim(rtrim(sc.Nombre))) as nyap
from Header_Operaciones ho

inner Join Detalle_operaciones do
on do.idOperacion=ho.idOperacion

Inner Join AplicacionesCuentasCorrientes acc
on acc.idtransaccion=do.idtransaccion

Inner Join CuentasCorrientes cc
on cc.idtransaccion=acc.idtransaccionCancelada

Inner Join Adherentes sc
on sc.Adherente=cc.socio 
where (TipoDeOperacion=120 or TipoDeOperacion=60) and do.idtipotransaccion=0 and cc.entidad=1

and (cc.DocumentoNumero>=@PeriodoInicio and cc.documentoNumero<=@PeriodoCierre) 
and (cc.socio>=@SocioDesde and cc.Socio<=@SocioHasta)

Group by cc.socio,cc.entidad,sc.apellido,sc.nombre





GO
/****** Object:  StoredProcedure [dbo].[RecibosMes]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


-- RecibosMesProvisorios 1,1

CREATE  Procedure [dbo].[RecibosMes](@cobrador int, @Entidad int)
as

if @Entidad = 1 
	(
	Select
	*,rtrim(ltrim(dbo.DescHospitalVoto(ad.Domicilio_Cobro))),
	0 idtransaccionRecibo
	from CuentasCorrientes cc
	inner join adherentes ad on cc.socio=ad.adherente
	Where 
	Concepto = 'MES' 
	and entidad=1 
	and Importe <> isNull(Cancelado,0) 
	and ad.fechabaja is null
	and ad.cobrador=@Cobrador 
	and isnull(ad.tarjeta,0)=0
	and (Select Count(*) from recibos where idTransaccionMes=cc.idtransaccion )=0
	)
	union
	(
	Select cct.*,ad.*,rtrim(ltrim(dbo.DescHospitalVoto(ad.Domicilio_Cobro))),
	cc.idtransaccion idtransaccionRecibo
	from Header_Operaciones ho
	inner join detalle_operaciones do
	on ho.idoperacion=do.idOperacion
	inner join aplicacionesCuentasCorrientes cc
	on do.idtransaccion=cc.idtransaccion
	inner join CuentasCorrientes cct
	on cc.idtransaccionCancelada=cct.idtransaccion
	inner join adherentes ad
	on ad.adherente=cct.socio
	left join recibos rc
	on rc.idtransaccionMes=cc.idtransaccionCancelada
	where tipodeOperacion=19
	and comprobantenumero>343
	and idtipotransaccion=0
	and rc.idtransaccion is null
	and ad.fechabaja is null
	and ad.cobrador=@Cobrador 
	and cct.entidad=1
	and dbo.saldoCta(@Entidad,ad.adherente)>0
	)

	order by rtrim(ltrim(dbo.DescHospitalVoto(ad.Domicilio_Cobro))), ad.apellido, ad.nombre 
else
	(
	Select *,0 idtransaccionRecibo from CuentasCorrientes cc
	inner join Socios sc on cc.socio=sc.Socio
	Where 
	Concepto = 'MES' 
	and cc.entidad=0
	and cc.Importe <> isNull(cc.Cancelado,0) 
	and sc.fechabaja is null
	and sc.cobrador=@Cobrador 
	and isnull(sc.tarjeta,0)=0
	and (Select Count(*) from recibos where idTransaccionMes=cc.idtransaccion )=0
	)
	union
	(
	Select cct.*,sc.*,cc.idtransaccion idtransaccionRecibo from Header_Operaciones ho
	inner join detalle_operaciones do
	on ho.idoperacion=do.idOperacion
	inner join aplicacionesCuentasCorrientes cc
	on do.idtransaccion=cc.idtransaccion
	inner join CuentasCorrientes cct
	on cc.idtransaccionCancelada=cct.idtransaccion
	inner join socios sc
	on sc.socio=cct.socio
	left join recibos rc
	on rc.idtransaccionMes=cc.idtransaccionCancelada
	where tipodeOperacion=19
	and comprobantenumero>343
	and idtipotransaccion=0
	and rc.idtransaccion is null
	and sc.fechabaja is null
	and sc.cobrador=@Cobrador 
	and cct.entidad=0
	and dbo.saldoCta(@Entidad,sc.socio)>0
	)

	order by sc.apellido, sc.nombre





GO
/****** Object:  StoredProcedure [dbo].[RecibosMesProvisorios]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO





-- RecibosMesProvisorios 1,1

CREATE     Procedure [dbo].[RecibosMesProvisorios](@cobrador int, @Entidad int)
as

if @Entidad = 1 
	(
	Select
	*,rtrim(ltrim(dbo.DescHospitalVoto(ad.Domicilio_Cobro))),
	0 idtransaccionRecibo
	from CuentasCorrientes cc
	inner join adherentes ad on cc.socio=ad.adherente
	Where 
	Concepto = 'MES' 
	and entidad=1 
	and Importe <> isNull(Cancelado,0) 
	and ad.fechabaja is null
	and ad.cobrador=@Cobrador 
--	and ad.adherente=9848
	and isnull(ad.tarjeta,0)=0
	and (Select Count(*) from recibos where idTransaccionMes=cc.idtransaccion )=0
	)
	union
	(
	Select cct.*,ad.*,rtrim(ltrim(dbo.DescHospitalVoto(ad.Domicilio_Cobro))),
	cc.idtransaccion idtransaccionRecibo
	from Header_Operaciones ho
	inner join detalle_operaciones do
	on ho.idoperacion=do.idOperacion
	inner join aplicacionesCuentasCorrientes cc
	on do.idtransaccion=cc.idtransaccion
	inner join CuentasCorrientes cct
	on cc.idtransaccionCancelada=cct.idtransaccion
	inner join adherentes ad
	on ad.adherente=cct.socio
	left join recibos rc
	on rc.idtransaccionMes=cc.idtransaccionCancelada
	where (tipodeOperacion=19 and comprobantenumero>343)
	and idtipotransaccion=0
	and rc.idtransaccion is null
	and ad.fechabaja is null
	and ad.cobrador=@Cobrador 
	and cct.entidad=1
	and dbo.saldoCta(@Entidad,ad.adherente)>0
--	and ad.adherente=9848
	)

	order by rtrim(ltrim(dbo.DescHospitalVoto(ad.Domicilio_Cobro))), ad.apellido, ad.nombre 
else
	(
	Select *,0 idtransaccionRecibo from CuentasCorrientes cc
	inner join Socios sc on cc.socio=sc.Socio
	Where 
	Concepto = 'MES' 
	and cc.entidad=0
	and cc.Importe <> isNull(cc.Cancelado,0) 
	and sc.fechabaja is null
	and sc.cobrador=@Cobrador 
	and isnull(sc.tarjeta,0)=0
	and (Select Count(*) from recibos where idTransaccionMes=cc.idtransaccion )=0
--	and sc.socio=9848
	)
	union
	(
	Select cct.*,sc.*,cc.idtransaccion idtransaccionRecibo from Header_Operaciones ho
	inner join detalle_operaciones do
	on ho.idoperacion=do.idOperacion
	inner join aplicacionesCuentasCorrientes cc
	on do.idtransaccion=cc.idtransaccion
	inner join CuentasCorrientes cct
	on cc.idtransaccionCancelada=cct.idtransaccion
	inner join socios sc
	on sc.socio=cct.socio
	left join recibos rc
	on rc.idtransaccionMes=cc.idtransaccionCancelada
	where tipodeOperacion=19
	and comprobantenumero>343
	and idtipotransaccion=0
	and rc.idtransaccion is null
	and sc.fechabaja is null
	and sc.cobrador=@Cobrador 
	and cct.entidad=0
	and dbo.saldoCta(@Entidad,sc.socio)>0
--	and sc.socio=9848
	)

	order by sc.apellido, sc.nombre








GO
/****** Object:  StoredProcedure [dbo].[ReciboSociosHeader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO



--ReciboSociosHeader default,default,default,default,200405,null

CREATE                           Procedure [dbo].[ReciboSociosHeader]

	@Directo		char(1) = 'N', -- Si, No
	@Desde			int = Null,
	@Hasta			int = Null,
	@Cobrador		int = Null,
	@AnioMes		char(6),
	@idOperacion	numeric

AS
Declare @C_String nvarchar(4000)
Declare @boolWhere char(1)

set @boolWhere = 'N'

/********************************************************************************/
/*		Consulta para los datos Header de Socios								*/
/********************************************************************************/

set @C_String = 'Select	1 as idOperacion, getdate() as Fecha, A03.DocumentoNumero as AnioMes,
			2 as idTransaccion, A03.Importe, 
			Upper(dbo.NumLet(A03.Importe)) as DescImporte,
		 	A04.Socio, A04.Apellido, A04.Nombre, A04.Domicilio, ltrim(rtrim(A04.domicilio_cobro)) as DomicilioCobro, ltrim(rtrim(A04.localidad_cobro)) as LocalidadCobro, A04.Localidad, A04.Telefono, A04.Observa1, 

			(Select top 1 B01.Especialidad from Especialidades_Socios B01 where B01.Socio = A04.Socio) as Especialidad,
			(Select top 1 B02.Descripcion from Especialidades_Socios B01 inner join Especialidades B02 on B01.especialidad = B02.especialidad
			where B01.Socio = A04.Socio) as DescEspecialidad,
			A07.Numero as NumeroRecibo, A04.Cobrador, ("SC" + right(year(A07.Fecha),2))  as Serie, 
			A07.idTransaccionMes,a07.idtransaccionrecibo

		From Recibos A07
			inner join cuentascorrientes A03
				on A07.idTransaccionMes = A03.idTransaccion
			inner join Socios A04
				on A03.socio = A04.Socio
		where A03.entidad = 0 and (a03.cancelado=0 or (a07.idtransaccionrecibo<>0 and dbo.toaniomes(a07.Fecha)=' + @aniomes + ')) and a04.fechaBaja is null and isnull(a04.tarjeta,0)=0 '

		if @Cobrador is not null and @Cobrador <> 0
			set @C_String =	@C_String + ' and A04.cobrador = ' + convert(char(3),@Cobrador)


-- Compruebo si se filtra por medio de un valor de operacion o por medio de distintos 
-- valores ingresados por pantalla
-- El filtro por un valor de operacion se utiliza en el caso de que el recibo se imprime 
-- directamente, y el otro caso es cuando se dan varias opciones para la impresion.


--if @Directo = 'S'
--	set @C_String =	@C_String + ' and A01.idOperacion = ' + convert(char(20),@idOperacion)	
--else
--	begin
		if @Desde is not null and @Desde <> 0
			set @C_String =	@C_String + ' and A04.socio >= ' + convert(char(10),@Desde)
	
		if @Hasta is not null and @Hasta <> 0
			set @C_String =	@C_String + ' and A04.socio <= ' + convert(char(10),@Hasta)

/*		
		if @Cobrador is not null and @Cobrador <> 0
			set @C_String =	@C_String + ' and A04.cobrador = ' + convert(char(3),@Cobrador)
	
		if len(@AnioMes) > 0
			set @C_String =	@C_String + ' and A01.aniomes = ' + @Aniomes
*/
--	end
	set @C_String =	@C_String + ' order by A04.apellido, A04.nombre '
	

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String
























GO
/****** Object:  StoredProcedure [dbo].[ReciboSociosHeader_ENERO2003]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO




CREATE                  Procedure [dbo].[ReciboSociosHeader_ENERO2003]

	@Directo		char(1) = 'N', -- Si, No
	@Desde			int = Null,
	@Hasta			int = Null,
	@Cobrador		int = Null,
	@AnioMes		char(6),
	@idOperacion	numeric

AS
Declare @C_String nvarchar(4000)
Declare @boolWhere char(1)

set @boolWhere = 'N'

/********************************************************************************/
/*		Consulta para los datos Header de Socios								*/
/********************************************************************************/

set @C_String = 'Select	A01.idOperacion, A01.Fecha, A01.AnioMes,
			A02.idTransaccion, A03.Concepto, A03.Importe, 
			Upper(dbo.NumLet(A03.Importe)) as DescImporte,
		 	A04.Socio, A04.Apellido, A04.Nombre, A04.Domicilio, A04.Localidad, A04.Telefono, A04.Observa1, 
			(Select top 1 B01.Especialidad from Especialidades_Socios B01 where B01.Socio = A04.Socio) as Especialidad,
			(Select top 1 B02.Descripcion from Especialidades_Socios B01 inner join Especialidades B02 on B01.especialidad = B02.especialidad
			where B01.Socio = A04.Socio) as DescEspecialidad,
			A07.Numero as NumeroRecibo, A07.Cobrador, A01.Serie, A07.idTransaccionMes, 

			(select top 1 ho.hospital  from socios so left join hospitales ho
			on right(convert(char(5),ho.hospital + 10000),4) = convert(char(10),so.domicilio_cobro) 
			where so.socio = A04.socio) as DomicilioCobro

		From header_operaciones A01
			inner join detalle_operaciones A02
				on A01.idOperacion = A02.idOperacion
			inner join Recibos A07
				on A02.idTransaccion = A07.idTransaccion
			inner join cuentascorrientes A03
				on A07.idTransaccionMes = A03.idTransaccion
			inner join Socios A04
				on A03.socio = A04.socio
		where A03.Entidad = 0 '

-- Compruebo si se filtra por medio de un valor de operacion o por medio de distintos 
-- valores ingresados por pantalla
-- El filtro por un valor de operacion se utiliza en el caso de que el recibo se imprime 
-- directamente, y el otro caso es cuando se dan varias opciones para la impresion.

if @Directo = 'S'
	set @C_String =	@C_String + ' and A01.idOperacion = ' + convert(char(20),@idOperacion)	
else
	begin
		if @Desde is not null and @Desde <> 0
			set @C_String =	@C_String + ' and A04.socio >= ' + convert(char(10),@Desde)
	
		if @Hasta is not null and @Hasta <> 0
			set @C_String =	@C_String + ' and A04.socio <= ' + convert(char(10),@Hasta)
		
		if @Cobrador is not null and @Cobrador <> 0
			set @C_String =	@C_String + ' and A04.cobrador = ' + convert(char(3),@Cobrador)
	
		if len(@AnioMes) > 0
			set @C_String =	@C_String + ' and A01.aniomes = ' + @Aniomes
	end


	set @C_String =	@C_String + ' order by A04.apellido, A04.nombre '
	

/**** Ejecuto la consulta ****/
EXEC sp_executesql @C_String
--print @C_String















GO
/****** Object:  StoredProcedure [dbo].[ReciboSociosItems]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO







CREATE     Procedure [dbo].[ReciboSociosItems]

	@idTransaccionMes	int

AS
Declare @C_String nvarchar(4000)

/****************************************************************************/
/*			Consulta para los datos Items 									*/
/*   Este SP se utiliza tanto para los socios como para los adherentes		*/
/****************************************************************************/

Set @C_String = ' Select A01.DocumentoNumero, A01.Fecha, A02.Concepto, A02.Importe, A03.Descripcion As DescConcepto
				from CuentasCorrientes A01
					inner join DetalleCuentasCorrientes A02 
						on A01.idTransaccion = A02.idTransaccion
					inner join Conceptos A03 
						on A02.concepto = A03.concepto 
				where A01.idtransaccion=' + convert(char(10),@IdtransaccionMes) 


/*

Set @C_String = 'Select	A01.Fecha, 
			A04.Concepto, A04.Importe,
			A05.Descripcion As DescConcepto
		From header_operaciones A01
			inner join detalle_operaciones A02
				on A01.idOperacion = A02.idOperacion
			inner join Recibos A06
				on A02.idTransaccion = A06.idTransaccion
			inner join cuentascorrientes A03
				on A06.idTransaccionMes = A03.idTransaccion
			inner join DetalleCuentasCorrientes A04
				on A06.idTransaccionMes = A04.idTransaccion
			inner join Conceptos A05
				on A04.concepto = A05.concepto 
		Where A03.entidad = ' + convert(char(1),@Entidad)

if @Socio is not null and @Socio <> 0
	set @C_String =	@C_String + ' and A03.socio = ' + convert(char(10),@Socio)

*/
EXEC sp_executesql @C_String
--print @C_String









GO
/****** Object:  StoredProcedure [dbo].[RecibosVariosHeader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  Procedure [dbo].[RecibosVariosHeader]
(
	@idOperacion	int=87871
)
as
Select  A01.idOperacion , A01.Fecha, A01.AnioMes As Header_AnioMes, 
A01.ObservacionComprobante,A01.ComprobanteNumero, A01.Serie, A04.ApellidoNombre, 
A03.haber as ImporteConcepto, A07.Concepto, A07.Descripcion As DescConcepto 
,dbo.numlet((select sum(c.importe) 
From Header_Operaciones a 
inner join Detalle_Operaciones b 
on a.idOperacion = b.idOperacion and b.idTipoTransaccion = 2 
inner join ValoresTesoreria c on c.idTransaccion = b.idTransaccion 
where a.idoperacion = A01.idOperacion)) as Letras,
(select sum(c.importe) 
From Header_Operaciones a 
inner join Detalle_Operaciones b 
on a.idOperacion = b.idOperacion and b.idTipoTransaccion = 2 
inner join ValoresTesoreria c on c.idTransaccion = b.idTransaccion 
where a.idoperacion = A01.idOperacion) ImportePago
From Header_Operaciones A01 inner join AsientosDiariosItems A03 
on A01.asientodiario = A03.asiento and A01.aniomes = A03.aniomes 
inner join DetalleOtrosIngresos A04 on A03.asiento = A04.asiento and A03.aniomes = A04.aniomes and A03.item = A04.item inner join OtrosConceptos A07 on A04.Concepto = A07.Concepto  
Where A01.idOperacion = @idOperacion and A03.tipoasiento = 1 
and A03.Debe=0


GO
/****** Object:  StoredProcedure [dbo].[RecibosVariosValores]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  Procedure [dbo].[RecibosVariosValores]
(
	@idOperacion	int=87871
)
as
Select distinct A01.idOperacion, A01.Fecha, A01.AnioMes As Header_AnioMes, 
A01.ObservacionComprobante, (select sum(c.importe) 
From Header_Operaciones a 
inner join Detalle_Operaciones b 
on a.idOperacion = b.idOperacion and b.idTipoTransaccion = 2 
inner join ValoresTesoreria c on c.idTransaccion = b.idTransaccion 
where a.idoperacion = A01.idOperacion) as ImporteRecibo,
dbo.numlet((select sum(c.importe) 
From Header_Operaciones a 
inner join Detalle_Operaciones b 
on a.idOperacion = b.idOperacion and b.idTipoTransaccion = 2 
inner join ValoresTesoreria c on c.idTransaccion = b.idTransaccion 
where a.idoperacion = A01.idOperacion)) as Letras,
 A04.ApellidoNombre, 
A05.importe as ImportePago, A05.Cuenta, A05.Sucursal, A05.Numero, 
A05.FechaEmision as FechaCheque, A06.Descripcion as DescPago, A06.Modalidad, 
A08.Descripcion as DescBanco 
From Header_Operaciones A01 
inner join Detalle_Operaciones A02 
on A01.idOperacion = A02.idOperacion 
and A02.idTipoTransaccion = 2 
inner join AsientosDiariosItems A03 
on A01.asientodiario = A03.asiento and A01.aniomes = A03.aniomes 
and A03.tipoasiento = 1 and A03.Debe=0 
inner join DetalleOtrosIngresos A04 
on A03.asiento = A04.asiento and A03.aniomes = A04.aniomes and A03.item = A04.item 
inner join ValoresTesoreria A05 
on A05.idTransaccion = A02.idTransaccion
left join Conceptos_Tesoreria A06 
on A05.idConcepto_Tesoreria = A06.idConcepto_Tesoreria 
left join Bancos A08 on A05.Banco = A08.Banco 
Where A01.idOperacion = @idOperacion


GO
/****** Object:  StoredProcedure [dbo].[Reimputa_Municipalidad]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO






CREATE     Procedure [dbo].[Reimputa_Municipalidad] (@idtransaccionOrigen numeric(18,0))
as

Insert into AplicacionesCuentasCorrientesAnuladas
Select * From AplicacionesCuentasCorrientes 
where idtransaccion=@idtransaccionOrigen

Update cc 
set importe=0,cancelado=0
From AplicacionesCuentasCorrientes acc
inner join CuentasCorrientes cc on  acc.idtransaccioncancelada=cc.idtransaccion
where acc.idtransaccion=@idtransaccionOrigen

delete from AplicacionesCuentasCorrientes 
where idtransaccion=@idtransaccionOrigen


/*** Declaro Variables Imputacion ***/
DECLARE @socio 			as int
DECLARE @Meses 			as int
DECLARE @Total		 	as Numeric(18,2)
DECLARE @Aniomes		as Numeric(18,0)
DECLARE @Parcial 		as Numeric(18,2)
DECLARE @Grupo			as Char(1)
DECLARE @MesComplemento		as int
DECLARE @boolWhere		as char(1)
Declare @Dump			as Int

/*** Declaro el Cursor de los Conceptos ***/
DECLARE Conceptos CURSOR FOR 
	Select socio,Descuentos,Importe_Total,DescuentoPeriodo,'R' as Grupo, Periodo as Aniomes
	From [reimputa muni] where idtransaccion=@idtransaccionOrigen

/*** Borro TempImputaciones ***/
Delete from Temp_Imputacion

/*** Abro el Cursor ***/
OPEN Conceptos
FETCH NEXT FROM Conceptos INTO @Socio, @Meses,@Total,@Parcial,@Grupo,@aniomes

/*** Recorro el Cursor ***/
WHILE @@FETCH_STATUS = 0
BEGIN
	print @Socio
	Print @Meses
	Print @Total
	Print @Parcial
	Print @Grupo

	insert into Temp_imputacion
	Select * from Conceptos_Activos_Muni(0,@Socio,@anioMes,@Aniomes,@Parcial) order by modalidad

	FETCH NEXT FROM Conceptos INTO @Socio, @Meses,@Total,@Parcial,@Grupo,@Aniomes
END

CLOSE Conceptos
DEALLOCATE Conceptos

/*** Declaro Variables Imputacion ***/
Declare @item			as int
Declare @xSocio			as int
Declare @xPeriodo		as int
Declare @xParcial		as numeric(18,2)
Declare @Periodo		as int
Declare @Descripcion		as char(20)
Declare @Concepto		as Char(3)
Declare @Modalidad		as char(1)
Declare @Importe		as numeric(18,2)
Declare	@Mes			as numeric(18,2)
Declare @Conceptos 		as Int
Declare @TotalPorcentaje	as Numeric(18,2)
Declare @Calculo		as Numeric(18,2)

Select @xSocio=0
Select @xPeriodo=0
Select @xParcial=0
Select @Item=0

/*** Declaro el Cursor de los Conceptos ***/
DECLARE Conceptos_II CURSOR for
Select Periodo,Socio,Concepto,Modalidad,Importe,Mes,Conceptos,TotalPorcentaje from Temp_imputacion order by Socio,Periodo, Modalidad,Concepto

OPEN Conceptos_II
FETCH NEXT FROM Conceptos_II INTO @Periodo,@Socio,@Concepto,@Modalidad,@Importe,@Mes,@Conceptos,@TotalPorcentaje

Declare @MesParcial numeric(18,2)

WHILE @@FETCH_STATUS = 0
BEGIN
	if @xsocio<>@Socio or @xPeriodo<>@Periodo
		begin
			Select @item=0
			select @xSocio=@socio
			Select @xPeriodo=@Periodo
			Select @xParcial=0
			Select @MesParcial=@Mes
		end
--	Else
/*		Select @item=@item+1
		if @Modalidad='I'
			Select @xParcial=@xParcial+@Importe
		else
			begin
				if @item=@conceptos
					select @Calculo=@Mes-@xParcial
				else
					select @Calculo=Round(@Mes/@TotalPorcentaje*@Importe,2)
					Select @xParcial=@xParcial+@Calculo
*/

--	Else

/*	Print @Concepto
	Print @modalidad
	Print @MesParcial
	Print @Importe
*/
	Select @item=@item+1
	if @Modalidad='I'
		begin
			Select @xParcial=@xParcial+@Importe
			Select @MesParcial=@MesParcial-@Importe	
		end
	else
		begin
			if @item=@conceptos
				select @Calculo=@Mes-@xParcial
			else
				select @Calculo=Round(@MesParcial/@TotalPorcentaje*@Importe,2)
				Select @xParcial=@xParcial+@Calculo


				UPDATE Temp_Imputacion SET Importe = @Calculo
				WHERE socio=@Socio and periodo=@Periodo and concepto=@Concepto

			end			

	FETCH NEXT FROM Conceptos_II INTO @Periodo,@Socio,@Concepto,@Modalidad,@Importe,@Mes,@Conceptos,@TotalPorcentaje
END

CLOSE Conceptos_II
DEALLOCATE Conceptos_II







GO
/****** Object:  StoredProcedure [dbo].[ReimputacionDesaplicacion]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[ReimputacionDesaplicacion](@idTransaccion int, @idOperacion int, @idOperacionOrigen int) 
as

-- Guardo Aplicaciones Anteriores
Insert into aplicacionesCuentasCorrientesAnuladas
Select * from aplicacionesCuentasCorrientes 
where idtransaccion=@idtransaccion -- 2634550

-- Repongo valores de Aplicaciones CuentasCorrientes
Update CuentasCorrientes 
set cancelado=isnull((
Select SUM(importe) 
from AplicacionesCuentasCorrientes ac1 
where ac1.idTransaccionCancelada=acc.IdTransaccionCancelada 
and cc.idTransaccion=acc.IdTransaccionCancelada and ac1.idtransaccion<>do.idTransaccion),0) 
from Detalle_Operaciones do
inner Join AplicacionesCuentasCorrientes acc on acc.idtransaccion=do.idtransaccion and do.idtipotransaccion=0
inner join cuentascorrientes cc on cc.idTransaccion=acc.idtransaccionCancelada
where idOPeracion=@idOperacionOrigen

Delete from aplicacionesCuentasCorrientes 
where idtransaccion=@idtransaccion -- 2634550


GO
/****** Object:  StoredProcedure [dbo].[ReingresaCompra]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[ReingresaCompra] (
	@idtransaccion int
)
as
Declare @nutra 		int

INSERT INTO CompProvHeader 
([comprobante], [aniomes], [fecha], [proveedor], [tipocomprobante], [nrocomprobante], [tipofactura], [totalimporte], [cancelado], [fecha1venc], [fecha2venc], [estado], [fechareal], [centrocosto], [DescripcionImporte])
Select [comprobante], [aniomes], [fecha], [proveedor], [tipocomprobante], [nrocomprobante], [tipofactura], [totalimporte], [cancelado], [fecha1venc], [fecha2venc], [estado], [fechareal], [centrocosto], [DescripcionImporte]
from CompProvHeaderAnulados
where idtransaccion=@idtransaccion
-- Idtransaccion de la nueva compra
Select @nutra=@@identity

Update Detalle_operaciones 
Set idtransaccion=@Nutra
where idtipoTransaccion=1 and idtransaccion=@idtransaccion

Delete from CompProvHeaderAnulados
where idtransaccion=@idtransaccion

Declare @idOperacion	int
Select @idOperacion=idOperacion from Detalle_operaciones 
where idtipoTransaccion=1 and idtransaccion=@nutra

insert into asientosdiariositems
select aia.* from asientosdiariositemsanulados aia
inner join header_operaciones ho 
on aia.asiento=ho.asientodiario 
and aia.aniomes=ho.aniomes 
and aia.tipoasiento=ho.tipoasiento
where ho.idOperacion=@idOPeracion

Delete aia from asientosdiariositemsanulados aia
inner join header_operaciones ho 
on aia.asiento=ho.asientodiario 
and aia.aniomes=ho.aniomes 
and aia.tipoasiento=ho.tipoasiento
where ho.idOperacion=@idOPeracion

insert into asientosdiariosHeader
select aia.* from asientosdiariosHeaderanulados aia
inner join header_operaciones ho 
on aia.asiento=ho.asientodiario 
and aia.aniomes=ho.aniomes 
and aia.tipoasiento=ho.tipoasiento
where ho.idOperacion=@idOPeracion


Delete aia
from asientosdiariosHeaderanulados aia
inner join header_operaciones ho 
on aia.asiento=ho.asientodiario 
and aia.aniomes=ho.aniomes 
and aia.tipoasiento=ho.tipoasiento
where ho.idOperacion=@idOPeracion

insert into CompProvItems
Select cpi.* from compProvHeader cph
Left join CompProvItemsAnulados cpi 
on cpi.comprobante=cph.comprobante
and cpi.aniomes=cph.aniomes
where
cph.idtransaccion=@nutra


Delete cpi 
from compProvHeader cph
Left join CompProvItemsAnulados cpi 
on cpi.comprobante=cph.comprobante
and cpi.aniomes=cph.aniomes
where
cph.idtransaccion=@nutra

GO
/****** Object:  StoredProcedure [dbo].[ReingresaOP]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  Procedure [dbo].[ReingresaOP] (
	@idoperacion int
)
as
Declare @nutra 		int

INSERT INTO CompProvHeader 
([comprobante], [aniomes], [fecha], [proveedor], [tipocomprobante], [nrocomprobante], [tipofactura], [totalimporte], [cancelado], [fecha1venc], [fecha2venc], [estado], [fechareal], [centrocosto], [DescripcionImporte])
Select cpa.comprobante, cpa.aniomes, cpa.fecha, cpa.proveedor, cpa.tipocomprobante, 
cpa.nrocomprobante, cpa.tipofactura, cpa.totalimporte, cpa.cancelado, cpa.fecha1venc,
cpa.fecha2venc, cpa.estado, cpa.fechareal, cpa.centrocosto, cpa.DescripcionImporte
from CompProvHeaderAnulados cpa
inner join Detalle_Operaciones do
on cpa.idtransaccion=do.idtransaccion
where idoperacion=@idOperacion
and idtipotransaccion=1
-- Idtransaccion de la nueva compra
Select @nutra=@@identity

Delete cpa
from CompProvHeaderAnulados cpa
inner join Detalle_Operaciones do
on cpa.idtransaccion=do.idtransaccion
where idoperacion=@idOperacion
and idtipotransaccion=1

Update Detalle_operaciones 
Set idtransaccion=@Nutra
where idtipoTransaccion=1 and idoperacion=@idOperacion

insert into asientosdiariositems
select aia.* from asientosdiariositemsanulados aia
inner join header_operaciones ho 
on aia.asiento=ho.asientodiario 
and aia.aniomes=ho.aniomes 
and aia.tipoasiento=ho.tipoasiento
where ho.idOperacion=@idOPeracion

Delete aia from asientosdiariositemsanulados aia
inner join header_operaciones ho 
on aia.asiento=ho.asientodiario 
and aia.aniomes=ho.aniomes 
and aia.tipoasiento=ho.tipoasiento
where ho.idOperacion=@idOPeracion

insert into asientosdiariosHeader
select aia.* from asientosdiariosHeaderanulados aia
inner join header_operaciones ho 
on aia.asiento=ho.asientodiario 
and aia.aniomes=ho.aniomes 
and aia.tipoasiento=ho.tipoasiento
where ho.idOperacion=@idOPeracion

Delete aia
from asientosdiariosHeaderanulados aia
inner join header_operaciones ho 
on aia.asiento=ho.asientodiario 
and aia.aniomes=ho.aniomes 
and aia.tipoasiento=ho.tipoasiento
where ho.idOperacion=@idOPeracion

insert into CompProvItems
Select cpi.* from compProvHeader cph
Left join CompProvItemsAnulados cpi 
on cpi.comprobante=cph.comprobante
and cpi.aniomes=cph.aniomes
where
cph.idtransaccion=@nutra

Delete cpi 
from compProvHeader cph
Left join CompProvItemsAnulados cpi 
on cpi.comprobante=cph.comprobante
and cpi.aniomes=cph.aniomes
where
cph.idtransaccion=@nutra


GO
/****** Object:  StoredProcedure [dbo].[Rendiciones_Vuelta]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE  Procedure [dbo].[Rendiciones_Vuelta]
	@N_Rendicion int
AS
SELECT     CuentasCorrientes.socio , Adherentes.Apellido, Adherentes.nombre, CuentasCorrientes.Concepto, CuentasCorrientes.DocumentoNumero, 
                      CuentasCorrientes.importe, CuentasCorrientes.vencimiento, 1 as Chk, idtransaccion 
FROM         CuentasCorrientes INNER JOIN
                      Adherentes ON CuentasCorrientes.socio = Adherentes.Adherente
Where Rendicion=@N_Rendicion and concepto='MES'
order by adherentes.apellido,adherentes.Nombre


GO
/****** Object:  StoredProcedure [dbo].[RendicionesManuales]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO





CREATE     Procedure [dbo].[RendicionesManuales] (@Entidad int, @Cobrador int)
as
Set Quoted_identifier off
Declare @strSql as varChar(4000)
if @entidad=1 
	Begin
		SELECT ad.Adherente AS Adherente, ad.Apellido AS Apellido, ad.nombre AS Nombre, 
		ad.NroMatricula AS NroMatricula, cc.Concepto AS Concepto_CtaCte,
		cc.DocumentoNumero AS DocumentoNumero, cc.Serie AS Serie, cc.importe AS Importe_CtaCte, 
		cc.vencimiento AS Vencimiento, cc.IdTransaccion AS IdTransaccion , cb.Importe as Bonificacion, cb.Honorarios, cb.Tope
		From CuentasCorrientes cc 
		INNER JOIN adherentes ad ON cc.socio = ad.Adherente and cc.Entidad = 1 
		inner join cobradores cb on ad.cobrador=cb.cobrador
		WHERE ad.FechaBaja is Null AND (cc.Cancelado is Null or cc.Cancelado = 0) 
		AND cc.Concepto="MES" AND ad.Cobrador = @Cobrador
	end
Else
	begin
		SELECT ad.Socio AS Adherente, ad.Apellido AS Apellido, ad.nombre AS Nombre, 
		ad.NroMatricula AS NroMatricula, cc.Concepto AS Concepto_CtaCte,
		cc.DocumentoNumero AS DocumentoNumero, cc.Serie AS Serie, cc.importe AS Importe_CtaCte, 
		cc.vencimiento AS Vencimiento, cc.IdTransaccion AS IdTransaccion, cb.Importe as Bonificacion, cb.Honorarios, cb.Tope
		From CuentasCorrientes cc 
		INNER JOIN socios ad ON cc.socio = ad.Socio and cc.Entidad = 0 
		inner join cobradores cb on ad.cobrador=cb.cobrador
		WHERE ad.FechaBaja is Null AND (cc.Cancelado is Null or cc.Cancelado = 0) 
		AND cc.Concepto="MES" AND ad.Cobrador = @Cobrador
	end




GO
/****** Object:  StoredProcedure [dbo].[RendicionesManualesDebitoAuto]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO





CREATE     Procedure [dbo].[RendicionesManualesDebitoAuto] (@Entidad int, @Cobrador int, @Tarjeta int)
as
Set Quoted_identifier off
Declare @strSql as varChar(4000)
if @entidad=1 
	Begin
		SELECT ad.Adherente AS Adherente, ad.Apellido AS Apellido, ad.nombre AS Nombre, 
		ad.NroMatricula AS NroMatricula, cc.Concepto AS Concepto_CtaCte,
		cc.DocumentoNumero AS DocumentoNumero, cc.Serie AS Serie, cc.importe AS Importe_CtaCte, 
		cc.vencimiento AS Vencimiento, cc.IdTransaccion AS IdTransaccion , cb.Importe as Bonificacion, cb.Honorarios
		From CuentasCorrientes cc 
		INNER JOIN adherentes ad ON cc.socio = ad.Adherente and cc.Entidad = 1 
		inner join cobradores cb on ad.cobrador=cb.cobrador
		WHERE ad.FechaBaja is Null AND (cc.Cancelado is Null or cc.Cancelado = 0) 
		AND cc.Concepto="MES" AND ad.Cobrador = @Cobrador
		AND ad.Tarjeta = @Tarjeta
	end
Else
	begin
		SELECT ad.Socio AS Adherente, ad.Apellido AS Apellido, ad.nombre AS Nombre, 
		ad.NroMatricula AS NroMatricula, cc.Concepto AS Concepto_CtaCte,
		cc.DocumentoNumero AS DocumentoNumero, cc.Serie AS Serie, cc.importe AS Importe_CtaCte, 
		cc.vencimiento AS Vencimiento, cc.IdTransaccion AS IdTransaccion, cb.Importe as Bonificacion, cb.Honorarios
		From CuentasCorrientes cc 
		INNER JOIN socios ad ON cc.socio = ad.Socio and cc.Entidad = 0 
		inner join cobradores cb on ad.cobrador=cb.cobrador
		WHERE ad.FechaBaja is Null AND (cc.Cancelado is Null or cc.Cancelado = 0) 
		AND cc.Concepto="MES" AND ad.Cobrador = @Cobrador
		AND ad.Tarjeta = @Tarjeta
		order by ad.apellido
	end




GO
/****** Object:  StoredProcedure [dbo].[ReporteRC]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


CREATE  Procedure [dbo].[ReporteRC]
(
	@Debito	    char(1)=null,
	@RNJ	    char(1)=null, -- R entados, N o rentados, J ubilados
	@GrupoDesde char(1)=null,
	@GrupoHasta char(1)=null
)
as
declare @sql as nvarchar(4000)
set @Sql='
Select distinct sc.socio,Apellido,Nombre,nroMatricula,numedocto, domicilio, 
cpostal, localidad, A02.Descripcion as Provincia, 
A03.descripcion as TipoDocu, numedocto, NroMatricula, 
A04.descripcion as TipoMatricula, fechaingreso 
from socios sc left join Grupos_Socios gs on gs.socio=sc.socio 
inner join provincias as A02 on A02.provincia = sc.provincia
inner join TiposDocumento A03 on A03.tipodocto = sc.tipodocto
inner join TiposMatricula A04 on A04.tipoMatricula = sc.tipoMatricula

where sc.fechabaja is null '

if @Debito='S'
	set @sql=@sql + ' and adherido=1 '

if len(@RNJ)>0
	set @sql=@sql + ' and sc.Grupo="' + @RNJ +'"'

if len(@GrupoDesde)>0
	set @sql=@sql + ' and Gs.Grupo>="' + @GrupoDesde + '"'

if len(@GrupoHasta)>0
	set @sql=@sql + ' and Gs.Grupo<="' + @GrupoHasta + '"'

	set @sql=@sql + ' Order by apellido,Nombre'

--print @sql
exec sp_executesql @sql



GO
/****** Object:  StoredProcedure [dbo].[Resubalance]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Procedure [dbo].[Resubalance]
(
	@Desde	char(8)='19000101',
	@Hasta	char(8)='20090630'
)
as
Select 'Total Activo' as Concepto ,sum(debe-haber) Saldo from asientosdiariositems ai
inner join Asientosdiariosheader ah
on ai.asiento=ah.asiento and ai.aniomes=ah.aniomes and ai.tipoasiento=ah.tipoasiento
where fecha between @Desde and @Hasta and cuenta<200000
Union
Select 'Total Pasivo' as Concepto ,sum(debe-haber) Saldo from asientosdiariositems ai
inner join Asientosdiariosheader ah
on ai.asiento=ah.asiento and ai.aniomes=ah.aniomes and ai.tipoasiento=ah.tipoasiento
where fecha between @Desde and @Hasta and cuenta between 200000 and 399999
Union
Select 'Total Ctas Resultado' as Concepto ,sum(debe-haber) Saldo from asientosdiariositems ai
inner join Asientosdiariosheader ah
on ai.asiento=ah.asiento and ai.aniomes=ah.aniomes and ai.tipoasiento=ah.tipoasiento
where fecha between @Desde and @Hasta and cuenta>399999
GO
/****** Object:  StoredProcedure [dbo].[ResultadosOperaciones]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[ResultadosOperaciones]
	@N_Moneda as int,
	@N_Confirmada as int
As
if @N_Confirmada=1
Begin
	(
	SELECT Movimientos.Fecha, Operaciones.Descripcion, 
	    Clientes.Razon_Social, Monedas.Descripcion AS Moneda, 
	    Movimientos.Cantidad AS Compra, 0 AS Venta, 
	    Movimientos.Precio, Movimientos.Neto, 0 as Modificar,
	    Movimientos.idOperacion, 
	    Movimientos.idOperacion as idOperacionCalce, movimientos.Tipooperacion, movimientos.moneda,movimientos.cliente, movimientos.idContacto, Movimientos.Precio_Contacto 
	FROM Movimientos INNER JOIN
	    Clientes ON 
	    Movimientos.Cliente = Clientes.Codigo INNER JOIN
	    Monedas ON 
	    Movimientos.Moneda = Monedas.idMoneda INNER JOIN
	    Operaciones ON 
	    Movimientos.TipoOperacion = Operaciones.idTipoOperacion
	WHERE (Movimientos.TipoOperacion = 0) and day(fecha)=day(getdate()) and month(fecha)=month(getdate()) and year(fecha)=year(getdate()) and movimientos.moneda=@N_Moneda and estado=@N_Confirmada
	)
	Union
	(
	SELECT CalceMovimientos.Fecha, Operaciones.Descripcion, 
	    Clientes.Razon_Social, Monedas.Descripcion AS Moneda, 0 AS Compra,
	    calceMovimientos.Cantidad AS Venta, 
	    Movimientos.Precio, Movimientos.Neto, 0 as Modificar, 
	    calceMovimientos.idOperacion, 
	    calceMovimientos.idOperacionCalce, movimientos.Tipooperacion, movimientos.moneda,movimientos.cliente, movimientos.idContacto, Movimientos.Precio_Contacto
	FROM calceMovimientos INNER JOIN
	    Movimientos ON
	    calceMovimientos.idOperacion=Movimientos.idOperacion INNER JOIN	
	    Clientes ON 
	    Movimientos.Cliente = Clientes.Codigo INNER JOIN
	    Monedas ON 
	    Movimientos.Moneda = Monedas.idMoneda INNER JOIN
	    Operaciones ON 
	    Movimientos.TipoOperacion = Operaciones.idTipoOperacion
	WHERE (Movimientos.TipoOperacion = 1) and day(calceMovimientos.fecha)=day(getdate()) and month(calceMovimientos.fecha)=month(getdate()) and year(calceMovimientos.fecha)=year(getdate()) and movimientos.moneda=@N_Moneda  and estado=@N_Confirmada
	)
	Union
	(
	SELECT Movimientos.Fecha, Operaciones.Descripcion, 
	    Clientes.Razon_Social, Monedas.Descripcion AS Moneda, 
	    0 AS Compra, Movimientos.Cantidad AS Venta, 
	    Movimientos.Precio, Movimientos.Neto, 0 as Modificar,
	    Movimientos.idOperacion, 
	    0 as idOperacionCalce, movimientos.Tipooperacion, movimientos.moneda,movimientos.cliente, movimientos.idContacto, Movimientos.Precio_Contacto 
	FROM Movimientos INNER JOIN
	    Clientes ON 
	    Movimientos.Cliente = Clientes.Codigo INNER JOIN
	    Monedas ON 
	    Movimientos.Moneda = Monedas.idMoneda INNER JOIN
	    Operaciones ON 
	    Movimientos.TipoOperacion = Operaciones.idTipoOperacion
	WHERE (Movimientos.TipoOperacion = 1) and day(fecha)=day(getdate()) and month(fecha)=month(getdate()) and year(fecha)=year(getdate()) and movimientos.moneda=@N_Moneda and estado=@N_Confirmada
	)
	
	Order by IdOperacionCalce, TipoOperacion
end	

Else

Begin
	(
	SELECT Movimientos.Fecha, Operaciones.Descripcion, 
	    Clientes.Razon_Social, Monedas.Descripcion AS Moneda, 
	    Movimientos.Cantidad AS Compra, 0 AS Venta, 
	    Movimientos.Precio, Movimientos.Neto, 0 as Modificar,
	    Movimientos.idOperacion, 
	    Movimientos.idOperacion as idOperacionCalce, movimientos.Tipooperacion, movimientos.moneda,movimientos.cliente, movimientos.idContacto, Movimientos.Precio_Contacto 
	FROM Movimientos INNER JOIN
	    Clientes ON 
	    Movimientos.Cliente = Clientes.Codigo INNER JOIN
	    Monedas ON 
	    Movimientos.Moneda = Monedas.idMoneda INNER JOIN
	    Operaciones ON 
	    Movimientos.TipoOperacion = Operaciones.idTipoOperacion
	WHERE (Movimientos.TipoOperacion = 0) and day(fecha)=day(getdate()) and month(fecha)=month(getdate()) and year(fecha)=year(getdate()) and movimientos.moneda=@N_Moneda 
	)
	Union
	(
	SELECT CalceMovimientos.Fecha, Operaciones.Descripcion, 
	    Clientes.Razon_Social, Monedas.Descripcion AS Moneda, 0 AS Compra,
	    calceMovimientos.Cantidad AS Venta, 
	    Movimientos.Precio, Movimientos.Neto, 0 as Modificar, 
	    calceMovimientos.idOperacion, 
	    calceMovimientos.idOperacionCalce, movimientos.Tipooperacion, movimientos.moneda,movimientos.cliente, movimientos.idContacto, Movimientos.Precio_Contacto
	FROM calceMovimientos INNER JOIN
	    Movimientos ON
	    calceMovimientos.idOperacion=Movimientos.idOperacion INNER JOIN	
	    Clientes ON 
	    Movimientos.Cliente = Clientes.Codigo INNER JOIN
	    Monedas ON 
	    Movimientos.Moneda = Monedas.idMoneda INNER JOIN
	    Operaciones ON 
	    Movimientos.TipoOperacion = Operaciones.idTipoOperacion
	WHERE (Movimientos.TipoOperacion = 1) and day(calceMovimientos.fecha)=day(getdate()) and month(calceMovimientos.fecha)=month(getdate()) and year(calceMovimientos.fecha)=year(getdate()) and movimientos.moneda=@N_Moneda  and estado=@N_Confirmada
	)
	
	Order by IdOperacionCalce, TipoOperacion
end


GO
/****** Object:  StoredProcedure [dbo].[Resumen]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  Procedure [dbo].[Resumen]
as
Select 
a.legajo,
a.apellido, 
a.nombre, 
(
	select sum(i.importe) from 
	items_liquidaciones i where i.legajo=a.legajo
	and i.concepto<152
) as Remuneracion
,
(
	select sum(i.importe) from 
	items_liquidaciones i where i.legajo=a.legajo
	and i.concepto>499 and i.concepto<600 
) as Asignaciones ,
(
	select sum(i.importe) from 
	items_liquidaciones i where i.legajo=a.legajo
	and i.concepto>599 and concepto<>690 and importe>=6
) as Descuentos, 
(
	select sum(i.importe) from 
	items_liquidaciones i where i.legajo=a.legajo
	and i.concepto=690
) as Ganancias

from maestropersonal a




GO
/****** Object:  StoredProcedure [dbo].[Resumen_Ingresos_Cobradores]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[Resumen_Ingresos_Cobradores]
(
	@Periodo int=200510,
	@Inicio int=471,
	@Cierre int=480	

)
as

-- Noviembre 343-354
-- Diciembre 355-365
-- Enero 366-375
-- Febrero 376-384
-- Marzo 385-396
-- Abril 397-410
-- Mayo 411-422
-- Junio 423-434
-- Julio 435-444
-- Agosto 445-456
-- Septiembre 457-470
-- Octubre 471-480

Select c.cobrador,c.global,isnull(c.honorarios,0),c.nombre,
isnull((Select sum(dcc.importe) 
from Header_operaciones ho 
inner join Detalle_operaciones do
on ho.idOperacion=do.idOperacion 
inner join AplicacionesCuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion 
inner join DetalleCuentasCorrientes dcc
on dcc.idtransaccion=cc.idtransaccionCancelada
inner join Conceptos co
on co.concepto=dcc.concepto
where (tipodeOperacion=17) -- or tipodeOperacion=19)
and aniomes=@Periodo
and idTipotransaccion=0 and cobertura=200
and ho.cuenta=c.cobrador),0) as c200,
isnull((Select sum(dcc.importe) 
from Header_operaciones ho 
inner join Detalle_operaciones do
on ho.idOperacion=do.idOperacion 
inner join AplicacionesCuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion 
inner join DetalleCuentasCorrientes dcc
on dcc.idtransaccion=cc.idtransaccionCancelada
inner join Conceptos co
on co.concepto=dcc.concepto
where (tipodeOperacion=17) -- or tipodeOperacion=19)
and aniomes=@Periodo
and idTipotransaccion=0 and cobertura=150
and ho.cuenta=c.cobrador),0) as c150,
isnull((Select sum(dcc.importe) 
from Header_operaciones ho 
inner join Detalle_operaciones do
on ho.idOperacion=do.idOperacion 
inner join AplicacionesCuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion 
inner join DetalleCuentasCorrientes dcc
on dcc.idtransaccion=cc.idtransaccionCancelada
inner join Conceptos co
on co.concepto=dcc.concepto
where (tipodeOperacion=17) -- or tipodeOperacion=19)
and aniomes=@Periodo
and idTipotransaccion=0 and cobertura=100
and ho.cuenta=c.cobrador),0) as c100,
isnull((Select sum(dcc.importe) 
from Header_operaciones ho 
inner join Detalle_operaciones do
on ho.idOperacion=do.idOperacion 
inner join AplicacionesCuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion 
inner join DetalleCuentasCorrientes dcc
on dcc.idtransaccion=cc.idtransaccionCancelada
inner join Conceptos co
on co.concepto=dcc.concepto
where (tipodeOperacion=17) -- or tipodeOperacion=19)
and aniomes=@Periodo
and idTipotransaccion=0 and cobertura=60
and ho.cuenta=c.cobrador),0) as c60,
isnull((Select sum(vt.importe) 
from Header_operaciones ho 
inner join Detalle_operaciones do
on ho.idOperacion=do.idOperacion 
inner join ValoresTesoreria vt
on do.idtransaccion=vt.idtransaccion
where (tipodeOperacion=17) -- or tipodeOperacion=19)
and aniomes=@Periodo 
and idTipotransaccion=2 and idConcepto_tesoreria=10
and ho.cuenta=c.cobrador),0)+isnull(c.honorarios,0) as Honorarios

from Header_operaciones ho 
inner join Cobradores c
on ho.cuenta=c.cobrador


where (tipodeOperacion=17) -- or tipodeOperacion=19)
and aniomes=@Periodo
--
Group By c.cobrador,c.nombre,c.global,c.honorarios

Union

Select c.cobrador,c.global,c.honorarios,c.nombre,
isnull((Select sum(dcc.importe) 
from Header_operaciones ho 
inner join Detalle_operaciones do
on ho.idOperacion=do.idOperacion 
inner join AplicacionesCuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion 
inner join DetalleCuentasCorrientes dcc
on dcc.idtransaccion=cc.idtransaccionCancelada
inner join Conceptos co
on co.concepto=dcc.concepto
where (tipodeOperacion=19)
and comprobanteNumero between @inicio and @cierre
and idTipotransaccion=0 and cobertura=200
and ho.cuenta=c.cobrador),0) as c200,
isnull((Select sum(dcc.importe) 
from Header_operaciones ho 
inner join Detalle_operaciones do
on ho.idOperacion=do.idOperacion 
inner join AplicacionesCuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion 
inner join DetalleCuentasCorrientes dcc
on dcc.idtransaccion=cc.idtransaccionCancelada
inner join Conceptos co
on co.concepto=dcc.concepto
where (tipodeOperacion=19)
and comprobanteNumero between @inicio and @cierre
and idTipotransaccion=0 and cobertura=150
and ho.cuenta=c.cobrador),0) as c150,
isnull((Select sum(dcc.importe) 
from Header_operaciones ho 
inner join Detalle_operaciones do
on ho.idOperacion=do.idOperacion 
inner join AplicacionesCuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion 
inner join DetalleCuentasCorrientes dcc
on dcc.idtransaccion=cc.idtransaccionCancelada
inner join Conceptos co
on co.concepto=dcc.concepto
where (tipodeOperacion=19)
and comprobanteNumero between @inicio and @cierre
and idTipotransaccion=0 and cobertura=100
and ho.cuenta=c.cobrador),0) as c100,
isnull((Select sum(dcc.importe) 
from Header_operaciones ho 
inner join Detalle_operaciones do
on ho.idOperacion=do.idOperacion 
inner join AplicacionesCuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion 
inner join DetalleCuentasCorrientes dcc
on dcc.idtransaccion=cc.idtransaccionCancelada
inner join Conceptos co
on co.concepto=dcc.concepto
where (tipodeOperacion=19)
and comprobanteNumero between @inicio and @cierre
and idTipotransaccion=0 and cobertura=60
and ho.cuenta=c.cobrador),0) as c60,
isnull((Select sum(vt.importe) 
from Header_operaciones ho 
inner join Detalle_operaciones do
on ho.idOperacion=do.idOperacion 
inner join ValoresTesoreria vt
on do.idtransaccion=vt.idtransaccion
where (tipodeOperacion=19)
and comprobanteNumero between @inicio and @cierre
and idTipotransaccion=2 and idConcepto_tesoreria=10
and ho.cuenta=c.cobrador),0)+isnull(c.honorarios,0) as Honorarios

from Header_operaciones ho 
inner join Cobradores c
on ho.cuenta=c.cobrador


where (tipodeOperacion=19)
and comprobanteNumero between @inicio and @cierre
--
Group By c.cobrador,c.nombre,c.global,c.honorarios

order by c.global,c.nombre






GO
/****** Object:  StoredProcedure [dbo].[Resumen_OrdenProduccion]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE  Procedure [dbo].[Resumen_OrdenProduccion]
(
	@Operacion	int=34
)
as
Select arc.articulo Componente, arc.descripcion dComponente,
sum(op.cantidad*isnull(fa.cantidad,1)) Necesidad

from Header_operaciones ho
inner join OrdenesProduccion op 
on ho.idOperacion=op.idOperacion
inner join articulos ar
on op.idArticulo=ar.idarticulo
left join FormulasArticulos fa
on ar.idarticulo=fa.idarticulo
left join articulos arc
on fa.idComponente=arc.idarticulo
where ho.idOPeracion=@Operacion
and arc.articulo is not null
Group by arc.articulo, arc.descripcion 

GO
/****** Object:  StoredProcedure [dbo].[Resumen_Rendiciones]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create Procedure [dbo].[Resumen_Rendiciones]
(
	@Periodo	int=200506,
	@inicio 	int=423,
	@Cierre 	int=434
)
as
-- Noviembre 343-354
-- Diciembre 355-365
-- Enero 366-375
-- Febrero 376-384
-- Marzo 385-396
-- Abril 397-410
-- Mayo 411-422
-- Junio 423-434
-- Select * from Header_operaciones 
-- where tipodeOperacion=19 and comprobanteNumero>354

Select c.cobrador,c.global,c.honorarios,c.nombre,
isnull((Select sum(dcc.importe) 
from Header_operaciones ho 
inner join Detalle_operaciones do
on ho.idOperacion=do.idOperacion 
inner join AplicacionesCuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion 
inner join DetalleCuentasCorrientes dcc
on dcc.idtransaccion=cc.idtransaccionCancelada
inner join Conceptos co
on co.concepto=dcc.concepto
where (tipodeOperacion=17) -- or tipodeOperacion=19)
and aniomes=@Periodo
and idTipotransaccion=0 and cobertura=200
and ho.cuenta=c.cobrador),0) as c200,
isnull((Select sum(dcc.importe) 
from Header_operaciones ho 
inner join Detalle_operaciones do
on ho.idOperacion=do.idOperacion 
inner join AplicacionesCuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion 
inner join DetalleCuentasCorrientes dcc
on dcc.idtransaccion=cc.idtransaccionCancelada
inner join Conceptos co
on co.concepto=dcc.concepto
where (tipodeOperacion=17) -- or tipodeOperacion=19)
and aniomes=@Periodo
and idTipotransaccion=0 and cobertura=150
and ho.cuenta=c.cobrador),0) as c150,
isnull((Select sum(dcc.importe) 
from Header_operaciones ho 
inner join Detalle_operaciones do
on ho.idOperacion=do.idOperacion 
inner join AplicacionesCuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion 
inner join DetalleCuentasCorrientes dcc
on dcc.idtransaccion=cc.idtransaccionCancelada
inner join Conceptos co
on co.concepto=dcc.concepto
where (tipodeOperacion=17) -- or tipodeOperacion=19)
and aniomes=@Periodo
and idTipotransaccion=0 and cobertura=100
and ho.cuenta=c.cobrador),0) as c100,
isnull((Select sum(dcc.importe) 
from Header_operaciones ho 
inner join Detalle_operaciones do
on ho.idOperacion=do.idOperacion 
inner join AplicacionesCuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion 
inner join DetalleCuentasCorrientes dcc
on dcc.idtransaccion=cc.idtransaccionCancelada
inner join Conceptos co
on co.concepto=dcc.concepto
where (tipodeOperacion=17) -- or tipodeOperacion=19)
and aniomes=@Periodo
and idTipotransaccion=0 and cobertura=60
and ho.cuenta=c.cobrador),0) as c60,
isnull((Select sum(vt.importe) 
from Header_operaciones ho 
inner join Detalle_operaciones do
on ho.idOperacion=do.idOperacion 
inner join ValoresTesoreria vt
on do.idtransaccion=vt.idtransaccion
where (tipodeOperacion=17) -- or tipodeOperacion=19)
and aniomes=@Periodo 
and idTipotransaccion=2 and idConcepto_tesoreria=10
and ho.cuenta=c.cobrador),0)+isnull(c.honorarios,0) as Honorarios

from Header_operaciones ho 
inner join Cobradores c
on ho.cuenta=c.cobrador


where (tipodeOperacion=17) -- or tipodeOperacion=19)
and aniomes=@Periodo
--
Group By c.cobrador,c.nombre,c.global,c.honorarios

Union

Select c.cobrador,c.global,c.honorarios,c.nombre,
isnull((Select sum(dcc.importe) 
from Header_operaciones ho 
inner join Detalle_operaciones do
on ho.idOperacion=do.idOperacion 
inner join AplicacionesCuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion 
inner join DetalleCuentasCorrientes dcc
on dcc.idtransaccion=cc.idtransaccionCancelada
inner join Conceptos co
on co.concepto=dcc.concepto
where (tipodeOperacion=19)
and comprobanteNumero between @inicio and @cierre
and idTipotransaccion=0 and cobertura=200
and ho.cuenta=c.cobrador),0) as c200,
isnull((Select sum(dcc.importe) 
from Header_operaciones ho 
inner join Detalle_operaciones do
on ho.idOperacion=do.idOperacion 
inner join AplicacionesCuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion 
inner join DetalleCuentasCorrientes dcc
on dcc.idtransaccion=cc.idtransaccionCancelada
inner join Conceptos co
on co.concepto=dcc.concepto
where (tipodeOperacion=19)
and comprobanteNumero between @inicio and @cierre
and idTipotransaccion=0 and cobertura=150
and ho.cuenta=c.cobrador),0) as c150,
isnull((Select sum(dcc.importe) 
from Header_operaciones ho 
inner join Detalle_operaciones do
on ho.idOperacion=do.idOperacion 
inner join AplicacionesCuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion 
inner join DetalleCuentasCorrientes dcc
on dcc.idtransaccion=cc.idtransaccionCancelada
inner join Conceptos co
on co.concepto=dcc.concepto
where (tipodeOperacion=19)
and comprobanteNumero between @inicio and @cierre
and idTipotransaccion=0 and cobertura=100
and ho.cuenta=c.cobrador),0) as c100,
isnull((Select sum(dcc.importe) 
from Header_operaciones ho 
inner join Detalle_operaciones do
on ho.idOperacion=do.idOperacion 
inner join AplicacionesCuentasCorrientes cc
on do.idtransaccion=cc.idtransaccion 
inner join DetalleCuentasCorrientes dcc
on dcc.idtransaccion=cc.idtransaccionCancelada
inner join Conceptos co
on co.concepto=dcc.concepto
where (tipodeOperacion=19)
and comprobanteNumero between @inicio and @cierre
and idTipotransaccion=0 and cobertura=60
and ho.cuenta=c.cobrador),0) as c60,
isnull((Select sum(vt.importe) 
from Header_operaciones ho 
inner join Detalle_operaciones do
on ho.idOperacion=do.idOperacion 
inner join ValoresTesoreria vt
on do.idtransaccion=vt.idtransaccion
where (tipodeOperacion=19)
and comprobanteNumero between @inicio and @cierre
and idTipotransaccion=2 and idConcepto_tesoreria=10
and ho.cuenta=c.cobrador),0)+isnull(c.honorarios,0) as Honorarios

from Header_operaciones ho 
inner join Cobradores c
on ho.cuenta=c.cobrador


where (tipodeOperacion=19)
and comprobanteNumero between @inicio and @cierre
--
Group By c.cobrador,c.nombre,c.global,c.honorarios

order by c.global,c.nombre






GO
/****** Object:  StoredProcedure [dbo].[ResumenCursos]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE       Procedure [dbo].[ResumenCursos] -- ResumenCursos '20060401','20060430'
(	
	@Desde	char(8)=null,
	@Hasta	char(8)=null
)
as
Select Distinct cc.Fecha,cc.Documentonumero recibo, 
cc1.documentonumero Mes,cc.Socio,nyap,isnull(dcc.concepto,cc.idcancelada) idcancelada,acc.importe,n.descripcion,99,acc.idtransaccioncancelada as item 
from CuentasCorrientes cc
inner join aplicacionesCuentasCorrientes acc
on cc.idtransaccion=acc.idtransaccion
left join detalleCuentasCorrientes dcc
on acc.idtransaccioncancelada=dcc.idtransaccion
left join CuentasCorrientes cc1
on acc.idtransaccionCancelada=cc1.idtransaccion

inner join alumnos a on 
cc.socio=a.idalumno
inner join NominaCursos n
on isnull(dcc.concepto,cc.idcancelada)=idcurso
where cc.entidad=2
and cc.fecha between @Desde and @Hasta
and (cc.concepto='COB' or cc.concepto='DA')

order by idcancelada,cc.fecha,cc.socio,cc1.Documentonumero



GO
/****** Object:  StoredProcedure [dbo].[ResumenTarjeta]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE   Procedure [dbo].[ResumenTarjeta] -- ResumenTarjeta 71800
(
	@idOperacion	int
)
as
Select substring(cast(isnull(co.concepto,'IDH') as char(3)),1,1) Grupo,cc.entidad,sum(dcc.importe) Importe,
Case
 when substring(cast(isnull(co.concepto,'IDH') as char(3)),1,1)='C' then 'Cuota Social'
 when substring(cast(isnull(co.concepto,'IDH') as char(3)),1,1)='F' and cc.entidad=1 then 'Foprosa'
 when substring(cast(isnull(co.concepto,'IDH') as char(3)),1,1)='F' and cc.entidad=0 then 'Fondo'
 when substring(cast(isnull(co.concepto,'IDH') as char(3)),1,1)='S' and cc.entidad=1 then 'Seguro de Vida Foprosa'
 when substring(cast(isnull(co.concepto,'IDH') as char(3)),1,1)='S' and cc.entidad=0 then 'Seguro de Vida Fondo'
 else 'Cursos'
end Descripcion,
Case
 when substring(cast(isnull(co.concepto,'IDH') as char(3)),1,1)='C' then '710102'
 when substring(cast(isnull(co.concepto,'IDH') as char(3)),1,1)='F' and cc.entidad=1 then '720201'
 when substring(cast(isnull(co.concepto,'IDH') as char(3)),1,1)='F' and cc.entidad=0 then '720102'
 when substring(cast(isnull(co.concepto,'IDH') as char(3)),1,1)='S' and cc.entidad=1 then '710200'
 when substring(cast(isnull(co.concepto,'IDH') as char(3)),1,1)='S' and cc.entidad=0 then '710200'
 else oc.Imputacion_contable
end Imputacion, ho.observacion

from header_operaciones ho
inner join Detalle_operaciones do
on do.idOPeracion=ho.idOperacion
inner join aplicacionesCuentasCOrrientes acc
on do.idTransaccion=acc.idtransaccion
inner join CuentasCorrientes cc
on acc.idtransaccion=cc.idtransaccion
inner join DetalleCuentasCorrientes dcc
on acc.idtransaccionCancelada=dcc.idtransaccion
Left join COnceptos co
on cast(dcc.concepto as char(3))=cast(co.concepto as char(3))
left join NominaCursos nc
on cast(nc.idCurso as char(3))=isnull(cast(cc.idCancelada as char(3)),cast(dcc.concepto as char(3))) 
left join otrosConceptos oc
on cast(nc.Concepto as char(3))=cast(oc.concepto as char(3))
where ho.idOperacion=@idOperacion
and idtipotransaccion=0
Group by  substring(cast(isnull(co.concepto,'IDH') as char(3)),1,1),cc.entidad,
Case
 when substring(cast(isnull(co.concepto,'IDH') as char(3)),1,1)='C' then 'Cuota Social'
 when substring(cast(isnull(co.concepto,'IDH') as char(3)),1,1)='F' and cc.entidad=1 then 'Foprosa'
 when substring(cast(isnull(co.concepto,'IDH') as char(3)),1,1)='F' and cc.entidad=0 then 'Fondo'
 when substring(cast(isnull(co.concepto,'IDH') as char(3)),1,1)='S' and cc.entidad=1 then 'Seguro de Vida Foprosa'
 when substring(cast(isnull(co.concepto,'IDH') as char(3)),1,1)='S' and cc.entidad=0 then 'Seguro de Vida Fondo'
end ,
Case
 when substring(cast(isnull(co.concepto,'IDH') as char(3)),1,1)='C' then '710102'
 when substring(cast(isnull(co.concepto,'IDH') as char(3)),1,1)='F' and cc.entidad=1 then '720201'
 when substring(cast(isnull(co.concepto,'IDH') as char(3)),1,1)='F' and cc.entidad=0 then '720102'
 when substring(cast(isnull(co.concepto,'IDH') as char(3)),1,1)='S' and cc.entidad=1 then '710200'
 when substring(cast(isnull(co.concepto,'IDH') as char(3)),1,1)='S' and cc.entidad=0 then '710200'
 else oc.Imputacion_contable
end ,
observacion
order by substring(cast(isnull(co.concepto,'IDH') as char(3)),1,1),cc.entidad



GO
/****** Object:  StoredProcedure [dbo].[Retencion]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  Procedure [dbo].[Retencion](@Aniomes int)
as

Select 
'01' as CodigoComprobante, FechaEmision,

(Select top 1 cph1.nroComprobante from detalle_Operaciones do1
Left Join AplicacionesCuentasaPagar cph on do1.idtransaccion=cph.idtransaccion 
Left Join Compprovheader cph1 on cph.idtransaccionCancelada=cph1.idtransaccion
inner join proveedores pv on pv.codigo=cph1.proveedor
where do1.idOperacion=ho.idoperacion and do1.idtipotransaccion=1) as NroComprobante, 

(Select top 1 cph1.totalimporte from detalle_Operaciones do1
Left Join AplicacionesCuentasaPagar cph on do1.idtransaccion=cph.idtransaccion 
Left Join Compprovheader cph1 on cph.idtransaccionCancelada=cph1.idtransaccion
inner join proveedores pv on pv.codigo=cph1.proveedor
where do1.idOperacion=ho.idoperacion and do1.idtipotransaccion=1) as TotalComprobante, 

217 as CodigodeImpuesto,

(Select top 1 case pv.tablaganancia when 6 then '094' when 7 then '116' end 
	from detalle_Operaciones do1
	Left Join AplicacionesCuentasaPagar cph on do1.idtransaccion=cph.idtransaccion 
	Left Join Compprovheader cph1 on cph.idtransaccionCancelada=cph1.idtransaccion
	inner join proveedores pv on pv.codigo=cph1.proveedor
	where do1.idOperacion=ho.idoperacion and do1.idtipotransaccion=1) as Regimen,
1 as CodigoOperacion,

(Select top 1 cph1.totalimporte from detalle_Operaciones do1
Left Join AplicacionesCuentasaPagar cph on do1.idtransaccion=cph.idtransaccion 
Left Join Compprovheader cph1 on cph.idtransaccionCancelada=cph1.idtransaccion
inner join proveedores pv on pv.codigo=cph1.proveedor
where do1.idOperacion=ho.idoperacion and do1.idtipotransaccion=1) as BaseCalculo,

FechaEmision as FechaRetencion, '01' as codigoCondicion, vt.importe as Retencion,
'00000000/00/0000' as Porcentaje_Boletin,

'80' as tipodocumento,

(Select top 1 pv.cuit from detalle_Operaciones do1
Left Join AplicacionesCuentasaPagar cph on do1.idtransaccion=cph.idtransaccion 
Left Join Compprovheader cph1 on cph.idtransaccionCancelada=cph1.idtransaccion
inner join proveedores pv on pv.codigo=cph1.proveedor
where do1.idOperacion=ho.idoperacion and do1.idtipotransaccion=1) as Documento,

'         000000000000000' as filler
from valoresTesoreria vt
inner join conceptos_Tesoreria ct
on vt.idConcepto_tesoreria=ct.idConcepto_tesoreria
inner join Detalle_Operaciones do
on do.idtransaccion=vt.idtransaccion 
inner join Header_Operaciones ho 
on ho.idOperacion=do.idOperacion
Left Join AplicacionesCuentasaPagar cph 
on do.idtransaccion=cph.idtransaccion 
Left Join Compprovheader cph1
on cph.idtransaccionCancelada=cph1.idtransaccion

where Unificador=8
and isnull(do.idtipotransaccion,2)=2
and dbo.toaniomes(FechaEmision)=@aniomes
--and FechaEmision>=@Inicio 
and (TipodeOperacion=20)






GO
/****** Object:  StoredProcedure [dbo].[Retenciones]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Procedure [dbo].[Retenciones]
(
	@Desde	varchar(8)='20090715',
	@Hasta	varchar(8)='20090731'
)
as
Select isnull(c.cuit,cv.cuit) cuit,v.fecha,nrocomprobante,TotalImporte

from CompProvHeader v
left join cphVarios vv
on v.idtransaccion=vv.idtransaccion
Left join Proveedores c
on isnull(vv.Codigo,v.Proveedor)=c.codigo
Left join Provfondo cv
on isnull(vv.Codigo,v.Proveedor)=cv.proveedor

where Tipocomprobante=30

and v.fecha between @Desde and @Hasta


GO
/****** Object:  StoredProcedure [dbo].[RetIIBB]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[RetIIBB]

(
	@Desde	varchar(8)='20100601',
	@Hasta	varchar(8)='20101130'
)
as
Select  p.cuit,substring(cast(100+day(vch.fecha) as varchar(3)),2,2)+'/'+
substring(cast(100+Month(vch.fecha) as varchar(3)),2,2)+'/'+
substring(cast(10000+year(vch.fecha) as varchar(5)),2,4)+
Substring(nrocomprobante,5,8)+
Substring(nrocomprobante,1,4)+
substring(Cast(100000000+Asientointerno as varchar(9)),2,8) Texto_1,
totalimporte 

from vencliheader vch
inner join clientes p 
on vch.cliente=p.codigo
inner join Detalle_operaciones do
on vch.idtransaccion=do.idtransaccion and do.idtipotransaccion=0 and vch.tipocomprobante=12
inner join Header_operaciones ho
on do.idOperacion=ho.idoperacion
inner join asientosdiariosheader ah
on ah.asiento=ho.asientoDiario and ah.aniomes=ho.aniomes and ah.tipoasiento=ho.tipoasiento
where -- tipocomprobante=30 and 
vch.Fecha between @Desde and @Hasta


GO
/****** Object:  StoredProcedure [dbo].[retIIBBRecibos]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[retIIBBRecibos]
(
	@Desde	varchar(8)='20110101',
	@Hasta	varchar(8)='20110131'
)
as
Select case when imputacion_contable=127905 then '901' else '902' end + ltrim(rtrim(cl.cuit))+
substring(cast(100+day(vch.fecha) as varchar(3)),2,2)+'/'+Substring(cast(100+Month(vch.fecha) as varchar(3)),2,2)+'/'+ substring(cast(10000+year(vch.fecha) as varchar(5)),2,4)
+'0000'+'00000000'+substring(cast(100000000+numero as varchar(9)),2,8)+'F'+(
Select top 1 cast(TipoFactura as char(1)) COLLATE French_CS_AS from aplicacionesCuentasacobrar acp
inner join vencliheader vch1
on acp.idtransaccioncancelada=vch1.idtransaccion
where acp.idtransaccion=vch.idtransaccion)
,dbo.nroOrigen(vch.idtransaccion)
,vt.importe  
,vch.idtransaccion

from vencliheader vch
inner join detalle_operaciones do 
on do.idtransaccion=vch.idtransaccion and idtipotransaccion=0
inner join detalle_operaciones do1
on do.idOperacion=do1.idOperacion and do1.idtipotransaccion=2
inner join valorestesoreria vt
on vt.idtransaccion=do1.idtransaccion
inner join conceptos_tesoreria ct
on vt.idconcepto_tesoreria=ct.idConcepto_tesoreria and ct.imputacion_Contable in (127901,127905)
inner join clientes cl
on vch.cliente=cl.codigo
where vch.fecha between @Desde and @Hasta  
AND tipocomprobante=0


GO
/****** Object:  StoredProcedure [dbo].[RetIvaClientes]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE Procedure [dbo].[RetIvaClientes]
(
	@Desde	varchar(8)='20110301',
	@Hasta	varchar(8)='20110331'
)
as
Select '214'+(Select Cuit from vencliheader vch
inner join detalle_operaciones do
on vch.idtransaccion=do.idtransaccion and idtipotransaccion=0 
inner join clientes cl 
on vch.cliente=cl.codigo
where idoperacion=ho.idoperacion)+
substring(cast(100+day(vt.fechaEmision) as varchar(3)),2,2)+'/'+
substring(cast(100+Month(vt.fechaEmision) as varchar(3)),2,2)+'/'+
substring(cast(10000+year(vt.fechaEmision) as varchar(5)),2,4)+
'00000000'+
substring(Cast(100000000+Numero as varchar(9)),2,8) Texto_1,
importe

from valorestesoreria vt
inner join detalle_operaciones do
on vt.idtransaccion=do.idtransaccion and idtipotransaccion=2
inner join Header_operaciones ho
on do.idoperacion=ho.idoperacion

where idconcepto_Tesoreria in (23,43)
and fecha between @Desde and @Hasta


GO
/****** Object:  StoredProcedure [dbo].[RevierteCobranza]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE      Procedure [dbo].[RevierteCobranza](@idTransaccion int, @idOperacion int, 
@idOperacionOrigen int) 
as

-- Guardo Aplicaciones Anteriores
Insert into aplicacionesCuentasCorrientesAnuladas
Select * from aplicacionesCuentasCorrientes 
where idtransaccion=@idtransaccion -- 2634550

-- Repongo valores de Aplicaciones CuentasCorrientes
Update CuentasCorrientes 
set cancelado=isnull((
Select SUM(importe) 
from AplicacionesCuentasCorrientes ac1 
where ac1.idTransaccionCancelada=acc.IdTransaccionCancelada 
and cc.idTransaccion=acc.IdTransaccionCancelada and ac1.idtransaccion<>do.idTransaccion),0) 
from Detalle_Operaciones do
inner Join AplicacionesCuentasCorrientes acc on acc.idtransaccion=do.idtransaccion and do.idtipotransaccion=0
inner join cuentascorrientes cc on cc.idTransaccion=acc.idtransaccionCancelada
where idOPeracion=@idOperacionOrigen

Delete from aplicacionesCuentasCorrientes 
where idtransaccion=@idtransaccion -- 2634550

Declare @trValor int
/*
Insert Into Valorestesoreria
(idTransaccionOrigen,TipoMovimiento,
 idConcepto_Tesoreria,FechaEmision,Vencimiento,Banco,Cuenta,Sucursal,Numero,Firma,
 importe,Cancelado,idoperador,numerointerno,observaciones,idOpCobrador,Corregido)
Select idTransaccionOrigen,2,
 idConcepto_Tesoreria,FechaEmision,Vencimiento,Banco,Cuenta,Sucursal,Numero,Firma,
 importe,Cancelado,idoperador,numerointerno,observaciones,idOpCobrador,Corregido from ValoresTesoreria where idtransaccionOrigen=@idtransaccion
Select trValor=@@identity
*/
update valoresTesoreria
set cancelado=importe where idtransaccion=@idtransaccion
update valoresTesoreria
set cancelado=importe,tipomovimiento=2 where idtransaccion=@trValor

Declare @trCtaCte int
Insert Into CuentasCorrientes
(socio, Entidad, Fecha, Concepto, 
PuntodeVenta, DocumentoNumero, FechaRendicion, 
Rendicion, importe, Cancelado, vencimiento, Cobrador,
serie,idOpcobrador)
Select socio, Entidad, Fecha, Concepto, 
PuntodeVenta, DocumentoNumero, FechaRendicion, 
Rendicion, importe, Cancelado, vencimiento, Cobrador,
serie,idOpcobrador from CuentasCorrientes where idtransaccion=@idtransaccion
Select @trCtaCte=@@identity

update CuentasCorrientes
set cancelado=importe where idtransaccion=@idtransaccion
update CuentasCorrientes
set cancelado=importe,Concepto='ND', fecha=getdate() where idtransaccion=@trCtaCte

Declare @Importe numeric(18,2)

Set @Importe=(Select importe from CuentasCorrientes where idtransaccion=@idtransaccion)

Insert into AplicacionesCuentasCorrientes
(idtransaccion,item,idTransaccionCancelada,importe)
values
(@trCtaCte,1,@idtransaccion,@importe)

insert into detalle_operaciones 
(IdOperacion,IdTipoTransaccion,idTransaccion,itemdiario)
values
(@IdOperacion,0,@trCtaCte,0)

insert into detalle_operaciones 
(IdOperacion,IdTipoTransaccion,idTransaccion,itemdiario)
values
(@IdOperacion,2,@trValor,0)

Declare @asientoRev int
Declare @Periodo int
Declare @Table varchar(20)
Select @Periodo=(Select dbo.toaniomes(getdate()))

--print @Periodo

select @Table='as_1_'+cast(@Periodo as char(6))
Execute getNextIdentity @Table, @Value=@asientoRev Output

insert into asientosDiariosHeader
Select @asientoRev as asiento ,@Periodo as aniomes, ai.tipoasiento as tipoasiento, getdate() as fecha,'Reversion Cobranza Ventanilla' ,ai.centrocosto as centrocosto,null as asientocierre from 
header_operaciones ho
inner Join AsientosDiariosHeader ai
on ai.asiento=asientoDiario and ho.aniomes=ai.aniomes and ai.tipoasiento=isnull(ho.tipoasiento,1)
where idOperacion=@idOperacionOrigen

insert into asientosDiariosItems
Select @asientoRev as asiento ,ai.item as item,@Periodo as aniomes, ai.tipoasiento as tipoasiento,ai.cuenta as cuenta ,ai.haber as debe,ai.debe as haber,ai.observacion as obsrevacion ,ai.centrocosto as centrocosto from 
header_operaciones ho
inner Join AsientosDiariosItems ai
on ai.asiento=asientoDiario and ho.aniomes=ai.aniomes and ai.tipoasiento=isnull(ho.tipoasiento,1)
where idOperacion=@idOperacionOrigen

update Header_operaciones 
set asientoDiario=@asientoRev, tipoasiento=1,aniomes=@Periodo 
where IdOperacion=@IdOperacion






GO
/****** Object:  StoredProcedure [dbo].[rptVentasJurisdiccion]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Procedure [dbo].[rptVentasJurisdiccion]
(
	@Desde char(8),
	@Hasta char(8)
)
as
Select case when len(ltrim(rtrim(dProvincia)))=0 then 'No Informado' else dProvincia end dProvinciar,idProvincia,sum(neto) Neto,sum(iva) Iva,sum(totalComprobante) Total from vBaseIva
where fecha between @Desde and @Hasta
Group by dProvincia,idProvincia



GO
/****** Object:  StoredProcedure [dbo].[saldos]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Procedure [dbo].[saldos]
(
	@inicio varchar(8)='20190802',
	@cierre varchar(8)='20200801',
	@opcion varchar(1)
)
as
SELECT RPT_SaldosCuentas.cuenta , RPT_SaldosCuentas.descripcion, RPT_SaldosCuentas.apertura, 
RPT_SaldosCuentas.debe, RPT_SaldosCuentas.haber, 
RPT_SaldosCuentas.apertura+
RPT_SaldosCuentas.debe- RPT_SaldosCuentas.haber as saldo
from (
Select c.cuenta,c.descripcion,
sum(case when fecha<@inicio and @opcion='A' then debe-haber else 0 end) apertura,
sum(isnull(case when fecha between @inicio and @cierre then debe else 0 end,0)) Debe,
sum(isnull(case when fecha between @inicio and @cierre then haber else 0 end,0)) Haber,
0 saldo
From Asientosdiariositems ai 
inner join asientosdiariosHeader ah 
on ai.asiento=ah.asiento and ai.aniomes=ah.aniomes and ai.tipoasiento=ah.tipoasiento
inner join cuentas c 
on ai.cuenta=c.cuenta
where fecha between @inicio and @cierre
Group by c.cuenta,c.descripcion
) as 
RPT_SaldosCuentas
order by RPT_SaldosCuentas.cuenta
GO
/****** Object:  StoredProcedure [dbo].[Saldos_Proveedores]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE               Procedure [dbo].[Saldos_Proveedores] (
	@CliPro 	Char(1)='C',
	@C_Modo		char(1)='P',
	@Codigo		int=0,
	@Desde 		int=null,
	@Hasta int=null,
	@Vendedor	int=0,
	@TipoCuenta	int=0
)
as 
if @CliPro='P'
Select 
Codigo,RazonSocial,(
	Select isnull(sum(totalimporte*Multiplicador),0)
	from compprovheader cph
	inner join tipCompModHeader tcmh
	on cph.tipocomprobante=tcmh.codigo
	where proveedor=pv.codigo and estado not in ('F')) as saldo,domicilio,localidad,telefono1,telefono2
from Proveedores pv
where (Select count(*)
from compprovheader cph inner join tipCompModHeader tcmh on cph.tipocomprobante=tcmh.codigo
where proveedor=pv.codigo and estado not in ('F'))<>0 and (Codigo=@Codigo or @Codigo=0) and 
(
	Select isnull(sum(totalimporte*Multiplicador),0)
	from compprovheader cph
	inner join tipCompModHeader tcmh
	on cph.tipocomprobante=tcmh.codigo
	where proveedor=pv.codigo and estado not in ('F'))<>0
	and (pv.tipocuenta=@tipocuenta or @tipocuenta=0)	
	ORDER BY Codigo
else
Select 
Codigo,RazonSocial,(
	Select isnull(sum((totalimporte-isnull(cancelado,0))*Multiplicador),0)
	from vencliheader cph
	inner join tipventModHeader tcmh
	on cph.tipocomprobante=tcmh.codigo
	where Cliente=pv.codigo) as saldo,(
	Select isnull(sum(totalimporte*Multiplicador),0)
	from vencliheader cph
	inner join tipventModHeader tcmh
	on cph.tipocomprobante=tcmh.codigo
	where Cliente=pv.codigo) as Analisis,domicilio,localidad,telefono1,telefono2
from Clientes pv
where (((
	Select isnull(sum(totalimporte*Multiplicador),0)
	from vencliheader cph
	inner join tipventModHeader tcmh
	on cph.tipocomprobante=tcmh.codigo
	where Cliente=pv.codigo)<>0) or 	@Codigo<>0)
and (pv.codigo=@Codigo or @Codigo=0)
ORDER BY Codigo



















GO
/****** Object:  StoredProcedure [dbo].[Saldos_ProveedoresConsolidado]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE               Procedure [dbo].[Saldos_ProveedoresConsolidado] (
	@CliPro 	Char(1)='c',
	@C_Modo		char(1)='P',
	@Codigo		int=0,
	@Desde 		int=null,
	@Hasta int=null,
	@Vendedor	int=0,
	@TipoCuenta	int=0
)
as 
if @CliPro='P'
	Select 
	Codigo,RazonSocial,(
		Select isnull(sum( (totalimporte-isnull(cancelado,0) ) * Multiplicador * case when moneda=0 then 1 else 0 end),0)
		from CompProvHeader cph
		inner join tipCompModHeader tcmh
		on cph.tipocomprobante=tcmh.codigo
		where Proveedor=pv.codigo and estado not in ('F')) as saldo,
	(
		Select isnull(sum(totalimporte*Multiplicador*case when moneda=0 then 1 else 0 end),0)
		from CompProvHeader cph
		inner join tipCompModHeader tcmh
		on cph.tipocomprobante=tcmh.codigo
		where Proveedor=pv.codigo and estado not in ('F')) as Analisis
	,isnull(
	(
		Select sum(isnull(ImporteOrigen,0)*Multiplicador*case when moneda=1 then 1 else 0 end) sPesos
		from CompProvHeader cph
		inner join tipCompModHeader tcmh
		on cph.tipocomprobante=tcmh.codigo
		where Proveedor=pv.codigo and estado not in ('F')),0)
	as Dolares,
	isnull(
	(
		Select sum((isnull(ImporteOrigen,0)-isnull(CanceladoOrigen,0))*Multiplicador*case when moneda=1 then 1 else 0 end) sPesos
		from CompProvHeader cph
		inner join tipCompModHeader tcmh
		on cph.tipocomprobante=tcmh.codigo
		where Proveedor=pv.codigo and estado not in ('F')),0)
	as Dolares ,
	domicilio,localidad,telefono1,telefono2
	from Proveedores pv
	where 
	(
	(	(Select isnull(sum(totalimporte*Multiplicador),0)
			from CompProvHeader cph
			inner join tipCompModHeader tcmh
			on cph.tipocomprobante=tcmh.codigo
			where Proveedor=pv.codigo and estado not in ('F'))<>0  

	or

	(Select isnull(sum(ImporteOrigen*Multiplicador),0)
		from CompProvHeader cph
		inner join tipCompModHeader tcmh
		on cph.tipocomprobante=tcmh.codigo
		where Proveedor=pv.codigo and estado not in ('F') )<>0  

			
	)
		or	

		@Codigo<>0 
	)
	and (pv.codigo=@Codigo or @Codigo=0)

	ORDER BY RAZONSOCIAL
else
	Select 
	Codigo,RazonSocial,(
		Select isnull(sum( (totalimporte-isnull(cancelado,0) ) * Multiplicador * case when moneda=0 then 1 else 0 end),0)
		from vencliheader cph
		inner join tipventModHeader tcmh
		on cph.tipocomprobante=tcmh.codigo
		where Cliente=pv.codigo) as saldo,
	(
		Select isnull(sum(totalimporte*Multiplicador*case when moneda=0 then 1 else 0 end),0)
		from vencliheader cph
		inner join tipventModHeader tcmh
		on cph.tipocomprobante=tcmh.codigo
		where Cliente=pv.codigo) as Analisis
	,isnull(
	(
		Select sum(isnull(ImporteOrigen,0)*Multiplicador*case when moneda=1 then 1 else 0 end) sPesos
		from vencliheader cph
		inner join tipventModHeader tcmh
		on cph.tipocomprobante=tcmh.codigo
		where Cliente=pv.codigo),0)
	as Dolares,
	isnull(
	(
		Select sum((isnull(ImporteOrigen,0)-isnull(CanceladoOrigen,0))*Multiplicador*case when moneda=1 then 1 else 0 end) sPesos
		from vencliheader cph
		inner join tipventModHeader tcmh
		on cph.tipocomprobante=tcmh.codigo
		where Cliente=pv.codigo),0)
	as Dolares ,
	domicilio,localidad,telefono1,telefono2
	from Clientes pv
	where 
	(
	(	(Select isnull(sum(totalimporte*Multiplicador),0)
				from vencliheader cph
				inner join BaseCrm..tipventModHeader tcmh
				on cph.tipocomprobante=tcmh.codigo
				where Cliente=pv.codigo )<>0  

	or

	(Select isnull(sum(ImporteOrigen*Multiplicador),0)
				from vencliheader cph
				inner join BaseCrm..tipventModHeader tcmh
				on cph.tipocomprobante=tcmh.codigo
				where Cliente=pv.codigo )<>0  

			
	)
		or	

		@Codigo<>0 
	)
	and (pv.codigo=@Codigo or @Codigo=0)
	ORDER BY RAZONSOCIAL



GO
/****** Object:  StoredProcedure [dbo].[SaldosClientesAbiertoOP]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE Procedure [dbo].[SaldosClientesAbiertoOP]
(
	@cliente	int=121089,
	@Desde		varchar(8)='20090701',
	@Hasta		varchar(8)='20091231'
)
as
(
SELECT 0 Modo,p.RazonSocial,p.codigo,p.domicilio,p.telefono1,
@Desde fecha, 'Apertura' AS TP, '' doc_c,'' as PV, '' as NCO,'' tipofactura, 
case when sum(totalImporte*Multiplicador)>=0 then sum(totalImporte*Multiplicador) else 0 end as Debe,
case when sum(totalImporte*Multiplicador)<0 then -sum(totalImporte*Multiplicador) else 0 end AS Haber, 
 0 AS SALDO,
0 cancelado, 
'' as Vencimiento, 
'' as serie,
0 idTransaccion, 
@cliente cliente, 0 signo, 0 idOperacion,0 as Asiento, 0 tipoasiento,'' fecha1venc,'' fecha2venc, 
case when sum(ImporteOrigen*Multiplicador*isnull(moneda,0))>=0 then Sum(ImporteOrigen*Multiplicador*isnull(moneda,0)) else 0 end as DebeDolares,
case when sum(ImporteOrigen*Multiplicador*isnull(moneda,0))<0 then -sum(ImporteOrigen*Multiplicador*isnull(moneda,0)) else 0 end AS HaberDolares, 
case when sum(totalImporte*Multiplicador*case when isnull(moneda,0)=0 then 1 else 0 end)>=0 then Sum(totalImporte*Multiplicador*case when isnull(moneda,0)=0 then 1 else 0 end) else 0 end as DebePesos,
case when sum(totalImporte*Multiplicador*case when isnull(moneda,0)=0 then 1 else 0 end)<0 then -sum(totalImporte*Multiplicador*case when isnull(moneda,0)=0 then 1 else 0 end) else 0 end AS HaberPesos, 
1,isnull(1,1) tc, 0 as MD, 0,0, '' letra
FROM vencliheader cph 
INNER JOIN TipVentModHeader ON cph.tipocomprobante = TipVentModHeader.codigo 
--inner join detalle_Operaciones do on do.idtransaccion=cph.idtransaccion
--inner join Header_Operaciones ho on do.idOperacion=ho.idOperacion
inner join clientes p on cph.cliente=p.codigo
						
		Where (cliente=@cliente or @cliente=0) and cph.fecha<@Desde
Group by p.RazonSocial,p.codigo,p.domicilio,p.telefono1
)
union
(
SELECT 1 Modo,p.RazonSocial,p.codigo,p.domicilio,p.telefono1,
cph.fecha, TipVentModHeader.comprobante AS TP, SUBSTRING(cast(cph.nrocomprobante as varchar(20)),5,8) doc_c,
case when cph.cancelado=cph.totalimporte then right(SUBSTRING(cast(cph.nrocomprobante as varchar(20)),5,8),3) else '' end as PV, 
SUBSTRING(cast(cph.nrocomprobante as varchar(20)),5,8) as NCO,
cph.tipofactura, 
case when multiplicador= 1 THEN cph.totalimporte ELSE 0 END
AS DEBE, 
case when multiplicador=-1 THEN cph.totalimporte ELSE 0 END as Haber, 0 AS SALDO,
isnull(cph.cancelado,0) cancelado, 
cph.fecha1venc as Vencimiento, 
0 as serie,
cph.idTransaccion, 
cph.cliente, TipVentModHeader.signo, ho.idOperacion,cph.Comprobante as Asiento, ho.tipoasiento,fecha1venc,fecha2venc, 
case when TipVentModHeader.Multiplicador=1 and Moneda=1 then importeOrigen else 0 end DolaresHaber,
case when TipVentModHeader.Multiplicador=-1 and moneda=1 then importeOrigen else 0 end DolaresDebe,
case when TipVentModHeader.Multiplicador=1 and Moneda=0 then totalImporte else 0 end PesosHaber,
case when TipVentModHeader.Multiplicador=-1 and moneda=0 then totalImporte else 0 end PesosDebe,
Moneda,isnull(tc,1) tc, 1 as MD, TipVentModHeader.Multiplicador,TipVentModHeader.Multiplicador, l.letra
FROM vencliheader cph 
INNER JOIN TipVentModHeader ON cph.tipocomprobante = TipVentModHeader.codigo 
inner join detalle_Operaciones do on do.idtransaccion=cph.idtransaccion
inner join Header_Operaciones ho on do.idOperacion=ho.idOperacion
inner join clientes p on cph.cliente=p.codigo
left join letras l on case when cph.cancelado=cph.totalimporte then right(SUBSTRING(cast(cph.nrocomprobante as varchar(20)),5,8),3) else '' end=l.id
Where idtipotransaccion=0 and TipVentModHeader.signo=1 and (cliente=@cliente or @cliente=0) and cph.fecha between @Desde and @Hasta
)
 Union
(
SELECT 1 Modo,p.razonSocial,p.codigo,p.domicilio,p.telefono1,
cph.fecha, TipVentModHeader.comprobante AS TP, 
cast(cph.nrocomprobante as varchar(20)) doc_c, 
right(ltrim(rtrim(SUBSTRING(isnull(cast(cph1.nrocomprobante as varchar(20)),cast(cph.nrocomprobante as varchar(20))),1,13))),3) as PV, 
SUBSTRING(isnull(cast(cph1.nrocomprobante as varchar(20)),cast(cph.nrocomprobante as varchar(20))),5,8) as NCO,
cph.tipofactura, 
case when isnull(t1.Multiplicador,TipVentModHeader.Multiplicador*-1)=-1  then isnull(acp.importe,cph.totalimporte) else 0 end Debe,
case when isnull(t1.Multiplicador,TipVentModHeader.Multiplicador*-1)=1  then isnull(acp.importe,cph.totalimporte) else 0 end Haber,
0 AS SALDO,
isnull(acp.importe,cph.totalimporte) cancelado, 
cph.fecha1venc as Vencimiento,  
0 as serie,
cph.idTransaccion, 
cph.cliente,TipVentModHeader.signo, ho.idOperacion,cph.Comprobante as Asiento, ho.tipoasiento,cph.fecha1venc,cph.fecha2venc,
case when isnull(t1.Multiplicador,TipVentModHeader.Multiplicador*-1)=-1 and cph.Moneda=1 then isnull(acp.importeorigen,cph.importeOrigen) else 0 end DolaresDebe,
case when isnull(t1.Multiplicador,TipVentModHeader.Multiplicador*-1)=1 and cph.moneda=1 then isnull(acp.importeorigen,cph.importeOrigen) else 0 end DolaresHaber,
case when isnull(t1.Multiplicador,TipVentModHeader.Multiplicador*-1)=-1 and cph.Moneda=0 then isnull(acp.importe,cph.totalimporte) else 0 end PesosDebe,
case when isnull(t1.Multiplicador,TipVentModHeader.Multiplicador*-1)=1 and cph.moneda=0 then isnull(acp.importe,cph.totalimporte) else 0 end PesosHaber,
cph.Moneda,isnull(cph.tc,1) tc, 2 as MD, t1.Multiplicador, TipVentModHeader.Multiplicador, l.letra
FROM vencliheader cph INNER JOIN TipVentModHeader ON cph.tipocomprobante = TipVentModHeader.codigo 
inner join detalle_Operaciones do on do.idtransaccion=cph.idtransaccion
inner join Header_Operaciones ho on do.idOperacion=ho.idOperacion
left join aplicacionesCuentasaCobrar acp on acp.idtransaccion=do.idtransaccion
left join vencliheader cph1 on acp.idtransaccioncancelada=cph1.idtransaccion
Left JOIN TipVentModHeader T1 ON cph1.tipocomprobante = T1.codigo 
inner join clientes p on cph.cliente=p.codigo
left join letras l on l.id=right(ltrim(rtrim(SUBSTRING(isnull(cast(cph1.nrocomprobante as varchar(20)),cast(cph.nrocomprobante as varchar(20))),1,13))),3)
		Where idtipotransaccion=0 and TipVentModHeader.signo=2 and (cph.cliente=@cliente or @cliente=0) and cph.fecha between @Desde and @Hasta
)
union
(
SELECT 1 Modo,p.razonSocial,p.codigo,p.domicilio,p.telefono1,
vch.fecha, TipVentModHeader.comprobante AS TP, cast(vch.nrocomprobante as varchar(20)) doc_c, 
right(ltrim(rtrim(SUBSTRING(cast(vch.nrocomprobante as varchar(20)),3,8))),3) as PV, 
SUBSTRING(cast(vch.nrocomprobante as varchar(20)),1,8) as NCO,
vch.tipofactura, 
0 Debe,
vch.totalimporte-sum(acp.importe*t1.multiplicador) Haber,
0 AS SALDO,
0 cancelado, 
vch.fecha1venc as Vencimiento,  
0 as serie,
vch.idTransaccion, 
vch.cliente,TipVentModHeader.signo, 0 idOperacion,vch.Comprobante, 0 tipoasiento,vch.fecha1venc,vch.fecha2venc,
0 DolaresDebe,
vch.importeOrigen-sum(acp.importeOrigen*t1.multiplicador) DolaresHaber,
0 PesosDebe,
vch.totalimporte-sum(acp.importe*t1.multiplicador) PesosHaber, 
vch.Moneda,isnull(vch.tc,1) tc, 2 as MD, 0 Multiplicador, TipVentModHeader.Multiplicador , l.letra--vch.totalimporte

FROM vencliheader vch
INNER JOIN TipVentModHeader ON vch.tipocomprobante = TipVentModHeader.codigo 
/*inner join detalle_Operaciones do on do.idtransaccion=vch.idtransaccion
inner join Header_Operaciones ho on do.idOperacion=ho.idOperacion */
inner join aplicacionesCuentasaCobrar acp on acp.idtransaccion=vch.idtransaccion
inner join vencliheader vch1 on acp.idtransaccioncancelada=vch1.idtransaccion
inner JOIN TipVentModHeader T1 ON vch1.tipocomprobante = T1.codigo 
inner join clientes p on vch.cliente=p.codigo
left join letras l on right(ltrim(rtrim(SUBSTRING(cast(vch.nrocomprobante as varchar(20)),3,8))),3)=id
Where TipVentModHeader.signo=2 and (vch.cliente=@cliente or @cliente=0) and vch.fecha between @Desde and @Hasta
Group by vch.idtransaccion, vch.totalimporte,vch.importeOrigen,TipVentModHeader.Multiplicador,
p.razonSocial,p.codigo,p.domicilio,p.telefono1,
vch.fecha, TipVentModHeader.comprobante,cast(vch.nrocomprobante as varchar(20)),
SUBSTRING(cast(vch.nrocomprobante as varchar(20)),1,4), 
SUBSTRING(cast(vch.nrocomprobante as varchar(20)),5,8),
vch.tipofactura, vch.fecha1venc,
vch.idTransaccion, 
vch.cliente,TipVentModHeader.signo,vch.Comprobante,vch.fecha1venc,vch.fecha2venc,vch.moneda,vch.tc, l.letra
having vch.totalimporte<>sum(acp.importe*t1.multiplicador) or vch.importeOrigen<>sum(acp.importeOrigen*t1.multiplicador)
)
Order by cph.fecha,pv 





GO
/****** Object:  StoredProcedure [dbo].[SaldosClientesAbiertoOPPendiente]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE Procedure [dbo].[SaldosClientesAbiertoOPPendiente]
(
	@cliente	int=121509,
	@Desde		varchar(8)='20090701',
	@Hasta		varchar(8)='20100630'
)
as
(
SELECT 0 Modo,p.RazonSocial,p.codigo,p.domicilio,p.telefono1,
@Desde fecha, 'Apertura' AS TP, '' doc_c,'' as PV, 
'0' as NCO,
'' tipofactura, 
case when sum((totalImporte-isnull(cph.cancelado,0))*Multiplicador)<0 then -sum((totalImporte-isnull(cph.cancelado,0))*Multiplicador) else 0 end AS DEBE, 
case when sum((totalImporte-isnull(cph.cancelado,0))*Multiplicador)>=0 then sum((totalImporte-isnull(cph.cancelado,0))*Multiplicador) else 0 end as Haber, 0 AS SALDO,
0 cancelado, 
'' as Vencimiento, 
'' as serie,
0 idTransaccion, 
@cliente cliente, 0 signo, 0 idOperacion,0 as Asiento, 0 tipoasiento,'' fecha1venc,'' fecha2venc, 
case when sum((ImporteOrigen-isnull(cph.canceladoOrigen,0))*Multiplicador*isnull(moneda,0))<0 then -sum((ImporteOrigen-isnull(cph.canceladoOrigen,0))*Multiplicador*isnull(moneda,0)) else 0 end AS DEBEDolares, 
case when sum((ImporteOrigen-isnull(cph.canceladoOrigen,0))*Multiplicador*isnull(moneda,0))>=0 then Sum((ImporteOrigen-isnull(cph.canceladoOrigen,0))*Multiplicador*isnull(moneda,0)) else 0 end as HaberDolares,
case when sum((totalImporte-isnull(cph.cancelado,0))*Multiplicador*case when isnull(moneda,0)=0 then 1 else 0 end)<0 then -sum((totalImporte-isnull(cph.cancelado,0))*Multiplicador*case when isnull(moneda,0)=0 then 1 else 0 end) else 0 end AS DEBEPesos, 
case when sum((totalImporte-isnull(cph.cancelado,0))*Multiplicador*case when isnull(moneda,0)=0 then 1 else 0 end)>=0 then Sum((totalImporte-isnull(cph.cancelado,0))*Multiplicador*case when isnull(moneda,0)=0 then 1 else 0 end) else 0 end as HaberPesos,
1,isnull(1,1) tc
FROM vencliheader cph 
INNER JOIN TipVentModHeader ON cph.tipocomprobante = TipVentModHeader.codigo 
inner join detalle_Operaciones do on do.idtransaccion=cph.idtransaccion
inner join Header_Operaciones ho on do.idOperacion=ho.idOperacion
inner join clientes p on cph.cliente=p.codigo
						
		Where idtipotransaccion=0 and (cliente=@cliente or @cliente=0) and cph.fecha<@Desde
and (round(cph.totalImporte-isnull(cph.cancelado,0)+isnull(cph.ImporteOrigen,0)-isnull(cph.canceladoOrigen,0),2)<>0)

Group by p.RazonSocial,p.codigo,p.domicilio,p.telefono1
)
union
(
SELECT 1 Modo,p.RazonSocial,p.codigo,p.domicilio,p.telefono1,
cph.fecha, TipVentModHeader.comprobante AS TP, '' doc_c,SUBSTRING(cph.nrocomprobante,1,4) as PV, 
SUBSTRING(cph.nrocomprobante,5,8) as NCO,
cph.tipofactura, 
0 AS DEBE, (cph.totalImporte-isnull(cph.cancelado,0)) as Haber, 0 AS SALDO,
isnull(cph.cancelado,0) cancelado, 
cph.fecha1venc as Vencimiento, 
'' as serie,
cph.idTransaccion, 
cph.cliente, TipVentModHeader.signo, ho.idOperacion,cph.Comprobante as Asiento, ho.tipoasiento,fecha1venc,fecha2venc, 
case when TipVentModHeader.Multiplicador=1 and Moneda=1 then (ImporteOrigen-isnull(cph.canceladoOrigen,0)) else 0 end DolaresDebe,
case when TipVentModHeader.Multiplicador=-1 and moneda=1 then (ImporteOrigen-isnull(cph.canceladoOrigen,0)) else 0 end DolaresHaber,
case when TipVentModHeader.Multiplicador=1 and Moneda=0 then (totalImporte-isnull(cph.cancelado,0)) else 0 end PesosDebe,
case when TipVentModHeader.Multiplicador=-1 and moneda=0 then (totalImporte-isnull(cph.cancelado,0)) else 0 end PesosHaber,
Moneda,isnull(tc,1) tc
FROM vencliheader cph 
INNER JOIN TipVentModHeader ON cph.tipocomprobante = TipVentModHeader.codigo 
inner join detalle_Operaciones do on do.idtransaccion=cph.idtransaccion
inner join Header_Operaciones ho on do.idOperacion=ho.idOperacion
inner join clientes p on cph.cliente=p.codigo

Where idtipotransaccion=0 and TipVentModHeader.signo=2 and (cliente=@cliente or @cliente=0) and cph.fecha between @Desde and @Hasta
and (round(cph.totalImporte-isnull(cph.cancelado,0)+isnull(cph.ImporteOrigen,0)-isnull(cph.canceladoOrigen,0),2)<>0)
)
 Union
(
SELECT 1 Modo,p.razonSocial,p.codigo,p.domicilio,p.telefono1,
cph.fecha, TipVentModHeader.comprobante AS TP, cph.nrocomprobante doc_c, SUBSTRING(cph.nrocomprobante,1,4) as PV, 
SUBSTRING(isnull(cph1.nrocomprobante,cph.nrocomprobante),1,8) as NCO,
cph.tipofactura, isnull(acp.importe,(cph.totalImporte-isnull(cph.cancelado,0))) as Debe, 0 as Haber, 
0 AS SALDO,
isnull(acp.importe,(cph.totalImporte-isnull(cph.cancelado,0))) cancelado, 
cph.fecha1venc as Vencimiento,  
0 as serie,
cph.idTransaccion, 
cph.cliente,TipVentModHeader.signo, ho.idOperacion,cph.Comprobante as Asiento, ho.tipoasiento,cph.fecha1venc,cph.fecha2venc,
case when isnull(t1.multiplicador*-1,TipVentModHeader.Multiplicador)=1 and cph.Moneda=1 then isnull((cph.ImporteOrigen-isnull(cph.canceladoOrigen,0)),(cph.ImporteOrigen-isnull(cph.canceladoOrigen,0))) else 0 end DolaresHaber,
case when isnull(t1.multiplicador*-1,TipVentModHeader.Multiplicador)=-1 and cph.moneda=1 then isnull((cph.ImporteOrigen-isnull(cph.canceladoOrigen,0)),(cph.ImporteOrigen-isnull(cph.canceladoOrigen,0))) else 0 end DolaresDebe,
case when isnull(t1.multiplicador*-1,TipVentModHeader.Multiplicador)=1 and cph.Moneda=0 then isnull(acp.importe,(cph.totalImporte-isnull(cph.cancelado,0))) else 0 end PesosHaber,
case when isnull(t1.multiplicador*-1,TipVentModHeader.Multiplicador)=-1 and cph.moneda=0 then isnull(acp.importe,(cph.totalImporte-isnull(cph.cancelado,0))) else 0 end PesosDebe,
cph.Moneda,isnull(cph.tc,1) tc 
FROM vencliheader cph 
INNER JOIN TipVentModHeader ON cph.tipocomprobante = TipVentModHeader.codigo 
inner join detalle_Operaciones do on do.idtransaccion=cph.idtransaccion
inner join Header_Operaciones ho on do.idOperacion=ho.idOperacion
left join aplicacionesCuentasaCobrar acp on acp.idtransaccion=do.idtransaccion
left join vencliheader cph1 on acp.idtransaccioncancelada=cph1.idtransaccion
left JOIN TipVentModHeader t1 ON cph1.tipocomprobante = t1.codigo 
inner join clientes p on cph.cliente=p.codigo
		Where idtipotransaccion=0 and TipVentModHeader.signo=1 and (cph.cliente=@cliente or @cliente=0) and cph.fecha between @Desde and @Hasta
and (round(cph.totalImporte-isnull(cph.cancelado,0)+isnull(cph.ImporteOrigen,0)-isnull(cph.canceladoOrigen,0),2)<>0)
)
Order by cph.fecha,pv 



GO
/****** Object:  StoredProcedure [dbo].[SaldosProveedores]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE   Procedure [dbo].[SaldosProveedores]
(
	@FechaInicio	char(8)='20050101',
	@FechaCierre	char(8)='20051231',
	@Modo		char(1)='M',
	@CliPro		char(1)='P'

 -- S olo Saldos M Inicio + Movimientos

)
as
if @Clipro='P'
	SELECT cast(@FechaInicio as datetime) Fecha,'Saldo Apertura' Detalle,
	A01.proveedor, A02.razonsocial,'0' NroComprobante,
	Case when Sum(A01.totalimporte*multiplicador)<0 then 
		-Sum(A01.totalimporte*multiplicador)else 0 end Debe,
	Case when Sum(A01.totalimporte*multiplicador)>0 then 
		Sum(A01.totalimporte*multiplicador) else 0 end Haber,
	Sum(A01.totalimporte*multiplicador) as Saldo,-1,domicilio,localidad,telefono1,telefono2
	FROM CompProvHeader A01
	INNER JOIN Proveedores A02      
	ON A01.Proveedor = A02.codigo
	INNER JOIN TIPCOMPMODHEADER tcm
	on A01.tipoComprobante=tcm.codigo
	WHERE A01.Fecha <= case when @Modo='S' then @FechaCierre else @FechaInicio end and estado not in ('F')
	GROUP BY A01.proveedor, A02.razonsocial,domicilio,localidad,telefono1,telefono2
	Having
	Sum(A01.totalimporte*multiplicador)<>0
	Union
	SELECT A01.Fecha Fecha,tcm.Descripcion,
	A01.proveedor, A02.razonsocial,NroComprobante,
	Case when A01.totalimporte*multiplicador<0 then 
		-(A01.totalimporte*multiplicador) else 0 end Debe,
	Case when (A01.totalimporte*multiplicador)>0 then 
		(A01.totalimporte*multiplicador) else 0 end Haber,
	A01.totalimporte*multiplicador as Saldo,idtransaccion,domicilio,localidad,telefono1,telefono2
	FROM CompProvHeader A01
	INNER JOIN Proveedores A02      
	ON A01.Proveedor = A02.codigo
	INNER JOIN TIPCOMPMODHEADER tcm
	on A01.tipoComprobante=tcm.codigo
	WHERE A01.Fecha Between cast(@FechaInicio as datetime)+1 and cast(@FechaCierre as datetime)
	and @Modo='M' and estado not in ('F')
	order by a01.Proveedor,Fecha
else
	SELECT cast(@FechaInicio as datetime) Fecha,'Saldo Apertura' Detalle,
	A01.Cliente proveedor, A02.razonsocial,'0' NroComprobante,
	Case when Sum(A01.totalimporte*multiplicador)<0 then 
		-Sum(A01.totalimporte*multiplicador)else 0 end Debe,
	Case when Sum(A01.totalimporte*multiplicador)>0 then 
		Sum(A01.totalimporte*multiplicador) else 0 end Haber,
	Sum(A01.totalimporte*multiplicador) as Saldo,-1,domicilio,localidad,telefono1,telefono2
	FROM VencliHeader A01
	INNER JOIN Clientes A02      
	ON A01.Cliente = A02.codigo
	INNER JOIN TIPVentMODHEADER tcm
	on A01.tipoComprobante=tcm.codigo
	WHERE A01.Fecha <= case when @Modo='S' then @FechaCierre else @FechaInicio end
	GROUP BY A01.Cliente, A02.razonsocial,domicilio,localidad,telefono1,telefono2
	Having
	Sum(A01.totalimporte*multiplicador)<>0
	Union
	SELECT A01.Fecha Fecha,tcm.Descripcion,
	A01.Cliente, A02.razonsocial,NroComprobante,
	Case when A01.totalimporte*multiplicador<0 then 
		-(A01.totalimporte*multiplicador) else 0 end Debe,
	Case when (A01.totalimporte*multiplicador)>0 then 
		(A01.totalimporte*multiplicador) else 0 end Haber,
	A01.totalimporte*multiplicador as Saldo,idtransaccion,domicilio,localidad,telefono1,telefono2
	FROM VenCliHeader A01
	INNER JOIN Clientes A02      
	ON A01.Cliente = A02.codigo
	INNER JOIN TIPVentMODHEADER tcm
	on A01.tipoComprobante=tcm.codigo
	WHERE A01.Fecha Between cast(@FechaInicio as datetime)+1 and cast(@FechaCierre as datetime)
	and @Modo='M'
	order by a01.Cliente,Fecha










GO
/****** Object:  StoredProcedure [dbo].[SaldosProveedoresAbiertoOP]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE Procedure [dbo].[SaldosProveedoresAbiertoOP]
(
	@Proveedor	int=211012,
	@Desde		varchar(8)='19000701',
	@Hasta		varchar(8)='20090630'
)
as
(
SELECT 0 Modo,p.RazonSocial,p.codigo,p.domicilio,p.telefono1,
@Desde fecha, 'Apertura' AS TP, '0' doc_c,'0' as PV, '' as NCO,'' tipofactura, 
case when sum(totalImporte*Multiplicador)>=0 then sum(totalImporte*Multiplicador) else 0 end as Debe,
case when sum(totalImporte*Multiplicador)<0 then -sum(totalImporte*Multiplicador) else 0 end AS Haber, 
 0 AS SALDO,
0 cancelado, 
'' as Vencimiento, 
'' as serie,
0 idTransaccion, 
@Proveedor proveedor, 0 signo, 0 idOperacion,0 as Asiento, 0 tipoasiento,'' fecha1venc,'' fecha2venc, 
case when sum(ImporteOrigen*Multiplicador*isnull(moneda,0))>=0 then Sum(ImporteOrigen*Multiplicador*isnull(moneda,0)) else 0 end as DebeDolares,
case when sum(ImporteOrigen*Multiplicador*isnull(moneda,0))<0 then -sum(ImporteOrigen*Multiplicador*isnull(moneda,0)) else 0 end AS HaberDolares, 
case when sum(totalImporte*Multiplicador*case when isnull(moneda,0)=0 then 1 else 0 end)>=0 then Sum(totalImporte*Multiplicador*case when isnull(moneda,0)=0 then 1 else 0 end) else 0 end as DebePesos,
case when sum(totalImporte*Multiplicador*case when isnull(moneda,0)=0 then 1 else 0 end)<0 then -sum(totalImporte*Multiplicador*case when isnull(moneda,0)=0 then 1 else 0 end) else 0 end AS HaberPesos, 
1,isnull(1,1) tc, 0 as MD, 0,0, '' letra
--into tempaplica
FROM CompProvHeader cph 
INNER JOIN TipCompModHeader ON cph.tipocomprobante = TipCompModHeader.codigo 
--inner join detalle_Operaciones do on do.idtransaccion=cph.idtransaccion
--inner join Header_Operaciones ho on do.idOperacion=ho.idOperacion
inner join proveedores p on cph.proveedor=p.codigo
						
		Where (proveedor=@Proveedor or @Proveedor=0) and p.codigo between 211001 and 212999 and estado not in ('F','Z') and cph.fecha<@Desde
Group by p.RazonSocial,p.codigo,p.domicilio,p.telefono1
)
union
(
SELECT 1 Modo,p.RazonSocial,p.codigo,p.domicilio,p.telefono1,
cph.fecha, TipCompModHeader.comprobante AS TP, SUBSTRING(cast(cph.nrocomprobante as varchar(20)),5,8) doc_c,
case when cph.cancelado=cph.totalimporte then right(SUBSTRING(cast(cph.nrocomprobante as varchar(20)),5,8),3) else '' end as PV, 
SUBSTRING(cast(cph.nrocomprobante as varchar(20)),5,8) as NCO,
cph.tipofactura, 
case when multiplicador= 1 THEN cph.totalimporte ELSE 0 END
AS DEBE, 
case when multiplicador=-1 THEN cph.totalimporte ELSE 0 END as Haber, 0 AS SALDO,
isnull(cph.cancelado,0) cancelado, 
cph.fecha1venc as Vencimiento, 
0 as serie,
cph.idTransaccion, 
cph.proveedor, TipCompModHeader.signo, ho.idOperacion,cph.Comprobante as Asiento, ho.tipoasiento,fecha1venc,fecha2venc, 
case when TipCompModHeader.Multiplicador=1 and Moneda=1 then importeOrigen else 0 end DolaresHaber,
case when TipCompModHeader.Multiplicador=-1 and moneda=1 then importeOrigen else 0 end DolaresDebe,
case when TipCompModHeader.Multiplicador=1 and Moneda=0 then totalImporte else 0 end PesosHaber,
case when TipCompModHeader.Multiplicador=-1 and moneda=0 then totalImporte else 0 end PesosDebe,
Moneda,isnull(tc,1) tc, 1 as MD, TipCompModHeader.Multiplicador,TipCompModHeader.Multiplicador, l.letra
FROM CompProvHeader cph 
INNER JOIN TipCompModHeader ON cph.tipocomprobante = TipCompModHeader.codigo 
inner join detalle_Operaciones do on do.idtransaccion=cph.idtransaccion
inner join Header_Operaciones ho on do.idOperacion=ho.idOperacion
inner join proveedores p on cph.proveedor=p.codigo
left join letras l on case when cph.cancelado=cph.totalimporte then right(SUBSTRING(cast(cph.nrocomprobante as varchar(20)),5,8),3) else '' end=l.id
Where idtipotransaccion=1 and TipCompModHeader.signo=2 and (proveedor=@Proveedor or @Proveedor=0) 
and p.codigo between 211001 and 212999 and estado not in ('F','Z') and cph.fecha between @Desde and @Hasta
)
 Union
(
SELECT 1 Modo,p.razonSocial,p.codigo,p.domicilio,p.telefono1,
cph.fecha, TipCompModHeader.comprobante AS TP, 
cast(cph.nrocomprobante as varchar(20)) doc_c, 
right(ltrim(rtrim(SUBSTRING(isnull(cast(cph1.nrocomprobante as varchar(20)),cast(cph.nrocomprobante as varchar(20))),1,13))),3) as PV, 
SUBSTRING(isnull(cast(cph1.nrocomprobante as varchar(20)),cast(cph.nrocomprobante as varchar(20))),5,8) as NCO,
cph.tipofactura, 
case when isnull(t1.Multiplicador,TipCompModHeader.Multiplicador*-1)=-1  then isnull(acp.importe,cph.totalimporte) else 0 end Debe,
case when isnull(t1.Multiplicador,TipCompModHeader.Multiplicador*-1)=1  then isnull(acp.importe,cph.totalimporte) else 0 end Haber,
0 AS SALDO,
isnull(acp.importe,cph.totalimporte) cancelado, 
cph.fecha1venc as Vencimiento,  
0 as serie,
cph.idTransaccion, 
cph.proveedor,TipCompModHeader.signo, ho.idOperacion,cph.Comprobante as Asiento, ho.tipoasiento,cph.fecha1venc,cph.fecha2venc,
case when isnull(t1.Multiplicador,TipCompModHeader.Multiplicador*-1)=-1 and cph.Moneda=1 then isnull(acp.importeorigen,cph.importeOrigen) else 0 end DolaresDebe,
case when isnull(t1.Multiplicador,TipCompModHeader.Multiplicador*-1)=1 and cph.moneda=1 then isnull(acp.importeorigen,cph.importeOrigen) else 0 end DolaresHaber,
case when isnull(t1.Multiplicador,TipCompModHeader.Multiplicador*-1)=-1 and cph.Moneda=0 then isnull(acp.importe,cph.totalimporte) else 0 end PesosDebe,
case when isnull(t1.Multiplicador,TipCompModHeader.Multiplicador*-1)=1 and cph.moneda=0 then isnull(acp.importe,cph.totalimporte) else 0 end PesosHaber,
cph.Moneda,isnull(cph.tc,1) tc, 2 as MD, t1.Multiplicador, TipCompModHeader.Multiplicador, l.letra
FROM CompProvHeader cph INNER JOIN TipCompModHeader ON cph.tipocomprobante = TipCompModHeader.codigo 
inner join detalle_Operaciones do on do.idtransaccion=cph.idtransaccion
inner join Header_Operaciones ho on do.idOperacion=ho.idOperacion
left join aplicacionesCuentasaPagar acp on acp.idtransaccion=do.idtransaccion
left join CompProvHeader cph1 on acp.idtransaccioncancelada=cph1.idtransaccion
Left JOIN TipCompModHeader T1 ON cph1.tipocomprobante = T1.codigo 
inner join proveedores p on cph.proveedor=p.codigo
left join letras l on l.id=right(ltrim(rtrim(SUBSTRING(isnull(cast(cph1.nrocomprobante as varchar(20)),cast(cph.nrocomprobante as varchar(20))),1,13))),3)
Where idtipotransaccion=1 and TipCompModHeader.signo=1  and p.codigo between 211001 and 212999 and (cph.proveedor=@Proveedor or @Proveedor=0) and cph.fecha between @Desde and @Hasta
)
union
(
SELECT 1 Modo,p.razonSocial,p.codigo,p.domicilio,p.telefono1,
vch.fecha, TipCompModHeader.comprobante AS TP, cast(vch.nrocomprobante as varchar(20)) doc_c, 
right(ltrim(rtrim(SUBSTRING(cast(vch.nrocomprobante as varchar(20)),3,8))),3) as PV, 
SUBSTRING(cast(vch.nrocomprobante as varchar(20)),1,8) as NCO,
vch.tipofactura, 
0 Debe,
vch.totalimporte-sum(acp.importe*t1.multiplicador) Haber,
0 AS SALDO,
0 cancelado, 
vch.fecha1venc as Vencimiento,  
0 as serie,
vch.idTransaccion, 
vch.proveedor,TipCompModHeader.signo, 0 idOperacion,vch.Comprobante, 0 tipoasiento,vch.fecha1venc,vch.fecha2venc,
0 DolaresDebe,
vch.importeOrigen-sum(acp.importeOrigen*t1.multiplicador) DolaresHaber,
0 PesosDebe,
vch.totalimporte-sum(acp.importe*t1.multiplicador) PesosHaber, 
vch.Moneda,isnull(vch.tc,1) tc, 2 as MD, 0 Multiplicador, TipCompModHeader.Multiplicador , l.letra--vch.totalimporte

FROM CompProvHeader vch
INNER JOIN TipCompModHeader ON vch.tipocomprobante = TipCompModHeader.codigo 
/*inner join detalle_Operaciones do on do.idtransaccion=vch.idtransaccion
inner join Header_Operaciones ho on do.idOperacion=ho.idOperacion */
inner join aplicacionesCuentasaPagar acp on acp.idtransaccion=vch.idtransaccion
inner join CompProvHeader vch1 on acp.idtransaccioncancelada=vch1.idtransaccion
inner JOIN TipCompModHeader T1 ON vch1.tipocomprobante = T1.codigo 
inner join proveedores p on vch.proveedor=p.codigo
left join letras l on right(ltrim(rtrim(SUBSTRING(cast(vch.nrocomprobante as varchar(20)),3,8))),3)=id
Where TipCompModHeader.signo=2  and p.codigo between 211001 and 212999 and (vch.proveedor=@Proveedor or @Proveedor=0) and vch.fecha between @Desde and @Hasta
Group by vch.idtransaccion, vch.totalimporte,vch.importeOrigen,TipCompModHeader.Multiplicador,
p.razonSocial,p.codigo,p.domicilio,p.telefono1,
vch.fecha, TipCompModHeader.comprobante,cast(vch.nrocomprobante as varchar(20)),
SUBSTRING(cast(vch.nrocomprobante as varchar(20)),1,4), 
SUBSTRING(cast(vch.nrocomprobante as varchar(20)),5,8),
vch.tipofactura, vch.fecha1venc,
vch.idTransaccion, 
vch.proveedor,TipCompModHeader.signo,vch.Comprobante,vch.fecha1venc,vch.fecha2venc,vch.moneda,vch.tc, l.letra
having vch.totalimporte<>sum(acp.importe*t1.multiplicador) or vch.importeOrigen<>sum(acp.importeOrigen*t1.multiplicador)
)
Order by cph.proveedor,letra,cph.fecha,pv 











GO
/****** Object:  StoredProcedure [dbo].[SaldosProveedoresAbiertoOPPendiente]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[SaldosProveedoresAbiertoOPPendiente]
(
	@proveedor	int=0,
	@Desde		varchar(8)='20090601',
	@Hasta		varchar(8)='20090930'
)
as
(
SELECT 0 Modo,p.RazonSocial,p.codigo,p.domicilio,p.telefono1,
@Desde fecha, 'Apertura' AS TP, '' doc_c,0 as PV, 
'' as NCO,
'' tipofactura, 
case when sum((totalImporte-isnull(cph.cancelado,0))*Multiplicador)<0 then -sum((totalImporte-isnull(cph.cancelado,0))*Multiplicador) else 0 end AS DEBE, 
case when sum((totalImporte-isnull(cph.cancelado,0))*Multiplicador)>=0 then sum((totalImporte-isnull(cph.cancelado,0))*Multiplicador) else 0 end as Haber, 0 AS SALDO,
0 cancelado, 
'' as Vencimiento, 
'' as serie,
0 idTransaccion, 
@proveedor cliente, 0 signo, 0 idOperacion,0 as Asiento, 0 tipoasiento,'' fecha1venc,'' fecha2venc, 
case when sum((ImporteOrigen-isnull(cph.canceladoOrigen,0))*Multiplicador*isnull(moneda,0))<0 then -sum((ImporteOrigen-isnull(cph.canceladoOrigen,0))*Multiplicador*isnull(moneda,0)) else 0 end AS DEBEDolares, 
case when sum((ImporteOrigen-isnull(cph.canceladoOrigen,0))*Multiplicador*isnull(moneda,0))>=0 then Sum((ImporteOrigen-isnull(cph.canceladoOrigen,0))*Multiplicador*isnull(moneda,0)) else 0 end as HaberDolares,
case when sum((totalImporte-isnull(cph.cancelado,0))*Multiplicador*case when isnull(moneda,0)=0 then 1 else 0 end)<0 then -sum((totalImporte-isnull(cph.cancelado,0))*Multiplicador*case when isnull(moneda,0)=0 then 1 else 0 end) else 0 end AS DEBEPesos, 
case when sum((totalImporte-isnull(cph.cancelado,0))*Multiplicador*case when isnull(moneda,0)=0 then 1 else 0 end)>=0 then Sum((totalImporte-isnull(cph.cancelado,0))*Multiplicador*case when isnull(moneda,0)=0 then 1 else 0 end) else 0 end as HaberPesos,
1,isnull(1,1) tc
FROM CompProvheader cph 
INNER JOIN TipCompModHeader ON cph.tipocomprobante = TipCompModHeader.codigo 
inner join detalle_Operaciones do on do.idtransaccion=cph.idtransaccion
inner join Header_Operaciones ho on do.idOperacion=ho.idOperacion
inner join proveedores p on cph.proveedor=p.codigo
						
		Where idtipotransaccion=1 and (proveedor=@proveedor or @proveedor=0) and estado not in ('F') and cph.fecha<@Desde
and (round(cph.totalImporte-isnull(cph.cancelado,0)+isnull(cph.ImporteOrigen,0)-isnull(cph.canceladoOrigen,0),2)<>0)
and cph.proveedor>210999
Group by p.RazonSocial,p.codigo,p.domicilio,p.telefono1

)
union
(
SELECT 1 Modo,p.RazonSocial,p.codigo,p.domicilio,p.telefono1,
cph.fecha, TipCompModHeader.comprobante AS TP, '' doc_c,SUBSTRING(cph.nrocomprobante,1,4) as PV, 
SUBSTRING(cph.nrocomprobante,5,8) as NCO,
cph.tipofactura, 
0 AS DEBE, (cph.totalImporte-isnull(cph.cancelado,0)) as Haber, 0 AS SALDO,
isnull(cph.cancelado,0) cancelado, 
cph.fecha1venc as Vencimiento, 
'' as serie,
cph.idTransaccion, 
cph.proveedor, TipCompModHeader.signo, ho.idOperacion,cph.Comprobante as Asiento, ho.tipoasiento,fecha1venc,fecha2venc, 
case when TipCompModHeader.Multiplicador=-1 and moneda=1 then (ImporteOrigen-isnull(cph.canceladoOrigen,0)) else 0 end DolaresDebe,
case when TipCompModHeader.Multiplicador=1 and Moneda=1 then (ImporteOrigen-isnull(cph.canceladoOrigen,0)) else 0 end DolaresHaber,
case when TipCompModHeader.Multiplicador=-1 and moneda=0 then (totalImporte-isnull(cph.cancelado,0)) else 0 end PesosDebe,
case when TipCompModHeader.Multiplicador=1 and Moneda=0 then (totalImporte-isnull(cph.cancelado,0)) else 0 end PesosHaber,
Moneda,isnull(tc,1) tc
FROM CompProvheader cph 
INNER JOIN TipCompModHeader ON cph.tipocomprobante = TipCompModHeader.codigo 
inner join detalle_Operaciones do on do.idtransaccion=cph.idtransaccion
inner join Header_Operaciones ho on do.idOperacion=ho.idOperacion
inner join proveedores p on cph.proveedor=p.codigo
Where idtipotransaccion=1 and TipCompModHeader.signo=2 and (proveedor=@proveedor or @proveedor=0) and estado not in ('F') and cph.fecha between @Desde and @Hasta
and (round(cph.totalImporte-isnull(cph.cancelado,0)+isnull(cph.ImporteOrigen,0)-isnull(cph.canceladoOrigen,0),2)<>0)
and cph.proveedor>210999
)
 Union
(
SELECT 1 Modo,p.razonSocial,p.codigo,p.domicilio,p.telefono1,
cph.fecha, TipCompModHeader.comprobante AS TP, cph.nrocomprobante doc_c, SUBSTRING(cph.nrocomprobante,1,4) as PV, 
SUBSTRING(isnull(cph1.nrocomprobante,cph.nrocomprobante),5,8) as NCO,
cph.tipofactura, isnull(acp.importe,(cph.totalImporte-isnull(cph.cancelado,0))) as Debe, 0 as Haber, 
0 AS SALDO,
isnull(acp.importe,(cph.totalImporte-isnull(cph.cancelado,0))) cancelado, 
cph.fecha1venc as Vencimiento,  
'' as serie,
cph.idTransaccion, 
cph.proveedor,TipCompModHeader.signo, ho.idOperacion,cph.Comprobante as Asiento, ho.tipoasiento,cph.fecha1venc,cph.fecha2venc,
case when TipCompModHeader.Multiplicador=-1 and cph.moneda=1 then isnull((cph.ImporteOrigen-isnull(cph.canceladoOrigen,0)),(cph.ImporteOrigen-isnull(cph.canceladoOrigen,0))) else 0 end DolaresDebe,
case when TipCompModHeader.Multiplicador=1 and cph.Moneda=1 then isnull((cph.ImporteOrigen-isnull(cph.canceladoOrigen,0)),(cph.ImporteOrigen-isnull(cph.canceladoOrigen,0))) else 0 end DolaresHaber,
case when TipCompModHeader.Multiplicador=-1 and cph.moneda=0 then isnull(acp.importe,(cph.totalImporte-isnull(cph.cancelado,0))) else 0 end PesosDebe,
case when TipCompModHeader.Multiplicador=1 and cph.Moneda=0 then isnull(acp.importe,(cph.totalImporte-isnull(cph.cancelado,0))) else 0 end PesosHaber,
cph.Moneda,isnull(cph.tc,1) tc 
FROM CompProvheader cph INNER JOIN TipCompModHeader ON cph.tipocomprobante = TipCompModHeader.codigo 
inner join detalle_Operaciones do on do.idtransaccion=cph.idtransaccion
inner join Header_Operaciones ho on do.idOperacion=ho.idOperacion
left join aplicacionesCuentasapagar acp on acp.idtransaccion=do.idtransaccion
left join CompProvheader cph1 on acp.idtransaccioncancelada=cph1.idtransaccion
inner join proveedores p on cph.proveedor=p.codigo
		Where idtipotransaccion=1 and TipCompModHeader.signo=1 and (cph.proveedor=@proveedor or @proveedor=0) and cph.fecha between @Desde and @Hasta
and (round(cph.totalImporte-isnull(cph.cancelado,0)+isnull(cph.ImporteOrigen,0)-isnull(cph.canceladoOrigen,0),2)<>0)
and cph.proveedor>210999
)
Order by cph.fecha,pv 


GO
/****** Object:  StoredProcedure [dbo].[SaldosProveedoresAnalizadoFecha]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE Procedure [dbo].[SaldosProveedoresAnalizadoFecha]
(
	@Fecha	char(8)='20140630',
	@CliPro		char(1)='P',
	@Codigo		int=212032

)
as

if @Clipro='P'

SELECT A01.Fecha Fecha,Descripcion,
	A01.proveedor cliente, razonsocial,NroComprobante,
	Case when ((abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(Aplicado,0))<>0 and (A01.importeOrigen-isnull(AplicadoOrigen,0))=0)
then 1 else 0 end)<0 then 
		-((abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(Aplicado,0))<>0 and (A01.importeOrigen-isnull(AplicadoOrigen,0))=0)
then 1 else 0 end) else 0 end Debe,
	Case when ((abs(A01.totalimporte)-isnull(Aplicado,0)))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(Aplicado,0))<>0 and (A01.importeOrigen-isnull(AplicadoOrigen,0))=0)
then 1 else 0 end>0 then 
		((abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(Aplicado,0))<>0 and (A01.importeOrigen-isnull(AplicadoOrigen,0))=0)
then 1 else 0 end) else 0 end Haber,
	-1*(abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(Aplicado,0))<>0 and (A01.importeOrigen-isnull(AplicadoOrigen,0))=0)
then 1 else 0 end as Saldo,
	Case when ((A01.importeOrigen-isnull(AplicadoOrigen,0))*multiplicador*case when moneda=1 then 1 else 0 end)<0 then 
		-((A01.importeOrigen-isnull(AplicadoOrigen,0))*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end DebeDolares,
	Case when (A01.importeOrigen-isnull(AplicadoOrigen,0))*multiplicador*case when moneda=1 then 1 else 0 end>0 then 
		((A01.importeOrigen-isnull(AplicadoOrigen,0))*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end HaberDolares,
	-1*(A01.importeOrigen-isnull(AplicadoOrigen,0))*multiplicador*case when moneda=1 then 1 else 0 end as SaldoDolares,
	Case when ((abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end)<0 then 
		-((abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) else 0 end DebeContable,
	Case when (abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end>0 then 
		((abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) else 0 end HaberContable,

	-1*(abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end as SaldoContable,

	a01.idtransaccion,domicilio,localidad,telefono1,telefono2

 from (

Select A01.Fecha Fecha,tcm.Descripcion,	A01.proveedor, A02.razonsocial,a01.NroComprobante,
a01.totalimporte,
abs(sum(case when vch1.idtransaccion is not null then importe else 0 end*t.multiplicador*case when 
a.idtransaccion=a01.idtransaccion then -1 else 1 end)) Aplicado,a01.importeOrigen,
abs(sum(case when vch1.idtransaccion is not null then a.importeOrigen else 0 end*t.multiplicador*case when 
a.idtransaccion=a01.idtransaccion then -1 else 1 end)) AplicadoOrigen,
a01.idtransaccion,domicilio,localidad,telefono1,telefono2,a01.Moneda,tcm.Multiplicador

from CompProvHeader A01
	Left join  bCarteraaFecha b
	on a01.idtransaccion=b.idtransaccion 
	INNER JOIN Proveedores A02      
	ON A01.Proveedor = A02.codigo
	INNER JOIN TIPCOMPMODHEADER tcm
	on A01.tipoComprobante=tcm.codigo

	left join aplicacionescuentasaPagar a
	on a.idtransaccionCancelada=a01.idtransaccion
	left join CompProvHeader vch1 
	on a.idtransaccion=vch1.idtransaccion and vch1.fecha<=@Fecha
	inner join TipCompModHeader t
	on a01.tipocomprobante=t.codigo

	where isnull(b.Fecha,Getdate())>@Fecha
	and A01.Fecha<=@Fecha
	and (a01.proveedor=@Codigo or @Codigo=0)
	and a01.proveedor>211000

Group by A01.Fecha,tcm.Descripcion,	A01.proveedor, A02.razonsocial,a01.NroComprobante,
a01.idtransaccion,domicilio,localidad,telefono1,telefono2,a01.totalimporte, a01.ImporteOrigen,a01.Moneda,tcm.Multiplicador

) as A01

Where 

(
(
	-1*(abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end
)
 +

(
	-1*(abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(Aplicado,0))<>0 and (A01.importeOrigen-isnull(AplicadoOrigen,0))=0)
then 1 else 0 end
)
)<>0
	
	order by a01.Proveedor,Fecha 


	
else
	SELECT A01.Fecha Fecha,tcm.Descripcion,
	A01.Cliente, A02.razonsocial,NroComprobante,
	Case when ((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0)))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cCliAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cCliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0)
then 1 else 0 end>0 then 
		((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cCliAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cCliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0)
then 1 else 0 end) else 0 end Debe,
	Case when ((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cCliAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cCliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0)
then 1 else 0 end)<0 then 
		-((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cCliAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cCliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0)
 then 1 else 0 end) else 0 end Haber,
	(abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cCliAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cCliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0) 
then 1 else 0 end as Saldo,
	Case when (A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end>0 then 
		((A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end DebeDolares,
	Case when ((A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end)<0 then 
		-((A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end HaberDolares,
	(A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end as SaldoDolares,

	Case when (abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end>0 then 
		((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) else 0 end DebeContable,

	Case when ((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end)<0 then 
		-((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) else 0 end HaberContable,
	(abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end as SaldoContable,

idtransaccion,domicilio,localidad,telefono1,telefono2
	FROM VenCliHeader A01
	INNER JOIN clientes

/* (

Select cliente codigo,razonsocial,domicilio,localidad,telefono1,telefono2
	FROM VenCliHeader A010
	INNER JOIN Clientes A020      
	ON A010.Cliente = A020.codigo
	INNER JOIN TIPVentMODHEADER tcm0
	on A010.tipoComprobante=tcm0.codigo
where len(ltrim(rtrim(isnull(estado,'A'))))=1
Group by cliente,razonsocial,domicilio,localidad,telefono1,telefono2
having 
sum(case when moneda=0 then totalimporte*multiplicador else 0 end)<>0
or 
sum(case when moneda=1 then importeOrigen*multiplicador else 0 end)<>0

) */ A02      
	ON A01.Cliente = A02.codigo
	INNER JOIN TIPVentMODHEADER tcm
	on A01.tipoComprobante=tcm.codigo
	WHERE a01.fecha<=@Fecha
	and (a01.cliente=@Codigo or @Codigo=0)
    and len(ltrim(rtrim(isnull(estado,'A'))))=1
	and (totalimporte-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0)<>0
	or a01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0)<>0)
	and
	Case when ((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0)))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cCliAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cCliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0) then 1 else 0 end>0 then 
		((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cCliAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cCliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0) then 1 else 0 end) else 0 end +
	Case when ((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cCliAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cCliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0)
then 1 else 0 end)<0 then 
		-((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cCliAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cCliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0)
 then 1 else 0 end) else 0 end +
--	(abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=0 then 1 else 0 end +
	Case when (A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end>0 then 
		((A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end+
	Case when ((A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end)<0 then 
		-((A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end+
	(A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end+

	Case when (abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end>0 then 
		((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) else 0 end+

	Case when ((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end)<0 then 
		-((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) else 0 end
--+	(abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end
<>0
 order by a01.Cliente,Fecha




































GO
/****** Object:  StoredProcedure [dbo].[SaldosProveedoresAnalizadoFecha_Original]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO









Create Procedure [dbo].[SaldosProveedoresAnalizadoFecha_Original]
(
	@Fecha	char(8)='20110630',
	@CliPro		char(1)='P',
	@Codigo		int=211271

)
as
if @Clipro='P'
	SELECT A01.Fecha Fecha,tcm.Descripcion,
	A01.proveedor cliente, A02.razonsocial,NroComprobante,
	Case when ((abs(A01.totalimporte)-isnull(dbo.cProAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cProAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cProaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0)
then 1 else 0 end)<0 then 
		-((abs(A01.totalimporte)-isnull(dbo.cProAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cProAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cProaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0)
then 1 else 0 end) else 0 end Debe,
	Case when ((abs(A01.totalimporte)-isnull(dbo.cProAplicadoFecha(a01.idtransaccion,@Fecha),0)))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cProAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cProaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0)
then 1 else 0 end>0 then 
		((abs(A01.totalimporte)-isnull(dbo.cProAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cProAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cProaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0)
then 1 else 0 end) else 0 end Haber,
	-1*(abs(A01.totalimporte)-isnull(dbo.cProAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cProAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cProaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0)
then 1 else 0 end as Saldo,
	Case when ((A01.importeOrigen-isnull(dbo.cProaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end)<0 then 
		-((A01.importeOrigen-isnull(dbo.cProaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end DebeDolares,
	Case when (A01.importeOrigen-isnull(dbo.cProaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end>0 then 
		((A01.importeOrigen-isnull(dbo.cProaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end HaberDolares,
	-1*(A01.importeOrigen-isnull(dbo.cProaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end as SaldoDolares,
	Case when ((abs(A01.totalimporte)-isnull(dbo.cProAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end)<0 then 
		-((abs(A01.totalimporte)-isnull(dbo.cProAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) else 0 end DebeContable,
	Case when (abs(A01.totalimporte)-isnull(dbo.cProAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end>0 then 
		((abs(A01.totalimporte)-isnull(dbo.cProAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) else 0 end HaberContable,

	-1*(abs(A01.totalimporte)-isnull(dbo.cProAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end as SaldoContable,

	a01.idtransaccion,domicilio,localidad,telefono1,telefono2

	FROM CompProvHeader A01
	INNER JOIN Proveedores A02      
	ON A01.Proveedor = A02.codigo
	INNER JOIN TIPCOMPMODHEADER tcm
	on A01.tipoComprobante=tcm.codigo
	WHERE a01.fecha<=@Fecha
	and a01.proveedor>211000
	and (a01.proveedor=@Codigo or @Codigo=0)

	and isnull(a01.estado,'A') not in ('F','Z')

	and Case when ((abs(A01.totalimporte)-isnull(dbo.cProAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cProAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cProaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0)
then 1 else 0 end)<0 then 
		-((abs(A01.totalimporte)-isnull(dbo.cProAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cProAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cProaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0)
then 1 else 0 end) else 0 end +
	Case when ((abs(A01.totalimporte)-isnull(dbo.cProAplicadoFecha(a01.idtransaccion,@Fecha),0)))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cProAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cProaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0)
then 1 else 0 end>0 then 
		((abs(A01.totalimporte)-isnull(dbo.cProAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cProAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cProaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0)
then 1 else 0 end) else 0 end +
	
	Case when ((A01.importeOrigen-isnull(dbo.cProaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end)<0 then 
		-((A01.importeOrigen-isnull(dbo.cProaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end +

	Case when (A01.importeOrigen-isnull(dbo.cProaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end>0 then 
		((A01.importeOrigen-isnull(dbo.cProaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end +
	
	Case when ((abs(A01.totalimporte)-isnull(dbo.cProAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end)<0 then 
		-((abs(A01.totalimporte)-isnull(dbo.cProAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) else 0 end +
	Case when (abs(A01.totalimporte)-isnull(dbo.cProAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end>0 then 
		((abs(A01.totalimporte)-isnull(dbo.cProAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) else 0 end <>0


	
	
	order by a01.Proveedor,Fecha 
	
else
	SELECT A01.Fecha Fecha,tcm.Descripcion,
	A01.Cliente, A02.razonsocial,NroComprobante,
	Case when ((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0)))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cCliAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cCliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0)
then 1 else 0 end>0 then 
		((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cCliAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cCliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0)
then 1 else 0 end) else 0 end Debe,
	Case when ((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cCliAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cCliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0)
then 1 else 0 end)<0 then 
		-((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cCliAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cCliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0)
 then 1 else 0 end) else 0 end Haber,
	(abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cCliAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cCliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0) 
then 1 else 0 end as Saldo,
	Case when (A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end>0 then 
		((A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end DebeDolares,
	Case when ((A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end)<0 then 
		-((A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end HaberDolares,
	(A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end as SaldoDolares,

	Case when (abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end>0 then 
		((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) else 0 end DebeContable,

	Case when ((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end)<0 then 
		-((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) else 0 end HaberContable,
	(abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end as SaldoContable,

idtransaccion,domicilio,localidad,telefono1,telefono2
	FROM VenCliHeader A01
	INNER JOIN Clientes A02      
	ON A01.Cliente = A02.codigo
	INNER JOIN TIPVentMODHEADER tcm
	on A01.tipoComprobante=tcm.codigo
	WHERE a01.fecha<=@Fecha
	and (a01.cliente=@Codigo or @Codigo=0)
    and len(ltrim(rtrim(isnull(estado,'A'))))=1
	and (totalimporte-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0)<>0
	or a01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0)<>0)
	and
	Case when ((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0)))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cCliAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cCliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0) then 1 else 0 end>0 then 
		((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cCliAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cCliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0) then 1 else 0 end) else 0 end +
	Case when ((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cCliAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cCliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0)
then 1 else 0 end)<0 then 
		-((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cCliAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cCliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0)
 then 1 else 0 end) else 0 end +
--	(abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=0 then 1 else 0 end +
	Case when (A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end>0 then 
		((A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end+
	Case when ((A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end)<0 then 
		-((A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end+
	(A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end+

	Case when (abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end>0 then 
		((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) else 0 end+

	Case when ((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end)<0 then 
		-((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) else 0 end
--+	(abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end
<>0
 order by a01.Cliente,Fecha


































GO
/****** Object:  StoredProcedure [dbo].[SaldosProveedoresAnalizadoFechaDebug]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE Procedure [dbo].[SaldosProveedoresAnalizadoFechaDebug]
(
	@Fecha	char(8)='20120630',
	@CliPro		char(1)='P',
	@Codigo		int=211274

)
as
if @Clipro='P'

SELECT A01.Fecha Fecha,Descripcion,
	A01.proveedor cliente, razonsocial,NroComprobante,
	Case when ((abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(Aplicado,0))<>0 and (A01.importeOrigen-isnull(AplicadoOrigen,0))=0)
then 1 else 0 end)<0 then 
		-((abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(Aplicado,0))<>0 and (A01.importeOrigen-isnull(AplicadoOrigen,0))=0)
then 1 else 0 end) else 0 end Debe,
	Case when ((abs(A01.totalimporte)-isnull(Aplicado,0)))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(Aplicado,0))<>0 and (A01.importeOrigen-isnull(AplicadoOrigen,0))=0)
then 1 else 0 end>0 then 
		((abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(Aplicado,0))<>0 and (A01.importeOrigen-isnull(AplicadoOrigen,0))=0)
then 1 else 0 end) else 0 end Haber,
	-1*(abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(Aplicado,0))<>0 and (A01.importeOrigen-isnull(AplicadoOrigen,0))=0)
then 1 else 0 end as Saldo,
	Case when ((A01.importeOrigen-isnull(AplicadoOrigen,0))*multiplicador*case when moneda=1 then 1 else 0 end)<0 then 
		-((A01.importeOrigen-isnull(AplicadoOrigen,0))*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end DebeDolares,
	Case when (A01.importeOrigen-isnull(AplicadoOrigen,0))*multiplicador*case when moneda=1 then 1 else 0 end>0 then 
		((A01.importeOrigen-isnull(AplicadoOrigen,0))*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end HaberDolares,
	-1*(A01.importeOrigen-isnull(AplicadoOrigen,0))*multiplicador*case when moneda=1 then 1 else 0 end as SaldoDolares,
	Case when ((abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end)<0 then 
		-((abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) else 0 end DebeContable,
	Case when (abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end>0 then 
		((abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) else 0 end HaberContable,

	-1*(abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end as SaldoContable,

	a01.idtransaccion,domicilio,localidad,telefono1,telefono2

 from (

Select A01.Fecha Fecha,tcm.Descripcion,	A01.proveedor, A02.razonsocial,a01.NroComprobante,
a01.totalimporte,
abs(sum(case when vch1.idtransaccion is not null then importe else 0 end*t.multiplicador*case when 
a.idtransaccion=a01.idtransaccion then -1 else 1 end)) Aplicado,a01.importeOrigen,
abs(sum(case when vch1.idtransaccion is not null then a.importeOrigen else 0 end*t.multiplicador*case when 
a.idtransaccion=a01.idtransaccion then -1 else 1 end)) AplicadoOrigen,
a01.idtransaccion,domicilio,localidad,telefono1,telefono2,a01.Moneda,tcm.Multiplicador

from CompProvHeader A01
	Left join  bCarteraaFecha b
	on a01.idtransaccion=b.idtransaccion 
	INNER JOIN Proveedores A02      
	ON A01.Proveedor = A02.codigo
	INNER JOIN TIPCOMPMODHEADER tcm
	on A01.tipoComprobante=tcm.codigo

	left join aplicacionescuentasaPagar a
	on a.idtransaccionCancelada=a01.idtransaccion
	left join CompProvHeader vch1 
	on a.idtransaccion=vch1.idtransaccion and vch1.fecha<=@Fecha
	inner join TipCompModHeader t
	on a01.tipocomprobante=t.codigo

	where isnull(b.Fecha,Getdate())>@Fecha
	and A01.Fecha<=@Fecha
	and (a01.proveedor=@Codigo or @Codigo=0)
	and a01.proveedor>211000

Group by A01.Fecha,tcm.Descripcion,	A01.proveedor, A02.razonsocial,a01.NroComprobante,
a01.idtransaccion,domicilio,localidad,telefono1,telefono2,a01.totalimporte, a01.ImporteOrigen,a01.Moneda,tcm.Multiplicador

) as A01

Where 

(
(
	-1*(abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end
)
 +

(
	-1*(abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(Aplicado,0))<>0 and (A01.importeOrigen-isnull(AplicadoOrigen,0))=0)
then 1 else 0 end
)
)<>0
	
Order by a01.Proveedor,Fecha 
	























GO
/****** Object:  StoredProcedure [dbo].[SaldosProveedoresAnalizadoFechaOptimizado]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create Procedure [dbo].[SaldosProveedoresAnalizadoFechaOptimizado]
(
	@Fecha	char(8)='20110630',
	@CliPro		char(1)='P',
	@Codigo		int=211271

)
as
if @Clipro='P'
 
SELECT A01.Fecha Fecha,Descripcion,
	A01.proveedor cliente, razonsocial,NroComprobante,
	Case when ((abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(Aplicado,0))<>0 and (A01.importeOrigen-isnull(AplicadoOrigen,0))=0)
then 1 else 0 end)<0 then 
		-((abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(Aplicado,0))<>0 and (A01.importeOrigen-isnull(AplicadoOrigen,0))=0)
then 1 else 0 end) else 0 end Debe,
	Case when ((abs(A01.totalimporte)-isnull(Aplicado,0)))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(Aplicado,0))<>0 and (A01.importeOrigen-isnull(AplicadoOrigen,0))=0)
then 1 else 0 end>0 then 
		((abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(Aplicado,0))<>0 and (A01.importeOrigen-isnull(AplicadoOrigen,0))=0)
then 1 else 0 end) else 0 end Haber,
	-1*(abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(Aplicado,0))<>0 and (A01.importeOrigen-isnull(AplicadoOrigen,0))=0)
then 1 else 0 end as Saldo,
	Case when ((A01.importeOrigen-isnull(AplicadoOrigen,0))*multiplicador*case when moneda=1 then 1 else 0 end)<0 then 
		-((A01.importeOrigen-isnull(AplicadoOrigen,0))*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end DebeDolares,
	Case when (A01.importeOrigen-isnull(AplicadoOrigen,0))*multiplicador*case when moneda=1 then 1 else 0 end>0 then 
		((A01.importeOrigen-isnull(AplicadoOrigen,0))*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end HaberDolares,
	-1*(A01.importeOrigen-isnull(AplicadoOrigen,0))*multiplicador*case when moneda=1 then 1 else 0 end as SaldoDolares,
	Case when ((abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end)<0 then 
		-((abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) else 0 end DebeContable,
	Case when (abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end>0 then 
		((abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) else 0 end HaberContable,

	-1*(abs(A01.totalimporte)-isnull(Aplicado,0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end as SaldoContable,

	a01.idtransaccion,domicilio,localidad,telefono1,telefono2


 from (

Select A01.Fecha Fecha,tcm.Descripcion,	A01.proveedor, A02.razonsocial,a01.NroComprobante,
a01.totalimporte,
abs(sum(case when vch1.idtransaccion is not null then importe else 0 end*t.multiplicador*case when 
a.idtransaccion=a01.idtransaccion then -1 else 1 end)) Aplicado,a01.importeOrigen,
abs(sum(case when vch1.idtransaccion is not null then a.importeOrigen else 0 end*t.multiplicador*case when 
a.idtransaccion=a01.idtransaccion then -1 else 1 end)) AplicadoOrigen,
a01.idtransaccion,domicilio,localidad,telefono1,telefono2,a01.Moneda,tcm.Multiplicador

from CompProvHeader A01
	Left join  bCarteraaFecha b
	on a01.idtransaccion=b.idtransaccion 
	INNER JOIN Proveedores A02      
	ON A01.Proveedor = A02.codigo
	INNER JOIN TIPCOMPMODHEADER tcm
	on A01.tipoComprobante=tcm.codigo

	left join aplicacionescuentasaPagar a
	on a.idtransaccionCancelada=a01.idtransaccion
	left join CompProvHeader vch1 
	on a.idtransaccion=vch1.idtransaccion and vch1.fecha<=@Fecha
	inner join TipCompModHeader t
	on a01.tipocomprobante=t.codigo

	where isnull(b.Fecha,Getdate())>'20120329'
	and A01.Fecha<='20120329'
	and (a01.proveedor=212001 or 212001=0)

Group by A01.Fecha,tcm.Descripcion,	A01.proveedor, A02.razonsocial,a01.NroComprobante,
a01.idtransaccion,domicilio,localidad,telefono1,telefono2,a01.totalimporte, a01.ImporteOrigen,a01.Moneda,tcm.Multiplicador

) as A01
	
	order by a01.Proveedor,Fecha 
	
else
	SELECT A01.Fecha Fecha,tcm.Descripcion,
	A01.Cliente, A02.razonsocial,NroComprobante,
	Case when ((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0)))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cCliAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cCliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0)
then 1 else 0 end>0 then 
		((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cCliAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cCliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0)
then 1 else 0 end) else 0 end Debe,
	Case when ((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cCliAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cCliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0)
then 1 else 0 end)<0 then 
		-((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cCliAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cCliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0)
 then 1 else 0 end) else 0 end Haber,
	(abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cCliAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cCliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0) 
then 1 else 0 end as Saldo,
	Case when (A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end>0 then 
		((A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end DebeDolares,
	Case when ((A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end)<0 then 
		-((A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end HaberDolares,
	(A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end as SaldoDolares,

	Case when (abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end>0 then 
		((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) else 0 end DebeContable,

	Case when ((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end)<0 then 
		-((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) else 0 end HaberContable,
	(abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end as SaldoContable,

idtransaccion,domicilio,localidad,telefono1,telefono2
	FROM VenCliHeader A01
	INNER JOIN Clientes A02      
	ON A01.Cliente = A02.codigo
	INNER JOIN TIPVentMODHEADER tcm
	on A01.tipoComprobante=tcm.codigo
	WHERE a01.fecha<=@Fecha
	and (a01.cliente=@Codigo or @Codigo=0)
    and len(ltrim(rtrim(isnull(estado,'A'))))=1
	and (totalimporte-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0)<>0
	or a01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0)<>0)
	and
	Case when ((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0)))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cCliAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cCliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0) then 1 else 0 end>0 then 
		((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cCliAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cCliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0) then 1 else 0 end) else 0 end +
	Case when ((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cCliAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cCliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0)
then 1 else 0 end)<0 then 
		-((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when 
(moneda=0 or (abs(A01.totalimporte)-isnull(dbo.cCliAplicadoFecha(a01.idtransaccion,@Fecha),0))<>0 and (A01.importeOrigen-isnull(dbo.cCliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))=0)
 then 1 else 0 end) else 0 end +
--	(abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=0 then 1 else 0 end +
	Case when (A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end>0 then 
		((A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end+
	Case when ((A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end)<0 then 
		-((A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end+
	(A01.importeOrigen-isnull(dbo.ccliaplicadoOrigenFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda=1 then 1 else 0 end+

	Case when (abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end>0 then 
		((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) else 0 end+

	Case when ((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end)<0 then 
		-((abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) else 0 end
--+	(abs(A01.totalimporte)-isnull(dbo.ccliAplicadoFecha(a01.idtransaccion,@Fecha),0))*multiplicador*case when moneda between 0 and 1 then 1 else 0 end
<>0
 order by a01.Cliente,Fecha


































GO
/****** Object:  StoredProcedure [dbo].[SaldosProveedoresConsolidado]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE Procedure [dbo].[SaldosProveedoresConsolidado]
(
	@FechaInicio	char(8)='20090630',
	@FechaCierre	char(8)='20090831',
	@Modo		char(1)='S',
	@CliPro		char(1)='P'

 -- A olo Saldos M Inicio + Movimientos

)
as
if @Clipro='P'
	SELECT cast(@FechaInicio as datetime) Fecha,'Saldo Apertura' Detalle,
	A01.proveedor, A02.razonsocial,'0' NroComprobante,
	Case when Sum(A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end)<0 then 
		-Sum(A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end)else 0 end Debe,
	Case when Sum(A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end)>0 then 
		Sum(A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end) else 0 end Haber,
	Sum(A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end) as Saldo,
	Case when Sum(A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end)<0 then 
		-Sum(A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end)else 0 end DebeDolares,
	Case when Sum(A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end)>0 then 
		Sum(A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end HaberDolares,
	Sum(A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end) as SaldoDolares,
	Case when Sum(A01.totalimporte*multiplicador*case when moneda between 0 and 1 then 1 else 0 end)<0 then 
		-Sum(A01.totalimporte*multiplicador*case when moneda between 0 and 1 then 1 else 0 end)else 0 end DebeContable,
	Case when Sum(A01.totalimporte*multiplicador*case when moneda between 0 and 1 then 1 else 0 end)>0 then 
		Sum(A01.totalimporte*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) else 0 end HaberContable,
	Sum(A01.totalimporte*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) as SaldoContable,

-1,domicilio,localidad,telefono1,telefono2
	FROM CompProvHeader A01
	INNER JOIN Proveedores A02      
	ON A01.Proveedor = A02.codigo
	INNER JOIN TIPCOMPMODHEADER tcm
	on A01.tipoComprobante=tcm.codigo
	WHERE A01.Fecha <= case when @Modo='S' then @FechaCierre else @FechaInicio end and isnull(a01.estado,'A') not in ('F','Z')
	GROUP BY A01.proveedor, A02.razonsocial,domicilio,localidad,telefono1,telefono2
	Having
	Sum(A01.totalimporte*multiplicador)<>0
	Union
	SELECT A01.Fecha Fecha,tcm.Descripcion,
	A01.proveedor, A02.razonsocial,NroComprobante,
	Case when A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end<0 then 
		-(A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end) else 0 end Debe,
	Case when (A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end)>0 then 
		(A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end) else 0 end Haber,
	A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end as Saldo,
	Case when A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end<0 then 
		-(A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end DebeDolares,
	Case when (A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end)>0 then 
		(A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end HaberDolares,
	A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end as SaldoDolares,

	Case when A01.totalimporte*multiplicador*case when moneda between 0 and 1 then 1 else 0 end<0 then 
		-(A01.totalimporte*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) else 0 end DebeContable,
	Case when (A01.totalimporte*multiplicador*case when moneda between 0 and 1 then 1 else 0 end)>0 then 
		(A01.totalimporte*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) else 0 end HaberContable,
	A01.totalimporte*multiplicador*case when moneda between 0 and 1 then 1 else 0 end as SaldoContable,

idtransaccion,domicilio,localidad,telefono1,telefono2
	FROM CompProvHeader A01
	INNER JOIN Proveedores A02      
	ON A01.Proveedor = A02.codigo
	INNER JOIN TIPCOMPMODHEADER tcm
	on A01.tipoComprobante=tcm.codigo
	WHERE A01.Fecha Between cast(@FechaInicio as datetime)+1 and cast(@FechaCierre as datetime) and isnull(a01.estado,'A') not in ('F','Z')
	and @Modo='M'
	order by a01.Proveedor,Fecha
else
	SELECT cast(@FechaInicio as datetime) Fecha,'Saldo Apertura' Detalle,
	A01.Cliente proveedor, A02.razonsocial,'0' NroComprobante,
	Case when Sum(A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end)>0 then 
		Sum(A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end)else 0 end Debe,
	Case when Sum(A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end)<0 then 
		-Sum(A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end) else 0 end Haber,
	Sum(A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end) as Saldo,
	Case when Sum(A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end)>0 then 
		Sum(A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end)else 0 end DebeDolares,
	Case when Sum(A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end)<0 then 
		-Sum(A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end HaberDolares,
	Sum(A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end) as SaldoDolares,

	Case when Sum(A01.totalimporte*multiplicador*case when moneda between 0 and 1 then 1 else 0 end)>0 then 
		Sum(A01.totalimporte*multiplicador*case when moneda between 0 and 1 then 1 else 0 end)else 0 end DebeContable,
	Case when Sum(A01.totalimporte*multiplicador*case when moneda between 0 and 1 then 1 else 0 end)<0 then 
		-Sum(A01.totalimporte*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) else 0 end HaberContable,
	Sum(A01.totalimporte*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) as SaldoContable,

-1,domicilio,localidad,telefono1,telefono2
	FROM VencliHeader A01
	INNER JOIN Clientes A02      
	ON A01.Cliente = A02.codigo
	INNER JOIN TIPVentMODHEADER tcm
	on A01.tipoComprobante=tcm.codigo
	WHERE A01.Fecha <= case when @Modo='S' then @FechaCierre else @FechaInicio end
	GROUP BY A01.Cliente, A02.razonsocial,domicilio,localidad,telefono1,telefono2
	Having
	Sum(A01.totalimporte*multiplicador)<>0
	Union
	SELECT A01.Fecha Fecha,tcm.Descripcion,
	A01.Cliente, A02.razonsocial,NroComprobante,
	Case when A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end>0 then 
		(A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end) else 0 end Debe,
	Case when (A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end)<0 then 
		-(A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end) else 0 end Haber,
	A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end as Saldo,
	Case when A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end>0 then 
		(A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end DebeDolares,
	Case when (A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end)<0 then 
		-(A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end HaberDolares,
	A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end as SaldoDolares,

	Case when A01.totalimporte*multiplicador*case when moneda between 0 and 1 then 1 else 0 end>0 then 
		(A01.totalimporte*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) else 0 end DebeContable,
	Case when (A01.totalimporte*multiplicador*case when moneda between 0 and 1 then 1 else 0 end)<0 then 
		-(A01.totalimporte*multiplicador*case when moneda between 0 and 1 then 1 else 0 end) else 0 end HaberContable,
	A01.totalimporte*multiplicador*case when moneda between 0 and 1 then 1 else 0 end as SaldoContable,

idtransaccion,domicilio,localidad,telefono1,telefono2
	FROM VenCliHeader A01
	INNER JOIN Clientes A02      
	ON A01.Cliente = A02.codigo
	INNER JOIN TIPVentMODHEADER tcm
	on A01.tipoComprobante=tcm.codigo
	WHERE A01.Fecha Between cast(@FechaInicio as datetime)+1 and cast(@FechaCierre as datetime)
	and @Modo='M'

	order by a01.Cliente,Fecha













GO
/****** Object:  StoredProcedure [dbo].[SaldosProveedoresControl]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE Procedure [dbo].[SaldosProveedoresControl]
(
	@FechaInicio	char(8)='20090630',
	@FechaCierre	char(8)='29000101',
	@Modo		char(1)='M',
	@CliPro		char(1)='C'

 -- A olo Saldos M Inicio + Movimientos

)
as
if @Clipro='P'
	SELECT cast(@FechaInicio as datetime) Fecha,'Saldo Apertura' Detalle,
	A01.proveedor, A02.razonsocial,'0' NroComprobante,
	Case when Sum(A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end)<0 then 
		-Sum(A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end)else 0 end Debe,
	Case when Sum(A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end)>0 then 
		Sum(A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end) else 0 end Haber,
	Sum(A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end) as Saldo,
	Case when Sum(A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end)<0 then 
		-Sum(A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end)else 0 end DebeDolares,
	Case when Sum(A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end)>0 then 
		Sum(A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end HaberDolares,
	Sum(A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end) as SaldoDolares,


-1,domicilio,localidad,telefono1,telefono2
	FROM CompProvHeader A01
	INNER JOIN Proveedores A02      
	ON A01.Proveedor = A02.codigo
	INNER JOIN TIPCOMPMODHEADER tcm
	on A01.tipoComprobante=tcm.codigo
	WHERE A01.Fecha <= case when @Modo='A' then @FechaCierre else @FechaInicio end and isnull(a01.estado,'A') not in ('F','Z')
	GROUP BY A01.proveedor, A02.razonsocial,domicilio,localidad,telefono1,telefono2
	Having
	Sum(A01.totalimporte*multiplicador)<>0
	Union
	SELECT A01.Fecha Fecha,tcm.Descripcion,
	A01.proveedor, A02.razonsocial,NroComprobante,
	Case when A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end<0 then 
		-(A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end) else 0 end Debe,
	Case when (A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end)>0 then 
		(A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end) else 0 end Haber,
	A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end as Saldo,
	Case when A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end<0 then 
		-(A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end DebeDolares,
	Case when (A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end)>0 then 
		(A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end HaberDolares,
	A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end as SaldoDolares,
idtransaccion,domicilio,localidad,telefono1,telefono2
	FROM CompProvHeader A01
	INNER JOIN Proveedores A02      
	ON A01.Proveedor = A02.codigo
	INNER JOIN TIPCOMPMODHEADER tcm
	on A01.tipoComprobante=tcm.codigo
	WHERE A01.Fecha Between cast(@FechaInicio as datetime)+1 and cast(@FechaCierre as datetime)
	and @Modo='M'
	order by a01.Proveedor,Fecha
else
	SELECT cast(@FechaInicio as datetime) Fecha,'Saldo Apertura' Detalle,
	A01.Cliente proveedor, A02.razonsocial,'0' NroComprobante,
	Case when Sum(A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end)>0 then 
		Sum(A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end)else 0 end Debe,
	Case when Sum(A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end)<0 then 
		-Sum(A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end) else 0 end Haber,
	Sum(A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end) as Saldo,
	Case when Sum(A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end)>0 then 
		Sum(A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end)else 0 end DebeDolares,
	Case when Sum(A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end)<0 then 
		-Sum(A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end HaberDolares,
	Sum(A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end) as SaldoDolares,
-1,domicilio,localidad,telefono1,telefono2
	FROM VencliHeader A01
	INNER JOIN Clientes A02      
	ON A01.Cliente = A02.codigo
	INNER JOIN TIPVentMODHEADER tcm
	on A01.tipoComprobante=tcm.codigo
	WHERE A01.Fecha <= case when @Modo='A' then @FechaCierre else @FechaInicio end
	GROUP BY A01.Cliente, A02.razonsocial,domicilio,localidad,telefono1,telefono2
	Having
	Sum(A01.totalimporte*multiplicador)<>0
	Union
	SELECT A01.Fecha Fecha,tcm.Descripcion,
	A01.Cliente, A02.razonsocial,NroComprobante,
	Case when A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end>0 then 
		(A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end) else 0 end Debe,
	Case when (A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end)<0 then 
		-(A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end) else 0 end Haber,
	A01.totalimporte*multiplicador*case when moneda=0 then 1 else 0 end as Saldo,
	Case when A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end>0 then 
		(A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end DebeDolares,
	Case when (A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end)<0 then 
		-(A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end) else 0 end HaberDolares,
	A01.importeOrigen*multiplicador*case when moneda=1 then 1 else 0 end as SaldoDolares,

idtransaccion,domicilio,localidad,telefono1,telefono2
	FROM VenCliHeader A01
	INNER JOIN Clientes A02      
	ON A01.Cliente = A02.codigo
	INNER JOIN TIPVentMODHEADER tcm
	on A01.tipoComprobante=tcm.codigo
	WHERE A01.Fecha Between cast(@FechaInicio as datetime)+1 and cast(@FechaCierre as datetime)
	and @Modo='M'

	order by a01.Cliente,Fecha













GO
/****** Object:  StoredProcedure [dbo].[Sel_Rendiciones]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


CREATE Procedure [dbo].[Sel_Rendiciones]
	@Cobrador int,
	@Votos int
AS

Declare @strSQL as nvarchar(4000)

set @strSQL = 
'SELECT  
	Adherentes.Adherente               AS Adherente, 
	Adherentes.Apellido                AS Apellido, 
	Adherentes.nombre                  AS Nombre, 
	CuentasCorrientes.Concepto         AS Concepto_CtaCte, 
	CuentasCorrientes.DocumentoNumero  AS DocumentoNumero, 
	CuentasCorrientes.importe          AS Importe_CtaCte, 
	CuentasCorrientes.vencimiento      AS Vencimiento, 
	CuentasCorrientes.IdTransaccion    AS IdTransaccion, 
	DetalleCuentasCorrientes.Concepto  AS Concepto_Detalle, 
	Conceptos.Descripcion              AS Desc_Concepto,  
	Conceptos.Modalidad                AS Modalidad, 
	Conceptos.Importe                  AS Importe_Concepto 
FROM DetalleCuentasCorrientes 
	INNER JOIN CuentasCorrientes 
		ON DetalleCuentasCorrientes.idTransaccion = CuentasCorrientes.IdTransaccion 
	INNER JOIN Conceptos 
		ON DetalleCuentasCorrientes.Concepto = Conceptos.Concepto 
	INNER JOIN Adherentes 
		ON CuentasCorrientes.socio = Adherentes.Adherente 
WHERE Adherentes.FechaBaja is Null 
and (CuentasCorrientes.idtransaccion = 181 or CuentasCorrientes.idtransaccion = 182) '

if @Cobrador <> '' 
        set @strSQL = @strSQL + ' AND Adherentes.Cobrador = ' + Convert(char(10),@Cobrador)

If @Votos <> ''
	set @strSQL = @strSQL + ' AND Adherentes.LugarVoto = ' + Convert(char(10),@Votos)


EXEC sp_executesql @strSQL



GO
/****** Object:  StoredProcedure [dbo].[siap]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO





-- siap 200512

CREATE                  Procedure [dbo].[siap] (@Periodo as integer)
as

Declare @TopeApor int
Declare @TopeCont int

if substring(cast(@Periodo as char(6)),5,2)=06 or substring(cast(@Periodo as char(6)),5,2)=12
	set @TopeCont=9000
else
	set @TopeCont=6000

if substring(cast(@Periodo as char(6)),5,2)=06 or substring(cast(@Periodo as char(6)),5,2)=12
	set @TopeApor=7200
else
	set @TopeApor=4800

Select cuil,
apellido , nombre, 
(Select Count(*) from familiareslegajos f where m.legajo=f.legajo and parentesco=1) as Conyuge,
99 as hijo, case (select isnull(count(*),0) from fechaslegajos where legajo=m.legajo and concepto=2 and finaliza is null) when 0 then situacion else 5 end as situacion,
(condicion+jubilado) as condicion, codigoactividad,zonageografica,sistemajubilacion,
jubilado,modalidad,obrasocial,adherentes
,'remutotal'=isnull((
Select /* case 
			when Sum(importe)>@TopeCont then @TopeCont
			when Sum(importe)=0 then 0.01
			Else Sum(importe)
			end*/ Sum(importe) from Items_Liquidaciones i
 inner join conceptosLiquidacion c on i.concepto=c.concepto
 inner join header_liquidaciones hl on i.idLiquidacion=hl.idLiquidacion
where m.legajo=i.legajo and c.tipoconcepto<>40 and i.concepto<>152 and hl.aniomes=@Periodo),0)
,'remuImponible'=isnull((
Select case 
			when Sum(importe)>@TopeApor then @TopeApor
			when Sum(importe)=0 then 0.01
			Else Sum(importe)
			end from Items_Liquidaciones i
 inner join conceptosLiquidacion c on i.concepto=c.concepto
 inner join header_liquidaciones hl on i.idLiquidacion=hl.idLiquidacion
where m.legajo=i.legajo and c.tipoconcepto between 10 and 11 and hl.aniomes=@Periodo),0)
, 'Salario'=
isnull((Select Sum(importe) from Items_Liquidaciones i
 inner join conceptosLiquidacion c on i.concepto=c.concepto
 inner join header_liquidaciones hl on i.idLiquidacion=hl.idLiquidacion
where m.legajo=i.legajo and c.tipoconcepto=20 and i.concepto<>152 and hl.aniomes=@Periodo),0),
0 as aporteVoluntario,0 as AdicionalOS,0 as ExcedenteSS,0 as ExcedenteOS
, 'remuImponible2'=
isnull((
Select /* case 
			when Sum(importe)>@TopeCont then @TopeCont
			when Sum(importe)=0 then 0.01
			Else Sum(importe)
			end */ Sum(importe) from Items_Liquidaciones i
 inner join conceptosLiquidacion c on i.concepto=c.concepto
 inner join header_liquidaciones hl on i.idLiquidacion=hl.idLiquidacion
where m.legajo=i.legajo and c.tipoconcepto between 10 and 11 and i.concepto<>152 and hl.aniomes=@Periodo),0)
,'remuImponible3'=
isnull((
Select /* case 
			when Sum(importe)>@TopeCont then @TopeCont
			when Sum(importe)=0 then 0.01
			Else Sum(importe)
			end*/ Sum(importe) from Items_Liquidaciones i
inner join conceptosLiquidacion c on i.concepto=c.concepto
inner join header_liquidaciones hl on i.idLiquidacion=hl.idLiquidacion
where m.legajo=i.legajo and c.tipoconcepto between 10 and 11 and i.concepto<>152 and hl.aniomes=@Periodo),0)
,'remuImponible4'=
isnull((
Select case 
			when Sum(importe)>@TopeApor then @TopeApor
			when Sum(importe)=0 then 0.01
			Else Sum(importe)
			end from Items_Liquidaciones i
 inner join conceptosLiquidacion c on i.concepto=c.concepto
 inner join header_liquidaciones hl on i.idLiquidacion=hl.idLiquidacion
where m.legajo=i.legajo and c.tipoconcepto between 10 and 11 and i.concepto<>152 and hl.aniomes=@Periodo),0)
,'remuImponible5'=
isnull((
Select case 
			when Sum(importe)>@TopeApor then @TopeApor
			Else Sum(importe)
			end from Items_Liquidaciones i
 inner join conceptosLiquidacion c on i.concepto=c.concepto
 inner join header_liquidaciones hl on i.idLiquidacion=hl.idLiquidacion
where m.legajo=i.legajo and c.tipoconcepto between 10 and 11 and i.concepto=152 and hl.aniomes=@Periodo),0),
0 as COSI
,
'jctiv'=round(isnull((
Select /*case 
			when Sum(importe)>@topeCont then @topeCont
			when Sum(importe)=0 then 0.01
			Else Sum(importe)
			end*/ Sum(importe) from Items_Liquidaciones i
 inner join conceptosLiquidacion c on i.concepto=c.concepto
 inner join header_liquidaciones hl on i.idLiquidacion=hl.idLiquidacion
where m.legajo=i.legajo and c.tipoconcepto between 10 and 11 and i.concepto<>152 and hl.aniomes=@Periodo),0)*10.17/100,2)
,'jpasiv'=round(isnull((
Select /*case 
			when Sum(importe)>@topeCont then @topeCont
			when Sum(importe)=0 then 0.01
			Else Sum(importe)
			end */ Sum(importe) from Items_Liquidaciones i
 inner join conceptosLiquidacion c on i.concepto=c.concepto
 inner join header_liquidaciones hl on i.idLiquidacion=hl.idLiquidacion
where m.legajo=i.legajo and c.tipoconcepto between 10 and 11 and i.concepto<>152 and hl.aniomes=@Periodo),0)*1.5/100,2)*(-isnull(jubilado,0)+1)
,'FNE'=round(isnull((
Select /* case 
			when Sum(importe)>@topeCont then @topeCont
			when Sum(importe)=0 then 0.01
			Else Sum(importe)
			end */ Sum(importe) from Items_Liquidaciones i
 inner join conceptosLiquidacion c on i.concepto=c.concepto
 inner join header_liquidaciones hl on i.idLiquidacion=hl.idLiquidacion
where m.legajo=i.legajo and c.tipoconcepto between 10 and 11 and i.concepto<>152 and hl.aniomes=@Periodo),0)*0.89/100,2)*(-isnull(jubilado,0)+1)
,'af'=round(isnull((
Select /*case 
			when Sum(importe)>@topeCont then @topeApor
			when Sum(importe)=0 then 0.01
			Else Sum(importe)
			end */ Sum(importe) from Items_Liquidaciones i
 inner join conceptosLiquidacion c on i.concepto=c.concepto
 inner join header_liquidaciones hl on i.idLiquidacion=hl.idLiquidacion
where m.legajo=i.legajo and c.tipoconcepto between 10 and 11 and i.concepto<>152 and hl.aniomes=@Periodo),0)*4.44/100,2)*(-isnull(jubilado,0)+1)
,'osocial'=round(isnull((
Select /* case 
			when Sum(importe)>@topeCont then @topeCont
			when Sum(importe)=0 then 0.01
			Else Sum(importe)
			end */ Sum(importe) from Items_Liquidaciones i
 inner join conceptosLiquidacion c on i.concepto=c.concepto
 inner join header_liquidaciones hl on i.idLiquidacion=hl.idLiquidacion
where m.legajo=i.legajo and c.tipoconcepto between 10 and 11 and i.concepto<>152 and hl.aniomes=@Periodo),0)*6/100,2)*(-isnull(jubilado,0)+1)

from maestropersonal m
where (Select count(*) from FechasLegajos
where legajo=m.legajo and concepto=0 and finaliza is null)<>0

order by cuil











GO
/****** Object:  StoredProcedure [dbo].[sicore]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO





CREATE       Procedure [dbo].[sicore] -- sicore 200605,'20060501','20060501','20060531','L'
(
	@Periodo as integer, 
	@Fecha as Char(8), 
	@Inicio as Char(8), 
	@Cierre as Char(8), 
	@Listado as char(1)
)
as
(
Select 
(Select top 1 sicore from detalle_Operaciones do1
Left Join AplicacionesCuentasaPagar cph on do1.idtransaccion=cph.idtransaccion 
Left Join Compprovheader cph1 on cph.idtransaccionCancelada=cph1.idtransaccion
left join tipcompModHeader tcph on 
cph1.tipocomprobante=tcph.codigo
inner join proveedores pv on pv.codigo=cph1.proveedor
where do1.idOperacion=ho.idoperacion and do1.idtipotransaccion=1) as CodigoComprobante, 
FechaEmision,
(Select top 1 substring(cph1.nroComprobante,1,4) from detalle_Operaciones do1
Left Join AplicacionesCuentasaPagar cph on do1.idtransaccion=cph.idtransaccion 
Left Join Compprovheader cph1 on cph.idtransaccionCancelada=cph1.idtransaccion
inner join proveedores pv on pv.codigo=cph1.proveedor
where do1.idOperacion=ho.idoperacion and do1.idtipotransaccion=1
order by cph1.totalimporte DESC
) as pvNroComprobante, 
(Select top 1 substring(cph1.nroComprobante,5,8) from detalle_Operaciones do1
Left Join AplicacionesCuentasaPagar cph on do1.idtransaccion=cph.idtransaccion 
Left Join Compprovheader cph1 on cph.idtransaccionCancelada=cph1.idtransaccion
inner join proveedores pv on pv.codigo=cph1.proveedor
where do1.idOperacion=ho.idoperacion and do1.idtipotransaccion=1
order by cph1.totalimporte DESC) as CNroComprobante, 
(Select sum(cph1.totalimporte) from detalle_Operaciones do1
Left Join AplicacionesCuentasaPagar cph on do1.idtransaccion=cph.idtransaccion 
Left Join Compprovheader cph1 on cph.idtransaccionCancelada=cph1.idtransaccion
inner join proveedores pv on pv.codigo=cph1.proveedor
where do1.idOperacion=ho.idoperacion and do1.idtipotransaccion=1) as TotalComprobante, 

217 as CodigodeImpuesto,

(Select top 1 case pv.tablaganancia when 6 then "094" when 7 then "116" end 
	from detalle_Operaciones do1
	Left Join AplicacionesCuentasaPagar cph on do1.idtransaccion=cph.idtransaccion 
	Left Join Compprovheader cph1 on cph.idtransaccionCancelada=cph1.idtransaccion
	inner join proveedores pv on pv.codigo=cph1.proveedor
	where do1.idOperacion=ho.idoperacion and do1.idtipotransaccion=1) as Regimen,
1 as CodigoOperacion,

(Select sum(cph1.totalimporte) from detalle_Operaciones do1
Left Join AplicacionesCuentasaPagar cph on do1.idtransaccion=cph.idtransaccion 
Left Join Compprovheader cph1 on cph.idtransaccionCancelada=cph1.idtransaccion
inner join proveedores pv on pv.codigo=cph1.proveedor
where do1.idOperacion=ho.idoperacion and do1.idtipotransaccion=1) as BaseCalculo,

FechaEmision as FechaRetencion, "01" as codigoCondicion, vt.importe as Retencion,
"00000000/00/0000" as Porcentaje_Boletin,

"80" as tipodocumento,

(Select top 1 pv.cuit from detalle_Operaciones do1
Left Join AplicacionesCuentasaPagar cph on do1.idtransaccion=cph.idtransaccion 
Left Join Compprovheader cph1 on cph.idtransaccionCancelada=cph1.idtransaccion
inner join proveedores pv on pv.codigo=cph1.proveedor
where do1.idOperacion=ho.idoperacion and do1.idtipotransaccion=1) as Documento,

"         000000000000000" as filler
,
(Select top 1 pv.RazonSocial from detalle_Operaciones do1
Left Join AplicacionesCuentasaPagar cph on do1.idtransaccion=cph.idtransaccion 
Left Join Compprovheader cph1 on cph.idtransaccionCancelada=cph1.idtransaccion
inner join proveedores pv on pv.codigo=cph1.proveedor
where do1.idOperacion=ho.idoperacion and do1.idtipotransaccion=1) as Nyap 
,
(Select top 1 pv.codigo from detalle_Operaciones do1
Left Join AplicacionesCuentasaPagar cph on do1.idtransaccion=cph.idtransaccion 
Left Join Compprovheader cph1 on cph.idtransaccionCancelada=cph1.idtransaccion
inner join proveedores pv on pv.codigo=cph1.proveedor
where do1.idOperacion=ho.idoperacion and do1.idtipotransaccion=1) as Codigo
, 
"Pagos a Proveedores" as Modo


from valoresTesoreria vt
inner join conceptos_Tesoreria ct
on vt.idConcepto_tesoreria=ct.idConcepto_tesoreria
inner join Detalle_Operaciones do
on do.idtransaccion=vt.idtransaccion 
inner join Header_Operaciones ho 
on ho.idOperacion=do.idOperacion
Left Join AplicacionesCuentasaPagar cph 
on do.idtransaccion=cph.idtransaccion 
where Unificador=8
and isnull(do.idtipotransaccion,2)=2
and dbo.toaniomes(FechaEmision)=@Periodo
and FechaEmision>= @inicio and fechaEmision<=@Cierre 
and (TipodeOperacion=20)
and (Select top 1 pv.tablaganancia from detalle_Operaciones do1
Left Join AplicacionesCuentasaPagar cph on do1.idtransaccion=cph.idtransaccion 
Left Join Compprovheader cph1 on cph.idtransaccionCancelada=cph1.idtransaccion
inner join proveedores pv on pv.codigo=cph1.proveedor
where do1.idOperacion=ho.idoperacion and do1.idtipotransaccion=1)<>10
)
order by fechaemision
/*union 
(
Select 
"02" as CodigoComprobante, 
@Fecha as FechaEmision,
"0000" as pvnroComprobante,
legajo as nroComprobante,
"TotalComprobante"=(
Select Bruto from Ganancias i
where m.legajo=i.Recibo AND I.pERIODO=@Periodo),
217 as CodigodeImpuesto,160 as Regimen,1 as CodigoOperacion,
"BaseCalculo"=(
Select BaseCalculo from Ganancias i
where m.legajo=i.Recibo AND I.pERIODO=@Periodo),
@Fecha as FechaRetencion,"01" as codigoCondicion,
"Retencion"=(
Select Sum(importe) from Items_Liquidaciones i
 inner join conceptosLiquidacion c on i.concepto=c.concepto
 inner join header_liquidaciones hl on i.idLiquidacion=hl.idLiquidacion
where m.legajo=i.legajo and i.concepto=690 and hl.aniomes=@Periodo) 
,"00000000/00/0000" as Porcentaje_Boletin,
"86" as tipodocumento,
cuil   as Documento,
"         000000000000000" as filler
, ltrim(rtrim(Apellido))+", "+ltrim(rtrim(nombre)) as Nyap, legajo as codigo
, 
"Sueldos Personal" as Modo
from maestropersonal m
where @Listado='N' and isnull((
Select Sum(importe) from Items_Liquidaciones i
 inner join conceptosLiquidacion c on i.concepto=c.concepto
 inner join header_liquidaciones hl on i.idLiquidacion=hl.idLiquidacion
where m.legajo=i.legajo and i.concepto=690 and hl.aniomes=@Periodo),0)>0
)
*/







GO
/****** Object:  StoredProcedure [dbo].[Socios1cobertura]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE    Procedure [dbo].[Socios1cobertura]
as
Select distinct co.socio,apellido,nombre,c01,f01,f02,c02,f04,f05,resumido from cobertura co
inner join grupos_socios gs
on co.socio=gs.socio
Left join repMuni rm
on gs.reparticion=rm.codigo 
and gs.LugarPago =rm.subCodigo
where 
((f01=0 and f02>=1) or (f02=0 and f01>=1)) or  (f04=0 and f05>=1) or (f05=0 and f04>=1)
order by resumido




GO
/****** Object:  StoredProcedure [dbo].[Socios1coberturaExtra]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE   Procedure [dbo].[Socios1coberturaExtra]
as
Select distinct co.socio,apellido,nombre,c01,f01,f02,c02,f04,f05,resumido,co.grupo
from cobertura co
inner join grupos_socios gs
on co.socio=gs.socio
Left join repMuni rm
on gs.reparticion=rm.codigo 
and gs.LugarPago =rm.subCodigo
where --(f01+f02=1) or 
f03+f04+f05=1
order by resumido






GO
/****** Object:  StoredProcedure [dbo].[Socios1coberturaMunicipales]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE   Procedure [dbo].[Socios1coberturaMunicipales]
as
Select distinct co.socio,apellido,nombre,c01,f01,f02,c02,f04,f05,resumido,co.Grupo 
from cobertura co
inner join grupos_socios gs
on co.socio=gs.socio
Left join repMuni rm
on gs.reparticion=rm.codigo 
and gs.LugarPago =rm.subCodigo
where (f01+f02=1) 
-- or f03+f04+f05=1
order by resumido






GO
/****** Object:  StoredProcedure [dbo].[sp_addasientodiarioheader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE procedure [dbo].[sp_addasientodiarioheader] (@asiento int,@aniomes int,@tipoasiento int,
@fecha datetime,@detalle varchar(50),@centrocosto int,@AsientoInterno int=0, @TipoAsInterno int=0)
as
begin
   insert into asientosdiariosheader (asiento,aniomes,fecha,detalle,centrocosto,tipoasiento,AsientoInterno,TipoasInterno)
   values (@asiento,@aniomes,@fecha,@detalle,@centrocosto,@tipoasiento,@AsientoInterno,@TipoasInterno)
end

GO
/****** Object:  StoredProcedure [dbo].[sp_addasientodiarioitem]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE  procedure [dbo].[sp_addasientodiarioitem] (@asiento int,@item int,
@aniomes int,@tipoasiento int,@cuenta int,@centrocosto int,
@debe numeric(18,2),@haber numeric(18,2),@observacion varchar(20))
as
begin
   insert into asientosdiariositems (asiento,item,aniomes,cuenta,centrocosto,debe,haber,observacion,tipoasiento)
   values (@asiento,@item,@aniomes,@cuenta,@centrocosto,@debe,@haber,@observacion,@tipoasiento)
end



GO
/****** Object:  StoredProcedure [dbo].[sp_addasientodiarioitemDiario]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE  procedure [dbo].[sp_addasientodiarioitemDiario] (@asiento int,@item int,
@aniomes int,@tipoasiento int,@cuenta int,@centrocosto int,
@debe numeric(18,2),@haber numeric(18,2),@observacion varchar(20),@ComputerName varchar(50),@tipoComprobante int)
as
begin
   insert into asientosdiariositemsDiario (asiento,item,aniomes,cuenta,centrocosto,debe,haber,observacion,tipoasiento,Usuario,tipodeComprobante)
   values (@asiento,@item,@aniomes,@cuenta,@centrocosto,@debe,@haber,@observacion,@tipoasiento,@Computername,@tipoComprobante)
end




GO
/****** Object:  StoredProcedure [dbo].[sp_addbanco]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addbanco] (@banco int,@descripcion varchar(20),@opera char(1))
as
begin
   insert into bancos (banco,descripcion,opera) 
    values (@banco,@descripcion,@opera)
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addcalificprofesional]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addcalificprofesional] (@descripcion varchar(30))
as
begin
   declare @iret int
   begin transaction
   insert into calificprofesionales (descripcion) values (@descripcion)
   select @iret=@@identity
   commit transaction
   return @iret
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addcargoasociacion]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addcargoasociacion] (@cargo int,@descripcion varchar(30))
as
begin
   insert into cargosasociacion (cargo,descripcion) 
   values (@cargo,@descripcion)
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addcategoria]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addcategoria] (@descripcion varchar(30))
as
begin
   declare @iret int
   begin transaction
   insert into categorias (descripcion) values (@descripcion)
   select @iret=@@identity
   commit transaction
   return @iret
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addcategoriaiva]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addcategoriaiva] (@descripcion varchar(30))
as
begin
   declare @iret int
   begin transaction
   insert into categorias_iva (descripcion) values (@descripcion)
   select @iret=@@identity
   commit transaction
   return @iret
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addcentrocosto]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addcentrocosto] (@descripcion varchar(30))
as
begin
   declare @iret int
   begin transaction
   insert into centrosdecostos (descripcion) values (@descripcion)
   select @iret=@@identity
   commit transaction
   return @iret
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addchequera]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  procedure [dbo].[sp_addchequera] 
	@concepto int, 
	@fechamov datetime, 
	@primercheque numeric(18,0),
	@cantcheques int,
	@ultimocheque numeric(18,0)
as
begin
   insert into chequeras (Concepto, FechaMovimiento, NroPrimerCheque, CantCheques, UltimoChequeEmitido) 
    values (@concepto,@fechamov,@primercheque,@cantcheques,@ultimocheque)
end



GO
/****** Object:  StoredProcedure [dbo].[sp_addcliente]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addcliente] (@RazonSocial varchar(30),@Contacto varchar(30),
@Domicilio varchar(30),@Localidad int,@Provincia int,@CPostal varchar(8),
@Telefono varchar(30),@TelefonoII varchar(30),@TelefonoIII varchar(30),@CIva int,
@Cuit varchar(14),@Cuenta int,@email varchar(30))
as 
begin
  begin transaction
  declare @iret int
  insert into clientes (RazonSocial,Contacto,Domicilio,Localidad,Provincia,CPostal,Telefono,TelefonoII,TelefonoIII,CIva,Cuit,Cuenta,Email) 
  values (@RazonSocial,@Contacto,@Domicilio,@Localidad,@Provincia,@CPostal,@Telefono,@TelefonoII,@TelefonoIII,@CIva,@Cuit,@Cuenta,@email)
  select @iret=@@identity
  commit transaction
  return @iret
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addcobrador]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  procedure [dbo].[sp_addcobrador] (@cobrador int,@nombre varchar(30),@serie char(5),
@importe numeric(18,2),@global char(1),@Tope int,@op int)
as
begin
   insert into cobradores (cobrador,nombre,serie,importe,[global],tope,op) 
   values (@cobrador,@nombre,@serie,@importe,@global,@tope,@op)
end



GO
/****** Object:  StoredProcedure [dbo].[sp_addcodigoactividad]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addcodigoactividad] (@codigoactividad int,@descripcion varchar(30))
as
begin
   insert into codigosactividades (codigoactividad,descripcion) 
   values (@codigoactividad,@descripcion)
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addcompfondo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE procedure [dbo].[sp_addcompfondo](@computer varchar(100),@itemfondo int,
@operacion int,@tipooperacion int,@tipotransaccion int,
@tipoasiento int,@szusuario varchar(10))
as
begin
   begin transaction
   --Variables auxiliares
   declare @transaccion int
   declare @szobservacion varchar(50),@szrazonsocial varchar(50)
   --Variables del Header de Compras Fondo Fijo
   declare @comprobante int ,@aniomes int,@fecha datetime,@proveedor int,
   @tipocomprobante int,@nrocomprobante char(12),@tipofactura char(1),
   @totalimporte numeric(18,2),@cancelado numeric(18,2),
   @fecha1venc datetime,@fecha2venc datetime,@estado char(1),
   @fechareal datetime,@centrocosto int
   
   --Recuperamos el registro
   select @comprobante=comprobante,@aniomes=aniomes,@fecha=fecha,@proveedor=proveedor,
   @tipocomprobante=tipocomprobante,@nrocomprobante=nrocomprobante,@tipofactura=tipofactura,
   @totalimporte=totalimporte,@cancelado=cancelado,@fecha1venc=fecha1venc,
   @fecha2venc=fecha2venc,@estado=estado,@fechareal=fechareal,@centrocosto=centrocosto
   from compfondosheadertemp 
   where computer=@computer and itemfondo=@itemfondo
   
   --Recuperamos el proximo Id Interno
   exec @comprobante=sp_getnextidint @aniomes,@tipoasiento

   --Creamos la observacion
   select @szrazonsocial=razonsocial from provfondo where proveedor=@proveedor
   select @szobservacion=left('Compra:'+convert(varchar(20),@comprobante)+',FC:'+@nrocomprobante+','+@szrazonsocial,50)
   
   --Insertamos en Compras Fondo Fijo
   insert into compfondosheader (comprobante,aniomes,fecha,proveedor,tipocomprobante,nrocomprobante,tipofactura,totalimporte,fecha1venc,fecha2venc,estado,fechareal,centrocosto)
   values(@comprobante,@aniomes,@fecha,@proveedor,@tipocomprobante,@nrocomprobante,@tipofactura,@totalimporte,@fecha1venc,@fecha2venc,@estado,@fechareal,@centrocosto)
   --Capturamos el Id Transaccion
   select @transaccion=@@identity

   --Insertamos en Detalle de Operaciones 
   insert into detalle_operaciones (idoperacion,idtipotransaccion,idtransaccion,itemdiario)
   values (@operacion,@tipotransaccion,@transaccion,@itemfondo)

   --Insertamos todos los Items en comprobante de compras de fondos fijos Items
   insert into compfondositems (comprobante,aniomes,item,concepto,importe,cuentaneto,neto,cuentamonto,monto,base,idtransaccion,alicuota)
   select @comprobante,aniomes,item,concepto,importe,cuentaneto,neto,cuentamonto,monto,base,@transaccion,alicuota
   from compfondositemstemp 
   where computer=@computer and itemfondo=@itemfondo
   commit transaction
   return @transaccion
end



GO
/****** Object:  StoredProcedure [dbo].[sp_addcompfondoheader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE procedure [dbo].[sp_addcompfondoheader](@comprobante int,@aniomes int,@fecha datetime,
@proveedor int,@tipocomprobante int,@nrocomprobante char(12),@tipofactura char(1),
@totalimporte numeric(18,2),@fecha1venc datetime=null,@fecha2venc datetime=null,
@estado char(1),@fechareal datetime,@centrocosto int, @idOperacion int)
as
begin
	declare @iret int
	insert into compfondosheader (comprobante,aniomes,fecha,proveedor,tipocomprobante,nrocomprobante,tipofactura,totalimporte,fecha1venc,fecha2venc,estado,fechareal,centrocosto)
	values(@comprobante,@aniomes,@fecha,@proveedor,@tipocomprobante,@nrocomprobante,@tipofactura,@totalimporte,@fecha1venc,@fecha2venc,@estado,@fechareal,@centrocosto)

	select @iret=@@identity

	--   if not @idoperacion is null --and not @itemdiario is null
	insert into detalle_operaciones (IdOperacion,IdTipoTransaccion,idTransaccion,itemdiario)
	values (@IdOperacion,3,@iret,99)

	return @iret

end

GO
/****** Object:  StoredProcedure [dbo].[sp_addcompfondoheadertemp]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addcompfondoheadertemp](@computer varchar(100),@itemfondo int,
@comprobante int,@aniomes int,@fecha datetime,
@proveedor int,@tipocomprobante int,@nrocomprobante char(12),@tipofactura char(1),
@totalimporte numeric(18,2),@fecha1venc datetime=null,@fecha2venc datetime=null,
@estado char(1),@fechareal datetime,@centrocosto int)
as
begin
   insert into compfondosheadertemp (computer,itemfondo,idtransaccion,comprobante,aniomes,fecha,proveedor,tipocomprobante,nrocomprobante,tipofactura,totalimporte,fecha1venc,fecha2venc,estado,fechareal,centrocosto)
   values(@computer,@itemfondo,0,@comprobante,@aniomes,@fecha,@proveedor,@tipocomprobante,@nrocomprobante,@tipofactura,@totalimporte,@fecha1venc,@fecha2venc,@estado,@fechareal,@centrocosto)
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addcompfondoitemstemp]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE procedure [dbo].[sp_addcompfondoitemstemp](@computer varchar(100),@itemfondo int,
@comprobante int,@aniomes int,@item int,@tipocomprobante int,@concepto char(3),
@importe numeric(18,2),@cuentaneto int,@neto numeric(18,2),
@cuentamonto int,@monto numeric(18,2),@base numeric(18,2)=0,@Alicuota numeric(18,2)=0)
as
begin
   --Insertamos el Item en comprobante de compras
   insert into compfondositemstemp (computer,itemfondo,comprobante,aniomes,item,concepto,importe,cuentaneto,neto,cuentamonto,monto,base,alicuota)
   values (@computer,@itemfondo,@comprobante,@aniomes,@item,@concepto,@importe,@cuentaneto,@neto,@cuentamonto,@monto,@base,@Alicuota)
end

GO
/****** Object:  StoredProcedure [dbo].[sp_addcompprovheader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO







CREATE       procedure [dbo].[sp_addcompprovheader](@comprobante int,@aniomes int,@fecha datetime,
@proveedor int,@tipocomprobante int,@nrocomprobante char(12),@tipofactura char(1),
@totalimporte numeric(18,2),@fecha1venc datetime=null,@fecha2venc datetime=null,
@estado char(1),@fechareal datetime,@centrocosto int, @N_Cancelado numeric(18,2)=null,
--Los paramatros de idoperacion,idtipotransaccion,itemdiario son para insertar en Detalle_operaciones
@IdOperacion int=null,@IdTipoTransaccion int=null,@itemdiario int=null, @descripcionimporte varchar(255),
@Moneda int, @ImporteOrigen numeric(18,2),@tc numeric(18,4))
as
begin
	declare @iret int
	begin transaction
	insert into compprovheader (comprobante,aniomes,fecha,proveedor,tipocomprobante,nrocomprobante,tipofactura,totalimporte,fecha1venc,fecha2venc,estado,fechareal,centrocosto,cancelado,DescripcionImporte,Moneda,ImporteOrigen,TC)
	values(@comprobante,@aniomes,@fecha,@proveedor,@tipocomprobante,@nrocomprobante,@tipofactura,@totalimporte,@fecha1venc,@fecha2venc,@estado,@fechareal,@centrocosto,@N_cancelado,@descripcionimporte,@Moneda,@ImporteOrigen,@TC)
	select @iret=@@identity

--   if not @idoperacion is null --and not @itemdiario is null
	insert into detalle_operaciones (IdOperacion,IdTipoTransaccion,idTransaccion,itemdiario)
	values (@IdOperacion,1,@iret,@itemdiario)
	commit transaction

	return @iret
end






GO
/****** Object:  StoredProcedure [dbo].[sp_addcompprovitems]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE   procedure [dbo].[sp_addcompprovitems](@comprobante int,@aniomes int,@item int,
@tipoasiento int,@tipocomprobante int,@concepto char(3),@importe numeric(18,2),
@cuentaneto int,@neto numeric(18,2),@cuentamonto int,@monto numeric(18,2),
@idoperacion int,@idtipotransaccion int,@idtransaccion int,@itemdiario int,
@Area int, @Detalle char(20), @bFindCuenta bit=1,@bInsertLast bit=0)
--Parametros:
--@bFindCuenta: Flag, indica si debe buscar la cuenta 
--              con los campos @tipocomprobante y @concepto en Tipo de Comprobante Modelo
--@InsertLast:  Flag, indica que debe insertar el ultimo registro en asientosdiariositems
as
begin
   declare @cuenta int,@debe numeric(18,2),@haber numeric(18,2)
   select @debe=0,@haber=0
   --Asignamos debe o haber y buscamos la cuenta
   if @bInsertLast=0
    begin
      --Si no buscamos la cuenta --> La tomamos desde la cuentaneto o cuentamonto
      if @cuentaneto!=0 and @bFindCuenta=0  
         select @cuenta=@cuentaneto
      else if @cuentamonto!=0 and @bFindCuenta=0
         select @cuenta=@cuentamonto
      --Asignamos el debe
      select @debe=@importe
      if @bFindCuenta=1
         select @cuenta=b.cuenta
         from tipcompmoditems a
         inner join conceptoscontables b on a.concepto=b.concepto
         where a.codigo=@tipocomprobante and a.concepto=@concepto
    end
   else 
    begin --Buscamos la cuenta en la tabla de parametros
       select @haber=@importe
       select @cuenta=Proveedores from ParametrosGeneralesSueldos
    end
   
   if @bInsertLast=0
    begin
      --Insertamos el Item en comprobante de compras
      insert into compprovitems (comprobante,aniomes,item,concepto,importe,cuentaneto,neto,cuentamonto,monto,area,detalle)
      values (@comprobante,@aniomes,@item,@concepto,@importe,@cuentaneto,@neto,@cuentamonto,@monto,@area,@detalle)
    end
   if @importe!=0 
    begin
      --Insertamos el asiento diario
      insert into asientosdiariositems (asiento,item,aniomes,cuenta,debe,haber,observacion,tipoasiento,centrocosto)
      values (@comprobante,@item,@aniomes,@cuenta,@debe,@haber,NULL,@tipoasiento,@area)
      --Insertamos en el detalle de operaciones
      if @bInsertLast!=0
       begin
         insert into detalle_operaciones (IdOperacion,IdTipoTransaccion,idTransaccion,itemdiario)
         values (@IdOperacion,@IdTipoTransaccion,@IdTransaccion,@itemdiario)
       end
    end
end

GO
/****** Object:  StoredProcedure [dbo].[sp_addconcepto]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE   procedure [dbo].[sp_addconcepto] (@Concepto char(3),@Entidad tinyint,@Descripcion char(30),
@Modalidad char(1),@Importe numeric(18,2),@mes int,@ano int,@imputacion_contable int,@Grupo char(1),@idCobertura int)
as 
begin
  insert into conceptos (Concepto,Entidad,Descripcion,Modalidad,Importe,mes,ano,imputacion_contable,grupo,idCobertura)
  values (@Concepto,@Entidad,@Descripcion,@Modalidad,@Importe,@mes,@ano,@imputacion_contable,@grupo,@idCobertura)
end
 



GO
/****** Object:  StoredProcedure [dbo].[sp_addconcepto_sindicato]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addconcepto_sindicato] (@concepto int,@sindicato int)
as
begin
   insert into conceptos_sindicatos (sindicato,concepto)
   values (@sindicato,@concepto)
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addconceptocontable]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addconceptocontable] (@concepto char(3),@descripcion varchar(30),
@alicuota numeric(6,2),@cuenta int)
as 
begin
  insert into conceptoscontables (concepto,descripcion,alicuota,cuenta)
  values (@concepto,@descripcion,@alicuota,@cuenta)
end
 

GO
/****** Object:  StoredProcedure [dbo].[sp_addconceptoimpuesto]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addconceptoimpuesto] (@descripcion varchar(30))
as 
begin
  insert into conceptosimpuestos (descripcion)
  values (@descripcion)
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addconceptolegajo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addconceptolegajo](@legajo int,@orden int,@concepto int,@importe numeric(18,2))
as
begin
   insert into conceptoslegajos(legajo,orden,concepto,importe)
   values (@legajo,@orden,@concepto,@importe)
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addconceptolegajonovedad]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  procedure [dbo].[sp_addconceptolegajonovedad](@añomes int, @Periodo int,@legajo int,@concepto int,@importe numeric(18,2))
as
begin
   declare @orden int
   select @orden=isnull(max(orden),0)+1 from conceptoslegajosnovedades 
   where legajo=@legajo   
   insert into conceptoslegajosnovedades(legajo,orden,concepto,importe,aniomes,periodo)
   values (@legajo,@orden,@concepto,@importe,@añomes,@periodo)
end



GO
/****** Object:  StoredProcedure [dbo].[sp_addconceptoliquidacion]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE  procedure [dbo].[sp_addconceptoliquidacion] (@concepto int,@descripcion varchar(21),
@tipoconcepto int,@modo int,@cuentacontable int, @Aplicable char(1), @Periodo int)
as
begin
   insert into Conceptosliquidacion(concepto,descripcion,tipoconcepto,modo,cuentacontable, LegajosAplicables, Periodo)
   values (@concepto,@descripcion,@tipoconcepto,@modo,@cuentacontable,@Aplicable,@Periodo)
end



GO
/****** Object:  StoredProcedure [dbo].[sp_addconceptoliquidaciondetalle]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addconceptoliquidaciondetalle] (@codigo int,@grupo int,@concepto int,
@operador1 int,@constante1 int,@operador2 int,@constante2 int,
@operador3 int,@constante3 int,@operador4 int,@constante4 int,@signo int)
as
begin
   insert into conceptosliquidaciondetalle (codigo,grupo,concepto,operador1,constante1,operador2,constante2,operador3,constante3,operador4,constante4,signo) 
   values (@codigo,@grupo,@concepto,@operador1,@constante1,@operador2,@constante2,@operador3,@constante3,@operador4,@constante4,@signo)
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addconceptoremunerativo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[sp_addconceptoremunerativo] (@descripcion varchar(21),@tipoconcepto int,
@modo int,@cuentacontable int)
as
begin
   declare @iret int
   begin transaction
   insert into ConceptosRemunerativos(descripcion,tipoconcepto,modo,cuentacontable)
   values (@descripcion,@tipoconcepto,@modo,@cuentacontable)
   select @iret=@@identity
   commit transaction
   return @iret
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addconceptotesoreria]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addconceptotesoreria] (@descripcion varchar(25),@imputacion_contable int,
@modalidad int,@ci char(1),@ce char(1))
as
begin
   declare @iret int
   begin transaction
   insert into conceptos_tesoreria (descripcion,imputacion_contable,modalidad,ci,ce) 
   values (@descripcion,@imputacion_contable,@modalidad,@ci,@ce)
   select @iret=@@identity
   commit transaction
   return @iret
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addcondicion]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addcondicion] (@condicion int,@descripcion varchar(30))
as
begin
   insert into Condiciones (condicion,descripcion) 
   values (@condicion,@descripcion)
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addconstanteliquidacion]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addconstanteliquidacion] (@descripcion varchar(20),@valor numeric(18,2))
as
begin
   declare @iret int
   begin transaction
   insert into constantesliquidacion (descripcion,valor) values (@descripcion,@valor)
   select @iret=@@identity
   commit transaction
   return @iret
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addcuenta]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE procedure [dbo].[sp_addcuenta](@cuenta int,@descripcion varchar(35),@corta int,
@sigla char(5),@Resumida char(10),@tipocuentaContable tinyint,@imputable tinyint,@ubBalance	int=0,@ubResultado int=0)
as
begin
   insert into cuentas (cuenta,descripcion,corta,sigla,Resumida,tipocuentaContable,imputable,ubbalance,ubresultado) 
   values (@cuenta,@descripcion,@corta,@sigla,@Resumida,@tipocuentaContable,@imputable,@ubbalance,@ubresultado)
end
GO
/****** Object:  StoredProcedure [dbo].[sp_adddepositoheader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_adddepositoheader](@deposito int,@aniomes int,
@fecha datetime,@banco int,@numero int,
@total numeric(18,2),@efectivo numeric(18,2),
@clearing int,@conceptotesoreria int)
as 
begin
   insert into depositosheader (deposito,aniomes,fecha,banco,numero,total,efectivo,
   clearing,conceptotesoreria)
   values (@deposito,@aniomes,@fecha,@banco,@numero,@total,@efectivo,
   @clearing,@conceptotesoreria)
end


GO
/****** Object:  StoredProcedure [dbo].[sp_adddepositoitem]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_adddepositoitem](@deposito int,@aniomes int,@item int,
@fecha datetime,@banco int,@sucursal int,@nrocheque int,@importe numeric(18,2),@checked bit)
as 
begin
   insert into depositositems (deposito,aniomes,item,fecha,banco,sucursal,nrocheque,importe,checked)
   values (@deposito,@aniomes,@item,@fecha,@banco,@sucursal,@nrocheque,@importe,@checked)
end


GO
/****** Object:  StoredProcedure [dbo].[sp_adddetalleotrosingresos]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO






CREATE     procedure [dbo].[sp_adddetalleotrosingresos] 
@concepto char(8), @aniomes int, @asiento int, @item int, @tipoasiento int, @ApellidoNombre varchar(50)
as
begin
   insert into detalleotrosingresos (concepto,aniomes,asiento,item,tipoasiento,apellidonombre)
   values (@concepto,@aniomes,@asiento,@item,@tipoasiento,@apellidonombre)
end





GO
/****** Object:  StoredProcedure [dbo].[sp_addDomicilioCobro]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO





CREATE     procedure [dbo].[sp_addDomicilioCobro] 

@Nombre varchar(30), @Calle varchar(30), @Numero int,
@PisoDto varchar(30), @Localidad int, @Provincia int

AS
begin
  insert into DomiciliosdeCobro (Nombre, Calle, Numero, PisoDto, Localidad, Provincia)
  values (@Nombre, @Calle, @Numero, @PisoDto, @Localidad, @Provincia)
end
 




GO
/****** Object:  StoredProcedure [dbo].[sp_addespecialidad]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  procedure [dbo].[sp_addespecialidad] (@especialidad int,@descripcion varchar(30),@actividad varchar(30)='')
as
begin
   insert into especialidades (especialidad,descripcion,actividad) 
   values (@especialidad,@descripcion,@actividad)
end



GO
/****** Object:  StoredProcedure [dbo].[sp_addfamiliar]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[sp_addfamiliar] (@legajo int,@apellido varchar(30),@nombre varchar(30),
@fechanac datetime=NULL,@fechaultimo datetime=NULL,@certificado varchar(30),@parentesco int)
as
begin
   insert into familiares (legajo,apellido,nombre,fechanac,fechaultimo,certificado,parentesco) 
   values (@legajo,@apellido,@nombre,@fechanac,@fechaultimo,@certificado,@parentesco)
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addfamiliarlegajo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addfamiliarlegajo](@legajo int,@orden int,@apellnombre varchar(35),
@sexo int,@fecnac datetime=null,@tipodoc int,@numero int,@parentesco int,
@feccertificado datetime=null,@fecvigencia datetime=null,@fecvencimiento datetime=null)
as
begin
   insert into familiareslegajos (legajo,orden,apellnombre,sexo,fecnac,tipodoc,numero,parentesco,feccertificado,fecvigencia,fecvencimiento)
   values (@legajo,@orden,@apellnombre,@sexo,@fecnac,@tipodoc,@numero,@parentesco,@feccertificado,@fecvigencia,@fecvencimiento)
end

GO
/****** Object:  StoredProcedure [dbo].[sp_addfechalegajo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE   procedure [dbo].[sp_addfechalegajo] (@legajo int,@orden int,@concepto int,
@indicativoantiguedad int,@fecha datetime,@finaliza datetime=null)
as
begin
if @finaliza is null or len(ltrim(rtrim(@finaliza)))=0 or year(@finaliza)<1900
   insert into fechaslegajos (legajo,orden,concepto,indicativoantiguedad,fecha)
   values (@legajo,@orden,@concepto,@indicativoantiguedad,@fecha)
else
   insert into fechaslegajos (legajo,orden,concepto,indicativoantiguedad,fecha,finaliza)
   values (@legajo,@orden,@concepto,@indicativoantiguedad,@fecha,@finaliza)
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addfondofijo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addfondofijo](
@fechaid datetime,
@cuenta  int,
@item   int,
@fecha  datetime,
@tipocomprobante int,
@numero  int,
@debe  numeric(18,2),
@haber  numeric(18,2),
@ctafecha datetime,
@ctanrocomprobante char(12),
@ctatipofactura char(1),
@ctaestado char(1),
@ctaproveedor int,
@ctatipocomp int,
@ctamonto numeric(18,2),
@ctaneto numeric(18,2),
@ctaconceptoimpuesto int)
as 
begin
   insert into fondosfijos (fechaid,cuenta,item,fecha,tipocomprobante,numero,debe,haber,ctafecha,ctanrocomprobante,ctatipofactura,ctaestado,ctaproveedor,ctatipocomp,ctamonto,ctaneto,ctaconceptoimpuesto)
   values (@fechaid,@cuenta,@item,@fecha,@tipocomprobante,@numero,@debe,@haber,@ctafecha,@ctanrocomprobante,@ctatipofactura,@ctaestado,@ctaproveedor,@ctatipocomp,@ctamonto,@ctaneto,@ctaconceptoimpuesto)
end

GO
/****** Object:  StoredProcedure [dbo].[sp_addgrupo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addgrupo] (@grupo char(2),@descripcion varchar(30))
as
begin
   insert into grupos (grupo,descripcion) 
   values (@grupo,@descripcion)
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addgrupoconceptoheader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addgrupoconceptoheader] (@descripcion varchar(30))
as
begin
   declare @iret int
   begin transaction
   insert into gruposconceptosheader (descripcion) values (@descripcion)
   select @iret=@@identity
   commit transaction
   return @iret
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addgrupoconceptoitem]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addgrupoconceptoitem] (@grupo int,@concepto int)
as
begin
   insert into gruposconceptositems (grupo,concepto) values (@grupo,@concepto)
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addgrupousuario]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addgrupousuario](@descripcion varchar(30))
as
begin
   declare @iret int
   begin transaction
   insert into gruposusuarios (descripcion) 
   values (@descripcion)
   select @iret=@@identity
   commit transaction
   return @iret
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addhospital]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addhospital] (@hospital int,@nombre varchar(30),@reparticion int,@filial char(1))
as
begin
   insert into hospitales (hospital,nombre,reparticion,filial)
   values (@hospital,@nombre,@reparticion,@filial)
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addhospitalvoto]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addhospitalvoto] (@hospitalvoto int,@nombre varchar(30))
as
begin
   insert into hospitalesvoto (hospitalvoto,nombre)
   values (@hospitalvoto,@nombre)
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addlocalidad]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addlocalidad] (@descripcion varchar(30))
as
begin
   declare @iret int
   begin transaction
   insert into localidades (descripcion) values (@descripcion)
   select @iret=@@identity
   commit transaction
   return @iret
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addmaestropersonal]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE   procedure [dbo].[sp_addmaestropersonal](@legajo int,@centrocosto int,@apellido varchar(20),
@nombre varchar(20),@tipodocumento int,@numero int,@obrasocial int,@adherentes int,@sindicato int,
@estadocivil int,@califprofesional int,@categoria int,@estado int,@tareacumplida int,
@fechanacimiento datetime=null,@modalidad int,@jornalbasico numeric(18,2)=null,
@jornalacuenta numeric(18,2)=null,@cuil char(13),@zonageografica int,@codigoactividad int,
@domicilio varchar(30),@localidad int,@cpostal char(8),@telefono varchar(20),
@modoantiguedad int,@jubilado int,@situacion int,@condicion int,@sistemajubilacion int,@nacionalidad int,@idcConvenio int)
as 
begin
   insert into maestropersonal(legajo,centrocosto,apellido,nombre,tipodocumento,numero,
   obrasocial,adherentes,sindicato,estadocivil,califprofesional,categoria,estado,
   tareacumplida,fechanacimiento,modalidad,jornalbasico,jornalacuenta,cuil,zonageografica,
   codigoactividad,domicilio,localidad,cpostal,telefono,modoantiguedad,jubilado,situacion,
   condicion,sistemajubilacion,nacionalidad,idcConvenio)
   values(@legajo,@centrocosto,@apellido,@nombre,@tipodocumento,@numero,@obrasocial,
   @adherentes,@sindicato,@estadocivil,@califprofesional,@categoria,@estado,@tareacumplida,
   @fechanacimiento,@modalidad,@jornalbasico,@jornalacuenta,@cuil,@zonageografica,
   @codigoactividad,@domicilio,@localidad,@cpostal,@telefono,@modoantiguedad,@jubilado,
   @situacion,@condicion,@sistemajubilacion,@nacionalidad,@idcConvenio)
end



GO
/****** Object:  StoredProcedure [dbo].[sp_addmodoantiguedad]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addmodoantiguedad] (@descripcion varchar(30))
as
begin
   declare @iret int
   begin transaction
   insert into modoantiguedad (descripcion) values (@descripcion)
   select @iret=@@identity
   commit transaction
   return @iret
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addmotivobaja]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addmotivobaja] (@motivo int,@nombre varchar(30))
as
begin
   insert into motivosbaja (motivo,nombre) 
    values (@motivo,@nombre)
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addnovedadlegajo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addnovedadlegajo](@legajo int,@orden int,@concepto int,
@modalidad int,@importe numeric(18,2))
as
begin
   insert novedadeslegajos (legajo,orden,concepto,modalidad,importe)
   values (@legajo,@orden,@concepto,@modalidad,@importe)
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addobrasocial]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addobrasocial] (@obrasocial int,@descripcion varchar(30))
as
begin
   insert into obrassociales (obrasocial,descripcion) 
    values (@obrasocial,@descripcion)
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addotroconcepto]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addotroconcepto](@Concepto char(8),@Descripcion varchar(30),@Importe numeric(18,2),@Imputacion_contable int)
as
begin
   insert into otrosconceptos(Concepto,Descripcion,Importe,Imputacion_contable)
   values(@Concepto,@Descripcion,@Importe,@Imputacion_contable)
end 


GO
/****** Object:  StoredProcedure [dbo].[sp_addparametrogeneral]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addparametrogeneral](@parametro varchar(50),@valor varchar(250))
as
begin
   insert into parametrosgenerales(parametro,valor)
   values (@parametro,@valor)
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addparametromodoantiguedad]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addparametromodoantiguedad] (@modoantiguedad int,@item int,
@vigentehasta int,@tipocalculo int,@base int,@importe numeric(18,2))
as
begin
   insert into parametrosmodoantiguedad (modoantiguedad,item,vigentehasta,tipocalculo,base,importe)
   values (@modoantiguedad,@item,@vigentehasta,@tipocalculo,@base,@importe)
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addparentesco]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addparentesco] (@descripcion varchar(30),@conceptoliquidacion int)
as
begin
   declare @iret int
   begin transaction
   insert into parentescos (descripcion,conceptoliquidacion) 
   values (@descripcion,@conceptoliquidacion)
   select @iret=@@identity
   commit transaction
   return @iret
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addPedidosheader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO



Create      procedure [dbo].[sp_addPedidosheader](@comprobante int,@aniomes int,@fecha datetime,
@proveedor int,@idPaciente int=0,@tipocomprobante int,@nrocomprobante char(12),@tipofactura char(1),
@totalimporte numeric(18,2),@fecha1venc datetime=null,@fecha2venc datetime=null,
@estado char(1),@fechareal datetime,@centrocosto int, @N_Cancelado numeric(18,2)=null,
--Los paramatros de idoperacion,idtipotransaccion,itemdiario son para insertar en Detalle_operaciones
@IdOperacion int=null,@IdTipoTransaccion int=null,@itemdiario int=null, @descripcionimporte varchar(255),
@Moneda int, @ImporteOrigen numeric(18,2),@tc numeric(18,2))
as
begin
	declare @iret int
	begin transaction
	insert into Pedidos (idPresupuesto,aniomes,fecha,cliente,idPaciente,tipocomprobante,nrocomprobante,tipofactura,totalimporte,fecha1venc,fecha2venc,estado,fechareal,centrocosto,cancelado,DescripcionImporte,Moneda,ImporteOrigen,TC)
	values(@comprobante,@aniomes,@fecha,@proveedor,@idPaciente,@tipocomprobante,@nrocomprobante,@tipofactura,@totalimporte,@fecha1venc,@fecha2venc,@estado,@fechareal,@centrocosto,@N_cancelado,@descripcionimporte,@Moneda,@ImporteOrigen,@TC)
	select @iret=@@identity

--   if not @idoperacion is null --and not @itemdiario is null
	insert into detalle_operaciones (IdOperacion,IdTipoTransaccion,idTransaccion,itemdiario)
	values (@IdOperacion,490,@iret,@itemdiario)
	commit transaction

	return @iret
end








GO
/****** Object:  StoredProcedure [dbo].[sp_addpermisousuario]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addpermisousuario](@usuario int,@grupo int)
as
begin
   insert into permisosusuarios (usuario,grupo) 
   values (@usuario,@grupo)
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addPoheader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO





CREATE  procedure [dbo].[sp_addPoheader](@comprobante int,@aniomes int,@fecha datetime,
@proveedor int,@idPaciente int=0,@tipocomprobante int,@nrocomprobante char(12),@tipofactura char(1),
@totalimporte numeric(18,2),@fecha1venc datetime=null,@fecha2venc datetime=null,
@estado char(1),@fechareal datetime,@centrocosto int, @N_Cancelado numeric(18,2)=null,
--Los paramatros de idoperacion,idtipotransaccion,itemdiario son para insertar en Detalle_operaciones
@IdOperacion int=null,@IdTipoTransaccion int=null,@itemdiario int=null, @descripcionimporte varchar(255),
@Moneda int, @ImporteOrigen numeric(18,2),@tc numeric(18,2),@poInterna as varchar(15), @poProveedor as varchar(15))
as
begin
	declare @iret int
	begin transaction
	insert into PO (idPo,aniomes,fecha,cliente,idPaciente,tipocomprobante,nrocomprobante,tipofactura,totalimporte,fecha1venc,fecha2venc,estado,fechareal,centrocosto,cancelado,DescripcionImporte,Moneda,ImporteOrigen,TC,POInterna,POProveedor)
	values(@comprobante,@aniomes,@fecha,@proveedor,@idPaciente,@tipocomprobante,@nrocomprobante,@tipofactura,@totalimporte,@fecha1venc,@fecha2venc,@estado,@fechareal,@centrocosto,@N_cancelado,@descripcionimporte,@Moneda,@ImporteOrigen,@TC,@POInterna,@POProveedor)
	select @iret=@@identity

--   if not @idoperacion is null --and not @itemdiario is null
	insert into detalle_operaciones (IdOperacion,IdTipoTransaccion,idTransaccion,itemdiario)
	values (@IdOperacion,490,@iret,@itemdiario)
	commit transaction

	return @iret
end



GO
/****** Object:  StoredProcedure [dbo].[sp_addPoliza]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE    procedure [dbo].[sp_addPoliza] (@Concepto char(3), @Desde char(10), @Hasta char(10),
@Descripcion char(25), @Poliza char(75))
as 
begin
  insert into Polizas (Concepto,Desde,Hasta,Descripcion,Poliza)
  values (@Concepto,@Desde,@Hasta,@Descripcion,@Poliza)
end
 




GO
/****** Object:  StoredProcedure [dbo].[sp_addprestamo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE    procedure [dbo].[sp_addprestamo] (@Entidad int, @Codigo int, 
@FechaOtor datetime, @Monto numeric(18,2), @Interes numeric(18,2), 
@Cuotas int, @Cancelado char(1))
as 
  insert into Header_Prestamos 
	(Entidad, Codigo, FechaOtorgamiento, MontoPrestado, TasaInteres, CantCuotas, Cancelado) 
  values (@Entidad, @Codigo, @FechaOtor, @Monto, @Interes, @Cuotas, @Cancelado) 



GO
/****** Object:  StoredProcedure [dbo].[sp_addPresupuestoheader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE      procedure [dbo].[sp_addPresupuestoheader](@comprobante int,@aniomes int,@fecha datetime,
@proveedor int,@idPaciente int=0,@tipocomprobante int,@nrocomprobante char(12),@tipofactura char(1),
@totalimporte numeric(18,2),@fecha1venc datetime=null,@fecha2venc datetime=null,
@estado char(1),@fechareal datetime,@centrocosto int, @N_Cancelado numeric(18,2)=null,
--Los paramatros de idoperacion,idtipotransaccion,itemdiario son para insertar en Detalle_operaciones
@IdOperacion int=null,@IdTipoTransaccion int=null,@itemdiario int=null, @descripcionimporte varchar(255),
@Moneda int, @ImporteOrigen numeric(18,2),@tc numeric(18,2),@idLeyenda int)
as
begin
	declare @iret int
	begin transaction
	insert into Presupuestos (idPresupuesto,aniomes,fecha,cliente,idPaciente,tipocomprobante,nrocomprobante,tipofactura,totalimporte,fecha1venc,fecha2venc,estado,fechareal,centrocosto,cancelado,DescripcionImporte,Moneda,ImporteOrigen,TC,idLeyenda)
	values(@comprobante,@aniomes,@fecha,@proveedor,@idPaciente,@tipocomprobante,@nrocomprobante,@tipofactura,@totalimporte,@fecha1venc,@fecha2venc,@estado,@fechareal,@centrocosto,@N_cancelado,@descripcionimporte,@Moneda,@ImporteOrigen,@TC,@idLeyenda)
	select @iret=@@identity

--   if not @idoperacion is null --and not @itemdiario is null
	insert into detalle_operaciones (IdOperacion,IdTipoTransaccion,idTransaccion,itemdiario)
	values (@IdOperacion,10,@iret,@itemdiario)
	commit transaction

	return @iret
end








GO
/****** Object:  StoredProcedure [dbo].[sp_addproveedor]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE   procedure [dbo].[sp_addproveedor] (@RazonSocial varchar(30),@Contacto varchar(30),
@Domicilio varchar(30),@Localidad int,@Provincia int,@CPostal varchar(8),
@Telefono varchar(30),@TelefonoII varchar(30),@TelefonoIII varchar(30),@CIva int,
@Cuit varchar(14),@Cuenta int,@email varchar(30), @Ganancia int, @Exento char(1),@Sumariza int)
as 
begin
  begin transaction
  declare @iret int
  insert into proveedores (RazonSocial,Contacto,Domicilio,Localidad,Provincia,CPostal,Telefono,TelefonoII,TelefonoIII,CIva,Cuit,Cuenta,Email,TablaGanancia,Exento,Sumariza) 
  values (@RazonSocial,@Contacto,@Domicilio,@Localidad,@Provincia,@CPostal,@Telefono,@TelefonoII,@TelefonoIII,@CIva,@Cuit,@Cuenta,@email,@Ganancia,@Exento,@Sumariza)
  select @iret=@@identity
  commit transaction
  return @iret
end




GO
/****** Object:  StoredProcedure [dbo].[sp_addprovfondo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  procedure [dbo].[sp_addprovfondo](@razonsocial varchar(30),@civa int,@cuit char(14),@cuenta int)
as
begin
   declare @iret int
   begin transaction
   insert into provfondo (razonsocial,civa,cuit,cuenta) 
   values (@razonsocial,@civa,@cuit,@cuenta)
   select @iret=@@identity
   commit transaction
   return @iret
end



GO
/****** Object:  StoredProcedure [dbo].[sp_addreparticion]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addreparticion] (@reparticion int,@nombre varchar(30))
as
begin
   insert into reparticiones (reparticion,nombre) 
   values (@reparticion,@nombre)
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addsindicato]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addsindicato] (@descripcion varchar(30))
as
begin
   declare @iret int
   begin transaction
   insert into sindicatos (descripcion) values (@descripcion)
   select @iret=@@identity
   commit transaction
   return @iret
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addsituacion]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addsituacion] (@situacion int,@descripcion varchar(30))
as
begin
   insert into situaciones (situacion,descripcion) 
   values (@situacion,@descripcion)
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addtareacumplida]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addtareacumplida] (@descripcion varchar(30))
as
begin
   declare @iret int
   begin transaction
   insert into TareasCumplidas (descripcion) values (@descripcion)
   select @iret=@@identity
   commit transaction
   return @iret
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addTempCobranza]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create     Procedure [dbo].[sp_addTempCobranza]
	@Computer			varchar(100),
	@N_idTransaccion 		numeric (18,0)
AS

INSERT INTO Temp_Cobranzas
SELECT 	@Computer 		AS computer,
	a.idTransaccion 	AS idTransaccion, 
	b.Imputacion_Contable 	AS cuenta,
	acc.Importe 		AS Importe
FROM aplicacionesCuentasCorrientes acc
inner join DetalleCuentasCorrientes a
on acc.idtransaccioncancelada=a.idtransaccion
	INNER JOIN Conceptos b
		ON a.concepto = b.concepto
WHERE acc.idTransaccion = @N_idTransaccion



GO
/****** Object:  StoredProcedure [dbo].[sp_addTempCobranzaAMM]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO






CREATE      Procedure [dbo].[sp_addTempCobranzaAMM]
	@Computer			varchar(100),
	@N_idTransaccion 		numeric (18,0)
AS

INSERT INTO Temp_Cobranzas
SELECT 	@Computer 		AS computer,
	a.idTransaccion 	AS idTransaccion, 
	b.Imputacion_Contable 	AS cuenta,
	a.Importe 		AS Importe
FROM DetalleCuentasCorrientes a
	INNER JOIN Conceptos b
		ON a.concepto = b.concepto
	inner join CuentasCorrientes cc
		on a.idtransaccion=cc.idtransaccion
WHERE a.idTransaccion = @N_idTransaccion
and cc.entidad<2
union
SELECT 	@Computer 		AS computer,
	a.idTransaccion 	AS idTransaccion, 
	b.Imputacion_Contable 	AS cuenta,
	a.Importe 		AS Importe
FROM DetalleCuentasCorrientes a
	inner join Horarios h
		on h.idHorario=a.concepto
	inner join NominaCursos n
		on n.idCurso=h.idCurso
	INNER JOIN OtrosConceptos b
		ON n.concepto = b.concepto
	inner join CuentasCorrientes cc
		on a.idtransaccion=cc.idtransaccion
WHERE a.idTransaccion = @N_idTransaccion
and cc.entidad=2



GO
/****** Object:  StoredProcedure [dbo].[sp_addtipcompmodheader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[sp_addtipcompmodheader] (@comprobante char(5),@descripcion varchar(25),
@signo int)
as 
begin
  begin transaction
  declare @iret int
  insert into tipcompmodheader (comprobante,descripcion,signo)
  values (@comprobante,@descripcion,@signo)
  select @iret=@@identity
  commit transaction
  return @iret
end

GO
/****** Object:  StoredProcedure [dbo].[sp_addtipcompmoditem]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[sp_addtipcompmoditem] (@codigo int,@concepto char(5),@signo int)
as 
begin
  insert into tipcompmoditems (codigo,concepto,signo)
  values (@codigo,@concepto,@signo)
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addtipocompmodelo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addtipocompmodelo] (@descripcion varchar(25),@concepto char(3),
@signo int,@tipo int)
as 
begin
  begin transaction
  declare @iret int
  insert into TiposComprobantesModelo (descripcion,concepto,signo,tipo)
  values (@descripcion,@concepto,@signo,@tipo)
  select @iret=@@identity
  commit transaction
  return @iret
end

GO
/****** Object:  StoredProcedure [dbo].[sp_addtipventmodheader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[sp_addtipventmodheader] (@comprobante char(5),@descripcion varchar(25),
@signo int)
as 
begin
  begin transaction
  declare @iret int
  insert into tipventmodheader (comprobante,descripcion,signo)
  values (@comprobante,@descripcion,@signo)
  select @iret=@@identity
  commit transaction
  return @iret
end

GO
/****** Object:  StoredProcedure [dbo].[sp_addtipventmoditem]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[sp_addtipventmoditem] (@codigo int,@concepto char(5),@signo int)
as 
begin
  insert into tipventmoditems (codigo,concepto,signo)
  values (@codigo,@concepto,@signo)
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addusuario]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addusuario](@uName char(10),@uPwd char(10),
@sqlName char(10),@sqlPwd char(10))
as
begin
   declare @iret int
   begin transaction
   insert into usuarios (uName,uPwd,sqlName,sqlPwd) 
   values (@uName,@uPwd,@sqlName,@sqlPwd)
   select @iret=@@identity
   commit transaction
   return @iret
end


GO
/****** Object:  StoredProcedure [dbo].[sp_addvencliheader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO






CREATE       procedure [dbo].[sp_addvencliheader](@comprobante int,@aniomes int,@fecha datetime,
@proveedor int,@tipocomprobante int,@nrocomprobante char(12),@tipofactura char(1),
@totalimporte numeric(18,2),@fecha1venc datetime=null,@fecha2venc datetime=null,
@estado char(1),@fechareal datetime,@centrocosto int, @N_Cancelado numeric(18,2)=null,
--Los paramatros de idoperacion,idtipotransaccion,itemdiario son para insertar en Detalle_operaciones
@IdOperacion int=null,@IdTipoTransaccion int=null,@itemdiario int=null, @descripcionimporte varchar(255),
@Moneda int, @ImporteOrigen numeric(18,2),@tc numeric(18,4))
as
begin
	declare @iret int
	begin transaction
	insert into Vencliheader (comprobante,aniomes,fecha,cliente,tipocomprobante,nrocomprobante,tipofactura,totalimporte,fecha1venc,fecha2venc,estado,fechareal,centrocosto,cancelado,DescripcionImporte,Moneda,ImporteOrigen,TC)
	values(@comprobante,@aniomes,@fecha,@proveedor,@tipocomprobante,@nrocomprobante,@tipofactura,@totalimporte,@fecha1venc,@fecha2venc,@estado,@fechareal,@centrocosto,@N_cancelado,@descripcionimporte,@Moneda,@ImporteOrigen,@TC)
	select @iret=@@identity
--   if not @idoperacion is null and not @itemdiario is null

	insert into detalle_operaciones (IdOperacion,IdTipoTransaccion,idTransaccion,itemdiario)
	values (@IdOperacion,0,@iret,@itemdiario)
	commit transaction
	return @iret
end








GO
/****** Object:  StoredProcedure [dbo].[sp_addvencliitems]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE   procedure [dbo].[sp_addvencliitems](@comprobante int,@aniomes int,@item int,
@tipoasiento int,@tipocomprobante int,@concepto char(3),@importe numeric(18,2),
@cuentaneto int,@neto numeric(18,2),@cuentamonto int,@monto numeric(18,2),
@idoperacion int,@idtipotransaccion int,@idtransaccion int,@itemdiario int,
@bFindCuenta bit=1,@bInsertLast bit=0)
--@bFindCuenta: Flag, indica si debe buscar la cuenta 
--              con los campos @tipocomprobante y @concepto en Tipo de Comprobante Modelo
--@InsertLast:  Flag, indica que debe insertar el ultimo registro en asientosdiariositems
as
begin
   declare @cuenta int,@debe numeric(18,2),@haber numeric(18,2)
   select @debe=0,@haber=0
   --Asignamos debe o haber y buscamos la cuenta
   if @bInsertLast=0
    begin
      --Si no buscamos la cuenta --> La tomamos desde la cuentaneto o cuentamonto
      if @cuentaneto!=0 and @bFindCuenta=0  
         select @cuenta=@cuentaneto
      else if @cuentamonto!=0 and @bFindCuenta=0
         select @cuenta=@cuentamonto
      --Asignamos el debe
      select @Haber=@importe
      if @bFindCuenta=1
       begin
         select @cuenta=b.cuenta
         from tipventmoditems a
         inner join conceptoscontables b on a.concepto=b.concepto
         where a.codigo=@tipocomprobante and a.concepto=@concepto
       end
    end
   else
    begin
       select @Debe=@importe
       select @cuenta=Deudores from parametrosgeneralesSueldos 
    end
   if @bInsertLast=0
    begin
      --Insertamos el Item en comprobante de ventas
      insert into vencliitems (comprobante,aniomes,item,concepto,importe,cuentaneto,neto,cuentamonto,monto)
      values (@comprobante,@aniomes,@item,@concepto,@importe,@cuentaneto,@neto,@cuentamonto,@monto)
    end
   if @importe!=0
    begin
      --Insertamos el asiento diario
      insert into asientosdiariositems (asiento,item,aniomes,cuenta,debe,haber,observacion,tipoasiento)
      values (@comprobante,@item,@aniomes,@cuenta,@debe,@haber,NULL,@tipoasiento)
      --Insertamos en el detalle de operaciones
      if @bInsertLast!=0
       begin
         insert into detalle_operaciones (IdOperacion,IdTipoTransaccion,idTransaccion,itemdiario)
         values (@IdOperacion,@IdTipoTransaccion,@IdTransaccion,@itemdiario)
       end
    end
end



GO
/****** Object:  StoredProcedure [dbo].[sp_addzonageografica]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_addzonageografica] (@zonageografica int,@descripcion varchar(30))
as
begin
   insert into ZonasGeograficas (zonageografica,descripcion) 
   values (@zonageografica,@descripcion)
end


GO
/****** Object:  StoredProcedure [dbo].[sp_consMesGenerado]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE            PROCEDURE [dbo].[sp_consMesGenerado] 
	@N_socio 		int,  
	@N_Entidad		int, 
	@AnioMes 		char(6)
AS

/********************************************/
/* Este SP consulta si ya tiene generado 	*/
/* el mes para el socio determinado			*/
/* Retorna 1 o mas si encontro el registro	*/
/********************************************/

declare @Mes int

set @Mes = (Select count(documentonumero) from cuentascorrientes 
where entidad = @N_Entidad and concepto = 'MES' 
and socio = @N_Socio and documentonumero = @AnioMes)

return @Mes


GO
/****** Object:  StoredProcedure [dbo].[sp_delalldepositoitem]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delalldepositoitem](@deposito int,@aniomes int)
as 
begin
   delete depositositems 
   where deposito=@deposito and aniomes=@aniomes
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delallfondo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[sp_delallfondo](
@fecha datetime,        --Fecha de cuando se realiza la transaccion
@cuenta int,            --Nro de Cuenta Contable seleccionada
@tipooperacion int,	--Tipo de Operacion (Diario=0)
@tipotransaccion int,	--Tipo de Transaccion (FondosFijos=3)
@tipoasiento int        --Tipo de Asiento (Diario=0)
)
as 
begin
   begin transaction
   --Eliminamos los Items de AsientosDiariosItems
   delete asientosdiariositems
   from header_operaciones b 
   where asientosdiariositems.asiento=b.asientodiario
   and b.fecha=@fecha and b.cuenta=@cuenta and b.tipodeoperacion=@tipooperacion
   and b.tipoasiento=@tipoasiento

   --Eliminamos los Header de AsientosDiariosHeader
   delete asientosdiariosheader
   from header_operaciones b 
   where asientosdiariosheader.asiento=b.asientodiario
   and b.fecha=@fecha and b.cuenta=@cuenta and b.tipodeoperacion=@tipooperacion
   and b.tipoasiento=@tipoasiento

   --Eliminamos los Items de Comprobantes de Fondos Fijos
   delete compfondositems
   from header_operaciones b,detalle_operaciones c,compfondosheader d
   where compfondositems.comprobante=d.comprobante and compfondositems.aniomes=d.aniomes
   and d.idtransaccion=c.idtransaccion and c.idtipotransaccion=@tipotransaccion
   and c.idoperacion=b.idoperacion
   and b.fecha=@fecha and b.cuenta=@cuenta and b.tipodeoperacion=@tipooperacion
   and b.tipoasiento=@tipoasiento and c.idtipotransaccion=@tipotransaccion

   --Eliminamos los Header de Comprobantes de Fondos Fijos
   delete compfondosheader
   from header_operaciones b,detalle_operaciones c
   where compfondosheader.idtransaccion=c.idtransaccion
   and c.idoperacion=b.idoperacion and c.idtipotransaccion=@tipotransaccion
   and b.fecha=@fecha and b.cuenta=@cuenta and b.tipodeoperacion=@tipooperacion
   and b.tipoasiento=@tipoasiento and c.idtipotransaccion=@tipotransaccion

   --Eliminamos los items de Detalle de Operaciones
   delete detalle_operaciones
   from header_operaciones b
   where b.idoperacion=detalle_operaciones.idoperacion
   and b.fecha=@fecha and b.cuenta=@cuenta and b.tipodeoperacion=@tipooperacion
   and b.tipoasiento=@tipoasiento and detalle_operaciones.idtipotransaccion=@tipotransaccion

   --Eliminamos los Header de Header de Operaciones
   delete header_operaciones 
   where fecha=@fecha and cuenta=@cuenta and tipodeoperacion=@tipooperacion
   and tipoasiento=@tipoasiento
   commit transaction
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delallfondotemp]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[sp_delallfondotemp](@computer varchar(100),@itemfondo int)
as 
begin
   --Eliminamos el Header
   delete CompFondosHeaderTemp
   where computer=@computer and itemfondo=@itemfondo
   --Eliminamos los Items
   delete CompFondosItemsTemp
   where computer=@computer and itemfondo=@itemfondo
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delasientodiarioitem]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[sp_delasientodiarioitem] (@asiento int,@item int,@aniomes int,
@tipoasiento int,@bDeleteItem bit=1)
--Parametro: 
--@bDeleteItem:	Indica si se quiere borrar el registro de la tabla AsientosDiariosItems
--              debido a que solo puede ocurrir que hayan cambiado la cuenta (idTipoTransaccion=null)
as
begin
   declare @idoperacion int,@itipotransaccion int,@idtransaccion int
   select @idoperacion=c.idoperacion,@itipotransaccion=c.idtipotransaccion,
   @idtransaccion=c.idtransaccion
   from asientosdiariositems a 
   inner join header_operaciones b on a.asiento=b.asientodiario and a.aniomes=b.aniomes
   left join detalle_operaciones c on b.idoperacion=c.idoperacion and a.item=c.itemdiario
   where a.asiento=@asiento and a.aniomes=@aniomes and a.item=@item
   --Borramos en las otras tablas
   if @itipotransaccion=0 --Borramos las cuentas a cobrar (VenCliHeader)
      delete vencliheader where idtransaccion=@idtransaccion
   else if @itipotransaccion=1 --Borramos las cuentas a pagar (CompProvHeader)
      delete compprovheader where idtransaccion=@idtransaccion
   else if @itipotransaccion=2 --Borramos las cuentas de valores (ValoresTesoreria)
      delete valorestesoreria where idtransaccion=@idtransaccion
   --Borramos el detalle de operaciones
   delete detalle_operaciones where idoperacion=@idoperacion and 
   idtransaccion=@idtransaccion and itemdiario=@item
   if @bDeleteItem=1
    begin
      --Borramos el asiento
      delete asientosdiariositems where asiento=@asiento and item=@item
   end
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delbanco]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delbanco] (@banco int)
as
begin
   delete bancos 
   where banco=@banco
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delcalificprofesional]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delcalificprofesional] (@califprofesional int)
as
begin
   delete calificprofesionales 
   where califprofesional=@califprofesional
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delcargoasociacion]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delcargoasociacion] (@cargo int)
as
begin
   delete cargosasociacion
   where cargo=@cargo
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delcategoria]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delcategoria] (@categoria int)
as
begin
   delete categorias
   where categoria=@categoria
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delcategoriaiva]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delcategoriaiva] (@idciva int)
as
begin
   delete categorias_iva
   where idciva=@idciva
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delcentrocosto]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delcentrocosto] (@centrocosto int)
as
begin
   delete centrosdecostos
   where centrocosto=@centrocosto
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delchequera]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  procedure [dbo].[sp_delchequera] (@item int)
as
begin
   delete chequeras
   where item=@item
end



GO
/****** Object:  StoredProcedure [dbo].[sp_delcliente]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delcliente] (@Codigo int)
as 
begin
  delete clientes
  where codigo=@codigo
end

GO
/****** Object:  StoredProcedure [dbo].[sp_delcobrador]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delcobrador] (@cobrador int)
as
begin
   delete cobradores
   where cobrador=@cobrador
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delcodigoactividad]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delcodigoactividad] (@codigoactividad int)
as
begin
   delete codigosactividades
   where codigoactividad=@codigoactividad
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delcompfondoheader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[sp_delcompfondoheader](@comprobante int,@aniomes int)
as
begin
   delete compfondosheader 
   where comprobante=@comprobante and aniomes=@aniomes
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delcompfondoitems]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[sp_delcompfondoitems](@comprobante int,@aniomes int)
as
begin
   --Borramos todos los detalles de operacionesa
   delete detalle_operaciones
   where idoperacion=(
   select idoperacion 
   from header_operaciones 
   where asientodiario=@comprobante and aniomes=@aniomes 
   and tipoasiento=3 and tipodeoperacion=3)
   --Borramos todos los asientos diarios
   delete asientosdiariositems 
   where asiento=@comprobante and aniomes=@aniomes and tipoasiento=3
   --Borramos todos los items de comprobante de ventas
   delete compfondositems 
   where comprobante=@comprobante and aniomes=@aniomes
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delcompprovheader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[sp_delcompprovheader](@comprobante int,@aniomes int)
as
begin
   delete compprovheader 
   where comprobante=@comprobante and aniomes=@aniomes
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delcompprovitems]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[sp_delcompprovitems](@comprobante int,@aniomes int)
as
begin
   --Borramos todos los detalles de operacionesa
   delete detalle_operaciones
   where idoperacion=(
   select idoperacion 
   from header_operaciones 
   where asientodiario=@comprobante and aniomes=@aniomes 
   and tipoasiento=3 and tipodeoperacion=3)
   --Borramos todos los asientos diarios
   delete asientosdiariositems 
   where asiento=@comprobante and aniomes=@aniomes and tipoasiento=3
   --Borramos todos los items de comprobante de ventas
   delete compprovitems 
   where comprobante=@comprobante and aniomes=@aniomes
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delconcepto]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delconcepto] (@Concepto char(3))
as 
begin
  delete conceptos 
  where concepto=@concepto
end
 

GO
/****** Object:  StoredProcedure [dbo].[sp_delconcepto_sindicato]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delconcepto_sindicato] (@concepto int,@sindicato int)
as
begin
   delete conceptos_sindicatos 
   where sindicato=@sindicato and concepto=@concepto
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delconceptocontable]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delconceptocontable] (@concepto char(3))
as 
begin
  delete conceptoscontables
  where concepto=@concepto
end

GO
/****** Object:  StoredProcedure [dbo].[sp_delconceptoimpuesto]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delconceptoimpuesto] (@concepto int)
as 
begin
  delete conceptosimpuestos 
  where concepto=@concepto
end
 

GO
/****** Object:  StoredProcedure [dbo].[sp_delconceptolegajo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delconceptolegajo](@legajo int,@orden int)
as
begin
   delete conceptoslegajos 
   where legajo=@legajo and orden=@orden
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delconceptolegajonovedad]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  procedure [dbo].[sp_delconceptolegajonovedad](@añomes int, @Periodo int,@legajo int,@orden int)
as
begin
   delete conceptoslegajosnovedades 
   where legajo=@legajo and orden=@orden and aniomes=@añomes and periodo=@Periodo
end



GO
/****** Object:  StoredProcedure [dbo].[sp_delconceptoliquidacion]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[sp_delconceptoliquidacion] (@concepto int)
as
begin
   delete Conceptosliquidacion
   where concepto=@concepto
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delconceptoliquidaciondetalle]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delconceptoliquidaciondetalle] (@codigo int)
as
begin
   delete conceptosliquidaciondetalle 
   where codigo=@codigo
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delconceptoremunerativo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[sp_delconceptoremunerativo] (@concepto int)
as
begin
   delete ConceptosRemunerativos 
   where concepto=@concepto
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delconceptotesoreria]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delconceptotesoreria] (@idConcepto_Tesoreria int)
as
begin
   delete conceptos_tesoreria 
   where idConcepto_Tesoreria=@idConcepto_Tesoreria
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delcondicion]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delcondicion] (@condicion int)
as
begin
   delete condiciones
   where condicion=@condicion
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delconstanteliquidacion]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delconstanteliquidacion] (@constante int)
as
begin
   delete constantesliquidacion 
   where constante=@constante
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delcuenta]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delcuenta](@cuenta int)
as
begin
   delete cuentas 
   where cuenta=@cuenta
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delDomicilioCobro]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE    procedure [dbo].[sp_delDomicilioCobro](@idDomicilio int)
as
begin
   delete DomiciliosdeCobro
   where idDomicilio = @idDomicilio
end





GO
/****** Object:  StoredProcedure [dbo].[sp_delespecialidad]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delespecialidad] (@especialidad int)
as
begin
   delete especialidades
   where especialidad=@especialidad
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delfamiliar]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[sp_delfamiliar] (@legajo int)
as
begin
   delete familiares 
   where legajo=@legajo 
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delfamiliarlegajo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delfamiliarlegajo](@legajo int,@orden int)
as
begin
   delete familiareslegajos 
   where legajo=@legajo and orden=@orden
end

GO
/****** Object:  StoredProcedure [dbo].[sp_delfechalegajo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delfechalegajo] (@legajo int,@orden int)
as
begin
   delete fechaslegajos 
   where legajo=@legajo and orden=@orden
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delgrupo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delgrupo] (@grupo char(2))
as
begin
   delete grupos
   where grupo=@grupo
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delgrupoconceptoheader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delgrupoconceptoheader] (@grupo int)
as
begin
   delete gruposconceptosheader 
   where grupo=@grupo
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delgrupoconceptoitem]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delgrupoconceptoitem] (@grupo int,@concepto int)
as
begin
   delete gruposconceptositems 
   where grupo=@grupo and concepto=@concepto
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delgrupousuario]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delgrupousuario](@grupo int)
as
begin
   delete gruposusuarios 
   where grupo=@grupo
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delhospital]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  procedure [dbo].[sp_delhospital] (@hospital int)
as
begin
   delete hospitales
   where idhospital=@hospital
end



GO
/****** Object:  StoredProcedure [dbo].[sp_delhospitalvoto]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delhospitalvoto] (@hospitalvoto int)
as
begin
   delete hospitalesvoto
   where hospitalvoto=@hospitalvoto
end


GO
/****** Object:  StoredProcedure [dbo].[sp_dellocalidad]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_dellocalidad] (@localidad int)
as
begin
   delete localidades
   where localidad=@localidad
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delmodoantiguedad]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delmodoantiguedad] (@modoantiguedad int)
as
begin
   delete modoantiguedad
   where modoantiguedad=@modoantiguedad
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delmotivobaja]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delmotivobaja] (@motivo int)
as
begin
   delete motivosbaja
   where motivo=@motivo
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delnovedadlegajo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delnovedadlegajo](@legajo int)
as
begin
   delete novedadeslegajos 
   where legajo=@legajo
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delobrasocial]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delobrasocial] (@obrasocial int)
as
begin
   delete obrassociales
   where obrasocial=@obrasocial
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delotroconcepto]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delotroconcepto](@Concepto char(8))
as
begin
   delete otrosconceptos 
   where concepto=@concepto
end 


GO
/****** Object:  StoredProcedure [dbo].[sp_delparametrogeneral]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delparametrogeneral](@parametro varchar(50))
as
begin
   delete parametrosgenerales 
   where parametro=@parametro
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delparametromodoantiguedad]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delparametromodoantiguedad] (@modoantiguedad int,@item int)
as
begin
   delete parametrosmodoantiguedad 
   where modoantiguedad=@modoantiguedad and item=@item
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delparentesco]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delparentesco] (@parentesco int)
as
begin
   delete parentescos
   where parentesco=@parentesco
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delpermisousuario]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delpermisousuario](@usuario int,@grupo int=null)
as
begin
   if not @grupo is null
      delete permisosusuarios 
      where usuario=@usuario and grupo=@grupo
   else
      delete permisosusuarios 
      where usuario=@usuario
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delPoliza]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO





CREATE     procedure [dbo].[sp_delPoliza](@idPoliza int)
as
begin
   delete polizas
   where idPoliza=@idPoliza
end






GO
/****** Object:  StoredProcedure [dbo].[sp_delproveedor]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delproveedor] (@Codigo int)
as 
begin
  delete proveedores
  where codigo=@codigo
end

GO
/****** Object:  StoredProcedure [dbo].[sp_delprovfondo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  procedure [dbo].[sp_delprovfondo](@proveedor int)
as
begin
   delete provfondo
   where proveedor=@proveedor 
end



GO
/****** Object:  StoredProcedure [dbo].[sp_delreparticion]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delreparticion] (@reparticion int)
as
begin
   delete reparticiones
   where reparticion=@reparticion
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delsindicato]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delsindicato] (@sindicato int)
as
begin
   delete sindicatos
   where sindicato=@sindicato
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delsituacion]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delsituacion] (@situacion int)
as
begin
   delete situaciones
   where situacion=@situacion
end


GO
/****** Object:  StoredProcedure [dbo].[sp_deltareacumplida]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_deltareacumplida] (@tareacumplida int)
as
begin
   delete tareascumplidas
   where tareacumplida=@tareacumplida
end


GO
/****** Object:  StoredProcedure [dbo].[sp_deltipcompmodheader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[sp_deltipcompmodheader] (@codigo int)
as 
begin
  delete tipcompmodheader 
  where codigo=@codigo
end

GO
/****** Object:  StoredProcedure [dbo].[sp_deltipcompmoditem]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[sp_deltipcompmoditem] (@codigo int,@concepto char(5))
as 
begin
  delete tipcompmoditems
  where codigo=@codigo and concepto=@concepto
end

GO
/****** Object:  StoredProcedure [dbo].[sp_deltipocompmodelo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_deltipocompmodelo] (@codigo int)
as 
begin
  delete TiposComprobantesModelo 
  where codigo=@codigo
end

GO
/****** Object:  StoredProcedure [dbo].[sp_deltipventmodheader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[sp_deltipventmodheader] (@codigo int)
as 
begin
  delete tipventmodheader 
  where codigo=@codigo
end

GO
/****** Object:  StoredProcedure [dbo].[sp_deltipventmoditem]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[sp_deltipventmoditem] (@codigo int,@concepto char(5))
as 
begin
  delete tipventmoditems
  where codigo=@codigo and concepto=@concepto
end

GO
/****** Object:  StoredProcedure [dbo].[sp_delusuario]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delusuario](@idUsuario int)
as
begin
   delete usuarios 
   where idusuario=@idusuario
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delvalortesoreria]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  procedure [dbo].[sp_delvalortesoreria] (@idTransaccion int, @idOperacion int)
as
begin
   	delete valorestesoreria
   	where idTransaccion=@idTransaccion

	Delete detalle_operaciones
	where idOperacion = @idOperacion and idTransaccion = @idTransaccion and idTipoTransaccion = 2	

end



GO
/****** Object:  StoredProcedure [dbo].[sp_delvencliitems]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delvencliitems](@comprobante int,@aniomes int)
as
begin
   --Borramos todos los detalles de operaciones
   delete detalle_operaciones
   where idoperacion=(
   select idoperacion 
   from header_operaciones 
   where asientodiario=@comprobante and aniomes=@aniomes 
   and tipoasiento=4 and tipodeoperacion=4)
   --Borramos todos los asientos diarios
   delete asientosdiariositems 
   where asiento=@comprobante and aniomes=@aniomes and tipoasiento=4
   --Borramos todos los items de comprobante de ventas
   delete vencliitems 
   where comprobante=@comprobante and aniomes=@aniomes
end


GO
/****** Object:  StoredProcedure [dbo].[sp_delzonageografica]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_delzonageografica] (@zonageografica int)
as
begin
   delete zonasgeograficas
   where zonageografica=@zonageografica
end


GO
/****** Object:  StoredProcedure [dbo].[sp_getasientosdiariositems]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  procedure [dbo].[sp_getasientosdiariositems](@asiento int,@aniomes int)
as
begin
--Tipo de Transaccion: NULL
select a.asiento,a.item,a.aniomes,a.tipoasiento,a.cuenta,a.centrocosto,a.debe,a.haber,a.observacion,e.TipoCuentaContable,
null idTipoTransaccion,null idTransaccion,null FechaEmision,null Vencimiento,null Banco,null valCuenta,
null Sucursal,null Numero,null NumeroInterno,null Firma,null Importe,null Observaciones,
null proveedor,null tipocomprobante,null nrocomprobante,null totalimporte,null estado,
null tipofactura,e.corta
from asientosdiariositems a
inner join header_operaciones b on a.aniomes=b.aniomes and a.asiento=b.AsientoDiario and a.tipoasiento=b.tipoasiento and b.TipoAsiento=0
left  join cuentas e on a.cuenta=e.cuenta
where a.aniomes=@aniomes and a.asiento=@asiento 
/*and
not exists(select * from detalle_operaciones x where b.idoperacion=x.idoperacion and a.item=x.itemdiario)
union
--Tipo de Transaccion: Valores
select a.asiento,a.item,a.aniomes,a.tipoasiento,a.cuenta,a.centrocosto,a.debe,a.haber,a.observacion,e.TipoCuentaContable,
c.idTipoTransaccion,c.idTransaccion,d.FechaEmision,d.Vencimiento,d.Banco,d.Cuenta valCuenta,d.Sucursal,d.Numero,
d.NumeroInterno,d.Firma,d.Importe,d.Observaciones,NULL proveedor,NULL tipocomprobante,NULL nrocomprobante,NULL totalimporte,NULL estado,
NULL tipofactura,e.corta
from asientosdiariositems a
inner join header_operaciones b on a.aniomes=b.aniomes and a.asiento=b.AsientoDiario and a.tipoasiento=b.tipoasiento and b.TipoAsiento=0
inner join detalle_operaciones c on b.idoperacion=c.idoperacion and a.item=c.itemdiario
inner join valorestesoreria d on c.idtransaccion=d.idtransaccion
left  join cuentas e on a.cuenta=e.cuenta
where c.idTipoTransaccion=2 and a.aniomes=@aniomes and a.asiento=@asiento
union
--Tipo de Transaccion: Cuentas a Pagar
select a.asiento,a.item,a.aniomes,a.tipoasiento,a.centrocosto,a.cuenta,a.debe,a.haber,a.observacion,e.TipoCuentaContable,
c.idTipoTransaccion,c.idTransaccion,f.fecha FechaEmision,null Vencimiento,null Banco,null valCuenta,
null Sucursal,null Numero,null NumeroInterno,null Firma,null Importe,null Observaciones,
f.proveedor,f.tipocomprobante,
f.nrocomprobante,f.totalimporte,f.estado,f.tipofactura,e.corta
from asientosdiariositems a
inner join header_operaciones b on a.aniomes=b.aniomes and a.asiento=b.AsientoDiario and a.tipoasiento=b.tipoasiento and b.TipoAsiento=0
inner join detalle_operaciones c on b.idoperacion=c.idoperacion and a.item=c.itemdiario
inner join compprovheader f on c.idtransaccion=f.idtransaccion
left  join cuentas e on a.cuenta=e.cuenta
where c.idTipoTransaccion=1 and a.aniomes=@aniomes and a.asiento=@asiento
union
--Tipo de Transaccion: Cuentas a Cobrar
select a.asiento,a.item,a.aniomes,a.tipoasiento,a.cuenta,a.centrocosto,a.debe,a.haber,a.observacion,e.TipoCuentaContable,
c.idTipoTransaccion,c.idTransaccion,f.fecha FechaEmision,null Vencimiento,null Banco,null valCuenta,
null Sucursal,null Numero,null NumeroInterno,null Firma,null Importe,null Observaciones,
f.cliente proveedor,f.tipocomprobante,
f.nrocomprobante,f.totalimporte,f.estado,f.tipofactura,e.corta
from asientosdiariositems a
inner join header_operaciones b on a.aniomes=b.aniomes and a.asiento=b.AsientoDiario and a.tipoasiento=b.tipoasiento and b.TipoAsiento=0
inner join detalle_operaciones c on b.idoperacion=c.idoperacion and a.item=c.itemdiario
inner join vencliheader f on c.idtransaccion=f.idtransaccion
left  join cuentas e on a.cuenta=e.cuenta
where c.idTipoTransaccion=0 and a.aniomes=@aniomes and a.asiento=@asiento*/
order by a.item
end



GO
/****** Object:  StoredProcedure [dbo].[sp_getasientosdiariositemsDiario]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create  procedure [dbo].[sp_getasientosdiariositemsDiario]
(
@ComputerName varchar(50)='CASA-78CD17791F'
)
as
select a.asiento,a.item,a.aniomes,a.tipoasiento,a.cuenta,a.centrocosto,a.debe,a.haber,a.observacion,
tipodecomprobante,c.corta,tipocuentacontable,a.tipodeComprobante
from asientosdiariositemsDiario a
inner join cuentas c
on a.cuenta=c.cuenta
where Usuario=@ComputerName


GO
/****** Object:  StoredProcedure [dbo].[sp_getasientosdiariositemsVarios]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


Create  procedure [dbo].[sp_getasientosdiariositemsVarios](@asiento int,@aniomes int, @TipoAsiento int)
as
begin
--Tipo de Transaccion: NULL
select a.asiento,a.item,a.aniomes,a.tipoasiento,a.cuenta,a.centrocosto,a.debe,a.haber,a.observacion,e.TipoCuentaContable,
null idTipoTransaccion,null idTransaccion,null FechaEmision,null Vencimiento,null Banco,null valCuenta,
null Sucursal,null Numero,null NumeroInterno,null Firma,null Importe,null Observaciones,
null proveedor,null tipocomprobante,null nrocomprobante,null totalimporte,null estado,
null tipofactura,e.corta
from asientosdiariositems a
inner join header_operaciones b on a.aniomes=b.aniomes and a.asiento=b.AsientoDiario and a.tipoasiento=b.tipoasiento and b.TipoAsiento=@TipoAsiento
left  join cuentas e on a.cuenta=e.cuenta
where a.aniomes=@aniomes and a.asiento=@asiento 
/*and
not exists(select * from detalle_operaciones x where b.idoperacion=x.idoperacion and a.item=x.itemdiario)
union
--Tipo de Transaccion: Valores
select a.asiento,a.item,a.aniomes,a.tipoasiento,a.cuenta,a.centrocosto,a.debe,a.haber,a.observacion,e.TipoCuentaContable,
c.idTipoTransaccion,c.idTransaccion,d.FechaEmision,d.Vencimiento,d.Banco,d.Cuenta valCuenta,d.Sucursal,d.Numero,
d.NumeroInterno,d.Firma,d.Importe,d.Observaciones,NULL proveedor,NULL tipocomprobante,NULL nrocomprobante,NULL totalimporte,NULL estado,
NULL tipofactura,e.corta
from asientosdiariositems a
inner join header_operaciones b on a.aniomes=b.aniomes and a.asiento=b.AsientoDiario and a.tipoasiento=b.tipoasiento and b.TipoAsiento=0
inner join detalle_operaciones c on b.idoperacion=c.idoperacion and a.item=c.itemdiario
inner join valorestesoreria d on c.idtransaccion=d.idtransaccion
left  join cuentas e on a.cuenta=e.cuenta
where c.idTipoTransaccion=2 and a.aniomes=@aniomes and a.asiento=@asiento
union
--Tipo de Transaccion: Cuentas a Pagar
select a.asiento,a.item,a.aniomes,a.tipoasiento,a.centrocosto,a.cuenta,a.debe,a.haber,a.observacion,e.TipoCuentaContable,
c.idTipoTransaccion,c.idTransaccion,f.fecha FechaEmision,null Vencimiento,null Banco,null valCuenta,
null Sucursal,null Numero,null NumeroInterno,null Firma,null Importe,null Observaciones,
f.proveedor,f.tipocomprobante,
f.nrocomprobante,f.totalimporte,f.estado,f.tipofactura,e.corta
from asientosdiariositems a
inner join header_operaciones b on a.aniomes=b.aniomes and a.asiento=b.AsientoDiario and a.tipoasiento=b.tipoasiento and b.TipoAsiento=0
inner join detalle_operaciones c on b.idoperacion=c.idoperacion and a.item=c.itemdiario
inner join compprovheader f on c.idtransaccion=f.idtransaccion
left  join cuentas e on a.cuenta=e.cuenta
where c.idTipoTransaccion=1 and a.aniomes=@aniomes and a.asiento=@asiento
union
--Tipo de Transaccion: Cuentas a Cobrar
select a.asiento,a.item,a.aniomes,a.tipoasiento,a.cuenta,a.centrocosto,a.debe,a.haber,a.observacion,e.TipoCuentaContable,
c.idTipoTransaccion,c.idTransaccion,f.fecha FechaEmision,null Vencimiento,null Banco,null valCuenta,
null Sucursal,null Numero,null NumeroInterno,null Firma,null Importe,null Observaciones,
f.cliente proveedor,f.tipocomprobante,
f.nrocomprobante,f.totalimporte,f.estado,f.tipofactura,e.corta
from asientosdiariositems a
inner join header_operaciones b on a.aniomes=b.aniomes and a.asiento=b.AsientoDiario and a.tipoasiento=b.tipoasiento and b.TipoAsiento=0
inner join detalle_operaciones c on b.idoperacion=c.idoperacion and a.item=c.itemdiario
inner join vencliheader f on c.idtransaccion=f.idtransaccion
left  join cuentas e on a.cuenta=e.cuenta
where c.idTipoTransaccion=0 and a.aniomes=@aniomes and a.asiento=@asiento*/
order by a.item
end




GO
/****** Object:  StoredProcedure [dbo].[sp_getnextidint]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_getnextidint](@aniomes int,@tipoasiento int)
as
begin
   declare @sztable varchar(100),@id int
   select @sztable='as_'+convert(varchar(2),@tipoasiento)+'_'+convert(varchar(8),@aniomes)
   --Capturamos el proximo Id
   exec GetNextIdentity @sztable,@id output
   return @id
end

GO
/****** Object:  StoredProcedure [dbo].[sp_lockvalorestesoreria]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  procedure [dbo].[sp_lockvalorestesoreria](@computer varchar(100),@tablename varchar(100),@idtransaccion int)
as
begin
   --Verificamos si se puede lockear
   declare @iret int
   select @iret=0
   begin transaction
   if (select IsNull(locked,0) from valorestesoreria where idtransaccion=@idtransaccion)=0
	begin
		update valorestesoreria set
		locked=1
		where idtransaccion=@idtransaccion
		insert into lockregs (computer,tablename,idtransaccion)
		values (@computer,@tablename,@idtransaccion)
		select @iret=1
	end
   else
	begin
		update valorestesoreria set
		locked=0
		where idtransaccion=@idtransaccion
		Delete from lockregs Where idtransaccion=@idtransaccion
		select @iret=0
	end
   commit transaction
   return @iret
end
--alter table valorestesoreria add locked bit


GO
/****** Object:  StoredProcedure [dbo].[sp_makefondofijo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO





CREATE   procedure [dbo].[sp_makefondofijo](
@computer varchar(100),	--Nombre del puesto de trabajo
@tipooperacion int,		--Tipo de Operacion (Diario=0)
@tipotransaccion int,	--Tipo de Transaccion (FondosFijos=3)
@tipoasiento int,       --Tipo de Asiento (Diario=0)
@fecha datetime,        --Fecha de cuando se realiza la transaccion
@cuenta int,            --Nro de Cuenta Contable seleccionada
@szusuario varchar(10),
@szobservacion varchar(50)  --Usuario que realizó la transaccion
)
as 
begin
   begin transaction
   --Declaracion de variables
   declare @itemfondo int,@item int,@itranscomp int
   declare @totalimporte numeric(18,2),@tipocomprobante int,@nrocomprobante char(12),@proveedor int
   declare @aniomes int,@operacion int,@asiento int
   declare @cuentaasiento int,@importeasiento numeric(18,2)
   declare @Recibo int, @DescCuenta varchar(50)

   --Liampos variables
   select @item=0
   exec sp_toaniomes @fecha,@aniomes output

   --Capturamos el proximo Id de Asiento para Fondo Fijo
   exec @asiento=sp_getnextidint @aniomes,@tipoasiento
   print 'asiento:'+convert(varchar(20),@asiento)

	--Genera el proximo numero de Fondo Fijo
	exec GetNextIdentity 'FondoFijo', @Recibo output

	--Arma Observacion con el numero de Fondo y la descripcion de la cuenta
	set @DescCuenta = (select descripcion from cuentas where cuenta = @cuenta)	
   	--select @szobservacion= 'Fondo Fijo No ' + rtrim(convert(varchar(20),@Recibo)) + ' - ' + @DescCuenta

   --Creamos Operacion
   exec @operacion=ABM_Header_Operaciones @fecha,@tipooperacion,@szobservacion,@szusuario,0,@asiento,@aniomes,@tipoasiento,@cuenta,@Recibo
   print 'operacion:'+convert(varchar(20),@operacion)

   --Creamos Header Asientos Diarios
   exec sp_addasientodiarioheader @asiento,@aniomes,@tipoasiento,@fecha,@szobservacion,0

   --Declaramos el cursor
   declare curCompras cursor local forward_only for
   select itemfondo,totalimporte,tipocomprobante,nrocomprobante,proveedor
   from compfondosheadertemp
   where computer=@computer order by itemfondo asc

   --Abrimos el cursor
   open curCompras

   fetch next from curCompras into @itemfondo,@totalimporte,@tipocomprobante,@nrocomprobante,@proveedor

   while @@fetch_status<>-1
    begin
       --Insertamos el Header,Items de Compras Fondo y el Detalle_Operaciones
       exec @itranscomp=sp_addcompfondo @computer,@itemfondo,@operacion,@tipooperacion,@tipotransaccion,@tipoasiento,@szusuario

       fetch next from curCompras into @itemfondo,@totalimporte,@tipocomprobante,@nrocomprobante,@proveedor
    end
   close curCompras
   deallocate curCompras

   --Insertamos Sumatoria de Todos los demas Items sin Cuenta Neto ni Cuenta Monto en AsientosDiariosItems
   --Declaramos el cursor que recorrerá los items encontrados 
   declare curAsientosItems cursor local forward_only for
   select e.cuenta,sum(a.importe) importe
   from compfondositems a
   inner join compfondosheader b on a.comprobante=b.comprobante and a.aniomes=b.aniomes
   inner join detalle_operaciones c on b.idtransaccion=c.idtransaccion
   inner join tipcompmoditems d on d.codigo=b.tipocomprobante
   inner join conceptoscontables e on a.concepto=e.concepto and d.concepto=e.concepto
   where c.idoperacion=@operacion and a.cuentamonto=0 and a.cuentaneto=0
   group by e.cuenta
   having sum(a.importe)!=0
   union all
   select a.cuentaneto,sum(a.importe) importe
   from compfondositems a
   inner join compfondosheader b on a.comprobante=b.comprobante and a.aniomes=b.aniomes
   inner join detalle_operaciones c on b.idtransaccion=c.idtransaccion
   where c.idoperacion=@operacion and a.cuentaneto!=0
   group by a.cuentaneto
   having sum(a.importe)!=0   
   union all
   select a.cuentamonto,sum(a.importe) importe
   from compfondositems a
   inner join compfondosheader b on a.comprobante=b.comprobante and a.aniomes=b.aniomes
   inner join detalle_operaciones c on b.idtransaccion=c.idtransaccion
   where c.idoperacion=@operacion and a.cuentamonto!=0
   group by a.cuentamonto
   having sum(a.importe)!=0

   open curAsientosItems
   fetch next from curAsientosItems into @cuentaasiento,@importeasiento
   while @@fetch_status<>-1
    begin
       select @item=@item+1
       --Insertamos el Item de AsientosDiariosItems
       insert into asientosdiariositems (asiento,item,aniomes,tipoasiento,cuenta,debe,haber,observacion)
       values (@asiento,@item,@aniomes,@tipoasiento,@cuentaasiento,@importeasiento,0,'')

       fetch next from curAsientosItems into @cuentaasiento,@importeasiento
    end
   close curAsientosItems
   deallocate curAsientosItems

   --Insertamos la cuenta debe en AsientosDiariosItems con la cuenta que nos pasaron 
   --y la sumatoria de todos los valores
   select @item=@item+1
   insert into asientosdiariositems (asiento,item,aniomes,tipoasiento,cuenta,debe,haber,observacion)
   select @asiento,@item,@aniomes,@tipoasiento,@cuenta,0,sum(a.importe),''
   from compfondositems a
   inner join compfondosheader b on a.comprobante=b.comprobante and a.aniomes=b.aniomes
   inner join detalle_operaciones c on b.idtransaccion=c.idtransaccion
   where c.idoperacion=@operacion

   --Eliminamos los datos del temporal 
   delete compfondosheadertemp where computer=@computer
   delete compfondositemstemp where computer=@computer
   commit transaction

   return @operacion
end





GO
/****** Object:  StoredProcedure [dbo].[sp_mkmayorescuentas]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


-- sp_mkmayorescuentas 'Servidor','20090801','20090831',null,127400,127400,'A'

--select *  from rpt_mayorescuentas where computer='Servidor'

CREATE                    Procedure [dbo].[sp_mkmayorescuentas] (
	@computer varchar(100),
	@dtfecini varchar(8),
	@dtfecfin varchar(8),
	@area int = Null,
	@ctaini numeric(10,0) = NULL,
	@ctafin numeric(10,0) = NULL,
	@opcion char(1)= 0
)
as 
   	/* Declaracion variables */
	Declare @C_String as nvarchar(4000)

/* Bloqueo @area */
/*
select @area=null
*/

Declare @tipo int
Declare @fecha datetime
Declare	@asiento int
Declare @tas varchar(50)
Declare	@detalle varchar(50)
Declare @debe numeric(18,2)
Declare @haber numeric(18,2)
Declare @saldo numeric(18,2) 
Declare @Control numeric(18,2) 
Declare @cuenta int
Declare @sape numeric(18,2) 
Declare @apertura varchar(10)
Declare @DCta varchar(50)
Declare @DCtro varchar(50)
Declare @idOp int
Declare @tiOp int
declare @detallediario varchar(100)
declare @detallevt varchar(100)
declare @numerovt int



/* Limpieza variables */
set @saldo=0 
/* Eliminamos datos anteriores */
/* Declaramos el cursor */
select 1 tipo,a.fecha,a.asientoInterno as asiento,
case a.tipoasinterno 
when 0 then "Diario"
when 1 then "Ingresos"
when 10 then "Recibos"
when 2 then "Egresos"
	when 3 then "Compras"
	when 4 then "Ventas"
	when 5 then "Subdiario Sueldos"
	when 6 then "Tesoreria"
end tipoasiento,a.detalle,Debe,haber,debe-haber neto,ai.cuenta,c.descripcion descCuenta,
d.descripcion descCentro,ah.idoperacion,ah.tipodeOperacion,ai.observacion,item --,ah.observacion ObservacionOperacion, ah.observacionComprobante,
--a.tipoasInterno,asientoInterno
from asientosdiariosheader a
inner join asientosdiariositems ai 
on a.asiento=ai.asiento and a.aniomes=ai.aniomes and a.tipoasiento=ai.tipoasiento
inner join header_Operaciones ah
on a.asiento=ah.asientoDiario and a.aniomes=ah.aniomes and a.tipoasiento=ah.tipoasiento
inner join cuentas as c 
on c.cuenta = ai.cuenta
Left join CentrosdeCostos d 
on ai.centrocosto = d.centrocosto
where a.fecha between @dtfecini and @dtfecfin
and (ai.centrocosto =  isnull(@area,ai.centrocosto) OR @area=0)
and ai.cuenta Between @ctaini and @ctafin
and ah.tipodeOperacion<200
and debe+haber<>0
union
select 0 tipo,@dtfecini fecha, 0 asiento,
"Saldo Apertura" tipoasiento,"" detalle, 0 DEBE, 0 haber,sum(debe-haber) neto,ai.cuenta,c.Descripcion descCuenta,"" descCentro,0 Idoperacion,
0 tipodeOperacion,"" observacion,0 item--, ""  ObservacionOperacion,"" ObservacionComprobante, 0 tipoasInterno,0 asientointerno
from asientosdiariosheader a
inner join asientosdiariositems ai 
on a.asiento=ai.asiento and a.aniomes=ai.aniomes and a.tipoasiento=ai.tipoasiento
-- inner join header_Operaciones ah
-- on a.asiento=ah.asientoDiario and a.aniomes=ah.aniomes and a.tipoasiento=ah.tipoasiento
inner join cuentas as c 
on c.cuenta = ai.cuenta
-- Left join CentrosdeCostos d 
-- on ai.centrocosto = d.centrocosto
where a.fecha < @dtfecini 
-- and (ai.centrocosto =  isnull(@area,ai.centrocosto) OR @area=0)
and ai.cuenta Between @ctaini and @ctafin
--and ah.tipodeOperacion<200
and @opcion="A"
Group by ai.cuenta,c.Descripcion
Having sum(debe-haber)<>0

order by ai.cuenta,a.fecha






GO
/****** Object:  StoredProcedure [dbo].[sp_mkmayorescuentasDetallado]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO






-- sp_mkmayorescuentasDetallado 'Servidor','20101201','20110117',null,273500,273500,'A'

--select *  from rpt_mayorescuentas where computer='Servidor'

CREATE                    Procedure [dbo].[sp_mkmayorescuentasDetallado] (
	@computer varchar(100),
	@dtfecini varchar(8),
	@dtfecfin varchar(8),
	@area int = Null,
	@ctaini numeric(10,0) = NULL,
	@ctafin numeric(10,0) = NULL,
	@opcion char(1)= 0
)
as 
   	/* Declaracion variables */
	Declare @C_String as nvarchar(4000)

/* Bloqueo @area */
/*
select @area=null
*/

Declare @tipo int
Declare @fecha datetime
Declare	@asiento int
Declare @tas varchar(50)
Declare	@detalle varchar(50)
Declare @debe numeric(18,2)
Declare @haber numeric(18,2)
Declare @saldo numeric(18,2) 
Declare @Control numeric(18,2) 
Declare @cuenta int
Declare @sape numeric(18,2) 
Declare @apertura varchar(10)
Declare @DCta varchar(50)
Declare @DCtro varchar(50)
Declare @idOp int
Declare @tiOp int
declare @detallediario varchar(100)
declare @detallevt varchar(100)
declare @numerovt int

/* Inicializacion Variables */
set @saldo=0 
/*
	Movimientos de Mayor con respaldo en carteras 
*/
select Distinct 1 tipo,a.fecha,a.asientoInterno as asiento,
case a.tipoasinterno 
when 0 then "AD"
when 1 then "CI"
when 10 then "RC"
when 2 then "CE"
	when 3 then "CP"
	when 4 then "VT"
	when 5 then "SS"
	when 6 then "TS"
end tipoasiento,a.detalle,sum(isnull(Debe,0)) Debe,sum(isnull(haber,0)) Haber,sum(isnull(debe,0)-isnull(haber,0)) neto,ai.cuenta,c.descripcion descCuenta,
d.descripcion descCentro,ah.idoperacion,ah.tipodeOperacion,ai.asiento asientosistema, ai.tipoasiento tipoasientosistema, ai.aniomes,
isnull((select count(*) from detalle_operaciones do
left join compProvHeader cph
on do.idtransaccion=cph.idtransaccion and proveedor=ai.cuenta
inner join compProvItems cpi
on do.idtransaccion=cpi.idtransaccion and cuenta=ai.cuenta
where do.idOperacion=ah.idOperacion and idtipotransaccion=1),0)+
isnull((select count(*) from detalle_operaciones do
left join compFondosHeader cph
on do.idtransaccion=cph.idtransaccion and proveedor=ai.cuenta
inner join compFondosItems cpi
on do.idtransaccion=cpi.idtransaccion and cpi.cuentaNeto=ai.cuenta
where do.idOperacion=ah.idOperacion and idtipotransaccion=3)
+
(select Count(*) from detalle_operaciones do
inner join valoresTesoreria cpi on do.idtransaccion=cpi.idtransaccion and do.idtipotransaccion=2
inner join Conceptos_tesoreria ct on cpi.idConcepto_tesoreria=ct.idConcepto_tesoreria
where do.idoperacion=ah.idoperacion and ct.imputacion_contable=ai.Cuenta and ai.cuenta not between 112000 and 112999)
,0) Casos,
(
(select isnull(sum(basecontable),0) from detalle_operaciones do
inner join CompProvHeader cph on do.idtransaccion=cph.idtransaccion and do.idtipotransaccion=1
inner join CompProvItems cpi on cph.idtransaccion=cpi.idtransaccion 
left join Conceptoscontables ct on cpi.concepto=ct.concepto
where do.idoperacion=ah.idoperacion and (ct.cuenta=ai.Cuenta or cpi.cuenta=ai.cuenta))
+
(select isnull(sum(cpi.importe),0) from detalle_operaciones do
inner join CompFondosHeader cph on do.idtransaccion=cph.idtransaccion and do.idtipotransaccion=3
inner join CompFondosItems cpi on cph.comprobante=cpi.comprobante and cph.aniomes=cpi.aniomes
inner join Conceptoscontables ct on cpi.concepto=ct.concepto
where do.idoperacion=ah.idoperacion and ct.cuenta=ai.Cuenta)
+
(select isnull(sum(cpi.importe),0) from detalle_operaciones do
inner join valoresTesoreria cpi on do.idtransaccion=cpi.idtransaccion and do.idtipotransaccion=2
inner join Conceptos_tesoreria ct on cpi.idConcepto_tesoreria=ct.idConcepto_tesoreria
where do.idoperacion=ah.idoperacion and ct.imputacion_contable=ai.Cuenta)
)
 Control, case when sum(isnull(Debe,0))-sum(isnull(haber,0))>0 then 'D' else 'H' end DH
from asientosdiariosheader a
inner join asientosdiariositems ai 
on a.asiento=ai.asiento and a.aniomes=ai.aniomes and a.tipoasiento=ai.tipoasiento
inner join header_Operaciones ah
on a.asiento=ah.asientoDiario and a.aniomes=ah.aniomes and a.tipoasiento=ah.tipoasiento
inner join cuentas as c 
on c.cuenta = ai.cuenta
Left join CentrosdeCostos d 
on ai.centrocosto = d.centrocosto
where a.fecha between @dtfecini and @dtfecfin
and ai.cuenta Between @ctaini and @ctafin
and ah.tipodeOperacion<200 and debe+haber<>0
and exists (
select do.idOperacion from detalle_operaciones do
left join compProvHeader cph
on do.idtransaccion=cph.idtransaccion and proveedor=ai.cuenta
inner join compProvItems cpi
on do.idtransaccion=cpi.idtransaccion and cuenta=ai.cuenta
where do.idOperacion=ah.idOperacion and idtipotransaccion=1
union
select do.idOperacion from detalle_operaciones do
left join compFondosHeader cph
on do.idtransaccion=cph.idtransaccion and proveedor=ai.cuenta
inner join compFondosItems cpi
on do.idtransaccion=cpi.idtransaccion and cpi.cuentaNeto=ai.cuenta
where do.idOperacion=ah.idOperacion and idtipotransaccion=3
union 
select do.idOperacion from detalle_operaciones do
inner join valoresTesoreria cpi on do.idtransaccion=cpi.idtransaccion and do.idtipotransaccion=2
inner join Conceptos_tesoreria ct on cpi.idConcepto_tesoreria=ct.idConcepto_tesoreria
where do.idoperacion=ah.idoperacion and ct.imputacion_contable=ai.Cuenta and ai.cuenta not between 112000 and 112999
)
Group by a.fecha,a.asientoInterno,
case a.tipoasinterno 
when 0 then "AD"
when 1 then "CI"
when 10 then "RC"
when 2 then "CE"
	when 3 then "CP"
	when 4 then "VT"
	when 5 then "SS"
	when 6 then "TS"
end,a.detalle,ai.cuenta,c.descripcion,d.descripcion,ah.idoperacion,ah.tipodeOperacion,ai.asiento,ai.tipoasiento,ai.aniomes
union
/*
	Items de Mayor sin respaldo en cartera
*/
select Distinct 1 tipo,a.fecha,a.asientoInterno as asiento,
case a.tipoasinterno 
when 0 then "AD"
when 1 then "CI"
when 10 then "RC"
when 2 then "CE"
	when 3 then "CP"
	when 4 then "VT"
	when 5 then "SS"
	when 6 then "TS"
end tipoasiento,a.detalle, Debe, Haber,isnull(debe,0)-isnull(haber,0) neto,ai.cuenta,c.descripcion descCuenta,
d.descripcion descCentro,ah.idoperacion,item tipodeOperacion,ai.asiento asientosistema, ai.tipoasiento tipoasientosistema, ai.aniomes,
0 Casos,
0 Control, case when isnull(Debe,0)-isnull(haber,0)>0 then 'D' else 'H' end DH
from asientosdiariosheader a
inner join asientosdiariositems ai 
on a.asiento=ai.asiento and a.aniomes=ai.aniomes and a.tipoasiento=ai.tipoasiento
inner join header_Operaciones ah
on a.asiento=ah.asientoDiario and a.aniomes=ah.aniomes and a.tipoasiento=ah.tipoasiento
inner join cuentas as c 
on c.cuenta = ai.cuenta
Left join CentrosdeCostos d 
on ai.centrocosto = d.centrocosto
where a.fecha between @dtfecini and @dtfecfin
and ai.cuenta Between @ctaini and @ctafin
and ah.tipodeOperacion<200 and debe+haber<>0
and not exists (
select do.idOperacion from detalle_operaciones do
left join compProvHeader cph
on do.idtransaccion=cph.idtransaccion and proveedor=ai.cuenta
inner join compProvItems cpi
on do.idtransaccion=cpi.idtransaccion and cuenta=ai.cuenta
where do.idOperacion=ah.idOperacion and idtipotransaccion=1
union
select do.idOperacion from detalle_operaciones do
left join compFondosHeader cph
on do.idtransaccion=cph.idtransaccion and proveedor=ai.cuenta
inner join compFondosItems cpi
on do.idtransaccion=cpi.idtransaccion and cpi.cuentaNeto=ai.cuenta
where do.idOperacion=ah.idOperacion and idtipotransaccion=3
union 
select do.idOperacion from detalle_operaciones do
inner join valoresTesoreria cpi on do.idtransaccion=cpi.idtransaccion and do.idtipotransaccion=2
inner join Conceptos_tesoreria ct on cpi.idConcepto_tesoreria=ct.idConcepto_tesoreria
where do.idoperacion=ah.idoperacion and ct.imputacion_contable=ai.Cuenta and ai.cuenta not between 112000 and 112999
)

union
/* Generacion Saldos de Apertura */

select 0 tipo,@dtfecini fecha, 0 asiento,
"SA" tipoasiento,"" detalle, 0 DEBE, 0 haber,sum(debe-haber) neto,ai.cuenta,c.Descripcion descCuenta,"" descCentro,0 Idoperacion,
0 tipodeOperacion,0 AsientoSistema,0 TipoasientoSistema,0 aniomes, 0 casos, 0 Control
, case when sum(debe-haber)>0 then 'D' else 'H' end DH -- ,"" observacion,0 item,0 basecontable,0 idtransaccion
from asientosdiariosheader a
inner join asientosdiariositems ai 
on a.asiento=ai.asiento and a.aniomes=ai.aniomes and a.tipoasiento=ai.tipoasiento
inner join cuentas as c 
on c.cuenta = ai.cuenta
where a.fecha < @dtfecini 
and ai.cuenta Between @ctaini and @ctafin
and @opcion="A"
Group by ai.cuenta,c.Descripcion
Having sum(debe-haber)<>0

order by ai.cuenta,a.fecha






















GO
/****** Object:  StoredProcedure [dbo].[sp_mkmayorescuentasSubdiario]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO


-- sp_mkmayorescuentas 'Servidor','20090801','20090831',null,127400,127400,'A'

--select *  from rpt_mayorescuentas where computer='Servidor'

CREATE                    Procedure [dbo].[sp_mkmayorescuentasSubdiario] (
	@computer varchar(100),
	@dtfecini varchar(8),
	@dtfecfin varchar(8),
	@area int = Null,
	@ctaini numeric(10,0) = NULL,
	@ctafin numeric(10,0) = NULL,
	@opcion char(1)= 0
)
as 
   	/* Declaracion variables */
	Declare @C_String as nvarchar(4000)

/* Bloqueo @area */
/*
select @area=null
*/

Declare @tipo int
Declare @fecha datetime
Declare	@asiento int
Declare @tas varchar(50)
Declare	@detalle varchar(50)
Declare @debe numeric(18,2)
Declare @haber numeric(18,2)
Declare @saldo numeric(18,2) 
Declare @Control numeric(18,2) 
Declare @cuenta int
Declare @sape numeric(18,2) 
Declare @apertura varchar(10)
Declare @DCta varchar(50)
Declare @DCtro varchar(50)
Declare @idOp int
Declare @tiOp int
declare @detallediario varchar(100)
declare @detallevt varchar(100)
declare @numerovt int



/* Limpieza variables */
set @saldo=0 
/* Eliminamos datos anteriores */
/* Declaramos el cursor */
select 1 tipo,a.fecha,a.asiento,
case a.tipoasiento 
when 0 then "Diario"
when 1 then "Caja Ingresos"
when 2 then "Caja Egresos"
	when 3 then "Compras"
	when 4 then "Ventas"
	when 5 then "Subdiario Sueldos"
	when 6 then "Tesoreria"
end tipoasiento,a.detalle,Debe,haber,debe-haber neto,ai.cuenta,c.descripcion descCuenta,
d.descripcion descCentro,ah.idoperacion,ah.tipodeOperacion,ai.observacion,item --,ah.observacion ObservacionOperacion, ah.observacionComprobante,
--a.tipoasInterno,asientoInterno
from asientosdiariosheader a
inner join asientosdiariositems ai 
on a.asiento=ai.asiento and a.aniomes=ai.aniomes and a.tipoasiento=ai.tipoasiento
inner join header_Operaciones ah
on a.asiento=ah.asientoDiario and a.aniomes=ah.aniomes and a.tipoasiento=ah.tipoasiento
inner join cuentas as c 
on c.cuenta = ai.cuenta
Left join CentrosdeCostos d 
on ai.centrocosto = d.centrocosto
where a.fecha between @dtfecini and @dtfecfin
and (ai.centrocosto =  isnull(@area,ai.centrocosto) OR @area=0)
and ai.cuenta Between @ctaini and @ctafin
and ah.tipodeOperacion<200
and debe+haber<>0
union
select 0 tipo,@dtfecini fecha, 0 asiento,
"Saldo Apertura" tipoasiento,"" detalle, 0 DEBE, 0 haber,sum(debe-haber) neto,ai.cuenta,c.Descripcion descCuenta,"" descCentro,0 Idoperacion,
0 tipodeOperacion,"" observacion,0 item--, ""  ObservacionOperacion,"" ObservacionComprobante, 0 tipoasInterno,0 asientointerno
from asientosdiariosheader a
inner join asientosdiariositems ai 
on a.asiento=ai.asiento and a.aniomes=ai.aniomes and a.tipoasiento=ai.tipoasiento
-- inner join header_Operaciones ah
-- on a.asiento=ah.asientoDiario and a.aniomes=ah.aniomes and a.tipoasiento=ah.tipoasiento
inner join cuentas as c 
on c.cuenta = ai.cuenta
-- Left join CentrosdeCostos d 
-- on ai.centrocosto = d.centrocosto
where a.fecha < @dtfecini 
-- and (ai.centrocosto =  isnull(@area,ai.centrocosto) OR @area=0)
and ai.cuenta Between @ctaini and @ctafin
--and ah.tipodeOperacion<200
and @opcion="A"
Group by ai.cuenta,c.Descripcion
Having sum(debe-haber)<>0

order by ai.cuenta,a.fecha






GO
/****** Object:  StoredProcedure [dbo].[sp_mkmayorescuentasSubdiarios]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE  procedure [dbo].[sp_mkmayorescuentasSubdiarios] (
	@computer varchar(100),
	@dtfecini varchar(10),
	@dtfecfin varchar(10),
	@area int = Null,
	@ctaini numeric(10,0) = NULL,
	@ctafin numeric(10,0) = NULL,
	@opcion char(1)= 0,
	@Tipoasiento int
)
as 
   	/* Declaracion variables */
	Declare @C_String as nvarchar(4000)

/* Bloqueo @area */
/*
select @area=null
*/

set @C_String = 'Declare @tipo int Declare @fecha datetime Declare	@asiento int 
Declare @tas varchar(50) Declare @detalle varchar(50) Declare @debe numeric(18,2) 
Declare @haber numeric(18,2) Declare @saldo numeric(18,2) Declare @cuenta int 
Declare @sape numeric(18,2) Declare @apertura varchar(10) Declare @DCta varchar(50) 
Declare @DCtro varchar(50) 
set @saldo=0 '

   	/* Eliminamos datos anteriores */
   	set @C_String = @C_String + ' Delete rpt_mayorescuentas where computer= "' + @computer + '"'
			
	/* Declaramos el cursor */
	set @C_String = @C_String + ' Declare curItems cursor local forward_only for 
select 1 tipo,a.fecha,a.asiento, case a.tipoasiento when 0 then "Diario" when 1 then "Subdiario Ingresos" 
when 2 then "Subdiario Egresos" when 3 then "Subdiario Compras" when 4 then "Subdiario Ventas" 
when 5 then "Subdiario Sueldos" end tipoasiento,(a.detalle + isnull(ho.observacionComprobante,"")) as detalle,sum(b.debe) debe,sum(b.haber) haber, b.cuenta, c.descripcion, d.descripcion 
from asientosdiariosheader a inner join asientosdiariositems b on a.asiento=b.asiento and a.aniomes=b.aniomes and a.tipoasiento=b.tipoasiento 
inner join cuentas as c on c.cuenta = b.cuenta inner Join Header_Operaciones ho on  a.asiento=ho.asientodiario and a.aniomes=ho.aniomes and a.tipoasiento=isnull(ho.tipoasiento,0)
left join CentrosdeCostos d on b.centrocosto = d.centrocosto
where b.haber=0 and a.tipoasiento=' + cast(@tipoasiento as char(1)) + ' and a.fecha between convert(datetime,"'+@dtfecini+'",103) and convert(datetime,"'+@dtfecfin+'",103)'

	if @area is not null and @area <> 0 
		set @C_String = @C_String + ' and b.centrocosto = ' + rtrim(rtrim(convert(char(10),@area))) 

	if @ctaini is not null and @ctaini <> 0 
		set @C_String = @C_String + ' and b.cuenta >= ' + rtrim(rtrim(convert(char(10),@ctaini))) 

	if @ctafin is not null and @ctafin <> 0 
		set @C_String = @C_String + ' and b.cuenta <= ' + rtrim(rtrim(convert(char(10),@ctafin))) 

	set @C_String = @C_String + ' 
group by a.fecha,a.asiento,a.tipoasiento,a.detalle, b.cuenta, c.descripcion, d.descripcion, ho.ObservacionComprobante
union all select 2 tipo,a.fecha,a.asiento, case a.tipoasiento when 0 then "Diario" when 1 then "Subdiario Ingresos" when 2 then "Subdiario Egresos" when 3 then "Subdiario Compras" when 4 then "Subdiario Ventas" 
when 5 then "Subdiario Sueldos" end tipoasiento,(a.detalle + isnull(ho.observacionComprobante,"")) as detalle,sum(b.debe) debe,sum(b.haber) haber, b.cuenta, c.descripcion, d.descripcion from asientosdiariosheader a 
inner join asientosdiariositems b on a.asiento=b.asiento and a.aniomes=b.aniomes and a.tipoasiento=b.tipoasiento inner join cuentas as c on c.cuenta = b.cuenta 
inner Join Header_Operaciones ho on  a.asiento=ho.asientodiario and a.aniomes=ho.aniomes and a.tipoasiento=isnull(ho.tipoasiento,0) 
left join CentrosdeCostos d on b.centrocosto = d.centrocosto where b.debe=0 and a.tipoasiento=' + cast(@tipoasiento as char(1)) + ' and a.fecha between convert(datetime,"'+@dtfecini+'",103) and convert(datetime,"'+@dtfecfin+'",103)'

			if @area is not null and @area <> 0 
				set @C_String = @C_String + ' and b.centrocosto = ' + rtrim(rtrim(convert(char(10),@area))) 

			if @ctaini is not null and @ctaini <> 0 
				set @C_String = @C_String + ' and b.cuenta >= ' + rtrim(rtrim(convert(char(10),@ctaini))) 

			if @ctafin is not null and @ctafin <> 0 
				set @C_String = @C_String + ' and b.cuenta <= ' + rtrim(rtrim(convert(char(10),@ctafin)))

		   	set @C_String = @C_String + ' group by a.fecha,a.asiento,a.tipoasiento,a.detalle, b.cuenta, c.descripcion, d.descripcion, ho.ObservacionComprobante 
order by b.cuenta,a.fecha,a.asiento,a.tipo,a.tipoasiento '

/* Abrimos el cursor */
set @C_String = @C_String + ' open curItems fetch next from curItems into @tipo, @fecha, @asiento, @tas, @detalle, @debe ,@haber, @cuenta, @DCta, @DCtro 
if "'+@opcion+'" = "A" select @sape = IsNull(sum(A2.debe)-sum(A2.haber),0) from asientosdiariosheader as A1 inner join asientosdiariositems A2 on A1.asiento=A2.asiento and A1.aniomes=A2.aniomes and a1.tipoasiento=A2.tipoasiento where A1.tipoasiento=0 and A2.cuenta= @cuenta and A1.fecha < convert(datetime,"'+@dtfecini+'",103)
else select @sape = 0 Select @apertura = right(day(convert(datetime,"'+@dtfecini+'",103))+100,2)+"/"+right(month(convert(datetime,"'+@dtfecini+'",103))+100,2)+"/"+right(year(convert(datetime,"'+@dtfecini+'",103))+10000,4)
while @@fetch_status<>-1 begin if @tipo=1 '
	   	set @C_String = @C_String + ' select @saldo=@saldo+@debe else '
		set @C_String = @C_String + ' select @saldo=@saldo-@haber insert into rpt_mayorescuentas(computer,tipo,fecha,asiento,tipoasiento,detalle,debe,haber,saldo,cuenta,saldoapertura,apertura,desccuenta,desccentro)
values("'+@computer+'",@tipo,@fecha,@asiento,@tas,@detalle,@debe,@haber,@saldo,@cuenta,@sape,@apertura,@DCta,@DCtro) 
fetch next from curItems into @tipo,@fecha,@asiento,@tas,@detalle,@debe,@haber,@cuenta,@DCta,@DCtro 
if "' + @opcion + '" = "A" select @sape = IsNull(sum(A2.debe)-sum(A2.haber),0) from asientosdiariosheader as A1 inner join asientosdiariositems A2 on A1.asiento=A2.asiento and A1.aniomes=A2.aniomes and A1.tipoasiento=A2.tipoasiento where A2.cuenta= @cuenta and a1.tipoasiento=0 and A1.fecha < convert(datetime,"'+@dtfecini+'",103) 
else select @sape = 0 end close curItems deallocate curItems'


/**** Ejecuto la consulta ****/
--EC sp_executesql @C_String
print @C_String




GO
/****** Object:  StoredProcedure [dbo].[sp_mkmayoresporcuenta]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  procedure [dbo].[sp_mkmayoresporcuenta] (
@computer varchar(100),
@dtfecini datetime=null,@dtfecfin datetime=null,
@ctaini int=null,@ctafin int=null,
@opcion char(1)
)
as 
begin
   --Declaracion variables
   declare @tipo int,@asiento int,@idtipoasiento int,@debe numeric(18,2),@haber numeric(18,2),
           @saldo numeric(18,2),@total numeric(18,2),@cuenta int,@item int
   declare @szSQL varchar(8000),@szCond varchar(4000),@szCondApert varchar(4000),@detalle varchar(50)
   --Limpieza variables
   select @total=0,@saldo=0,@szSQL='',@szCond='',@szCondApert='',@detalle=''

   --Eliminamos datos anteriores
   delete rpt_mayorescuentas 
   where computer=@computer

   --Armamos la condicion
   if not @dtfecini is null
    begin
      select @szCond=@szCond+'a.fecha>=convert(datetime,'''+right(day(@dtfecini)+100,2)+'/'+right(month(@dtfecini)+100,2)+'/'+right(year(@dtfecini),4)+''',103) and '
      select @szCondApert=@szCondApert+'a.fecha<convert(datetime,'''+right(day(@dtfecini)+100,2)+'/'+right(month(@dtfecini)+100,2)+'/'+right(year(@dtfecini),4)+''',103) and '
    end
   if not @dtfecfin is null
    begin
      select @szCond=@szCond+'a.fecha<=convert(datetime,'''+right(day(@dtfecfin)+100,2)+'/'+right(month(@dtfecfin)+100,2)+'/'+right(year(@dtfecfin),4)+' 23:59:59'',103) and '
    end
   if not @ctaini is null
    begin
      select @szCond=@szCond+'b.cuenta>='+convert(varchar(20),@ctaini)+' and '
      select @szCondApert=@szCondApert+'b.cuenta>='+convert(varchar(20),@ctaini)+' and '
    end
   if not @ctafin is null
    begin
      select @szCond=@szCond+'b.cuenta<='+convert(varchar(20),@ctafin)+' and '
      select @szCondApert=@szCondApert+'b.cuenta<='+convert(varchar(20),@ctafin)+' and '
    end
   if len(@szCond)>0
    begin
      select @szCond='where '+left(@szCond,len(@szCond)-4)
    end  
   if len(@szCondApert)>0
    begin
      select @szCondApert='where  '+left(@szCondApert,len(@szCondApert)-4)
    end  
   --Insertamos el valor de Apertura
   if @opcion='A'
    begin
      if not @dtfecini is null
         select @detalle='Apertura al: '+right(day(@dtfecini)+100,2)+'/'+right(month(@dtfecini)+100,2)+'/'+right(year(@dtfecini)+10000,4)
      else
         select @detalle='Apertura'
      select @szSQL='insert into rpt_mayorescuentas(computer,tipo,cuenta,saldo,detalle,item)
                     select '''+@computer+''',0,b.cuenta,IsNull(sum(b.debe)-sum(b.haber),0),'''+@detalle+''', 0 item
                     from asientosdiariosheader a
                     inner join asientosdiariositems b on a.asiento=b.asiento and a.aniomes=b.aniomes and a.tipoasiento=b.tipoasiento  
                     '+@szCondApert+' 
                     group by b.cuenta'

      exec(@szSQL)
    end

   --Insertamos todos los valores
   select @szSQL='insert into rpt_mayorescuentas 
                 (computer,tipo,cuenta,asiento,idtipoasiento,tipoasiento,detalle,debe,haber,item)
                 select '''+@computer+''',1 tipo,b.cuenta,a.asiento,a.tipoasiento,
                 case a.tipoasiento 
                 when 0 then ''Diario''
                 when 1 then ''Subdiario Ingresos''
                 when 2 then ''Subdiario Egresos''
                 when 3 then ''Subdiario Compras''
                 when 4 then ''Subdiario Ventas''
                 when 5 then ''Subdiario Sueldos''
                 end dstipoasiento,a.detalle,sum(b.debe) debe,sum(b.haber) haber, item
                 from asientosdiariosheader a
                 inner join asientosdiariositems b on a.asiento=b.asiento and a.aniomes=b.aniomes and a.tipoasiento=b.tipoasiento '
   if len(@szCond)>0 
      select @szSQL=@szSQL+@szCond+' and b.haber=0 '
   else
      select @szSQL=@szSQL+' where b.haber=0 '
   select @szSQL=@szSQL+'group by b.cuenta,a.asiento,a.tipoasiento,a.detalle, item
                 union all
                 select '''+@computer+''',2 tipo,b.cuenta,a.asiento,a.tipoasiento,
                 case a.tipoasiento 
                 when 0 then ''Diario''
                 when 1 then ''Subdiario Ingresos''
                 when 2 then ''Subdiario Egresos''
                 when 3 then ''Subdiario Compras''
                 when 4 then ''Subdiario Ventas''
                 when 5 then ''Subdiario Sueldos''
                 end dstipoasiento,a.detalle,sum(b.debe) debe,sum(b.haber) haber,item
                 from asientosdiariosheader a
                 inner join asientosdiariositems b on a.asiento=b.asiento and a.aniomes=b.aniomes and a.tipoasiento=b.tipoasiento '
   if len(@szCond)>0 
      select @szSQL=@szSQL+@szCond+' and b.debe=0 '
   else
      select @szSQL=@szSQL+' where b.debe=0 '
   select @szSQL=@szSQL+'group by b.cuenta,a.asiento,a.tipoasiento,a.detalle, item
                 order by b.cuenta,a.asiento,a.tipo,a.tipoasiento'
   exec(@szSQL)

   --Declaramos el cursor
   declare curItems cursor local forward_only for
   select cuenta,tipo,asiento,idtipoasiento,debe,haber,saldo
   from rpt_mayorescuentas
   where computer=@computer
   order by cuenta,tipo,fecha,asiento,idtipoasiento

   --Abrimos el cursor
   open curItems
   fetch next from curItems into @cuenta,@tipo,@asiento,@idtipoasiento,@debe,@haber,@saldo 
   declare @lastcuenta int,@lasttipo int
   select @lasttipo=0,@lastcuenta=0
/* if @@fetch_status<>-1
    begin
      if @tipo=0
       begin
          select @total=@saldo,@lastcuenta=0,@lastcuenta=@cuenta
       end
    end
*/ while @@fetch_status<>-1
    begin
       if @tipo=0
        begin
           if @lasttipo!=0 
            begin
           print 'Actualizar'
           print '@lasttipo='+convert(varchar(20),@lasttipo)
           print '@lastcuenta='+convert(varchar(20),@lastcuenta)
           print '@total='+convert(varchar(20),@total)
           print '@total='+convert(varchar(20),@total)
           --Actualizamos los saldos que teniamos
           update rpt_mayorescuentas set
           saldo=@total
           where computer=@computer and @idtipoasiento=@idtipoasiento 
           and asiento=@asiento and tipo=@lasttipo and @cuenta=@lastcuenta
            end
           --Movemos los valores
           select @total=@saldo,@lasttipo=@tipo,@lastcuenta=@cuenta
        end
       else
        begin
          if @tipo=1
             select @total=@total+@debe
          else
             select @total=@total-@haber
          select @lasttipo=@tipo
          update rpt_mayorescuentas set
          saldo=@total
          where computer=@computer and @idtipoasiento=@idtipoasiento 
          and asiento=@asiento and tipo=@tipo and @cuenta=@lastcuenta
        end
       fetch next from curItems into @cuenta,@tipo,@asiento,@idtipoasiento,@debe,@haber,@saldo 
    end
   close curItems
   deallocate curItems
end



GO
/****** Object:  StoredProcedure [dbo].[sp_mkmayoresporcuentaAnalitico]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_mkmayoresporcuentaAnalitico] (
@computer varchar(100),
@dtfecini datetime=null,@dtfecfin datetime=null,
@ctaini int=null,@ctafin int=null,
@opcion char(1)
)
as 
begin
   --Declaracion variables
   declare @tipo int,@asiento int,@idtipoasiento int,@debe numeric(18,2),@haber numeric(18,2),
           @saldo numeric(18,2),@total numeric(18,2),@cuenta int
   declare @szSQL varchar(8000),@szCond varchar(4000),@szCondApert varchar(4000),@detalle varchar(50)
   --Limpieza variables
   select @total=0,@saldo=0,@szSQL='',@szCond='',@szCondApert='',@detalle=''

   --Eliminamos datos anteriores
   delete rpt_mayorescuentas 
   where computer=@computer

   --Armamos la condicion
   if not @dtfecini is null
    begin
      select @szCond=@szCond+'a.fecha>=convert(datetime,'''+right(day(@dtfecini)+100,2)+'/'+right(month(@dtfecini)+100,2)+'/'+right(year(@dtfecini),4)+''',103) and '
      select @szCondApert=@szCondApert+'a.fecha<convert(datetime,'''+right(day(@dtfecini)+100,2)+'/'+right(month(@dtfecini)+100,2)+'/'+right(year(@dtfecini),4)+''',103) and '
    end
   if not @dtfecfin is null
    begin
      select @szCond=@szCond+'a.fecha<=convert(datetime,'''+right(day(@dtfecfin)+100,2)+'/'+right(month(@dtfecfin)+100,2)+'/'+right(year(@dtfecfin),4)+' 23:59:59'',103) and '
    end
   if not @ctaini is null
    begin
      select @szCond=@szCond+'b.cuenta>='+convert(varchar(20),@ctaini)+' and '
      select @szCondApert=@szCondApert+'b.cuenta>='+convert(varchar(20),@ctaini)+' and '
    end
   if not @ctafin is null
    begin
      select @szCond=@szCond+'b.cuenta<='+convert(varchar(20),@ctafin)+' and '
      select @szCondApert=@szCondApert+'b.cuenta<='+convert(varchar(20),@ctafin)+' and '
    end
   if len(@szCond)>0
    begin
      select @szCond='where '+left(@szCond,len(@szCond)-4)
    end  
   if len(@szCondApert)>0
    begin
      select @szCondApert='where '+left(@szCondApert,len(@szCondApert)-4)
    end  
   --Insertamos el valor de Apertura
   if @opcion='A'
    begin
      if not @dtfecini is null
         select @detalle='Apertura al: '+right(day(@dtfecini)+100,2)+'/'+right(month(@dtfecini)+100,2)+'/'+right(year(@dtfecini)+10000,4)
      else
         select @detalle='Apertura'
      select @szSQL='insert into rpt_mayorescuentas(computer,tipo,cuenta,saldo,detalle)
                     select '''+@computer+''',0,b.cuenta,IsNull(sum(b.debe)-sum(b.haber),0),'''+@detalle+'''
                     from asientosdiariosheader a
                     inner join asientosdiariositems b on a.asiento=b.asiento and a.aniomes=b.aniomes and a.tipoasiento=b.tipoasiento  
                     '+@szCondApert+' 
                     group by b.cuenta'
      exec(@szSQL)
    end

   --Insertamos todos los valores
   select @szSQL='insert into rpt_mayorescuentas 
                 (computer,tipo,cuenta,asiento,idtipoasiento,tipoasiento,detalle,debe,haber)
                 select '''+@computer+''',1 tipo,b.cuenta,a.asiento,a.tipoasiento,
                 case a.tipoasiento 
                 when 0 then ''Diario''
                 when 1 then ''Subdiario Ingresos''
                 when 2 then ''Subdiario Egresos''
                 when 3 then ''Subdiario Compras''
                 when 4 then ''Subdiario Ventas''
                 when 5 then ''Subdiario Sueldos''
                 end dstipoasiento,a.detalle,sum(b.debe) debe,sum(b.haber) haber
                 from asientosdiariosheader a
                 inner join asientosdiariositems b on a.asiento=b.asiento and a.aniomes=b.aniomes and a.tipoasiento=b.tipoasiento '
   if len(@szCond)>0 
      select @szSQL=@szSQL+@szCond+' and b.haber=0 '
   else
      select @szSQL=@szSQL+' where b.haber=0 '
   select @szSQL=@szSQL+'group by b.cuenta,a.asiento,a.tipoasiento,a.detalle
                 union all
                 select '''+@computer+''',2 tipo,b.cuenta,a.asiento,a.tipoasiento,
                 case a.tipoasiento 
                 when 0 then ''Diario''
                 when 1 then ''Subdiario Ingresos''
                 when 2 then ''Subdiario Egresos''
                 when 3 then ''Subdiario Compras''
                 when 4 then ''Subdiario Ventas''
                 when 5 then ''Subdiario Sueldos''
                 end dstipoasiento,a.detalle,sum(b.debe) debe,sum(b.haber) haber
                 from asientosdiariosheader a
                 inner join asientosdiariositems b on a.asiento=b.asiento and a.aniomes=b.aniomes and a.tipoasiento=b.tipoasiento '
   if len(@szCond)>0 
      select @szSQL=@szSQL+@szCond+' and b.debe=0 '
   else
      select @szSQL=@szSQL+' where b.debe=0 '
   select @szSQL=@szSQL+'group by b.cuenta,a.asiento,a.tipoasiento,a.detalle
                 order by b.cuenta,a.asiento,a.tipo,a.tipoasiento'
   exec(@szSQL)

   --Declaramos el cursor
   declare curItems cursor local forward_only for
   select cuenta,tipo,asiento,idtipoasiento,debe,haber,saldo
   from rpt_mayorescuentas
   where computer=@computer
   order by cuenta,tipo,fecha,asiento,idtipoasiento

   --Abrimos el cursor
   open curItems
   fetch next from curItems into @cuenta,@tipo,@asiento,@idtipoasiento,@debe,@haber,@saldo 
   declare @lastcuenta int,@lasttipo int
   select @lasttipo=0,@lastcuenta=0
/* if @@fetch_status<>-1
    begin
      if @tipo=0
       begin
          select @total=@saldo,@lastcuenta=0,@lastcuenta=@cuenta
       end
    end
*/ while @@fetch_status<>-1
    begin
       if @tipo=0
        begin
           if @lasttipo!=0 
            begin
           print 'Actualizar'
           print '@lasttipo='+convert(varchar(20),@lasttipo)
           print '@lastcuenta='+convert(varchar(20),@lastcuenta)
           print '@total='+convert(varchar(20),@total)
           print '@total='+convert(varchar(20),@total)
           --Actualizamos los saldos que teniamos
           update rpt_mayorescuentas set
           saldo=@total
           where computer=@computer and @idtipoasiento=@idtipoasiento 
           and asiento=@asiento and tipo=@lasttipo and @cuenta=@lastcuenta
            end
           --Movemos los valores
           select @total=@saldo,@lasttipo=@tipo,@lastcuenta=@cuenta
        end
       else
        begin
          if @tipo=1
             select @total=@total+@debe
          else
             select @total=@total-@haber
          select @lasttipo=@tipo
          update rpt_mayorescuentas set
          saldo=@total
          where computer=@computer and @idtipoasiento=@idtipoasiento 
          and asiento=@asiento and tipo=@tipo and @cuenta=@lastcuenta
        end
       fetch next from curItems into @cuenta,@tipo,@asiento,@idtipoasiento,@debe,@haber,@saldo 
    end
   close curItems
   deallocate curItems
end

GO
/****** Object:  StoredProcedure [dbo].[sp_mksaldoscuentas]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO







-- exec sp_mksaldoscuentas 'SERVER', '20030101', '20031231', default, default, default, default, default, 'A',200906,0,934,0,935,0,0

CREATE              procedure [dbo].[sp_mksaldoscuentas](
@computer varchar(100),
@dtfecini char(8),
@dtfecfin char(8),
@ctaini int=null,@ctafin int=null,
@tipoasiento int=null,
@tipooperacion int=null,
@centrocosto int=null,
@opcion char(1),
@aniomes int=0,
@tas1 int=0,
@asiento1 int=0,
@tas2 int=0,
@asiento2 int=0,
@tas3 int=0,
@asiento3 int=0,
@tas4 int=0,
@asiento4 int=0,
@tas5 int=0,
@asiento5 int=0,
@tas6 int=0,
@asiento6 int=0
)
as
begin
   begin transaction
   --Declaracion de variables
   declare @szSQL varchar(8000),@szCond varchar(8000),@szCondApert varchar(8000)
   declare @descripcion varchar(50)
   declare @tipo int,@cuenta int,@apertura numeric(18,2),@debe numeric(18,2),@haber numeric(18,2),@saldo numeric(18,2)
   --Limpieza de variables
   select @szSQL='',@szCond='',@szCondApert='',@descripcion=''
   --Eliminamos registros anteriores
   delete rpt_saldoscuentas 
   where computer=@computer

   delete AsientosExcluidos 
   where computer=@computer

	if @aniomes<>0 and @Asiento1<>0
		insert into asientosExcluidos (computer,aniomes,tas,asiento) values (@computer,@aniomes,@tas1,@asiento1)

	if @aniomes<>0 and @Asiento2<>0
		insert into asientosExcluidos (computer,aniomes,tas,asiento) values (@computer,@aniomes,@tas2,@asiento2)

	if @aniomes<>0 and @Asiento3<>0
		insert into asientosExcluidos (computer,aniomes,tas,asiento) values (@computer,@aniomes,@tas2,@asiento3)

	if @aniomes<>0 and @Asiento4<>0
		insert into asientosExcluidos (computer,aniomes,tas,asiento) values (@computer,@aniomes,@tas2,@asiento4)

	if @aniomes<>0 and @Asiento5<>0
		insert into asientosExcluidos (computer,aniomes,tas,asiento) values (@computer,@aniomes,@tas2,@asiento5)

	if @aniomes<>0 and @Asiento6<>0
		insert into asientosExcluidos (computer,aniomes,tas,asiento) values (@computer,@aniomes,@tas2,@asiento6)


   --Armamos la condicion
   if not @dtfecini is null
    begin
      select @szCond=@szCond+'b.fecha>=convert(datetime,'''+right(day(@dtfecini)+100,2)+'/'+right(month(@dtfecini)+100,2)+'/'+right(year(@dtfecini),4)+''',103) and ' 
      select @szCondApert=@szCondApert+'X.fecha<convert(datetime,'''+right(day(@dtfecini)+100,2)+'/'+right(month(@dtfecini)+100,2)+'/'+right(year(@dtfecini),4)+''',103) and '
    end
    if not @dtfecfin is null
    begin
      select @szCond=@szCond+'b.fecha<=convert(datetime,'''+right(day(@dtfecfin)+100,2)+'/'+right(month(@dtfecfin)+100,2)+'/'+right(year(@dtfecfin),4)+' 23:59'',103) and '
    end
   if not @ctaini is null
    begin
      select @szCond=@szCond+'a.cuenta>='+convert(varchar(20),@ctaini)+' and '
      select @szCondApert=@szCondApert+'a.cuenta>='+convert(varchar(20),@ctaini)+' and '
    end
   if not @ctafin is null
    begin
      select @szCond=@szCond+'a.cuenta<='+convert(varchar(20),@ctafin)+' and '
      select @szCondApert=@szCondApert+'a.cuenta<='+convert(varchar(20),@ctafin)+' and '
    end

    Select @szCond=@szCond+'c.tipodeoperacion<200 and ' -- +convert(varchar(20),@tipoasiento)+' and '
    Select @szCondApert=@szCondApert+'c.tipodeoperacion<200 and ' -- +convert(varchar(20),@tipoasiento)+' and '


    if not @tipooperacion is null
    begin
      select @szCond=@szCond+'c.tipodeoperacion='+convert(varchar(20),@tipooperacion)+' and '
      select @szCondApert=@szCondApert+'c.tipodeoperacion='+convert(varchar(20),@tipooperacion)+' and '
    end

    if @Aniomes<>0
    begin
      select @szCond=@szCond+ ' ax.Asiento is null and '
      select @szCondApert=@szCondApert+ ' ax.Asiento is null and '
    end


   if not @centrocosto is null
    begin
      select @szCond=@szCond+'A.centrocosto=' + convert(varchar(20),@centrocosto) + ' and '
      select @szCondApert=@szCondApert+'A.centrocosto=' + convert(varchar(20),@centrocosto) + ' and '
    end

   if len(@szCond)>0
    begin
      select @szCond=' where ' + left(@szCond,len(@szCond)-4)
    end  
   if len(@szCondApert)>0
    begin
      select @szCondApert='where ' + left(@szCondApert,len(@szCondApert)-4)
    end  

    --Insertamos todos los items
    select @szSQL='insert into rpt_saldoscuentas (computer,tipo,cuenta,descripcion,apertura,debe,haber,saldo,ubbalance) 
		   select '''+@computer+''',1,A.Cuenta,A.Descripcion,X.Apertura,B.Debe,C.Haber,0,
case when ubbalance =1121 and b.debe-c.haber<0 then 2112 
when (ubbalance between 2111 and 2112 or ubbalance=1132) and b.debe-c.haber>0 then 1132
when (ubbalance between 2111 and 2112 or ubbalance=1132) and b.debe-c.haber<0 then 2111
else ubbalance  end ubalance

from cuentas a
                   left join (select A.cuenta, '

					if @opcion='A' 
						select @szSQL= @szSQL + ' sum(A.Debe) - sum(A.Haber) Apertura '
					else
						select @szSQL= @szSQL + ' 0 as Apertura '

					select @szSQL= @szSQL + ' from asientosdiariositems A inner join asientosdiariosheader X on A.asiento=X.asiento and 
 A.aniomes=X.aniomes and A.tipoasiento=X.tipoasiento left join header_operaciones C on X.asiento=C.AsientoDiario and 
 X.aniomes=C.AnioMes and X.tipoasiento=C.tipoasiento left join asientosexcluidos ax on x.tipoasInterno=ax.tas and ax.Asiento=x.AsientoInterno and x.aniomes=ax.aniomes and ax.Computer=''' + @computer + ''''
               	   +@szCondApert+ ' 
                   group by a.cuenta
                   ) X on a.cuenta=X.cuenta
                   left join
                   (
                   select A.cuenta,sum(A.Debe) Debe
                   from asientosdiariositems A
                   inner join asientosdiariosheader B on A.asiento=B.asiento and 
                        A.aniomes=B.aniomes and A.tipoasiento=B.tipoasiento 
                   left join header_operaciones C on B.asiento=C.AsientoDiario and 
                        B.aniomes=C.AnioMes and B.tipoasiento=C.tipoasiento 
				   left join asientosexcluidos ax 
						on b.tipoasInterno=ax.tas and ax.Asiento=b.AsientoInterno and b.aniomes=ax.aniomes and ax.Computer=''' + @computer + ''''
                   +@szCond+ ' 
                   group by a.cuenta
                   ) b on a.cuenta=b.cuenta
                   left join 
                   (
                   select A.cuenta,sum(A.Haber) Haber                   from asientosdiariositems A 
                   inner join asientosdiariosheader B on A.asiento=B.asiento and 
                         A.aniomes=B.aniomes and A.tipoasiento=B.tipoasiento 
                   left join header_operaciones C on B.asiento=C.AsientoDiario and 
                        B.aniomes=C.AnioMes and B.tipoasiento=C.tipoasiento 
				   left join asientosexcluidos ax 
						on b.tipoasInterno=ax.tas and ax.Asiento=b.AsientoInterno and b.aniomes=ax.aniomes and ax.Computer=''' + @computer + ''''
                   +@szCond+ ' 
                   group by a.cuenta
                   ) c on a.cuenta=c.cuenta
                   order by a.cuenta'

   exec(@szSQL) --Insertamos todas las cuentas

   print @szSQL

   --Declaramos el cursor
   declare curItems cursor local forward_only for
   select tipo,cuenta,apertura,debe,haber
   from rpt_saldoscuentas
   where (not debe is null or not haber is null or (not Apertura is null AND apertura<>0)) or (cuenta is null)
   and computer=@computer
   order by tipo,cuenta
   open curItems
   fetch next from curItems into @tipo,@cuenta,@apertura,@debe,@haber
   select @saldo=0
   if @@fetch_status<>-1
    begin
      if @tipo=0
       begin
         select @saldo=@apertura
         print 'Saldo Apertura: '+convert(varchar(20),@apertura)
	 fetch next from curItems into @tipo,@cuenta,@apertura,@debe,@haber
       end
    end
   while @@fetch_status<>-1
    begin
       print 'Cuenta: '+convert(varchar(20),@cuenta)
       print 'Saldo: '+convert(varchar(20),@saldo)+' Debe: '+convert(varchar(20),@debe)+' Haber: '+convert(varchar(20),@haber)
       select @saldo=@saldo+(@debe-@haber)
       update rpt_saldoscuentas set
       saldo=@saldo
       where cuenta=@cuenta
       print 'Nuevo Saldo: '+convert(varchar(20),@saldo)
       print ''
       fetch next from curItems into @tipo,@cuenta,@apertura,@debe,@haber
    end
   close curItems
   deallocate curItems
   commit transaction
end



















GO
/****** Object:  StoredProcedure [dbo].[sp_mksaldoscuentas_OLD]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  procedure [dbo].[sp_mksaldoscuentas_OLD](
@computer varchar(100),
@dtfecini datetime=null,@dtfecfin datetime=null,
@ctaini int=null,@ctafin int=null,
@tipoasiento int=null,@tipooperacion int=null,@centrocosto int=null,
@opcion char(1)
)
as
begin
   begin transaction
   --Declaracion de variables
   declare @szSQL varchar(8000),@szCond varchar(4000),@szCondApert varchar(4000)
   declare @descripcion varchar(50)
   declare @tipo int,@cuenta int,@apertura numeric(18,2),@debe numeric(18,2),@haber numeric(18,2),@saldo numeric(18,2)
   --Limpieza de variables
   select @szSQL='',@szCond='',@szCondApert='',@descripcion=''
   --Eliminamos registros anteriores
   delete rpt_saldoscuentas 
   where computer=@computer

   --Armamos la condicion
   if not @dtfecini is null
    begin
      select @szCond=@szCond+'b.fecha>=convert(datetime,'''+right(day(@dtfecini)+100,2)+'/'+right(month(@dtfecini)+100,2)+'/'+right(year(@dtfecini),4)+''',103) and '
      select @szCondApert=@szCondApert+'b.fecha<convert(datetime,'''+right(day(@dtfecini)+100,2)+'/'+right(month(@dtfecini)+100,2)+'/'+right(year(@dtfecini),4)+''',103) and '
    end
   if not @dtfecfin is null
    begin
      select @szCond=@szCond+'b.fecha<=convert(datetime,'''+right(day(@dtfecfin)+100,2)+'/'+right(month(@dtfecfin)+100,2)+'/'+right(year(@dtfecfin),4)+' 23:59:59'',103) and '
    end
   if not @ctaini is null
    begin
      select @szCond=@szCond+'a.cuenta>='+convert(varchar(20),@ctaini)+' and '
      select @szCondApert=@szCondApert+'a.cuenta>='+convert(varchar(20),@ctaini)+' and '
    end
   if not @ctafin is null
    begin
      select @szCond=@szCond+'a.cuenta<='+convert(varchar(20),@ctafin)+' and '
      select @szCondApert=@szCondApert+'a.cuenta<='+convert(varchar(20),@ctafin)+' and '
    end
   if not @tipoasiento is null
    begin
      select @szCond=@szCond+'a.tipoasiento='+convert(varchar(20),@tipoasiento)+' and '
      select @szCondApert=@szCondApert+'a.tipoasiento='+convert(varchar(20),@tipoasiento)+' and '
    end
   if not @tipoasiento is null
    begin
      select @szCond=@szCond+'c.tipodeoperacion='+convert(varchar(20),@tipooperacion)+' and '
      select @szCondApert=@szCondApert+'c.tipodeoperacion='+convert(varchar(20),@tipooperacion)+' and '
    end
   if not @centrocosto is null
    begin
      select @szCond=@szCond+'b.centrocosto='+convert(varchar(20),@centrocosto)+' and '
      select @szCondApert=@szCondApert+'b.centrocosto='+convert(varchar(20),@centrocosto)+' and '
    end
   if len(@szCond)>0
    begin
      select @szCond='where '+left(@szCond,len(@szCond)-4)
    end  
   if len(@szCondApert)>0
    begin
      select @szCondApert='where '+left(@szCondApert,len(@szCondApert)-4)
    end  
   if @opcion='A'
    begin --Insertamos la apertura
      if @dtfecini is null
         select @descripcion='Apertura'
      else
         select @descripcion='Apertura al: '+right(day(@dtfecini)+100,2)+'/'+right(month(@dtfecini)+100,2)+'/'+right(year(@dtfecini)+10000,4)
      select @szSQL='insert into rpt_saldoscuentas (computer,tipo,descripcion,apertura)
                     select '''+@computer+''',0,'''+@descripcion+''',sum(A.Debe)-sum(A.haber)
                     from asientosdiariositems A
                     inner join asientosdiariosheader B on A.asiento=B.asiento and 
                           A.aniomes=B.aniomes and A.tipoasiento=B.tipoasiento 
                     left join header_operaciones C on B.asiento=C.AsientoDiario and 
                          B.aniomes=C.AnioMes and B.tipoasiento=C.tipoasiento '
                     +@szCondApert
      exec(@szSQL) --Insertamos la apertura
    end
    --Insertamos todos los items
    select @szSQL='insert into rpt_saldoscuentas (computer,tipo,cuenta,descripcion,debe,haber,saldo) 
                   select '''+@computer+''',1,A.Cuenta,A.Descripcion,B.Debe,C.Haber,0 
                   from cuentas a
                   left join
                   (
                   select A.cuenta,sum(A.Debe) Debe
                   from asientosdiariositems A
                   inner join asientosdiariosheader B on A.asiento=B.asiento and 
                        A.aniomes=B.aniomes and A.tipoasiento=B.tipoasiento 
                   left join header_operaciones C on B.asiento=C.AsientoDiario and 
                        B.aniomes=C.AnioMes and B.tipoasiento=C.tipoasiento '
                   +@szCond+ ' 
                   group by a.cuenta
                   ) b on a.cuenta=b.cuenta
                   left join 
                   (
                   select A.cuenta,sum(A.Haber) Haber
                   from asientosdiariositems A
                   inner join asientosdiariosheader B on A.asiento=B.asiento and 
                         A.aniomes=B.aniomes and A.tipoasiento=B.tipoasiento 
                   left join header_operaciones C on B.asiento=C.AsientoDiario and 
                        B.aniomes=C.AnioMes and B.tipoasiento=C.tipoasiento '
                   +@szCond+ ' 
                   group by a.cuenta
                   ) c on a.cuenta=c.cuenta
                   order by a.cuenta'

--   exec(@szSQL) --Insertamos todas las cuentas

	print @szSQL

   --Declaramos el cursor
   declare curItems cursor local forward_only for
   select tipo,cuenta,apertura,debe,haber
   from rpt_saldoscuentas
   where (not debe is null and not haber is null) or (cuenta is null)
   and computer=@computer
   order by tipo,cuenta
   open curItems
   fetch next from curItems into @tipo,@cuenta,@apertura,@debe,@haber
   select @saldo=0
   if @@fetch_status<>-1
    begin
      if @tipo=0
       begin
         select @saldo=@apertura
         print 'Saldo Apertura: '+convert(varchar(20),@apertura)
	 fetch next from curItems into @tipo,@cuenta,@apertura,@debe,@haber
       end
    end
   while @@fetch_status<>-1
    begin
       print 'Cuenta: '+convert(varchar(20),@cuenta)
       print 'Saldo: '+convert(varchar(20),@saldo)+' Debe: '+convert(varchar(20),@debe)+' Haber: '+convert(varchar(20),@haber)
       select @saldo=@saldo+(@debe-@haber)
       update rpt_saldoscuentas set
       saldo=@saldo
       where cuenta=@cuenta
       print 'Nuevo Saldo: '+convert(varchar(20),@saldo)
       print ''
       fetch next from curItems into @tipo,@cuenta,@apertura,@debe,@haber
    end
   close curItems
   deallocate curItems
   commit transaction
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modasientodiarioheader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE procedure [dbo].[sp_modasientodiarioheader] (@asiento int,@aniomes int,@tipoasiento int,
@fecha datetime,@detalle varchar(50),@centrocosto int,@AsientoInterno int=0,@TipoAsInterno int=0)
as
begin
   update asientosdiariosheader set
   detalle=@detalle,centrocosto=@centrocosto,fecha=@fecha,AsientoInterno=@AsientoInterno,TipoAsInterno=@TipoAsInterno
   where asiento=@asiento and aniomes=@aniomes and tipoasiento=@tipoasiento
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modasientodiarioitem]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE  procedure [dbo].[sp_modasientodiarioitem] (@asiento int,@item int,@newitem int,
@aniomes int,@tipoasiento int,@cuenta int,@centrocosto int,
@debe numeric(18,2),@haber numeric(18,2),@observacion varchar(20))
as
begin
   update asientosdiariositems set
   cuenta=@cuenta,centrocosto=@centrocosto,debe=@debe,haber=@haber,observacion=@observacion,
   item=@newitem
   where asiento=@asiento and aniomes=@aniomes and item=@item and tipoasiento=@tipoasiento
   and tipoasiento=@tipoasiento
end



GO
/****** Object:  StoredProcedure [dbo].[sp_modbanco]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modbanco] (@banco int,@descripcion varchar(20),@opera char(1))
as
begin
   update bancos set 
   descripcion=@descripcion,opera=@opera
   where banco=@banco
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modcalificprofesional]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modcalificprofesional] (@califprofesional int,@descripcion varchar(30))
as
begin
   update calificprofesionales set
   descripcion=@descripcion
   where califprofesional=@califprofesional
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modcargoasociacion]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modcargoasociacion] (@cargo int,@descripcion varchar(30))
as
begin
   update cargosasociacion set
   descripcion=@descripcion
   where cargo=@cargo
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modcategoria]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modcategoria] (@categoria int,@descripcion varchar(30))
as
begin
   update categorias set
   descripcion=@descripcion
   where categoria=@categoria
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modcategoriaiva]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modcategoriaiva] (@idciva int,@descripcion varchar(30))
as
begin
   update categorias_iva set
   descripcion=@descripcion
   where idciva=@idciva
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modcentrocosto]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modcentrocosto] (@centrocosto int,@descripcion varchar(30))
as
begin
   update centrosdecostos set
   descripcion=@descripcion
   where centrocosto=@centrocosto
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modchequera]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  procedure [dbo].[sp_modchequera] 
	@item int, 
	@concepto int, 
	@fechamov datetime, 
	@primercheque numeric(18,0),
	@cantcheques int,
	@ultimocheque numeric(18,0)
as
begin
   update chequeras set 
	Concepto=@concepto, FechaMovimiento=@fechamov, NroPrimerCheque=@primercheque,
 	CantCheques=@cantcheques, UltimoChequeEmitido=@ultimocheque  
   where item=@item
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modcliente]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modcliente] (@Codigo int,@RazonSocial varchar(30),@Contacto varchar(30),
@Domicilio varchar(30),@Localidad int,@Provincia int,@CPostal varchar(8),
@Telefono varchar(30),@TelefonoII varchar(30),@TelefonoIII varchar(30),@CIva int,
@Cuit varchar(14),@Cuenta int,@email varchar(30))
as 
begin
  update clientes set
  RazonSocial=@RazonSocial,Contacto=@Contacto,Domicilio=@Domicilio,Localidad=@Localidad,
  Provincia=@Provincia,CPostal=@CPostal,Telefono=@Telefono,TelefonoII=@TelefonoII,
  TelefonoIII=@TelefonoIII,CIva=@CIva,Cuit=@Cuit,Cuenta=@Cuenta,email=@email
  where codigo=@codigo
end

GO
/****** Object:  StoredProcedure [dbo].[sp_modcobrador]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE   procedure [dbo].[sp_modcobrador] (@cobrador int,@nombre varchar(30),@serie char(5),
@importe numeric(18,2),@global char(1),@Tope int,@op int)
as
begin
   update cobradores set
   nombre=@nombre,serie=@serie,importe=@importe,[global]=@global,
   Tope=@Tope,op=@Op
   where cobrador=@cobrador
end




GO
/****** Object:  StoredProcedure [dbo].[sp_modcodigoactividad]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modcodigoactividad] (@codigoactividad int,@descripcion varchar(30))
as
begin
   update codigosactividades set
   descripcion=@descripcion
   where codigoactividad=@codigoactividad
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modcompfondoheader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modcompfondoheader](@idtransaccion int,@comprobante int,@aniomes int,
@fecha datetime,@proveedor int,@tipocomprobante int,@nrocomprobante char(12),
@tipofactura char(1),@totalimporte numeric(18,2),@fecha1venc datetime=null,
@fecha2venc datetime=null,@estado char(1),@fechareal datetime,@centrocosto int,
@bUpdateAll bit=0, --Indica si actualiza todo normalmente o es llamado desde AsientosDiarios
--Los paramatros de idoperacion,idtipotransaccion,itemdiario son para insertar en Detalle_operaciones
@IdOperacion int=null,@IdTipoTransaccion int=null,@itemdiario int=null,@inewitem int=null)
as
begin
   if @bUpdateAll=0
      update compfondosheader set
      fecha=@fecha,proveedor=@proveedor,tipocomprobante=@tipocomprobante,
      nrocomprobante=@nrocomprobante,tipofactura=@tipofactura,totalimporte=@totalimporte,
      fecha1venc=@fecha1venc,fecha2venc=@fecha2venc,estado=@estado,
      fechareal=@fechareal,centrocosto=@centrocosto
      where idtransaccion=@idtransaccion
   else --Actualizamos solo los campos desde AsientosDiarios
    begin
      update compfondosheader set
      fecha=@fecha,proveedor=@proveedor,tipocomprobante=@tipocomprobante,
      nrocomprobante=@nrocomprobante,tipofactura=@tipofactura,totalimporte=@totalimporte,
      estado=@estado,centrocosto=@centrocosto
      where idtransaccion=@idtransaccion
      update detalle_operaciones set
      idTipoTransaccion=@idtipotransaccion,itemdiario=@inewitem
      where idoperacion=@idoperacion and idtransaccion=@idtransaccion
    end
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modcompprovheader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE  procedure [dbo].[sp_modcompprovheader](@idtransaccion int,@comprobante int,@aniomes int,
@fecha datetime,@proveedor int,@tipocomprobante int,@nrocomprobante char(12),
@tipofactura char(1),@totalimporte numeric(18,2),@fecha1venc datetime=null,
@fecha2venc datetime=null,@estado char(1),@fechareal datetime,@centrocosto int,
@bUpdateAll bit=0, --Indica si actualiza todo normalmente o es llamado desde AsientosDiarios
--Los paramatros de idoperacion,idtipotransaccion,itemdiario son para insertar en Detalle_operaciones
@IdOperacion int=null,@IdTipoTransaccion int=null,@itemdiario int=null,@inewitem int=null,@descripcionimporte varchar(255),
@Moneda int, @ImporteOrigen numeric(18,2),@tc numeric(18,4))
as
begin
--   if @bUpdateAll=0
      update compprovheader set
      fecha=@fecha,proveedor=@proveedor,tipocomprobante=@tipocomprobante,
      nrocomprobante=@nrocomprobante,tipofactura=@tipofactura,totalimporte=@totalimporte,
      fecha1venc=@fecha1venc,fecha2venc=@fecha2venc,estado=@estado,
      fechareal=@fechareal,centrocosto=@centrocosto,descripcionimporte=@descripcionimporte,Moneda=@Moneda,ImporteOrigen=@ImporteOrigen,TC=@TC
      where idtransaccion=@idtransaccion
/*   else --Actualizamos solo los campos desde AsientosDiarios
    begin
      update compprovheader set
      fecha=@fecha,proveedor=@proveedor,tipocomprobante=@tipocomprobante,
      nrocomprobante=@nrocomprobante,tipofactura=@tipofactura,totalimporte=@totalimporte,
      estado=@estado,centrocosto=@centrocosto
      where idtransaccion=@idtransaccion
      update detalle_operaciones set
      idTipoTransaccion=@idtipotransaccion,itemdiario=@inewitem
      where idoperacion=@idoperacion and idtransaccion=@idtransaccion
    end*/
end




GO
/****** Object:  StoredProcedure [dbo].[sp_modcompprovitems]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modcompprovitems](@comprobante int,@aniomes int,@item int,
@concepto char(3),@importe numeric(18,2),
@cuentaneto int,@neto numeric(18,2),@cuentamonto int,@monto numeric(18,2))
as
begin
   update compprovitems set
   concepto=@concepto,@importe=@importe,
   cuentaneto=@cuentaneto,neto=@neto,cuentamonto=@cuentamonto,monto=@monto
   where comprobante=@comprobante and aniomes=@aniomes and item=@item
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modconcepto]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE   procedure [dbo].[sp_modconcepto] (@Concepto char(3),@Entidad tinyint,@Descripcion char(30),
@Modalidad char(1),@Importe numeric(18,2),@mes int,@ano int,@imputacion_contable int,@Grupo char(1),@idCobertura int)
as 
begin
  update conceptos set 
  Entidad=@entidad,Descripcion=@descripcion,Modalidad=@modalidad,Importe=@importe,
  mes=@mes,ano=@ano,imputacion_contable=@imputacion_contable, grupo=@grupo,idCobertura=@idCobertura
  where concepto=@concepto
end
 



GO
/****** Object:  StoredProcedure [dbo].[sp_modconceptocontable]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modconceptocontable] (@concepto char(3),@descripcion varchar(30),
@alicuota numeric(6,2),@cuenta int)
as 
begin
  update conceptoscontables set
  descripcion=@descripcion,alicuota=@alicuota,cuenta=@cuenta
  where concepto=@concepto
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modconceptoimpuesto]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modconceptoimpuesto] (@concepto int,@descripcion varchar(30))
as 
begin
  update conceptosimpuestos set
  descripcion=@descripcion
  where concepto=@concepto
end
 

GO
/****** Object:  StoredProcedure [dbo].[sp_modconceptolegajo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modconceptolegajo](@legajo int,@orden int,@concepto int,@importe numeric(18,2))
as
begin
   update conceptoslegajos set
   concepto=@concepto,importe=@importe
   where legajo=@legajo and orden=@orden
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modconceptolegajonovedad]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  procedure [dbo].[sp_modconceptolegajonovedad](@añomes int, @Periodo int,@legajo int,@orden int,@concepto int,@importe numeric(18,2))
as
begin
   update conceptoslegajosnovedades set
   concepto=@concepto,importe=@importe 
   where legajo=@legajo and orden=@orden and aniomes=@añomes and periodo=@Periodo
end



GO
/****** Object:  StoredProcedure [dbo].[sp_modconceptoliquidacion]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE  procedure [dbo].[sp_modconceptoliquidacion] (@concepto int,@descripcion varchar(21),@tipoconcepto int,
@modo int,@cuentacontable int, @Aplicable char(1), @Periodo int)
as
begin
   update Conceptosliquidacion set
   descripcion=@descripcion,tipoconcepto=@tipoconcepto,modo=@modo,
   cuentacontable=@cuentacontable, LegajosAplicables=@Aplicable, Periodo = @Periodo
   where concepto=@concepto
end



GO
/****** Object:  StoredProcedure [dbo].[sp_modconceptoliquidaciondetalle]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modconceptoliquidaciondetalle] (@codigo int,@grupo int,@concepto int,
@operador1 int,@constante1 int,@operador2 int,@constante2 int,
@operador3 int,@constante3 int,@operador4 int,@constante4 int,@signo int)
as
begin
   update conceptosliquidaciondetalle set 
   grupo=@grupo,concepto=@concepto,
   operador1=@operador1,constante1=@constante1,operador2=@operador2,constante2=@constante2,
   operador3=@operador3,constante3=@constante3,operador4=@operador4,constante4=@constante4,
   signo=@signo
   where codigo=@codigo
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modconceptoremunerativo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[sp_modconceptoremunerativo] (@concepto int,@descripcion varchar(21),@tipoconcepto int,
@modo int,@cuentacontable int)
as
begin
   update ConceptosRemunerativos set
   descripcion=@descripcion,tipoconcepto=@tipoconcepto,modo=@modo,cuentacontable=@cuentacontable
   where concepto=@concepto
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modconceptotesoreria]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modconceptotesoreria] (@idConcepto_Tesoreria int,@descripcion varchar(25),
@imputacion_contable int,@modalidad int,@ci char(1),@ce char(1))
as
begin
   update conceptos_tesoreria set 
   descripcion=@descripcion,imputacion_contable=@imputacion_contable,
   modalidad=@modalidad,ci=@ci,ce=@ce
   where idConcepto_Tesoreria=@idConcepto_Tesoreria
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modcondicion]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modcondicion] (@condicion int,@descripcion varchar(30))
as
begin
   update condiciones set
   descripcion=@descripcion
   where condicion=@condicion
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modconstanteliquidacion]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modconstanteliquidacion] (@constante int,@descripcion varchar(20),@valor numeric(18,2))
as
begin
   update constantesliquidacion set
   descripcion=@descripcion,valor=@valor
   where constante=@constante
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modcuenta]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE procedure [dbo].[sp_modcuenta](@cuenta int,@descripcion varchar(35),@corta int,
@sigla char(5),@Resumida char(10),@tipocuentaContable tinyint,@imputable tinyint,@ubbalance int,@UbResultado int)
as
begin
   update cuentas set 
   descripcion=@descripcion,corta=@corta,sigla=@sigla,Resumida=@resumida,
   tipocuentaContable=@tipocuentacontable,imputable=@imputable, ubbalance=@ubBalance, ubResultado=@ubResultado
   where cuenta=@cuenta
end



GO
/****** Object:  StoredProcedure [dbo].[sp_modDomicilioCobro]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE    procedure [dbo].[sp_modDomicilioCobro] 

@Nombre varchar(30), @Calle varchar(30), @Numero int,
@PisoDto varchar(30), @Localidad int, @Provincia int, @idDomicilio int

AS
begin
  	update DomiciliosdeCobro 
	set Nombre = @Nombre, Calle=@Calle, Numero=@Numero, PisoDto= @PisoDto, Localidad=@Localidad, Provincia=@Provincia
	where idDomicilio = @idDomicilio
end
 



GO
/****** Object:  StoredProcedure [dbo].[sp_modespecialidad]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  procedure [dbo].[sp_modespecialidad] (@especialidad int,@descripcion varchar(30),@actividad varchar(30)='')
as
begin
   update especialidades set
   descripcion=@descripcion,actividad=@actividad
   where especialidad=@especialidad
end



GO
/****** Object:  StoredProcedure [dbo].[sp_modfamiliar]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[sp_modfamiliar] (@legajo int,@apellido varchar(30),@nombre varchar(30),
@fechanac datetime=null,@fechaultimo datetime=null,@certificado varchar(30),@parentesco int)
as
begin
   update familiares set
   apellido=@apellido,nombre=@nombre,fechanac=@fechanac,fechaultimo=@fechaultimo,
   certificado=@certificado,parentesco=@parentesco
   where legajo=@legajo 
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modfamiliarlegajo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modfamiliarlegajo](@legajo int,@orden int,@apellnombre varchar(35),
@sexo int,@fecnac datetime=null,@tipodoc int,@numero int,@parentesco int,
@feccertificado datetime=null,@fecvigencia datetime=null,@fecvencimiento datetime=null)
as
begin
   update familiareslegajos set
   apellnombre=@apellnombre,sexo=@sexo,fecnac=@fecnac,tipodoc=@tipodoc,
   numero=@numero,parentesco=@parentesco,feccertificado=@feccertificado,
   fecvigencia=@fecvigencia,fecvencimiento=@fecvencimiento
   where legajo=@legajo and orden=@orden
end

GO
/****** Object:  StoredProcedure [dbo].[sp_modfechalegajo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  procedure [dbo].[sp_modfechalegajo] (@legajo int,@orden int,@concepto int,
@indicativoantiguedad int,@fecha datetime,@Finaliza datetime=null)
as
begin
   update fechaslegajos set 
   concepto=@concepto,indicativoantiguedad=@indicativoantiguedad,fecha=@fecha,Finaliza=@Finaliza
   where legajo=@legajo and orden=@orden
end



GO
/****** Object:  StoredProcedure [dbo].[sp_modgrupo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modgrupo] (@grupo char(2),@descripcion varchar(30))
as
begin
   update grupos set
   descripcion=@descripcion
   where grupo=@grupo
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modgrupoconceptoheader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modgrupoconceptoheader] (@grupo int,@descripcion varchar(30))
as
begin
   update gruposconceptosheader set
   descripcion=@descripcion
   where grupo=@grupo
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modgrupousuario]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modgrupousuario](@grupo int,@descripcion varchar(30))
as
begin
   update gruposusuarios set 
   descripcion=@descripcion
   where grupo=@grupo
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modHeader_Operaciones]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[sp_modHeader_Operaciones](@operacion int,@fecha datetime,
@observacion varchar(50),@idusuario varchar(10),@idOperadorTesoreria int=null)
as
begin
   update header_operaciones set
   fecha=@fecha,observacion=@observacion,idusuario=@idusuario,
   idOperadorTesoreria=@idOperadorTesoreria,procesado=getdate()
   where idoperacion=@operacion
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modhospital]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  procedure [dbo].[sp_modhospital] (@idHospital int, @hospital int,@nombre varchar(30),@reparticion int,@filial char(1))
as
begin
   update hospitales set
   nombre=@nombre,reparticion=@reparticion,filial=@filial
   where idHospital=@idHospital
end



GO
/****** Object:  StoredProcedure [dbo].[sp_modhospitalvoto]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modhospitalvoto] (@hospitalvoto int,@nombre varchar(30))
as
begin
   update hospitalesvoto set
   nombre=@nombre
   where hospitalvoto=@hospitalvoto
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modlocalidad]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modlocalidad] (@localidad int,@descripcion varchar(30))
as
begin
   update localidades set
   descripcion=@descripcion
   where localidad=@localidad
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modmaestropersonal]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE   procedure [dbo].[sp_modmaestropersonal](@legajo int,@centrocosto int,@apellido varchar(20),
@nombre varchar(20),@tipodocumento int,@numero int,@obrasocial int,@adherentes int,@sindicato int,
@estadocivil int,@califprofesional int,@categoria int,@estado int,@tareacumplida int,
@fechanacimiento datetime=null,@modalidad int,@jornalbasico numeric(18,2)=null,
@jornalacuenta numeric(18,2)=null,@cuil char(13),@zonageografica int,@codigoactividad int,
@domicilio varchar(30),@localidad int,@cpostal char(8),@telefono varchar(20),
@modoantiguedad int,@jubilado int,@situacion int,@condicion int,@sistemajubilacion int, 
@nacionalidad int,@idcConvenio int)
as 
begin
   update maestropersonal set
   centrocosto=@centrocosto,apellido=@apellido,nombre=@nombre,tipodocumento=@tipodocumento,
   numero=@numero,obrasocial=@obrasocial,adherentes=@adherentes,sindicato=@sindicato,
   estadocivil=@estadocivil,califprofesional=@califprofesional,categoria=@categoria,
   estado=@estado,tareacumplida=@tareacumplida,fechanacimiento=@fechanacimiento,
   modalidad=@modalidad,jornalbasico=@jornalbasico,jornalacuenta=@jornalacuenta,
   cuil=@cuil,zonageografica=@zonageografica,codigoactividad=@codigoactividad,
   domicilio=@domicilio,localidad=@localidad,cpostal=@cpostal,telefono=@telefono,
   modoantiguedad=@modoantiguedad,jubilado=@jubilado,situacion=@situacion,
   condicion=@condicion,sistemajubilacion=@sistemajubilacion, nacionalidad = @nacionalidad,idcConvenio=@idcConvenio
   where legajo=@legajo
end



GO
/****** Object:  StoredProcedure [dbo].[sp_modmodoantiguedad]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modmodoantiguedad] (@modoantiguedad int,@descripcion varchar(30))
as
begin
   update modoantiguedad set
   descripcion=@descripcion
   where modoantiguedad=@modoantiguedad
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modmotivobaja]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modmotivobaja] (@motivo int,@nombre varchar(30))
as
begin
   update motivosbaja set
   nombre=@nombre
   where motivo=@motivo
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modnovedadlegajo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modnovedadlegajo](@legajo int,@orden int,@concepto int,
@modalidad int,@importe numeric(18,2))
as
begin
   update novedadeslegajos set 
   orden=@orden,concepto=@concepto,modalidad=@modalidad,importe=@importe
   where legajo=@legajo
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modobrasocial]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modobrasocial] (@obrasocial int,@descripcion varchar(30))
as
begin
   update obrassociales set
   descripcion=@descripcion
   where obrasocial=@obrasocial
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modotroconcepto]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modotroconcepto](@Concepto char(8),@Descripcion varchar(30),@Importe numeric(18,2),@Imputacion_contable int)
as
begin
   update otrosconceptos set 
   descripcion=@descripcion,Importe=@importe,Imputacion_contable=@imputacion_contable
   where concepto=@concepto
end 


GO
/****** Object:  StoredProcedure [dbo].[sp_modparametrogeneral]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modparametrogeneral](@parametro varchar(50),@valor varchar(250))
as
begin
   update parametrosgenerales set 
   valor=@valor
   where parametro=@parametro
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modparametrogeneralsueldo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE procedure [dbo].[sp_modparametrogeneralsueldo](@nombreempresa varchar(255),@domicilio varchar(30),
@codigopostal char(8),@localidad varchar(30),@provincia varchar(30),@cuit char(13),
@localidadpago varchar(30),@lugardedeposito varchar(30),@sucursal varchar(30),
@cargofijoART numeric(18,2),@alicuotaART numeric(18,2),@nombretxtDGI varchar(30),
@redondeo int,@valor numeric(18,2),@actividadempresa varchar(30))
as
begin
  delete parametrosgeneralessueldos
  insert into parametrosgeneralessueldos(nombreempresa,domicilio,codigopostal,localidad,provincia,cuit,localidadpago,lugardedeposito,sucursal,cargofijoART,alicuotaART,nombretxtDGI,redondeo,valor,actividadempresa)
  values (@nombreempresa,@domicilio,@codigopostal,@localidad,@provincia,@cuit,@localidadpago,@lugardedeposito,@sucursal,@cargofijoART,@alicuotaART,@nombretxtDGI,@redondeo,@valor,@actividadempresa)
end
GO
/****** Object:  StoredProcedure [dbo].[sp_modparametromodoantiguedad]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modparametromodoantiguedad] (@modoantiguedad int,@item int,
@vigentehasta int,@tipocalculo int,@base int,@importe numeric(18,2))
as
begin
   update parametrosmodoantiguedad set 
   vigentehasta=@vigentehasta,tipocalculo=@tipocalculo,base=@base,importe=@importe
   where modoantiguedad=@modoantiguedad and item=@item
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modparentesco]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modparentesco] (@parentesco int,@descripcion varchar(30),
@conceptoliquidacion int)as
begin
   update parentescos set
   descripcion=@descripcion,conceptoliquidacion=@conceptoliquidacion
   where parentesco=@parentesco
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modPedidosheader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




Create   procedure [dbo].[sp_modPedidosheader](@idtransaccion int,@comprobante int,@aniomes int,
@fecha datetime,@proveedor int,@idPaciente int,@tipocomprobante int,@nrocomprobante char(12),
@tipofactura char(1),@totalimporte numeric(18,2),@fecha1venc datetime=null,
@fecha2venc datetime=null,@estado char(1),@fechareal datetime,@centrocosto int,
@bUpdateAll bit=0, --Indica si actualiza todo normalmente o es llamado desde AsientosDiarios
--Los paramatros de idoperacion,idtipotransaccion,itemdiario son para insertar en Detalle_operaciones
@IdOperacion int=null,@IdTipoTransaccion int=null,@itemdiario int=null,@inewitem int=null,@descripcionimporte varchar(255),
@Moneda int, @ImporteOrigen numeric(18,2),@tc numeric(18,2))
as
begin
--   if @bUpdateAll=0
      update Pedidos set
      fecha=@fecha,cliente=@proveedor,idPaciente=@idPaciente,tipocomprobante=@tipocomprobante,
      nrocomprobante=@nrocomprobante,tipofactura=@tipofactura,totalimporte=@totalimporte,
      fecha1venc=@fecha1venc,fecha2venc=@fecha2venc,estado=@estado,
      fechareal=@fechareal,centrocosto=@centrocosto,descripcionimporte=@descripcionimporte,Moneda=@Moneda,ImporteOrigen=@ImporteOrigen,TC=@TC
      where idtransaccion=@idtransaccion
/*   else --Actualizamos solo los campos desde AsientosDiarios
    begin
      update compprovheader set
      fecha=@fecha,proveedor=@proveedor,tipocomprobante=@tipocomprobante,
      nrocomprobante=@nrocomprobante,tipofactura=@tipofactura,totalimporte=@totalimporte,
      estado=@estado,centrocosto=@centrocosto
      where idtransaccion=@idtransaccion
      update detalle_operaciones set
      idTipoTransaccion=@idtipotransaccion,itemdiario=@inewitem
      where idoperacion=@idoperacion and idtransaccion=@idtransaccion
    end*/
end





GO
/****** Object:  StoredProcedure [dbo].[sp_modPoheader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO





Create   procedure [dbo].[sp_modPoheader](@idtransaccion int,@comprobante int,@aniomes int,
@fecha datetime,@proveedor int,@idPaciente int,@tipocomprobante int,@nrocomprobante char(12),
@tipofactura char(1),@totalimporte numeric(18,2),@fecha1venc datetime=null,
@fecha2venc datetime=null,@estado char(1),@fechareal datetime,@centrocosto int,
@bUpdateAll bit=0, @IdOperacion int=null,@IdTipoTransaccion int=null,@itemdiario int=null,@inewitem int=null,@descripcionimporte varchar(255),
@Moneda int, @ImporteOrigen numeric(18,2),@tc numeric(18,2))
as
begin
--   if @bUpdateAll=0
      update Pedidos set
      fecha=@fecha,cliente=@proveedor,idPaciente=@idPaciente,tipocomprobante=@tipocomprobante,
      nrocomprobante=@nrocomprobante,tipofactura=@tipofactura,totalimporte=@totalimporte,
      fecha1venc=@fecha1venc,fecha2venc=@fecha2venc,estado=@estado,
      fechareal=@fechareal,centrocosto=@centrocosto,descripcionimporte=@descripcionimporte,Moneda=@Moneda,ImporteOrigen=@ImporteOrigen,TC=@TC
      where idtransaccion=@idtransaccion

end






GO
/****** Object:  StoredProcedure [dbo].[sp_modPoliza]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO






CREATE      procedure [dbo].[sp_modPoliza] (@idPoliza int, @Concepto char(3), @Desde char(10), @Hasta char(10),
@Descripcion char(25), @Poliza char(75))

as 
begin
  update Polizas set 
  Concepto=@Concepto,Desde=@Desde,Hasta=@Hasta,Descripcion=@descripcion,Poliza=@Poliza
  where idPoliza = @idPoliza
end





GO
/****** Object:  StoredProcedure [dbo].[sp_modPresupuestoheader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO





CREATE    procedure [dbo].[sp_modPresupuestoheader](@idtransaccion int,@comprobante int,@aniomes int,
@fecha datetime,@proveedor int, /*@idPaciente int,*/ @tipocomprobante int,@nrocomprobante char(12),
@tipofactura char(1),@totalimporte numeric(18,2),@fecha1venc datetime=null,
@fecha2venc datetime=null,@estado char(1),@fechareal datetime,@centrocosto int,
@bUpdateAll bit=0, --Indica si actualiza todo normalmente o es llamado desde AsientosDiarios
--Los paramatros de idoperacion,idtipotransaccion,itemdiario son para insertar en Detalle_operaciones
@IdOperacion int=null,@IdTipoTransaccion int=null,@itemdiario int=null,@inewitem int=null,@descripcionimporte varchar(255),
@Moneda int, @ImporteOrigen numeric(18,2),@tc numeric(18,2),@idLeyenda int)
as
begin
--   if @bUpdateAll=0
      update Presupuestos set
      fecha=@fecha,cliente=@proveedor, /* idPaciente=@idPaciente, */tipocomprobante=@tipocomprobante,
      nrocomprobante=@nrocomprobante,tipofactura=@tipofactura,totalimporte=@totalimporte,
      fecha1venc=@fecha1venc,fecha2venc=@fecha2venc,estado=@estado,
      fechareal=@fechareal,centrocosto=@centrocosto,descripcionimporte=@descripcionimporte,Moneda=@Moneda,ImporteOrigen=@ImporteOrigen,TC=@TC,idLeyenda=@idLeyenda
      where idtransaccion=@idtransaccion
/*   else --Actualizamos solo los campos desde AsientosDiarios
    begin
      update compprovheader set
      fecha=@fecha,proveedor=@proveedor,tipocomprobante=@tipocomprobante,
      nrocomprobante=@nrocomprobante,tipofactura=@tipofactura,totalimporte=@totalimporte,
      estado=@estado,centrocosto=@centrocosto
      where idtransaccion=@idtransaccion
      update detalle_operaciones set
      idTipoTransaccion=@idtipotransaccion,itemdiario=@inewitem
      where idoperacion=@idoperacion and idtransaccion=@idtransaccion
    end*/
end






GO
/****** Object:  StoredProcedure [dbo].[sp_modproveedor]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE   procedure [dbo].[sp_modproveedor] (@Codigo int,@RazonSocial varchar(30),@Contacto varchar(30),
@Domicilio varchar(30),@Localidad int,@Provincia int,@CPostal varchar(8),
@Telefono varchar(30),@TelefonoII varchar(30),@TelefonoIII varchar(30),@CIva int,
@Cuit varchar(14),@Cuenta int,@email varchar(30), @Ganancia int, @Exento char(1),@Sumariza int)
as 
begin
  update proveedores set
  RazonSocial=@RazonSocial,Contacto=@Contacto,Domicilio=@Domicilio,Localidad=@Localidad,
  Provincia=@Provincia,CPostal=@CPostal,Telefono=@Telefono,TelefonoII=@TelefonoII,
  TelefonoIII=@TelefonoIII,CIva=@CIva,Cuit=@Cuit,Cuenta=@Cuenta,email=@email,
  TablaGanancia = @Ganancia, Exento = @Exento, Sumariza = @Sumariza
  where codigo=@codigo
end



GO
/****** Object:  StoredProcedure [dbo].[sp_modprovfondo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  procedure [dbo].[sp_modprovfondo](@proveedor int,@razonsocial varchar(30),@civa int,@cuit char(14),@cuenta int)
as
begin
   update provfondo set
   razonsocial=@razonsocial,civa=@civa,cuit=@cuit, cuenta=@cuenta
   where proveedor=@proveedor 
end



GO
/****** Object:  StoredProcedure [dbo].[sp_modreparticion]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modreparticion] (@reparticion int,@nombre varchar(30))
as
begin
   update reparticiones set
   nombre=@nombre
   where reparticion=@reparticion
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modsindicato]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modsindicato] (@sindicato int,@descripcion varchar(30))
as
begin
   update sindicatos set
   descripcion=@descripcion
   where sindicato=@sindicato
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modsituacion]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modsituacion] (@situacion int,@descripcion varchar(30))
as
begin
   update situaciones set
   descripcion=@descripcion
   where situacion=@situacion
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modtareacumplida]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modtareacumplida] (@tareacumplida int,@descripcion varchar(30))
as
begin
   update tareascumplidas set
   descripcion=@descripcion
   where tareacumplida=@tareacumplida
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modtipcompmodheader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[sp_modtipcompmodheader] (@codigo int,@comprobante char(5),
@descripcion varchar(25),@signo int)
as 
begin
  update tipcompmodheader set
  comprobante=@comprobante,descripcion=@descripcion,signo=@signo
  where codigo=@codigo
end

GO
/****** Object:  StoredProcedure [dbo].[sp_modtipcompmoditem]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[sp_modtipcompmoditem] (@codigo int,@concepto char(5),@signo int)
as 
begin
  update tipcompmoditems set
  signo=@signo
  where codigo=@codigo and concepto=@concepto
end

GO
/****** Object:  StoredProcedure [dbo].[sp_modtipocompmodelo]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modtipocompmodelo] (@codigo int,@descripcion varchar(25),
@concepto char(3),@signo int,@tipo int)
as 
begin
  update TiposComprobantesModelo set
  descripcion=@descripcion,concepto=@concepto,signo=@signo,tipo=@tipo
  where codigo=@codigo
end

GO
/****** Object:  StoredProcedure [dbo].[sp_modtipventmodheader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[sp_modtipventmodheader] (@codigo int,@comprobante char(5),
@descripcion varchar(25),@signo int)
as 
begin
  update tipventmodheader set
  comprobante=@comprobante,descripcion=@descripcion,signo=@signo
  where codigo=@codigo
end

GO
/****** Object:  StoredProcedure [dbo].[sp_modtipventmoditem]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[sp_modtipventmoditem] (@codigo int,@concepto char(5),@signo int)
as 
begin
  update tipventmoditems set
  signo=@signo
  where codigo=@codigo and concepto=@concepto
end

GO
/****** Object:  StoredProcedure [dbo].[sp_modusuario]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modusuario](@idUsuario int,@uName char(10),@uPwd char(10),
@sqlName char(10),@sqlPwd char(10))
as
begin
   update usuarios set 
   uName=@uName,uPwd=@upwd,sqlName=@sqlname,sqlPwd=@sqlpwd 
   where idusuario=@idusuario
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modvencliheader]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE procedure [dbo].[sp_modvencliheader](@idtransaccion int,@comprobante int,@aniomes int,
@fecha datetime,@proveedor int,@tipocomprobante int,@nrocomprobante char(12),
@tipofactura char(1),@totalimporte numeric(18,2),@fecha1venc datetime=null,
@fecha2venc datetime=null,@estado char(1),@fechareal datetime,@centrocosto int,
@bUpdateAll bit=0, --Indica si actualiza todo normalmente o es llamado desde AsientosDiarios
--Los paramatros de idoperacion,idtipotransaccion,itemdiario son para insertar en Detalle_operaciones
@IdOperacion int=null,@IdTipoTransaccion int=null,@itemdiario int=null,@inewitem int=null,@descripcionimporte varchar(255),
@Moneda int, @ImporteOrigen numeric(18,2),@tc numeric(18,2))
as
begin
--   if @bUpdateAll=0
      update venCliheader set
      fecha=@fecha,Cliente=@proveedor,tipocomprobante=@tipocomprobante,
      nrocomprobante=@nrocomprobante,tipofactura=@tipofactura,totalimporte=@totalimporte,
      fecha1venc=@fecha1venc,fecha2venc=@fecha2venc,estado=@estado,
      fechareal=@fechareal,centrocosto=@centrocosto,descripcionimporte=@descripcionimporte,Moneda=@Moneda,ImporteOrigen=@ImporteOrigen,TC=@TC
      where idtransaccion=@idtransaccion
/*   else --Actualizamos solo los campos desde AsientosDiarios
    begin
      update compprovheader set
      fecha=@fecha,proveedor=@proveedor,tipocomprobante=@tipocomprobante,
      nrocomprobante=@nrocomprobante,tipofactura=@tipofactura,totalimporte=@totalimporte,
      estado=@estado,centrocosto=@centrocosto
      where idtransaccion=@idtransaccion
      update detalle_operaciones set
      idTipoTransaccion=@idtipotransaccion,itemdiario=@inewitem
      where idoperacion=@idoperacion and idtransaccion=@idtransaccion
    end*/
end



GO
/****** Object:  StoredProcedure [dbo].[sp_modvencliitems]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modvencliitems](@comprobante int,@aniomes int,@item int,
@concepto char(3),@importe numeric(18,2),
@cuentaneto int,@neto numeric(18,2),@cuentamonto int,@monto numeric(18,2))
as
begin
   update vencliitems set
   concepto=@concepto,@importe=@importe,
   cuentaneto=@cuentaneto,neto=@neto,cuentamonto=@cuentamonto,monto=@monto
   where comprobante=@comprobante and aniomes=@aniomes and item=@item
end


GO
/****** Object:  StoredProcedure [dbo].[sp_modzonageografica]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_modzonageografica] (@zonageografica int,@descripcion varchar(30))
as
begin
   update zonasgeograficas set
   descripcion=@descripcion
   where zonageografica=@zonageografica
end


GO
/****** Object:  StoredProcedure [dbo].[sp_movefondostemp]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


create procedure [dbo].[sp_movefondostemp] (
@computer varchar(100),	--Nombre del puesto de trabajo
@fechafondo datetime,	--Fecha Solicitada del Query
@cuentafondo int,	--Cuenta Solicitada del Query
@tipooperacion int,	--Tipo de Operacion
@tipotransaccion int,	--Tipo de Transaccion
@tipoasiento int	--Tipo de Asiento
)
as
/*declare @computer varchar(100),@fechafondo datetime,@cuentafondo int,
@tipooperacion int,@tipotransaccion int,@tipoasiento int

select @computer='JUPISERVER'
select @fechafondo=convert(datetime,'04/06/2002',103)
select @cuentafondo=1000000,@tipooperacion=0,@tipotransaccion=3,@tipoasiento=0
*/
begin
   begin transaction
   --Declaramos variables
   declare @itemfondo int
   declare @idtransaccion int,@comprobante int,@aniomes int,@fecha datetime,@proveedor int,
   @tipocomprobante int,@nrocomprobante char(12),@tipofactura char(1),@totalimporte numeric(18,2),
   @cancelado numeric(18,2),@fecha1venc datetime,@fecha2venc datetime,@estado char(1),
   @fechareal datetime,@centrocosto int
   --Limpiamos variables
   select @itemfondo=0

   --Borramos los datos del temporal
   delete compfondosheadertemp where computer=@computer
   delete compfondositemstemp where computer=@computer

   --Declaramos el cursor de Header de Fondos
   declare curFondosHeader cursor local forward_only for
   select c.idtransaccion,c.comprobante,c.aniomes,c.fecha,c.proveedor,c.tipocomprobante,c.nrocomprobante,c.tipofactura,c.totalimporte,c.cancelado,c.fecha1venc,c.fecha2venc,c.estado,c.fechareal,c.centrocosto
   from header_operaciones a
   inner join detalle_operaciones b on a.idoperacion=b.idoperacion and b.idtipotransaccion=@tipotransaccion
   inner join compfondosheader c on b.idtransaccion=c.idtransaccion
   where a.fecha=@fechafondo and a.cuenta=@cuentafondo
   and a.TipodeOperacion=@tipooperacion and a.tipoasiento=@tipoasiento 

   --Abrimos el cursor de Header de Fondos
   open curFondosHeader

   fetch next from curFondosHeader into @idtransaccion,@comprobante,@aniomes,@fecha,@proveedor,@tipocomprobante,@nrocomprobante,@tipofactura,@totalimporte,@cancelado,@fecha1venc,@fecha2venc,@estado,@fechareal,@centrocosto

   while @@fetch_status<>-1
    begin
       --Insertamos en el temporal del Header de Fondos
       select @itemfondo=@itemfondo+1
       insert into compfondosheadertemp (computer,itemfondo,idtransaccion,comprobante,aniomes,fecha,proveedor,tipocomprobante,nrocomprobante,tipofactura,totalimporte,cancelado,fecha1venc,fecha2venc,estado,fechareal,centrocosto)
       values (@computer,@itemfondo,@idtransaccion,@comprobante,@aniomes,@fecha,@proveedor,@tipocomprobante,@nrocomprobante,@tipofactura,@totalimporte,@cancelado,@fecha1venc,@fecha2venc,@estado,@fechareal,@centrocosto)
       fetch next from curFondosHeader into @idtransaccion,@comprobante,@aniomes,@fecha,@proveedor,@tipocomprobante,@nrocomprobante,@tipofactura,@totalimporte,@cancelado,@fecha1venc,@fecha2venc,@estado,@fechareal,@centrocosto
    end
   close curFondosHeader
   deallocate curFondosHeader

   insert into compfondositemstemp (computer,itemfondo,comprobante,aniomes,item,concepto,importe,cuentaneto,neto,cuentamonto,monto)
   select c.computer,c.itemfondo,d.comprobante,d.aniomes,d.item,d.concepto,d.importe,d.cuentaneto,d.neto,d.cuentamonto,d.monto
   from header_operaciones a
   inner join detalle_operaciones b on a.idoperacion=b.idoperacion and b.idtipotransaccion=@tipotransaccion
   inner join compfondosheadertemp c on b.idtransaccion=c.idtransaccion
   inner join compfondositems d on c.comprobante=d.comprobante and c.aniomes=d.aniomes
   where a.fecha=@fechafondo and a.cuenta=@cuentafondo
   and a.TipodeOperacion=@tipooperacion and a.tipoasiento=@tipoasiento 
   commit transaction
   return @itemfondo
end


GO
/****** Object:  StoredProcedure [dbo].[sp_toaniomes]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_toaniomes](@fecha datetime,@aniomes int output)
as
begin
   select @aniomes=convert(int,convert(varchar(4),year(@fecha))+right(str(month(@fecha)+100),2))
end

GO
/****** Object:  StoredProcedure [dbo].[sp_unlockvalorestesoreria]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

create procedure [dbo].[sp_unlockvalorestesoreria](@computer varchar(100),@tablename varchar(100))
as
begin
   --Verificamos si se puede lockear
   begin transaction
   --Sacamos la marca de lock en los registros que existan en la computadora y tabla
   update valorestesoreria set
   locked=0
   from lockregs a
   where valorestesoreria.idtransaccion=a.idtransaccion 
   and a.computer=@computer and a.tablename=@tablename
   --Eliminamos los registros de la computadora y la tabla indicada
   delete lockregs 
   where computer=@computer and tablename=@tablename
   commit transaction
end
--alter table valorestesoreria add locked bit

GO
/****** Object:  StoredProcedure [dbo].[sp_updLdspHistorico]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  procedure [dbo].[sp_updLdspHistorico]

	@Periodo varchar(10)

as
insert into ldsp580_Historico
Select @Periodo as Periodo,
	col001 as Texto
from temp_ldsp580

drop table Temp_ldsp580


GO
/****** Object:  StoredProcedure [dbo].[sp_updMemmHistorico]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE   procedure [dbo].[sp_updMemmHistorico]

	@Periodo varchar(10)

as
insert into Memm_Historico
Select @Periodo as Periodo,
		convert(char(35),Col001) + Convert(char(41),Col002) as Texto
from Memm




GO
/****** Object:  StoredProcedure [dbo].[sp_updN580Historico]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE  procedure [dbo].[sp_updN580Historico]

	@Periodo varchar(10)

as
insert into N580_Historico
Select @Periodo as Periodo, col001, col002
from temp_N580

drop table Temp_N580


GO
/****** Object:  StoredProcedure [dbo].[sp_updNoveHistorico]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE    procedure [dbo].[sp_updNoveHistorico]

	@Periodo varchar(10)

as
insert into Nove_Historico
Select @Periodo as Periodo,
		convert(char(35),Col001) + Convert(char(134),Col002) + Convert(char(11),Col003) as Texto
from Nove





GO
/****** Object:  StoredProcedure [dbo].[sp_updUltimaGeneracion]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO




CREATE            PROCEDURE [dbo].[sp_updUltimaGeneracion] 
	@N_socio 		int,  
	@N_Entidad		int, 
	@D_FechaGeneracion	DateTime=null

AS

if @N_Entidad=0 
	update SOCIOS set ultimaGeneracion=@D_FechaGeneracion where socio=@N_SOCIO
else if @N_Entidad=1
	update Adherentes set ultimaGeneracion=@D_FechaGeneracion where adherente=@N_SOCIO




GO
/****** Object:  StoredProcedure [dbo].[StockArticulos]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO



CREATE          Procedure [dbo].[StockArticulos]
(
	@Deposito	int=0,
	@Hasta		char(8)='',
	@Orden		char(1)='A', -- A lfabetico C odigo D escripcion P art number S ector ubicacion
	@Linea		int=0,
	@SubLinea	int=0,
	@Marca		int=0,
	@AIT		char(1)='A',
	@Detalle	char(1)='S',
	@Pedido		char(1)='N',
	@ArticuloDesde	varChar(20)='',
	@ArticuloHasta	varChar(20)='',
	@Serie		varChar(20)='',
	@Minimo		numeric(18,2)=-99999999.99,
	@Maximo		numeric(18,2)=0, --99999999.99,
	@PrecioMinimo		numeric(18,2)=-99999999.99,
	@PrecioMaximo		numeric(18,2)=99999999.99,
	@ParcialMinimo		numeric(18,2)=-99999999.99,
	@ParcialMaximo		numeric(18,2)=99999999.99,
	@Columnas	int=2,
	@tc			numeric (18,4)=3.86,
	@ConDesde		char(8)='19000101',
	@SinDesde		char(8)=''
)
as

Declare @SqlScrpt nvarchar(4000)
Declare @Sqlconect nvarchar(10)

Set @Sqlconect=' Where '

set @SqlScrpt='Select a.idArticulo,a.articulo,a.notas,ea.serial,a.Descripcion,sum(cantidad*signo) Stock,
a.articulo as grupoRpt, isnull(dp.descripcion,cl.razonSocial) Deposito, a.sector, a.ubicacion, a.precio,a.minimo, 
max(ho.fecha)
-- into stp12

from estadisticaArticulos ea
inner join tiposMovimientoStock t
on ea.tipomovimiento=t.idTipomovimientoStock
inner join articulos a
on ea.idarticulo=a.idarticulo
left join Header_operaciones ho 
on ho.idOperacion=ea.idOPeracion
left join Depositos dp on ea.Deposito=dp.idDeposito
left join Clientes cl on ea.Deposito=cl.Codigo
 '

if @Deposito<>0
begin
	set @SqlScrpt=@SqlScrpt + @SqlConect + ' Deposito=' + cast(@Deposito as char(8))
	Set @Sqlconect=' And '
end

if @Linea<>0
begin
	set @SqlScrpt=@SqlScrpt + @SqlConect + ' idLinea=' + cast(@Linea as char(8))
	Set @Sqlconect=' And '
end

if @Sublinea<>0
begin
	set @SqlScrpt=@SqlScrpt + @SqlConect + ' idSublinea=' + cast(@Sublinea as char(8))
	Set @Sqlconect=' And '
end

if @Marca<>0
begin
	set @SqlScrpt=@SqlScrpt + @SqlConect + ' Deposito=' + cast(@Marca as char(8))
	Set @Sqlconect=' And '
end

--Fecha Hasta
if @Hasta <> ''
begin
	Set @SqlScrpt=@SqlScrpt + @SqlConect + ' isnull(ho.Fecha,"19000101") <= "' + @Hasta + '"'
	Set @Sqlconect=' And '
end

if @ArticuloDesde <> ''
begin
	Set @SqlScrpt=@SqlScrpt + @SqlConect + ' articulo >= "' + @ArticuloDesde + '"'
	Set @Sqlconect=' And '
end

if @ArticuloHasta <> ''
begin
	Set @SqlScrpt=@SqlScrpt + @SqlConect + ' articulo <= "' + @ArticuloHasta + '"'
	Set @Sqlconect=' And '
end

if @Serie <> ''
begin
	Set @SqlScrpt=@SqlScrpt + @SqlConect + ' ltrim(rtrim(Serial)) =  "ltrim(rtrim(' + @Serie + '))"'
	Set @Sqlconect=' And '
end

if @AIT='A'
	begin
		Set @SqlScrpt=@SqlScrpt + @SqlConect + ' a.fechainactivo is null'
		Set @Sqlconect=' And '
	end
else if @AIT='I'
	begin
		Set @SqlScrpt=@SqlScrpt + @SqlConect + ' a.fechainactivo is not null'
		Set @Sqlconect=' And '
	end

Set @SqlScrpt=@SqlScrpt + @SqlConect + ' a.precio between ' + cast(@Preciominimo as varchar(15)) + ' and ' + cast(@Preciomaximo as varchar(15))
Set @Sqlconect=' And '


Set @SqlScrpt=@SqlScrpt + @SqlConect + ' isnull(procesa,1)=1'


Set @SqlScrpt=@SqlScrpt + ' Group by Deposito,a.idArticulo,a.articulo,a.Notas,a.Descripcion,ea.serial,isnull(dp.descripcion,cl.razonSocial), a.sector, a.ubicacion, a.precio, a.minimo '

if @Pedido<>'S'
	Set @SqlScrpt=@SqlScrpt + ' having sum(cantidad*signo)<>0 and sum(cantidad*signo) between ' + cast(@minimo as varchar(15)) + ' and ' + cast(@maximo as varchar(15))
else
	Set @SqlScrpt=@SqlScrpt + ' having sum(cantidad*signo)<a.minimo '

if @ConDesde <> ''
begin
	Set @SqlScrpt=@SqlScrpt + ' and max(isnull(ho.Fecha,"19000101")) >= "' + @ConDesde + '"'
end

if @SinDesde <> ''
begin
	Set @SqlScrpt=@SqlScrpt + ' and max(isnull(ho.Fecha,"19000101")) <= "' + @SinDesde + '"'
end


Set @SqlScrpt=@SqlScrpt + ' and sum(cantidad*signo*a.precio) between ' + cast(@Parcialminimo as varchar(15)) + ' and ' + cast(@Parcialmaximo as varchar(15))


if @Orden='C' or @Orden='A'
	Set @SqlScrpt=@SqlScrpt + ' order by Articulo'
else if @Orden='D'
	Set @SqlScrpt=@SqlScrpt + ' order by a.Descripcion'
else if @Orden='P'
	Set @SqlScrpt=@SqlScrpt + ' order by a.Notas'
else if @Orden='S'
	Set @SqlScrpt=@SqlScrpt + ' order by a.Sector, a.Ubicacion, a.Descripcion'
else
	Set @SqlScrpt=@SqlScrpt + ' order by a.Descripcion '

--print @SqlScrpt

EXEC sp_executesql @SqlScrpt
















GO
/****** Object:  StoredProcedure [dbo].[StockArticulosPrueba]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO





CREATE          Procedure [dbo].[StockArticulosPrueba]
(
	@Deposito	int=0,
	@Hasta		char(8)='',
	@Orden		char(1)='A', -- A lfabetico C odigo D escripcion P art number S ector ubicacion
	@Linea		int=0,
	@SubLinea	int=0,
	@Marca		int=0,
	@AIT		char(1)='A',
	@Detalle	char(1)='S',
	@Pedido		char(1)='N',
	@ArticuloDesde	varChar(20)='',
	@ArticuloHasta	varChar(20)='',
	@Serie		varChar(20)='',
	@Minimo		numeric(18,2)=-99999999.99,
	@Maximo		numeric(18,2)=99999999.99,
	@PrecioMinimo		numeric(18,2)=-99999999.99,
	@PrecioMaximo		numeric(18,2)=99999999.99,
	@ParcialMinimo		numeric(18,2)=-99999999.99,
	@ParcialMaximo		numeric(18,2)=99999999.99,
	@Columnas	int=2,
	@tc			numeric (18,4)=8.133,
	@ConDesde		char(8)='20090601',
	@SinDesde		char(8)=''
)
as

Declare @SqlScrpt nvarchar(4000)
Declare @Sqlconect nvarchar(10)

Set @Sqlconect=' Where '

set @SqlScrpt='Select a.idArticulo,a.articulo,a.notas,ea.serial,a.Descripcion,sum(cantidad*signo) Stock,
a.articulo as grupoRpt, isnull(dp.descripcion,cl.razonSocial) Deposito, a.sector, a.ubicacion, a.precio,a.minimo, 
max(ho.fecha)
-- into stp12

from estadisticaArticulos ea
inner join tiposMovimientoStock t
on ea.tipomovimiento=t.idTipomovimientoStock
inner join articulos a
on ea.idarticulo=a.idarticulo
left join Header_operaciones ho 
on ho.idOperacion=ea.idOPeracion
left join Depositos dp on ea.Deposito=dp.idDeposito
left join Clientes cl on ea.Deposito=cl.Codigo
 '

if @Deposito<>0
begin
	set @SqlScrpt=@SqlScrpt + @SqlConect + ' Deposito=' + cast(@Deposito as char(8))
	Set @Sqlconect=' And '
end

if @Linea<>0
begin
	set @SqlScrpt=@SqlScrpt + @SqlConect + ' idLinea=' + cast(@Linea as char(8))
	Set @Sqlconect=' And '
end

if @Sublinea<>0
begin
	set @SqlScrpt=@SqlScrpt + @SqlConect + ' idSublinea=' + cast(@Sublinea as char(8))
	Set @Sqlconect=' And '
end

if @Marca<>0
begin
	set @SqlScrpt=@SqlScrpt + @SqlConect + ' Deposito=' + cast(@Marca as char(8))
	Set @Sqlconect=' And '
end

--Fecha Hasta
if @Hasta <> ''
begin
	Set @SqlScrpt=@SqlScrpt + @SqlConect + ' isnull(ho.Fecha,"19000101") <= "' + @Hasta + '"'
	Set @Sqlconect=' And '
end

if @ArticuloDesde <> ''
begin
	Set @SqlScrpt=@SqlScrpt + @SqlConect + ' articulo >= "' + @ArticuloDesde + '"'
	Set @Sqlconect=' And '
end

if @ArticuloHasta <> ''
begin
	Set @SqlScrpt=@SqlScrpt + @SqlConect + ' articulo <= "' + @ArticuloHasta + '"'
	Set @Sqlconect=' And '
end

if @Serie <> ''
begin
	Set @SqlScrpt=@SqlScrpt + @SqlConect + ' ltrim(rtrim(Serial)) =  "ltrim(rtrim(' + @Serie + '))"'
	Set @Sqlconect=' And '
end

if @AIT='A'
	begin
		Set @SqlScrpt=@SqlScrpt + @SqlConect + ' a.fechainactivo is null'
		Set @Sqlconect=' And '
	end
else if @AIT='I'
	begin
		Set @SqlScrpt=@SqlScrpt + @SqlConect + ' a.fechainactivo is not null'
		Set @Sqlconect=' And '
	end

Set @SqlScrpt=@SqlScrpt + @SqlConect + ' a.precio between ' + cast(@Preciominimo as varchar(15)) + ' and ' + cast(@Preciomaximo as varchar(15))
Set @Sqlconect=' And '


Set @SqlScrpt=@SqlScrpt + @SqlConect + ' isnull(procesa,1)=0'


Set @SqlScrpt=@SqlScrpt + ' Group by Deposito,a.idArticulo,a.articulo,a.Notas,a.Descripcion,ea.serial,isnull(dp.descripcion,cl.razonSocial), a.sector, a.ubicacion, a.precio, a.minimo '

if @Pedido<>'S'
	Set @SqlScrpt=@SqlScrpt + ' having sum(cantidad*signo)<>0 and sum(cantidad*signo) between ' + cast(@minimo as varchar(15)) + ' and ' + cast(@maximo as varchar(15))
else
	Set @SqlScrpt=@SqlScrpt + ' having sum(cantidad*signo)<a.minimo '

if @ConDesde <> ''
begin
	Set @SqlScrpt=@SqlScrpt + ' and max(isnull(ho.Fecha,"19000101")) >= "' + @ConDesde + '"'
end

if @SinDesde <> ''
begin
	Set @SqlScrpt=@SqlScrpt + ' and max(isnull(ho.Fecha,"19000101")) <= "' + @SinDesde + '"'
end


Set @SqlScrpt=@SqlScrpt + ' and sum(cantidad*signo*a.precio) between ' + cast(@Parcialminimo as varchar(15)) + ' and ' + cast(@Parcialmaximo as varchar(15))


if @Orden='C' or @Orden='A'
	Set @SqlScrpt=@SqlScrpt + ' order by Articulo'
else if @Orden='D'
	Set @SqlScrpt=@SqlScrpt + ' order by a.Descripcion'
else if @Orden='P'
	Set @SqlScrpt=@SqlScrpt + ' order by a.Notas'
else if @Orden='S'
	Set @SqlScrpt=@SqlScrpt + ' order by a.Sector, a.Ubicacion, a.Descripcion'
else
	Set @SqlScrpt=@SqlScrpt + ' order by a.Descripcion '

print @SqlScrpt

EXEC sp_executesql @SqlScrpt


















GO
/****** Object:  StoredProcedure [dbo].[SubdiarioIvaCompras]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Procedure [dbo].[SubdiarioIvaCompras]
(
	@Desde	Char(8),
	@Hasta	Char(8)
)
as
Select cph.fecha,
ah.asiento,ah.tipoasiento,ah.aniomes,cph.idtransaccion,razonsocial,totalimporte,
-ai.debe+ai.haber Proveedor, isnull(aiIva.debe-aiIva.Haber,0) IvaProveedor,
substring(nroComprobante,1,4) pv,substring(nroComprobante,5,8) nFac,TipoFactura,ci.Resumido dCiva,
c.cuit,sum(cpi.importe) NetoGravado
from asientosdiariosheader ah
left join asientosdiariosItems ai 
on ah.asiento=ai.asiento and ah.aniomes=ai.aniomes and ah.tipoasiento=ai.tipoasiento 
and (cuenta=(Select Proveedores from parametrosgeneralesSueldos) 
or cuenta=(Select proveedoresExterior from parametrosgeneralesSueldos))
left join asientosdiariosItems aiIva 
on ah.asiento=aiIva.asiento and ah.aniomes=aiIva.aniomes and ah.tipoasiento=aiIva.tipoasiento 
and (aiIva.cuenta=(Select CuentaIvaCompras from parametrosgeneralesSueldos))
inner join Header_operaciones ho 
on ho.asientoDiario=ah.asiento and ho.tipoasiento=ah.tipoasiento and ho.aniomes=ah.aniomes
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner join compProvHeader cph
on do.idtransaccion=cph.idtransaccion
left join compProvItems cpi on 
cpi.idtransaccion=cph.idtransaccion and cpi.concepto='NG'
inner join TipCompModHeader t
on cph.tipocomprobante=t.codigo
inner join Proveedores c
on cph.Proveedor=c.codigo
inner join categorias_iva ci
on c.civa=ci.idciva

Where ah.tipoasiento=3
and ah.fecha between @Desde and @Hasta
and idtipotransaccion=1

Group by cph.fecha,ah.asiento,ah.tipoasiento,ah.aniomes,cph.idtransaccion,razonsocial,totalimporte,
-ai.debe+ai.haber, isnull(aiIva.debe-aiIva.Haber,0),
substring(nroComprobante,1,4),substring(nroComprobante,5,8),TipoFactura,ci.Resumido,
c.cuit


GO
/****** Object:  StoredProcedure [dbo].[SubdiarioIvaComprasAuditron]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Procedure [dbo].[SubdiarioIvaComprasAuditron]
(
	@Periodo	int=200712
)
as
Select cph.idtransaccion,day(cph.fecha),tph.comp,ci.descripcion,nroComprobante,tipofactura,razonsocial,cuit,
(Select Sum(-isnull(debe,0)+isnull(Haber,0)) from Asientosdiariositems 
where asiento=ho.asientodiario and tipoasiento=ho.tipoasiento and aniomes=ho.aniomes 
and cuenta=3101100) Proveedores,
(Select Sum(BaseContable) from CompProvItems
where idtransaccion=cph.idtransaccion 
and ltrim(rtrim(concepto))='NG') NetoGravado,
(Select Sum(isnull(debe,0)+isnull(Haber,0)) from Asientosdiariositems 
where asiento=ho.asientodiario and tipoasiento=ho.tipoasiento and aniomes=ho.aniomes 
and cuenta=3303100) Iva

from Header_operaciones ho
inner join Detalle_operaciones do 
on ho.idOperacion=do.idOperacion
inner Join CompProvHeader cph 
on do.idtransaccion=cph.idtransaccion
inner join Proveedores p 
on cph.proveedor=p.codigo
inner join TipCompModHeader tph
on cph.tipocomprobante=tph.codigo
inner join Categorias_Iva ci 
on p.Civa=ci.idciva
where  ho.aniomes=@Periodo and tipoasiento=3
order by day(cph.Fecha),asientoDiario

GO
/****** Object:  StoredProcedure [dbo].[SubdiarioIvaComprasResumen]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create Procedure [dbo].[SubdiarioIvaComprasResumen]
(
	@Desde	Char(8),
	@Hasta	Char(8)
)
as
Select c.cuenta,c.descripcion,Sum(debe-haber) importe 
from asientosdiariositems ai
inner join cuentas c
on ai.cuenta=c.cuenta
inner join AsientosdiariosHeader ah
on ai.asiento=ah.asiento and ai.aniomes=ah.aniomes and ai.tipoasiento=ah.tipoasiento
where ah.fecha between @Desde and @Hasta
and ai.cuenta<>(Select Proveedores from parametrosgeneralesSueldos) 
and ai.cuenta<>(Select proveedoresExterior from parametrosgeneralesSueldos)
and ai.cuenta<>(Select CuentaIvaCompras from parametrosgeneralesSueldos)
and ai.tipoasiento=3
Group by c.cuenta,c.descripcion
GO
/****** Object:  StoredProcedure [dbo].[SubdiarioIvaComprasVarios]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Procedure [dbo].[SubdiarioIvaComprasVarios]
(
	@Asiento	int,
	@aniomes	int	
)
as
Select c.cuenta,c.descripcion,debe-haber importe from asientosdiariositems ai
inner join cuentas c
on ai.cuenta=c.cuenta
where asiento=@asiento and aniomes=@aniomes and tipoasiento=3
and ai.cuenta<>(Select Proveedores from parametrosgeneralesSueldos) 
and ai.cuenta<>(Select proveedoresExterior from parametrosgeneralesSueldos)
and ai.cuenta<>(Select CuentaIvaCompras from parametrosgeneralesSueldos)


GO
/****** Object:  StoredProcedure [dbo].[Subtotal_Anses]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create Procedure [dbo].[Subtotal_Anses](@Periodo int)
as
Select 
sum(cast(Substring(col002,32,6) as numeric(18,2))/100) as MES
from memm mm

GO
/****** Object:  StoredProcedure [dbo].[Suplentes]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[Suplentes]
as
Select socios.fechabaja,socios.numedocto as Documento, substring(col002,10,2) subnumero,
	socios.tipodocto as TipoDocumento, 
	'580' as Codigo, socios.cuil, 2.5 as Importe,	0 as Seguro,idcampo
from socios
--	inner join grupos_socios as gru_socios
--		on socios.socio = gru_socios.socio
--	inner join grupos gru
--		on gru.grupo = gru_socios.grupo and gru.modo = 1
--	inner join conceptos_socios as con_socios
--		on socios.socio = con_socios.socio 
	inner join c580Guardias c
		on socios.cuilmuni=c.col001
--	inner join conceptos co
--		on co.concepto = con_socios.concepto 
where socios.fechabaja is null or socios.fechabaja>'20050901'
--and ((Select count(*) from CuentasCorrientes where Socio=socios.socio
--and DocumentoNumero=200509 and entidad=0 and isnull(cancelado,0)<>0 and concepto="MES")=0)  and con_socios.fechabaja is null 
--and socios.cuil <> "" and socios.numedocto<>0
--	and dbo.toaniomes(con_socios.fechavigencia)<=200509 
--	and (select count(*) from conceptos_Socios cs
--		inner join conceptos c on c.concepto=cs.concepto
--		where socios.socio=cs.socio and c.modalidad="P" and cs.fechabaja is null and dbo.toaniomes(cs.fechavigencia)<=200508 )>0 
--	and socios.grupo="R" 

--group by socios.numedocto, gru_socios.subnumero, socios.tipodocto, gru_socios.subnumero,
--	socios.cuil, socios.socio  ) 
--Order By socios.cuil 


GO
/****** Object:  StoredProcedure [dbo].[Tabulado]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE           procedure [dbo].[Tabulado](@idLiquidacion int=110)
as

(
Select 
a.concepto as cdConcepto,
c.descripcion + case when a.concepto<>600 then ''
when a.concepto=600 and m.sistemajubilacion = 1 then '  5 % '
when a.concepto=600 and m.sistemajubilacion = 0 then ' 11 % '
end Descripcion				
,c.tipoConcepto  TipoConcepto ,tcl.Multiplicador
,tcl.Descripcion  dTipoConcepto , 0 as Horas
,sum(importe) as Importe
From 
Items_liquidaciones a
inner join maestropersonal m on a.legajo=m.legajo
inner join conceptosLiquidacion c on a.concepto=c.concepto
inner join tipconcliq tcl on c.tipoconcepto=tcl.concepto
where a.idliquidacion=@idLiquidacion -- and a.concepto<>600 
group by a.concepto,
c.descripcion + case when a.concepto<>600 then ''
when a.concepto=600 and m.sistemajubilacion = 1 then '  5 % '
when a.concepto=600 and m.sistemajubilacion = 0 then ' 11 % '
end
,c.tipoConcepto
,tcl.Multiplicador
,tcl.Descripcion
)

order by a.concepto


GO
/****** Object:  StoredProcedure [dbo].[TiposdeIva]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE   Procedure [dbo].[TiposdeIva]
(
	@Desde char(8)='20080701',
	@Hasta char(8)='20080731'
)
as
Select alicuota,dciva,sum(Total) Total,sum(neto) Neto, sum(iva) Iva from vivaventas
where fecha between @Desde and @Hasta
Group by dciva,alicuota



GO
/****** Object:  StoredProcedure [dbo].[TotalaFecha]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[TotalaFecha]
(	@Fecha char(8),
	@Entidad int
)
as
if @Entidad=0
	Select Count(*) Casos from socios 
	where dbo.activoal(socio,0,@Fecha)>0
else
	Select Count(*) Casos from Adherentes 
	where dbo.activoal(Adherente,0,@Fecha)>0








GO
/****** Object:  StoredProcedure [dbo].[TotalConceptos]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[TotalConceptos]
(
	@Periodo	int,
	@Proveedor	int,
	@Concepto	char(3)='OP'
)
as
Select Sum(totalImporte) as Total
from compProvheader cp
inner join tipCompModHeader tch
on cp.tipocomprobante=tch.codigo
where tch.comprobante=@Concepto and cp.proveedor=@Proveedor 
and dbo.toaniomes(cp.fecha)=@Periodo

GO
/****** Object:  StoredProcedure [dbo].[TotalesBalancePresentacion]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE   Procedure [dbo].[TotalesBalancePresentacion]
as

Select 
(
	select isnull(sum(debe-haber),0) from asientosDiariosItems ai
	inner join cuentas ct on ai.cuenta=ct.cuenta
	left Join Capitulos_Contablidad caco on 
	Substring(cast(ct.cuenta as char(6)),1,1)=caco.capitulo
	left Join Rubros_Contablidad rc on 
	caco.rubro=rc.rubro
	left Join  Cuentas ct1
	on cast( substring(cast(ct.cuenta as char(6)),1,1)+  cast(ct.rubro as char(3)) + '00' as int)=ct1.cuenta
	where tipoasiento=0 and caco.rubro=0 and (ai.aniomes between 200305 and 200404)
) as activo,
(
	select isnull(sum(debe-haber),0) from asientosDiariosItems ai
	inner join cuentas ct on ai.cuenta=ct.cuenta
	left Join Capitulos_Contablidad caco on 
	Substring(cast(ct.cuenta as char(6)),1,1)=caco.capitulo
	left Join Rubros_Contablidad rc on 
	caco.rubro=rc.rubro
	left Join  Cuentas ct1
	on cast( substring(cast(ct.cuenta as char(6)),1,1)+  cast(ct.rubro as char(3)) + '00' as int)=ct1.cuenta
	where tipoasiento=0 and caco.rubro=1 and (ai.aniomes between 200305 and 200404)
) as Pasivo,
(
	select isnull(sum(debe-haber),0) from asientosDiariosItems ai
	inner join cuentas ct on ai.cuenta=ct.cuenta
	left Join Capitulos_Contablidad caco on 
	Substring(cast(ct.cuenta as char(6)),1,1)=caco.capitulo
	left Join Rubros_Contablidad rc on 
	caco.rubro=rc.rubro
	left Join  Cuentas ct1
	on cast( substring(cast(ct.cuenta as char(6)),1,1)+  cast(ct.rubro as char(3)) + '00' as int)=ct1.cuenta
	where tipoasiento=0 and caco.rubro=2
) as PatrimonioNeto,
(
	select isnull(sum(debe-haber),0) from asientosDiariosItems ai
	inner join cuentas ct on ai.cuenta=ct.cuenta
	left Join Capitulos_Contablidad caco on 
	Substring(cast(ct.cuenta as char(6)),1,1)=caco.capitulo
	left Join Rubros_Contablidad rc on 
	caco.rubro=rc.rubro
	left Join  Cuentas ct1
	on cast( substring(cast(ct.cuenta as char(6)),1,1)+  cast(ct.rubro as char(3)) + '00' as int)=ct1.cuenta
	where tipoasiento=0 and caco.rubro=3 and (ai.aniomes between 200305 and 200404)
) as Gastos,
(
	select isnull(sum(debe-haber),0) from asientosDiariosItems ai
	inner join cuentas ct on ai.cuenta=ct.cuenta
	left Join Capitulos_Contablidad caco on 
	Substring(cast(ct.cuenta as char(6)),1,1)=caco.capitulo
	left Join Rubros_Contablidad rc on 
	caco.rubro=rc.rubro
	left Join  Cuentas ct1
	on cast( substring(cast(ct.cuenta as char(6)),1,1)+  cast(ct.rubro as char(3)) + '00' as int)=ct1.cuenta
	where tipoasiento=0 and caco.rubro=4 and (ai.aniomes between 200305 and 200404)
) as Ingresos





GO
/****** Object:  StoredProcedure [dbo].[TotalRetenido]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[TotalRetenido]
(
	@Periodo	int,
	@Proveedor	int,
	@Concepto	char(3)='OP'
)
as
Select Sum(vt.importe) as total from CompProvHeader cp
inner join detalle_operaciones do on cp.idtransaccion=do.idtransaccion
inner join tipCompModHeader tch on cp.tipocomprobante=tch.codigo
inner Join detalle_operaciones do1 on do.idOperacion=do1.idOperacion
inner Join ValoresTesoreria vt on vt.idtransaccion=do1.idtransaccion
where proveedor=@Proveedor
and do.idtipotransaccion=1 -- Ordenes de Pago
and tch.comprobante=@Concepto
and do1.idtipotransaccion=2 -- Valores Tesoreria
and vt.idConcepto_tesoreria=8
and dbo.toaniomes(cp.fecha)=@Periodo




GO
/****** Object:  StoredProcedure [dbo].[Trae_AsientoDiario]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create Procedure [dbo].[Trae_AsientoDiario] (@Asiento int, @Aniomes int)
as

Select * from Header_Operaciones 
where asientodiario=@Asiento and aniomes=@Aniomes and tipoasiento=0

Select * from AsientosDiariosHeader
where asiento=@Asiento and aniomes=@Aniomes and tipoasiento=0

Select * from AsientosDiariosItems
where asiento=@Asiento and aniomes=@Aniomes and tipoasiento=0

GO
/****** Object:  StoredProcedure [dbo].[Trae_Novedades]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

Create Procedure [dbo].[Trae_Novedades] (@Periodo int, @Aniomes int)
as
 
Delete ConceptosLegajosNovedades 

Insert into conceptosLegajosNovedades 
select * from ConceptosLegajosNovedadesDiciembreFinal
where aniomes=@Aniomes and periodo=@Periodo


GO
/****** Object:  StoredProcedure [dbo].[TraeCuits]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Procedure [dbo].[TraeCuits]
as
Select ho.fecha,ho.observacion,ai.cuenta,ai.debe-haber,
isnull(p.razonSocial,p1.razonSocial),isnull(p.cuit,p1.cuit) 
from asientosdiariositems ai
inner join header_Operaciones ho
on ai.asiento=ho.asientodiario and ai.aniomes=ho.aniomes and ai.tipoasiento=ho.tipoasiento
inner join detalle_operaciones do 
on ho.idOperacion=do.idOPeracion
inner join compProvHeader cph
on do.idtransaccion=cph.idtransaccion
left join proveedores p 
on cph.proveedor=p.codigo
left join provFondo p1
on cph.proveedor=p1.proveedor
where ai.aniomes=200907 and ai.cuenta between 127901 and 127920
and idtipotransaccion=1


GO
/****** Object:  StoredProcedure [dbo].[TraeDobles]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


-- TraeDobles 200601,200512,1

CREATE  Procedure [dbo].[TraeDobles] (
	@Periodo	int,
	@Desde		int,
	@Tarjeta	int
)
as
Select sc.apellido,sc.nombre,Cc.documentoNumero as Periodo,sc.socio,
Cc.documentoNumero as MesaImputar,cc.entidad,cc.importe,@Tarjeta as tarjeta
from Socios sc
inner join CuentasCorrientes cc
on sc.socio=cc.socio 
where entidad=0 and tarjeta=@Tarjeta 
and concepto='MES' and isnull(cancelado,0)=0
and DocumentoNumero<>@Periodo
and sc.fechabaja is null
and cc.documentonumero>@Desde
Union
Select sc.apellido,sc.nombre,Cc.documentoNumero as Periodo,sc.Adherente,
Cc.documentoNumero as MesaImputar,cc.entidad,cc.importe,@Tarjeta as tarjeta
from Adherentes sc
inner join CuentasCorrientes cc
on sc.Adherente=cc.socio 
where cc.entidad=1 and tarjeta=@Tarjeta
and concepto='MES' and isnull(cancelado,0)=0
and DocumentoNumero<>@Periodo
and sc.fechabaja is null
and cc.documentonumero>@Desde
Union
Select sc.nyap apellido,'' nombre,Cc.documentoNumero as Periodo,sc.idalumno,
Cc.documentoNumero as MesaImputar,cc.entidad,cc.importe,@Tarjeta as tarjeta
from Alumnos sc
inner join CuentasCorrientes cc
on sc.idAlumno=cc.socio 
where cc.entidad=2 and tarjeta=@Tarjeta
and (concepto='MAT' or concepto='CUO') and isnull(cancelado,0)=0
and dbo.toaniomes(cc.fecha)<>@Periodo
-- and sc.fechabaja is null
and (dbo.toaniomes(cc.fecha)>@Desde and dbo.toaniomes(cc.fecha)<@Periodo)


--TraeDobles 200401,200308,1


GO
/****** Object:  StoredProcedure [dbo].[TraeMovs]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE Procedure [dbo].[TraeMovs]
(
	@Articulo	varchar(6)='701308',
	@Parte		varchar(20)=''
	
)
as
Select ea.idcampo,isnull(isnull(hm.fcproveedor,ea.fcProv),0) fcProv,isnull(oCompra,0) oCompra,isnull(vto,'') vto,
isnull(vto,'')+meses,a.notas,a.articulo


 from temp_vencimientos tv
inner join estadisticaArticulos ea
on tv.idcampo=ea.idcampo
inner join articulos a
on ea.idarticulo=a.idArticulo
left join headerMovimientosStock hm
on ea.idOperacion=hm.idOPeracion
where a.articulo=@Articulo and computername='veamos'



GO
/****** Object:  StoredProcedure [dbo].[TraeUltima]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Procedure [dbo].[TraeUltima] (
	@idCliente	int=121937,
	@Articulo	varchar(20)=''
)
as
Select top 1 ed.descripcion,eap.neto,vch.totalimporte,vch.tipoFactura from EstadisticaArticulos ea
inner join Articulos a
on ea.idArticulo=a.idarticulo
inner join EstadisticaArticulosPrecios eap
on ea.idcampo=eap.idcampo
inner join EstadisticaArticulosDescripciones ed
on ea.idCampo=ed.idcampo
inner join detalle_operaciones do 
on ea.idOperacion=do.idOperacion and idtipotransaccion=0
inner join vencliheader vch on 
do.idtransaccion=vch.idtransaccion
where (((articulo='ALQ' OR ARTICULO LIKE 'HANGA%' OR ARTICULO LIKE 'LOC%' OR ARTICULO='RT') and @Articulo='' ) or Articulo=@Articulo)
and (cliente=@idCliente or @idCliente=0)
order by vch.idtransaccion desc
GO
/****** Object:  StoredProcedure [dbo].[Ultima_Generacion]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


Create Procedure [dbo].[Ultima_Generacion]
	@N_entidad	int,
	@N_Socio	int, 	
	@N_Ultima	datetime output
AS

if @N_Entidad=0
	begin
	Select @N_Ultima=UltimaGeneracion from Socios where socio=@N_socio
	end
else
	begin
	select @N_Ultima=UltimaGeneracion from Adherentes where adherente=@N_Socio
	end



GO
/****** Object:  StoredProcedure [dbo].[UltimosMovimientos]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Procedure [dbo].[UltimosMovimientos]
(
	@idArticulo	int=1,
	@TipoMovimiento int=1
)
as

Select top 10 isnull(ho.fecha,ea.fechados) fecha ,
isnull(oCompra,isnull(docum,0)) docum,cantidad,desvia,vencimiento,meses,
isnull(hm.fcproveedor,docum) fcprov,dbo.Stock(a.idarticulo) from estadisticaarticulos ea
inner join Articulos a
on ea.idarticulo=a.idarticulo
Left join Header_operaciones ho 
on ea.idOPeracion=ho.idOPeracion 
left join Headermovimientosstock hm
on ho.idOperacion=hm.idOPeracion

where ea.idarticulo=@idArticulo
and tipomovimiento=@TipoMovimiento

order by isnull(ho.fecha,ea.fechados) desc
GO
/****** Object:  StoredProcedure [dbo].[UltimosMovs]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Procedure [dbo].[UltimosMovs]
(
	@idArticulo	int=6637,
	@TipoMovimiento	int=23
)
as
Select TOP 5 ho.fecha,ea.Docum,ea.desvia,ea.cantidad from EstadisticaArticulos ea
inner join Articulos a
on ea.idarticulo=a.idarticulo
inner join header_operaciones ho
on ea.idoperacion=ho.idoperacion
where ea.idarticulo=@idArticulo
and TipoMovimiento=@TipoMovimiento
order by fecha desc


GO
/****** Object:  StoredProcedure [dbo].[Utedyc]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

CREATE Procedure [dbo].[Utedyc] -- 200507
(
	@aniomes	int
)
as
Select aniomes,r.legajo,apellido,nombre,remuneracion,
(select isnull(sum(importe),0) from items_liquidaciones i
inner join Header_liquidaciones h
on i.idliquidacion=h.idliquidacion
where aniomes=r.aniomes and legajo=r.legajo
and concepto=603) as 'Sindicato'

from remuneracionesSindicato r
inner join maestroPersonal m
on m.legajo=r.legajo

where (select isnull(sum(importe),0) from items_liquidaciones i
inner join Header_liquidaciones h
on i.idliquidacion=h.idliquidacion
where aniomes=r.aniomes and legajo=r.legajo
and concepto=603)<>0 and aniomes=@Aniomes

order by Aniomes,apellido



GO
/****** Object:  StoredProcedure [dbo].[Valorizastock]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


CREATE   Procedure [dbo].[Valorizastock]
(
	@Costo	int=90,
	@Venta	int=85,
	@adesde	int= 0,
	@ahasta int= 0,
	@TC	numeric(18,2)=3.20

)
as
Select a.idlinea,l.descripcion dLinea,a.idsublinea,sl.descripcion dSublinea,
sum(case when ea.deposito<99 then stock else 0 end) Stock,
sum(case when ea.deposito>99 then stock else 0 end) Consignado,
sum(case when ea.deposito<99 then stock*isnull(dlc.neto,0)*@TC else 0 end) CostoStock,
sum(case when ea.deposito<99 then stock*isnull(dlv.neto,0) else 0 end) VentaStock,
sum(case when ea.deposito>99 then stock*isnull(dlc.neto,0)*@TC else 0 end) CostoConsignado,
sum(case when ea.deposito>99 then stock*isnull(dlv.neto,0) else 0 end) VentaConsignado
from estadisticaArticulos ea
left join estadisticaarticulosprecios eap
on ea.idcampo=eap.idcampo
inner join articulos a
on ea.idarticulo=a.idarticulo
Left join lineas l
on a.idlinea=l.idlinea
left join sublineas sl 
on a.idsublinea=sl.idsublinea
Left join detalle_listas dlV
on dlV.idarticulo=ea.idarticulo and dlv.idlista=@Venta
Left join detalle_listas dlC
on dlC.idarticulo=ea.idarticulo and dlc.idlista=@Costo
where a.procesa=1
Group by a.idlinea,l.descripcion,a.idsublinea,sl.descripcion
order by a.idlinea,a.idsublinea




GO
/****** Object:  StoredProcedure [dbo].[Vencidos]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Procedure [dbo].[Vencidos]
(
	@Fecha	varchar(20)='20090731',
	@ComputerName	varchar(30)='ServerBaires'
)
as
Select a.Articulo,a.Notas,descripcion,ea.Cantidad
from Temp_Vencimientos t
inner join estadisticaArticulos Ea
on t.idcampo=ea.idcampo
inner join Articulos a
on ea.idarticulo=a.idarticulo
where Vto<@Fecha
and ComputerName=@ComputerName
and isnull(a.meses ,0)<>0
--and @fecha<>'20090731'
GO
/****** Object:  StoredProcedure [dbo].[VHangaraje]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO



CREATE    Procedure [dbo].[VHangaraje]
(
	@Hasta varchar(8)=null,
	@Moneda	varchar(1)='P',
	@Tipo varchar(1)='A'
)
as
Select v.*,mt.Matricula,cl.RazonSocial, (Select ivageneral from 
ParametrosGeneralesSueldos) iva, Case when (Select ivageneral from 
ParametrosGeneralesSueldos)<>0 then isnull(PercepcionIB,0) else 0 end PIB,cl.codigo idCliente

from valoresHangaraje v
inner join Matriculas mt
on v.idMatricula=mt.idMatricula
inner join Clientes cl 
on mt.idCliente=cl.codigo
inner join categorias_Iva ci
on cl.civa=ci.idciva
where (Hasta is null or Hasta<=@Hasta)
and pesos+dolares<>0
and (TipoFacturaVentas=@Tipo or @Tipo='T')
and ((@Moneda='P' and Pesos<>0)
or (@Moneda='D' and Dolares<>0) or @Moneda='T')



GO
/****** Object:  StoredProcedure [dbo].[ViewNextIdentity]    Script Date: 22/12/2025 17:04:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO

-- ViewNextIdentity 'FC0A'

CREATE proc [dbo].[ViewNextIdentity] @ForTable Char(50), @Value int OUTPUT
AS
set nocount on
begin tran
/* if this is the first value generated for this table, start with zero */ 
  if not exists (select * from IdentityTable where ForTable = @ForTable)
    insert IdentityTable (ForTable, Value) values (@ForTable, 0)
/* update must be before select to issue a lock and prevent duplicates
  update IdentityTable
    set Value = Value + 1 
    where ForTable = @ForTable  */ 
  select @Value = Value + 1 from IdentityTable
    where ForTable = @ForTable
commit tran
return @value


GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'EstadisticaArticulosPreciosAnulados', @level2type=N'COLUMN',@level2name=N'Bonificacion'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'0 = No' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'TiposMovimientoStock', @level2type=N'COLUMN',@level2name=N'Aduana'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_DiagramPane1', @value=N'[0E232FF0-B466-11cf-A24F-00AA00A3EFFF, 1.00]
Begin DesignProperties = 
   Begin PaneConfigurations = 
      Begin PaneConfiguration = 0
         NumPanes = 4
         Configuration = "(H (1[22] 4[12] 2[51] 3) )"
      End
      Begin PaneConfiguration = 1
         NumPanes = 3
         Configuration = "(H (1 [50] 4 [25] 3))"
      End
      Begin PaneConfiguration = 2
         NumPanes = 3
         Configuration = "(H (1 [50] 2 [25] 3))"
      End
      Begin PaneConfiguration = 3
         NumPanes = 3
         Configuration = "(H (4 [30] 2 [40] 3))"
      End
      Begin PaneConfiguration = 4
         NumPanes = 2
         Configuration = "(H (1 [56] 3))"
      End
      Begin PaneConfiguration = 5
         NumPanes = 2
         Configuration = "(H (2 [66] 3))"
      End
      Begin PaneConfiguration = 6
         NumPanes = 2
         Configuration = "(H (4 [50] 3))"
      End
      Begin PaneConfiguration = 7
         NumPanes = 1
         Configuration = "(V (3))"
      End
      Begin PaneConfiguration = 8
         NumPanes = 3
         Configuration = "(H (1[56] 4[18] 2) )"
      End
      Begin PaneConfiguration = 9
         NumPanes = 2
         Configuration = "(H (1 [75] 4))"
      End
      Begin PaneConfiguration = 10
         NumPanes = 2
         Configuration = "(H (1[66] 2) )"
      End
      Begin PaneConfiguration = 11
         NumPanes = 2
         Configuration = "(H (4 [60] 2))"
      End
      Begin PaneConfiguration = 12
         NumPanes = 1
         Configuration = "(H (1) )"
      End
      Begin PaneConfiguration = 13
         NumPanes = 1
         Configuration = "(V (4))"
      End
      Begin PaneConfiguration = 14
         NumPanes = 1
         Configuration = "(V (2))"
      End
      ActivePaneConfig = 0
   End
   Begin DiagramPane = 
      Begin Origin = 
         Top = -720
         Left = 0
      End
      Begin Tables = 
         Begin Table = "v"
            Begin Extent = 
               Top = 6
               Left = 38
               Bottom = 114
               Right = 243
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "t"
            Begin Extent = 
               Top = 114
               Left = 38
               Bottom = 222
               Right = 243
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "c"
            Begin Extent = 
               Top = 222
               Left = 38
               Bottom = 330
               Right = 243
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "ci"
            Begin Extent = 
               Top = 330
               Left = 38
               Bottom = 438
               Right = 243
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "do"
            Begin Extent = 
               Top = 438
               Left = 38
               Bottom = 546
               Right = 243
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "dv"
            Begin Extent = 
               Top = 546
               Left = 38
               Bottom = 654
               Right = 243
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "p"
            Begin Extent = 
               Top = 654
               Left = 38
               Bottom = 747
               Right = 243
            End
            DisplayFlags = 280
            TopColumn = 0
         E' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'vBaseIva'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_DiagramPane2', @value=N'nd
         Begin Table = "ho"
            Begin Extent = 
               Top = 750
               Left = 38
               Bottom = 858
               Right = 259
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "ai"
            Begin Extent = 
               Top = 858
               Left = 38
               Bottom = 966
               Right = 243
            End
            DisplayFlags = 280
            TopColumn = 0
         End
      End
   End
   Begin SQLPane = 
   End
   Begin DataPane = 
      Begin ParameterDefaults = ""
      End
      Begin ColumnWidths = 9
         Width = 284
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
      End
   End
   Begin CriteriaPane = 
      Begin ColumnWidths = 12
         Column = 1440
         Alias = 900
         Table = 1170
         Output = 720
         Append = 1400
         NewValue = 1170
         SortType = 1350
         SortOrder = 1410
         GroupBy = 1350
         Filter = 1350
         Or = 1350
         Or = 1350
         Or = 1350
      End
   End
End
' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'vBaseIva'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_DiagramPaneCount', @value=2 , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'vBaseIva'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_DiagramPane1', @value=N'[0E232FF0-B466-11cf-A24F-00AA00A3EFFF, 1.00]
Begin DesignProperties = 
   Begin PaneConfigurations = 
      Begin PaneConfiguration = 0
         NumPanes = 4
         Configuration = "(H (1[40] 4[20] 2[20] 3) )"
      End
      Begin PaneConfiguration = 1
         NumPanes = 3
         Configuration = "(H (1[50] 4[25] 3) )"
      End
      Begin PaneConfiguration = 2
         NumPanes = 3
         Configuration = "(H (1 [50] 2 [25] 3))"
      End
      Begin PaneConfiguration = 3
         NumPanes = 3
         Configuration = "(H (4 [30] 2 [40] 3))"
      End
      Begin PaneConfiguration = 4
         NumPanes = 2
         Configuration = "(H (1[56] 3) )"
      End
      Begin PaneConfiguration = 5
         NumPanes = 2
         Configuration = "(H (2[66] 3) )"
      End
      Begin PaneConfiguration = 6
         NumPanes = 2
         Configuration = "(H (4 [50] 3))"
      End
      Begin PaneConfiguration = 7
         NumPanes = 1
         Configuration = "(V (3) )"
      End
      Begin PaneConfiguration = 8
         NumPanes = 3
         Configuration = "(H (1[56] 4[18] 2) )"
      End
      Begin PaneConfiguration = 9
         NumPanes = 2
         Configuration = "(H (1[75] 4) )"
      End
      Begin PaneConfiguration = 10
         NumPanes = 2
         Configuration = "(H (1[66] 2) )"
      End
      Begin PaneConfiguration = 11
         NumPanes = 2
         Configuration = "(H (4 [60] 2))"
      End
      Begin PaneConfiguration = 12
         NumPanes = 1
         Configuration = "(H (1) )"
      End
      Begin PaneConfiguration = 13
         NumPanes = 1
         Configuration = "(V (4))"
      End
      Begin PaneConfiguration = 14
         NumPanes = 1
         Configuration = "(V (2))"
      End
      ActivePaneConfig = 5
   End
   Begin DiagramPane = 
      PaneHidden = 
      Begin Origin = 
         Top = -288
         Left = 0
      End
      Begin Tables = 
         Begin Table = "v"
            Begin Extent = 
               Top = 6
               Left = 38
               Bottom = 114
               Right = 227
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "t"
            Begin Extent = 
               Top = 6
               Left = 265
               Bottom = 114
               Right = 454
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "c"
            Begin Extent = 
               Top = 114
               Left = 38
               Bottom = 222
               Right = 227
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "ci"
            Begin Extent = 
               Top = 114
               Left = 265
               Bottom = 222
               Right = 454
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "do"
            Begin Extent = 
               Top = 222
               Left = 38
               Bottom = 330
               Right = 227
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "dv"
            Begin Extent = 
               Top = 222
               Left = 265
               Bottom = 330
               Right = 454
            End
            DisplayFlags = 280
            TopColumn = 0
         End
         Begin Table = "p"
            Begin Extent = 
               Top = 330
               Left = 38
               Bottom = 423
               Right = 227
            End
            DisplayFlags = 280
            Top' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'vIvaVentas'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_DiagramPane2', @value=N'Column = 0
         End
      End
   End
   Begin SQLPane = 
   End
   Begin DataPane = 
      Begin ParameterDefaults = ""
      End
      Begin ColumnWidths = 9
         Width = 284
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
         Width = 1500
      End
   End
   Begin CriteriaPane = 
      PaneHidden = 
      Begin ColumnWidths = 11
         Column = 1440
         Alias = 900
         Table = 1170
         Output = 720
         Append = 1400
         NewValue = 1170
         SortType = 1350
         SortOrder = 1410
         GroupBy = 1350
         Filter = 1350
         Or = 1350
         Or = 1350
         Or = 1350
      End
   End
End
' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'vIvaVentas'
GO
EXEC sys.sp_addextendedproperty @name=N'MS_DiagramPaneCount', @value=2 , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'VIEW',@level1name=N'vIvaVentas'
GO
